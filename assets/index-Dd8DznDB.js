(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const j of document.querySelectorAll('link[rel="modulepreload"]'))_(j);new MutationObserver(j=>{for(const _t of j)if(_t.type==="childList")for(const Wt of _t.addedNodes)Wt.tagName==="LINK"&&Wt.rel==="modulepreload"&&_(Wt)}).observe(document,{childList:!0,subtree:!0});function h(j){const _t={};return j.integrity&&(_t.integrity=j.integrity),j.referrerPolicy&&(_t.referrerPolicy=j.referrerPolicy),j.crossOrigin==="use-credentials"?_t.credentials="include":j.crossOrigin==="anonymous"?_t.credentials="omit":_t.credentials="same-origin",_t}function _(j){if(j.ep)return;j.ep=!0;const _t=h(j);fetch(j.href,_t)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(e){return e===null||typeof e!="object"?null:(e=z$1&&e[z$1]||e["@@iterator"],typeof e=="function"?e:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(e,i,h){this.props=e,this.context=i,this.refs=D$1,this.updater=h||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(e,i){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,i,"setState")};E$1.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(e,i,h){this.props=e,this.context=i,this.refs=D$1,this.updater=h||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(e,i,h){var _,j={},_t=null,Wt=null;if(i!=null)for(_ in i.ref!==void 0&&(Wt=i.ref),i.key!==void 0&&(_t=""+i.key),i)J.call(i,_)&&!L$1.hasOwnProperty(_)&&(j[_]=i[_]);var _n=arguments.length-2;if(_n===1)j.children=h;else if(1<_n){for(var _i=Array(_n),_s=0;_s<_n;_s++)_i[_s]=arguments[_s+2];j.children=_i}if(e&&e.defaultProps)for(_ in _n=e.defaultProps,_n)j[_]===void 0&&(j[_]=_n[_]);return{$$typeof:l$1,type:e,key:_t,ref:Wt,props:j,_owner:K$1.current}}function N$1(e,i){return{$$typeof:l$1,type:e.type,key:i,ref:e.ref,props:e.props,_owner:e._owner}}function O$1(e){return typeof e=="object"&&e!==null&&e.$$typeof===l$1}function escape$1(e){var i={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(h){return i[h]})}var P$1=/\/+/g;function Q$1(e,i){return typeof e=="object"&&e!==null&&e.key!=null?escape$1(""+e.key):i.toString(36)}function R$1(e,i,h,_,j){var _t=typeof e;(_t==="undefined"||_t==="boolean")&&(e=null);var Wt=!1;if(e===null)Wt=!0;else switch(_t){case"string":case"number":Wt=!0;break;case"object":switch(e.$$typeof){case l$1:case n$1:Wt=!0}}if(Wt)return Wt=e,j=j(Wt),e=_===""?"."+Q$1(Wt,0):_,I$1(j)?(h="",e!=null&&(h=e.replace(P$1,"$&/")+"/"),R$1(j,i,h,"",function(_s){return _s})):j!=null&&(O$1(j)&&(j=N$1(j,h+(!j.key||Wt&&Wt.key===j.key?"":(""+j.key).replace(P$1,"$&/")+"/")+e)),i.push(j)),1;if(Wt=0,_=_===""?".":_+":",I$1(e))for(var _n=0;_n<e.length;_n++){_t=e[_n];var _i=_+Q$1(_t,_n);Wt+=R$1(_t,i,h,_i,j)}else if(_i=A$1(e),typeof _i=="function")for(e=_i.call(e),_n=0;!(_t=e.next()).done;)_t=_t.value,_i=_+Q$1(_t,_n++),Wt+=R$1(_t,i,h,_i,j);else if(_t==="object")throw i=String(e),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return Wt}function S$1(e,i,h){if(e==null)return e;var _=[],j=0;return R$1(e,_,"","",function(_t){return i.call(h,_t,j++)}),_}function T$1(e){if(e._status===-1){var i=e._result;i=i(),i.then(function(h){(e._status===0||e._status===-1)&&(e._status=1,e._result=h)},function(h){(e._status===0||e._status===-1)&&(e._status=2,e._result=h)}),e._status===-1&&(e._status=0,e._result=i)}if(e._status===1)return e._result.default;throw e._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$1(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(e,i,h){S$1(e,function(){i.apply(this,arguments)},h)},count:function(e){var i=0;return S$1(e,function(){i++}),i},toArray:function(e){return S$1(e,function(i){return i})||[]},only:function(e){if(!O$1(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$1;react_production_min.cloneElement=function(e,i,h){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var _=C$1({},e.props),j=e.key,_t=e.ref,Wt=e._owner;if(i!=null){if(i.ref!==void 0&&(_t=i.ref,Wt=K$1.current),i.key!==void 0&&(j=""+i.key),e.type&&e.type.defaultProps)var _n=e.type.defaultProps;for(_i in i)J.call(i,_i)&&!L$1.hasOwnProperty(_i)&&(_[_i]=i[_i]===void 0&&_n!==void 0?_n[_i]:i[_i])}var _i=arguments.length-2;if(_i===1)_.children=h;else if(1<_i){_n=Array(_i);for(var _s=0;_s<_i;_s++)_n[_s]=arguments[_s+2];_.children=_n}return{$$typeof:l$1,type:e.type,key:j,ref:_t,props:_,_owner:Wt}};react_production_min.createContext=function(e){return e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:t,_context:e},e.Consumer=e};react_production_min.createElement=M$1;react_production_min.createFactory=function(e){var i=M$1.bind(null,e);return i.type=e,i};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(e){return{$$typeof:v$1,render:e}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(e){return{$$typeof:y,_payload:{_status:-1,_result:e},_init:T$1}};react_production_min.memo=function(e,i){return{$$typeof:x,type:e,compare:i===void 0?null:i}};react_production_min.startTransition=function(e){var i=V$1.transition;V$1.transition={};try{e()}finally{V$1.transition=i}};react_production_min.unstable_act=X$1;react_production_min.useCallback=function(e,i){return U$1.current.useCallback(e,i)};react_production_min.useContext=function(e){return U$1.current.useContext(e)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(e){return U$1.current.useDeferredValue(e)};react_production_min.useEffect=function(e,i){return U$1.current.useEffect(e,i)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(e,i,h){return U$1.current.useImperativeHandle(e,i,h)};react_production_min.useInsertionEffect=function(e,i){return U$1.current.useInsertionEffect(e,i)};react_production_min.useLayoutEffect=function(e,i){return U$1.current.useLayoutEffect(e,i)};react_production_min.useMemo=function(e,i){return U$1.current.useMemo(e,i)};react_production_min.useReducer=function(e,i,h){return U$1.current.useReducer(e,i,h)};react_production_min.useRef=function(e){return U$1.current.useRef(e)};react_production_min.useState=function(e){return U$1.current.useState(e)};react_production_min.useSyncExternalStore=function(e,i,h){return U$1.current.useSyncExternalStore(e,i,h)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(e,i,h){var _,j={},_t=null,Wt=null;h!==void 0&&(_t=""+h),i.key!==void 0&&(_t=""+i.key),i.ref!==void 0&&(Wt=i.ref);for(_ in i)m$1.call(i,_)&&!p$1.hasOwnProperty(_)&&(j[_]=i[_]);if(e&&e.defaultProps)for(_ in i=e.defaultProps,i)j[_]===void 0&&(j[_]=i[_]);return{$$typeof:k,type:e,key:_t,ref:Wt,props:j,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function i(CE,jE){var LE=CE.length;CE.push(jE);t:for(;0<LE;){var i_=LE-1>>>1,o_=CE[i_];if(0<j(o_,jE))CE[i_]=jE,CE[LE]=o_,LE=i_;else break t}}function h(CE){return CE.length===0?null:CE[0]}function _(CE){if(CE.length===0)return null;var jE=CE[0],LE=CE.pop();if(LE!==jE){CE[0]=LE;t:for(var i_=0,o_=CE.length,w_=o_>>>1;i_<w_;){var _y=2*(i_+1)-1,bS=CE[_y],MS=_y+1,qR=CE[MS];if(0>j(bS,LE))MS<o_&&0>j(qR,bS)?(CE[i_]=qR,CE[MS]=LE,i_=MS):(CE[i_]=bS,CE[_y]=LE,i_=_y);else if(MS<o_&&0>j(qR,LE))CE[i_]=qR,CE[MS]=LE,i_=MS;else break t}}return jE}function j(CE,jE){var LE=CE.sortIndex-jE.sortIndex;return LE!==0?LE:CE.id-jE.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _t=performance;e.unstable_now=function(){return _t.now()}}else{var Wt=Date,_n=Wt.now();e.unstable_now=function(){return Wt.now()-_n}}var _i=[],_s=[],_u=1,_h=null,_d=3,nE=!1,aE=!1,uE=!1,hE=typeof setTimeout=="function"?setTimeout:null,oE=typeof clearTimeout=="function"?clearTimeout:null,sE=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function dE(CE){for(var jE=h(_s);jE!==null;){if(jE.callback===null)_(_s);else if(jE.startTime<=CE)_(_s),jE.sortIndex=jE.expirationTime,i(_i,jE);else break;jE=h(_s)}}function vE(CE){if(uE=!1,dE(CE),!aE)if(h(_i)!==null)aE=!0,OE(AE);else{var jE=h(_s);jE!==null&&HE(vE,jE.startTime-CE)}}function AE(CE,jE){aE=!1,uE&&(uE=!1,oE(QE),QE=-1),nE=!0;var LE=_d;try{for(dE(jE),_h=h(_i);_h!==null&&(!(_h.expirationTime>jE)||CE&&!FE());){var i_=_h.callback;if(typeof i_=="function"){_h.callback=null,_d=_h.priorityLevel;var o_=i_(_h.expirationTime<=jE);jE=e.unstable_now(),typeof o_=="function"?_h.callback=o_:_h===h(_i)&&_(_i),dE(jE)}else _(_i);_h=h(_i)}if(_h!==null)var w_=!0;else{var _y=h(_s);_y!==null&&HE(vE,_y.startTime-jE),w_=!1}return w_}finally{_h=null,_d=LE,nE=!1}}var PE=!1,IE=null,QE=-1,m_=5,yE=-1;function FE(){return!(e.unstable_now()-yE<m_)}function UE(){if(IE!==null){var CE=e.unstable_now();yE=CE;var jE=!0;try{jE=IE(!0,CE)}finally{jE?qE():(PE=!1,IE=null)}}else PE=!1}var qE;if(typeof sE=="function")qE=function(){sE(UE)};else if(typeof MessageChannel<"u"){var gE=new MessageChannel,RE=gE.port2;gE.port1.onmessage=UE,qE=function(){RE.postMessage(null)}}else qE=function(){hE(UE,0)};function OE(CE){IE=CE,PE||(PE=!0,qE())}function HE(CE,jE){QE=hE(function(){CE(e.unstable_now())},jE)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(CE){CE.callback=null},e.unstable_continueExecution=function(){aE||nE||(aE=!0,OE(AE))},e.unstable_forceFrameRate=function(CE){0>CE||125<CE?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):m_=0<CE?Math.floor(1e3/CE):5},e.unstable_getCurrentPriorityLevel=function(){return _d},e.unstable_getFirstCallbackNode=function(){return h(_i)},e.unstable_next=function(CE){switch(_d){case 1:case 2:case 3:var jE=3;break;default:jE=_d}var LE=_d;_d=jE;try{return CE()}finally{_d=LE}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(CE,jE){switch(CE){case 1:case 2:case 3:case 4:case 5:break;default:CE=3}var LE=_d;_d=CE;try{return jE()}finally{_d=LE}},e.unstable_scheduleCallback=function(CE,jE,LE){var i_=e.unstable_now();switch(typeof LE=="object"&&LE!==null?(LE=LE.delay,LE=typeof LE=="number"&&0<LE?i_+LE:i_):LE=i_,CE){case 1:var o_=-1;break;case 2:o_=250;break;case 5:o_=1073741823;break;case 4:o_=1e4;break;default:o_=5e3}return o_=LE+o_,CE={id:_u++,callback:jE,priorityLevel:CE,startTime:LE,expirationTime:o_,sortIndex:-1},LE>i_?(CE.sortIndex=LE,i(_s,CE),h(_i)===null&&CE===h(_s)&&(uE?(oE(QE),QE=-1):uE=!0,HE(vE,LE-i_))):(CE.sortIndex=o_,i(_i,CE),aE||nE||(aE=!0,OE(AE))),CE},e.unstable_shouldYield=FE,e.unstable_wrapCallback=function(CE){var jE=_d;return function(){var LE=_d;_d=jE;try{return CE.apply(this,arguments)}finally{_d=LE}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(e){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+e,h=1;h<arguments.length;h++)i+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+e+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(e,i){ha(e,i),ha(e+"Capture",i)}function ha(e,i){for(ea[e]=i,e=0;e<i.length;e++)da.add(i[e])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(e){return ja.call(ma,e)?!0:ja.call(la,e)?!1:ka.test(e)?ma[e]=!0:(la[e]=!0,!1)}function pa(e,i,h,_){if(h!==null&&h.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return _?!1:h!==null?!h.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function qa(e,i,h,_){if(i===null||typeof i>"u"||pa(e,i,h,_))return!0;if(_)return!1;if(h!==null)switch(h.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function v(e,i,h,_,j,_t,Wt){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=_,this.attributeNamespace=j,this.mustUseProperty=h,this.propertyName=e,this.type=i,this.sanitizeURL=_t,this.removeEmptyString=Wt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){z[e]=new v(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var i=e[0];z[i]=new v(i,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){z[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){z[e]=new v(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){z[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){z[e]=new v(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){z[e]=new v(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){z[e]=new v(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){z[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v(i,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v(i,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var i=e.replace(ra,sa);z[i]=new v(i,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){z[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){z[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)});function ta(e,i,h,_){var j=z.hasOwnProperty(i)?z[i]:null;(j!==null?j.type!==0:_||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(qa(i,h,j,_)&&(h=null),_||j===null?oa(i)&&(h===null?e.removeAttribute(i):e.setAttribute(i,""+h)):j.mustUseProperty?e[j.propertyName]=h===null?j.type===3?!1:"":h:(i=j.attributeName,_=j.attributeNamespace,h===null?e.removeAttribute(i):(j=j.type,h=j===3||j===4&&h===!0?"":""+h,_?e.setAttributeNS(_,i,h):e.setAttribute(i,h))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(e){return e===null||typeof e!="object"?null:(e=Ja&&e[Ja]||e["@@iterator"],typeof e=="function"?e:null)}var A=Object.assign,La;function Ma(e){if(La===void 0)try{throw Error()}catch(h){var i=h.stack.trim().match(/\n( *(at )?)/);La=i&&i[1]||""}return`
`+La+e}var Na=!1;function Oa(e,i){if(!e||Na)return"";Na=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(_s){var _=_s}Reflect.construct(e,[],i)}else{try{i.call()}catch(_s){_=_s}e.call(i.prototype)}else{try{throw Error()}catch(_s){_=_s}e()}}catch(_s){if(_s&&_&&typeof _s.stack=="string"){for(var j=_s.stack.split(`
`),_t=_.stack.split(`
`),Wt=j.length-1,_n=_t.length-1;1<=Wt&&0<=_n&&j[Wt]!==_t[_n];)_n--;for(;1<=Wt&&0<=_n;Wt--,_n--)if(j[Wt]!==_t[_n]){if(Wt!==1||_n!==1)do if(Wt--,_n--,0>_n||j[Wt]!==_t[_n]){var _i=`
`+j[Wt].replace(" at new "," at ");return e.displayName&&_i.includes("<anonymous>")&&(_i=_i.replace("<anonymous>",e.displayName)),_i}while(1<=Wt&&0<=_n);break}}}finally{Na=!1,Error.prepareStackTrace=h}return(e=e?e.displayName||e.name:"")?Ma(e):""}function Pa(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=Oa(e.type,!1),e;case 11:return e=Oa(e.type.render,!1),e;case 1:return e=Oa(e.type,!0),e;default:return""}}function Qa(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ca:return(e.displayName||"Context")+".Consumer";case Ba:return(e._context.displayName||"Context")+".Provider";case Da:var i=e.render;return e=e.displayName,e||(e=i.displayName||i.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ga:return i=e.displayName||null,i!==null?i:Qa(e.type)||"Memo";case Ha:i=e._payload,e=e._init;try{return Qa(e(i))}catch{}}return null}function Ra(e){var i=e.type;switch(e.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=i.render,e=e.displayName||e.name||"",i.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(i);case 8:return i===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Sa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ta(e){var i=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Ua(e){var i=Ta(e)?"checked":"value",h=Object.getOwnPropertyDescriptor(e.constructor.prototype,i),_=""+e[i];if(!e.hasOwnProperty(i)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var j=h.get,_t=h.set;return Object.defineProperty(e,i,{configurable:!0,get:function(){return j.call(this)},set:function(Wt){_=""+Wt,_t.call(this,Wt)}}),Object.defineProperty(e,i,{enumerable:h.enumerable}),{getValue:function(){return _},setValue:function(Wt){_=""+Wt},stopTracking:function(){e._valueTracker=null,delete e[i]}}}}function Va(e){e._valueTracker||(e._valueTracker=Ua(e))}function Wa(e){if(!e)return!1;var i=e._valueTracker;if(!i)return!0;var h=i.getValue(),_="";return e&&(_=Ta(e)?e.checked?"true":"false":e.value),e=_,e!==h?(i.setValue(e),!0):!1}function Xa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ya(e,i){var h=i.checked;return A({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??e._wrapperState.initialChecked})}function Za(e,i){var h=i.defaultValue==null?"":i.defaultValue,_=i.checked!=null?i.checked:i.defaultChecked;h=Sa(i.value!=null?i.value:h),e._wrapperState={initialChecked:_,initialValue:h,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function ab(e,i){i=i.checked,i!=null&&ta(e,"checked",i,!1)}function bb(e,i){ab(e,i);var h=Sa(i.value),_=i.type;if(h!=null)_==="number"?(h===0&&e.value===""||e.value!=h)&&(e.value=""+h):e.value!==""+h&&(e.value=""+h);else if(_==="submit"||_==="reset"){e.removeAttribute("value");return}i.hasOwnProperty("value")?cb(e,i.type,h):i.hasOwnProperty("defaultValue")&&cb(e,i.type,Sa(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(e.defaultChecked=!!i.defaultChecked)}function db(e,i,h){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var _=i.type;if(!(_!=="submit"&&_!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+e._wrapperState.initialValue,h||i===e.value||(e.value=i),e.defaultValue=i}h=e.name,h!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,h!==""&&(e.name=h)}function cb(e,i,h){(i!=="number"||Xa(e.ownerDocument)!==e)&&(h==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+h&&(e.defaultValue=""+h))}var eb=Array.isArray;function fb(e,i,h,_){if(e=e.options,i){i={};for(var j=0;j<h.length;j++)i["$"+h[j]]=!0;for(h=0;h<e.length;h++)j=i.hasOwnProperty("$"+e[h].value),e[h].selected!==j&&(e[h].selected=j),j&&_&&(e[h].defaultSelected=!0)}else{for(h=""+Sa(h),i=null,j=0;j<e.length;j++){if(e[j].value===h){e[j].selected=!0,_&&(e[j].defaultSelected=!0);return}i!==null||e[j].disabled||(i=e[j])}i!==null&&(i.selected=!0)}}function gb(e,i){if(i.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},i,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function hb(e,i){var h=i.value;if(h==null){if(h=i.children,i=i.defaultValue,h!=null){if(i!=null)throw Error(p(92));if(eb(h)){if(1<h.length)throw Error(p(93));h=h[0]}i=h}i==null&&(i=""),h=i}e._wrapperState={initialValue:Sa(h)}}function ib(e,i){var h=Sa(i.value),_=Sa(i.defaultValue);h!=null&&(h=""+h,h!==e.value&&(e.value=h),i.defaultValue==null&&e.defaultValue!==h&&(e.defaultValue=h)),_!=null&&(e.defaultValue=""+_)}function jb(e){var i=e.textContent;i===e._wrapperState.initialValue&&i!==""&&i!==null&&(e.value=i)}function kb(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(e,i){return e==null||e==="http://www.w3.org/1999/xhtml"?kb(i):e==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mb,nb=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,h,_,j){MSApp.execUnsafeLocalFunction(function(){return e(i,h,_,j)})}:e}(function(e,i){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=i;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=mb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;i.firstChild;)e.appendChild(i.firstChild)}});function ob(e,i){if(i){var h=e.firstChild;if(h&&h===e.lastChild&&h.nodeType===3){h.nodeValue=i;return}}e.textContent=i}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(e){qb.forEach(function(i){i=i+e.charAt(0).toUpperCase()+e.substring(1),pb[i]=pb[e]})});function rb(e,i,h){return i==null||typeof i=="boolean"||i===""?"":h||typeof i!="number"||i===0||pb.hasOwnProperty(e)&&pb[e]?(""+i).trim():i+"px"}function sb(e,i){e=e.style;for(var h in i)if(i.hasOwnProperty(h)){var _=h.indexOf("--")===0,j=rb(h,i[h],_);h==="float"&&(h="cssFloat"),_?e.setProperty(h,j):e[h]=j}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(e,i){if(i){if(tb[e]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(p(137,e));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(p(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(p(61))}if(i.style!=null&&typeof i.style!="object")throw Error(p(62))}}function vb(e,i){if(e.indexOf("-")===-1)return typeof i.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yb=null,zb=null,Ab=null;function Bb(e){if(e=Cb(e)){if(typeof yb!="function")throw Error(p(280));var i=e.stateNode;i&&(i=Db(i),yb(e.stateNode,e.type,i))}}function Eb(e){zb?Ab?Ab.push(e):Ab=[e]:zb=e}function Fb(){if(zb){var e=zb,i=Ab;if(Ab=zb=null,Bb(e),i)for(e=0;e<i.length;e++)Bb(i[e])}}function Gb(e,i){return e(i)}function Hb(){}var Ib=!1;function Jb(e,i,h){if(Ib)return e(i,h);Ib=!0;try{return Gb(e,i,h)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(e,i){var h=e.stateNode;if(h===null)return null;var _=Db(h);if(_===null)return null;h=_[i];t:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(e=e.type,_=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!_;break t;default:e=!1}if(e)return null;if(h&&typeof h!="function")throw Error(p(231,i,typeof h));return h}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(e,i,h,_,j,_t,Wt,_n,_i){var _s=Array.prototype.slice.call(arguments,3);try{i.apply(h,_s)}catch(_u){this.onError(_u)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(e){Ob=!0,Pb=e}};function Tb(e,i,h,_,j,_t,Wt,_n,_i){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(e,i,h,_,j,_t,Wt,_n,_i){if(Tb.apply(this,arguments),Ob){if(Ob){var _s=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=_s)}}function Vb(e){var i=e,h=e;if(e.alternate)for(;i.return;)i=i.return;else{e=i;do i=e,i.flags&4098&&(h=i.return),e=i.return;while(e)}return i.tag===3?h:null}function Wb(e){if(e.tag===13){var i=e.memoizedState;if(i===null&&(e=e.alternate,e!==null&&(i=e.memoizedState)),i!==null)return i.dehydrated}return null}function Xb(e){if(Vb(e)!==e)throw Error(p(188))}function Yb(e){var i=e.alternate;if(!i){if(i=Vb(e),i===null)throw Error(p(188));return i!==e?null:e}for(var h=e,_=i;;){var j=h.return;if(j===null)break;var _t=j.alternate;if(_t===null){if(_=j.return,_!==null){h=_;continue}break}if(j.child===_t.child){for(_t=j.child;_t;){if(_t===h)return Xb(j),e;if(_t===_)return Xb(j),i;_t=_t.sibling}throw Error(p(188))}if(h.return!==_.return)h=j,_=_t;else{for(var Wt=!1,_n=j.child;_n;){if(_n===h){Wt=!0,h=j,_=_t;break}if(_n===_){Wt=!0,_=j,h=_t;break}_n=_n.sibling}if(!Wt){for(_n=_t.child;_n;){if(_n===h){Wt=!0,h=_t,_=j;break}if(_n===_){Wt=!0,_=_t,h=j;break}_n=_n.sibling}if(!Wt)throw Error(p(189))}}if(h.alternate!==_)throw Error(p(190))}if(h.tag!==3)throw Error(p(188));return h.stateNode.current===h?e:i}function Zb(e){return e=Yb(e),e!==null?$b(e):null}function $b(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var i=$b(e);if(i!==null)return i;e=e.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(e){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,e,void 0,(e.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(e){return e>>>=0,e===0?32:31-(pc(e)/qc|0)|0}var rc=64,sc=4194304;function tc(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function uc(e,i){var h=e.pendingLanes;if(h===0)return 0;var _=0,j=e.suspendedLanes,_t=e.pingedLanes,Wt=h&268435455;if(Wt!==0){var _n=Wt&~j;_n!==0?_=tc(_n):(_t&=Wt,_t!==0&&(_=tc(_t)))}else Wt=h&~j,Wt!==0?_=tc(Wt):_t!==0&&(_=tc(_t));if(_===0)return 0;if(i!==0&&i!==_&&!(i&j)&&(j=_&-_,_t=i&-i,j>=_t||j===16&&(_t&4194240)!==0))return i;if(_&4&&(_|=h&16),i=e.entangledLanes,i!==0)for(e=e.entanglements,i&=_;0<i;)h=31-oc(i),j=1<<h,_|=e[h],i&=~j;return _}function vc(e,i){switch(e){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(e,i){for(var h=e.suspendedLanes,_=e.pingedLanes,j=e.expirationTimes,_t=e.pendingLanes;0<_t;){var Wt=31-oc(_t),_n=1<<Wt,_i=j[Wt];_i===-1?(!(_n&h)||_n&_)&&(j[Wt]=vc(_n,i)):_i<=i&&(e.expiredLanes|=_n),_t&=~_n}}function xc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function yc(){var e=rc;return rc<<=1,!(rc&4194240)&&(rc=64),e}function zc(e){for(var i=[],h=0;31>h;h++)i.push(e);return i}function Ac(e,i,h){e.pendingLanes|=i,i!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,i=31-oc(i),e[i]=h}function Bc(e,i){var h=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;var _=e.eventTimes;for(e=e.expirationTimes;0<h;){var j=31-oc(h),_t=1<<j;i[j]=0,_[j]=-1,e[j]=-1,h&=~_t}}function Cc(e,i){var h=e.entangledLanes|=i;for(e=e.entanglements;h;){var _=31-oc(h),j=1<<_;j&i|e[_]&i&&(e[_]|=i),h&=~j}}var C=0;function Dc(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(e,i){switch(e){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(i.pointerId)}}function Tc(e,i,h,_,j,_t){return e===null||e.nativeEvent!==_t?(e={blockedOn:i,domEventName:h,eventSystemFlags:_,nativeEvent:_t,targetContainers:[j]},i!==null&&(i=Cb(i),i!==null&&Fc(i)),e):(e.eventSystemFlags|=_,i=e.targetContainers,j!==null&&i.indexOf(j)===-1&&i.push(j),e)}function Uc(e,i,h,_,j){switch(i){case"focusin":return Lc=Tc(Lc,e,i,h,_,j),!0;case"dragenter":return Mc=Tc(Mc,e,i,h,_,j),!0;case"mouseover":return Nc=Tc(Nc,e,i,h,_,j),!0;case"pointerover":var _t=j.pointerId;return Oc.set(_t,Tc(Oc.get(_t)||null,e,i,h,_,j)),!0;case"gotpointercapture":return _t=j.pointerId,Pc.set(_t,Tc(Pc.get(_t)||null,e,i,h,_,j)),!0}return!1}function Vc(e){var i=Wc(e.target);if(i!==null){var h=Vb(i);if(h!==null){if(i=h.tag,i===13){if(i=Wb(h),i!==null){e.blockedOn=i,Ic(e.priority,function(){Gc(h)});return}}else if(i===3&&h.stateNode.current.memoizedState.isDehydrated){e.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xc(e){if(e.blockedOn!==null)return!1;for(var i=e.targetContainers;0<i.length;){var h=Yc(e.domEventName,e.eventSystemFlags,i[0],e.nativeEvent);if(h===null){h=e.nativeEvent;var _=new h.constructor(h.type,h);wb=_,h.target.dispatchEvent(_),wb=null}else return i=Cb(h),i!==null&&Fc(i),e.blockedOn=h,!1;i.shift()}return!0}function Zc(e,i,h){Xc(e)&&h.delete(i)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(e,i){e.blockedOn===i&&(e.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(e){function i(j){return ad(j,e)}if(0<Kc.length){ad(Kc[0],e);for(var h=1;h<Kc.length;h++){var _=Kc[h];_.blockedOn===e&&(_.blockedOn=null)}}for(Lc!==null&&ad(Lc,e),Mc!==null&&ad(Mc,e),Nc!==null&&ad(Nc,e),Oc.forEach(i),Pc.forEach(i),h=0;h<Qc.length;h++)_=Qc[h],_.blockedOn===e&&(_.blockedOn=null);for(;0<Qc.length&&(h=Qc[0],h.blockedOn===null);)Vc(h),h.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(e,i,h,_){var j=C,_t=cd.transition;cd.transition=null;try{C=1,fd(e,i,h,_)}finally{C=j,cd.transition=_t}}function gd(e,i,h,_){var j=C,_t=cd.transition;cd.transition=null;try{C=4,fd(e,i,h,_)}finally{C=j,cd.transition=_t}}function fd(e,i,h,_){if(dd){var j=Yc(e,i,h,_);if(j===null)hd(e,i,_,id,h),Sc(e,_);else if(Uc(j,e,i,h,_))_.stopPropagation();else if(Sc(e,_),i&4&&-1<Rc.indexOf(e)){for(;j!==null;){var _t=Cb(j);if(_t!==null&&Ec(_t),_t=Yc(e,i,h,_),_t===null&&hd(e,i,_,id,h),_t===j)break;j=_t}j!==null&&_.stopPropagation()}else hd(e,i,_,null,h)}}var id=null;function Yc(e,i,h,_){if(id=null,e=xb(_),e=Wc(e),e!==null)if(i=Vb(e),i===null)e=null;else if(h=i.tag,h===13){if(e=Wb(i),e!==null)return e;e=null}else if(h===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;e=null}else i!==e&&(e=null);return id=e,null}function jd(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var e,i=ld,h=i.length,_,j="value"in kd?kd.value:kd.textContent,_t=j.length;for(e=0;e<h&&i[e]===j[e];e++);var Wt=h-e;for(_=1;_<=Wt&&i[h-_]===j[_t-_];_++);return md=j.slice(e,1<_?1-_:void 0)}function od(e){var i=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&i===13&&(e=13)):e=i,e===10&&(e=13),32<=e||e===13?e:0}function pd(){return!0}function qd(){return!1}function rd(e){function i(h,_,j,_t,Wt){this._reactName=h,this._targetInst=j,this.type=_,this.nativeEvent=_t,this.target=Wt,this.currentTarget=null;for(var _n in e)e.hasOwnProperty(_n)&&(h=e[_n],this[_n]=h?h(_t):_t[_n]);return this.isDefaultPrevented=(_t.defaultPrevented!=null?_t.defaultPrevented:_t.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),i}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yd&&(yd&&e.type==="mousemove"?(wd=e.screenX-yd.screenX,xd=e.screenY-yd.screenY):xd=wd=0,yd=e),wd)},movementY:function(e){return"movementY"in e?e.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(e){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(e):(e=Od[e])?!!i[e]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(e){if(e.key){var i=Md[e.key]||e.key;if(i!=="Unidentified")return i}return e.type==="keypress"?(e=od(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Nd[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(e){return e.type==="keypress"?od(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?od(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe=!1;function ge(e,i){switch(e){case"keyup":return $d.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ie=!1;function je(e,i){switch(e){case"compositionend":return he(i);case"keypress":return i.which!==32?null:(fe=!0,ee);case"textInput":return e=i.data,e===ee&&fe?null:e;default:return null}}function ke(e,i){if(ie)return e==="compositionend"||!ae&&ge(e,i)?(e=nd(),md=ld=kd=null,ie=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return de&&i.locale!=="ko"?null:i.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i==="input"?!!le[e.type]:i==="textarea"}function ne(e,i,h,_){Eb(_),i=oe(i,"onChange"),0<i.length&&(h=new td("onChange","change",null,h,_),e.push({event:h,listeners:i}))}var pe=null,qe=null;function re(e){se(e,0)}function te(e){var i=ue(e);if(Wa(i))return e}function ve(e,i){if(e==="change")return i}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(e){if(e.propertyName==="value"&&te(qe)){var i=[];ne(i,qe,e,xb(e)),Jb(re,i)}}function Ce(e,i,h){e==="focusin"?(Ae(),pe=i,qe=h,pe.attachEvent("onpropertychange",Be)):e==="focusout"&&Ae()}function De(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return te(qe)}function Ee(e,i){if(e==="click")return te(i)}function Fe(e,i){if(e==="input"||e==="change")return te(i)}function Ge(e,i){return e===i&&(e!==0||1/e===1/i)||e!==e&&i!==i}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(e,i){if(He(e,i))return!0;if(typeof e!="object"||e===null||typeof i!="object"||i===null)return!1;var h=Object.keys(e),_=Object.keys(i);if(h.length!==_.length)return!1;for(_=0;_<h.length;_++){var j=h[_];if(!ja.call(i,j)||!He(e[j],i[j]))return!1}return!0}function Je(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ke(e,i){var h=Je(e);e=0;for(var _;h;){if(h.nodeType===3){if(_=e+h.textContent.length,e<=i&&_>=i)return{node:h,offset:i-e};e=_}t:{for(;h;){if(h.nextSibling){h=h.nextSibling;break t}h=h.parentNode}h=void 0}h=Je(h)}}function Le(e,i){return e&&i?e===i?!0:e&&e.nodeType===3?!1:i&&i.nodeType===3?Le(e,i.parentNode):"contains"in e?e.contains(i):e.compareDocumentPosition?!!(e.compareDocumentPosition(i)&16):!1:!1}function Me(){for(var e=window,i=Xa();i instanceof e.HTMLIFrameElement;){try{var h=typeof i.contentWindow.location.href=="string"}catch{h=!1}if(h)e=i.contentWindow;else break;i=Xa(e.document)}return i}function Ne(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i&&(i==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||i==="textarea"||e.contentEditable==="true")}function Oe(e){var i=Me(),h=e.focusedElem,_=e.selectionRange;if(i!==h&&h&&h.ownerDocument&&Le(h.ownerDocument.documentElement,h)){if(_!==null&&Ne(h)){if(i=_.start,e=_.end,e===void 0&&(e=i),"selectionStart"in h)h.selectionStart=i,h.selectionEnd=Math.min(e,h.value.length);else if(e=(i=h.ownerDocument||document)&&i.defaultView||window,e.getSelection){e=e.getSelection();var j=h.textContent.length,_t=Math.min(_.start,j);_=_.end===void 0?_t:Math.min(_.end,j),!e.extend&&_t>_&&(j=_,_=_t,_t=j),j=Ke(h,_t);var Wt=Ke(h,_);j&&Wt&&(e.rangeCount!==1||e.anchorNode!==j.node||e.anchorOffset!==j.offset||e.focusNode!==Wt.node||e.focusOffset!==Wt.offset)&&(i=i.createRange(),i.setStart(j.node,j.offset),e.removeAllRanges(),_t>_?(e.addRange(i),e.extend(Wt.node,Wt.offset)):(i.setEnd(Wt.node,Wt.offset),e.addRange(i)))}}for(i=[],e=h;e=e.parentNode;)e.nodeType===1&&i.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<i.length;h++)e=i[h],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(e,i,h){var _=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Te||Qe==null||Qe!==Xa(_)||(_=Qe,"selectionStart"in _&&Ne(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Se&&Ie(Se,_)||(Se=_,_=oe(Re,"onSelect"),0<_.length&&(i=new td("onSelect","select",null,i,h),e.push({event:i,listeners:_}),i.target=Qe)))}function Ve(e,i){var h={};return h[e.toLowerCase()]=i.toLowerCase(),h["Webkit"+e]="webkit"+i,h["Moz"+e]="moz"+i,h}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(e){if(Xe[e])return Xe[e];if(!We[e])return e;var i=We[e],h;for(h in i)if(i.hasOwnProperty(h)&&h in Ye)return Xe[e]=i[h];return e}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(e,i){df.set(e,i),fa(i,[e])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(e,i,h){var _=e.type||"unknown-event";e.currentTarget=h,Ub(_,i,void 0,e),e.currentTarget=null}function se(e,i){i=(i&4)!==0;for(var h=0;h<e.length;h++){var _=e[h],j=_.event;_=_.listeners;t:{var _t=void 0;if(i)for(var Wt=_.length-1;0<=Wt;Wt--){var _n=_[Wt],_i=_n.instance,_s=_n.currentTarget;if(_n=_n.listener,_i!==_t&&j.isPropagationStopped())break t;nf(j,_n,_s),_t=_i}else for(Wt=0;Wt<_.length;Wt++){if(_n=_[Wt],_i=_n.instance,_s=_n.currentTarget,_n=_n.listener,_i!==_t&&j.isPropagationStopped())break t;nf(j,_n,_s),_t=_i}}}if(Qb)throw e=Rb,Qb=!1,Rb=null,e}function D(e,i){var h=i[of];h===void 0&&(h=i[of]=new Set);var _=e+"__bubble";h.has(_)||(pf(i,e,2,!1),h.add(_))}function qf(e,i,h){var _=0;i&&(_|=4),pf(h,e,_,i)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(e){if(!e[rf]){e[rf]=!0,da.forEach(function(h){h!=="selectionchange"&&(mf.has(h)||qf(h,!1,e),qf(h,!0,e))});var i=e.nodeType===9?e:e.ownerDocument;i===null||i[rf]||(i[rf]=!0,qf("selectionchange",!1,i))}}function pf(e,i,h,_){switch(jd(i)){case 1:var j=ed;break;case 4:j=gd;break;default:j=fd}h=j.bind(null,i,h,e),j=void 0,!Lb||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(j=!0),_?j!==void 0?e.addEventListener(i,h,{capture:!0,passive:j}):e.addEventListener(i,h,!0):j!==void 0?e.addEventListener(i,h,{passive:j}):e.addEventListener(i,h,!1)}function hd(e,i,h,_,j){var _t=_;if(!(i&1)&&!(i&2)&&_!==null)t:for(;;){if(_===null)return;var Wt=_.tag;if(Wt===3||Wt===4){var _n=_.stateNode.containerInfo;if(_n===j||_n.nodeType===8&&_n.parentNode===j)break;if(Wt===4)for(Wt=_.return;Wt!==null;){var _i=Wt.tag;if((_i===3||_i===4)&&(_i=Wt.stateNode.containerInfo,_i===j||_i.nodeType===8&&_i.parentNode===j))return;Wt=Wt.return}for(;_n!==null;){if(Wt=Wc(_n),Wt===null)return;if(_i=Wt.tag,_i===5||_i===6){_=_t=Wt;continue t}_n=_n.parentNode}}_=_.return}Jb(function(){var _s=_t,_u=xb(h),_h=[];t:{var _d=df.get(e);if(_d!==void 0){var nE=td,aE=e;switch(e){case"keypress":if(od(h)===0)break t;case"keydown":case"keyup":nE=Rd;break;case"focusin":aE="focus",nE=Fd;break;case"focusout":aE="blur",nE=Fd;break;case"beforeblur":case"afterblur":nE=Fd;break;case"click":if(h.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":nE=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":nE=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":nE=Vd;break;case $e:case af:case bf:nE=Hd;break;case cf:nE=Xd;break;case"scroll":nE=vd;break;case"wheel":nE=Zd;break;case"copy":case"cut":case"paste":nE=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":nE=Td}var uE=(i&4)!==0,hE=!uE&&e==="scroll",oE=uE?_d!==null?_d+"Capture":null:_d;uE=[];for(var sE=_s,dE;sE!==null;){dE=sE;var vE=dE.stateNode;if(dE.tag===5&&vE!==null&&(dE=vE,oE!==null&&(vE=Kb(sE,oE),vE!=null&&uE.push(tf(sE,vE,dE)))),hE)break;sE=sE.return}0<uE.length&&(_d=new nE(_d,aE,null,h,_u),_h.push({event:_d,listeners:uE}))}}if(!(i&7)){t:{if(_d=e==="mouseover"||e==="pointerover",nE=e==="mouseout"||e==="pointerout",_d&&h!==wb&&(aE=h.relatedTarget||h.fromElement)&&(Wc(aE)||aE[uf]))break t;if((nE||_d)&&(_d=_u.window===_u?_u:(_d=_u.ownerDocument)?_d.defaultView||_d.parentWindow:window,nE?(aE=h.relatedTarget||h.toElement,nE=_s,aE=aE?Wc(aE):null,aE!==null&&(hE=Vb(aE),aE!==hE||aE.tag!==5&&aE.tag!==6)&&(aE=null)):(nE=null,aE=_s),nE!==aE)){if(uE=Bd,vE="onMouseLeave",oE="onMouseEnter",sE="mouse",(e==="pointerout"||e==="pointerover")&&(uE=Td,vE="onPointerLeave",oE="onPointerEnter",sE="pointer"),hE=nE==null?_d:ue(nE),dE=aE==null?_d:ue(aE),_d=new uE(vE,sE+"leave",nE,h,_u),_d.target=hE,_d.relatedTarget=dE,vE=null,Wc(_u)===_s&&(uE=new uE(oE,sE+"enter",aE,h,_u),uE.target=dE,uE.relatedTarget=hE,vE=uE),hE=vE,nE&&aE)e:{for(uE=nE,oE=aE,sE=0,dE=uE;dE;dE=vf(dE))sE++;for(dE=0,vE=oE;vE;vE=vf(vE))dE++;for(;0<sE-dE;)uE=vf(uE),sE--;for(;0<dE-sE;)oE=vf(oE),dE--;for(;sE--;){if(uE===oE||oE!==null&&uE===oE.alternate)break e;uE=vf(uE),oE=vf(oE)}uE=null}else uE=null;nE!==null&&wf(_h,_d,nE,uE,!1),aE!==null&&hE!==null&&wf(_h,hE,aE,uE,!0)}}t:{if(_d=_s?ue(_s):window,nE=_d.nodeName&&_d.nodeName.toLowerCase(),nE==="select"||nE==="input"&&_d.type==="file")var AE=ve;else if(me(_d))if(we)AE=Fe;else{AE=De;var PE=Ce}else(nE=_d.nodeName)&&nE.toLowerCase()==="input"&&(_d.type==="checkbox"||_d.type==="radio")&&(AE=Ee);if(AE&&(AE=AE(e,_s))){ne(_h,AE,h,_u);break t}PE&&PE(e,_d,_s),e==="focusout"&&(PE=_d._wrapperState)&&PE.controlled&&_d.type==="number"&&cb(_d,"number",_d.value)}switch(PE=_s?ue(_s):window,e){case"focusin":(me(PE)||PE.contentEditable==="true")&&(Qe=PE,Re=_s,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(_h,h,_u);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(_h,h,_u)}var IE;if(ae)t:{switch(e){case"compositionstart":var QE="onCompositionStart";break t;case"compositionend":QE="onCompositionEnd";break t;case"compositionupdate":QE="onCompositionUpdate";break t}QE=void 0}else ie?ge(e,h)&&(QE="onCompositionEnd"):e==="keydown"&&h.keyCode===229&&(QE="onCompositionStart");QE&&(de&&h.locale!=="ko"&&(ie||QE!=="onCompositionStart"?QE==="onCompositionEnd"&&ie&&(IE=nd()):(kd=_u,ld="value"in kd?kd.value:kd.textContent,ie=!0)),PE=oe(_s,QE),0<PE.length&&(QE=new Ld(QE,e,null,h,_u),_h.push({event:QE,listeners:PE}),IE?QE.data=IE:(IE=he(h),IE!==null&&(QE.data=IE)))),(IE=ce?je(e,h):ke(e,h))&&(_s=oe(_s,"onBeforeInput"),0<_s.length&&(_u=new Ld("onBeforeInput","beforeinput",null,h,_u),_h.push({event:_u,listeners:_s}),_u.data=IE))}se(_h,i)})}function tf(e,i,h){return{instance:e,listener:i,currentTarget:h}}function oe(e,i){for(var h=i+"Capture",_=[];e!==null;){var j=e,_t=j.stateNode;j.tag===5&&_t!==null&&(j=_t,_t=Kb(e,h),_t!=null&&_.unshift(tf(e,_t,j)),_t=Kb(e,i),_t!=null&&_.push(tf(e,_t,j))),e=e.return}return _}function vf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wf(e,i,h,_,j){for(var _t=i._reactName,Wt=[];h!==null&&h!==_;){var _n=h,_i=_n.alternate,_s=_n.stateNode;if(_i!==null&&_i===_)break;_n.tag===5&&_s!==null&&(_n=_s,j?(_i=Kb(h,_t),_i!=null&&Wt.unshift(tf(h,_i,_n))):j||(_i=Kb(h,_t),_i!=null&&Wt.push(tf(h,_i,_n)))),h=h.return}Wt.length!==0&&e.push({event:i,listeners:Wt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(e){return(typeof e=="string"?e:""+e).replace(xf,`
`).replace(yf,"")}function Af(e,i,h){if(i=zf(i),zf(e)!==i&&h)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(e,i){return e==="textarea"||e==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(e){return Hf.resolve(null).then(e).catch(If)}:Ff;function If(e){setTimeout(function(){throw e})}function Kf(e,i){var h=i,_=0;do{var j=h.nextSibling;if(e.removeChild(h),j&&j.nodeType===8)if(h=j.data,h==="/$"){if(_===0){e.removeChild(j),bd(i);return}_--}else h!=="$"&&h!=="$?"&&h!=="$!"||_++;h=j}while(h);bd(i)}function Lf(e){for(;e!=null;e=e.nextSibling){var i=e.nodeType;if(i===1||i===3)break;if(i===8){if(i=e.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return e}function Mf(e){e=e.previousSibling;for(var i=0;e;){if(e.nodeType===8){var h=e.data;if(h==="$"||h==="$!"||h==="$?"){if(i===0)return e;i--}else h==="/$"&&i++}e=e.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(e){var i=e[Of];if(i)return i;for(var h=e.parentNode;h;){if(i=h[uf]||h[Of]){if(h=i.alternate,i.child!==null||h!==null&&h.child!==null)for(e=Mf(e);e!==null;){if(h=e[Of])return h;e=Mf(e)}return i}e=h,h=e.parentNode}return null}function Cb(e){return e=e[Of]||e[uf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ue(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(p(33))}function Db(e){return e[Pf]||null}var Sf=[],Tf=-1;function Uf(e){return{current:e}}function E(e){0>Tf||(e.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(e,i){Tf++,Sf[Tf]=e.current,e.current=i}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(e,i){var h=e.type.contextTypes;if(!h)return Vf;var _=e.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===i)return _.__reactInternalMemoizedMaskedChildContext;var j={},_t;for(_t in h)j[_t]=i[_t];return _&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=j),j}function Zf(e){return e=e.childContextTypes,e!=null}function $f(){E(Wf),E(H)}function ag(e,i,h){if(H.current!==Vf)throw Error(p(168));G(H,i),G(Wf,h)}function bg(e,i,h){var _=e.stateNode;if(i=i.childContextTypes,typeof _.getChildContext!="function")return h;_=_.getChildContext();for(var j in _)if(!(j in i))throw Error(p(108,Ra(e)||"Unknown",j));return A({},h,_)}function cg(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,e),G(Wf,Wf.current),!0}function dg(e,i,h){var _=e.stateNode;if(!_)throw Error(p(169));h?(e=bg(e,i,Xf),_.__reactInternalMemoizedMergedChildContext=e,E(Wf),E(H),G(H,e)):E(Wf),G(Wf,h)}var eg=null,fg=!1,gg=!1;function hg(e){eg===null?eg=[e]:eg.push(e)}function ig(e){fg=!0,hg(e)}function jg(){if(!gg&&eg!==null){gg=!0;var e=0,i=C;try{var h=eg;for(C=1;e<h.length;e++){var _=h[e];do _=_(!0);while(_!==null)}eg=null,fg=!1}catch(j){throw eg!==null&&(eg=eg.slice(e+1)),ac(fc,jg),j}finally{C=i,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(e,i){kg[lg++]=ng,kg[lg++]=mg,mg=e,ng=i}function ug(e,i,h){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=e;var _=rg;e=sg;var j=32-oc(_)-1;_&=~(1<<j),h+=1;var _t=32-oc(i)+j;if(30<_t){var Wt=j-j%5;_t=(_&(1<<Wt)-1).toString(32),_>>=Wt,j-=Wt,rg=1<<32-oc(i)+j|h<<j|_,sg=_t+e}else rg=1<<_t|h<<j|_,sg=e}function vg(e){e.return!==null&&(tg(e,1),ug(e,1,0))}function wg(e){for(;e===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;e===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(e,i){var h=Bg(5,null,null,0);h.elementType="DELETED",h.stateNode=i,h.return=e,i=e.deletions,i===null?(e.deletions=[h],e.flags|=16):i.push(h)}function Cg(e,i){switch(e.tag){case 5:var h=e.type;return i=i.nodeType!==1||h.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(e.stateNode=i,xg=e,yg=Lf(i.firstChild),!0):!1;case 6:return i=e.pendingProps===""||i.nodeType!==3?null:i,i!==null?(e.stateNode=i,xg=e,yg=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(h=qg!==null?{id:rg,overflow:sg}:null,e.memoizedState={dehydrated:i,treeContext:h,retryLane:1073741824},h=Bg(18,null,null,0),h.stateNode=i,h.return=e,e.child=h,xg=e,yg=null,!0):!1;default:return!1}}function Dg(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Eg(e){if(I){var i=yg;if(i){var h=i;if(!Cg(e,i)){if(Dg(e))throw Error(p(418));i=Lf(h.nextSibling);var _=xg;i&&Cg(e,i)?Ag(_,h):(e.flags=e.flags&-4097|2,I=!1,xg=e)}}else{if(Dg(e))throw Error(p(418));e.flags=e.flags&-4097|2,I=!1,xg=e}}}function Fg(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xg=e}function Gg(e){if(e!==xg)return!1;if(!I)return Fg(e),I=!0,!1;var i;if((i=e.tag!==3)&&!(i=e.tag!==5)&&(i=e.type,i=i!=="head"&&i!=="body"&&!Ef(e.type,e.memoizedProps)),i&&(i=yg)){if(Dg(e))throw Hg(),Error(p(418));for(;i;)Ag(e,i),i=Lf(i.nextSibling)}if(Fg(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(p(317));t:{for(e=e.nextSibling,i=0;e;){if(e.nodeType===8){var h=e.data;if(h==="/$"){if(i===0){yg=Lf(e.nextSibling);break t}i--}else h!=="$"&&h!=="$!"&&h!=="$?"||i++}e=e.nextSibling}yg=null}}else yg=xg?Lf(e.stateNode.nextSibling):null;return!0}function Hg(){for(var e=yg;e;)e=Lf(e.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(e){zg===null?zg=[e]:zg.push(e)}var Kg=ua.ReactCurrentBatchConfig;function Lg(e,i,h){if(e=h.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(p(309));var _=h.stateNode}if(!_)throw Error(p(147,e));var j=_,_t=""+e;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===_t?i.ref:(i=function(Wt){var _n=j.refs;Wt===null?delete _n[_t]:_n[_t]=Wt},i._stringRef=_t,i)}if(typeof e!="string")throw Error(p(284));if(!h._owner)throw Error(p(290,e))}return e}function Mg(e,i){throw e=Object.prototype.toString.call(i),Error(p(31,e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e))}function Ng(e){var i=e._init;return i(e._payload)}function Og(e){function i(oE,sE){if(e){var dE=oE.deletions;dE===null?(oE.deletions=[sE],oE.flags|=16):dE.push(sE)}}function h(oE,sE){if(!e)return null;for(;sE!==null;)i(oE,sE),sE=sE.sibling;return null}function _(oE,sE){for(oE=new Map;sE!==null;)sE.key!==null?oE.set(sE.key,sE):oE.set(sE.index,sE),sE=sE.sibling;return oE}function j(oE,sE){return oE=Pg(oE,sE),oE.index=0,oE.sibling=null,oE}function _t(oE,sE,dE){return oE.index=dE,e?(dE=oE.alternate,dE!==null?(dE=dE.index,dE<sE?(oE.flags|=2,sE):dE):(oE.flags|=2,sE)):(oE.flags|=1048576,sE)}function Wt(oE){return e&&oE.alternate===null&&(oE.flags|=2),oE}function _n(oE,sE,dE,vE){return sE===null||sE.tag!==6?(sE=Qg(dE,oE.mode,vE),sE.return=oE,sE):(sE=j(sE,dE),sE.return=oE,sE)}function _i(oE,sE,dE,vE){var AE=dE.type;return AE===ya?_u(oE,sE,dE.props.children,vE,dE.key):sE!==null&&(sE.elementType===AE||typeof AE=="object"&&AE!==null&&AE.$$typeof===Ha&&Ng(AE)===sE.type)?(vE=j(sE,dE.props),vE.ref=Lg(oE,sE,dE),vE.return=oE,vE):(vE=Rg(dE.type,dE.key,dE.props,null,oE.mode,vE),vE.ref=Lg(oE,sE,dE),vE.return=oE,vE)}function _s(oE,sE,dE,vE){return sE===null||sE.tag!==4||sE.stateNode.containerInfo!==dE.containerInfo||sE.stateNode.implementation!==dE.implementation?(sE=Sg(dE,oE.mode,vE),sE.return=oE,sE):(sE=j(sE,dE.children||[]),sE.return=oE,sE)}function _u(oE,sE,dE,vE,AE){return sE===null||sE.tag!==7?(sE=Tg(dE,oE.mode,vE,AE),sE.return=oE,sE):(sE=j(sE,dE),sE.return=oE,sE)}function _h(oE,sE,dE){if(typeof sE=="string"&&sE!==""||typeof sE=="number")return sE=Qg(""+sE,oE.mode,dE),sE.return=oE,sE;if(typeof sE=="object"&&sE!==null){switch(sE.$$typeof){case va:return dE=Rg(sE.type,sE.key,sE.props,null,oE.mode,dE),dE.ref=Lg(oE,null,sE),dE.return=oE,dE;case wa:return sE=Sg(sE,oE.mode,dE),sE.return=oE,sE;case Ha:var vE=sE._init;return _h(oE,vE(sE._payload),dE)}if(eb(sE)||Ka(sE))return sE=Tg(sE,oE.mode,dE,null),sE.return=oE,sE;Mg(oE,sE)}return null}function _d(oE,sE,dE,vE){var AE=sE!==null?sE.key:null;if(typeof dE=="string"&&dE!==""||typeof dE=="number")return AE!==null?null:_n(oE,sE,""+dE,vE);if(typeof dE=="object"&&dE!==null){switch(dE.$$typeof){case va:return dE.key===AE?_i(oE,sE,dE,vE):null;case wa:return dE.key===AE?_s(oE,sE,dE,vE):null;case Ha:return AE=dE._init,_d(oE,sE,AE(dE._payload),vE)}if(eb(dE)||Ka(dE))return AE!==null?null:_u(oE,sE,dE,vE,null);Mg(oE,dE)}return null}function nE(oE,sE,dE,vE,AE){if(typeof vE=="string"&&vE!==""||typeof vE=="number")return oE=oE.get(dE)||null,_n(sE,oE,""+vE,AE);if(typeof vE=="object"&&vE!==null){switch(vE.$$typeof){case va:return oE=oE.get(vE.key===null?dE:vE.key)||null,_i(sE,oE,vE,AE);case wa:return oE=oE.get(vE.key===null?dE:vE.key)||null,_s(sE,oE,vE,AE);case Ha:var PE=vE._init;return nE(oE,sE,dE,PE(vE._payload),AE)}if(eb(vE)||Ka(vE))return oE=oE.get(dE)||null,_u(sE,oE,vE,AE,null);Mg(sE,vE)}return null}function aE(oE,sE,dE,vE){for(var AE=null,PE=null,IE=sE,QE=sE=0,m_=null;IE!==null&&QE<dE.length;QE++){IE.index>QE?(m_=IE,IE=null):m_=IE.sibling;var yE=_d(oE,IE,dE[QE],vE);if(yE===null){IE===null&&(IE=m_);break}e&&IE&&yE.alternate===null&&i(oE,IE),sE=_t(yE,sE,QE),PE===null?AE=yE:PE.sibling=yE,PE=yE,IE=m_}if(QE===dE.length)return h(oE,IE),I&&tg(oE,QE),AE;if(IE===null){for(;QE<dE.length;QE++)IE=_h(oE,dE[QE],vE),IE!==null&&(sE=_t(IE,sE,QE),PE===null?AE=IE:PE.sibling=IE,PE=IE);return I&&tg(oE,QE),AE}for(IE=_(oE,IE);QE<dE.length;QE++)m_=nE(IE,oE,QE,dE[QE],vE),m_!==null&&(e&&m_.alternate!==null&&IE.delete(m_.key===null?QE:m_.key),sE=_t(m_,sE,QE),PE===null?AE=m_:PE.sibling=m_,PE=m_);return e&&IE.forEach(function(FE){return i(oE,FE)}),I&&tg(oE,QE),AE}function uE(oE,sE,dE,vE){var AE=Ka(dE);if(typeof AE!="function")throw Error(p(150));if(dE=AE.call(dE),dE==null)throw Error(p(151));for(var PE=AE=null,IE=sE,QE=sE=0,m_=null,yE=dE.next();IE!==null&&!yE.done;QE++,yE=dE.next()){IE.index>QE?(m_=IE,IE=null):m_=IE.sibling;var FE=_d(oE,IE,yE.value,vE);if(FE===null){IE===null&&(IE=m_);break}e&&IE&&FE.alternate===null&&i(oE,IE),sE=_t(FE,sE,QE),PE===null?AE=FE:PE.sibling=FE,PE=FE,IE=m_}if(yE.done)return h(oE,IE),I&&tg(oE,QE),AE;if(IE===null){for(;!yE.done;QE++,yE=dE.next())yE=_h(oE,yE.value,vE),yE!==null&&(sE=_t(yE,sE,QE),PE===null?AE=yE:PE.sibling=yE,PE=yE);return I&&tg(oE,QE),AE}for(IE=_(oE,IE);!yE.done;QE++,yE=dE.next())yE=nE(IE,oE,QE,yE.value,vE),yE!==null&&(e&&yE.alternate!==null&&IE.delete(yE.key===null?QE:yE.key),sE=_t(yE,sE,QE),PE===null?AE=yE:PE.sibling=yE,PE=yE);return e&&IE.forEach(function(UE){return i(oE,UE)}),I&&tg(oE,QE),AE}function hE(oE,sE,dE,vE){if(typeof dE=="object"&&dE!==null&&dE.type===ya&&dE.key===null&&(dE=dE.props.children),typeof dE=="object"&&dE!==null){switch(dE.$$typeof){case va:t:{for(var AE=dE.key,PE=sE;PE!==null;){if(PE.key===AE){if(AE=dE.type,AE===ya){if(PE.tag===7){h(oE,PE.sibling),sE=j(PE,dE.props.children),sE.return=oE,oE=sE;break t}}else if(PE.elementType===AE||typeof AE=="object"&&AE!==null&&AE.$$typeof===Ha&&Ng(AE)===PE.type){h(oE,PE.sibling),sE=j(PE,dE.props),sE.ref=Lg(oE,PE,dE),sE.return=oE,oE=sE;break t}h(oE,PE);break}else i(oE,PE);PE=PE.sibling}dE.type===ya?(sE=Tg(dE.props.children,oE.mode,vE,dE.key),sE.return=oE,oE=sE):(vE=Rg(dE.type,dE.key,dE.props,null,oE.mode,vE),vE.ref=Lg(oE,sE,dE),vE.return=oE,oE=vE)}return Wt(oE);case wa:t:{for(PE=dE.key;sE!==null;){if(sE.key===PE)if(sE.tag===4&&sE.stateNode.containerInfo===dE.containerInfo&&sE.stateNode.implementation===dE.implementation){h(oE,sE.sibling),sE=j(sE,dE.children||[]),sE.return=oE,oE=sE;break t}else{h(oE,sE);break}else i(oE,sE);sE=sE.sibling}sE=Sg(dE,oE.mode,vE),sE.return=oE,oE=sE}return Wt(oE);case Ha:return PE=dE._init,hE(oE,sE,PE(dE._payload),vE)}if(eb(dE))return aE(oE,sE,dE,vE);if(Ka(dE))return uE(oE,sE,dE,vE);Mg(oE,dE)}return typeof dE=="string"&&dE!==""||typeof dE=="number"?(dE=""+dE,sE!==null&&sE.tag===6?(h(oE,sE.sibling),sE=j(sE,dE),sE.return=oE,oE=sE):(h(oE,sE),sE=Qg(dE,oE.mode,vE),sE.return=oE,oE=sE),Wt(oE)):h(oE,sE)}return hE}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(e){var i=Wg.current;E(Wg),e._currentValue=i}function bh(e,i,h){for(;e!==null;){var _=e.alternate;if((e.childLanes&i)!==i?(e.childLanes|=i,_!==null&&(_.childLanes|=i)):_!==null&&(_.childLanes&i)!==i&&(_.childLanes|=i),e===h)break;e=e.return}}function ch(e,i){Xg=e,Zg=Yg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&i&&(dh=!0),e.firstContext=null)}function eh(e){var i=e._currentValue;if(Zg!==e)if(e={context:e,memoizedValue:i,next:null},Yg===null){if(Xg===null)throw Error(p(308));Yg=e,Xg.dependencies={lanes:0,firstContext:e}}else Yg=Yg.next=e;return i}var fh=null;function gh(e){fh===null?fh=[e]:fh.push(e)}function hh(e,i,h,_){var j=i.interleaved;return j===null?(h.next=h,gh(i)):(h.next=j.next,j.next=h),i.interleaved=h,ih(e,_)}function ih(e,i){e.lanes|=i;var h=e.alternate;for(h!==null&&(h.lanes|=i),h=e,e=e.return;e!==null;)e.childLanes|=i,h=e.alternate,h!==null&&(h.childLanes|=i),h=e,e=e.return;return h.tag===3?h.stateNode:null}var jh=!1;function kh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(e,i){e=e.updateQueue,i.updateQueue===e&&(i.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mh(e,i){return{eventTime:e,lane:i,tag:0,payload:null,callback:null,next:null}}function nh(e,i,h){var _=e.updateQueue;if(_===null)return null;if(_=_.shared,K&2){var j=_.pending;return j===null?i.next=i:(i.next=j.next,j.next=i),_.pending=i,ih(e,h)}return j=_.interleaved,j===null?(i.next=i,gh(_)):(i.next=j.next,j.next=i),_.interleaved=i,ih(e,h)}function oh(e,i,h){if(i=i.updateQueue,i!==null&&(i=i.shared,(h&4194240)!==0)){var _=i.lanes;_&=e.pendingLanes,h|=_,i.lanes=h,Cc(e,h)}}function ph(e,i){var h=e.updateQueue,_=e.alternate;if(_!==null&&(_=_.updateQueue,h===_)){var j=null,_t=null;if(h=h.firstBaseUpdate,h!==null){do{var Wt={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};_t===null?j=_t=Wt:_t=_t.next=Wt,h=h.next}while(h!==null);_t===null?j=_t=i:_t=_t.next=i}else j=_t=i;h={baseState:_.baseState,firstBaseUpdate:j,lastBaseUpdate:_t,shared:_.shared,effects:_.effects},e.updateQueue=h;return}e=h.lastBaseUpdate,e===null?h.firstBaseUpdate=i:e.next=i,h.lastBaseUpdate=i}function qh(e,i,h,_){var j=e.updateQueue;jh=!1;var _t=j.firstBaseUpdate,Wt=j.lastBaseUpdate,_n=j.shared.pending;if(_n!==null){j.shared.pending=null;var _i=_n,_s=_i.next;_i.next=null,Wt===null?_t=_s:Wt.next=_s,Wt=_i;var _u=e.alternate;_u!==null&&(_u=_u.updateQueue,_n=_u.lastBaseUpdate,_n!==Wt&&(_n===null?_u.firstBaseUpdate=_s:_n.next=_s,_u.lastBaseUpdate=_i))}if(_t!==null){var _h=j.baseState;Wt=0,_u=_s=_i=null,_n=_t;do{var _d=_n.lane,nE=_n.eventTime;if((_&_d)===_d){_u!==null&&(_u=_u.next={eventTime:nE,lane:0,tag:_n.tag,payload:_n.payload,callback:_n.callback,next:null});t:{var aE=e,uE=_n;switch(_d=i,nE=h,uE.tag){case 1:if(aE=uE.payload,typeof aE=="function"){_h=aE.call(nE,_h,_d);break t}_h=aE;break t;case 3:aE.flags=aE.flags&-65537|128;case 0:if(aE=uE.payload,_d=typeof aE=="function"?aE.call(nE,_h,_d):aE,_d==null)break t;_h=A({},_h,_d);break t;case 2:jh=!0}}_n.callback!==null&&_n.lane!==0&&(e.flags|=64,_d=j.effects,_d===null?j.effects=[_n]:_d.push(_n))}else nE={eventTime:nE,lane:_d,tag:_n.tag,payload:_n.payload,callback:_n.callback,next:null},_u===null?(_s=_u=nE,_i=_h):_u=_u.next=nE,Wt|=_d;if(_n=_n.next,_n===null){if(_n=j.shared.pending,_n===null)break;_d=_n,_n=_d.next,_d.next=null,j.lastBaseUpdate=_d,j.shared.pending=null}}while(!0);if(_u===null&&(_i=_h),j.baseState=_i,j.firstBaseUpdate=_s,j.lastBaseUpdate=_u,i=j.shared.interleaved,i!==null){j=i;do Wt|=j.lane,j=j.next;while(j!==i)}else _t===null&&(j.shared.lanes=0);rh|=Wt,e.lanes=Wt,e.memoizedState=_h}}function sh(e,i,h){if(e=i.effects,i.effects=null,e!==null)for(i=0;i<e.length;i++){var _=e[i],j=_.callback;if(j!==null){if(_.callback=null,_=h,typeof j!="function")throw Error(p(191,j));j.call(_)}}}var th={},uh=Uf(th),vh=Uf(th),wh=Uf(th);function xh(e){if(e===th)throw Error(p(174));return e}function yh(e,i){switch(G(wh,i),G(vh,e),G(uh,th),e=i.nodeType,e){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:lb(null,"");break;default:e=e===8?i.parentNode:i,i=e.namespaceURI||null,e=e.tagName,i=lb(i,e)}E(uh),G(uh,i)}function zh(){E(uh),E(vh),E(wh)}function Ah(e){xh(wh.current);var i=xh(uh.current),h=lb(i,e.type);i!==h&&(G(vh,e),G(uh,h))}function Bh(e){vh.current===e&&(E(uh),E(vh))}var L=Uf(0);function Ch(e){for(var i=e;i!==null;){if(i.tag===13){var h=i.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Dh=[];function Eh(){for(var e=0;e<Dh.length;e++)Dh[e]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p(321))}function Mh(e,i){if(i===null)return!1;for(var h=0;h<i.length&&h<e.length;h++)if(!He(e[h],i[h]))return!1;return!0}function Nh(e,i,h,_,j,_t){if(Hh=_t,M=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Fh.current=e===null||e.memoizedState===null?Oh:Ph,e=h(_,j),Jh){_t=0;do{if(Jh=!1,Kh=0,25<=_t)throw Error(p(301));_t+=1,O=N=null,i.updateQueue=null,Fh.current=Qh,e=h(_,j)}while(Jh)}if(Fh.current=Rh,i=N!==null&&N.next!==null,Hh=0,O=N=M=null,Ih=!1,i)throw Error(p(300));return e}function Sh(){var e=Kh!==0;return Kh=0,e}function Th(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M.memoizedState=O=e:O=O.next=e,O}function Uh(){if(N===null){var e=M.alternate;e=e!==null?e.memoizedState:null}else e=N.next;var i=O===null?M.memoizedState:O.next;if(i!==null)O=i,N=e;else{if(e===null)throw Error(p(310));N=e,e={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M.memoizedState=O=e:O=O.next=e}return O}function Vh(e,i){return typeof i=="function"?i(e):i}function Wh(e){var i=Uh(),h=i.queue;if(h===null)throw Error(p(311));h.lastRenderedReducer=e;var _=N,j=_.baseQueue,_t=h.pending;if(_t!==null){if(j!==null){var Wt=j.next;j.next=_t.next,_t.next=Wt}_.baseQueue=j=_t,h.pending=null}if(j!==null){_t=j.next,_=_.baseState;var _n=Wt=null,_i=null,_s=_t;do{var _u=_s.lane;if((Hh&_u)===_u)_i!==null&&(_i=_i.next={lane:0,action:_s.action,hasEagerState:_s.hasEagerState,eagerState:_s.eagerState,next:null}),_=_s.hasEagerState?_s.eagerState:e(_,_s.action);else{var _h={lane:_u,action:_s.action,hasEagerState:_s.hasEagerState,eagerState:_s.eagerState,next:null};_i===null?(_n=_i=_h,Wt=_):_i=_i.next=_h,M.lanes|=_u,rh|=_u}_s=_s.next}while(_s!==null&&_s!==_t);_i===null?Wt=_:_i.next=_n,He(_,i.memoizedState)||(dh=!0),i.memoizedState=_,i.baseState=Wt,i.baseQueue=_i,h.lastRenderedState=_}if(e=h.interleaved,e!==null){j=e;do _t=j.lane,M.lanes|=_t,rh|=_t,j=j.next;while(j!==e)}else j===null&&(h.lanes=0);return[i.memoizedState,h.dispatch]}function Xh(e){var i=Uh(),h=i.queue;if(h===null)throw Error(p(311));h.lastRenderedReducer=e;var _=h.dispatch,j=h.pending,_t=i.memoizedState;if(j!==null){h.pending=null;var Wt=j=j.next;do _t=e(_t,Wt.action),Wt=Wt.next;while(Wt!==j);He(_t,i.memoizedState)||(dh=!0),i.memoizedState=_t,i.baseQueue===null&&(i.baseState=_t),h.lastRenderedState=_t}return[_t,_]}function Yh(){}function Zh(e,i){var h=M,_=Uh(),j=i(),_t=!He(_.memoizedState,j);if(_t&&(_.memoizedState=j,dh=!0),_=_.queue,$h(ai.bind(null,h,_,e),[e]),_.getSnapshot!==i||_t||O!==null&&O.memoizedState.tag&1){if(h.flags|=2048,bi(9,ci.bind(null,h,_,j,i),void 0,null),Q===null)throw Error(p(349));Hh&30||di(h,i,j)}return j}function di(e,i,h){e.flags|=16384,e={getSnapshot:i,value:h},i=M.updateQueue,i===null?(i={lastEffect:null,stores:null},M.updateQueue=i,i.stores=[e]):(h=i.stores,h===null?i.stores=[e]:h.push(e))}function ci(e,i,h,_){i.value=h,i.getSnapshot=_,ei(i)&&fi(e)}function ai(e,i,h){return h(function(){ei(i)&&fi(e)})}function ei(e){var i=e.getSnapshot;e=e.value;try{var h=i();return!He(e,h)}catch{return!0}}function fi(e){var i=ih(e,1);i!==null&&gi(i,e,1,-1)}function hi(e){var i=Th();return typeof e=="function"&&(e=e()),i.memoizedState=i.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:e},i.queue=e,e=e.dispatch=ii.bind(null,M,e),[i.memoizedState,e]}function bi(e,i,h,_){return e={tag:e,create:i,destroy:h,deps:_,next:null},i=M.updateQueue,i===null?(i={lastEffect:null,stores:null},M.updateQueue=i,i.lastEffect=e.next=e):(h=i.lastEffect,h===null?i.lastEffect=e.next=e:(_=h.next,h.next=e,e.next=_,i.lastEffect=e)),e}function ji(){return Uh().memoizedState}function ki(e,i,h,_){var j=Th();M.flags|=e,j.memoizedState=bi(1|i,h,void 0,_===void 0?null:_)}function li(e,i,h,_){var j=Uh();_=_===void 0?null:_;var _t=void 0;if(N!==null){var Wt=N.memoizedState;if(_t=Wt.destroy,_!==null&&Mh(_,Wt.deps)){j.memoizedState=bi(i,h,_t,_);return}}M.flags|=e,j.memoizedState=bi(1|i,h,_t,_)}function mi(e,i){return ki(8390656,8,e,i)}function $h(e,i){return li(2048,8,e,i)}function ni(e,i){return li(4,2,e,i)}function oi(e,i){return li(4,4,e,i)}function pi(e,i){if(typeof i=="function")return e=e(),i(e),function(){i(null)};if(i!=null)return e=e(),i.current=e,function(){i.current=null}}function qi(e,i,h){return h=h!=null?h.concat([e]):null,li(4,4,pi.bind(null,i,e),h)}function ri(){}function si(e,i){var h=Uh();i=i===void 0?null:i;var _=h.memoizedState;return _!==null&&i!==null&&Mh(i,_[1])?_[0]:(h.memoizedState=[e,i],e)}function ti(e,i){var h=Uh();i=i===void 0?null:i;var _=h.memoizedState;return _!==null&&i!==null&&Mh(i,_[1])?_[0]:(e=e(),h.memoizedState=[e,i],e)}function ui(e,i,h){return Hh&21?(He(h,i)||(h=yc(),M.lanes|=h,rh|=h,e.baseState=!0),i):(e.baseState&&(e.baseState=!1,dh=!0),e.memoizedState=h)}function vi(e,i){var h=C;C=h!==0&&4>h?h:4,e(!0);var _=Gh.transition;Gh.transition={};try{e(!1),i()}finally{C=h,Gh.transition=_}}function wi(){return Uh().memoizedState}function xi(e,i,h){var _=yi(e);if(h={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null},zi(e))Ai(i,h);else if(h=hh(e,i,h,_),h!==null){var j=R();gi(h,e,_,j),Bi(h,i,_)}}function ii(e,i,h){var _=yi(e),j={lane:_,action:h,hasEagerState:!1,eagerState:null,next:null};if(zi(e))Ai(i,j);else{var _t=e.alternate;if(e.lanes===0&&(_t===null||_t.lanes===0)&&(_t=i.lastRenderedReducer,_t!==null))try{var Wt=i.lastRenderedState,_n=_t(Wt,h);if(j.hasEagerState=!0,j.eagerState=_n,He(_n,Wt)){var _i=i.interleaved;_i===null?(j.next=j,gh(i)):(j.next=_i.next,_i.next=j),i.interleaved=j;return}}catch{}finally{}h=hh(e,i,j,_),h!==null&&(j=R(),gi(h,e,_,j),Bi(h,i,_))}}function zi(e){var i=e.alternate;return e===M||i!==null&&i===M}function Ai(e,i){Jh=Ih=!0;var h=e.pending;h===null?i.next=i:(i.next=h.next,h.next=i),e.pending=i}function Bi(e,i,h){if(h&4194240){var _=i.lanes;_&=e.pendingLanes,h|=_,i.lanes=h,Cc(e,h)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(e,i){return Th().memoizedState=[e,i===void 0?null:i],e},useContext:eh,useEffect:mi,useImperativeHandle:function(e,i,h){return h=h!=null?h.concat([e]):null,ki(4194308,4,pi.bind(null,i,e),h)},useLayoutEffect:function(e,i){return ki(4194308,4,e,i)},useInsertionEffect:function(e,i){return ki(4,2,e,i)},useMemo:function(e,i){var h=Th();return i=i===void 0?null:i,e=e(),h.memoizedState=[e,i],e},useReducer:function(e,i,h){var _=Th();return i=h!==void 0?h(i):i,_.memoizedState=_.baseState=i,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},_.queue=e,e=e.dispatch=xi.bind(null,M,e),[_.memoizedState,e]},useRef:function(e){var i=Th();return e={current:e},i.memoizedState=e},useState:hi,useDebugValue:ri,useDeferredValue:function(e){return Th().memoizedState=e},useTransition:function(){var e=hi(!1),i=e[0];return e=vi.bind(null,e[1]),Th().memoizedState=e,[i,e]},useMutableSource:function(){},useSyncExternalStore:function(e,i,h){var _=M,j=Th();if(I){if(h===void 0)throw Error(p(407));h=h()}else{if(h=i(),Q===null)throw Error(p(349));Hh&30||di(_,i,h)}j.memoizedState=h;var _t={value:h,getSnapshot:i};return j.queue=_t,mi(ai.bind(null,_,_t,e),[e]),_.flags|=2048,bi(9,ci.bind(null,_,_t,h,i),void 0,null),h},useId:function(){var e=Th(),i=Q.identifierPrefix;if(I){var h=sg,_=rg;h=(_&~(1<<32-oc(_)-1)).toString(32)+h,i=":"+i+"R"+h,h=Kh++,0<h&&(i+="H"+h.toString(32)),i+=":"}else h=Lh++,i=":"+i+"r"+h.toString(32)+":";return e.memoizedState=i},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return ui(i,N.memoizedState,e)},useTransition:function(){var e=Wh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return N===null?i.memoizedState=e:ui(i,N.memoizedState,e)},useTransition:function(){var e=Xh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(e,i){if(e&&e.defaultProps){i=A({},i),e=e.defaultProps;for(var h in e)i[h]===void 0&&(i[h]=e[h]);return i}return i}function Di(e,i,h,_){i=e.memoizedState,h=h(_,i),h=h==null?i:A({},i,h),e.memoizedState=h,e.lanes===0&&(e.updateQueue.baseState=h)}var Ei={isMounted:function(e){return(e=e._reactInternals)?Vb(e)===e:!1},enqueueSetState:function(e,i,h){e=e._reactInternals;var _=R(),j=yi(e),_t=mh(_,j);_t.payload=i,h!=null&&(_t.callback=h),i=nh(e,_t,j),i!==null&&(gi(i,e,j,_),oh(i,e,j))},enqueueReplaceState:function(e,i,h){e=e._reactInternals;var _=R(),j=yi(e),_t=mh(_,j);_t.tag=1,_t.payload=i,h!=null&&(_t.callback=h),i=nh(e,_t,j),i!==null&&(gi(i,e,j,_),oh(i,e,j))},enqueueForceUpdate:function(e,i){e=e._reactInternals;var h=R(),_=yi(e),j=mh(h,_);j.tag=2,i!=null&&(j.callback=i),i=nh(e,j,_),i!==null&&(gi(i,e,_,h),oh(i,e,_))}};function Fi(e,i,h,_,j,_t,Wt){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(_,_t,Wt):i.prototype&&i.prototype.isPureReactComponent?!Ie(h,_)||!Ie(j,_t):!0}function Gi(e,i,h){var _=!1,j=Vf,_t=i.contextType;return typeof _t=="object"&&_t!==null?_t=eh(_t):(j=Zf(i)?Xf:H.current,_=i.contextTypes,_t=(_=_!=null)?Yf(e,j):Vf),i=new i(h,_t),e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Ei,e.stateNode=i,i._reactInternals=e,_&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=j,e.__reactInternalMemoizedMaskedChildContext=_t),i}function Hi(e,i,h,_){e=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(h,_),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(h,_),i.state!==e&&Ei.enqueueReplaceState(i,i.state,null)}function Ii(e,i,h,_){var j=e.stateNode;j.props=h,j.state=e.memoizedState,j.refs={},kh(e);var _t=i.contextType;typeof _t=="object"&&_t!==null?j.context=eh(_t):(_t=Zf(i)?Xf:H.current,j.context=Yf(e,_t)),j.state=e.memoizedState,_t=i.getDerivedStateFromProps,typeof _t=="function"&&(Di(e,i,_t,h),j.state=e.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(i=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),i!==j.state&&Ei.enqueueReplaceState(j,j.state,null),qh(e,h,j,_),j.state=e.memoizedState),typeof j.componentDidMount=="function"&&(e.flags|=4194308)}function Ji(e,i){try{var h="",_=i;do h+=Pa(_),_=_.return;while(_);var j=h}catch(_t){j=`
Error generating stack: `+_t.message+`
`+_t.stack}return{value:e,source:i,stack:j,digest:null}}function Ki(e,i,h){return{value:e,source:null,stack:h??null,digest:i??null}}function Li(e,i){try{console.error(i.value)}catch(h){setTimeout(function(){throw h})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(e,i,h){h=mh(-1,h),h.tag=3,h.payload={element:null};var _=i.value;return h.callback=function(){Oi||(Oi=!0,Pi=_),Li(e,i)},h}function Qi(e,i,h){h=mh(-1,h),h.tag=3;var _=e.type.getDerivedStateFromError;if(typeof _=="function"){var j=i.value;h.payload=function(){return _(j)},h.callback=function(){Li(e,i)}}var _t=e.stateNode;return _t!==null&&typeof _t.componentDidCatch=="function"&&(h.callback=function(){Li(e,i),typeof _!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var Wt=i.stack;this.componentDidCatch(i.value,{componentStack:Wt!==null?Wt:""})}),h}function Si(e,i,h){var _=e.pingCache;if(_===null){_=e.pingCache=new Mi;var j=new Set;_.set(i,j)}else j=_.get(i),j===void 0&&(j=new Set,_.set(i,j));j.has(h)||(j.add(h),e=Ti.bind(null,e,i,h),i.then(e,e))}function Ui(e){do{var i;if((i=e.tag===13)&&(i=e.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return e;e=e.return}while(e!==null);return null}function Vi(e,i,h,_,j){return e.mode&1?(e.flags|=65536,e.lanes=j,e):(e===i?e.flags|=65536:(e.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(i=mh(-1,1),i.tag=2,nh(h,i,1))),h.lanes|=1),e)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(e,i,h,_){i.child=e===null?Vg(i,null,h,_):Ug(i,e.child,h,_)}function Yi(e,i,h,_,j){h=h.render;var _t=i.ref;return ch(i,j),_=Nh(e,i,h,_,_t,j),h=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~j,Zi(e,i,j)):(I&&h&&vg(i),i.flags|=1,Xi(e,i,_,j),i.child)}function $i(e,i,h,_,j){if(e===null){var _t=h.type;return typeof _t=="function"&&!aj(_t)&&_t.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(i.tag=15,i.type=_t,bj(e,i,_t,_,j)):(e=Rg(h.type,null,_,i,i.mode,j),e.ref=i.ref,e.return=i,i.child=e)}if(_t=e.child,!(e.lanes&j)){var Wt=_t.memoizedProps;if(h=h.compare,h=h!==null?h:Ie,h(Wt,_)&&e.ref===i.ref)return Zi(e,i,j)}return i.flags|=1,e=Pg(_t,_),e.ref=i.ref,e.return=i,i.child=e}function bj(e,i,h,_,j){if(e!==null){var _t=e.memoizedProps;if(Ie(_t,_)&&e.ref===i.ref)if(dh=!1,i.pendingProps=_=_t,(e.lanes&j)!==0)e.flags&131072&&(dh=!0);else return i.lanes=e.lanes,Zi(e,i,j)}return cj(e,i,h,_,j)}function dj(e,i,h){var _=i.pendingProps,j=_.children,_t=e!==null?e.memoizedState:null;if(_.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=h;else{if(!(h&1073741824))return e=_t!==null?_t.baseLanes|h:h,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:e,cachePool:null,transitions:null},i.updateQueue=null,G(ej,fj),fj|=e,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},_=_t!==null?_t.baseLanes:h,G(ej,fj),fj|=_}else _t!==null?(_=_t.baseLanes|h,i.memoizedState=null):_=h,G(ej,fj),fj|=_;return Xi(e,i,j,h),i.child}function gj(e,i){var h=i.ref;(e===null&&h!==null||e!==null&&e.ref!==h)&&(i.flags|=512,i.flags|=2097152)}function cj(e,i,h,_,j){var _t=Zf(h)?Xf:H.current;return _t=Yf(i,_t),ch(i,j),h=Nh(e,i,h,_,_t,j),_=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~j,Zi(e,i,j)):(I&&_&&vg(i),i.flags|=1,Xi(e,i,h,j),i.child)}function hj(e,i,h,_,j){if(Zf(h)){var _t=!0;cg(i)}else _t=!1;if(ch(i,j),i.stateNode===null)ij(e,i),Gi(i,h,_),Ii(i,h,_,j),_=!0;else if(e===null){var Wt=i.stateNode,_n=i.memoizedProps;Wt.props=_n;var _i=Wt.context,_s=h.contextType;typeof _s=="object"&&_s!==null?_s=eh(_s):(_s=Zf(h)?Xf:H.current,_s=Yf(i,_s));var _u=h.getDerivedStateFromProps,_h=typeof _u=="function"||typeof Wt.getSnapshotBeforeUpdate=="function";_h||typeof Wt.UNSAFE_componentWillReceiveProps!="function"&&typeof Wt.componentWillReceiveProps!="function"||(_n!==_||_i!==_s)&&Hi(i,Wt,_,_s),jh=!1;var _d=i.memoizedState;Wt.state=_d,qh(i,_,Wt,j),_i=i.memoizedState,_n!==_||_d!==_i||Wf.current||jh?(typeof _u=="function"&&(Di(i,h,_u,_),_i=i.memoizedState),(_n=jh||Fi(i,h,_n,_,_d,_i,_s))?(_h||typeof Wt.UNSAFE_componentWillMount!="function"&&typeof Wt.componentWillMount!="function"||(typeof Wt.componentWillMount=="function"&&Wt.componentWillMount(),typeof Wt.UNSAFE_componentWillMount=="function"&&Wt.UNSAFE_componentWillMount()),typeof Wt.componentDidMount=="function"&&(i.flags|=4194308)):(typeof Wt.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=_,i.memoizedState=_i),Wt.props=_,Wt.state=_i,Wt.context=_s,_=_n):(typeof Wt.componentDidMount=="function"&&(i.flags|=4194308),_=!1)}else{Wt=i.stateNode,lh(e,i),_n=i.memoizedProps,_s=i.type===i.elementType?_n:Ci(i.type,_n),Wt.props=_s,_h=i.pendingProps,_d=Wt.context,_i=h.contextType,typeof _i=="object"&&_i!==null?_i=eh(_i):(_i=Zf(h)?Xf:H.current,_i=Yf(i,_i));var nE=h.getDerivedStateFromProps;(_u=typeof nE=="function"||typeof Wt.getSnapshotBeforeUpdate=="function")||typeof Wt.UNSAFE_componentWillReceiveProps!="function"&&typeof Wt.componentWillReceiveProps!="function"||(_n!==_h||_d!==_i)&&Hi(i,Wt,_,_i),jh=!1,_d=i.memoizedState,Wt.state=_d,qh(i,_,Wt,j);var aE=i.memoizedState;_n!==_h||_d!==aE||Wf.current||jh?(typeof nE=="function"&&(Di(i,h,nE,_),aE=i.memoizedState),(_s=jh||Fi(i,h,_s,_,_d,aE,_i)||!1)?(_u||typeof Wt.UNSAFE_componentWillUpdate!="function"&&typeof Wt.componentWillUpdate!="function"||(typeof Wt.componentWillUpdate=="function"&&Wt.componentWillUpdate(_,aE,_i),typeof Wt.UNSAFE_componentWillUpdate=="function"&&Wt.UNSAFE_componentWillUpdate(_,aE,_i)),typeof Wt.componentDidUpdate=="function"&&(i.flags|=4),typeof Wt.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof Wt.componentDidUpdate!="function"||_n===e.memoizedProps&&_d===e.memoizedState||(i.flags|=4),typeof Wt.getSnapshotBeforeUpdate!="function"||_n===e.memoizedProps&&_d===e.memoizedState||(i.flags|=1024),i.memoizedProps=_,i.memoizedState=aE),Wt.props=_,Wt.state=aE,Wt.context=_i,_=_s):(typeof Wt.componentDidUpdate!="function"||_n===e.memoizedProps&&_d===e.memoizedState||(i.flags|=4),typeof Wt.getSnapshotBeforeUpdate!="function"||_n===e.memoizedProps&&_d===e.memoizedState||(i.flags|=1024),_=!1)}return jj(e,i,h,_,_t,j)}function jj(e,i,h,_,j,_t){gj(e,i);var Wt=(i.flags&128)!==0;if(!_&&!Wt)return j&&dg(i,h,!1),Zi(e,i,_t);_=i.stateNode,Wi.current=i;var _n=Wt&&typeof h.getDerivedStateFromError!="function"?null:_.render();return i.flags|=1,e!==null&&Wt?(i.child=Ug(i,e.child,null,_t),i.child=Ug(i,null,_n,_t)):Xi(e,i,_n,_t),i.memoizedState=_.state,j&&dg(i,h,!0),i.child}function kj(e){var i=e.stateNode;i.pendingContext?ag(e,i.pendingContext,i.pendingContext!==i.context):i.context&&ag(e,i.context,!1),yh(e,i.containerInfo)}function lj(e,i,h,_,j){return Ig(),Jg(j),i.flags|=256,Xi(e,i,h,_),i.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(e){return{baseLanes:e,cachePool:null,transitions:null}}function oj(e,i,h){var _=i.pendingProps,j=L.current,_t=!1,Wt=(i.flags&128)!==0,_n;if((_n=Wt)||(_n=e!==null&&e.memoizedState===null?!1:(j&2)!==0),_n?(_t=!0,i.flags&=-129):(e===null||e.memoizedState!==null)&&(j|=1),G(L,j&1),e===null)return Eg(i),e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(i.mode&1?e.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(Wt=_.children,e=_.fallback,_t?(_=i.mode,_t=i.child,Wt={mode:"hidden",children:Wt},!(_&1)&&_t!==null?(_t.childLanes=0,_t.pendingProps=Wt):_t=pj(Wt,_,0,null),e=Tg(e,_,h,null),_t.return=i,e.return=i,_t.sibling=e,i.child=_t,i.child.memoizedState=nj(h),i.memoizedState=mj,e):qj(i,Wt));if(j=e.memoizedState,j!==null&&(_n=j.dehydrated,_n!==null))return rj(e,i,Wt,_,_n,j,h);if(_t){_t=_.fallback,Wt=i.mode,j=e.child,_n=j.sibling;var _i={mode:"hidden",children:_.children};return!(Wt&1)&&i.child!==j?(_=i.child,_.childLanes=0,_.pendingProps=_i,i.deletions=null):(_=Pg(j,_i),_.subtreeFlags=j.subtreeFlags&14680064),_n!==null?_t=Pg(_n,_t):(_t=Tg(_t,Wt,h,null),_t.flags|=2),_t.return=i,_.return=i,_.sibling=_t,i.child=_,_=_t,_t=i.child,Wt=e.child.memoizedState,Wt=Wt===null?nj(h):{baseLanes:Wt.baseLanes|h,cachePool:null,transitions:Wt.transitions},_t.memoizedState=Wt,_t.childLanes=e.childLanes&~h,i.memoizedState=mj,_}return _t=e.child,e=_t.sibling,_=Pg(_t,{mode:"visible",children:_.children}),!(i.mode&1)&&(_.lanes=h),_.return=i,_.sibling=null,e!==null&&(h=i.deletions,h===null?(i.deletions=[e],i.flags|=16):h.push(e)),i.child=_,i.memoizedState=null,_}function qj(e,i){return i=pj({mode:"visible",children:i},e.mode,0,null),i.return=e,e.child=i}function sj(e,i,h,_){return _!==null&&Jg(_),Ug(i,e.child,null,h),e=qj(i,i.pendingProps.children),e.flags|=2,i.memoizedState=null,e}function rj(e,i,h,_,j,_t,Wt){if(h)return i.flags&256?(i.flags&=-257,_=Ki(Error(p(422))),sj(e,i,Wt,_)):i.memoizedState!==null?(i.child=e.child,i.flags|=128,null):(_t=_.fallback,j=i.mode,_=pj({mode:"visible",children:_.children},j,0,null),_t=Tg(_t,j,Wt,null),_t.flags|=2,_.return=i,_t.return=i,_.sibling=_t,i.child=_,i.mode&1&&Ug(i,e.child,null,Wt),i.child.memoizedState=nj(Wt),i.memoizedState=mj,_t);if(!(i.mode&1))return sj(e,i,Wt,null);if(j.data==="$!"){if(_=j.nextSibling&&j.nextSibling.dataset,_)var _n=_.dgst;return _=_n,_t=Error(p(419)),_=Ki(_t,_,void 0),sj(e,i,Wt,_)}if(_n=(Wt&e.childLanes)!==0,dh||_n){if(_=Q,_!==null){switch(Wt&-Wt){case 4:j=2;break;case 16:j=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:j=32;break;case 536870912:j=268435456;break;default:j=0}j=j&(_.suspendedLanes|Wt)?0:j,j!==0&&j!==_t.retryLane&&(_t.retryLane=j,ih(e,j),gi(_,e,j,-1))}return tj(),_=Ki(Error(p(421))),sj(e,i,Wt,_)}return j.data==="$?"?(i.flags|=128,i.child=e.child,i=uj.bind(null,e),j._reactRetry=i,null):(e=_t.treeContext,yg=Lf(j.nextSibling),xg=i,I=!0,zg=null,e!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=e.id,sg=e.overflow,qg=i),i=qj(i,_.children),i.flags|=4096,i)}function vj(e,i,h){e.lanes|=i;var _=e.alternate;_!==null&&(_.lanes|=i),bh(e.return,i,h)}function wj(e,i,h,_,j){var _t=e.memoizedState;_t===null?e.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:_,tail:h,tailMode:j}:(_t.isBackwards=i,_t.rendering=null,_t.renderingStartTime=0,_t.last=_,_t.tail=h,_t.tailMode=j)}function xj(e,i,h){var _=i.pendingProps,j=_.revealOrder,_t=_.tail;if(Xi(e,i,_.children,h),_=L.current,_&2)_=_&1|2,i.flags|=128;else{if(e!==null&&e.flags&128)t:for(e=i.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&vj(e,h,i);else if(e.tag===19)vj(e,h,i);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break t;for(;e.sibling===null;){if(e.return===null||e.return===i)break t;e=e.return}e.sibling.return=e.return,e=e.sibling}_&=1}if(G(L,_),!(i.mode&1))i.memoizedState=null;else switch(j){case"forwards":for(h=i.child,j=null;h!==null;)e=h.alternate,e!==null&&Ch(e)===null&&(j=h),h=h.sibling;h=j,h===null?(j=i.child,i.child=null):(j=h.sibling,h.sibling=null),wj(i,!1,j,h,_t);break;case"backwards":for(h=null,j=i.child,i.child=null;j!==null;){if(e=j.alternate,e!==null&&Ch(e)===null){i.child=j;break}e=j.sibling,j.sibling=h,h=j,j=e}wj(i,!0,h,null,_t);break;case"together":wj(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function ij(e,i){!(i.mode&1)&&e!==null&&(e.alternate=null,i.alternate=null,i.flags|=2)}function Zi(e,i,h){if(e!==null&&(i.dependencies=e.dependencies),rh|=i.lanes,!(h&i.childLanes))return null;if(e!==null&&i.child!==e.child)throw Error(p(153));if(i.child!==null){for(e=i.child,h=Pg(e,e.pendingProps),i.child=h,h.return=i;e.sibling!==null;)e=e.sibling,h=h.sibling=Pg(e,e.pendingProps),h.return=i;h.sibling=null}return i.child}function yj(e,i,h){switch(i.tag){case 3:kj(i),Ig();break;case 5:Ah(i);break;case 1:Zf(i.type)&&cg(i);break;case 4:yh(i,i.stateNode.containerInfo);break;case 10:var _=i.type._context,j=i.memoizedProps.value;G(Wg,_._currentValue),_._currentValue=j;break;case 13:if(_=i.memoizedState,_!==null)return _.dehydrated!==null?(G(L,L.current&1),i.flags|=128,null):h&i.child.childLanes?oj(e,i,h):(G(L,L.current&1),e=Zi(e,i,h),e!==null?e.sibling:null);G(L,L.current&1);break;case 19:if(_=(h&i.childLanes)!==0,e.flags&128){if(_)return xj(e,i,h);i.flags|=128}if(j=i.memoizedState,j!==null&&(j.rendering=null,j.tail=null,j.lastEffect=null),G(L,L.current),_)break;return null;case 22:case 23:return i.lanes=0,dj(e,i,h)}return Zi(e,i,h)}var zj,Aj,Bj,Cj;zj=function(e,i){for(var h=i.child;h!==null;){if(h.tag===5||h.tag===6)e.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===i)break;for(;h.sibling===null;){if(h.return===null||h.return===i)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};Aj=function(){};Bj=function(e,i,h,_){var j=e.memoizedProps;if(j!==_){e=i.stateNode,xh(uh.current);var _t=null;switch(h){case"input":j=Ya(e,j),_=Ya(e,_),_t=[];break;case"select":j=A({},j,{value:void 0}),_=A({},_,{value:void 0}),_t=[];break;case"textarea":j=gb(e,j),_=gb(e,_),_t=[];break;default:typeof j.onClick!="function"&&typeof _.onClick=="function"&&(e.onclick=Bf)}ub(h,_);var Wt;h=null;for(_s in j)if(!_.hasOwnProperty(_s)&&j.hasOwnProperty(_s)&&j[_s]!=null)if(_s==="style"){var _n=j[_s];for(Wt in _n)_n.hasOwnProperty(Wt)&&(h||(h={}),h[Wt]="")}else _s!=="dangerouslySetInnerHTML"&&_s!=="children"&&_s!=="suppressContentEditableWarning"&&_s!=="suppressHydrationWarning"&&_s!=="autoFocus"&&(ea.hasOwnProperty(_s)?_t||(_t=[]):(_t=_t||[]).push(_s,null));for(_s in _){var _i=_[_s];if(_n=j!=null?j[_s]:void 0,_.hasOwnProperty(_s)&&_i!==_n&&(_i!=null||_n!=null))if(_s==="style")if(_n){for(Wt in _n)!_n.hasOwnProperty(Wt)||_i&&_i.hasOwnProperty(Wt)||(h||(h={}),h[Wt]="");for(Wt in _i)_i.hasOwnProperty(Wt)&&_n[Wt]!==_i[Wt]&&(h||(h={}),h[Wt]=_i[Wt])}else h||(_t||(_t=[]),_t.push(_s,h)),h=_i;else _s==="dangerouslySetInnerHTML"?(_i=_i?_i.__html:void 0,_n=_n?_n.__html:void 0,_i!=null&&_n!==_i&&(_t=_t||[]).push(_s,_i)):_s==="children"?typeof _i!="string"&&typeof _i!="number"||(_t=_t||[]).push(_s,""+_i):_s!=="suppressContentEditableWarning"&&_s!=="suppressHydrationWarning"&&(ea.hasOwnProperty(_s)?(_i!=null&&_s==="onScroll"&&D("scroll",e),_t||_n===_i||(_t=[])):(_t=_t||[]).push(_s,_i))}h&&(_t=_t||[]).push("style",h);var _s=_t;(i.updateQueue=_s)&&(i.flags|=4)}};Cj=function(e,i,h,_){h!==_&&(i.flags|=4)};function Dj(e,i){if(!I)switch(e.tailMode){case"hidden":i=e.tail;for(var h=null;i!==null;)i.alternate!==null&&(h=i),i=i.sibling;h===null?e.tail=null:h.sibling=null;break;case"collapsed":h=e.tail;for(var _=null;h!==null;)h.alternate!==null&&(_=h),h=h.sibling;_===null?i||e.tail===null?e.tail=null:e.tail.sibling=null:_.sibling=null}}function S(e){var i=e.alternate!==null&&e.alternate.child===e.child,h=0,_=0;if(i)for(var j=e.child;j!==null;)h|=j.lanes|j.childLanes,_|=j.subtreeFlags&14680064,_|=j.flags&14680064,j.return=e,j=j.sibling;else for(j=e.child;j!==null;)h|=j.lanes|j.childLanes,_|=j.subtreeFlags,_|=j.flags,j.return=e,j=j.sibling;return e.subtreeFlags|=_,e.childLanes=h,i}function Ej(e,i,h){var _=i.pendingProps;switch(wg(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(i),null;case 1:return Zf(i.type)&&$f(),S(i),null;case 3:return _=i.stateNode,zh(),E(Wf),E(H),Eh(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(e===null||e.child===null)&&(Gg(i)?i.flags|=4:e===null||e.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(e,i),S(i),null;case 5:Bh(i);var j=xh(wh.current);if(h=i.type,e!==null&&i.stateNode!=null)Bj(e,i,h,_,j),e.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!_){if(i.stateNode===null)throw Error(p(166));return S(i),null}if(e=xh(uh.current),Gg(i)){_=i.stateNode,h=i.type;var _t=i.memoizedProps;switch(_[Of]=i,_[Pf]=_t,e=(i.mode&1)!==0,h){case"dialog":D("cancel",_),D("close",_);break;case"iframe":case"object":case"embed":D("load",_);break;case"video":case"audio":for(j=0;j<lf.length;j++)D(lf[j],_);break;case"source":D("error",_);break;case"img":case"image":case"link":D("error",_),D("load",_);break;case"details":D("toggle",_);break;case"input":Za(_,_t),D("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!_t.multiple},D("invalid",_);break;case"textarea":hb(_,_t),D("invalid",_)}ub(h,_t),j=null;for(var Wt in _t)if(_t.hasOwnProperty(Wt)){var _n=_t[Wt];Wt==="children"?typeof _n=="string"?_.textContent!==_n&&(_t.suppressHydrationWarning!==!0&&Af(_.textContent,_n,e),j=["children",_n]):typeof _n=="number"&&_.textContent!==""+_n&&(_t.suppressHydrationWarning!==!0&&Af(_.textContent,_n,e),j=["children",""+_n]):ea.hasOwnProperty(Wt)&&_n!=null&&Wt==="onScroll"&&D("scroll",_)}switch(h){case"input":Va(_),db(_,_t,!0);break;case"textarea":Va(_),jb(_);break;case"select":case"option":break;default:typeof _t.onClick=="function"&&(_.onclick=Bf)}_=j,i.updateQueue=_,_!==null&&(i.flags|=4)}else{Wt=j.nodeType===9?j:j.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=kb(h)),e==="http://www.w3.org/1999/xhtml"?h==="script"?(e=Wt.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof _.is=="string"?e=Wt.createElement(h,{is:_.is}):(e=Wt.createElement(h),h==="select"&&(Wt=e,_.multiple?Wt.multiple=!0:_.size&&(Wt.size=_.size))):e=Wt.createElementNS(e,h),e[Of]=i,e[Pf]=_,zj(e,i,!1,!1),i.stateNode=e;t:{switch(Wt=vb(h,_),h){case"dialog":D("cancel",e),D("close",e),j=_;break;case"iframe":case"object":case"embed":D("load",e),j=_;break;case"video":case"audio":for(j=0;j<lf.length;j++)D(lf[j],e);j=_;break;case"source":D("error",e),j=_;break;case"img":case"image":case"link":D("error",e),D("load",e),j=_;break;case"details":D("toggle",e),j=_;break;case"input":Za(e,_),j=Ya(e,_),D("invalid",e);break;case"option":j=_;break;case"select":e._wrapperState={wasMultiple:!!_.multiple},j=A({},_,{value:void 0}),D("invalid",e);break;case"textarea":hb(e,_),j=gb(e,_),D("invalid",e);break;default:j=_}ub(h,j),_n=j;for(_t in _n)if(_n.hasOwnProperty(_t)){var _i=_n[_t];_t==="style"?sb(e,_i):_t==="dangerouslySetInnerHTML"?(_i=_i?_i.__html:void 0,_i!=null&&nb(e,_i)):_t==="children"?typeof _i=="string"?(h!=="textarea"||_i!=="")&&ob(e,_i):typeof _i=="number"&&ob(e,""+_i):_t!=="suppressContentEditableWarning"&&_t!=="suppressHydrationWarning"&&_t!=="autoFocus"&&(ea.hasOwnProperty(_t)?_i!=null&&_t==="onScroll"&&D("scroll",e):_i!=null&&ta(e,_t,_i,Wt))}switch(h){case"input":Va(e),db(e,_,!1);break;case"textarea":Va(e),jb(e);break;case"option":_.value!=null&&e.setAttribute("value",""+Sa(_.value));break;case"select":e.multiple=!!_.multiple,_t=_.value,_t!=null?fb(e,!!_.multiple,_t,!1):_.defaultValue!=null&&fb(e,!!_.multiple,_.defaultValue,!0);break;default:typeof j.onClick=="function"&&(e.onclick=Bf)}switch(h){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break t;case"img":_=!0;break t;default:_=!1}}_&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return S(i),null;case 6:if(e&&i.stateNode!=null)Cj(e,i,e.memoizedProps,_);else{if(typeof _!="string"&&i.stateNode===null)throw Error(p(166));if(h=xh(wh.current),xh(uh.current),Gg(i)){if(_=i.stateNode,h=i.memoizedProps,_[Of]=i,(_t=_.nodeValue!==h)&&(e=xg,e!==null))switch(e.tag){case 3:Af(_.nodeValue,h,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Af(_.nodeValue,h,(e.mode&1)!==0)}_t&&(i.flags|=4)}else _=(h.nodeType===9?h:h.ownerDocument).createTextNode(_),_[Of]=i,i.stateNode=_}return S(i),null;case 13:if(E(L),_=i.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(I&&yg!==null&&i.mode&1&&!(i.flags&128))Hg(),Ig(),i.flags|=98560,_t=!1;else if(_t=Gg(i),_!==null&&_.dehydrated!==null){if(e===null){if(!_t)throw Error(p(318));if(_t=i.memoizedState,_t=_t!==null?_t.dehydrated:null,!_t)throw Error(p(317));_t[Of]=i}else Ig(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;S(i),_t=!1}else zg!==null&&(Fj(zg),zg=null),_t=!0;if(!_t)return i.flags&65536?i:null}return i.flags&128?(i.lanes=h,i):(_=_!==null,_!==(e!==null&&e.memoizedState!==null)&&_&&(i.child.flags|=8192,i.mode&1&&(e===null||L.current&1?T===0&&(T=3):tj())),i.updateQueue!==null&&(i.flags|=4),S(i),null);case 4:return zh(),Aj(e,i),e===null&&sf(i.stateNode.containerInfo),S(i),null;case 10:return ah(i.type._context),S(i),null;case 17:return Zf(i.type)&&$f(),S(i),null;case 19:if(E(L),_t=i.memoizedState,_t===null)return S(i),null;if(_=(i.flags&128)!==0,Wt=_t.rendering,Wt===null)if(_)Dj(_t,!1);else{if(T!==0||e!==null&&e.flags&128)for(e=i.child;e!==null;){if(Wt=Ch(e),Wt!==null){for(i.flags|=128,Dj(_t,!1),_=Wt.updateQueue,_!==null&&(i.updateQueue=_,i.flags|=4),i.subtreeFlags=0,_=h,h=i.child;h!==null;)_t=h,e=_,_t.flags&=14680066,Wt=_t.alternate,Wt===null?(_t.childLanes=0,_t.lanes=e,_t.child=null,_t.subtreeFlags=0,_t.memoizedProps=null,_t.memoizedState=null,_t.updateQueue=null,_t.dependencies=null,_t.stateNode=null):(_t.childLanes=Wt.childLanes,_t.lanes=Wt.lanes,_t.child=Wt.child,_t.subtreeFlags=0,_t.deletions=null,_t.memoizedProps=Wt.memoizedProps,_t.memoizedState=Wt.memoizedState,_t.updateQueue=Wt.updateQueue,_t.type=Wt.type,e=Wt.dependencies,_t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),h=h.sibling;return G(L,L.current&1|2),i.child}e=e.sibling}_t.tail!==null&&B()>Gj&&(i.flags|=128,_=!0,Dj(_t,!1),i.lanes=4194304)}else{if(!_)if(e=Ch(Wt),e!==null){if(i.flags|=128,_=!0,h=e.updateQueue,h!==null&&(i.updateQueue=h,i.flags|=4),Dj(_t,!0),_t.tail===null&&_t.tailMode==="hidden"&&!Wt.alternate&&!I)return S(i),null}else 2*B()-_t.renderingStartTime>Gj&&h!==1073741824&&(i.flags|=128,_=!0,Dj(_t,!1),i.lanes=4194304);_t.isBackwards?(Wt.sibling=i.child,i.child=Wt):(h=_t.last,h!==null?h.sibling=Wt:i.child=Wt,_t.last=Wt)}return _t.tail!==null?(i=_t.tail,_t.rendering=i,_t.tail=i.sibling,_t.renderingStartTime=B(),i.sibling=null,h=L.current,G(L,_?h&1|2:h&1),i):(S(i),null);case 22:case 23:return Hj(),_=i.memoizedState!==null,e!==null&&e.memoizedState!==null!==_&&(i.flags|=8192),_&&i.mode&1?fj&1073741824&&(S(i),i.subtreeFlags&6&&(i.flags|=8192)):S(i),null;case 24:return null;case 25:return null}throw Error(p(156,i.tag))}function Ij(e,i){switch(wg(i),i.tag){case 1:return Zf(i.type)&&$f(),e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 3:return zh(),E(Wf),E(H),Eh(),e=i.flags,e&65536&&!(e&128)?(i.flags=e&-65537|128,i):null;case 5:return Bh(i),null;case 13:if(E(L),e=i.memoizedState,e!==null&&e.dehydrated!==null){if(i.alternate===null)throw Error(p(340));Ig()}return e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah(i.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(e,i){var h=e.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(_){W(e,i,_)}else h.current=null}function Mj(e,i,h){try{h()}catch(_){W(e,i,_)}}var Nj=!1;function Oj(e,i){if(Cf=dd,e=Me(),Ne(e)){if("selectionStart"in e)var h={start:e.selectionStart,end:e.selectionEnd};else t:{h=(h=e.ownerDocument)&&h.defaultView||window;var _=h.getSelection&&h.getSelection();if(_&&_.rangeCount!==0){h=_.anchorNode;var j=_.anchorOffset,_t=_.focusNode;_=_.focusOffset;try{h.nodeType,_t.nodeType}catch{h=null;break t}var Wt=0,_n=-1,_i=-1,_s=0,_u=0,_h=e,_d=null;e:for(;;){for(var nE;_h!==h||j!==0&&_h.nodeType!==3||(_n=Wt+j),_h!==_t||_!==0&&_h.nodeType!==3||(_i=Wt+_),_h.nodeType===3&&(Wt+=_h.nodeValue.length),(nE=_h.firstChild)!==null;)_d=_h,_h=nE;for(;;){if(_h===e)break e;if(_d===h&&++_s===j&&(_n=Wt),_d===_t&&++_u===_&&(_i=Wt),(nE=_h.nextSibling)!==null)break;_h=_d,_d=_h.parentNode}_h=nE}h=_n===-1||_i===-1?null:{start:_n,end:_i}}else h=null}h=h||{start:0,end:0}}else h=null;for(Df={focusedElem:e,selectionRange:h},dd=!1,V=i;V!==null;)if(i=V,e=i.child,(i.subtreeFlags&1028)!==0&&e!==null)e.return=i,V=e;else for(;V!==null;){i=V;try{var aE=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(aE!==null){var uE=aE.memoizedProps,hE=aE.memoizedState,oE=i.stateNode,sE=oE.getSnapshotBeforeUpdate(i.elementType===i.type?uE:Ci(i.type,uE),hE);oE.__reactInternalSnapshotBeforeUpdate=sE}break;case 3:var dE=i.stateNode.containerInfo;dE.nodeType===1?dE.textContent="":dE.nodeType===9&&dE.documentElement&&dE.removeChild(dE.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(vE){W(i,i.return,vE)}if(e=i.sibling,e!==null){e.return=i.return,V=e;break}V=i.return}return aE=Nj,Nj=!1,aE}function Pj(e,i,h){var _=i.updateQueue;if(_=_!==null?_.lastEffect:null,_!==null){var j=_=_.next;do{if((j.tag&e)===e){var _t=j.destroy;j.destroy=void 0,_t!==void 0&&Mj(i,h,_t)}j=j.next}while(j!==_)}}function Qj(e,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var h=i=i.next;do{if((h.tag&e)===e){var _=h.create;h.destroy=_()}h=h.next}while(h!==i)}}function Rj(e){var i=e.ref;if(i!==null){var h=e.stateNode;switch(e.tag){case 5:e=h;break;default:e=h}typeof i=="function"?i(e):i.current=e}}function Sj(e){var i=e.alternate;i!==null&&(e.alternate=null,Sj(i)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(i=e.stateNode,i!==null&&(delete i[Of],delete i[Pf],delete i[of],delete i[Qf],delete i[Rf])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Tj(e){return e.tag===5||e.tag===3||e.tag===4}function Uj(e){t:for(;;){for(;e.sibling===null;){if(e.return===null||Tj(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue t;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Vj(e,i,h){var _=e.tag;if(_===5||_===6)e=e.stateNode,i?h.nodeType===8?h.parentNode.insertBefore(e,i):h.insertBefore(e,i):(h.nodeType===8?(i=h.parentNode,i.insertBefore(e,h)):(i=h,i.appendChild(e)),h=h._reactRootContainer,h!=null||i.onclick!==null||(i.onclick=Bf));else if(_!==4&&(e=e.child,e!==null))for(Vj(e,i,h),e=e.sibling;e!==null;)Vj(e,i,h),e=e.sibling}function Wj(e,i,h){var _=e.tag;if(_===5||_===6)e=e.stateNode,i?h.insertBefore(e,i):h.appendChild(e);else if(_!==4&&(e=e.child,e!==null))for(Wj(e,i,h),e=e.sibling;e!==null;)Wj(e,i,h),e=e.sibling}var X=null,Xj=!1;function Yj(e,i,h){for(h=h.child;h!==null;)Zj(e,i,h),h=h.sibling}function Zj(e,i,h){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,h)}catch{}switch(h.tag){case 5:U||Lj(h,i);case 6:var _=X,j=Xj;X=null,Yj(e,i,h),X=_,Xj=j,X!==null&&(Xj?(e=X,h=h.stateNode,e.nodeType===8?e.parentNode.removeChild(h):e.removeChild(h)):X.removeChild(h.stateNode));break;case 18:X!==null&&(Xj?(e=X,h=h.stateNode,e.nodeType===8?Kf(e.parentNode,h):e.nodeType===1&&Kf(e,h),bd(e)):Kf(X,h.stateNode));break;case 4:_=X,j=Xj,X=h.stateNode.containerInfo,Xj=!0,Yj(e,i,h),X=_,Xj=j;break;case 0:case 11:case 14:case 15:if(!U&&(_=h.updateQueue,_!==null&&(_=_.lastEffect,_!==null))){j=_=_.next;do{var _t=j,Wt=_t.destroy;_t=_t.tag,Wt!==void 0&&(_t&2||_t&4)&&Mj(h,i,Wt),j=j.next}while(j!==_)}Yj(e,i,h);break;case 1:if(!U&&(Lj(h,i),_=h.stateNode,typeof _.componentWillUnmount=="function"))try{_.props=h.memoizedProps,_.state=h.memoizedState,_.componentWillUnmount()}catch(_n){W(h,i,_n)}Yj(e,i,h);break;case 21:Yj(e,i,h);break;case 22:h.mode&1?(U=(_=U)||h.memoizedState!==null,Yj(e,i,h),U=_):Yj(e,i,h);break;default:Yj(e,i,h)}}function ak(e){var i=e.updateQueue;if(i!==null){e.updateQueue=null;var h=e.stateNode;h===null&&(h=e.stateNode=new Kj),i.forEach(function(_){var j=bk.bind(null,e,_);h.has(_)||(h.add(_),_.then(j,j))})}}function ck(e,i){var h=i.deletions;if(h!==null)for(var _=0;_<h.length;_++){var j=h[_];try{var _t=e,Wt=i,_n=Wt;t:for(;_n!==null;){switch(_n.tag){case 5:X=_n.stateNode,Xj=!1;break t;case 3:X=_n.stateNode.containerInfo,Xj=!0;break t;case 4:X=_n.stateNode.containerInfo,Xj=!0;break t}_n=_n.return}if(X===null)throw Error(p(160));Zj(_t,Wt,j),X=null,Xj=!1;var _i=j.alternate;_i!==null&&(_i.return=null),j.return=null}catch(_s){W(j,i,_s)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)dk(i,e),i=i.sibling}function dk(e,i){var h=e.alternate,_=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ck(i,e),ek(e),_&4){try{Pj(3,e,e.return),Qj(3,e)}catch(uE){W(e,e.return,uE)}try{Pj(5,e,e.return)}catch(uE){W(e,e.return,uE)}}break;case 1:ck(i,e),ek(e),_&512&&h!==null&&Lj(h,h.return);break;case 5:if(ck(i,e),ek(e),_&512&&h!==null&&Lj(h,h.return),e.flags&32){var j=e.stateNode;try{ob(j,"")}catch(uE){W(e,e.return,uE)}}if(_&4&&(j=e.stateNode,j!=null)){var _t=e.memoizedProps,Wt=h!==null?h.memoizedProps:_t,_n=e.type,_i=e.updateQueue;if(e.updateQueue=null,_i!==null)try{_n==="input"&&_t.type==="radio"&&_t.name!=null&&ab(j,_t),vb(_n,Wt);var _s=vb(_n,_t);for(Wt=0;Wt<_i.length;Wt+=2){var _u=_i[Wt],_h=_i[Wt+1];_u==="style"?sb(j,_h):_u==="dangerouslySetInnerHTML"?nb(j,_h):_u==="children"?ob(j,_h):ta(j,_u,_h,_s)}switch(_n){case"input":bb(j,_t);break;case"textarea":ib(j,_t);break;case"select":var _d=j._wrapperState.wasMultiple;j._wrapperState.wasMultiple=!!_t.multiple;var nE=_t.value;nE!=null?fb(j,!!_t.multiple,nE,!1):_d!==!!_t.multiple&&(_t.defaultValue!=null?fb(j,!!_t.multiple,_t.defaultValue,!0):fb(j,!!_t.multiple,_t.multiple?[]:"",!1))}j[Pf]=_t}catch(uE){W(e,e.return,uE)}}break;case 6:if(ck(i,e),ek(e),_&4){if(e.stateNode===null)throw Error(p(162));j=e.stateNode,_t=e.memoizedProps;try{j.nodeValue=_t}catch(uE){W(e,e.return,uE)}}break;case 3:if(ck(i,e),ek(e),_&4&&h!==null&&h.memoizedState.isDehydrated)try{bd(i.containerInfo)}catch(uE){W(e,e.return,uE)}break;case 4:ck(i,e),ek(e);break;case 13:ck(i,e),ek(e),j=e.child,j.flags&8192&&(_t=j.memoizedState!==null,j.stateNode.isHidden=_t,!_t||j.alternate!==null&&j.alternate.memoizedState!==null||(fk=B())),_&4&&ak(e);break;case 22:if(_u=h!==null&&h.memoizedState!==null,e.mode&1?(U=(_s=U)||_u,ck(i,e),U=_s):ck(i,e),ek(e),_&8192){if(_s=e.memoizedState!==null,(e.stateNode.isHidden=_s)&&!_u&&e.mode&1)for(V=e,_u=e.child;_u!==null;){for(_h=V=_u;V!==null;){switch(_d=V,nE=_d.child,_d.tag){case 0:case 11:case 14:case 15:Pj(4,_d,_d.return);break;case 1:Lj(_d,_d.return);var aE=_d.stateNode;if(typeof aE.componentWillUnmount=="function"){_=_d,h=_d.return;try{i=_,aE.props=i.memoizedProps,aE.state=i.memoizedState,aE.componentWillUnmount()}catch(uE){W(_,h,uE)}}break;case 5:Lj(_d,_d.return);break;case 22:if(_d.memoizedState!==null){gk(_h);continue}}nE!==null?(nE.return=_d,V=nE):gk(_h)}_u=_u.sibling}t:for(_u=null,_h=e;;){if(_h.tag===5){if(_u===null){_u=_h;try{j=_h.stateNode,_s?(_t=j.style,typeof _t.setProperty=="function"?_t.setProperty("display","none","important"):_t.display="none"):(_n=_h.stateNode,_i=_h.memoizedProps.style,Wt=_i!=null&&_i.hasOwnProperty("display")?_i.display:null,_n.style.display=rb("display",Wt))}catch(uE){W(e,e.return,uE)}}}else if(_h.tag===6){if(_u===null)try{_h.stateNode.nodeValue=_s?"":_h.memoizedProps}catch(uE){W(e,e.return,uE)}}else if((_h.tag!==22&&_h.tag!==23||_h.memoizedState===null||_h===e)&&_h.child!==null){_h.child.return=_h,_h=_h.child;continue}if(_h===e)break t;for(;_h.sibling===null;){if(_h.return===null||_h.return===e)break t;_u===_h&&(_u=null),_h=_h.return}_u===_h&&(_u=null),_h.sibling.return=_h.return,_h=_h.sibling}}break;case 19:ck(i,e),ek(e),_&4&&ak(e);break;case 21:break;default:ck(i,e),ek(e)}}function ek(e){var i=e.flags;if(i&2){try{t:{for(var h=e.return;h!==null;){if(Tj(h)){var _=h;break t}h=h.return}throw Error(p(160))}switch(_.tag){case 5:var j=_.stateNode;_.flags&32&&(ob(j,""),_.flags&=-33);var _t=Uj(e);Wj(e,_t,j);break;case 3:case 4:var Wt=_.stateNode.containerInfo,_n=Uj(e);Vj(e,_n,Wt);break;default:throw Error(p(161))}}catch(_i){W(e,e.return,_i)}e.flags&=-3}i&4096&&(e.flags&=-4097)}function hk(e,i,h){V=e,ik(e)}function ik(e,i,h){for(var _=(e.mode&1)!==0;V!==null;){var j=V,_t=j.child;if(j.tag===22&&_){var Wt=j.memoizedState!==null||Jj;if(!Wt){var _n=j.alternate,_i=_n!==null&&_n.memoizedState!==null||U;_n=Jj;var _s=U;if(Jj=Wt,(U=_i)&&!_s)for(V=j;V!==null;)Wt=V,_i=Wt.child,Wt.tag===22&&Wt.memoizedState!==null?jk(j):_i!==null?(_i.return=Wt,V=_i):jk(j);for(;_t!==null;)V=_t,ik(_t),_t=_t.sibling;V=j,Jj=_n,U=_s}kk(e)}else j.subtreeFlags&8772&&_t!==null?(_t.return=j,V=_t):kk(e)}}function kk(e){for(;V!==null;){var i=V;if(i.flags&8772){var h=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:U||Qj(5,i);break;case 1:var _=i.stateNode;if(i.flags&4&&!U)if(h===null)_.componentDidMount();else{var j=i.elementType===i.type?h.memoizedProps:Ci(i.type,h.memoizedProps);_.componentDidUpdate(j,h.memoizedState,_.__reactInternalSnapshotBeforeUpdate)}var _t=i.updateQueue;_t!==null&&sh(i,_t,_);break;case 3:var Wt=i.updateQueue;if(Wt!==null){if(h=null,i.child!==null)switch(i.child.tag){case 5:h=i.child.stateNode;break;case 1:h=i.child.stateNode}sh(i,Wt,h)}break;case 5:var _n=i.stateNode;if(h===null&&i.flags&4){h=_n;var _i=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":_i.autoFocus&&h.focus();break;case"img":_i.src&&(h.src=_i.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var _s=i.alternate;if(_s!==null){var _u=_s.memoizedState;if(_u!==null){var _h=_u.dehydrated;_h!==null&&bd(_h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||i.flags&512&&Rj(i)}catch(_d){W(i,i.return,_d)}}if(i===e){V=null;break}if(h=i.sibling,h!==null){h.return=i.return,V=h;break}V=i.return}}function gk(e){for(;V!==null;){var i=V;if(i===e){V=null;break}var h=i.sibling;if(h!==null){h.return=i.return,V=h;break}V=i.return}}function jk(e){for(;V!==null;){var i=V;try{switch(i.tag){case 0:case 11:case 15:var h=i.return;try{Qj(4,i)}catch(_i){W(i,h,_i)}break;case 1:var _=i.stateNode;if(typeof _.componentDidMount=="function"){var j=i.return;try{_.componentDidMount()}catch(_i){W(i,j,_i)}}var _t=i.return;try{Rj(i)}catch(_i){W(i,_t,_i)}break;case 5:var Wt=i.return;try{Rj(i)}catch(_i){W(i,Wt,_i)}}}catch(_i){W(i,i.return,_i)}if(i===e){V=null;break}var _n=i.sibling;if(_n!==null){_n.return=i.return,V=_n;break}V=i.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(e){return e.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(e=C,e!==0||(e=window.event,e=e===void 0?16:jd(e.type)),e):1}function gi(e,i,h,_){if(50<yk)throw yk=0,zk=null,Error(p(185));Ac(e,h,_),(!(K&2)||e!==Q)&&(e===Q&&(!(K&2)&&(qk|=h),T===4&&Ck(e,Z)),Dk(e,_),h===1&&K===0&&!(i.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(e,i){var h=e.callbackNode;wc(e,i);var _=uc(e,e===Q?Z:0);if(_===0)h!==null&&bc(h),e.callbackNode=null,e.callbackPriority=0;else if(i=_&-_,e.callbackPriority!==i){if(h!=null&&bc(h),i===1)e.tag===0?ig(Ek.bind(null,e)):hg(Ek.bind(null,e)),Jf(function(){!(K&6)&&jg()}),h=null;else{switch(Dc(_)){case 1:h=fc;break;case 4:h=gc;break;case 16:h=hc;break;case 536870912:h=jc;break;default:h=hc}h=Fk(h,Gk.bind(null,e))}e.callbackPriority=i,e.callbackNode=h}}function Gk(e,i){if(Ak=-1,Bk=0,K&6)throw Error(p(327));var h=e.callbackNode;if(Hk()&&e.callbackNode!==h)return null;var _=uc(e,e===Q?Z:0);if(_===0)return null;if(_&30||_&e.expiredLanes||i)i=Ik(e,_);else{i=_;var j=K;K|=2;var _t=Jk();(Q!==e||Z!==i)&&(uk=null,Gj=B()+500,Kk(e,i));do try{Lk();break}catch(_n){Mk(e,_n)}while(!0);$g(),mk.current=_t,K=j,Y!==null?i=0:(Q=null,Z=0,i=T)}if(i!==0){if(i===2&&(j=xc(e),j!==0&&(_=j,i=Nk(e,j))),i===1)throw h=pk,Kk(e,0),Ck(e,_),Dk(e,B()),h;if(i===6)Ck(e,_);else{if(j=e.current.alternate,!(_&30)&&!Ok(j)&&(i=Ik(e,_),i===2&&(_t=xc(e),_t!==0&&(_=_t,i=Nk(e,_t))),i===1))throw h=pk,Kk(e,0),Ck(e,_),Dk(e,B()),h;switch(e.finishedWork=j,e.finishedLanes=_,i){case 0:case 1:throw Error(p(345));case 2:Pk(e,tk,uk);break;case 3:if(Ck(e,_),(_&130023424)===_&&(i=fk+500-B(),10<i)){if(uc(e,0)!==0)break;if(j=e.suspendedLanes,(j&_)!==_){R(),e.pingedLanes|=e.suspendedLanes&j;break}e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),i);break}Pk(e,tk,uk);break;case 4:if(Ck(e,_),(_&4194240)===_)break;for(i=e.eventTimes,j=-1;0<_;){var Wt=31-oc(_);_t=1<<Wt,Wt=i[Wt],Wt>j&&(j=Wt),_&=~_t}if(_=j,_=B()-_,_=(120>_?120:480>_?480:1080>_?1080:1920>_?1920:3e3>_?3e3:4320>_?4320:1960*lk(_/1960))-_,10<_){e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),_);break}Pk(e,tk,uk);break;case 5:Pk(e,tk,uk);break;default:throw Error(p(329))}}}return Dk(e,B()),e.callbackNode===h?Gk.bind(null,e):null}function Nk(e,i){var h=sk;return e.current.memoizedState.isDehydrated&&(Kk(e,i).flags|=256),e=Ik(e,i),e!==2&&(i=tk,tk=h,i!==null&&Fj(i)),e}function Fj(e){tk===null?tk=e:tk.push.apply(tk,e)}function Ok(e){for(var i=e;;){if(i.flags&16384){var h=i.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var _=0;_<h.length;_++){var j=h[_],_t=j.getSnapshot;j=j.value;try{if(!He(_t(),j))return!1}catch{return!1}}}if(h=i.child,i.subtreeFlags&16384&&h!==null)h.return=i,i=h;else{if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Ck(e,i){for(i&=~rk,i&=~qk,e.suspendedLanes|=i,e.pingedLanes&=~i,e=e.expirationTimes;0<i;){var h=31-oc(i),_=1<<h;e[h]=-1,i&=~_}}function Ek(e){if(K&6)throw Error(p(327));Hk();var i=uc(e,0);if(!(i&1))return Dk(e,B()),null;var h=Ik(e,i);if(e.tag!==0&&h===2){var _=xc(e);_!==0&&(i=_,h=Nk(e,_))}if(h===1)throw h=pk,Kk(e,0),Ck(e,i),Dk(e,B()),h;if(h===6)throw Error(p(345));return e.finishedWork=e.current.alternate,e.finishedLanes=i,Pk(e,tk,uk),Dk(e,B()),null}function Qk(e,i){var h=K;K|=1;try{return e(i)}finally{K=h,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(e){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var i=K;K|=1;var h=ok.transition,_=C;try{if(ok.transition=null,C=1,e)return e()}finally{C=_,ok.transition=h,K=i,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(e,i){e.finishedWork=null,e.finishedLanes=0;var h=e.timeoutHandle;if(h!==-1&&(e.timeoutHandle=-1,Gf(h)),Y!==null)for(h=Y.return;h!==null;){var _=h;switch(wg(_),_.tag){case 1:_=_.type.childContextTypes,_!=null&&$f();break;case 3:zh(),E(Wf),E(H),Eh();break;case 5:Bh(_);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(_.type._context);break;case 22:case 23:Hj()}h=h.return}if(Q=e,Y=e=Pg(e.current,null),Z=fj=i,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(i=0;i<fh.length;i++)if(h=fh[i],_=h.interleaved,_!==null){h.interleaved=null;var j=_.next,_t=h.pending;if(_t!==null){var Wt=_t.next;_t.next=j,_.next=Wt}h.pending=_}fh=null}return e}function Mk(e,i){do{var h=Y;try{if($g(),Fh.current=Rh,Ih){for(var _=M.memoizedState;_!==null;){var j=_.queue;j!==null&&(j.pending=null),_=_.next}Ih=!1}if(Hh=0,O=N=M=null,Jh=!1,Kh=0,nk.current=null,h===null||h.return===null){T=1,pk=i,Y=null;break}t:{var _t=e,Wt=h.return,_n=h,_i=i;if(i=Z,_n.flags|=32768,_i!==null&&typeof _i=="object"&&typeof _i.then=="function"){var _s=_i,_u=_n,_h=_u.tag;if(!(_u.mode&1)&&(_h===0||_h===11||_h===15)){var _d=_u.alternate;_d?(_u.updateQueue=_d.updateQueue,_u.memoizedState=_d.memoizedState,_u.lanes=_d.lanes):(_u.updateQueue=null,_u.memoizedState=null)}var nE=Ui(Wt);if(nE!==null){nE.flags&=-257,Vi(nE,Wt,_n,_t,i),nE.mode&1&&Si(_t,_s,i),i=nE,_i=_s;var aE=i.updateQueue;if(aE===null){var uE=new Set;uE.add(_i),i.updateQueue=uE}else aE.add(_i);break t}else{if(!(i&1)){Si(_t,_s,i),tj();break t}_i=Error(p(426))}}else if(I&&_n.mode&1){var hE=Ui(Wt);if(hE!==null){!(hE.flags&65536)&&(hE.flags|=256),Vi(hE,Wt,_n,_t,i),Jg(Ji(_i,_n));break t}}_t=_i=Ji(_i,_n),T!==4&&(T=2),sk===null?sk=[_t]:sk.push(_t),_t=Wt;do{switch(_t.tag){case 3:_t.flags|=65536,i&=-i,_t.lanes|=i;var oE=Ni(_t,_i,i);ph(_t,oE);break t;case 1:_n=_i;var sE=_t.type,dE=_t.stateNode;if(!(_t.flags&128)&&(typeof sE.getDerivedStateFromError=="function"||dE!==null&&typeof dE.componentDidCatch=="function"&&(Ri===null||!Ri.has(dE)))){_t.flags|=65536,i&=-i,_t.lanes|=i;var vE=Qi(_t,_n,i);ph(_t,vE);break t}}_t=_t.return}while(_t!==null)}Sk(h)}catch(AE){i=AE,Y===h&&h!==null&&(Y=h=h.return);continue}break}while(!0)}function Jk(){var e=mk.current;return mk.current=Rh,e===null?Rh:e}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(e,i){var h=K;K|=2;var _=Jk();(Q!==e||Z!==i)&&(uk=null,Kk(e,i));do try{Tk();break}catch(j){Mk(e,j)}while(!0);if($g(),K=h,mk.current=_,Y!==null)throw Error(p(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(e){var i=Vk(e.alternate,e,fj);e.memoizedProps=e.pendingProps,i===null?Sk(e):Y=i,nk.current=null}function Sk(e){var i=e;do{var h=i.alternate;if(e=i.return,i.flags&32768){if(h=Ij(h,i),h!==null){h.flags&=32767,Y=h;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{T=6,Y=null;return}}else if(h=Ej(h,i,fj),h!==null){Y=h;return}if(i=i.sibling,i!==null){Y=i;return}Y=i=e}while(i!==null);T===0&&(T=5)}function Pk(e,i,h){var _=C,j=ok.transition;try{ok.transition=null,C=1,Wk(e,i,h,_)}finally{ok.transition=j,C=_}return null}function Wk(e,i,h,_){do Hk();while(wk!==null);if(K&6)throw Error(p(327));h=e.finishedWork;var j=e.finishedLanes;if(h===null)return null;if(e.finishedWork=null,e.finishedLanes=0,h===e.current)throw Error(p(177));e.callbackNode=null,e.callbackPriority=0;var _t=h.lanes|h.childLanes;if(Bc(e,_t),e===Q&&(Y=Q=null,Z=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),_t=(h.flags&15990)!==0,h.subtreeFlags&15990||_t){_t=ok.transition,ok.transition=null;var Wt=C;C=1;var _n=K;K|=4,nk.current=null,Oj(e,h),dk(h,e),Oe(Df),dd=!!Cf,Df=Cf=null,e.current=h,hk(h),dc(),K=_n,C=Wt,ok.transition=_t}else e.current=h;if(vk&&(vk=!1,wk=e,xk=j),_t=e.pendingLanes,_t===0&&(Ri=null),mc(h.stateNode),Dk(e,B()),i!==null)for(_=e.onRecoverableError,h=0;h<i.length;h++)j=i[h],_(j.value,{componentStack:j.stack,digest:j.digest});if(Oi)throw Oi=!1,e=Pi,Pi=null,e;return xk&1&&e.tag!==0&&Hk(),_t=e.pendingLanes,_t&1?e===zk?yk++:(yk=0,zk=e):yk=0,jg(),null}function Hk(){if(wk!==null){var e=Dc(xk),i=ok.transition,h=C;try{if(ok.transition=null,C=16>e?16:e,wk===null)var _=!1;else{if(e=wk,wk=null,xk=0,K&6)throw Error(p(331));var j=K;for(K|=4,V=e.current;V!==null;){var _t=V,Wt=_t.child;if(V.flags&16){var _n=_t.deletions;if(_n!==null){for(var _i=0;_i<_n.length;_i++){var _s=_n[_i];for(V=_s;V!==null;){var _u=V;switch(_u.tag){case 0:case 11:case 15:Pj(8,_u,_t)}var _h=_u.child;if(_h!==null)_h.return=_u,V=_h;else for(;V!==null;){_u=V;var _d=_u.sibling,nE=_u.return;if(Sj(_u),_u===_s){V=null;break}if(_d!==null){_d.return=nE,V=_d;break}V=nE}}}var aE=_t.alternate;if(aE!==null){var uE=aE.child;if(uE!==null){aE.child=null;do{var hE=uE.sibling;uE.sibling=null,uE=hE}while(uE!==null)}}V=_t}}if(_t.subtreeFlags&2064&&Wt!==null)Wt.return=_t,V=Wt;else t:for(;V!==null;){if(_t=V,_t.flags&2048)switch(_t.tag){case 0:case 11:case 15:Pj(9,_t,_t.return)}var oE=_t.sibling;if(oE!==null){oE.return=_t.return,V=oE;break t}V=_t.return}}var sE=e.current;for(V=sE;V!==null;){Wt=V;var dE=Wt.child;if(Wt.subtreeFlags&2064&&dE!==null)dE.return=Wt,V=dE;else t:for(Wt=sE;V!==null;){if(_n=V,_n.flags&2048)try{switch(_n.tag){case 0:case 11:case 15:Qj(9,_n)}}catch(AE){W(_n,_n.return,AE)}if(_n===Wt){V=null;break t}var vE=_n.sibling;if(vE!==null){vE.return=_n.return,V=vE;break t}V=_n.return}}if(K=j,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,e)}catch{}_=!0}return _}finally{C=h,ok.transition=i}}return!1}function Xk(e,i,h){i=Ji(h,i),i=Ni(e,i,1),e=nh(e,i,1),i=R(),e!==null&&(Ac(e,1,i),Dk(e,i))}function W(e,i,h){if(e.tag===3)Xk(e,e,h);else for(;i!==null;){if(i.tag===3){Xk(i,e,h);break}else if(i.tag===1){var _=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(Ri===null||!Ri.has(_))){e=Ji(h,e),e=Qi(i,e,1),i=nh(i,e,1),e=R(),i!==null&&(Ac(i,1,e),Dk(i,e));break}}i=i.return}}function Ti(e,i,h){var _=e.pingCache;_!==null&&_.delete(i),i=R(),e.pingedLanes|=e.suspendedLanes&h,Q===e&&(Z&h)===h&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(e,0):rk|=h),Dk(e,i)}function Yk(e,i){i===0&&(e.mode&1?(i=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):i=1);var h=R();e=ih(e,i),e!==null&&(Ac(e,i,h),Dk(e,h))}function uj(e){var i=e.memoizedState,h=0;i!==null&&(h=i.retryLane),Yk(e,h)}function bk(e,i){var h=0;switch(e.tag){case 13:var _=e.stateNode,j=e.memoizedState;j!==null&&(h=j.retryLane);break;case 19:_=e.stateNode;break;default:throw Error(p(314))}_!==null&&_.delete(i),Yk(e,h)}var Vk;Vk=function(e,i,h){if(e!==null)if(e.memoizedProps!==i.pendingProps||Wf.current)dh=!0;else{if(!(e.lanes&h)&&!(i.flags&128))return dh=!1,yj(e,i,h);dh=!!(e.flags&131072)}else dh=!1,I&&i.flags&1048576&&ug(i,ng,i.index);switch(i.lanes=0,i.tag){case 2:var _=i.type;ij(e,i),e=i.pendingProps;var j=Yf(i,H.current);ch(i,h),j=Nh(null,i,_,e,j,h);var _t=Sh();return i.flags|=1,typeof j=="object"&&j!==null&&typeof j.render=="function"&&j.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Zf(_)?(_t=!0,cg(i)):_t=!1,i.memoizedState=j.state!==null&&j.state!==void 0?j.state:null,kh(i),j.updater=Ei,i.stateNode=j,j._reactInternals=i,Ii(i,_,e,h),i=jj(null,i,_,!0,_t,h)):(i.tag=0,I&&_t&&vg(i),Xi(null,i,j,h),i=i.child),i;case 16:_=i.elementType;t:{switch(ij(e,i),e=i.pendingProps,j=_._init,_=j(_._payload),i.type=_,j=i.tag=Zk(_),e=Ci(_,e),j){case 0:i=cj(null,i,_,e,h);break t;case 1:i=hj(null,i,_,e,h);break t;case 11:i=Yi(null,i,_,e,h);break t;case 14:i=$i(null,i,_,Ci(_.type,e),h);break t}throw Error(p(306,_,""))}return i;case 0:return _=i.type,j=i.pendingProps,j=i.elementType===_?j:Ci(_,j),cj(e,i,_,j,h);case 1:return _=i.type,j=i.pendingProps,j=i.elementType===_?j:Ci(_,j),hj(e,i,_,j,h);case 3:t:{if(kj(i),e===null)throw Error(p(387));_=i.pendingProps,_t=i.memoizedState,j=_t.element,lh(e,i),qh(i,_,null,h);var Wt=i.memoizedState;if(_=Wt.element,_t.isDehydrated)if(_t={element:_,isDehydrated:!1,cache:Wt.cache,pendingSuspenseBoundaries:Wt.pendingSuspenseBoundaries,transitions:Wt.transitions},i.updateQueue.baseState=_t,i.memoizedState=_t,i.flags&256){j=Ji(Error(p(423)),i),i=lj(e,i,_,h,j);break t}else if(_!==j){j=Ji(Error(p(424)),i),i=lj(e,i,_,h,j);break t}else for(yg=Lf(i.stateNode.containerInfo.firstChild),xg=i,I=!0,zg=null,h=Vg(i,null,_,h),i.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Ig(),_===j){i=Zi(e,i,h);break t}Xi(e,i,_,h)}i=i.child}return i;case 5:return Ah(i),e===null&&Eg(i),_=i.type,j=i.pendingProps,_t=e!==null?e.memoizedProps:null,Wt=j.children,Ef(_,j)?Wt=null:_t!==null&&Ef(_,_t)&&(i.flags|=32),gj(e,i),Xi(e,i,Wt,h),i.child;case 6:return e===null&&Eg(i),null;case 13:return oj(e,i,h);case 4:return yh(i,i.stateNode.containerInfo),_=i.pendingProps,e===null?i.child=Ug(i,null,_,h):Xi(e,i,_,h),i.child;case 11:return _=i.type,j=i.pendingProps,j=i.elementType===_?j:Ci(_,j),Yi(e,i,_,j,h);case 7:return Xi(e,i,i.pendingProps,h),i.child;case 8:return Xi(e,i,i.pendingProps.children,h),i.child;case 12:return Xi(e,i,i.pendingProps.children,h),i.child;case 10:t:{if(_=i.type._context,j=i.pendingProps,_t=i.memoizedProps,Wt=j.value,G(Wg,_._currentValue),_._currentValue=Wt,_t!==null)if(He(_t.value,Wt)){if(_t.children===j.children&&!Wf.current){i=Zi(e,i,h);break t}}else for(_t=i.child,_t!==null&&(_t.return=i);_t!==null;){var _n=_t.dependencies;if(_n!==null){Wt=_t.child;for(var _i=_n.firstContext;_i!==null;){if(_i.context===_){if(_t.tag===1){_i=mh(-1,h&-h),_i.tag=2;var _s=_t.updateQueue;if(_s!==null){_s=_s.shared;var _u=_s.pending;_u===null?_i.next=_i:(_i.next=_u.next,_u.next=_i),_s.pending=_i}}_t.lanes|=h,_i=_t.alternate,_i!==null&&(_i.lanes|=h),bh(_t.return,h,i),_n.lanes|=h;break}_i=_i.next}}else if(_t.tag===10)Wt=_t.type===i.type?null:_t.child;else if(_t.tag===18){if(Wt=_t.return,Wt===null)throw Error(p(341));Wt.lanes|=h,_n=Wt.alternate,_n!==null&&(_n.lanes|=h),bh(Wt,h,i),Wt=_t.sibling}else Wt=_t.child;if(Wt!==null)Wt.return=_t;else for(Wt=_t;Wt!==null;){if(Wt===i){Wt=null;break}if(_t=Wt.sibling,_t!==null){_t.return=Wt.return,Wt=_t;break}Wt=Wt.return}_t=Wt}Xi(e,i,j.children,h),i=i.child}return i;case 9:return j=i.type,_=i.pendingProps.children,ch(i,h),j=eh(j),_=_(j),i.flags|=1,Xi(e,i,_,h),i.child;case 14:return _=i.type,j=Ci(_,i.pendingProps),j=Ci(_.type,j),$i(e,i,_,j,h);case 15:return bj(e,i,i.type,i.pendingProps,h);case 17:return _=i.type,j=i.pendingProps,j=i.elementType===_?j:Ci(_,j),ij(e,i),i.tag=1,Zf(_)?(e=!0,cg(i)):e=!1,ch(i,h),Gi(i,_,j),Ii(i,_,j,h),jj(null,i,_,!0,e,h);case 19:return xj(e,i,h);case 22:return dj(e,i,h)}throw Error(p(156,i.tag))};function Fk(e,i){return ac(e,i)}function $k(e,i,h,_){this.tag=e,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(e,i,h,_){return new $k(e,i,h,_)}function aj(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Zk(e){if(typeof e=="function")return aj(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Da)return 11;if(e===Ga)return 14}return 2}function Pg(e,i){var h=e.alternate;return h===null?(h=Bg(e.tag,i,e.key,e.mode),h.elementType=e.elementType,h.type=e.type,h.stateNode=e.stateNode,h.alternate=e,e.alternate=h):(h.pendingProps=i,h.type=e.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=e.flags&14680064,h.childLanes=e.childLanes,h.lanes=e.lanes,h.child=e.child,h.memoizedProps=e.memoizedProps,h.memoizedState=e.memoizedState,h.updateQueue=e.updateQueue,i=e.dependencies,h.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},h.sibling=e.sibling,h.index=e.index,h.ref=e.ref,h}function Rg(e,i,h,_,j,_t){var Wt=2;if(_=e,typeof e=="function")aj(e)&&(Wt=1);else if(typeof e=="string")Wt=5;else t:switch(e){case ya:return Tg(h.children,j,_t,i);case za:Wt=8,j|=8;break;case Aa:return e=Bg(12,h,i,j|2),e.elementType=Aa,e.lanes=_t,e;case Ea:return e=Bg(13,h,i,j),e.elementType=Ea,e.lanes=_t,e;case Fa:return e=Bg(19,h,i,j),e.elementType=Fa,e.lanes=_t,e;case Ia:return pj(h,j,_t,i);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Ba:Wt=10;break t;case Ca:Wt=9;break t;case Da:Wt=11;break t;case Ga:Wt=14;break t;case Ha:Wt=16,_=null;break t}throw Error(p(130,e==null?e:typeof e,""))}return i=Bg(Wt,h,i,j),i.elementType=e,i.type=_,i.lanes=_t,i}function Tg(e,i,h,_){return e=Bg(7,e,_,i),e.lanes=h,e}function pj(e,i,h,_){return e=Bg(22,e,_,i),e.elementType=Ia,e.lanes=h,e.stateNode={isHidden:!1},e}function Qg(e,i,h){return e=Bg(6,e,null,i),e.lanes=h,e}function Sg(e,i,h){return i=Bg(4,e.children!==null?e.children:[],e.key,i),i.lanes=h,i.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},i}function al(e,i,h,_,j){this.tag=i,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=_,this.onRecoverableError=j,this.mutableSourceEagerHydrationData=null}function bl(e,i,h,_,j,_t,Wt,_n,_i){return e=new al(e,i,h,_n,_i),i===1?(i=1,_t===!0&&(i|=8)):i=0,_t=Bg(3,null,null,i),e.current=_t,_t.stateNode=e,_t.memoizedState={element:_,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(_t),e}function cl(e,i,h){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:_==null?null:""+_,children:e,containerInfo:i,implementation:h}}function dl(e){if(!e)return Vf;e=e._reactInternals;t:{if(Vb(e)!==e||e.tag!==1)throw Error(p(170));var i=e;do{switch(i.tag){case 3:i=i.stateNode.context;break t;case 1:if(Zf(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break t}}i=i.return}while(i!==null);throw Error(p(171))}if(e.tag===1){var h=e.type;if(Zf(h))return bg(e,h,i)}return i}function el(e,i,h,_,j,_t,Wt,_n,_i){return e=bl(h,_,!0,e,j,_t,Wt,_n,_i),e.context=dl(null),h=e.current,_=R(),j=yi(h),_t=mh(_,j),_t.callback=i??null,nh(h,_t,j),e.current.lanes=j,Ac(e,j,_),Dk(e,_),e}function fl(e,i,h,_){var j=i.current,_t=R(),Wt=yi(j);return h=dl(h),i.context===null?i.context=h:i.pendingContext=h,i=mh(_t,Wt),i.payload={element:e},_=_===void 0?null:_,_!==null&&(i.callback=_),e=nh(j,i,Wt),e!==null&&(gi(e,j,Wt,_t),oh(e,j,Wt)),Wt}function gl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hl(e,i){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var h=e.retryLane;e.retryLane=h!==0&&h<i?h:i}}function il(e,i){hl(e,i),(e=e.alternate)&&hl(e,i)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(e){console.error(e)};function ll(e){this._internalRoot=e}ml.prototype.render=ll.prototype.render=function(e){var i=this._internalRoot;if(i===null)throw Error(p(409));fl(e,i,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var i=e.containerInfo;Rk(function(){fl(null,e,null,null)}),i[uf]=null}};function ml(e){this._internalRoot=e}ml.prototype.unstable_scheduleHydration=function(e){if(e){var i=Hc();e={blockedOn:null,target:e,priority:i};for(var h=0;h<Qc.length&&i!==0&&i<Qc[h].priority;h++);Qc.splice(h,0,e),h===0&&Vc(e)}};function nl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(e,i,h,_,j){if(j){if(typeof _=="function"){var _t=_;_=function(){var _s=gl(Wt);_t.call(_s)}}var Wt=el(i,_,e,0,null,!1,!1,"",pl);return e._reactRootContainer=Wt,e[uf]=Wt.current,sf(e.nodeType===8?e.parentNode:e),Rk(),Wt}for(;j=e.lastChild;)e.removeChild(j);if(typeof _=="function"){var _n=_;_=function(){var _s=gl(_i);_n.call(_s)}}var _i=bl(e,0,!1,null,null,!1,!1,"",pl);return e._reactRootContainer=_i,e[uf]=_i.current,sf(e.nodeType===8?e.parentNode:e),Rk(function(){fl(i,_i,h,_)}),_i}function rl(e,i,h,_,j){var _t=h._reactRootContainer;if(_t){var Wt=_t;if(typeof j=="function"){var _n=j;j=function(){var _i=gl(Wt);_n.call(_i)}}fl(i,Wt,e,j)}else Wt=ql(h,i,e,j,_);return gl(Wt)}Ec=function(e){switch(e.tag){case 3:var i=e.stateNode;if(i.current.memoizedState.isDehydrated){var h=tc(i.pendingLanes);h!==0&&(Cc(i,h|1),Dk(i,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var _=ih(e,1);if(_!==null){var j=R();gi(_,e,1,j)}}),il(e,1)}};Fc=function(e){if(e.tag===13){var i=ih(e,134217728);if(i!==null){var h=R();gi(i,e,134217728,h)}il(e,134217728)}};Gc=function(e){if(e.tag===13){var i=yi(e),h=ih(e,i);if(h!==null){var _=R();gi(h,e,i,_)}il(e,i)}};Hc=function(){return C};Ic=function(e,i){var h=C;try{return C=e,i()}finally{C=h}};yb=function(e,i,h){switch(i){case"input":if(bb(e,h),i=h.name,h.type==="radio"&&i!=null){for(h=e;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<h.length;i++){var _=h[i];if(_!==e&&_.form===e.form){var j=Db(_);if(!j)throw Error(p(90));Wa(_),bb(_,j)}}}break;case"textarea":ib(e,h);break;case"select":i=h.value,i!=null&&fb(e,!!h.multiple,i,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Zb(e),e===null?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(e,i){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(i))throw Error(p(200));return cl(e,i,null,h)};reactDom_production_min.createRoot=function(e,i){if(!nl(e))throw Error(p(299));var h=!1,_="",j=kl;return i!=null&&(i.unstable_strictMode===!0&&(h=!0),i.identifierPrefix!==void 0&&(_=i.identifierPrefix),i.onRecoverableError!==void 0&&(j=i.onRecoverableError)),i=bl(e,1,!1,null,null,h,!1,_,j),e[uf]=i.current,sf(e.nodeType===8?e.parentNode:e),new ll(i)};reactDom_production_min.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var i=e._reactInternals;if(i===void 0)throw typeof e.render=="function"?Error(p(188)):(e=Object.keys(e).join(","),Error(p(268,e)));return e=Zb(i),e=e===null?null:e.stateNode,e};reactDom_production_min.flushSync=function(e){return Rk(e)};reactDom_production_min.hydrate=function(e,i,h){if(!ol(i))throw Error(p(200));return rl(null,e,i,!0,h)};reactDom_production_min.hydrateRoot=function(e,i,h){if(!nl(e))throw Error(p(405));var _=h!=null&&h.hydratedSources||null,j=!1,_t="",Wt=kl;if(h!=null&&(h.unstable_strictMode===!0&&(j=!0),h.identifierPrefix!==void 0&&(_t=h.identifierPrefix),h.onRecoverableError!==void 0&&(Wt=h.onRecoverableError)),i=el(i,null,e,1,h??null,j,!1,_t,Wt),e[uf]=i.current,sf(e),_)for(e=0;e<_.length;e++)h=_[e],j=h._getVersion,j=j(h._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[h,j]:i.mutableSourceEagerHydrationData.push(h,j);return new ml(i)};reactDom_production_min.render=function(e,i,h){if(!ol(i))throw Error(p(200));return rl(null,e,i,!1,h)};reactDom_production_min.unmountComponentAtNode=function(e){if(!ol(e))throw Error(p(40));return e._reactRootContainer?(Rk(function(){rl(null,null,e,!1,function(){e._reactRootContainer=null,e[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e,i,h,_){if(!ol(h))throw Error(p(200));if(e==null||e._reactInternals===void 0)throw Error(p(38));return rl(e,i,h,!1,_)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e){console.error(e)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports,createRoot,m=reactDomExports;createRoot=m.createRoot,m.hydrateRoot;var AgoraRTC_NProduction={exports:{}};(function(e,i){(function(h,_){e.exports=_()})(commonjsGlobal,function(){function h(o,s){return s.forEach(function(d){d&&typeof d!="string"&&!Array.isArray(d)&&Object.keys(d).forEach(function(g){if(g!=="default"&&!(g in o)){var b=Object.getOwnPropertyDescriptor(d,g);Object.defineProperty(o,g,b.get?b:{enumerable:!0,get:function(){return d[g]}})}})}),Object.freeze(o)}var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{};function j(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var _t=function(o){try{return!!o()}catch{return!0}},Wt=!_t(function(){var o=(function(){}).bind();return typeof o!="function"||o.hasOwnProperty("prototype")}),_n=Wt,_i=Function.prototype,_s=_i.call,_u=_n&&_i.bind.bind(_s,_s),_h=_n?_u:function(o){return function(){return _s.apply(o,arguments)}},_d=_h({}.isPrototypeOf),nE=function(o){return o&&o.Math==Math&&o},aE=nE(typeof globalThis=="object"&&globalThis)||nE(typeof window=="object"&&window)||nE(typeof self=="object"&&self)||nE(typeof _=="object"&&_)||function(){return this}()||_||Function("return this")(),uE=Wt,hE=Function.prototype,oE=hE.apply,sE=hE.call,dE=typeof Reflect=="object"&&Reflect.apply||(uE?sE.bind(oE):function(){return sE.apply(oE,arguments)}),vE=_h,AE=vE({}.toString),PE=vE("".slice),IE=function(o){return PE(AE(o),8,-1)},QE=IE,m_=_h,yE=function(o){if(QE(o)==="Function")return m_(o)},FE=typeof document=="object"&&document.all,UE={all:FE,IS_HTMLDDA:FE===void 0&&FE!==void 0},qE=UE.all,gE=UE.IS_HTMLDDA?function(o){return typeof o=="function"||o===qE}:function(o){return typeof o=="function"},RE={},OE=!_t(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),HE=Wt,CE=Function.prototype.call,jE=HE?CE.bind(CE):function(){return CE.apply(CE,arguments)},LE={},i_={}.propertyIsEnumerable,o_=Object.getOwnPropertyDescriptor,w_=o_&&!i_.call({1:2},1);LE.f=w_?function(o){var s=o_(this,o);return!!s&&s.enumerable}:i_;var _y,bS,MS=function(o,s){return{enumerable:!(1&o),configurable:!(2&o),writable:!(4&o),value:s}},qR=_t,zL=IE,wN=Object,XP=_h("".split),nR=qR(function(){return!wN("z").propertyIsEnumerable(0)})?function(o){return zL(o)=="String"?XP(o,""):wN(o)}:wN,HR=function(o){return o==null},bT=HR,U_=TypeError,sS=function(o){if(bT(o))throw U_("Can't call method on "+o);return o},h_=nR,fS=sS,AS=function(o){return h_(fS(o))},j0=gE,IN=UE.all,OT=UE.IS_HTMLDDA?function(o){return typeof o=="object"?o!==null:j0(o)||o===IN}:function(o){return typeof o=="object"?o!==null:j0(o)},V0={},YL=V0,JL=aE,cQ=gE,LG=function(o){return cQ(o)?o:void 0},UT=function(o,s){return arguments.length<2?LG(YL[o])||LG(JL[o]):YL[o]&&YL[o][s]||JL[o]&&JL[o][s]},II=typeof navigator<"u"&&String(navigator.userAgent)||"",MG=aE,XL=II,xG=MG.process,UG=MG.Deno,jG=xG&&xG.versions||UG&&UG.version,VG=jG&&jG.v8;VG&&(bS=(_y=VG.split("."))[0]>0&&_y[0]<4?1:+(_y[0]+_y[1])),!bS&&XL&&(!(_y=XL.match(/Edge\/(\d+)/))||_y[1]>=74)&&(_y=XL.match(/Chrome\/(\d+)/))&&(bS=+_y[1]);var OI=bS,FG=OI,uQ=_t,lQ=aE.String,pO=!!Object.getOwnPropertySymbols&&!uQ(function(){var o=Symbol();return!lQ(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&FG&&FG<41}),BG=pO&&!Symbol.sham&&typeof Symbol.iterator=="symbol",dQ=UT,hQ=gE,pQ=_d,fQ=Object,ON=BG?function(o){return typeof o=="symbol"}:function(o){var s=dQ("Symbol");return hQ(s)&&pQ(s.prototype,fQ(o))},mQ=String,fO=function(o){try{return mQ(o)}catch{return"Object"}},EQ=gE,gQ=fO,_Q=TypeError,f0=function(o){if(EQ(o))return o;throw _Q(gQ(o)+" is not a function")},vQ=f0,yQ=HR,QP=function(o,s){var d=o[s];return yQ(d)?void 0:vQ(d)},GG=jE,WG=gE,qG=OT,SQ=TypeError,HG={exports:{}},KG=aE,TQ=Object.defineProperty,bQ=function(o,s){try{TQ(KG,o,{value:s,configurable:!0,writable:!0})}catch{KG[o]=s}return s},zG="__core-js_shared__",QL=aE[zG]||bQ(zG,{}),YG=QL;(HG.exports=function(o,s){return YG[o]||(YG[o]=s!==void 0?s:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var mO=HG.exports,RQ=sS,CQ=Object,rR=function(o){return CQ(RQ(o))},wQ=rR,IQ=_h({}.hasOwnProperty),iT=Object.hasOwn||function(o,s){return IQ(wQ(o),s)},OQ=_h,AQ=0,NQ=Math.random(),kQ=OQ(1 .toString),ZL=function(o){return"Symbol("+(o===void 0?"":o)+")_"+kQ(++AQ+NQ,36)},PQ=mO,JG=iT,DQ=ZL,LQ=pO,MQ=BG,EO=aE.Symbol,$L=PQ("wks"),xQ=MQ?EO.for||EO:EO&&EO.withoutSetter||DQ,RS=function(o){return JG($L,o)||($L[o]=LQ&&JG(EO,o)?EO[o]:xQ("Symbol."+o)),$L[o]},UQ=jE,XG=OT,QG=ON,jQ=QP,VQ=function(o,s){var d,g;if(WG(d=o.toString)&&!qG(g=GG(d,o))||WG(d=o.valueOf)&&!qG(g=GG(d,o)))return g;throw SQ("Can't convert object to primitive value")},FQ=TypeError,BQ=RS("toPrimitive"),GQ=function(o,s){if(!XG(o)||QG(o))return o;var d,g=jQ(o,BQ);if(g){if(d=UQ(g,o,s),!XG(d)||QG(d))return d;throw FQ("Can't convert object to primitive value")}return VQ(o)},WQ=ON,ZP=function(o){var s=GQ(o,"string");return WQ(s)?s:s+""},ZG=OT,tM=aE.document,qQ=ZG(tM)&&ZG(tM.createElement),eM=function(o){return qQ?tM.createElement(o):{}},HQ=eM,$G=!OE&&!_t(function(){return Object.defineProperty(HQ("div"),"a",{get:function(){return 7}}).a!=7}),KQ=OE,zQ=jE,YQ=LE,JQ=MS,XQ=AS,QQ=ZP,ZQ=iT,$Q=$G,t6=Object.getOwnPropertyDescriptor;RE.f=KQ?t6:function(o,s){if(o=XQ(o),s=QQ(s),$Q)try{return t6(o,s)}catch{}if(ZQ(o,s))return JQ(!zQ(YQ.f,o,s),o[s])};var t2=_t,e2=gE,n2=/#|\.prototype\./,AN=function(o,s){var d=i2[r2(o)];return d==s2||d!=o2&&(e2(s)?t2(s):!!s)},r2=AN.normalize=function(o){return String(o).replace(n2,".").toLowerCase()},i2=AN.data={},o2=AN.NATIVE="N",s2=AN.POLYFILL="P",e6=AN,a2=f0,c2=Wt,u2=yE(yE.bind),KR=function(o,s){return a2(o),s===void 0?o:c2?u2(o,s):function(){return o.apply(s,arguments)}},m0={},n6=OE&&_t(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),l2=OT,d2=String,h2=TypeError,AT=function(o){if(l2(o))return o;throw h2(d2(o)+" is not an object")},p2=OE,f2=$G,m2=n6,$P=AT,r6=ZP,E2=TypeError,nM=Object.defineProperty,g2=Object.getOwnPropertyDescriptor,rM="enumerable",iM="configurable",oM="writable";m0.f=p2?m2?function(o,s,d){if($P(o),s=r6(s),$P(d),typeof o=="function"&&s==="prototype"&&"value"in d&&oM in d&&!d[oM]){var g=g2(o,s);g&&g[oM]&&(o[s]=d.value,d={configurable:iM in d?d[iM]:g[iM],enumerable:rM in d?d[rM]:g[rM],writable:!1})}return nM(o,s,d)}:nM:function(o,s,d){if($P(o),s=r6(s),$P(d),f2)try{return nM(o,s,d)}catch{}if("get"in d||"set"in d)throw E2("Accessors not supported");return"value"in d&&(o[s]=d.value),o};var _2=m0,v2=MS,zR=OE?function(o,s,d){return _2.f(o,s,v2(1,d))}:function(o,s,d){return o[s]=d,o},t1=aE,y2=dE,S2=yE,T2=gE,b2=RE.f,R2=e6,gO=V0,C2=KR,_O=zR,i6=iT,w2=function(o){var s=function(d,g,b){if(this instanceof s){switch(arguments.length){case 0:return new o;case 1:return new o(d);case 2:return new o(d,g)}return new o(d,g,b)}return y2(o,this,arguments)};return s.prototype=o.prototype,s},X_=function(o,s){var d,g,b,$,Vt,zt,_e,_r,_o,ga=o.target,_a=o.global,_c=o.stat,tE=o.proto,_p=_a?t1:_c?t1[ga]:(t1[ga]||{}).prototype,_f=_a?gO:gO[ga]||_O(gO,ga,{})[ga],eE=_f.prototype;for($ in s)g=!(d=R2(_a?$:ga+(_c?".":"#")+$,o.forced))&&_p&&i6(_p,$),zt=_f[$],g&&(_e=o.dontCallGetSet?(_o=b2(_p,$))&&_o.value:_p[$]),Vt=g&&_e?_e:s[$],g&&typeof zt==typeof Vt||(_r=o.bind&&g?C2(Vt,t1):o.wrap&&g?w2(Vt):tE&&T2(Vt)?S2(Vt):Vt,(o.sham||Vt&&Vt.sham||zt&&zt.sham)&&_O(_r,"sham",!0),_O(_f,$,_r),tE&&(i6(gO,b=ga+"Prototype")||_O(gO,b,{}),_O(gO[b],$,Vt),o.real&&eE&&(d||!eE[$])&&_O(eE,$,Vt)))},I2=Math.ceil,O2=Math.floor,A2=Math.trunc||function(o){var s=+o;return(s>0?O2:I2)(s)},N2=A2,sM=function(o){var s=+o;return s!=s||s===0?0:N2(s)},k2=sM,P2=Math.max,D2=Math.min,aM=function(o,s){var d=k2(o);return d<0?P2(d+s,0):D2(d,s)},L2=sM,M2=Math.min,o6=function(o){return o>0?M2(L2(o),9007199254740991):0},x2=o6,IR=function(o){return x2(o.length)},U2=AS,j2=aM,V2=IR,s6=function(o){return function(s,d,g){var b,$=U2(s),Vt=V2($),zt=j2(g,Vt);if(o&&d!=d){for(;Vt>zt;)if((b=$[zt++])!=b)return!0}else for(;Vt>zt;zt++)if((o||zt in $)&&$[zt]===d)return o||zt||0;return!o&&-1}},cM={includes:s6(!0),indexOf:s6(!1)},F2=cM.includes;X_({target:"Array",proto:!0,forced:_t(function(){return!Array(1).includes()})},{includes:function(o){return F2(this,o,arguments.length>1?arguments[1]:void 0)}});var B2=V0,E0=function(o){return B2[o+"Prototype"]},G2=E0("Array").includes,W2=OT,q2=IE,H2=RS("match"),a6=function(o){var s;return W2(o)&&((s=o[H2])!==void 0?!!s:q2(o)=="RegExp")},K2=a6,z2=TypeError,c6={};c6[RS("toStringTag")]="z";var uM=String(c6)==="[object z]",Y2=uM,J2=gE,e1=IE,X2=RS("toStringTag"),Q2=Object,Z2=e1(function(){return arguments}())=="Arguments",iR=Y2?e1:function(o){var s,d,g;return o===void 0?"Undefined":o===null?"Null":typeof(d=function(b,$){try{return b[$]}catch{}}(s=Q2(o),X2))=="string"?d:Z2?e1(s):(g=e1(s))=="Object"&&J2(s.callee)?"Arguments":g},$2=iR,tZ=String,n0=function(o){if($2(o)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return tZ(o)},eZ=RS("match"),nZ=X_,rZ=function(o){if(K2(o))throw z2("The method doesn't accept regular expressions");return o},iZ=sS,u6=n0,oZ=function(o){var s=/./;try{"/./"[o](s)}catch{try{return s[eZ]=!1,"/./"[o](s)}catch{}}return!1},sZ=_h("".indexOf);nZ({target:"String",proto:!0,forced:!oZ("includes")},{includes:function(o){return!!~sZ(u6(iZ(this)),u6(rZ(o)),arguments.length>1?arguments[1]:void 0)}});var aZ=E0("String").includes,l6=_d,cZ=G2,uZ=aZ,lM=Array.prototype,dM=String.prototype,lZ=function(o){var s=o.includes;return o===lM||l6(lM,o)&&s===lM.includes?cZ:typeof o=="string"||o===dM||l6(dM,o)&&s===dM.includes?uZ:s},KE=j(lZ),dZ=f0,hZ=rR,pZ=nR,fZ=IR,mZ=TypeError,d6=function(o){return function(s,d,g,b){dZ(d);var $=hZ(s),Vt=pZ($),zt=fZ($),_e=o?zt-1:0,_r=o?-1:1;if(g<2)for(;;){if(_e in Vt){b=Vt[_e],_e+=_r;break}if(_e+=_r,o?_e<0:zt<=_e)throw mZ("Reduce of empty array with no initial value")}for(;o?_e>=0:zt>_e;_e+=_r)_e in Vt&&(b=d(b,Vt[_e],_e,$));return b}},EZ={left:d6(!1),right:d6(!0)},gZ=_t,n1=function(o,s){var d=[][o];return!!d&&gZ(function(){d.call(null,s||function(){return 1},1)})},NN=typeof process<"u"&&IE(process)=="process",_Z=EZ.left;X_({target:"Array",proto:!0,forced:!NN&&OI>79&&OI<83||!n1("reduce")},{reduce:function(o){var s=arguments.length;return _Z(this,o,s,s>1?arguments[1]:void 0)}});var vZ=E0("Array").reduce,yZ=_d,SZ=vZ,hM=Array.prototype,TZ=function(o){var s=o.reduce;return o===hM||yZ(hM,o)&&s===hM.reduce?SZ:s},h6=TZ,F0=j(h6);let p6=!0,f6=!0;function r1(o,s,d){const g=o.match(s);return g&&g.length>=d&&parseInt(g[d],10)}function AI(o,s,d){if(!o.RTCPeerConnection)return;const g=o.RTCPeerConnection.prototype,b=g.addEventListener;g.addEventListener=function(Vt,zt){if(Vt!==s)return b.apply(this,arguments);const _e=_r=>{const _o=d(_r);_o&&(zt.handleEvent?zt.handleEvent(_o):zt(_o))};return this._eventMap=this._eventMap||{},this._eventMap[s]||(this._eventMap[s]=new Map),this._eventMap[s].set(zt,_e),b.apply(this,[Vt,_e])};const $=g.removeEventListener;g.removeEventListener=function(Vt,zt){if(Vt!==s||!this._eventMap||!this._eventMap[s])return $.apply(this,arguments);if(!this._eventMap[s].has(zt))return $.apply(this,arguments);const _e=this._eventMap[s].get(zt);return this._eventMap[s].delete(zt),this._eventMap[s].size===0&&delete this._eventMap[s],Object.keys(this._eventMap).length===0&&delete this._eventMap,$.apply(this,[Vt,_e])},Object.defineProperty(g,"on"+s,{get(){return this["_on"+s]},set(Vt){this["_on"+s]&&(this.removeEventListener(s,this["_on"+s]),delete this["_on"+s]),Vt&&this.addEventListener(s,this["_on"+s]=Vt)},enumerable:!0,configurable:!0})}function bZ(o){return typeof o!="boolean"?new Error("Argument type: "+typeof o+". Please use a boolean."):(p6=o,o?"adapter.js logging disabled":"adapter.js logging enabled")}function RZ(o){return typeof o!="boolean"?new Error("Argument type: "+typeof o+". Please use a boolean."):(f6=!o,"adapter.js deprecation warnings "+(o?"disabled":"enabled"))}function m6(){if(typeof window=="object"){if(p6)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function pM(o,s){f6&&console.warn(o+" is deprecated, please use "+s+" instead.")}function E6(o){return Object.prototype.toString.call(o)==="[object Object]"}function g6(o){var s;return E6(o)?F0(s=Object.keys(o)).call(s,function(d,g){const b=E6(o[g]),$=b?g6(o[g]):o[g],Vt=b&&!Object.keys($).length;return $===void 0||Vt?d:Object.assign(d,{[g]:$})},{}):o}function fM(o,s,d){s&&!d.has(s.id)&&(d.set(s.id,s),Object.keys(s).forEach(g=>{g.endsWith("Id")?fM(o,o.get(s[g]),d):g.endsWith("Ids")&&s[g].forEach(b=>{fM(o,o.get(b),d)})}))}function _6(o,s,d){const g=d?"outbound-rtp":"inbound-rtp",b=new Map;if(s===null)return b;const $=[];return o.forEach(Vt=>{Vt.type==="track"&&Vt.trackIdentifier===s.id&&$.push(Vt)}),$.forEach(Vt=>{o.forEach(zt=>{zt.type===g&&zt.trackId===Vt.id&&fM(o,zt,b)})}),b}var CZ=ZL,v6=mO("keys"),i1=function(o){return v6[o]||(v6[o]=CZ(o))},wZ=!_t(function(){function o(){}return o.prototype.constructor=null,Object.getPrototypeOf(new o)!==o.prototype}),IZ=iT,OZ=gE,AZ=rR,NZ=wZ,y6=i1("IE_PROTO"),mM=Object,kZ=mM.prototype,EM=NZ?mM.getPrototypeOf:function(o){var s=AZ(o);if(IZ(s,y6))return s[y6];var d=s.constructor;return OZ(d)&&s instanceof d?d.prototype:s instanceof mM?kZ:null},PZ=_h,DZ=f0,LZ=gE,MZ=String,xZ=TypeError,UZ=function(o,s,d){try{return PZ(DZ(Object.getOwnPropertyDescriptor(o,s)[d]))}catch{}},jZ=AT,VZ=function(o){if(typeof o=="object"||LZ(o))return o;throw xZ("Can't set "+MZ(o)+" as a prototype")},FZ=Object.setPrototypeOf||("__proto__"in{}?function(){var o,s=!1,d={};try{(o=UZ(Object.prototype,"__proto__","set"))(d,[]),s=d instanceof Array}catch{}return function(g,b){return jZ(g),VZ(b),s?o(g,b):g.__proto__=b,g}}():void 0),o1={},s1={},gM=iT,BZ=AS,GZ=cM.indexOf,WZ=s1,S6=_h([].push),T6=function(o,s){var d,g=BZ(o),b=0,$=[];for(d in g)!gM(WZ,d)&&gM(g,d)&&S6($,d);for(;s.length>b;)gM(g,d=s[b++])&&(~GZ($,d)||S6($,d));return $},_M=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qZ=T6,HZ=_M.concat("length","prototype");o1.f=Object.getOwnPropertyNames||function(o){return qZ(o,HZ)};var kN={};kN.f=Object.getOwnPropertySymbols;var KZ=UT,zZ=o1,YZ=kN,JZ=AT,XZ=_h([].concat),QZ=KZ("Reflect","ownKeys")||function(o){var s=zZ.f(JZ(o)),d=YZ.f;return d?XZ(s,d(o)):s},b6=iT,ZZ=QZ,$Z=RE,t$=m0,vM={},e$=T6,n$=_M,a1=Object.keys||function(o){return e$(o,n$)},r$=OE,i$=n6,o$=m0,s$=AT,a$=AS,c$=a1;vM.f=r$&&!i$?Object.defineProperties:function(o,s){s$(o);for(var d,g=a$(s),b=c$(s),$=b.length,Vt=0;$>Vt;)o$.f(o,d=b[Vt++],g[d]);return o};var c1,R6=UT("document","documentElement"),u$=AT,l$=vM,C6=_M,d$=s1,h$=R6,p$=eM,yM="prototype",SM="script",w6=i1("IE_PROTO"),TM=function(){},I6=function(o){return"<"+SM+">"+o+"</"+SM+">"},O6=function(o){o.write(I6("")),o.close();var s=o.parentWindow.Object;return o=null,s},u1=function(){try{c1=new ActiveXObject("htmlfile")}catch{}var o,s,d;u1=typeof document<"u"?document.domain&&c1?O6(c1):(s=p$("iframe"),d="java"+SM+":",s.style.display="none",h$.appendChild(s),s.src=String(d),(o=s.contentWindow.document).open(),o.write(I6("document.F=Object")),o.close(),o.F):O6(c1);for(var g=C6.length;g--;)delete u1[yM][C6[g]];return u1()};d$[w6]=!0;var PN=Object.create||function(o,s){var d;return o!==null?(TM[yM]=u$(o),d=new TM,TM[yM]=null,d[w6]=o):d=u1(),s===void 0?d:l$.f(d,s)},f$=OT,m$=zR,A6=Error,E$=_h("".replace),g$=String(A6("zxcasd").stack),N6=/\n\s*at [^:]*:[^\n]*/,_$=N6.test(g$),v$=MS,y$=!_t(function(){var o=Error("a");return!("stack"in o)||(Object.defineProperty(o,"stack",v$(1,7)),o.stack!==7)}),S$=zR,T$=function(o,s){if(_$&&typeof o=="string"&&!A6.prepareStackTrace)for(;s--;)o=E$(o,N6,"");return o},b$=y$,k6=Error.captureStackTrace,NI={},R$=NI,C$=RS("iterator"),w$=Array.prototype,P6=function(o){return o!==void 0&&(R$.Array===o||w$[C$]===o)},I$=iR,D6=QP,O$=HR,A$=NI,N$=RS("iterator"),l1=function(o){if(!O$(o))return D6(o,N$)||D6(o,"@@iterator")||A$[I$(o)]},k$=jE,P$=f0,D$=AT,L$=fO,M$=l1,x$=TypeError,bM=function(o,s){var d=arguments.length<2?M$(o):s;if(P$(d))return D$(k$(d,o));throw x$(L$(o)+" is not iterable")},U$=jE,L6=AT,j$=QP,M6=function(o,s,d){var g,b;L6(o);try{if(!(g=j$(o,"return"))){if(s==="throw")throw d;return d}g=U$(g,o)}catch($){b=!0,g=$}if(s==="throw")throw d;if(b)throw g;return L6(g),d},V$=KR,F$=jE,B$=AT,G$=fO,W$=P6,q$=IR,x6=_d,H$=bM,K$=l1,U6=M6,z$=TypeError,d1=function(o,s){this.stopped=o,this.result=s},j6=d1.prototype,DN=function(o,s,d){var g,b,$,Vt,zt,_e,_r,_o=d&&d.that,ga=!(!d||!d.AS_ENTRIES),_a=!(!d||!d.IS_RECORD),_c=!(!d||!d.IS_ITERATOR),tE=!(!d||!d.INTERRUPTED),_p=V$(s,_o),_f=function(iE){return g&&U6(g,"normal",iE),new d1(!0,iE)},eE=function(iE){return ga?(B$(iE),tE?_p(iE[0],iE[1],_f):_p(iE[0],iE[1])):tE?_p(iE,_f):_p(iE)};if(_a)g=o.iterator;else if(_c)g=o;else{if(!(b=K$(o)))throw z$(G$(o)+" is not iterable");if(W$(b)){for($=0,Vt=q$(o);Vt>$;$++)if((zt=eE(o[$]))&&x6(j6,zt))return zt;return new d1(!1)}g=H$(o,b)}for(_e=_a?o.next:g.next;!(_r=F$(_e,g)).done;){try{zt=eE(_r.value)}catch(iE){U6(g,"throw",iE)}if(typeof zt=="object"&&zt&&x6(j6,zt))return zt}return new d1(!1)},Y$=n0,J$=X_,X$=_d,Q$=EM,h1=FZ,Z$=function(o,s,d){for(var g=ZZ(s),b=t$.f,$=$Z.f,Vt=0;Vt<g.length;Vt++){var zt=g[Vt];b6(o,zt)||d&&b6(d,zt)||b(o,zt,$(s,zt))}},V6=PN,RM=zR,CM=MS,$$=function(o,s){f$(s)&&"cause"in s&&m$(o,"cause",s.cause)},ttt=function(o,s,d,g){b$&&(k6?k6(o,s):S$(o,"stack",T$(d,g)))},ett=DN,ntt=function(o,s){return o===void 0?arguments.length<2?"":s:Y$(o)},rtt=RS("toStringTag"),p1=Error,itt=[].push,vO=function(o,s){var d,g=X$(wM,this);h1?d=h1(p1(),g?Q$(this):wM):(d=g?this:V6(wM),RM(d,rtt,"Error")),s!==void 0&&RM(d,"message",ntt(s)),ttt(d,vO,d.stack,1),arguments.length>2&&$$(d,arguments[2]);var b=[];return ett(o,itt,{that:b}),RM(d,"errors",b),d};h1?h1(vO,p1):Z$(vO,p1,{name:!0});var wM=vO.prototype=V6(p1.prototype,{constructor:CM(1,vO),message:CM(1,""),name:CM(1,"AggregateError")});J$({global:!0,constructor:!0,arity:2},{AggregateError:vO});var f1,LN,m1,ott=gE,F6=aE.WeakMap,stt=ott(F6)&&/native code/.test(String(F6)),B6=aE,att=OT,ctt=zR,IM=iT,OM=QL,utt=i1,ltt=s1,G6="Object already initialized",AM=B6.TypeError,dtt=B6.WeakMap;if(stt||OM.state){var oR=OM.state||(OM.state=new dtt);oR.get=oR.get,oR.has=oR.has,oR.set=oR.set,f1=function(o,s){if(oR.has(o))throw AM(G6);return s.facade=o,oR.set(o,s),s},LN=function(o){return oR.get(o)||{}},m1=function(o){return oR.has(o)}}else{var yO=utt("state");ltt[yO]=!0,f1=function(o,s){if(IM(o,yO))throw AM(G6);return s.facade=o,ctt(o,yO,s),s},LN=function(o){return IM(o,yO)?o[yO]:{}},m1=function(o){return IM(o,yO)}}var kI,W6,q6,PI={set:f1,get:LN,has:m1,enforce:function(o){return m1(o)?LN(o):f1(o,{})},getterFor:function(o){return function(s){var d;if(!att(s)||(d=LN(s)).type!==o)throw AM("Incompatible receiver, "+o+" required");return d}}},NM=OE,htt=iT,H6=Function.prototype,ptt=NM&&Object.getOwnPropertyDescriptor,kM=htt(H6,"name"),K6={EXISTS:kM,PROPER:kM&&(function(){}).name==="something",CONFIGURABLE:kM&&(!NM||NM&&ptt(H6,"name").configurable)},ftt=zR,YR=function(o,s,d,g){return g&&g.enumerable?o[s]=d:ftt(o,s,d),o},mtt=_t,Ett=gE,gtt=OT,_tt=PN,z6=EM,vtt=YR,PM=RS("iterator"),Y6=!1;[].keys&&("next"in(q6=[].keys())?(W6=z6(z6(q6)))!==Object.prototype&&(kI=W6):Y6=!0);var ytt=!gtt(kI)||mtt(function(){var o={};return kI[PM].call(o)!==o});Ett((kI=ytt?{}:_tt(kI))[PM])||vtt(kI,PM,function(){return this});var J6={IteratorPrototype:kI,BUGGY_SAFARI_ITERATORS:Y6},Stt=iR,Ttt=uM?{}.toString:function(){return"[object "+Stt(this)+"]"},btt=uM,Rtt=m0.f,Ctt=zR,wtt=iT,Itt=Ttt,X6=RS("toStringTag"),JR=function(o,s,d,g){if(o){var b=d?o:o.prototype;wtt(b,X6)||Rtt(b,X6,{configurable:!0,value:s}),g&&!btt&&Ctt(b,"toString",Itt)}},Ott=J6.IteratorPrototype,Att=PN,Ntt=MS,ktt=JR,Ptt=NI,Dtt=function(){return this},DM=function(o,s,d,g){var b=s+" Iterator";return o.prototype=Att(Ott,{next:Ntt(+!g,d)}),ktt(o,b,!1,!0),Ptt[b]=Dtt,o},Ltt=X_,Mtt=jE,xtt=K6,Utt=DM,jtt=EM,Vtt=JR,Q6=YR,Z6=NI,Ftt=J6,Btt=xtt.PROPER,E1=Ftt.BUGGY_SAFARI_ITERATORS,LM=RS("iterator"),$6="keys",g1="values",t5="entries",Gtt=function(){return this},e5=function(o,s,d,g,b,$,Vt){Utt(d,s,g);var zt,_e,_r,_o=function(eE){if(eE===b&&_p)return _p;if(!E1&&eE in _c)return _c[eE];switch(eE){case $6:case g1:case t5:return function(){return new d(this,eE)}}return function(){return new d(this)}},ga=s+" Iterator",_a=!1,_c=o.prototype,tE=_c[LM]||_c["@@iterator"]||b&&_c[b],_p=!E1&&tE||_o(b),_f=s=="Array"&&_c.entries||tE;if(_f&&(zt=jtt(_f.call(new o)))!==Object.prototype&&zt.next&&(Vtt(zt,ga,!0,!0),Z6[ga]=Gtt),Btt&&b==g1&&tE&&tE.name!==g1&&(_a=!0,_p=function(){return Mtt(tE,this)}),b)if(_e={values:_o(g1),keys:$?_p:_o($6),entries:_o(t5)},Vt)for(_r in _e)(E1||_a||!(_r in _c))&&Q6(_c,_r,_e[_r]);else Ltt({target:s,proto:!0,forced:E1||_a},_e);return Vt&&_c[LM]!==_p&&Q6(_c,LM,_p,{name:b}),Z6[s]=_p,_e},MM=function(o,s){return{value:o,done:s}},Wtt=AS,n5=NI,r5=PI;m0.f;var qtt=e5,i5=MM,o5="Array Iterator",Htt=r5.set,Ktt=r5.getterFor(o5);qtt(Array,"Array",function(o,s){Htt(this,{type:o5,target:Wtt(o),index:0,kind:s})},function(){var o=Ktt(this),s=o.target,d=o.kind,g=o.index++;return!s||g>=s.length?(o.target=void 0,i5(void 0,!0)):i5(d=="keys"?g:d=="values"?s[g]:[g,s[g]],!1)},"values"),n5.Arguments=n5.Array;var ztt=m0,_1=function(o,s,d){return ztt.f(o,s,d)},Ytt=UT,Jtt=_1,Xtt=OE,s5=RS("species"),Qtt=_d,Ztt=TypeError,xM=function(o,s){if(Qtt(s,o))return o;throw Ztt("Incorrect invocation")},$tt=gE,UM=QL,tet=_h(Function.toString);$tt(UM.inspectSource)||(UM.inspectSource=function(o){return tet(o)});var a5=UM.inspectSource,eet=_h,net=_t,c5=gE,ret=iR,iet=a5,u5=function(){},oet=[],l5=UT("Reflect","construct"),jM=/^\s*(?:class|function)\b/,set=eet(jM.exec),aet=!jM.exec(u5),MN=function(o){if(!c5(o))return!1;try{return l5(u5,oet,o),!0}catch{return!1}},d5=function(o){if(!c5(o))return!1;switch(ret(o)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return aet||!!set(jM,iet(o))}catch{return!0}};d5.sham=!0;var xN,SO,h5,VM,v1=!l5||net(function(){var o;return MN(MN.call)||!MN(Object)||!MN(function(){o=!0})||o})?d5:MN,cet=v1,uet=fO,det=TypeError,p5=AT,het=function(o){if(cet(o))return o;throw det(uet(o)+" is not a constructor")},pet=HR,fet=RS("species"),FM=function(o,s){var d,g=p5(o).constructor;return g===void 0||pet(d=p5(g)[fet])?s:het(d)},BM=_h([].slice),met=TypeError,y1=function(o,s){if(o<s)throw met("Not enough arguments");return o},f5=/(?:ipad|iphone|ipod).*applewebkit/i.test(II),r0=aE,Eet=dE,get=KR,m5=gE,_et=iT,E5=_t,g5=R6,vet=BM,_5=eM,yet=y1,Tet=f5,bet=NN,GM=r0.setImmediate,WM=r0.clearImmediate,Ret=r0.process,qM=r0.Dispatch,Cet=r0.Function,v5=r0.MessageChannel,wet=r0.String,HM=0,UN={},y5="onreadystatechange";E5(function(){xN=r0.location});var KM=function(o){if(_et(UN,o)){var s=UN[o];delete UN[o],s()}},zM=function(o){return function(){KM(o)}},S5=function(o){KM(o.data)},T5=function(o){r0.postMessage(wet(o),xN.protocol+"//"+xN.host)};GM&&WM||(GM=function(o){yet(arguments.length,1);var s=m5(o)?o:Cet(o),d=vet(arguments,1);return UN[++HM]=function(){Eet(s,void 0,d)},SO(HM),HM},WM=function(o){delete UN[o]},bet?SO=function(o){Ret.nextTick(zM(o))}:qM&&qM.now?SO=function(o){qM.now(zM(o))}:v5&&!Tet?(VM=(h5=new v5).port2,h5.port1.onmessage=S5,SO=get(VM.postMessage,VM)):r0.addEventListener&&m5(r0.postMessage)&&!r0.importScripts&&xN&&xN.protocol!=="file:"&&!E5(T5)?(SO=T5,r0.addEventListener("message",S5,!1)):SO=y5 in _5("script")?function(o){g5.appendChild(_5("script"))[y5]=function(){g5.removeChild(this),KM(o)}}:function(o){setTimeout(zM(o),0)});var b5={set:GM,clear:WM},R5=function(){this.head=null,this.tail=null};R5.prototype={add:function(o){var s={item:o,next:null},d=this.tail;d?d.next=s:this.head=s,this.tail=s},get:function(){var o=this.head;if(o)return(this.head=o.next)===null&&(this.tail=null),o.item}};var TO,YM,JM,XM,C5,w5=R5,Iet=/ipad|iphone|ipod/i.test(II)&&typeof Pebble<"u",Oet=/web0s(?!.*chrome)/i.test(II),DI=aE,I5=KR,Aet=RE.f,QM=b5.set,Net=w5,ket=f5,Pet=Iet,Det=Oet,ZM=NN,O5=DI.MutationObserver||DI.WebKitMutationObserver,A5=DI.document,N5=DI.process,S1=DI.Promise,k5=Aet(DI,"queueMicrotask"),$M=k5&&k5.value;if(!$M){var T1=new Net,b1=function(){var o,s;for(ZM&&(o=N5.domain)&&o.exit();s=T1.get();)try{s()}catch(d){throw T1.head&&TO(),d}o&&o.enter()};ket||ZM||Det||!O5||!A5?!Pet&&S1&&S1.resolve?((XM=S1.resolve(void 0)).constructor=S1,C5=I5(XM.then,XM),TO=function(){C5(b1)}):ZM?TO=function(){N5.nextTick(b1)}:(QM=I5(QM,DI),TO=function(){QM(b1)}):(YM=!0,JM=A5.createTextNode(""),new O5(b1).observe(JM,{characterData:!0}),TO=function(){JM.data=YM=!YM}),$M=function(o){T1.head||TO(),T1.add(o)}}var Let=$M,bO=function(o){try{return{error:!1,value:o()}}catch(s){return{error:!0,value:s}}},LI=aE.Promise,P5=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Met=!P5&&!NN&&typeof window=="object"&&typeof document=="object",xet=aE,jN=LI,Uet=gE,jet=e6,Vet=a5,Fet=RS,Bet=Met,Get=P5,_x=OI,D5=jN&&jN.prototype,Wet=Fet("species"),L5=!1,M5=Uet(xet.PromiseRejectionEvent),qet=jet("Promise",function(){var o=Vet(jN),s=o!==String(jN);if(!s&&_x===66||!D5.catch||!D5.finally)return!0;if(!_x||_x<51||!/native code/.test(o)){var d=new jN(function(b){b(1)}),g=function(b){b(function(){},function(){})};if((d.constructor={})[Wet]=g,!(L5=d.then(function(){})instanceof g))return!0}return!s&&(Bet||Get)&&!M5}),VN={CONSTRUCTOR:qet,REJECTION_EVENT:M5,SUBCLASSING:L5},sR={},x5=f0,Het=TypeError,Ket=function(o){var s,d;this.promise=new o(function(g,b){if(s!==void 0||d!==void 0)throw Het("Bad Promise constructor");s=g,d=b}),this.resolve=x5(s),this.reject=x5(d)};sR.f=function(o){return new Ket(o)};var tU,U5,zet=X_,R1=NN,XR=aE,FN=jE,Yet=YR,Jet=JR,Xet=function(o){var s=Ytt(o);Xtt&&s&&!s[s5]&&Jtt(s,s5,{configurable:!0,get:function(){return this}})},Qet=f0,eU=gE,Zet=OT,$et=xM,tnt=FM,j5=b5.set,nU=Let,ent=function(o,s){try{arguments.length==1?console.error(o):console.error(o,s)}catch{}},nnt=bO,rnt=w5,V5=PI,rU=LI,F5=VN,B5=sR,C1="Promise",G5=F5.CONSTRUCTOR,int=F5.REJECTION_EVENT,iU=V5.getterFor(C1),ont=V5.set,snt=rU&&rU.prototype,BN=rU,oU=snt,W5=XR.TypeError,sU=XR.document,aU=XR.process,cU=B5.f,ant=cU,cnt=!!(sU&&sU.createEvent&&XR.dispatchEvent),q5="unhandledrejection",H5=function(o){var s;return!(!Zet(o)||!eU(s=o.then))&&s},K5=function(o,s){var d,g,b,$=s.value,Vt=s.state==1,zt=Vt?o.ok:o.fail,_e=o.resolve,_r=o.reject,_o=o.domain;try{zt?(Vt||(s.rejection===2&&lnt(s),s.rejection=1),zt===!0?d=$:(_o&&_o.enter(),d=zt($),_o&&(_o.exit(),b=!0)),d===o.promise?_r(W5("Promise-chain cycle")):(g=H5(d))?FN(g,d,_e,_r):_e(d)):_r($)}catch(ga){_o&&!b&&_o.exit(),_r(ga)}},z5=function(o,s){o.notified||(o.notified=!0,nU(function(){for(var d,g=o.reactions;d=g.get();)K5(d,o);o.notified=!1,s&&!o.rejection&&unt(o)}))},Y5=function(o,s,d){var g,b;cnt?((g=sU.createEvent("Event")).promise=s,g.reason=d,g.initEvent(o,!1,!0),XR.dispatchEvent(g)):g={promise:s,reason:d},!int&&(b=XR["on"+o])?b(g):o===q5&&ent("Unhandled promise rejection",d)},unt=function(o){FN(j5,XR,function(){var s,d=o.facade,g=o.value;if(J5(o)&&(s=nnt(function(){R1?aU.emit("unhandledRejection",g,d):Y5(q5,d,g)}),o.rejection=R1||J5(o)?2:1,s.error))throw s.value})},J5=function(o){return o.rejection!==1&&!o.parent},lnt=function(o){FN(j5,XR,function(){var s=o.facade;R1?aU.emit("rejectionHandled",s):Y5("rejectionhandled",s,o.value)})},RO=function(o,s,d){return function(g){o(s,g,d)}},CO=function(o,s,d){o.done||(o.done=!0,d&&(o=d),o.value=s,o.state=2,z5(o,!0))},uU=function(o,s,d){if(!o.done){o.done=!0,d&&(o=d);try{if(o.facade===s)throw W5("Promise can't be resolved itself");var g=H5(s);g?nU(function(){var b={done:!1};try{FN(g,s,RO(uU,b,o),RO(CO,b,o))}catch($){CO(b,$,o)}}):(o.value=s,o.state=1,z5(o,!1))}catch(b){CO({done:!1},b,o)}}};G5&&(oU=(BN=function(o){$et(this,oU),Qet(o),FN(tU,this);var s=iU(this);try{o(RO(uU,s),RO(CO,s))}catch(d){CO(s,d)}}).prototype,(tU=function(o){ont(this,{type:C1,done:!1,notified:!1,parent:!1,reactions:new rnt,rejection:!1,state:0,value:void 0})}).prototype=Yet(oU,"then",function(o,s){var d=iU(this),g=cU(tnt(this,BN));return d.parent=!0,g.ok=!eU(o)||o,g.fail=eU(s)&&s,g.domain=R1?aU.domain:void 0,d.state==0?d.reactions.add(g):nU(function(){K5(g,d)}),g.promise}),U5=function(){var o=new tU,s=iU(o);this.promise=o,this.resolve=RO(uU,s),this.reject=RO(CO,s)},B5.f=cU=function(o){return o===BN||o===void 0?new U5(o):ant(o)}),zet({global:!0,constructor:!0,wrap:!0,forced:G5},{Promise:BN}),Jet(BN,C1,!1,!0),Xet(C1);var X5=RS("iterator"),Q5=!1;try{var dnt=0,Z5={next:function(){return{done:!!dnt++}},return:function(){Q5=!0}};Z5[X5]=function(){return this},Array.from(Z5,function(){throw 2})}catch{}var hnt=LI,pnt=function(o,s){if(!Q5)return!1;var d=!1;try{var g={};g[X5]=function(){return{next:function(){return{done:d=!0}}}},o(g)}catch{}return d},w1=VN.CONSTRUCTOR||!pnt(function(o){hnt.all(o).then(void 0,function(){})}),fnt=jE,mnt=f0,Ent=sR,gnt=bO,_nt=DN;X_({target:"Promise",stat:!0,forced:w1},{all:function(o){var s=this,d=Ent.f(s),g=d.resolve,b=d.reject,$=gnt(function(){var Vt=mnt(s.resolve),zt=[],_e=0,_r=1;_nt(o,function(_o){var ga=_e++,_a=!1;_r++,fnt(Vt,s,_o).then(function(_c){_a||(_a=!0,zt[ga]=_c,--_r||g(zt))},b)}),--_r||g(zt)});return $.error&&b($.value),d.promise}});var vnt=X_,ynt=VN.CONSTRUCTOR;LI&&LI.prototype,vnt({target:"Promise",proto:!0,forced:ynt,real:!0},{catch:function(o){return this.then(void 0,o)}});var Snt=jE,Tnt=f0,bnt=sR,Rnt=bO,Cnt=DN;X_({target:"Promise",stat:!0,forced:w1},{race:function(o){var s=this,d=bnt.f(s),g=d.reject,b=Rnt(function(){var $=Tnt(s.resolve);Cnt(o,function(Vt){Snt($,s,Vt).then(d.resolve,g)})});return b.error&&g(b.value),d.promise}});var wnt=jE,Int=sR;X_({target:"Promise",stat:!0,forced:VN.CONSTRUCTOR},{reject:function(o){var s=Int.f(this);return wnt(s.reject,void 0,o),s.promise}});var Ont=AT,Ant=OT,Nnt=sR,$5=function(o,s){if(Ont(o),Ant(s)&&s.constructor===o)return s;var d=Nnt.f(o);return(0,d.resolve)(s),d.promise},knt=X_,Pnt=LI,Dnt=VN.CONSTRUCTOR,Lnt=$5,Mnt=UT("Promise"),xnt=!Dnt;knt({target:"Promise",stat:!0,forced:!0},{resolve:function(o){return Lnt(xnt&&this===Mnt?Pnt:this,o)}});var Unt=jE,jnt=f0,Vnt=sR,Fnt=bO,Bnt=DN;X_({target:"Promise",stat:!0,forced:w1},{allSettled:function(o){var s=this,d=Vnt.f(s),g=d.resolve,b=d.reject,$=Fnt(function(){var Vt=jnt(s.resolve),zt=[],_e=0,_r=1;Bnt(o,function(_o){var ga=_e++,_a=!1;_r++,Unt(Vt,s,_o).then(function(_c){_a||(_a=!0,zt[ga]={status:"fulfilled",value:_c},--_r||g(zt))},function(_c){_a||(_a=!0,zt[ga]={status:"rejected",reason:_c},--_r||g(zt))})}),--_r||g(zt)});return $.error&&b($.value),d.promise}});var Gnt=jE,Wnt=f0,qnt=UT,Hnt=sR,Knt=bO,znt=DN,tW="No one promise resolved";X_({target:"Promise",stat:!0,forced:w1},{any:function(o){var s=this,d=qnt("AggregateError"),g=Hnt.f(s),b=g.resolve,$=g.reject,Vt=Knt(function(){var zt=Wnt(s.resolve),_e=[],_r=0,_o=1,ga=!1;znt(o,function(_a){var _c=_r++,tE=!1;_o++,Gnt(zt,s,_a).then(function(_p){tE||ga||(ga=!0,b(_p))},function(_p){tE||ga||(tE=!0,_e[_c]=_p,--_o||$(new d(_e,tW)))})}),--_o||$(new d(_e,tW))});return Vt.error&&$(Vt.value),g.promise}});var Ynt=X_,lU=LI,Jnt=_t,Xnt=UT,Qnt=gE,Znt=FM,eW=$5,$nt=lU&&lU.prototype;Ynt({target:"Promise",proto:!0,real:!0,forced:!!lU&&Jnt(function(){$nt.finally.call({then:function(){}},function(){})})},{finally:function(o){var s=Znt(this,Xnt("Promise")),d=Qnt(o);return this.then(d?function(g){return eW(s,o()).then(function(){return g})}:o,d?function(g){return eW(s,o()).then(function(){throw g})}:o)}});var dU=_h,trt=sM,ert=n0,nrt=sS,rrt=dU("".charAt),nW=dU("".charCodeAt),irt=dU("".slice),rW=function(o){return function(s,d){var g,b,$=ert(nrt(s)),Vt=trt(d),zt=$.length;return Vt<0||Vt>=zt?o?"":void 0:(g=nW($,Vt))<55296||g>56319||Vt+1===zt||(b=nW($,Vt+1))<56320||b>57343?o?rrt($,Vt):g:o?irt($,Vt,Vt+2):b-56320+(g-55296<<10)+65536}},hU={codeAt:rW(!1),charAt:rW(!0)},ort=hU.charAt,srt=n0,iW=PI,art=e5,oW=MM,sW="String Iterator",crt=iW.set,urt=iW.getterFor(sW);art(String,"String",function(o){crt(this,{type:sW,string:srt(o),index:0})},function(){var o,s=urt(this),d=s.string,g=s.index;return g>=d.length?oW(void 0,!0):(o=ort(d,g),s.index+=o.length,oW(o,!1))});var lrt=V0.Promise,drt={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},hrt=aE,prt=iR,frt=zR,aW=NI,cW=RS("toStringTag");for(var pU in drt){var uW=hrt[pU],fU=uW&&uW.prototype;fU&&prt(fU)!==cW&&frt(fU,cW,pU),aW[pU]=aW.Array}var lW=lrt,GE=j(lW);const dW=m6;function hW(o,s){const d=o&&o.navigator;if(!d.mediaDevices)return;const g=function(Vt){if(typeof Vt!="object"||Vt.mandatory||Vt.optional)return Vt;const zt={};return Object.keys(Vt).forEach(_e=>{if(_e==="require"||_e==="advanced"||_e==="mediaSource")return;const _r=typeof Vt[_e]=="object"?Vt[_e]:{ideal:Vt[_e]};_r.exact!==void 0&&typeof _r.exact=="number"&&(_r.min=_r.max=_r.exact);const _o=function(ga,_a){return ga?ga+_a.charAt(0).toUpperCase()+_a.slice(1):_a==="deviceId"?"sourceId":_a};if(_r.ideal!==void 0){zt.optional=zt.optional||[];let ga={};typeof _r.ideal=="number"?(ga[_o("min",_e)]=_r.ideal,zt.optional.push(ga),ga={},ga[_o("max",_e)]=_r.ideal,zt.optional.push(ga)):(ga[_o("",_e)]=_r.ideal,zt.optional.push(ga))}_r.exact!==void 0&&typeof _r.exact!="number"?(zt.mandatory=zt.mandatory||{},zt.mandatory[_o("",_e)]=_r.exact):["min","max"].forEach(ga=>{_r[ga]!==void 0&&(zt.mandatory=zt.mandatory||{},zt.mandatory[_o(ga,_e)]=_r[ga])})}),Vt.advanced&&(zt.optional=(zt.optional||[]).concat(Vt.advanced)),zt},b=function(Vt,zt){if(s.version>=61)return zt(Vt);if((Vt=JSON.parse(JSON.stringify(Vt)))&&typeof Vt.audio=="object"){const _e=function(_r,_o,ga){_o in _r&&!(ga in _r)&&(_r[ga]=_r[_o],delete _r[_o])};_e((Vt=JSON.parse(JSON.stringify(Vt))).audio,"autoGainControl","googAutoGainControl"),_e(Vt.audio,"noiseSuppression","googNoiseSuppression"),Vt.audio=g(Vt.audio)}if(Vt&&typeof Vt.video=="object"){let _e=Vt.video.facingMode;_e=_e&&(typeof _e=="object"?_e:{ideal:_e});const _r=s.version<66;if(_e&&(_e.exact==="user"||_e.exact==="environment"||_e.ideal==="user"||_e.ideal==="environment")&&(!d.mediaDevices.getSupportedConstraints||!d.mediaDevices.getSupportedConstraints().facingMode||_r)){let _o;if(delete Vt.video.facingMode,_e.exact==="environment"||_e.ideal==="environment"?_o=["back","rear"]:_e.exact!=="user"&&_e.ideal!=="user"||(_o=["front"]),_o)return d.mediaDevices.enumerateDevices().then(ga=>{let _a=(ga=ga.filter(_c=>_c.kind==="videoinput")).find(_c=>_o.some(tE=>{var _p;return KE(_p=_c.label.toLowerCase()).call(_p,tE)}));return!_a&&ga.length&&KE(_o).call(_o,"back")&&(_a=ga[ga.length-1]),_a&&(Vt.video.deviceId=_e.exact?{exact:_a.deviceId}:{ideal:_a.deviceId}),Vt.video=g(Vt.video),dW("chrome: "+JSON.stringify(Vt)),zt(Vt)})}Vt.video=g(Vt.video)}return dW("chrome: "+JSON.stringify(Vt)),zt(Vt)},$=function(Vt){return s.version>=64?Vt:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[Vt.name]||Vt.name,message:Vt.message,constraint:Vt.constraint||Vt.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(d.getUserMedia=(function(Vt,zt,_e){b(Vt,_r=>{d.webkitGetUserMedia(_r,zt,_o=>{_e&&_e($(_o))})})}).bind(d),d.mediaDevices.getUserMedia){const Vt=d.mediaDevices.getUserMedia.bind(d.mediaDevices);d.mediaDevices.getUserMedia=function(zt){return b(zt,_e=>Vt(_e).then(_r=>{if(_e.audio&&!_r.getAudioTracks().length||_e.video&&!_r.getVideoTracks().length)throw _r.getTracks().forEach(_o=>{_o.stop()}),new DOMException("","NotFoundError");return _r},_r=>GE.reject($(_r))))}}}function pW(o){o.MediaStream=o.MediaStream||o.webkitMediaStream}function fW(o){if(typeof o=="object"&&o.RTCPeerConnection&&!("ontrack"in o.RTCPeerConnection.prototype)){Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(d){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=d)},enumerable:!0,configurable:!0});const s=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=d=>{d.stream.addEventListener("addtrack",g=>{let b;b=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(Vt=>Vt.track&&Vt.track.id===g.track.id):{track:g.track};const $=new Event("track");$.track=g.track,$.receiver=b,$.transceiver={receiver:b},$.streams=[d.stream],this.dispatchEvent($)}),d.stream.getTracks().forEach(g=>{let b;b=o.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(Vt=>Vt.track&&Vt.track.id===g.id):{track:g};const $=new Event("track");$.track=g,$.receiver=b,$.transceiver={receiver:b},$.streams=[d.stream],this.dispatchEvent($)})},this.addEventListener("addstream",this._ontrackpoly)),s.apply(this,arguments)}}else AI(o,"track",s=>(s.transceiver||Object.defineProperty(s,"transceiver",{value:{receiver:s.receiver}}),s))}function mW(o){if(typeof o=="object"&&o.RTCPeerConnection&&!("getSenders"in o.RTCPeerConnection.prototype)&&"createDTMFSender"in o.RTCPeerConnection.prototype){const s=function(b,$){return{track:$,get dtmf(){return this._dtmf===void 0&&($.kind==="audio"?this._dtmf=b.createDTMFSender($):this._dtmf=null),this._dtmf},_pc:b}};if(!o.RTCPeerConnection.prototype.getSenders){o.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const b=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function(Vt,zt){let _e=b.apply(this,arguments);return _e||(_e=s(this,Vt),this._senders.push(_e)),_e};const $=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function(Vt){$.apply(this,arguments);const zt=this._senders.indexOf(Vt);zt!==-1&&this._senders.splice(zt,1)}}const d=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(b){this._senders=this._senders||[],d.apply(this,[b]),b.getTracks().forEach($=>{this._senders.push(s(this,$))})};const g=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function(b){this._senders=this._senders||[],g.apply(this,[b]),b.getTracks().forEach($=>{const Vt=this._senders.find(zt=>zt.track===$);Vt&&this._senders.splice(this._senders.indexOf(Vt),1)})}}else if(typeof o=="object"&&o.RTCPeerConnection&&"getSenders"in o.RTCPeerConnection.prototype&&"createDTMFSender"in o.RTCPeerConnection.prototype&&o.RTCRtpSender&&!("dtmf"in o.RTCRtpSender.prototype)){const s=o.RTCPeerConnection.prototype.getSenders;o.RTCPeerConnection.prototype.getSenders=function(){const d=s.apply(this,[]);return d.forEach(g=>g._pc=this),d},Object.defineProperty(o.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function EW(o){if(!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[d,g,b]=arguments;if(arguments.length>0&&typeof d=="function")return s.apply(this,arguments);if(s.length===0&&(arguments.length===0||typeof d!="function"))return s.apply(this,[]);const $=function(zt){const _e={};return zt.result().forEach(_r=>{const _o={id:_r.id,timestamp:_r.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[_r.type]||_r.type};_r.names().forEach(ga=>{_o[ga]=_r.stat(ga)}),_e[_o.id]=_o}),_e},Vt=function(zt){return new Map(Object.keys(zt).map(_e=>[_e,zt[_e]]))};if(arguments.length>=2){const zt=function(_e){g(Vt($(_e)))};return s.apply(this,[zt,d])}return new GE((zt,_e)=>{s.apply(this,[function(_r){zt(Vt($(_r)))},_e])}).then(g,b)}}function gW(o){if(!(typeof o=="object"&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){const d=o.RTCPeerConnection.prototype.getSenders;d&&(o.RTCPeerConnection.prototype.getSenders=function(){const b=d.apply(this,[]);return b.forEach($=>$._pc=this),b});const g=o.RTCPeerConnection.prototype.addTrack;g&&(o.RTCPeerConnection.prototype.addTrack=function(){const b=g.apply(this,arguments);return b._pc=this,b}),o.RTCRtpSender.prototype.getStats=function(){const b=this;return this._pc.getStats().then($=>_6($,b.track,!0))}}if(!("getStats"in o.RTCRtpReceiver.prototype)){const d=o.RTCPeerConnection.prototype.getReceivers;d&&(o.RTCPeerConnection.prototype.getReceivers=function(){const g=d.apply(this,[]);return g.forEach(b=>b._pc=this),g}),AI(o,"track",g=>(g.receiver._pc=g.srcElement,g)),o.RTCRtpReceiver.prototype.getStats=function(){const g=this;return this._pc.getStats().then(b=>_6(b,g.track,!1))}}if(!("getStats"in o.RTCRtpSender.prototype)||!("getStats"in o.RTCRtpReceiver.prototype))return;const s=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof o.MediaStreamTrack){const d=arguments[0];let g,b,$;return this.getSenders().forEach(Vt=>{Vt.track===d&&(g?$=!0:g=Vt)}),this.getReceivers().forEach(Vt=>(Vt.track===d&&(b?$=!0:b=Vt),Vt.track===d)),$||g&&b?GE.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):g?g.getStats():b?b.getStats():GE.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}function _W(o){o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map($=>this._shimmedLocalStreams[$][0])};const s=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addTrack=function($,Vt){if(!Vt)return s.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const zt=s.apply(this,arguments);return this._shimmedLocalStreams[Vt.id]?this._shimmedLocalStreams[Vt.id].indexOf(zt)===-1&&this._shimmedLocalStreams[Vt.id].push(zt):this._shimmedLocalStreams[Vt.id]=[Vt,zt],zt};const d=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function($){this._shimmedLocalStreams=this._shimmedLocalStreams||{},$.getTracks().forEach(_e=>{if(this.getSenders().find(_o=>_o.track===_e))throw new DOMException("Track already exists.","InvalidAccessError")});const Vt=this.getSenders();d.apply(this,arguments);const zt=this.getSenders().filter(_e=>Vt.indexOf(_e)===-1);this._shimmedLocalStreams[$.id]=[$].concat(zt)};const g=o.RTCPeerConnection.prototype.removeStream;o.RTCPeerConnection.prototype.removeStream=function($){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[$.id],g.apply(this,arguments)};const b=o.RTCPeerConnection.prototype.removeTrack;o.RTCPeerConnection.prototype.removeTrack=function($){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},$&&Object.keys(this._shimmedLocalStreams).forEach(Vt=>{const zt=this._shimmedLocalStreams[Vt].indexOf($);zt!==-1&&this._shimmedLocalStreams[Vt].splice(zt,1),this._shimmedLocalStreams[Vt].length===1&&delete this._shimmedLocalStreams[Vt]}),b.apply(this,arguments)}}function vW(o,s){if(!o.RTCPeerConnection)return;if(o.RTCPeerConnection.prototype.addTrack&&s.version>=65)return _W(o);const d=o.RTCPeerConnection.prototype.getLocalStreams;o.RTCPeerConnection.prototype.getLocalStreams=function(){const _e=d.apply(this);return this._reverseStreams=this._reverseStreams||{},_e.map(_r=>this._reverseStreams[_r.id])};const g=o.RTCPeerConnection.prototype.addStream;o.RTCPeerConnection.prototype.addStream=function(_e){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_e.getTracks().forEach(_r=>{if(this.getSenders().find(ga=>ga.track===_r))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_e.id]){const _r=new o.MediaStream(_e.getTracks());this._streams[_e.id]=_r,this._reverseStreams[_r.id]=_e,_e=_r}g.apply(this,[_e])};const b=o.RTCPeerConnection.prototype.removeStream;function $(_e,_r){let _o=_r.sdp;return Object.keys(_e._reverseStreams||[]).forEach(ga=>{const _a=_e._reverseStreams[ga],_c=_e._streams[_a.id];_o=_o.replace(new RegExp(_c.id,"g"),_a.id)}),new RTCSessionDescription({type:_r.type,sdp:_o})}o.RTCPeerConnection.prototype.removeStream=function(_e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},b.apply(this,[this._streams[_e.id]||_e]),delete this._reverseStreams[this._streams[_e.id]?this._streams[_e.id].id:_e.id],delete this._streams[_e.id]},o.RTCPeerConnection.prototype.addTrack=function(_e,_r){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const _o=[].slice.call(arguments,1);if(_o.length!==1||!_o[0].getTracks().find(_c=>_c===_e))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(_c=>_c.track===_e))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _a=this._streams[_r.id];if(_a)_a.addTrack(_e),GE.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const _c=new o.MediaStream([_e]);this._streams[_r.id]=_c,this._reverseStreams[_c.id]=_r,this.addStream(_c)}return this.getSenders().find(_c=>_c.track===_e)},["createOffer","createAnswer"].forEach(function(_e){const _r=o.RTCPeerConnection.prototype[_e],_o={[_e](){const ga=arguments;return arguments.length&&typeof arguments[0]=="function"?_r.apply(this,[_a=>{const _c=$(this,_a);ga[0].apply(null,[_c])},_a=>{ga[1]&&ga[1].apply(null,_a)},arguments[2]]):_r.apply(this,arguments).then(_a=>$(this,_a))}};o.RTCPeerConnection.prototype[_e]=_o[_e]});const Vt=o.RTCPeerConnection.prototype.setLocalDescription;o.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_e,_r){let _o=_r.sdp;return Object.keys(_e._reverseStreams||[]).forEach(ga=>{const _a=_e._reverseStreams[ga],_c=_e._streams[_a.id];_o=_o.replace(new RegExp(_a.id,"g"),_c.id)}),new RTCSessionDescription({type:_r.type,sdp:_o})}(this,arguments[0]),Vt.apply(this,arguments)):Vt.apply(this,arguments)};const zt=Object.getOwnPropertyDescriptor(o.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(o.RTCPeerConnection.prototype,"localDescription",{get(){const _e=zt.get.apply(this);return _e.type===""?_e:$(this,_e)}}),o.RTCPeerConnection.prototype.removeTrack=function(_e){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let _r;this._streams=this._streams||{},Object.keys(this._streams).forEach(_o=>{this._streams[_o].getTracks().find(ga=>_e.track===ga)&&(_r=this._streams[_o])}),_r&&(_r.getTracks().length===1?this.removeStream(this._reverseStreams[_r.id]):_r.removeTrack(_e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function mU(o,s){!o.RTCPeerConnection&&o.webkitRTCPeerConnection&&(o.RTCPeerConnection=o.webkitRTCPeerConnection),o.RTCPeerConnection&&s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(d){const g=o.RTCPeerConnection.prototype[d],b={[d](){return arguments[0]=new(d==="addIceCandidate"?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),g.apply(this,arguments)}};o.RTCPeerConnection.prototype[d]=b[d]})}function yW(o,s){AI(o,"negotiationneeded",d=>{const g=d.target;if(!(s.version<72||g.getConfiguration&&g.getConfiguration().sdpSemantics==="plan-b")||g.signalingState==="stable")return d})}var SW=Object.freeze({__proto__:null,fixNegotiationNeeded:yW,shimAddTrackRemoveTrack:vW,shimAddTrackRemoveTrackWithNative:_W,shimGetDisplayMedia:function(o,s){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(typeof s=="function"?o.navigator.mediaDevices.getDisplayMedia=function(d){return s(d).then(g=>{const b=d.video&&d.video.width,$=d.video&&d.video.height,Vt=d.video&&d.video.frameRate;return d.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:g,maxFrameRate:Vt||3}},b&&(d.video.mandatory.maxWidth=b),$&&(d.video.mandatory.maxHeight=$),o.navigator.mediaDevices.getUserMedia(d)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:mW,shimGetStats:EW,shimGetUserMedia:hW,shimMediaStream:pW,shimOnTrack:fW,shimPeerConnection:mU,shimSenderReceiverGetStats:gW});function TW(o,s){const d=o&&o.navigator,g=o&&o.MediaStreamTrack;if(d.getUserMedia=function(b,$,Vt){pM("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),d.mediaDevices.getUserMedia(b).then($,Vt)},!(s.version>55&&"autoGainControl"in d.mediaDevices.getSupportedConstraints())){const b=function(Vt,zt,_e){zt in Vt&&!(_e in Vt)&&(Vt[_e]=Vt[zt],delete Vt[zt])},$=d.mediaDevices.getUserMedia.bind(d.mediaDevices);if(d.mediaDevices.getUserMedia=function(Vt){return typeof Vt=="object"&&typeof Vt.audio=="object"&&(Vt=JSON.parse(JSON.stringify(Vt)),b(Vt.audio,"autoGainControl","mozAutoGainControl"),b(Vt.audio,"noiseSuppression","mozNoiseSuppression")),$(Vt)},g&&g.prototype.getSettings){const Vt=g.prototype.getSettings;g.prototype.getSettings=function(){const zt=Vt.apply(this,arguments);return b(zt,"mozAutoGainControl","autoGainControl"),b(zt,"mozNoiseSuppression","noiseSuppression"),zt}}if(g&&g.prototype.applyConstraints){const Vt=g.prototype.applyConstraints;g.prototype.applyConstraints=function(zt){return this.kind==="audio"&&typeof zt=="object"&&(zt=JSON.parse(JSON.stringify(zt)),b(zt,"autoGainControl","mozAutoGainControl"),b(zt,"noiseSuppression","mozNoiseSuppression")),Vt.apply(this,[zt])}}}}function bW(o){typeof o=="object"&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function EU(o,s){if(typeof o!="object"||!o.RTCPeerConnection&&!o.mozRTCPeerConnection)return;!o.RTCPeerConnection&&o.mozRTCPeerConnection&&(o.RTCPeerConnection=o.mozRTCPeerConnection),s.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(b){const $=o.RTCPeerConnection.prototype[b],Vt={[b](){return arguments[0]=new(b==="addIceCandidate"?o.RTCIceCandidate:o.RTCSessionDescription)(arguments[0]),$.apply(this,arguments)}};o.RTCPeerConnection.prototype[b]=Vt[b]});const d={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},g=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(){const[b,$,Vt]=arguments;return g.apply(this,[b||null]).then(zt=>{if(s.version<53&&!$)try{zt.forEach(_e=>{_e.type=d[_e.type]||_e.type})}catch(_e){if(_e.name!=="TypeError")throw _e;zt.forEach((_r,_o)=>{zt.set(_o,Object.assign({},_r,{type:d[_r.type]||_r.type}))})}return zt}).then($,Vt)}}function RW(o){if(typeof o!="object"||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpSender.prototype)return;const s=o.RTCPeerConnection.prototype.getSenders;s&&(o.RTCPeerConnection.prototype.getSenders=function(){const g=s.apply(this,[]);return g.forEach(b=>b._pc=this),g});const d=o.RTCPeerConnection.prototype.addTrack;d&&(o.RTCPeerConnection.prototype.addTrack=function(){const g=d.apply(this,arguments);return g._pc=this,g}),o.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):GE.resolve(new Map)}}function CW(o){if(typeof o!="object"||!o.RTCPeerConnection||!o.RTCRtpSender||o.RTCRtpSender&&"getStats"in o.RTCRtpReceiver.prototype)return;const s=o.RTCPeerConnection.prototype.getReceivers;s&&(o.RTCPeerConnection.prototype.getReceivers=function(){const d=s.apply(this,[]);return d.forEach(g=>g._pc=this),d}),AI(o,"track",d=>(d.receiver._pc=d.srcElement,d)),o.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function wW(o){o.RTCPeerConnection&&!("removeStream"in o.RTCPeerConnection.prototype)&&(o.RTCPeerConnection.prototype.removeStream=function(s){pM("removeStream","removeTrack"),this.getSenders().forEach(d=>{var g;d.track&&KE(g=s.getTracks()).call(g,d.track)&&this.removeTrack(d)})})}function IW(o){o.DataChannel&&!o.RTCDataChannel&&(o.RTCDataChannel=o.DataChannel)}function OW(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype.addTransceiver;s&&(o.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let d=arguments[1]&&arguments[1].sendEncodings;d===void 0&&(d=[]),d=[...d];const g=d.length>0;g&&d.forEach($=>{if("rid"in $&&!/^[a-z0-9]{0,16}$/i.test($.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in $&&!(parseFloat($.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in $&&!(parseFloat($.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const b=s.apply(this,arguments);if(g){const{sender:$}=b,Vt=$.getParameters();(!("encodings"in Vt)||Vt.encodings.length===1&&Object.keys(Vt.encodings[0]).length===0)&&(Vt.encodings=d,$.sendEncodings=d,this.setParametersPromises.push($.setParameters(Vt).then(()=>{delete $.sendEncodings}).catch(()=>{delete $.sendEncodings})))}return b})}function AW(o){if(typeof o!="object"||!o.RTCRtpSender)return;const s=o.RTCRtpSender.prototype.getParameters;s&&(o.RTCRtpSender.prototype.getParameters=function(){const d=s.apply(this,arguments);return"encodings"in d||(d.encodings=[].concat(this.sendEncodings||[{}])),d})}function NW(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?GE.all(this.setParametersPromises).then(()=>s.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):s.apply(this,arguments)}}function kW(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype.createAnswer;o.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?GE.all(this.setParametersPromises).then(()=>s.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):s.apply(this,arguments)}}var PW=Object.freeze({__proto__:null,shimAddTransceiver:OW,shimCreateAnswer:kW,shimCreateOffer:NW,shimGetDisplayMedia:function(o,s){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&(o.navigator.mediaDevices.getDisplayMedia=function(d){if(!d||!d.video){const g=new DOMException("getDisplayMedia without video constraints is undefined");return g.name="NotFoundError",g.code=8,GE.reject(g)}return d.video===!0?d.video={mediaSource:s}:d.video.mediaSource=s,o.navigator.mediaDevices.getUserMedia(d)})},shimGetParameters:AW,shimGetUserMedia:TW,shimOnTrack:bW,shimPeerConnection:EU,shimRTCDataChannel:IW,shimReceiverGetStats:CW,shimRemoveStream:wW,shimSenderGetStats:RW});function DW(o){if(typeof o=="object"&&o.RTCPeerConnection){if("getLocalStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in o.RTCPeerConnection.prototype)){const s=o.RTCPeerConnection.prototype.addTrack;o.RTCPeerConnection.prototype.addStream=function(d){var g;this._localStreams||(this._localStreams=[]),KE(g=this._localStreams).call(g,d)||this._localStreams.push(d),d.getAudioTracks().forEach(b=>s.call(this,b,d)),d.getVideoTracks().forEach(b=>s.call(this,b,d))},o.RTCPeerConnection.prototype.addTrack=function(d){for(var g=arguments.length,b=new Array(g>1?g-1:0),$=1;$<g;$++)b[$-1]=arguments[$];return b&&b.forEach(Vt=>{var zt;this._localStreams?KE(zt=this._localStreams).call(zt,Vt)||this._localStreams.push(Vt):this._localStreams=[Vt]}),s.apply(this,arguments)}}"removeStream"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.removeStream=function(s){this._localStreams||(this._localStreams=[]);const d=this._localStreams.indexOf(s);if(d===-1)return;this._localStreams.splice(d,1);const g=s.getTracks();this.getSenders().forEach(b=>{KE(g).call(g,b.track)&&this.removeTrack(b)})})}}function LW(o){if(typeof o=="object"&&o.RTCPeerConnection&&("getRemoteStreams"in o.RTCPeerConnection.prototype||(o.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in o.RTCPeerConnection.prototype))){Object.defineProperty(o.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(d){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=d),this.addEventListener("track",this._onaddstreampoly=g=>{g.streams.forEach(b=>{var $;if(this._remoteStreams||(this._remoteStreams=[]),KE($=this._remoteStreams).call($,b))return;this._remoteStreams.push(b);const Vt=new Event("addstream");Vt.stream=b,this.dispatchEvent(Vt)})})}});const s=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){const d=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(g){g.streams.forEach(b=>{if(d._remoteStreams||(d._remoteStreams=[]),d._remoteStreams.indexOf(b)>=0)return;d._remoteStreams.push(b);const $=new Event("addstream");$.stream=b,d.dispatchEvent($)})}),s.apply(d,arguments)}}}function MW(o){if(typeof o!="object"||!o.RTCPeerConnection)return;const s=o.RTCPeerConnection.prototype,d=s.createOffer,g=s.createAnswer,b=s.setLocalDescription,$=s.setRemoteDescription,Vt=s.addIceCandidate;s.createOffer=function(_e,_r){const _o=arguments.length>=2?arguments[2]:arguments[0],ga=d.apply(this,[_o]);return _r?(ga.then(_e,_r),GE.resolve()):ga},s.createAnswer=function(_e,_r){const _o=arguments.length>=2?arguments[2]:arguments[0],ga=g.apply(this,[_o]);return _r?(ga.then(_e,_r),GE.resolve()):ga};let zt=function(_e,_r,_o){const ga=b.apply(this,[_e]);return _o?(ga.then(_r,_o),GE.resolve()):ga};s.setLocalDescription=zt,zt=function(_e,_r,_o){const ga=$.apply(this,[_e]);return _o?(ga.then(_r,_o),GE.resolve()):ga},s.setRemoteDescription=zt,zt=function(_e,_r,_o){const ga=Vt.apply(this,[_e]);return _o?(ga.then(_r,_o),GE.resolve()):ga},s.addIceCandidate=zt}function xW(o){const s=o&&o.navigator;if(s.mediaDevices&&s.mediaDevices.getUserMedia){const d=s.mediaDevices,g=d.getUserMedia.bind(d);s.mediaDevices.getUserMedia=b=>g(UW(b))}!s.getUserMedia&&s.mediaDevices&&s.mediaDevices.getUserMedia&&(s.getUserMedia=(function(d,g,b){s.mediaDevices.getUserMedia(d).then(g,b)}).bind(s))}function UW(o){return o&&o.video!==void 0?Object.assign({},o,{video:g6(o.video)}):o}function jW(o){if(!o.RTCPeerConnection)return;const s=o.RTCPeerConnection;o.RTCPeerConnection=function(d,g){if(d&&d.iceServers){const b=[];for(let $=0;$<d.iceServers.length;$++){let Vt=d.iceServers[$];!Vt.hasOwnProperty("urls")&&Vt.hasOwnProperty("url")?(pM("RTCIceServer.url","RTCIceServer.urls"),Vt=JSON.parse(JSON.stringify(Vt)),Vt.urls=Vt.url,delete Vt.url,b.push(Vt)):b.push(d.iceServers[$])}d.iceServers=b}return new s(d,g)},o.RTCPeerConnection.prototype=s.prototype,"generateCertificate"in s&&Object.defineProperty(o.RTCPeerConnection,"generateCertificate",{get:()=>s.generateCertificate})}function VW(o){typeof o=="object"&&o.RTCTrackEvent&&"receiver"in o.RTCTrackEvent.prototype&&!("transceiver"in o.RTCTrackEvent.prototype)&&Object.defineProperty(o.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function FW(o){const s=o.RTCPeerConnection.prototype.createOffer;o.RTCPeerConnection.prototype.createOffer=function(d){if(d){d.offerToReceiveAudio!==void 0&&(d.offerToReceiveAudio=!!d.offerToReceiveAudio);const g=this.getTransceivers().find($=>$.receiver.track.kind==="audio");d.offerToReceiveAudio===!1&&g?g.direction==="sendrecv"?g.setDirection?g.setDirection("sendonly"):g.direction="sendonly":g.direction==="recvonly"&&(g.setDirection?g.setDirection("inactive"):g.direction="inactive"):d.offerToReceiveAudio!==!0||g||this.addTransceiver("audio",{direction:"recvonly"}),d.offerToReceiveVideo!==void 0&&(d.offerToReceiveVideo=!!d.offerToReceiveVideo);const b=this.getTransceivers().find($=>$.receiver.track.kind==="video");d.offerToReceiveVideo===!1&&b?b.direction==="sendrecv"?b.setDirection?b.setDirection("sendonly"):b.direction="sendonly":b.direction==="recvonly"&&(b.setDirection?b.setDirection("inactive"):b.direction="inactive"):d.offerToReceiveVideo!==!0||b||this.addTransceiver("video",{direction:"recvonly"})}return s.apply(this,arguments)}}function BW(o){typeof o!="object"||o.AudioContext||(o.AudioContext=o.webkitAudioContext)}var GW=Object.freeze({__proto__:null,shimAudioContext:BW,shimCallbacksAPI:MW,shimConstraints:UW,shimCreateOfferLegacy:FW,shimGetUserMedia:xW,shimLocalStreamsAPI:DW,shimRTCIceServerUrls:jW,shimRemoteStreamsAPI:LW,shimTrackEventTransceiver:VW}),WW=`	
\v\f\r \u2028\u2029\uFEFF`,mrt=sS,Ert=n0,gU=WW,qW=_h("".replace),grt=RegExp("^["+gU+"]+"),_rt=RegExp("(^|[^"+gU+"])["+gU+"]+$"),_U=function(o){return function(s){var d=Ert(mrt(s));return 1&o&&(d=qW(d,grt,"")),2&o&&(d=qW(d,_rt,"$1")),d}},vrt={start:_U(1),end:_U(2),trim:_U(3)},yrt=K6.PROPER,Srt=_t,HW=WW,Trt=vrt.trim;X_({target:"String",proto:!0,forced:function(o){return Srt(function(){return!!HW[o]()||""[o]()!==""||yrt&&HW[o].name!==o})}("trim")},{trim:function(){return Trt(this)}});var brt=E0("String").trim,Rrt=_d,Crt=brt,vU=String.prototype,wrt=function(o){var s=o.trim;return typeof o=="string"||o===vU||Rrt(vU,o)&&s===vU.trim?Crt:s},dT=j(wrt),KW={exports:{}};(function(o){const s={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};s.localCName=s.generateIdentifier(),s.splitLines=function(d){return d.trim().split(`
`).map(g=>g.trim())},s.splitSections=function(d){return d.split(`
m=`).map((g,b)=>(b>0?"m="+g:g).trim()+`\r
`)},s.getDescription=function(d){const g=s.splitSections(d);return g&&g[0]},s.getMediaSections=function(d){const g=s.splitSections(d);return g.shift(),g},s.matchPrefix=function(d,g){return s.splitLines(d).filter(b=>b.indexOf(g)===0)},s.parseCandidate=function(d){let g;g=d.indexOf("a=candidate:")===0?d.substring(12).split(" "):d.substring(10).split(" ");const b={foundation:g[0],component:{1:"rtp",2:"rtcp"}[g[1]]||g[1],protocol:g[2].toLowerCase(),priority:parseInt(g[3],10),ip:g[4],address:g[4],port:parseInt(g[5],10),type:g[7]};for(let $=8;$<g.length;$+=2)switch(g[$]){case"raddr":b.relatedAddress=g[$+1];break;case"rport":b.relatedPort=parseInt(g[$+1],10);break;case"tcptype":b.tcpType=g[$+1];break;case"ufrag":b.ufrag=g[$+1],b.usernameFragment=g[$+1];break;default:b[g[$]]===void 0&&(b[g[$]]=g[$+1])}return b},s.writeCandidate=function(d){const g=[];g.push(d.foundation);const b=d.component;b==="rtp"?g.push(1):b==="rtcp"?g.push(2):g.push(b),g.push(d.protocol.toUpperCase()),g.push(d.priority),g.push(d.address||d.ip),g.push(d.port);const $=d.type;return g.push("typ"),g.push($),$!=="host"&&d.relatedAddress&&d.relatedPort&&(g.push("raddr"),g.push(d.relatedAddress),g.push("rport"),g.push(d.relatedPort)),d.tcpType&&d.protocol.toLowerCase()==="tcp"&&(g.push("tcptype"),g.push(d.tcpType)),(d.usernameFragment||d.ufrag)&&(g.push("ufrag"),g.push(d.usernameFragment||d.ufrag)),"candidate:"+g.join(" ")},s.parseIceOptions=function(d){return d.substring(14).split(" ")},s.parseRtpMap=function(d){let g=d.substring(9).split(" ");const b={payloadType:parseInt(g.shift(),10)};return g=g[0].split("/"),b.name=g[0],b.clockRate=parseInt(g[1],10),b.channels=g.length===3?parseInt(g[2],10):1,b.numChannels=b.channels,b},s.writeRtpMap=function(d){let g=d.payloadType;d.preferredPayloadType!==void 0&&(g=d.preferredPayloadType);const b=d.channels||d.numChannels||1;return"a=rtpmap:"+g+" "+d.name+"/"+d.clockRate+(b!==1?"/"+b:"")+`\r
`},s.parseExtmap=function(d){const g=d.substring(9).split(" ");return{id:parseInt(g[0],10),direction:g[0].indexOf("/")>0?g[0].split("/")[1]:"sendrecv",uri:g[1],attributes:g.slice(2).join(" ")}},s.writeExtmap=function(d){return"a=extmap:"+(d.id||d.preferredId)+(d.direction&&d.direction!=="sendrecv"?"/"+d.direction:"")+" "+d.uri+(d.attributes?" "+d.attributes:"")+`\r
`},s.parseFmtp=function(d){const g={};let b;const $=d.substring(d.indexOf(" ")+1).split(";");for(let Vt=0;Vt<$.length;Vt++)b=$[Vt].trim().split("="),g[b[0].trim()]=b[1];return g},s.writeFmtp=function(d){let g="",b=d.payloadType;if(d.preferredPayloadType!==void 0&&(b=d.preferredPayloadType),d.parameters&&Object.keys(d.parameters).length){const $=[];Object.keys(d.parameters).forEach(Vt=>{d.parameters[Vt]!==void 0?$.push(Vt+"="+d.parameters[Vt]):$.push(Vt)}),g+="a=fmtp:"+b+" "+$.join(";")+`\r
`}return g},s.parseRtcpFb=function(d){const g=d.substring(d.indexOf(" ")+1).split(" ");return{type:g.shift(),parameter:g.join(" ")}},s.writeRtcpFb=function(d){let g="",b=d.payloadType;return d.preferredPayloadType!==void 0&&(b=d.preferredPayloadType),d.rtcpFeedback&&d.rtcpFeedback.length&&d.rtcpFeedback.forEach($=>{g+="a=rtcp-fb:"+b+" "+$.type+($.parameter&&$.parameter.length?" "+$.parameter:"")+`\r
`}),g},s.parseSsrcMedia=function(d){const g=d.indexOf(" "),b={ssrc:parseInt(d.substring(7,g),10)},$=d.indexOf(":",g);return $>-1?(b.attribute=d.substring(g+1,$),b.value=d.substring($+1)):b.attribute=d.substring(g+1),b},s.parseSsrcGroup=function(d){const g=d.substring(13).split(" ");return{semantics:g.shift(),ssrcs:g.map(b=>parseInt(b,10))}},s.getMid=function(d){const g=s.matchPrefix(d,"a=mid:")[0];if(g)return g.substring(6)},s.parseFingerprint=function(d){const g=d.substring(14).split(" ");return{algorithm:g[0].toLowerCase(),value:g[1].toUpperCase()}},s.getDtlsParameters=function(d,g){return{role:"auto",fingerprints:s.matchPrefix(d+g,"a=fingerprint:").map(s.parseFingerprint)}},s.writeDtlsParameters=function(d,g){let b="a=setup:"+g+`\r
`;return d.fingerprints.forEach($=>{b+="a=fingerprint:"+$.algorithm+" "+$.value+`\r
`}),b},s.parseCryptoLine=function(d){const g=d.substring(9).split(" ");return{tag:parseInt(g[0],10),cryptoSuite:g[1],keyParams:g[2],sessionParams:g.slice(3)}},s.writeCryptoLine=function(d){return"a=crypto:"+d.tag+" "+d.cryptoSuite+" "+(typeof d.keyParams=="object"?s.writeCryptoKeyParams(d.keyParams):d.keyParams)+(d.sessionParams?" "+d.sessionParams.join(" "):"")+`\r
`},s.parseCryptoKeyParams=function(d){if(d.indexOf("inline:")!==0)return null;const g=d.substring(7).split("|");return{keyMethod:"inline",keySalt:g[0],lifeTime:g[1],mkiValue:g[2]?g[2].split(":")[0]:void 0,mkiLength:g[2]?g[2].split(":")[1]:void 0}},s.writeCryptoKeyParams=function(d){return d.keyMethod+":"+d.keySalt+(d.lifeTime?"|"+d.lifeTime:"")+(d.mkiValue&&d.mkiLength?"|"+d.mkiValue+":"+d.mkiLength:"")},s.getCryptoParameters=function(d,g){return s.matchPrefix(d+g,"a=crypto:").map(s.parseCryptoLine)},s.getIceParameters=function(d,g){const b=s.matchPrefix(d+g,"a=ice-ufrag:")[0],$=s.matchPrefix(d+g,"a=ice-pwd:")[0];return b&&$?{usernameFragment:b.substring(12),password:$.substring(10)}:null},s.writeIceParameters=function(d){let g="a=ice-ufrag:"+d.usernameFragment+`\r
a=ice-pwd:`+d.password+`\r
`;return d.iceLite&&(g+=`a=ice-lite\r
`),g},s.parseRtpParameters=function(d){const g={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},b=s.splitLines(d)[0].split(" ");g.profile=b[2];for(let Vt=3;Vt<b.length;Vt++){const zt=b[Vt],_e=s.matchPrefix(d,"a=rtpmap:"+zt+" ")[0];if(_e){const _r=s.parseRtpMap(_e),_o=s.matchPrefix(d,"a=fmtp:"+zt+" ");switch(_r.parameters=_o.length?s.parseFmtp(_o[0]):{},_r.rtcpFeedback=s.matchPrefix(d,"a=rtcp-fb:"+zt+" ").map(s.parseRtcpFb),g.codecs.push(_r),_r.name.toUpperCase()){case"RED":case"ULPFEC":g.fecMechanisms.push(_r.name.toUpperCase())}}}s.matchPrefix(d,"a=extmap:").forEach(Vt=>{g.headerExtensions.push(s.parseExtmap(Vt))});const $=s.matchPrefix(d,"a=rtcp-fb:* ").map(s.parseRtcpFb);return g.codecs.forEach(Vt=>{$.forEach(zt=>{Vt.rtcpFeedback.find(_e=>_e.type===zt.type&&_e.parameter===zt.parameter)||Vt.rtcpFeedback.push(zt)})}),g},s.writeRtpDescription=function(d,g){let b="";b+="m="+d+" ",b+=g.codecs.length>0?"9":"0",b+=" "+(g.profile||"UDP/TLS/RTP/SAVPF")+" ",b+=g.codecs.map(Vt=>Vt.preferredPayloadType!==void 0?Vt.preferredPayloadType:Vt.payloadType).join(" ")+`\r
`,b+=`c=IN IP4 0.0.0.0\r
`,b+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,g.codecs.forEach(Vt=>{b+=s.writeRtpMap(Vt),b+=s.writeFmtp(Vt),b+=s.writeRtcpFb(Vt)});let $=0;return g.codecs.forEach(Vt=>{Vt.maxptime>$&&($=Vt.maxptime)}),$>0&&(b+="a=maxptime:"+$+`\r
`),g.headerExtensions&&g.headerExtensions.forEach(Vt=>{b+=s.writeExtmap(Vt)}),b},s.parseRtpEncodingParameters=function(d){const g=[],b=s.parseRtpParameters(d),$=b.fecMechanisms.indexOf("RED")!==-1,Vt=b.fecMechanisms.indexOf("ULPFEC")!==-1,zt=s.matchPrefix(d,"a=ssrc:").map(_a=>s.parseSsrcMedia(_a)).filter(_a=>_a.attribute==="cname"),_e=zt.length>0&&zt[0].ssrc;let _r;const _o=s.matchPrefix(d,"a=ssrc-group:FID").map(_a=>_a.substring(17).split(" ").map(_c=>parseInt(_c,10)));_o.length>0&&_o[0].length>1&&_o[0][0]===_e&&(_r=_o[0][1]),b.codecs.forEach(_a=>{if(_a.name.toUpperCase()==="RTX"&&_a.parameters.apt){let _c={ssrc:_e,codecPayloadType:parseInt(_a.parameters.apt,10)};_e&&_r&&(_c.rtx={ssrc:_r}),g.push(_c),$&&(_c=JSON.parse(JSON.stringify(_c)),_c.fec={ssrc:_e,mechanism:Vt?"red+ulpfec":"red"},g.push(_c))}}),g.length===0&&_e&&g.push({ssrc:_e});let ga=s.matchPrefix(d,"b=");return ga.length&&(ga=ga[0].indexOf("b=TIAS:")===0?parseInt(ga[0].substring(7),10):ga[0].indexOf("b=AS:")===0?1e3*parseInt(ga[0].substring(5),10)*.95-16e3:void 0,g.forEach(_a=>{_a.maxBitrate=ga})),g},s.parseRtcpParameters=function(d){const g={},b=s.matchPrefix(d,"a=ssrc:").map(zt=>s.parseSsrcMedia(zt)).filter(zt=>zt.attribute==="cname")[0];b&&(g.cname=b.value,g.ssrc=b.ssrc);const $=s.matchPrefix(d,"a=rtcp-rsize");g.reducedSize=$.length>0,g.compound=$.length===0;const Vt=s.matchPrefix(d,"a=rtcp-mux");return g.mux=Vt.length>0,g},s.writeRtcpParameters=function(d){let g="";return d.reducedSize&&(g+=`a=rtcp-rsize\r
`),d.mux&&(g+=`a=rtcp-mux\r
`),d.ssrc!==void 0&&d.cname&&(g+="a=ssrc:"+d.ssrc+" cname:"+d.cname+`\r
`),g},s.parseMsid=function(d){let g;const b=s.matchPrefix(d,"a=msid:");if(b.length===1)return g=b[0].substring(7).split(" "),{stream:g[0],track:g[1]};const $=s.matchPrefix(d,"a=ssrc:").map(Vt=>s.parseSsrcMedia(Vt)).filter(Vt=>Vt.attribute==="msid");return $.length>0?(g=$[0].value.split(" "),{stream:g[0],track:g[1]}):void 0},s.parseSctpDescription=function(d){const g=s.parseMLine(d),b=s.matchPrefix(d,"a=max-message-size:");let $;b.length>0&&($=parseInt(b[0].substring(19),10)),isNaN($)&&($=65536);const Vt=s.matchPrefix(d,"a=sctp-port:");if(Vt.length>0)return{port:parseInt(Vt[0].substring(12),10),protocol:g.fmt,maxMessageSize:$};const zt=s.matchPrefix(d,"a=sctpmap:");if(zt.length>0){const _e=zt[0].substring(10).split(" ");return{port:parseInt(_e[0],10),protocol:_e[1],maxMessageSize:$}}},s.writeSctpDescription=function(d,g){let b=[];return b=d.protocol!=="DTLS/SCTP"?["m="+d.kind+" 9 "+d.protocol+" "+g.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+g.port+`\r
`]:["m="+d.kind+" 9 "+d.protocol+" "+g.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+g.port+" "+g.protocol+` 65535\r
`],g.maxMessageSize!==void 0&&b.push("a=max-message-size:"+g.maxMessageSize+`\r
`),b.join("")},s.generateSessionId=function(){return Math.random().toString().substr(2,22)},s.writeSessionBoilerplate=function(d,g,b){let $;const Vt=g!==void 0?g:2;return $=d||s.generateSessionId(),`v=0\r
o=`+(b||"thisisadapterortc")+" "+$+" "+Vt+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},s.getDirection=function(d,g){const b=s.splitLines(d);for(let $=0;$<b.length;$++)switch(b[$]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return b[$].substring(2)}return g?s.getDirection(g):"sendrecv"},s.getKind=function(d){return s.splitLines(d)[0].split(" ")[0].substring(2)},s.isRejected=function(d){return d.split(" ",2)[1]==="0"},s.parseMLine=function(d){const g=s.splitLines(d)[0].substring(2).split(" ");return{kind:g[0],port:parseInt(g[1],10),protocol:g[2],fmt:g.slice(3).join(" ")}},s.parseOLine=function(d){const g=s.matchPrefix(d,"o=")[0].substring(2).split(" ");return{username:g[0],sessionId:g[1],sessionVersion:parseInt(g[2],10),netType:g[3],addressType:g[4],address:g[5]}},s.isValidSDP=function(d){if(typeof d!="string"||d.length===0)return!1;const g=s.splitLines(d);for(let b=0;b<g.length;b++)if(g[b].length<2||g[b].charAt(1)!=="=")return!1;return!0},o.exports=s})(KW);var zW=KW.exports,wO=j(zW),Irt=h({__proto__:null,default:wO},[zW]);function I1(o){if(!o.RTCIceCandidate||o.RTCIceCandidate&&"foundation"in o.RTCIceCandidate.prototype)return;const s=o.RTCIceCandidate;o.RTCIceCandidate=function(d){if(typeof d=="object"&&d.candidate&&d.candidate.indexOf("a=")===0&&((d=JSON.parse(JSON.stringify(d))).candidate=d.candidate.substr(2)),d.candidate&&d.candidate.length){const g=new s(d),b=wO.parseCandidate(d.candidate),$=Object.assign(g,b);return $.toJSON=function(){return{candidate:$.candidate,sdpMid:$.sdpMid,sdpMLineIndex:$.sdpMLineIndex,usernameFragment:$.usernameFragment}},$}return new s(d)},o.RTCIceCandidate.prototype=s.prototype,AI(o,"icecandidate",d=>(d.candidate&&Object.defineProperty(d,"candidate",{value:new o.RTCIceCandidate(d.candidate),writable:"false"}),d))}function yU(o){!o.RTCIceCandidate||o.RTCIceCandidate&&"relayProtocol"in o.RTCIceCandidate.prototype||AI(o,"icecandidate",s=>{if(s.candidate){const d=wO.parseCandidate(s.candidate.candidate);d.type==="relay"&&(s.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[d.priority>>24])}return s})}function O1(o,s){if(!o.RTCPeerConnection)return;"sctp"in o.RTCPeerConnection.prototype||Object.defineProperty(o.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const d=function(zt){if(!zt||!zt.sdp)return!1;const _e=wO.splitSections(zt.sdp);return _e.shift(),_e.some(_r=>{const _o=wO.parseMLine(_r);return _o&&_o.kind==="application"&&_o.protocol.indexOf("SCTP")!==-1})},g=function(zt){const _e=zt.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_e===null||_e.length<2)return-1;const _r=parseInt(_e[1],10);return _r!=_r?-1:_r},b=function(zt){let _e=65536;return s.browser==="firefox"&&(_e=s.version<57?zt===-1?16384:2147483637:s.version<60?s.version===57?65535:65536:2147483637),_e},$=function(zt,_e){let _r=65536;s.browser==="firefox"&&s.version===57&&(_r=65535);const _o=wO.matchPrefix(zt.sdp,"a=max-message-size:");return _o.length>0?_r=parseInt(_o[0].substr(19),10):s.browser==="firefox"&&_e!==-1&&(_r=2147483637),_r},Vt=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,s.browser==="chrome"&&s.version>=76){const{sdpSemantics:zt}=this.getConfiguration();zt==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(d(arguments[0])){const zt=g(arguments[0]),_e=b(zt),_r=$(arguments[0],zt);let _o;_o=_e===0&&_r===0?Number.POSITIVE_INFINITY:_e===0||_r===0?Math.max(_e,_r):Math.min(_e,_r);const ga={};Object.defineProperty(ga,"maxMessageSize",{get:()=>_o}),this._sctp=ga}return Vt.apply(this,arguments)}}function A1(o){if(!o.RTCPeerConnection||!("createDataChannel"in o.RTCPeerConnection.prototype))return;function s(g,b){const $=g.send;g.send=function(){const Vt=arguments[0],zt=Vt.length||Vt.size||Vt.byteLength;if(g.readyState==="open"&&b.sctp&&zt>b.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+b.sctp.maxMessageSize+" bytes)");return $.apply(g,arguments)}}const d=o.RTCPeerConnection.prototype.createDataChannel;o.RTCPeerConnection.prototype.createDataChannel=function(){const g=d.apply(this,arguments);return s(g,this),g},AI(o,"datachannel",g=>(s(g.channel,g.target),g))}function SU(o){if(!o.RTCPeerConnection||"connectionState"in o.RTCPeerConnection.prototype)return;const s=o.RTCPeerConnection.prototype;Object.defineProperty(s,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(s,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(d){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),d&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=d)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(d=>{const g=s[d];s[d]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=b=>{const $=b.target;if($._lastConnectionState!==$.connectionState){$._lastConnectionState=$.connectionState;const Vt=new Event("connectionstatechange",b);$.dispatchEvent(Vt)}return b},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),g.apply(this,arguments)}})}function TU(o,s){if(!o.RTCPeerConnection||s.browser==="chrome"&&s.version>=71||s.browser==="safari"&&s.version>=605)return;const d=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(g){if(g&&g.sdp&&g.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const b=g.sdp.split(`
`).filter($=>dT($).call($)!=="a=extmap-allow-mixed").join(`
`);o.RTCSessionDescription&&g instanceof o.RTCSessionDescription?arguments[0]=new o.RTCSessionDescription({type:g.type,sdp:b}):g.sdp=b}return d.apply(this,arguments)}}function N1(o,s){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const d=o.RTCPeerConnection.prototype.addIceCandidate;d&&d.length!==0&&(o.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(s.browser==="chrome"&&s.version<78||s.browser==="firefox"&&s.version<68||s.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?GE.resolve():d.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),GE.resolve())})}function k1(o,s){if(!o.RTCPeerConnection||!o.RTCPeerConnection.prototype)return;const d=o.RTCPeerConnection.prototype.setLocalDescription;d&&d.length!==0&&(o.RTCPeerConnection.prototype.setLocalDescription=function(){let g=arguments[0]||{};if(typeof g!="object"||g.type&&g.sdp)return d.apply(this,arguments);if(g={type:g.type,sdp:g.sdp},!g.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":g.type="offer";break;default:g.type="answer"}return g.sdp||g.type!=="offer"&&g.type!=="answer"?d.apply(this,[g]):(g.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(b=>d.apply(this,[b]))})}var Ort=Object.freeze({__proto__:null,removeExtmapAllowMixed:TU,shimAddIceCandidateNullOrEmpty:N1,shimConnectionState:SU,shimMaxMessageSize:O1,shimParameterlessSetLocalDescription:k1,shimRTCIceCandidate:I1,shimRTCIceCandidateRelayProtocol:yU,shimSendThrowTypeError:A1});(function(){let{window:o}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const d=m6,g=function($){const Vt={browser:null,version:null};if($===void 0||!$.navigator)return Vt.browser="Not a browser.",Vt;const{navigator:zt}=$;if(zt.mozGetUserMedia)Vt.browser="firefox",Vt.version=r1(zt.userAgent,/Firefox\/(\d+)\./,1);else if(zt.webkitGetUserMedia||$.isSecureContext===!1&&$.webkitRTCPeerConnection)Vt.browser="chrome",Vt.version=r1(zt.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!$.RTCPeerConnection||!zt.userAgent.match(/AppleWebKit\/(\d+)\./))return Vt.browser="Not a supported browser.",Vt;Vt.browser="safari",Vt.version=r1(zt.userAgent,/AppleWebKit\/(\d+)\./,1),Vt.supportsUnifiedPlan=$.RTCRtpTransceiver&&"currentDirection"in $.RTCRtpTransceiver.prototype}return Vt}(o),b={browserDetails:g,commonShim:Ort,extractVersion:r1,disableLog:bZ,disableWarnings:RZ,sdp:Irt};switch(g.browser){case"chrome":if(!SW||!mU||!s.shimChrome)return d("Chrome shim is not included in this adapter release."),b;if(g.version===null)return d("Chrome shim can not determine version, not shimming."),b;d("adapter.js shimming chrome."),b.browserShim=SW,N1(o,g),k1(o),hW(o,g),pW(o),mU(o,g),fW(o),vW(o,g),mW(o),EW(o),gW(o),yW(o,g),I1(o),yU(o),SU(o),O1(o,g),A1(o),TU(o,g);break;case"firefox":if(!PW||!EU||!s.shimFirefox)return d("Firefox shim is not included in this adapter release."),b;d("adapter.js shimming firefox."),b.browserShim=PW,N1(o,g),k1(o),TW(o,g),EU(o,g),bW(o),wW(o),RW(o),CW(o),IW(o),OW(o),AW(o),NW(o),kW(o),I1(o),SU(o),O1(o,g),A1(o);break;case"safari":if(!GW||!s.shimSafari)return d("Safari shim is not included in this adapter release."),b;d("adapter.js shimming safari."),b.browserShim=GW,N1(o,g),k1(o),jW(o),FW(o),MW(o),DW(o),LW(o),VW(o),xW(o),BW(o),I1(o),yU(o),O1(o,g),A1(o),TU(o,g);break;default:d("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var Art=E0("Array").keys,Nrt=iR,krt=iT,Prt=_d,Drt=Art,bU=Array.prototype,Lrt={DOMTokenList:!0,NodeList:!0},Mrt=function(o){var s=o.keys;return o===bU||Prt(bU,o)&&s===bU.keys||krt(Lrt,Nrt(o))?Drt:s},qT=j(Mrt),YW=fO,xrt=TypeError,Urt=ZP,jrt=m0,Vrt=MS,P1=function(o,s,d){var g=Urt(s);g in o?jrt.f(o,g,Vrt(0,d)):o[g]=d},JW=aM,Frt=IR,Brt=P1,Grt=Array,Wrt=Math.max,RU=function(o,s,d){for(var g=Frt(o),b=JW(s,g),$=JW(d===void 0?g:d,g),Vt=Grt(Wrt($-b,0)),zt=0;b<$;b++,zt++)Brt(Vt,zt,o[b]);return Vt.length=zt,Vt},XW=RU,qrt=Math.floor,CU=function(o,s){var d=o.length,g=qrt(d/2);return d<8?Hrt(o,s):Krt(o,CU(XW(o,0,g),s),CU(XW(o,g),s),s)},Hrt=function(o,s){for(var d,g,b=o.length,$=1;$<b;){for(g=$,d=o[$];g&&s(o[g-1],d)>0;)o[g]=o[--g];g!==$++&&(o[g]=d)}return o},Krt=function(o,s,d,g){for(var b=s.length,$=d.length,Vt=0,zt=0;Vt<b||zt<$;)o[Vt+zt]=Vt<b&&zt<$?g(s[Vt],d[zt])<=0?s[Vt++]:d[zt++]:Vt<b?s[Vt++]:d[zt++];return o},QW=CU,ZW=II.match(/firefox\/(\d+)/i),zrt=!!ZW&&+ZW[1],Yrt=/MSIE|Trident/.test(II),$W=II.match(/AppleWebKit\/(\d+)\./),Jrt=!!$W&&+$W[1],Xrt=X_,t3=_h,Qrt=f0,Zrt=rR,e3=IR,$rt=function(o,s){if(!delete o[s])throw xrt("Cannot delete property "+YW(s)+" of "+YW(o))},n3=n0,wU=_t,tit=QW,eit=n1,r3=zrt,nit=Yrt,i3=OI,o3=Jrt,QR=[],s3=t3(QR.sort),rit=t3(QR.push),iit=wU(function(){QR.sort(void 0)}),oit=wU(function(){QR.sort(null)}),sit=eit("sort"),a3=!wU(function(){if(i3)return i3<70;if(!(r3&&r3>3)){if(nit)return!0;if(o3)return o3<603;var o,s,d,g,b="";for(o=65;o<76;o++){switch(s=String.fromCharCode(o),o){case 66:case 69:case 70:case 72:d=3;break;case 68:case 71:d=4;break;default:d=2}for(g=0;g<47;g++)QR.push({k:s+g,v:d})}for(QR.sort(function($,Vt){return Vt.v-$.v}),g=0;g<QR.length;g++)s=QR[g].k.charAt(0),b.charAt(b.length-1)!==s&&(b+=s);return b!=="DGBEFHACIJK"}});Xrt({target:"Array",proto:!0,forced:iit||!oit||!sit||!a3},{sort:function(o){o!==void 0&&Qrt(o);var s=Zrt(this);if(a3)return o===void 0?s3(s):s3(s,o);var d,g,b=[],$=e3(s);for(g=0;g<$;g++)g in s&&rit(b,s[g]);for(tit(b,function(Vt){return function(zt,_e){return _e===void 0?-1:zt===void 0?1:Vt!==void 0?+Vt(zt,_e)||0:n3(zt)>n3(_e)?1:-1}}(o)),d=e3(b),g=0;g<d;)s[g]=b[g++];for(;g<$;)$rt(s,g++);return s}});var ait=E0("Array").sort,cit=_d,uit=ait,IU=Array.prototype,lit=function(o){var s=o.sort;return o===IU||cit(IU,o)&&s===IU.sort?uit:s},GN=j(lit),OU={exports:{}};(function(o,s){(function(d,g){var b="function",$="undefined",Vt="object",zt="string",_e="major",_r="model",_o="name",ga="type",_a="vendor",_c="version",tE="architecture",_p="console",_f="mobile",eE="tablet",iE="smarttv",fE="wearable",mE="embedded",_E="Amazon",SE="Apple",wE="ASUS",NE="BlackBerry",DE="Browser",JE="Chrome",b_="Firefox",L_="Google",$_="Huawei",OS="LG",lS="Microsoft",U0="Motorola",kE="Opera",VE="Samsung",$E="Sharp",u_="Sony",P_="Xiaomi",WE="Zebra",_m="Facebook",lE="Chromium OS",pE="Mac OS",xE=function(SS){for(var LS={},eS=0;eS<SS.length;eS++)LS[SS[eS].toUpperCase()]=SS[eS];return LS},l_=function(SS,LS){return typeof SS===zt&&G_(LS).indexOf(G_(SS))!==-1},G_=function(SS){return SS.toLowerCase()},FS=function(SS,LS){if(typeof SS===zt)return SS=SS.replace(/^\s\s*/,""),typeof LS===$?SS:SS.substring(0,350)},MT=function(SS,LS){for(var eS,WT,wR,TS,D_,xT,wI=0;wI<LS.length&&!D_;){var eR=LS[wI],oQ=LS[wI+1];for(eS=WT=0;eS<eR.length&&!D_&&eR[eS];)if(D_=eR[eS++].exec(SS))for(wR=0;wR<oQ.length;wR++)xT=D_[++WT],typeof(TS=oQ[wR])===Vt&&TS.length>0?TS.length===2?typeof TS[1]==b?this[TS[0]]=TS[1].call(this,xT):this[TS[0]]=TS[1]:TS.length===3?typeof TS[1]!==b||TS[1].exec&&TS[1].test?this[TS[0]]=xT?xT.replace(TS[1],TS[2]):g:this[TS[0]]=xT?TS[1].call(this,xT,TS[2]):g:TS.length===4&&(this[TS[0]]=xT?TS[3].call(this,xT.replace(TS[1],TS[2])):g):this[TS]=xT||g;wI+=2}},WR=function(SS,LS){for(var eS in LS)if(typeof LS[eS]===Vt&&LS[eS].length>0){for(var WT=0;WT<LS[eS].length;WT++)if(l_(LS[eS][WT],SS))return eS==="?"?g:eS}else if(l_(LS[eS],SS))return eS==="?"?g:eS;return SS},WL={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},qL={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[_c,[_o,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[_c,[_o,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_o,_c],[/opios[\/ ]+([\w\.]+)/i],[_c,[_o,kE+" Mini"]],[/\bopr\/([\w\.]+)/i],[_c,[_o,kE]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[_o,_c],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[_c,[_o,"UC"+DE]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[_c,[_o,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[_c,[_o,"WeChat"]],[/konqueror\/([\w\.]+)/i],[_c,[_o,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[_c,[_o,"IE"]],[/yabrowser\/([\w\.]+)/i],[_c,[_o,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[_o,/(.+)/,"$1 Secure "+DE],_c],[/\bfocus\/([\w\.]+)/i],[_c,[_o,b_+" Focus"]],[/\bopt\/([\w\.]+)/i],[_c,[_o,kE+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[_c,[_o,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[_c,[_o,"Dolphin"]],[/coast\/([\w\.]+)/i],[_c,[_o,kE+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[_c,[_o,"MIUI "+DE]],[/fxios\/([-\w\.]+)/i],[_c,[_o,b_]],[/\bqihu|(qi?ho?o?|360)browser/i],[[_o,"360 "+DE]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[_o,/(.+)/,"$1 "+DE],_c],[/(comodo_dragon)\/([\w\.]+)/i],[[_o,/_/g," "],_c],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[_o,_c],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[_o],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_o,_m],_c],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[_o,_c],[/\bgsa\/([\w\.]+) .*safari\//i],[_c,[_o,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[_c,[_o,JE+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_o,JE+" WebView"],_c],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[_c,[_o,"Android "+DE]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_o,_c],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[_c,[_o,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[_c,_o],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_o,[_c,WR,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_o,_c],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_o,"Netscape"],_c],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[_c,[_o,b_+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[_o,_c],[/(cobalt)\/([\w\.]+)/i],[_o,[_c,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[tE,"amd64"]],[/(ia32(?=;))/i],[[tE,G_]],[/((?:i[346]|x)86)[;\)]/i],[[tE,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[tE,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[tE,"armhf"]],[/windows (ce|mobile); ppc;/i],[[tE,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[tE,/ower/,"",G_]],[/(sun4\w)[;\)]/i],[[tE,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[tE,G_]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[_r,[_a,VE],[ga,eE]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[_r,[_a,VE],[ga,_f]],[/\((ip(?:hone|od)[\w ]*);/i],[_r,[_a,SE],[ga,_f]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[_r,[_a,SE],[ga,eE]],[/(macintosh);/i],[_r,[_a,SE]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[_r,[_a,$E],[ga,_f]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[_r,[_a,$_],[ga,eE]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[_r,[_a,$_],[ga,_f]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[_r,/_/g," "],[_a,P_],[ga,_f]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[_r,/_/g," "],[_a,P_],[ga,eE]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[_r,[_a,"OPPO"],[ga,_f]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[_r,[_a,"Vivo"],[ga,_f]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[_r,[_a,"Realme"],[ga,_f]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[_r,[_a,U0],[ga,_f]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[_r,[_a,U0],[ga,eE]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[_r,[_a,OS],[ga,eE]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[_r,[_a,OS],[ga,_f]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[_r,[_a,"Lenovo"],[ga,eE]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[_r,/_/g," "],[_a,"Nokia"],[ga,_f]],[/(pixel c)\b/i],[_r,[_a,L_],[ga,eE]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[_r,[_a,L_],[ga,_f]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[_r,[_a,u_],[ga,_f]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[_r,"Xperia Tablet"],[_a,u_],[ga,eE]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[_r,[_a,"OnePlus"],[ga,_f]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[_r,[_a,_E],[ga,eE]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[_r,/(.+)/g,"Fire Phone $1"],[_a,_E],[ga,_f]],[/(playbook);[-\w\),; ]+(rim)/i],[_r,_a,[ga,eE]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[_r,[_a,NE],[ga,_f]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[_r,[_a,wE],[ga,eE]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[_r,[_a,wE],[ga,_f]],[/(nexus 9)/i],[_r,[_a,"HTC"],[ga,eE]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_a,[_r,/_/g," "],[ga,_f]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[_r,[_a,"Acer"],[ga,eE]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[_r,[_a,"Meizu"],[ga,_f]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_a,_r,[ga,_f]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_a,_r,[ga,eE]],[/(surface duo)/i],[_r,[_a,lS],[ga,eE]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[_r,[_a,"Fairphone"],[ga,_f]],[/(u304aa)/i],[_r,[_a,"AT&T"],[ga,_f]],[/\bsie-(\w*)/i],[_r,[_a,"Siemens"],[ga,_f]],[/\b(rct\w+) b/i],[_r,[_a,"RCA"],[ga,eE]],[/\b(venue[\d ]{2,7}) b/i],[_r,[_a,"Dell"],[ga,eE]],[/\b(q(?:mv|ta)\w+) b/i],[_r,[_a,"Verizon"],[ga,eE]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[_r,[_a,"Barnes & Noble"],[ga,eE]],[/\b(tm\d{3}\w+) b/i],[_r,[_a,"NuVision"],[ga,eE]],[/\b(k88) b/i],[_r,[_a,"ZTE"],[ga,eE]],[/\b(nx\d{3}j) b/i],[_r,[_a,"ZTE"],[ga,_f]],[/\b(gen\d{3}) b.+49h/i],[_r,[_a,"Swiss"],[ga,_f]],[/\b(zur\d{3}) b/i],[_r,[_a,"Swiss"],[ga,eE]],[/\b((zeki)?tb.*\b) b/i],[_r,[_a,"Zeki"],[ga,eE]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_a,"Dragon Touch"],_r,[ga,eE]],[/\b(ns-?\w{0,9}) b/i],[_r,[_a,"Insignia"],[ga,eE]],[/\b((nxa|next)-?\w{0,9}) b/i],[_r,[_a,"NextBook"],[ga,eE]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_a,"Voice"],_r,[ga,_f]],[/\b(lvtel\-)?(v1[12]) b/i],[[_a,"LvTel"],_r,[ga,_f]],[/\b(ph-1) /i],[_r,[_a,"Essential"],[ga,_f]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[_r,[_a,"Envizen"],[ga,eE]],[/\b(trio[-\w\. ]+) b/i],[_r,[_a,"MachSpeed"],[ga,eE]],[/\btu_(1491) b/i],[_r,[_a,"Rotor"],[ga,eE]],[/(shield[\w ]+) b/i],[_r,[_a,"Nvidia"],[ga,eE]],[/(sprint) (\w+)/i],[_a,_r,[ga,_f]],[/(kin\.[onetw]{3})/i],[[_r,/\./g," "],[_a,lS],[ga,_f]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[_r,[_a,WE],[ga,eE]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[_r,[_a,WE],[ga,_f]],[/smart-tv.+(samsung)/i],[_a,[ga,iE]],[/hbbtv.+maple;(\d+)/i],[[_r,/^/,"SmartTV"],[_a,VE],[ga,iE]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_a,OS],[ga,iE]],[/(apple) ?tv/i],[_a,[_r,SE+" TV"],[ga,iE]],[/crkey/i],[[_r,JE+"cast"],[_a,L_],[ga,iE]],[/droid.+aft(\w)( bui|\))/i],[_r,[_a,_E],[ga,iE]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[_r,[_a,$E],[ga,iE]],[/(bravia[\w ]+)( bui|\))/i],[_r,[_a,u_],[ga,iE]],[/(mitv-\w{5}) bui/i],[_r,[_a,P_],[ga,iE]],[/Hbbtv.*(technisat) (.*);/i],[_a,_r,[ga,iE]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_a,FS],[_r,FS],[ga,iE]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[ga,iE]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_a,_r,[ga,_p]],[/droid.+; (shield) bui/i],[_r,[_a,"Nvidia"],[ga,_p]],[/(playstation [345portablevi]+)/i],[_r,[_a,u_],[ga,_p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[_r,[_a,lS],[ga,_p]],[/((pebble))app/i],[_a,_r,[ga,fE]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[_r,[_a,SE],[ga,fE]],[/droid.+; (glass) \d/i],[_r,[_a,L_],[ga,fE]],[/droid.+; (wt63?0{2,3})\)/i],[_r,[_a,WE],[ga,fE]],[/(quest( 2| pro)?)/i],[_r,[_a,_m],[ga,fE]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_a,[ga,mE]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[_r,[ga,_f]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[_r,[ga,eE]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[ga,eE]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[ga,_f]],[/(android[-\w\. ]{0,9});.+buil/i],[_r,[_a,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[_c,[_o,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[_c,[_o,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[_o,_c],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[_c,_o]],os:[[/microsoft (windows) (vista|xp)/i],[_o,_c],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[_o,[_c,WR,WL]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[_o,"Windows"],[_c,WR,WL]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[_c,/_/g,"."],[_o,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_o,pE],[_c,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[_c,_o],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[_o,_c],[/\(bb(10);/i],[_c,[_o,NE]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[_c,[_o,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[_c,[_o,b_+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[_c,[_o,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[_c,[_o,"watchOS"]],[/crkey\/([\d\.]+)/i],[_c,[_o,JE+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_o,lE],_c],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_o,_c],[/(sunos) ?([\w\.\d]*)/i],[[_o,"Solaris"],_c],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[_o,_c]]},p0=function(SS,LS){if(typeof SS===Vt&&(LS=SS,SS=g),!(this instanceof p0))return new p0(SS,LS).getResult();var eS=typeof d!==$&&d.navigator?d.navigator:g,WT=SS||(eS&&eS.userAgent?eS.userAgent:""),wR=eS&&eS.userAgentData?eS.userAgentData:g,TS=LS?function(D_,xT){var wI={};for(var eR in D_)xT[eR]&&xT[eR].length%2==0?wI[eR]=xT[eR].concat(D_[eR]):wI[eR]=D_[eR];return wI}(qL,LS):qL;return this.getBrowser=function(){var D_={};return D_[_o]=g,D_[_c]=g,MT.call(D_,WT,TS.browser),D_[_e]=function(xT){return typeof xT===zt?xT.replace(/[^\d\.]/g,"").split(".")[0]:g}(D_[_c]),eS&&eS.brave&&typeof eS.brave.isBrave==b&&(D_[_o]="Brave"),D_},this.getCPU=function(){var D_={};return D_[tE]=g,MT.call(D_,WT,TS.cpu),D_},this.getDevice=function(){var D_={};return D_[_a]=g,D_[_r]=g,D_[ga]=g,MT.call(D_,WT,TS.device),!D_[ga]&&wR&&wR.mobile&&(D_[ga]=_f),D_[_r]=="Macintosh"&&eS&&typeof eS.standalone!==$&&eS.maxTouchPoints&&eS.maxTouchPoints>2&&(D_[_r]="iPad",D_[ga]=eE),D_},this.getEngine=function(){var D_={};return D_[_o]=g,D_[_c]=g,MT.call(D_,WT,TS.engine),D_},this.getOS=function(){var D_={};return D_[_o]=g,D_[_c]=g,MT.call(D_,WT,TS.os),!D_[_o]&&wR&&wR.platform!="Unknown"&&(D_[_o]=wR.platform.replace(/chrome os/i,lE).replace(/macos/i,pE)),D_},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return WT},this.setUA=function(D_){return WT=typeof D_===zt&&D_.length>350?FS(D_,350):D_,this},this.setUA(WT),this};p0.VERSION="0.7.34",p0.BROWSER=xE([_o,_c,_e]),p0.CPU=xE([tE]),p0.DEVICE=xE([_r,_a,ga,_p,_f,iE,eE,fE,mE]),p0.ENGINE=p0.OS=xE([_o,_c]),o.exports&&(s=o.exports=p0),s.UAParser=p0;var CI=typeof d!==$&&(d.jQuery||d.Zepto);if(CI&&!CI.ua){var RN=new p0;CI.ua=RN.getResult(),CI.ua.get=function(){return RN.getUA()},CI.ua.set=function(SS){RN.setUA(SS);var LS=RN.getResult();for(var eS in LS)CI.ua[eS]=LS[eS]}}})(typeof window=="object"?window:_)})(OU,OU.exports);var dit=j(OU.exports),hit=iR,pit=iT,fit=HR,mit=NI,Eit=RS("iterator"),git=Object,_it=function(o){if(fit(o))return!1;var s=git(o);return s[Eit]!==void 0||"@@iterator"in s||pit(mit,hit(s))},vit=j(_it),AU=aE;X_({global:!0,forced:AU.globalThis!==AU},{globalThis:AU});var c3=j(aE);function u3(o,s){return function(){return o.apply(s,arguments)}}const{toString:yit}=Object.prototype,{getPrototypeOf:NU}=Object,D1=(kU=Object.create(null),o=>{const s=yit.call(o);return kU[s]||(kU[s]=s.slice(8,-1).toLowerCase())});var kU;const aR=o=>(o=o.toLowerCase(),s=>D1(s)===o),L1=o=>s=>typeof s===o,{isArray:IO}=Array,WN=L1("undefined"),l3=aR("ArrayBuffer"),Sit=L1("string"),g0=L1("function"),d3=L1("number"),M1=o=>o!==null&&typeof o=="object",x1=o=>{if(D1(o)!=="object")return!1;const s=NU(o);return!(s!==null&&s!==Object.prototype&&Object.getPrototypeOf(s)!==null||Symbol.toStringTag in o||vit(o))},Tit=aR("Date"),bit=aR("File"),Rit=aR("Blob"),Cit=aR("FileList"),wit=aR("URLSearchParams");function qN(o,s){let d,g,{allOwnKeys:b=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(o!=null)if(typeof o!="object"&&(o=[o]),IO(o))for(d=0,g=o.length;d<g;d++)s.call(null,o[d],d,o);else{const $=b?Object.getOwnPropertyNames(o):Object.keys(o),Vt=$.length;let zt;for(d=0;d<Vt;d++)zt=$[d],s.call(null,o[zt],zt,o)}}function h3(o,s){s=s.toLowerCase();const d=Object.keys(o);let g,b=d.length;for(;b-- >0;)if(g=d[b],s===g.toLowerCase())return g;return null}const p3=c3!==void 0?c3:typeof self<"u"?self:typeof window<"u"?window:commonjsGlobal,f3=o=>!WN(o)&&o!==p3,Iit=(PU=typeof Uint8Array<"u"&&NU(Uint8Array),o=>PU&&o instanceof PU);var PU;const Oit=aR("HTMLFormElement"),m3=(o=>{let{hasOwnProperty:s}=o;return(d,g)=>s.call(d,g)})(Object.prototype),Ait=aR("RegExp"),E3=(o,s)=>{const d=Object.getOwnPropertyDescriptors(o),g={};qN(d,(b,$)=>{let Vt;(Vt=s(b,$,o))!==!1&&(g[$]=Vt||b)}),Object.defineProperties(o,g)},DU="abcdefghijklmnopqrstuvwxyz",g3="0123456789",_3={DIGIT:g3,ALPHA:DU,ALPHA_DIGIT:DU+DU.toUpperCase()+g3},Nit=aR("AsyncFunction");var ZE={isArray:IO,isArrayBuffer:l3,isBuffer:function(o){return o!==null&&!WN(o)&&o.constructor!==null&&!WN(o.constructor)&&g0(o.constructor.isBuffer)&&o.constructor.isBuffer(o)},isFormData:o=>{let s;return o&&(typeof FormData=="function"&&o instanceof FormData||g0(o.append)&&((s=D1(o))==="formdata"||s==="object"&&g0(o.toString)&&o.toString()==="[object FormData]"))},isArrayBufferView:function(o){let s;return s=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(o):o&&o.buffer&&l3(o.buffer),s},isString:Sit,isNumber:d3,isBoolean:o=>o===!0||o===!1,isObject:M1,isPlainObject:x1,isUndefined:WN,isDate:Tit,isFile:bit,isBlob:Rit,isRegExp:Ait,isFunction:g0,isStream:o=>M1(o)&&g0(o.pipe),isURLSearchParams:wit,isTypedArray:Iit,isFileList:Cit,forEach:qN,merge:function o(){const{caseless:s}=f3(this)&&this||{},d={},g=(b,$)=>{const Vt=s&&h3(d,$)||$;x1(d[Vt])&&x1(b)?d[Vt]=o(d[Vt],b):x1(b)?d[Vt]=o({},b):IO(b)?d[Vt]=b.slice():d[Vt]=b};for(let b=0,$=arguments.length;b<$;b++)arguments[b]&&qN(arguments[b],g);return d},extend:function(o,s,d){let{allOwnKeys:g}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return qN(s,(b,$)=>{d&&g0(b)?o[$]=u3(b,d):o[$]=b},{allOwnKeys:g}),o},trim:o=>dT(o)?dT(o).call(o):o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),inherits:(o,s,d,g)=>{o.prototype=Object.create(s.prototype,g),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:s.prototype}),d&&Object.assign(o.prototype,d)},toFlatObject:(o,s,d,g)=>{let b,$,Vt;const zt={};if(s=s||{},o==null)return s;do{for(b=Object.getOwnPropertyNames(o),$=b.length;$-- >0;)Vt=b[$],g&&!g(Vt,o,s)||zt[Vt]||(s[Vt]=o[Vt],zt[Vt]=!0);o=d!==!1&&NU(o)}while(o&&(!d||d(o,s))&&o!==Object.prototype);return s},kindOf:D1,kindOfTest:aR,endsWith:(o,s,d)=>{o=String(o),(d===void 0||d>o.length)&&(d=o.length),d-=s.length;const g=o.indexOf(s,d);return g!==-1&&g===d},toArray:o=>{if(!o)return null;if(IO(o))return o;let s=o.length;if(!d3(s))return null;const d=new Array(s);for(;s-- >0;)d[s]=o[s];return d},forEachEntry:(o,s)=>{const d=(o&&o[Symbol.iterator]).call(o);let g;for(;(g=d.next())&&!g.done;){const b=g.value;s.call(o,b[0],b[1])}},matchAll:(o,s)=>{let d;const g=[];for(;(d=o.exec(s))!==null;)g.push(d);return g},isHTMLForm:Oit,hasOwnProperty:m3,hasOwnProp:m3,reduceDescriptors:E3,freezeMethods:o=>{E3(o,(s,d)=>{if(g0(o)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const g=o[d];g0(g)&&(s.enumerable=!1,"writable"in s?s.writable=!1:s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")}))})},toObjectSet:(o,s)=>{const d={},g=b=>{b.forEach($=>{d[$]=!0})};return IO(o)?g(o):g(String(o).split(s)),d},toCamelCase:o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(s,d,g){return d.toUpperCase()+g}),noop:()=>{},toFiniteNumber:(o,s)=>(o=+o,Number.isFinite(o)?o:s),findKey:h3,global:p3,isContextDefined:f3,ALPHABET:_3,generateString:function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:_3.ALPHA_DIGIT,d="";const{length:g}=s;for(;o--;)d+=s[Math.random()*g|0];return d},isSpecCompliantForm:function(o){return!!(o&&g0(o.append)&&o[Symbol.toStringTag]==="FormData"&&o[Symbol.iterator])},toJSONObject:o=>{const s=new Array(10),d=(g,b)=>{if(M1(g)){if(s.indexOf(g)>=0)return;if(!("toJSON"in g)){s[b]=g;const $=IO(g)?[]:{};return qN(g,(Vt,zt)=>{const _e=d(Vt,b+1);!WN(_e)&&($[zt]=_e)}),s[b]=void 0,$}}return g};return d(o,0)},isAsyncFn:Nit,isThenable:o=>o&&(M1(o)||g0(o))&&g0(o.then)&&g0(o.catch)};function aS(o,s,d,g,b){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",s&&(this.code=s),d&&(this.config=d),g&&(this.request=g),b&&(this.response=b)}ZE.inherits(aS,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ZE.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const v3=aS.prototype,y3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{y3[o]={value:o}}),Object.defineProperties(aS,y3),Object.defineProperty(v3,"isAxiosError",{value:!0}),aS.from=(o,s,d,g,b,$)=>{const Vt=Object.create(v3);return ZE.toFlatObject(o,Vt,function(zt){return zt!==Error.prototype},zt=>zt!=="isAxiosError"),aS.call(Vt,o.message,s,d,g,b),Vt.cause=o,Vt.name=o.name,$&&Object.assign(Vt,$),Vt};function LU(o){return ZE.isPlainObject(o)||ZE.isArray(o)}function S3(o){return ZE.endsWith(o,"[]")?o.slice(0,-2):o}function T3(o,s,d){return o?o.concat(s).map(function(g,b){return g=S3(g),!d&&b?"["+g+"]":g}).join(d?".":""):s}const kit=ZE.toFlatObject(ZE,{},null,function(o){return/^is[A-Z]/.test(o)});function U1(o,s,d){if(!ZE.isObject(o))throw new TypeError("target must be an object");s=s||new FormData;const g=(d=ZE.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_a,_c){return!ZE.isUndefined(_c[_a])})).metaTokens,b=d.visitor||_r,$=d.dots,Vt=d.indexes,zt=(d.Blob||typeof Blob<"u"&&Blob)&&ZE.isSpecCompliantForm(s);if(!ZE.isFunction(b))throw new TypeError("visitor must be a function");function _e(_a){if(_a===null)return"";if(ZE.isDate(_a))return _a.toISOString();if(!zt&&ZE.isBlob(_a))throw new aS("Blob is not supported. Use a Buffer instead.");return ZE.isArrayBuffer(_a)||ZE.isTypedArray(_a)?zt&&typeof Blob=="function"?new Blob([_a]):Buffer.from(_a):_a}function _r(_a,_c,tE){let _p=_a;if(_a&&!tE&&typeof _a=="object"){if(ZE.endsWith(_c,"{}"))_c=g?_c:_c.slice(0,-2),_a=JSON.stringify(_a);else if(ZE.isArray(_a)&&function(_f){return ZE.isArray(_f)&&!_f.some(LU)}(_a)||(ZE.isFileList(_a)||ZE.endsWith(_c,"[]"))&&(_p=ZE.toArray(_a)))return _c=S3(_c),_p.forEach(function(_f,eE){!ZE.isUndefined(_f)&&_f!==null&&s.append(Vt===!0?T3([_c],eE,$):Vt===null?_c:_c+"[]",_e(_f))}),!1}return!!LU(_a)||(s.append(T3(tE,_c,$),_e(_a)),!1)}const _o=[],ga=Object.assign(kit,{defaultVisitor:_r,convertValue:_e,isVisitable:LU});if(!ZE.isObject(o))throw new TypeError("data must be an object");return function _a(_c,tE){if(!ZE.isUndefined(_c)){if(_o.indexOf(_c)!==-1)throw Error("Circular reference detected in "+tE.join("."));_o.push(_c),ZE.forEach(_c,function(_p,_f){(!(ZE.isUndefined(_p)||_p===null)&&b.call(s,_p,ZE.isString(_f)?dT(_f).call(_f):_f,tE,ga))===!0&&_a(_p,tE?tE.concat(_f):[_f])}),_o.pop()}}(o),s}function b3(o){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(d){return s[d]})}function MU(o,s){this._pairs=[],o&&U1(o,this,s)}const R3=MU.prototype;function Pit(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function C3(o,s,d){if(!s)return o;const g=d&&d.encode||Pit,b=d&&d.serialize;let $;if($=b?b(s,d):ZE.isURLSearchParams(s)?s.toString():new MU(s,d).toString(g),$){const Vt=o.indexOf("#");Vt!==-1&&(o=o.slice(0,Vt)),o+=(o.indexOf("?")===-1?"?":"&")+$}return o}R3.append=function(o,s){this._pairs.push([o,s])},R3.toString=function(o){const s=o?function(d){return o.call(this,d,b3)}:b3;return this._pairs.map(function(d){return s(d[0])+"="+s(d[1])},"").join("&")};var w3=class{constructor(){this.handlers=[]}use(o,s,d){return this.handlers.push({fulfilled:o,rejected:s,synchronous:!!d&&d.synchronous,runWhen:d?d.runWhen:null}),this.handlers.length-1}eject(o){this.handlers[o]&&(this.handlers[o]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(o){ZE.forEach(this.handlers,function(s){s!==null&&o(s)})}},I3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},O3={exports:{}},Dit=X_,Lit=OE,A3=m0.f;Dit({target:"Object",stat:!0,forced:Object.defineProperty!==A3,sham:!Lit},{defineProperty:A3});var N3=V0.Object,Mit=O3.exports=function(o,s,d){return N3.defineProperty(o,s,d)};N3.defineProperty.sham&&(Mit.sham=!0);var k3=j(O3.exports),xit=IE,HN=Array.isArray||function(o){return xit(o)=="Array"},Uit=TypeError,P3=HN,jit=v1,Vit=OT,Fit=RS("species"),D3=Array,Bit=function(o){var s;return P3(o)&&(s=o.constructor,(jit(s)&&(s===D3||P3(s.prototype))||Vit(s)&&(s=s[Fit])===null)&&(s=void 0)),s===void 0?D3:s},L3=function(o,s){return new(Bit(o))(s===0?0:s)},Git=_t,Wit=OI,qit=RS("species"),M3=function(o){return Wit>=51||!Git(function(){var s=[];return(s.constructor={})[qit]=function(){return{foo:1}},s[o](Boolean).foo!==1})},Hit=X_,Kit=_t,zit=HN,Yit=OT,Jit=rR,Xit=IR,x3=function(o){if(o>9007199254740991)throw Uit("Maximum allowed index exceeded");return o},U3=P1,Qit=L3,Zit=M3,$it=OI,j3=RS("isConcatSpreadable"),tot=$it>=51||!Kit(function(){var o=[];return o[j3]=!1,o.concat()[0]!==o}),eot=function(o){if(!Yit(o))return!1;var s=o[j3];return s!==void 0?!!s:zit(o)};Hit({target:"Array",proto:!0,arity:1,forced:!tot||!Zit("concat")},{concat:function(o){var s,d,g,b,$,Vt=Jit(this),zt=Qit(Vt,0),_e=0;for(s=-1,g=arguments.length;s<g;s++)if(eot($=s===-1?Vt:arguments[s]))for(b=Xit($),x3(_e+b),d=0;d<b;d++,_e++)d in $&&U3(zt,_e,$[d]);else x3(_e+1),U3(zt,_e++,$);return zt.length=_e,zt}});var V3={},not=IE,rot=AS,F3=o1.f,iot=RU,B3=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];V3.f=function(o){return B3&&not(o)=="Window"?function(s){try{return F3(s)}catch{return iot(B3)}}(o):F3(rot(o))};var OO={},oot=RS;OO.f=oot;var G3=V0,sot=iT,aot=OO,cot=m0.f,$S=function(o){var s=G3.Symbol||(G3.Symbol={});sot(s,o)||cot(s,o,{value:aot.f(o)})},uot=jE,lot=UT,dot=RS,hot=YR,W3=function(){var o=lot("Symbol"),s=o&&o.prototype,d=s&&s.valueOf,g=dot("toPrimitive");s&&!s[g]&&hot(s,g,function(b){return uot(d,this)},{arity:1})},pot=KR,fot=nR,mot=rR,Eot=IR,got=L3,q3=_h([].push),ZR=function(o){var s=o==1,d=o==2,g=o==3,b=o==4,$=o==6,Vt=o==7,zt=o==5||$;return function(_e,_r,_o,ga){for(var _a,_c,tE=mot(_e),_p=fot(tE),_f=pot(_r,_o),eE=Eot(_p),iE=0,fE=ga||got,mE=s?fE(_e,eE):d||Vt?fE(_e,0):void 0;eE>iE;iE++)if((zt||iE in _p)&&(_c=_f(_a=_p[iE],iE,tE),o))if(s)mE[iE]=_c;else if(_c)switch(o){case 3:return!0;case 5:return _a;case 6:return iE;case 2:q3(mE,_a)}else switch(o){case 4:return!1;case 7:q3(mE,_a)}return $?-1:g||b?b:mE}},H3={forEach:ZR(0),map:ZR(1),filter:ZR(2),some:ZR(3),every:ZR(4),find:ZR(5),findIndex:ZR(6),filterReject:ZR(7)},j1=X_,xU=aE,UU=jE,_ot=_h,AO=OE,NO=pO,vot=_t,ET=iT,yot=_d,jU=AT,V1=AS,VU=ZP,Sot=n0,FU=MS,KN=PN,K3=a1,Tot=o1,z3=V3,bot=kN,Y3=RE,J3=m0,Rot=vM,X3=LE,Q3=YR,Cot=_1,BU=mO,Z3=s1,$3=ZL,wot=RS,Iot=OO,Oot=$S,Aot=W3,Not=JR,_q=PI,F1=H3.forEach,HT=i1("hidden"),B1="Symbol",zN="prototype",kot=_q.set,tH=_q.getterFor(B1),B0=Object[zN],MI=xU.Symbol,G1=MI&&MI[zN],Pot=xU.TypeError,GU=xU.QObject,eH=Y3.f,xI=J3.f,nH=z3.f,Dot=X3.f,rH=_ot([].push),OR=BU("symbols"),YN=BU("op-symbols"),Lot=BU("wks"),WU=!GU||!GU[zN]||!GU[zN].findChild,qU=AO&&vot(function(){return KN(xI({},"a",{get:function(){return xI(this,"a",{value:7}).a}})).a!=7})?function(o,s,d){var g=eH(B0,s);g&&delete B0[s],xI(o,s,d),g&&o!==B0&&xI(B0,s,g)}:xI,HU=function(o,s){var d=OR[o]=KN(G1);return kot(d,{type:B1,tag:o,description:s}),AO||(d.description=s),d},W1=function(o,s,d){o===B0&&W1(YN,s,d),jU(o);var g=VU(s);return jU(d),ET(OR,g)?(d.enumerable?(ET(o,HT)&&o[HT][g]&&(o[HT][g]=!1),d=KN(d,{enumerable:FU(0,!1)})):(ET(o,HT)||xI(o,HT,FU(1,{})),o[HT][g]=!0),qU(o,g,d)):xI(o,g,d)},KU=function(o,s){jU(o);var d=V1(s),g=K3(d).concat(aH(d));return F1(g,function(b){AO&&!UU(iH,d,b)||W1(o,b,d[b])}),o},iH=function(o){var s=VU(o),d=UU(Dot,this,s);return!(this===B0&&ET(OR,s)&&!ET(YN,s))&&(!(d||!ET(this,s)||!ET(OR,s)||ET(this,HT)&&this[HT][s])||d)},oH=function(o,s){var d=V1(o),g=VU(s);if(d!==B0||!ET(OR,g)||ET(YN,g)){var b=eH(d,g);return!b||!ET(OR,g)||ET(d,HT)&&d[HT][g]||(b.enumerable=!0),b}},sH=function(o){var s=nH(V1(o)),d=[];return F1(s,function(g){ET(OR,g)||ET(Z3,g)||rH(d,g)}),d},aH=function(o){var s=o===B0,d=nH(s?YN:V1(o)),g=[];return F1(d,function(b){!ET(OR,b)||s&&!ET(B0,b)||rH(g,OR[b])}),g};NO||(MI=function(){if(yot(G1,this))throw Pot("Symbol is not a constructor");var o=arguments.length&&arguments[0]!==void 0?Sot(arguments[0]):void 0,s=$3(o),d=function(g){this===B0&&UU(d,YN,g),ET(this,HT)&&ET(this[HT],s)&&(this[HT][s]=!1),qU(this,s,FU(1,g))};return AO&&WU&&qU(B0,s,{configurable:!0,set:d}),HU(s,o)},Q3(G1=MI[zN],"toString",function(){return tH(this).tag}),Q3(MI,"withoutSetter",function(o){return HU($3(o),o)}),X3.f=iH,J3.f=W1,Rot.f=KU,Y3.f=oH,Tot.f=z3.f=sH,bot.f=aH,Iot.f=function(o){return HU(wot(o),o)},AO&&Cot(G1,"description",{configurable:!0,get:function(){return tH(this).description}})),j1({global:!0,constructor:!0,wrap:!0,forced:!NO,sham:!NO},{Symbol:MI}),F1(K3(Lot),function(o){Oot(o)}),j1({target:B1,stat:!0,forced:!NO},{useSetter:function(){WU=!0},useSimple:function(){WU=!1}}),j1({target:"Object",stat:!0,forced:!NO,sham:!AO},{create:function(o,s){return s===void 0?KN(o):KU(KN(o),s)},defineProperty:W1,defineProperties:KU,getOwnPropertyDescriptor:oH}),j1({target:"Object",stat:!0,forced:!NO},{getOwnPropertyNames:sH}),Aot(),Not(MI,B1),Z3[HT]=!0;var cH=pO&&!!Symbol.for&&!!Symbol.keyFor,Mot=X_,xot=UT,Uot=iT,jot=n0,uH=mO,Vot=cH,zU=uH("string-to-symbol-registry"),Fot=uH("symbol-to-string-registry");Mot({target:"Symbol",stat:!0,forced:!Vot},{for:function(o){var s=jot(o);if(Uot(zU,s))return zU[s];var d=xot("Symbol")(s);return zU[s]=d,Fot[d]=s,d}});var Bot=X_,Got=iT,Wot=ON,qot=fO,Hot=cH,lH=mO("symbol-to-string-registry");Bot({target:"Symbol",stat:!0,forced:!Hot},{keyFor:function(o){if(!Wot(o))throw TypeError(qot(o)+" is not a symbol");if(Got(lH,o))return lH[o]}});var dH=HN,Kot=gE,hH=IE,zot=n0,pH=_h([].push),Yot=X_,fH=UT,mH=dE,Jot=jE,JN=_h,EH=_t,gH=gE,_H=ON,vH=BM,Xot=function(o){if(Kot(o))return o;if(dH(o)){for(var s=o.length,d=[],g=0;g<s;g++){var b=o[g];typeof b=="string"?pH(d,b):typeof b!="number"&&hH(b)!="Number"&&hH(b)!="String"||pH(d,zot(b))}var $=d.length,Vt=!0;return function(zt,_e){if(Vt)return Vt=!1,_e;if(dH(this))return _e;for(var _r=0;_r<$;_r++)if(d[_r]===zt)return _e}}},Qot=pO,Zot=String,$R=fH("JSON","stringify"),q1=JN(/./.exec),yH=JN("".charAt),$ot=JN("".charCodeAt),tst=JN("".replace),est=JN(1 .toString),nst=/[\uD800-\uDFFF]/g,SH=/^[\uD800-\uDBFF]$/,TH=/^[\uDC00-\uDFFF]$/,bH=!Qot||EH(function(){var o=fH("Symbol")();return $R([o])!="[null]"||$R({a:o})!="{}"||$R(Object(o))!="{}"}),RH=EH(function(){return $R("\uDF06\uD834")!=='"\\udf06\\ud834"'||$R("\uDEAD")!=='"\\udead"'}),rst=function(o,s){var d=vH(arguments),g=Xot(s);if(gH(g)||o!==void 0&&!_H(o))return d[1]=function(b,$){if(gH(g)&&($=Jot(g,this,Zot(b),$)),!_H($))return $},mH($R,null,d)},ist=function(o,s,d){var g=yH(d,s-1),b=yH(d,s+1);return q1(SH,o)&&!q1(TH,b)||q1(TH,o)&&!q1(SH,g)?"\\u"+est($ot(o,0),16):o};$R&&Yot({target:"JSON",stat:!0,arity:3,forced:bH||RH},{stringify:function(o,s,d){var g=vH(arguments),b=mH(bH?rst:$R,null,g);return RH&&typeof b=="string"?tst(b,nst,ist):b}});var CH=kN,ost=rR;X_({target:"Object",stat:!0,forced:!pO||_t(function(){CH.f(1)})},{getOwnPropertySymbols:function(o){var s=CH.f;return s?s(ost(o)):[]}}),$S("asyncIterator"),$S("hasInstance"),$S("isConcatSpreadable"),$S("iterator"),$S("match"),$S("matchAll"),$S("replace"),$S("search"),$S("species"),$S("split");var sst=W3;$S("toPrimitive"),sst();var ast=UT,cst=JR;$S("toStringTag"),cst(ast("Symbol"),"Symbol"),$S("unscopables"),JR(aE.JSON,"JSON",!0);var ust=V0.Symbol,lst=RS,dst=m0.f,wH=lst("metadata"),IH=Function.prototype;IH[wH]===void 0&&dst(IH,wH,{value:null}),$S("dispose"),$S("metadata");var hst=ust;$S("asyncDispose");var pst=_h,YU=UT("Symbol"),fst=YU.keyFor,mst=pst(YU.prototype.valueOf),OH=YU.isRegisteredSymbol||function(o){try{return fst(mst(o))!==void 0}catch{return!1}};X_({target:"Symbol",stat:!0},{isRegisteredSymbol:OH});for(var Est=mO,AH=UT,gst=_h,_st=ON,vst=RS,H1=AH("Symbol"),NH=H1.isWellKnownSymbol,kH=AH("Object","getOwnPropertyNames"),yst=gst(H1.prototype.valueOf),PH=Est("wks"),JU=0,DH=kH(H1),Sst=DH.length;JU<Sst;JU++)try{var LH=DH[JU];_st(H1[LH])&&vst(LH)}catch{}var MH=function(o){if(NH&&NH(o))return!0;try{for(var s=yst(o),d=0,g=kH(PH),b=g.length;d<b;d++)if(PH[g[d]]==s)return!0}catch{}return!1};X_({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:MH}),$S("matcher"),$S("observable"),X_({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:OH}),X_({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:MH}),$S("metadataKey"),$S("patternMatch"),$S("replaceAll");var kO=j(hst),xH=j(OO.f("iterator"));function XN(o){return XN=typeof kO=="function"&&typeof xH=="symbol"?function(s){return typeof s}:function(s){return s&&typeof kO=="function"&&s.constructor===kO&&s!==kO.prototype?"symbol":typeof s},XN(o)}var Tst=j(OO.f("toPrimitive"));function bst(o){var s=function(d,g){if(XN(d)!=="object"||d===null)return d;var b=d[Tst];if(b!==void 0){var $=b.call(d,g||"default");if(XN($)!=="object")return $;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(d)}(o,"string");return XN(s)==="symbol"?s:String(s)}function Qm(o,s,d){return(s=bst(s))in o?k3(o,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):o[s]=d,o}var Rst=_t,Cst=RS("iterator"),XU=!Rst(function(){var o=new URL("b?a=1&b=2&c=3","http://a"),s=o.searchParams,d=new URLSearchParams("a=1&a=2"),g="";return o.pathname="c%20d",s.forEach(function(b,$){s.delete("b"),g+=$+b}),d.delete("a",2),!o.toJSON||!d.has("a",1)||d.has("a",2)||!s.size&&!0||!s.sort||o.href!=="http://a/c%20d?a=1&c=3"||s.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!s[Cst]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||g!=="a1c3"||new URL("http://x",void 0).host!=="x"}),wst=YR,QU=X_,PO=aE,K1=jE,cR=_h,DO=OE,UH=XU,jH=YR,Ist=_1,Ost=function(o,s,d){for(var g in s)d&&d.unsafe&&o[g]?o[g]=s[g]:wst(o,g,s[g],d);return o},Ast=JR,Nst=DM,ZU=PI,VH=xM,$U=gE,kst=iT,Pst=KR,Dst=iR,Lst=AT,FH=OT,jT=n0,Mst=PN,BH=MS,_j=bM,xst=l1,LO=y1,Ust=QW,jst=RS("iterator"),QN="URLSearchParams",GH=QN+"Iterator",WH=ZU.set,_0=ZU.getterFor(QN),Vst=ZU.getterFor(GH),Fst=Object.getOwnPropertyDescriptor,$j=function(o){if(!DO)return PO[o];var s=Fst(PO,o);return s&&s.value},qH=$j("fetch"),z1=$j("Request"),ZN=$j("Headers"),tV=z1&&z1.prototype,HH=ZN&&ZN.prototype,Bst=PO.RegExp,Gst=PO.TypeError,KH=PO.decodeURIComponent,Wst=PO.encodeURIComponent,qst=cR("".charAt),zH=cR([].join),UI=cR([].push),eV=cR("".replace),Hst=cR([].shift),YH=cR([].splice),JH=cR("".split),Kst=cR("".slice),zst=/\+/g,XH=Array(4),Yst=function(o){return XH[o-1]||(XH[o-1]=Bst("((?:%[\\da-f]{2}){"+o+"})","gi"))},Jst=function(o){try{return KH(o)}catch{return o}},QH=function(o){var s=eV(o,zst," "),d=4;try{return KH(s)}catch{for(;d;)s=eV(s,Yst(d--),Jst);return s}},Xst=/[!'()~]|%20/g,Qst={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Zst=function(o){return Qst[o]},ZH=function(o){return eV(Wst(o),Xst,Zst)},nV=Nst(function(o,s){WH(this,{type:GH,iterator:_j(_0(o).entries),kind:s})},"Iterator",function(){var o=Vst(this),s=o.kind,d=o.iterator.next(),g=d.value;return d.done||(d.value=s==="keys"?g.key:s==="values"?g.value:[g.key,g.value]),d},!0),$H=function(o){this.entries=[],this.url=null,o!==void 0&&(FH(o)?this.parseObject(o):this.parseQuery(typeof o=="string"?qst(o,0)==="?"?Kst(o,1):o:jT(o)))};$H.prototype={type:QN,bindURL:function(o){this.url=o,this.update()},parseObject:function(o){var s,d,g,b,$,Vt,zt,_e=xst(o);if(_e)for(d=(s=_j(o,_e)).next;!(g=K1(d,s)).done;){if($=(b=_j(Lst(g.value))).next,(Vt=K1($,b)).done||(zt=K1($,b)).done||!K1($,b).done)throw Gst("Expected sequence with length 2");UI(this.entries,{key:jT(Vt.value),value:jT(zt.value)})}else for(var _r in o)kst(o,_r)&&UI(this.entries,{key:_r,value:jT(o[_r])})},parseQuery:function(o){if(o)for(var s,d,g=JH(o,"&"),b=0;b<g.length;)(s=g[b++]).length&&(d=JH(s,"="),UI(this.entries,{key:QH(Hst(d)),value:QH(zH(d,"="))}))},serialize:function(){for(var o,s=this.entries,d=[],g=0;g<s.length;)o=s[g++],UI(d,ZH(o.key)+"="+ZH(o.value));return zH(d,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Y1=function(){VH(this,MO);var o=WH(this,new $H(arguments.length>0?arguments[0]:void 0));DO||(this.size=o.entries.length)},MO=Y1.prototype;if(Ost(MO,{append:function(o,s){var d=_0(this);LO(arguments.length,2),UI(d.entries,{key:jT(o),value:jT(s)}),DO||this.length++,d.updateURL()},delete:function(o){for(var s=_0(this),d=LO(arguments.length,1),g=s.entries,b=jT(o),$=d<2?void 0:arguments[1],Vt=$===void 0?$:jT($),zt=0;zt<g.length;){var _e=g[zt];if(_e.key!==b||Vt!==void 0&&_e.value!==Vt)zt++;else if(YH(g,zt,1),Vt!==void 0)break}DO||(this.size=g.length),s.updateURL()},get:function(o){var s=_0(this).entries;LO(arguments.length,1);for(var d=jT(o),g=0;g<s.length;g++)if(s[g].key===d)return s[g].value;return null},getAll:function(o){var s=_0(this).entries;LO(arguments.length,1);for(var d=jT(o),g=[],b=0;b<s.length;b++)s[b].key===d&&UI(g,s[b].value);return g},has:function(o){for(var s=_0(this).entries,d=LO(arguments.length,1),g=jT(o),b=d<2?void 0:arguments[1],$=b===void 0?b:jT(b),Vt=0;Vt<s.length;){var zt=s[Vt++];if(zt.key===g&&($===void 0||zt.value===$))return!0}return!1},set:function(o,s){var d=_0(this);LO(arguments.length,1);for(var g,b=d.entries,$=!1,Vt=jT(o),zt=jT(s),_e=0;_e<b.length;_e++)(g=b[_e]).key===Vt&&($?YH(b,_e--,1):($=!0,g.value=zt));$||UI(b,{key:Vt,value:zt}),DO||(this.size=b.length),d.updateURL()},sort:function(){var o=_0(this);Ust(o.entries,function(s,d){return s.key>d.key?1:-1}),o.updateURL()},forEach:function(o){for(var s,d=_0(this).entries,g=Pst(o,arguments.length>1?arguments[1]:void 0),b=0;b<d.length;)g((s=d[b++]).value,s.key,this)},keys:function(){return new nV(this,"keys")},values:function(){return new nV(this,"values")},entries:function(){return new nV(this,"entries")}},{enumerable:!0}),jH(MO,jst,MO.entries,{name:"entries"}),jH(MO,"toString",function(){return _0(this).serialize()},{enumerable:!0}),DO&&Ist(MO,"size",{get:function(){return _0(this).entries.length},configurable:!0,enumerable:!0}),Ast(Y1,QN),QU({global:!0,constructor:!0,forced:!UH},{URLSearchParams:Y1}),!UH&&$U(ZN)){var $st=cR(HH.has),tat=cR(HH.set),t8=function(o){if(FH(o)){var s,d=o.body;if(Dst(d)===QN)return s=o.headers?new ZN(o.headers):new ZN,$st(s,"content-type")||tat(s,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Mst(o,{body:BH(0,jT(d)),headers:BH(0,s)})}return o};if($U(qH)&&QU({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(o){return qH(o,arguments.length>1?t8(arguments[1]):{})}}),$U(z1)){var rV=function(o){return VH(this,tV),new z1(o,arguments.length>1?t8(arguments[1]):{})};tV.constructor=rV,rV.prototype=tV,QU({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:rV})}}var eat={URLSearchParams:Y1,getState:_0},e8=j(V0.URLSearchParams),nat={isBrowser:!0,classes:{URLSearchParams:e8!==void 0?e8:MU,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const n8=typeof window<"u"&&typeof document<"u",rat=(r8=typeof navigator<"u"&&navigator.product,n8&&["ReactNative","NativeScript","NS"].indexOf(r8)<0);var r8;const iat=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function";function i8(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function o8(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?i8(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):i8(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}var uR=o8(o8({},Object.freeze({__proto__:null,hasBrowserEnv:n8,hasStandardBrowserEnv:rat,hasStandardBrowserWebWorkerEnv:iat})),nat),oat=AT,sat=jE,aat=iT,cat=_d,uat=function(){var o=oat(this),s="";return o.hasIndices&&(s+="d"),o.global&&(s+="g"),o.ignoreCase&&(s+="i"),o.multiline&&(s+="m"),o.dotAll&&(s+="s"),o.unicode&&(s+="u"),o.unicodeSets&&(s+="v"),o.sticky&&(s+="y"),s},s8=RegExp.prototype,a8=function(o){var s=o.flags;return s!==void 0||"flags"in s8||aat(o,"flags")||!cat(s8,o)?s:sat(uat,o)},lat=hU.charAt,c8=jE,dat=AT,hat=gE,pat=IE,fat=/./.exec,mat=TypeError,Eat=X_,u8=jE,l8=yE,gat=DM,J1=MM,d8=sS,h8=o6,$N=n0,_at=AT,vat=HR,yat=IE,Sat=a6,p8=a8,Tat=QP,bat=_t,Rat=FM,Cat=function(o,s,d){return s+(d?lat(o,s).length:1)},wat=function(o,s){var d=o.exec;if(hat(d)){var g=c8(d,o,s);return g!==null&&dat(g),g}if(pat(o)==="RegExp")return c8(fat,o,s);throw mat("RegExp#exec called on incompatible receiver")},f8=PI,Iat=RS("matchAll"),m8="RegExp String",E8=m8+" Iterator",Oat=f8.set,Aat=f8.getterFor(E8),Nat=TypeError,iV=l8("".indexOf),X1=l8("".matchAll),oV=!!X1&&!bat(function(){X1("a",/./)}),kat=gat(function(o,s,d,g){Oat(this,{type:E8,regexp:o,string:s,global:d,unicode:g,done:!1})},m8,function(){var o=Aat(this);if(o.done)return J1(void 0,!0);var s=o.regexp,d=o.string,g=wat(s,d);return g===null?(o.done=!0,J1(void 0,!0)):o.global?($N(g[0])===""&&(s.lastIndex=Cat(d,h8(s.lastIndex),o.unicode)),J1(g,!1)):(o.done=!0,J1(g,!1))}),g8=function(o){var s,d,g,b=_at(this),$=$N(o),Vt=Rat(b,RegExp),zt=$N(p8(b));return s=new Vt(Vt===RegExp?b.source:b,zt),d=!!~iV(zt,"g"),g=!!~iV(zt,"u"),s.lastIndex=h8(b.lastIndex),new kat(s,$,d,g)};Eat({target:"String",proto:!0,forced:oV},{matchAll:function(o){var s,d,g,b,$=d8(this);if(vat(o)){if(oV)return X1($,o)}else{if(Sat(o)&&(s=$N(d8(p8(o))),!~iV(s,"g")))throw Nat("`.matchAll` does not allow non-global regexes");if(oV)return X1($,o);if((g=Tat(o,Iat))===void 0&&yat(o)=="RegExp"&&(g=g8),g)return u8(g,o,$)}return d=$N($),b=new RegExp(o,"g"),u8(g8,b,d)}});var Pat=E0("String").matchAll,Dat=_d,Lat=Pat,sV=String.prototype,Mat=function(o){var s=o.matchAll;return typeof o=="string"||o===sV||Dat(sV,o)&&s===sV.matchAll?Lat:s},xat=j(Mat);function _8(o){function s(d,g,b,$){let Vt=d[$++];if(Vt==="__proto__")return!0;const zt=Number.isFinite(+Vt),_e=$>=d.length;return Vt=!Vt&&ZE.isArray(b)?b.length:Vt,_e?(ZE.hasOwnProp(b,Vt)?b[Vt]=[b[Vt],g]:b[Vt]=g,!zt):(b[Vt]&&ZE.isObject(b[Vt])||(b[Vt]=[]),s(d,g,b[Vt],$)&&ZE.isArray(b[Vt])&&(b[Vt]=function(_r){const _o={},ga=Object.keys(_r);let _a;const _c=ga.length;let tE;for(_a=0;_a<_c;_a++)tE=ga[_a],_o[tE]=_r[tE];return _o}(b[Vt])),!zt)}if(ZE.isFormData(o)&&ZE.isFunction(o.entries)){const d={};return ZE.forEachEntry(o,(g,b)=>{s(function($){return xat(ZE).call(ZE,/\w+|\[(\w*)]/g,$).map(Vt=>Vt[0]==="[]"?"":Vt[1]||Vt[0])}(g),b,d,0)}),d}return null}const aV={transitional:I3,adapter:["xhr","http"],transformRequest:[function(o,s){const d=s.getContentType()||"",g=d.indexOf("application/json")>-1,b=ZE.isObject(o);if(b&&ZE.isHTMLForm(o)&&(o=new FormData(o)),ZE.isFormData(o))return g?JSON.stringify(_8(o)):o;if(ZE.isArrayBuffer(o)||ZE.isBuffer(o)||ZE.isStream(o)||ZE.isFile(o)||ZE.isBlob(o))return o;if(ZE.isArrayBufferView(o))return o.buffer;if(ZE.isURLSearchParams(o))return s.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),o.toString();let $;if(b){if(d.indexOf("application/x-www-form-urlencoded")>-1)return function(Vt,zt){return U1(Vt,new uR.classes.URLSearchParams,Object.assign({visitor:function(_e,_r,_o,ga){return uR.isNode&&ZE.isBuffer(_e)?(this.append(_r,_e.toString("base64")),!1):ga.defaultVisitor.apply(this,arguments)}},zt))}(o,this.formSerializer).toString();if(($=ZE.isFileList(o))||d.indexOf("multipart/form-data")>-1){const Vt=this.env&&this.env.FormData;return U1($?{"files[]":o}:o,Vt&&new Vt,this.formSerializer)}}return b||g?(s.setContentType("application/json",!1),function(Vt,zt,_e){if(ZE.isString(Vt))try{return(zt||JSON.parse)(Vt),dT(ZE).call(ZE,Vt)}catch(_r){if(_r.name!=="SyntaxError")throw _r}return(0,JSON.stringify)(Vt)}(o)):o}],transformResponse:[function(o){const s=this.transitional||aV.transitional,d=s&&s.forcedJSONParsing,g=this.responseType==="json";if(o&&ZE.isString(o)&&(d&&!this.responseType||g)){const b=!(s&&s.silentJSONParsing)&&g;try{return JSON.parse(o)}catch($){if(b)throw $.name==="SyntaxError"?aS.from($,aS.ERR_BAD_RESPONSE,this,null,this.response):$}}return o}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:uR.classes.FormData,Blob:uR.classes.Blob},validateStatus:function(o){return o>=200&&o<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ZE.forEach(["delete","get","head","post","put","patch"],o=>{aV.headers[o]={}});var cV=aV;const Uat=ZE.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),v8=Symbol("internals");function _k(o){var s;return o&&dT(s=String(o)).call(s).toLowerCase()}function Q1(o){return o===!1||o==null?o:ZE.isArray(o)?o.map(Q1):String(o)}function uV(o,s,d,g,b){return ZE.isFunction(g)?g.call(this,s,d):(b&&(s=d),ZE.isString(s)?ZE.isString(g)?s.indexOf(g)!==-1:ZE.isRegExp(g)?g.test(s):void 0:void 0)}class Z1{constructor(s){s&&this.set(s)}set(s,d,g){const b=this;function $(_e,_r,_o){const ga=_k(_r);if(!ga)throw new Error("header name must be a non-empty string");const _a=ZE.findKey(b,ga);(!_a||b[_a]===void 0||_o===!0||_o===void 0&&b[_a]!==!1)&&(b[_a||_r]=Q1(_e))}const Vt=(_e,_r)=>ZE.forEach(_e,(_o,ga)=>$(_o,ga,_r));var zt;return ZE.isPlainObject(s)||s instanceof this.constructor?Vt(s,d):ZE.isString(s)&&(s=dT(s).call(s))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(dT(zt=s).call(zt))?Vt((_e=>{const _r={};let _o,ga,_a;return _e&&_e.split(`
`).forEach(function(_c){var tE,_p;_a=_c.indexOf(":"),_o=dT(tE=_c.substring(0,_a)).call(tE).toLowerCase(),ga=dT(_p=_c.substring(_a+1)).call(_p),!_o||_r[_o]&&Uat[_o]||(_o==="set-cookie"?_r[_o]?_r[_o].push(ga):_r[_o]=[ga]:_r[_o]=_r[_o]?_r[_o]+", "+ga:ga)}),_r})(s),d):s!=null&&$(d,s,g),this}get(s,d){if(s=_k(s)){const g=ZE.findKey(this,s);if(g){const b=this[g];if(!d)return b;if(d===!0)return function($){const Vt=Object.create(null),zt=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _e;for(;_e=zt.exec($);)Vt[_e[1]]=_e[2];return Vt}(b);if(ZE.isFunction(d))return d.call(this,b,g);if(ZE.isRegExp(d))return d.exec(b);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,d){if(s=_k(s)){const g=ZE.findKey(this,s);return!(!g||this[g]===void 0||d&&!uV(0,this[g],g,d))}return!1}delete(s,d){const g=this;let b=!1;function $(Vt){if(Vt=_k(Vt)){const zt=ZE.findKey(g,Vt);!zt||d&&!uV(0,g[zt],zt,d)||(delete g[zt],b=!0)}}return ZE.isArray(s)?s.forEach($):$(s),b}clear(s){const d=Object.keys(this);let g=d.length,b=!1;for(;g--;){const $=d[g];s&&!uV(0,this[$],$,s,!0)||(delete this[$],b=!0)}return b}normalize(s){const d=this,g={};return ZE.forEach(this,(b,$)=>{var Vt;const zt=ZE.findKey(g,$);if(zt)return d[zt]=Q1(b),void delete d[$];const _e=s?function(_r){return dT(_r).call(_r).toLowerCase().replace(/([a-z\d])(\w*)/g,(_o,ga,_a)=>ga.toUpperCase()+_a)}($):dT(Vt=String($)).call(Vt);_e!==$&&delete d[$],d[_e]=Q1(b),g[_e]=!0}),this}concat(){for(var s=arguments.length,d=new Array(s),g=0;g<s;g++)d[g]=arguments[g];return this.constructor.concat(this,...d)}toJSON(s){const d=Object.create(null);return ZE.forEach(this,(g,b)=>{g!=null&&g!==!1&&(d[b]=s&&ZE.isArray(g)?g.join(", "):g)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(s=>{let[d,g]=s;return d+": "+g}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s){const d=new this(s);for(var g=arguments.length,b=new Array(g>1?g-1:0),$=1;$<g;$++)b[$-1]=arguments[$];return b.forEach(Vt=>d.set(Vt)),d}static accessor(s){const d=(this[v8]=this[v8]={accessors:{}}).accessors,g=this.prototype;function b($){const Vt=_k($);d[Vt]||(function(zt,_e){const _r=ZE.toCamelCase(" "+_e);["get","set","has"].forEach(_o=>{Object.defineProperty(zt,_o+_r,{value:function(ga,_a,_c){return this[_o].call(this,_e,ga,_a,_c)},configurable:!0})})}(g,$),d[Vt]=!0)}return ZE.isArray(s)?s.forEach(b):b(s),this}}Z1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ZE.reduceDescriptors(Z1.prototype,(o,s)=>{let{value:d}=o,g=s[0].toUpperCase()+s.slice(1);return{get:()=>d,set(b){this[g]=b}}}),ZE.freezeMethods(Z1);var AR=Z1;function lV(o,s){const d=this||cV,g=s||d,b=AR.from(g.headers);let $=g.data;return ZE.forEach(o,function(Vt){$=Vt.call(d,$,b.normalize(),s?s.status:void 0)}),b.normalize(),$}function y8(o){return!(!o||!o.__CANCEL__)}function tP(o,s,d){aS.call(this,o??"canceled",aS.ERR_CANCELED,s,d),this.name="CanceledError"}ZE.inherits(tP,aS,{__CANCEL__:!0});var jat=uR.hasStandardBrowserEnv?{write(o,s,d,g,b,$){const Vt=[o+"="+encodeURIComponent(s)];ZE.isNumber(d)&&Vt.push("expires="+new Date(d).toGMTString()),ZE.isString(g)&&Vt.push("path="+g),ZE.isString(b)&&Vt.push("domain="+b),$===!0&&Vt.push("secure"),document.cookie=Vt.join("; ")},read(o){const s=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(o){this.write(o,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function S8(o,s){return o&&!function(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)}(s)?function(d,g){return g?d.replace(/\/?\/$/,"")+"/"+g.replace(/^\/+/,""):d}(o,s):s}var Vat=uR.hasStandardBrowserEnv?function(){const o=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");let d;function g(b){let $=b;return o&&(s.setAttribute("href",$),$=s.href),s.setAttribute("href",$),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:s.pathname.charAt(0)==="/"?s.pathname:"/"+s.pathname}}return d=g(window.location.href),function(b){const $=ZE.isString(b)?g(b):b;return $.protocol===d.protocol&&$.host===d.host}}():function(){return!0};function T8(o,s){let d=0;const g=function(b,$){b=b||10;const Vt=new Array(b),zt=new Array(b);let _e,_r=0,_o=0;return $=$!==void 0?$:1e3,function(ga){const _a=Date.now(),_c=zt[_o];_e||(_e=_a),Vt[_r]=ga,zt[_r]=_a;let tE=_o,_p=0;for(;tE!==_r;)_p+=Vt[tE++],tE%=b;if(_r=(_r+1)%b,_r===_o&&(_o=(_o+1)%b),_a-_e<$)return;const _f=_c&&_a-_c;return _f?Math.round(1e3*_p/_f):void 0}}(50,250);return b=>{const $=b.loaded,Vt=b.lengthComputable?b.total:void 0,zt=$-d,_e=g(zt);d=$;const _r={loaded:$,total:Vt,progress:Vt?$/Vt:void 0,bytes:zt,rate:_e||void 0,estimated:_e&&Vt&&$<=Vt?(Vt-$)/_e:void 0,event:b};_r[s?"download":"upload"]=!0,o(_r)}}var Fat=typeof XMLHttpRequest<"u"&&function(o){return new GE(function(s,d){let g=o.data;const b=AR.from(o.headers).normalize();let $,Vt,{responseType:zt,withXSRFToken:_e}=o;function _r(){o.cancelToken&&o.cancelToken.unsubscribe($),o.signal&&o.signal.removeEventListener("abort",$)}if(ZE.isFormData(g)){if(uR.hasStandardBrowserEnv||uR.hasStandardBrowserWebWorkerEnv)b.setContentType(!1);else if((Vt=b.getContentType())!==!1){const[tE,..._p]=Vt?Vt.split(";").map(_f=>dT(_f).call(_f)).filter(Boolean):[];b.setContentType([tE||"multipart/form-data",..._p].join("; "))}}let _o=new XMLHttpRequest;if(o.auth){const tE=o.auth.username||"",_p=o.auth.password?unescape(encodeURIComponent(o.auth.password)):"";b.set("Authorization","Basic "+btoa(tE+":"+_p))}const ga=S8(o.baseURL,o.url);function _a(){if(!_o)return;const tE=AR.from("getAllResponseHeaders"in _o&&_o.getAllResponseHeaders());(function(_p,_f,eE){const iE=eE.config.validateStatus;eE.status&&iE&&!iE(eE.status)?_f(new aS("Request failed with status code "+eE.status,[aS.ERR_BAD_REQUEST,aS.ERR_BAD_RESPONSE][Math.floor(eE.status/100)-4],eE.config,eE.request,eE)):_p(eE)})(function(_p){s(_p),_r()},function(_p){d(_p),_r()},{data:zt&&zt!=="text"&&zt!=="json"?_o.response:_o.responseText,status:_o.status,statusText:_o.statusText,headers:tE,config:o,request:_o}),_o=null}if(_o.open(o.method.toUpperCase(),C3(ga,o.params,o.paramsSerializer),!0),_o.timeout=o.timeout,"onloadend"in _o?_o.onloadend=_a:_o.onreadystatechange=function(){_o&&_o.readyState===4&&(_o.status!==0||_o.responseURL&&_o.responseURL.indexOf("file:")===0)&&setTimeout(_a)},_o.onabort=function(){_o&&(d(new aS("Request aborted",aS.ECONNABORTED,o,_o)),_o=null)},_o.onerror=function(){d(new aS("Network Error",aS.ERR_NETWORK,o,_o)),_o=null},_o.ontimeout=function(){let tE=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const _p=o.transitional||I3;o.timeoutErrorMessage&&(tE=o.timeoutErrorMessage),d(new aS(tE,_p.clarifyTimeoutError?aS.ETIMEDOUT:aS.ECONNABORTED,o,_o)),_o=null},uR.hasStandardBrowserEnv&&(_e&&ZE.isFunction(_e)&&(_e=_e(o)),_e||_e!==!1&&Vat(ga))){const tE=o.xsrfHeaderName&&o.xsrfCookieName&&jat.read(o.xsrfCookieName);tE&&b.set(o.xsrfHeaderName,tE)}g===void 0&&b.setContentType(null),"setRequestHeader"in _o&&ZE.forEach(b.toJSON(),function(tE,_p){_o.setRequestHeader(_p,tE)}),ZE.isUndefined(o.withCredentials)||(_o.withCredentials=!!o.withCredentials),zt&&zt!=="json"&&(_o.responseType=o.responseType),typeof o.onDownloadProgress=="function"&&_o.addEventListener("progress",T8(o.onDownloadProgress,!0)),typeof o.onUploadProgress=="function"&&_o.upload&&_o.upload.addEventListener("progress",T8(o.onUploadProgress)),(o.cancelToken||o.signal)&&($=tE=>{_o&&(d(!tE||tE.type?new tP(null,o,_o):tE),_o.abort(),_o=null)},o.cancelToken&&o.cancelToken.subscribe($),o.signal&&(o.signal.aborted?$():o.signal.addEventListener("abort",$)));const _c=function(tE){const _p=/^([-+\w]{1,25})(:?\/\/|:)/.exec(tE);return _p&&_p[1]||""}(ga);_c&&uR.protocols.indexOf(_c)===-1?d(new aS("Unsupported protocol "+_c+":",aS.ERR_BAD_REQUEST,o)):_o.send(g||null)})};const dV={http:null,xhr:Fat};ZE.forEach(dV,(o,s)=>{if(o){try{Object.defineProperty(o,"name",{value:s})}catch{}Object.defineProperty(o,"adapterName",{value:s})}});const b8=o=>"- ".concat(o),Bat=o=>ZE.isFunction(o)||o===null||o===!1;var R8={getAdapter:o=>{o=ZE.isArray(o)?o:[o];const{length:s}=o;let d,g;const b={};for(let $=0;$<s;$++){let Vt;if(d=o[$],g=d,!Bat(d)&&(g=dV[(Vt=String(d)).toLowerCase()],g===void 0))throw new aS("Unknown adapter '".concat(Vt,"'"));if(g)break;b[Vt||"#"+$]=g}if(!g){const $=Object.entries(b).map(Vt=>{let[zt,_e]=Vt;return"adapter ".concat(zt," ")+(_e===!1?"is not supported by the environment":"is not available in the build")});throw new aS("There is no suitable adapter to dispatch the request "+(s?$.length>1?`since :
`+$.map(b8).join(`
`):" "+b8($[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return g},adapters:dV};function hV(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new tP(null,o)}function C8(o){return hV(o),o.headers=AR.from(o.headers),o.data=lV.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),R8.getAdapter(o.adapter||cV.adapter)(o).then(function(s){return hV(o),s.data=lV.call(o,o.transformResponse,s),s.headers=AR.from(s.headers),s},function(s){return y8(s)||(hV(o),s&&s.response&&(s.response.data=lV.call(o,o.transformResponse,s.response),s.response.headers=AR.from(s.response.headers))),GE.reject(s)})}function w8(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}const I8=o=>o instanceof AR?function(s){for(var d=1;d<arguments.length;d++){var g=arguments[d]!=null?arguments[d]:{};d%2?w8(Object(g),!0).forEach(function(b){Qm(s,b,g[b])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(g)):w8(Object(g)).forEach(function(b){Object.defineProperty(s,b,Object.getOwnPropertyDescriptor(g,b))})}return s}({},o):o;function xO(o,s){s=s||{};const d={};function g(_r,_o,ga){return ZE.isPlainObject(_r)&&ZE.isPlainObject(_o)?ZE.merge.call({caseless:ga},_r,_o):ZE.isPlainObject(_o)?ZE.merge({},_o):ZE.isArray(_o)?_o.slice():_o}function b(_r,_o,ga){return ZE.isUndefined(_o)?ZE.isUndefined(_r)?void 0:g(void 0,_r,ga):g(_r,_o,ga)}function $(_r,_o){if(!ZE.isUndefined(_o))return g(void 0,_o)}function Vt(_r,_o){return ZE.isUndefined(_o)?ZE.isUndefined(_r)?void 0:g(void 0,_r):g(void 0,_o)}function zt(_r,_o,ga){return ga in s?g(_r,_o):ga in o?g(void 0,_r):void 0}const _e={url:$,method:$,data:$,baseURL:Vt,transformRequest:Vt,transformResponse:Vt,paramsSerializer:Vt,timeout:Vt,timeoutMessage:Vt,withCredentials:Vt,withXSRFToken:Vt,adapter:Vt,responseType:Vt,xsrfCookieName:Vt,xsrfHeaderName:Vt,onUploadProgress:Vt,onDownloadProgress:Vt,decompress:Vt,maxContentLength:Vt,maxBodyLength:Vt,beforeRedirect:Vt,transport:Vt,httpAgent:Vt,httpsAgent:Vt,cancelToken:Vt,socketPath:Vt,responseEncoding:Vt,validateStatus:zt,headers:(_r,_o)=>b(I8(_r),I8(_o),!0)};return ZE.forEach(Object.keys(Object.assign({},o,s)),function(_r){const _o=_e[_r]||b,ga=_o(o[_r],s[_r],_r);ZE.isUndefined(ga)&&_o!==zt||(d[_r]=ga)}),d}const O8="1.6.8",pV={};["object","boolean","number","function","string","symbol"].forEach((o,s)=>{pV[o]=function(d){return typeof d===o||"a"+(s<1?"n ":" ")+o}});const A8={};pV.transitional=function(o,s,d){function g(b,$){return"[Axios v"+O8+"] Transitional option '"+b+"'"+$+(d?". "+d:"")}return(b,$,Vt)=>{if(o===!1)throw new aS(g($," has been removed"+(s?" in "+s:"")),aS.ERR_DEPRECATED);return s&&!A8[$]&&(A8[$]=!0,console.warn(g($," has been deprecated since v"+s+" and will be removed in the near future"))),!o||o(b,$,Vt)}};var fV={assertOptions:function(o,s,d){if(typeof o!="object")throw new aS("options must be an object",aS.ERR_BAD_OPTION_VALUE);const g=Object.keys(o);let b=g.length;for(;b-- >0;){const $=g[b],Vt=s[$];if(Vt){const zt=o[$],_e=zt===void 0||Vt(zt,$,o);if(_e!==!0)throw new aS("option "+$+" must be "+_e,aS.ERR_BAD_OPTION_VALUE)}else if(d!==!0)throw new aS("Unknown option "+$,aS.ERR_BAD_OPTION)}},validators:pV};const _C=fV.validators;let $1=class{constructor(o){this.defaults=o,this.interceptors={request:new w3,response:new w3}}async request(o,s){try{return await this._request(o,s)}catch(d){if(d instanceof Error){let g;Error.captureStackTrace?Error.captureStackTrace(g={}):g=new Error;const b=g.stack?g.stack.replace(/^.+\n/,""):"";d.stack?b&&!String(d.stack).endsWith(b.replace(/^.+\n.+\n/,""))&&(d.stack+=`
`+b):d.stack=b}throw d}}_request(o,s){typeof o=="string"?(s=s||{}).url=o:s=o||{},s=xO(this.defaults,s);const{transitional:d,paramsSerializer:g,headers:b}=s;d!==void 0&&fV.assertOptions(d,{silentJSONParsing:_C.transitional(_C.boolean),forcedJSONParsing:_C.transitional(_C.boolean),clarifyTimeoutError:_C.transitional(_C.boolean)},!1),g!=null&&(ZE.isFunction(g)?s.paramsSerializer={serialize:g}:fV.assertOptions(g,{encode:_C.function,serialize:_C.function},!0)),s.method=(s.method||this.defaults.method||"get").toLowerCase();let $=b&&ZE.merge(b.common,b[s.method]);b&&ZE.forEach(["delete","get","head","post","put","patch","common"],_c=>{delete b[_c]}),s.headers=AR.concat($,b);const Vt=[];let zt=!0;this.interceptors.request.forEach(function(_c){typeof _c.runWhen=="function"&&_c.runWhen(s)===!1||(zt=zt&&_c.synchronous,Vt.unshift(_c.fulfilled,_c.rejected))});const _e=[];let _r;this.interceptors.response.forEach(function(_c){_e.push(_c.fulfilled,_c.rejected)});let _o,ga=0;if(!zt){const _c=[C8.bind(this),void 0];for(_c.unshift.apply(_c,Vt),_c.push.apply(_c,_e),_o=_c.length,_r=GE.resolve(s);ga<_o;)_r=_r.then(_c[ga++],_c[ga++]);return _r}_o=Vt.length;let _a=s;for(ga=0;ga<_o;){const _c=Vt[ga++],tE=Vt[ga++];try{_a=_c(_a)}catch(_p){tE.call(this,_p);break}}try{_r=C8.call(this,_a)}catch(_c){return GE.reject(_c)}for(ga=0,_o=_e.length;ga<_o;)_r=_r.then(_e[ga++],_e[ga++]);return _r}getUri(o){return C3(S8((o=xO(this.defaults,o)).baseURL,o.url),o.params,o.paramsSerializer)}};ZE.forEach(["delete","get","head","options"],function(o){$1.prototype[o]=function(s,d){return this.request(xO(d||{},{method:o,url:s,data:(d||{}).data}))}}),ZE.forEach(["post","put","patch"],function(o){function s(d){return function(g,b,$){return this.request(xO($||{},{method:o,headers:d?{"Content-Type":"multipart/form-data"}:{},url:g,data:b}))}}$1.prototype[o]=s(),$1.prototype[o+"Form"]=s(!0)});var tD=$1;class mV{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let d;this.promise=new GE(function(b){d=b});const g=this;this.promise.then(b=>{if(!g._listeners)return;let $=g._listeners.length;for(;$-- >0;)g._listeners[$](b);g._listeners=null}),this.promise.then=b=>{let $;const Vt=new GE(zt=>{g.subscribe(zt),$=zt}).then(b);return Vt.cancel=function(){g.unsubscribe($)},Vt},s(function(b,$,Vt){g.reason||(g.reason=new tP(b,$,Vt),d(g.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){this.reason?s(this.reason):this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const d=this._listeners.indexOf(s);d!==-1&&this._listeners.splice(d,1)}static source(){let s;return{token:new mV(function(d){s=d}),cancel:s}}}var Gat=mV;const EV={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(EV).forEach(o=>{let[s,d]=o;EV[d]=s});var Wat=EV;const cT=function o(s){const d=new tD(s),g=u3(tD.prototype.request,d);return ZE.extend(g,tD.prototype,d,{allOwnKeys:!0}),ZE.extend(g,d,null,{allOwnKeys:!0}),g.create=function(b){return o(xO(s,b))},g}(cV);cT.Axios=tD,cT.CanceledError=tP,cT.CancelToken=Gat,cT.isCancel=y8,cT.VERSION=O8,cT.toFormData=U1,cT.AxiosError=aS,cT.Cancel=cT.CanceledError,cT.all=function(o){return GE.all(o)},cT.spread=function(o){return function(s){return o.apply(null,s)}},cT.isAxiosError=function(o){return ZE.isObject(o)&&o.isAxiosError===!0},cT.mergeConfig=xO,cT.AxiosHeaders=AR,cT.formToJSON=o=>_8(ZE.isHTMLForm(o)?new FormData(o):o),cT.getAdapter=R8.getAdapter,cT.HttpStatusCode=Wat,cT.default=cT;var RT=cT;const qat=()=>{};function eP(){const o={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:qat};return o.promise=new GE((s,d)=>{o.resolve=g=>{o.isFinished||(o.isResolved=!0,o.isFinished=!0,s(g),o.value=g)},o.reject=g=>{o.isFinished||(o.isRejected=!0,o.isFinished=!0,d(g))}}),o}const sD=new Map,uD=new Map,lR=new Map;let BS=function(o){return o.WIN_10="Windows 10",o.WIN_81="Windows 8.1",o.WIN_8="Windows 8",o.WIN_7="Windows 7",o.WIN_VISTA="Windows Vista",o.WIN_SERVER_2003="Windows Server 2003",o.WIN_XP="Windows XP",o.WIN_2000="Windows 2000",o.ANDROID="Android",o.HARMONY_OS="HarmonyOS",o.OPEN_BSD="Open BSD",o.SUN_OS="Sun OS",o.LINUX="Linux",o.IOS="iOS",o.MAC_OS="Mac OS",o.CHROMIUM_OS="Chromium OS",o.QNX="QNX",o.UNIX="UNIX",o.BEOS="BeOS",o.OS_2="OS/2",o.SEARCH_BOT="Search Bot",o}({}),M_=function(o){return o.CHROME="Chrome",o.SAFARI="Safari",o.EDGE="Edge",o.FIREFOX="Firefox",o.OPERA="OPR",o.QQ="QQBrowser",o.WECHAT="MicroMessenger",o}({});const N8=new dit;let G0=N8.getResult(),gV=null;function O_(o){if(!gV){G0=N8.getResult();const s=function(zt){if(zt.engine.name==="Blink"&&zt.browser.name!=="WeChat")return M_.CHROME;switch(zt.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return M_.CHROME;case"Safari":case"Mobile Safari":return M_.SAFARI;case"Edge":return M_.EDGE;case"Firefox":return M_.FIREFOX;case"QQ":case"QQBrowser":return M_.QQ;case"Opera":return M_.OPERA;case"WeChat":return M_.WECHAT;default:return zt.browser.name||""}}(G0),d=k8(G0),g=function(zt){return zt.os.name==="Windows"?zt.os.version?zt.os.name+" "+zt.os.version:zt.os.name:zt.os.name||""}(G0),b=G0.os.version,$=k8(G0,!1),Vt=G0.device.type;if(!(s&&d&&g&&b))return{name:s,version:d,os:g,osVersion:b,browserVersion:$,deviceType:Vt};gV={name:s,version:d,os:g,osVersion:b,browserVersion:$,deviceType:Vt}}return gV}function k8(o){let s,d=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return s=o.engine.name==="Blink"?o.engine.version||"":o.browser.version||"",d?s.split(".")[0]:s}function ED(){return O_().os}function P8(){const o=O_();return"".concat(o.os," ").concat(o.osVersion)}function _D(){const o=O_();return!!(G0.engine.name==="WebKit"&&o.os===BS.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&o.name!==M_.SAFARI||oT()&&o.name!==M_.SAFARI)}function _w(){return O_().name===M_.CHROME}function GS(){return O_().name===M_.SAFARI}function D8(){return O_().name===M_.EDGE}function H_(){return O_().name===M_.FIREFOX}function oT(){return O_().os===BS.IOS}function _V(o){const s=O_();return!(s.name!==M_.CHROME||!s.osVersion)&&Number(s.version)>=o}function L8(o){const s=O_();return!(s.name!==M_.EDGE||!s.osVersion)&&Number(s.version)>=o}function M8(o){const s=O_();return!(s.name!==M_.SAFARI||!s.osVersion)&&Number(s.version)>=o}function x8(o,s,d){const g=O_();if(g.os!==BS.IOS||!g.osVersion)return!1;const b=g.osVersion.split(".");return s&&Number(b[0])===o&&Number(b[1])<s||Number(b[0])<o}function U8(o,s,d){const g=O_();if(g.name!==M_.SAFARI||!g.osVersion||!g.browserVersion)return!1;const b=g.browserVersion.split(".");return s&&Number(b[0])===o&&Number(b[1])<s||Number(b[0])<o}function j8(o){const s=O_();return!(s.name!==M_.OPERA||!s.osVersion)&&Number(s.version)>=o}function V8(){const o=O_();return!(o.name!==M_.CHROME||!o.osVersion)&&Number(o.version)<=90}function F8(){const o=O_();if(o.os!==BS.IOS||!o.osVersion)return!1;const s=o.osVersion.split(".");return Number(s[0])<14||Number(s[0])===14&&Number(s[1])<=6}function UO(){const o=O_();if(o.os!==BS.IOS||!o.osVersion)return!1;const s=o.osVersion.split(".");return Number(s[0])===15}function vV(){const o=O_();if(o.os!==BS.IOS||!o.osVersion)return!1;const s=o.osVersion.split(".");return Number(s[0])===16}function B8(){const o=O_();if(o.os!==BS.IOS||!o.osVersion)return!1;const s=o.osVersion.split(".");return Number(s[0])===15&&Number(s[1])>=1}function v0(){return GS()&&navigator.maxTouchPoints>0}function G8(){return O_().name===M_.WECHAT}function W8(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function yV(){const o=ED();return function(){const{deviceType:s}=O_();return s==="mobile"||s==="tablet"}()||o===BS.ANDROID||o===BS.IOS||o===BS.HARMONY_OS}function tI(){const o=O_();return o.name!==M_.EDGE&&o.name!==M_.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function vD(){return ED()===BS.ANDROID}function nP(){const o=O_();return vD()&&(o.name===M_.CHROME||o.name===M_.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function q8(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function e_(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?q8(Object(d),!0).forEach(function(g){tS(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):q8(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}function tS(o,s,d){return(s=function(g){var b=function($,Vt){if(typeof $!="object"||$===null)return $;var zt=$[Symbol.toPrimitive];if(zt!==void 0){var _e=zt.call($,"string");if(typeof _e!="object")return _e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String($)}(g);return typeof b=="symbol"?b:String(b)}(s))in o?Object.defineProperty(o,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):o[s]=d,o}let rE=function(o){return o.UNEXPECTED_ERROR="UNEXPECTED_ERROR",o.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",o.TIMEOUT="TIMEOUT",o.INVALID_PARAMS="INVALID_PARAMS",o.NOT_READABLE="NOT_READABLE",o.NOT_SUPPORTED="NOT_SUPPORTED",o.INVALID_OPERATION="INVALID_OPERATION",o.OPERATION_ABORTED="OPERATION_ABORTED",o.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",o.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",o.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",o.DATACHANNEL_FAILED="DATACHANNEL_FAILED",o.NETWORK_ERROR="NETWORK_ERROR",o.NETWORK_TIMEOUT="NETWORK_TIMEOUT",o.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",o.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",o.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",o.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",o.ELECTRON_IS_NULL="ELECTRON_IS_NULL",o.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",o.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",o.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",o.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",o.PERMISSION_DENIED="PERMISSION_DENIED",o.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",o.TRACK_IS_DISABLED="TRACK_IS_DISABLED",o.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",o.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",o.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",o.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",o.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",o.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",o.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",o.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",o.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",o.UID_CONFLICT="UID_CONFLICT",o.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",o.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",o.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",o.INVALID_TRACK="INVALID_TRACK",o.SENDER_NOT_FOUND="SENDER_NOT_FOUND",o.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",o.SET_ANSWER_FAILED="SET_ANSWER_FAILED",o.ICE_FAILED="ICE_FAILED",o.PC_CLOSED="PC_CLOSED",o.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",o.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",o.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",o.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",o.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",o.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",o.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",o.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",o.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",o.INVALID_REMOTE_USER="INVALID_REMOTE_USER",o.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",o.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",o.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",o.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",o.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",o.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",o.WS_ABORT="WS_ABORT",o.WS_DISCONNECT="WS_DISCONNECT",o.WS_ERR="WS_ERR",o.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",o.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",o.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",o.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",o.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",o.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",o.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",o.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",o.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",o.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",o.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",o.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",o.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",o.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",o.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",o.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",o.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",o.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",o.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",o.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",o.INVALID_PLUGIN="INVALID_PLUGIN",o.DISCONNECT_P2P="DISCONNECT_P2P",o.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",o.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",o.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",o.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",o.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",o.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",o.PROHIBITED_OPERATION="PROHIBITED_OPERATION",o.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",o.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",o}({});class TE extends Error{constructor(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",g=arguments.length>2?arguments[2]:void 0;super(d),tS(this,"code",void 0),tS(this,"message",void 0),tS(this,"data",void 0),tS(this,"name","AgoraRTCException"),this.code=s,this.message="AgoraRTCError ".concat(this.code,": ").concat(d),this.data=g}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",d=arguments.length>1?arguments[1]:void 0;return s==="error"&&(d||console).error(this.toString()),s==="warning"&&(d||console).warn(this.toString()),this}throw(s){throw this.print("error",s),this}}function NR(o,s){if(typeof o!="boolean")throw new TE(rE.INVALID_PARAMS,"Invalid ".concat(s,": The value is of the boolean type."))}function VS(o,s,d){if(!KE(d).call(d,o))throw new TE(rE.INVALID_PARAMS,"".concat(s," can only be set as ").concat(JSON.stringify(d)))}function W_(o,s){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(o<d||o>g||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(b){return typeof b=="number"&&b%1==0}(o))throw new TE(rE.INVALID_PARAMS,"invalid ".concat(s,": the value range is [").concat(d,", ").concat(g,"]. integer only"))}function SV(o,s){if(typeof o!="number"){if(!(o.min||o.max||o.ideal||o.exact))throw new TE(rE.INVALID_PARAMS,"".concat(s," is not a valid ConstrainLong"));o.min!==void 0&&W_(o.min,"".concat(s,".min"),0,1/0),o.max!==void 0&&W_(o.max,"".concat(s,".max"),1,1/0),o.exact!==void 0&&W_(o.exact,"".concat(s,".exact"),1,1/0),o.ideal!==void 0&&W_(o.ideal,"".concat(s,".ideal"),1,1/0)}else W_(o,s,1,1/0)}function QS(o,s){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,b=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(o==null)throw new TE(rE.INVALID_PARAMS,"".concat(s||"param"," cannot be empty"));if(!H8(o,d,g,b))throw new TE(rE.INVALID_PARAMS,"Invalid ".concat(s||"string param",": Length of the string: [").concat(d,",").concat(g,"].").concat(b?" ASCII characters only.":""))}function kR(o,s){if(!Array.isArray(o))throw new TE(rE.INVALID_PARAMS,"".concat(s," should be an array"))}function dS(o){return o==null}function H8(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,g=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof o=="string"&&o.length<=d&&o.length>=s&&(!g||function(b){if(typeof b!="string")return!1;for(let $=0;$<b.length;$+=1){const Vt=b.charCodeAt($);if(Vt<0||Vt>255)return!1}return!0}(o))}function K8(o,s,d){if("getBigUint64"in DataView.prototype)return o.getBigUint64(s,d);const g=o.getUint32(s,d),b=o.getUint32(s+4,d),$=+!!d,Vt=+!d;return BigInt(g*Vt+b*$)<<BigInt(32)|BigInt(g*$+b*Vt)}function z8(o,s,d,g){if("setBigUint64"in DataView.prototype)return o.setBigUint64(s,d,g);const b=Number(d>>BigInt(32)),$=Number(d&BigInt(4294967295));o.setUint32(s,b,g),o.setUint32(s+4,$,g)}var rP=function(o){return o.COVERED="COVERED",o.POSITION="POSITION",o.SIZE="SIZE",o.STYLE="STYLE",o}(rP||{}),TV=function(o){return o.UNMOUNTED="UNMOUNTED",o.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",o}(TV||{});const Y8=new class{constructor(){tS(this,"_clientSize",null),tS(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),tS(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),tS(this,"getStyle",o=>window.getComputedStyle(o,null)),tS(this,"checkCssVisibleProperty",o=>{var s;let d=!0;const g=this.getStyle(o),{display:b,visibility:$,opacity:Vt,filter:zt}=g;return(b==="none"||KE(s=["hidden","collapse"]).call(s,$)||Number(Vt)<.1)&&(d=!1),!!d&&(zt&&zt.split(" ").filter(_e=>{var _r;const _o=_e.split("(")[0];return KE(_r=["brightness","blur","opacity"]).call(_r,_o)}).map(_e=>{const[_r,_o]=_e.split(/\(|\)/);return[_r,Number(_o.match(/^[0-9\.]+/))]}).forEach(_e=>{const[_r,_o]=_e;switch(_r){case"brightness":(_o<.1||_o>3)&&(d=!1);break;case"blur":_o>3&&(d=!1);break;case"opacity":_o<.1&&(d=!1)}}),d)}),tS(this,"checkPropertyUpToAllParentNodes",(o,s)=>{let d=!0,g=!0;const b=Vt=>s(Vt);let $=o;for(;$&&g;)b($)||(d=!1,g=!1),$=$.parentElement,$||(g=!1);return d}),tS(this,"checkActualCssVisibleIncludeInherit",o=>this.checkPropertyUpToAllParentNodes(o,this.checkCssVisibleProperty)),tS(this,"getSizeAboutClient",o=>{const{width:s,height:d,left:g,right:b,top:$,bottom:Vt}=o.getBoundingClientRect(),zt=this.getClientWidth(),_e=this.getClientHeight();return{width:s,height:d,left:g,right:b,top:$,bottom:Vt,clientWidth:zt,clientHeight:_e,clientMin:Math.min(zt,_e)}}),tS(this,"checkActualSize",()=>{const{width:o,height:s,clientMin:d}=this._clientSize;return this.checkSizeIsVisible(o,s,d)}),tS(this,"elementFromPoint",(o,s)=>document.elementFromPoint?document.elementFromPoint(o,s):null),tS(this,"checkCoverForAPoint",(o,s,d)=>{const g=this.elementFromPoint(o,s);return g!==null&&g!==d}),tS(this,"getPointPositionList",()=>{const{width:o,height:s,left:d,top:g}=this._clientSize,b=o/6,$=s/6,Vt=[],zt=10**6;for(let _e=0;_e<5;_e++)for(let _r=0;_r<5;_r++){const _o=(d*zt+(_e===0?.1:_e===4?(b*_e*zt-1e5)/zt:b*_e)*zt)/zt,ga=(g*zt+(_r===0?.1:_r===4?($*_r*zt-1e5)/zt:$*_r)*zt)/zt;Vt.push({x:_o,y:ga})}return[...Vt]}),tS(this,"checkElementCover",o=>this.getPointPositionList().map(s=>this.checkCoverForAPoint(s.x,s.y,o)).filter(s=>!!s).length>6),tS(this,"checkSizeIsVisible",(o,s,d)=>(o>50||d/o<=10)&&(s>50||d/s<=10)),tS(this,"checkSizeOfPartInClient",()=>{const{left:o,right:s,top:d,bottom:g,clientHeight:b,clientWidth:$,clientMin:Vt}=this._clientSize;let zt,_e,_r,_o;if(o<0)zt=0;else{if(!(o<$))return!1;zt=o}if(s<0)return!1;if(_e=s<$?s:$,d<0)_r=0;else{if(!(d<b))return!1;_r=d}if(g<0)return!1;_o=g<b?g:b;const ga=_e-zt,_a=_o-_r;return this.checkSizeIsVisible(ga,_a,Vt)}),tS(this,"returnHiddenResult",o=>(this._clientSize=null,{visible:!1,reason:o})),tS(this,"checkOneElementVisible",o=>{if(o instanceof HTMLElement){if(this.checkElementIsMountedOnDom(o)){if(this.checkActualCssVisibleIncludeInherit(o)){if(this._clientSize=this.getSizeAboutClient(o),this.checkElementCover(o))return this.returnHiddenResult(rP.COVERED);{const s=this.checkActualSize(),d=this.checkSizeOfPartInClient();return s&&!d?this.returnHiddenResult(rP.POSITION):s?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(rP.SIZE)}}return this.returnHiddenResult(rP.STYLE)}return this.returnHiddenResult(TV.UNMOUNTED)}return this.returnHiddenResult(TV.INVALID_HTML_ELEMENT)}),tS(this,"checkElementIsMountedOnDom",o=>this.checkPropertyUpToAllParentNodes(o,s=>s.nodeName.toUpperCase()!=="HTML"?s.parentElement!==null:!!document.documentElement))}};function bV(o){return new TextEncoder().encode(o)}const J8=function(o,s){const d=new Uint8Array(o.byteLength+s.byteLength);return d.set(new Uint8Array(o),0),d.set(new Uint8Array(s),o.byteLength),d},RV=async o=>function(s,d){let g="";return new Uint8Array(s).forEach(b=>{g+=b.toString(d).padStart(2,"0")}),g}(await crypto.subtle.digest("SHA-256",bV(o)),16);let nS=class{constructor(){tS(this,"_events",{}),tS(this,"addListener",this.on)}getListeners(o){return this._events[o]?this._events[o].map(s=>s.listener):[]}on(o,s){this._events[o]||(this._events[o]=[]);const d=this._events[o];this._indexOfListener(d,s)===-1&&d.push({listener:s,once:!1})}once(o,s){this._events[o]||(this._events[o]=[]);const d=this._events[o];this._indexOfListener(d,s)===-1&&d.push({listener:s,once:!0})}off(o,s){if(!this._events[o])return;const d=this._events[o],g=this._indexOfListener(d,s);g!==-1&&d.splice(g,1),this._events[o].length===0&&delete this._events[o]}removeAllListeners(o){o?delete this._events[o]:this._events={}}emit(o){this._events[o]||(this._events[o]=[]);const s=this._events[o].map($=>$);for(var d=arguments.length,g=new Array(d>1?d-1:0),b=1;b<d;b++)g[b-1]=arguments[b];for(let $=0;$<s.length;$+=1){const Vt=s[$];Vt.once&&this.off(o,Vt.listener),Vt.listener.apply(this,g||[])}}safeEmit(o){for(var s=arguments.length,d=new Array(s>1?s-1:0),g=1;g<s;g++)d[g-1]=arguments[g];[...this._events[o]||[]].forEach(b=>{b.once&&this.off(o,b.listener);try{b.listener.apply(this,d)}catch($){console.error("safeEmit event:".concat(o," error ").concat($==null?void 0:$.toString()))}})}_indexOfListener(o,s){let d=o.length;for(;d--;)if(o[d].listener===s)return d;return-1}},iP=null;function X8(){if(iP)return iP;if(window.electron)return iP=window.electron;if(!window.require)return null;try{return iP=window.require("electron"),iP}catch{return null}}let NS=function(o){return o.CREATE_CLIENT="createClient",o.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",o.SET_AREA="setArea",o.PRELOAD="PRELOAD",o.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",o.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",o.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",o.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",o.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",o.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",o.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",o.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",o.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",o.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",o.START_PROXY_SERVER="Client.startProxyServer",o.STOP_PROXY_SERVER="Client.stopProxyServer",o.SET_PROXY_SERVER="Client.setProxyServer",o.SET_TURN_SERVER="Client.setTurnServer",o.SET_CLIENT_ROLE="Client.setClientRole",o.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",o.ENABLE_DUAL_STREAM="Client.enableDualStream",o.DISABLE_DUAL_STREAM="Client.disableDualStream",o.JOIN="Client.join",o.LEAVE="Client.leave",o.PUBLISH="Client.publish",o.UNPUBLISH="Client.unpublish",o.SUBSCRIBE="Client.subscribe",o.MASS_SUBSCRIBE="Client.massSubscribe",o.MASS_UNSUBSCRIBE="Client.massUnsubscribe",o.UNSUBSCRIBE="Client.unsubscribe",o.RENEW_TOKEN="Client.renewToken",o.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",o.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",o.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",o.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",o.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",o.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",o.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",o.DATACHANNEL_FAILBACK="Client._datachannelFailback",o.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",o.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",o.START_LIVE_STREAMING="Client.startLiveStreaming",o.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",o.STOP_LIVE_STREAMING="Client.stopLiveStreaming",o.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",o.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",o.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",o.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",o.SET_CONFIG_DISTRIBUTE="_configDistribute",o.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",o.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",o.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",o.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",o.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",o.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",o.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",o.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",o.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",o.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",o.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",o.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",o.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",o.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",o.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",o.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",o.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",o.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",o.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",o.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",o.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",o.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",o.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",o.STREAM_TYPE_CHANGE="streamTypeChange",o.CONNECTION_STATE_CHANGE="connectionStateChange",o.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",o.IMAGE_MODERATION_UPLOAD="imageModerationUpload",o}({}),hS=function(o){return o.TRACER="tracer",o}({});function Q8(o){return W_(o.timeout,"config.timeout",0,1e5),W_(o.timeoutFactor,"config.timeoutFactor",0,100,!1),W_(o.maxRetryCount,"config.maxRetryConfig",0,1/0),W_(o.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Hat=function(o){return o[o.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",o[o.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",o[o.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",o}({}),y_=function(o){return o.LEAVE="LEAVE",o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.UID_BANNED="UID_BANNED",o.IP_BANNED="IP_BANNED",o.CHANNEL_BANNED="CHANNEL_BANNED",o.FALLBACK="FALLBACK",o.LICENSE_MISSING="LICENSE_MISSING",o.LICENSE_EXPIRED="LICENSE_EXPIRED",o.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",o.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",o.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",o.LICENSE_ILLEGAL="LICENSE_ILLEGAL",o.TOKEN_EXPIRE="TOKEN_EXPIRE",o}({});function jO(o){if(!Array.isArray(o)||o.length<1)return!1;try{o.forEach(s=>{if(!s.urls)throw Error()})}catch{return!1}return!0}function Z8(o){return QS(o.turnServerURL,"turnServerURL"),QS(o.username,"username"),QS(o.password,"password"),o.udpport&&W_(o.udpport,"udpport",1,99999,!0),o.forceturn&&NR(o.forceturn,"forceturn"),o.security&&NR(o.security,"security"),o.tcpport&&W_(o.tcpport,"tcpport",1,99999,!0),!0}function $8(o){return o.level!==void 0&&VS(o.level,"level",[1,2,3]),o.delay!==void 0&&W_(o.delay,"delay",0,3e3,!0),!0}let S_=function(o){return o.CONNECTION_STATE_CHANGE="connection-state-change",o.MEDIA_RECONNECT_START="media-reconnect-start",o.MEDIA_RECONNECT_END="media-reconnect-end",o.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",o.USER_JOINED="user-joined",o.USER_LEAVED="user-left",o.USER_PUBLISHED="user-published",o.USER_UNPUBLISHED="user-unpublished",o.USER_INFO_UPDATED="user-info-updated",o.CLIENT_BANNED="client-banned",o.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",o.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",o.VOLUME_INDICATOR="volume-indicator",o.CRYPT_ERROR="crypt-error",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGED="stream-type-changed",o.STREAM_FALLBACK="stream-fallback",o.RECEIVE_METADATA="receive-metadata",o.STREAM_MESSAGE="stream-message",o.LIVE_STREAMING_ERROR="live-streaming-error",o.LIVE_STREAMING_WARNING="live-streaming-warning",o.INJECT_STREAM_STATUS="stream-inject-status",o.EXCEPTION="exception",o.ERROR="error",o.P2P_LOST="p2p_lost",o.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",o.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",o.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",o.PUBLISHED_USER_LIST="published-user-list",o.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",o.CONTENT_INSPECT_ERROR="content-inspect-error",o.CONTENT_INSPECT_RESULT="content-inspect-result",o.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",o}({}),tT=function(o){return o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK",o}({}),gT=function(o){return o.ONLINE="ONLINE",o.OFFLINE="OFFLINE",o}({}),jI=function(o){return o.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",o.ONLINE="ONLINE",o.OFFLINE="OFFLINE",o}({});function kS(o,s){for(var d=arguments.length,g=new Array(d>2?d-2:0),b=2;b<d;b++)g[b-2]=arguments[b];return o.getListeners(s).length===0?GE.reject(new TE(rE.UNEXPECTED_ERROR,"can not emit promise")):new GE(($,Vt)=>{o.emit(s,...g,$,Vt)})}function K_(o,s){if(o.getListeners(s).length===0)return GE.resolve();for(var d=arguments.length,g=new Array(d>2?d-2:0),b=2;b<d;b++)g[b-2]=arguments[b];return kS(o,s,...g)}function VT(o,s){if(o.getListeners(s).length===0)return null;for(var d=arguments.length,g=new Array(d>2?d-2:0),b=2;b<d;b++)g[b-2]=arguments[b];return VI(o,s,...g)}function VI(o,s){let d=null,g=null;for(var b=arguments.length,$=new Array(b>2?b-2:0),Vt=2;Vt<b;Vt++)$[Vt-2]=arguments[Vt];if(o.emit(s,...$,zt=>{d=zt},zt=>{g=zt}),g!==null)throw g;if(d===null)throw new TE(rE.UNEXPECTED_ERROR,"handler is not sync");return d}const pS=new class extends nS{set networkState(o){this.emit(jI.NETWORK_STATE_CHANGE,o,this._networkState),o===gT.ONLINE?this.emit(jI.ONLINE):o===gT.OFFLINE&&(this.onlineWaiter=new GE(s=>{this.once(jI.ONLINE,()=>{this.onlineWaiter=void 0,s(gT.ONLINE)})}),this.emit(jI.OFFLINE)),this._networkState=o}get networkState(){return this._networkState}get isOnline(){return this._networkState===gT.ONLINE}constructor(){super(),tS(this,"_moduleName","network-indicator"),tS(this,"_networkState",gT.ONLINE),tS(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=gT.ONLINE}),window.addEventListener("offline",()=>{this.networkState=gT.OFFLINE})}};function yD(o,s){const d=o.indexOf(s);d!==-1&&o.splice(d,1)}function VO(o){const s=[];return o.forEach(d=>{s.indexOf(d)===-1&&s.push(d)}),s}function SD(o){GE!==void 0?GE.resolve().then(o):setTimeout(o,0)}function Q_(o){return JSON.parse(JSON.stringify(o))}function FI(o){try{return Q_(o)}catch{return o}}const t4={};function eI(o,s){t4[s]||(t4[s]=!0,o())}function BI(o){const s=window.atob(o),d=new Uint8Array(new ArrayBuffer(s.length));for(let g=0;g<s.length;g+=1)d[g]=s.charCodeAt(g);return d}function nI(o){let s="";for(let d=0;d<o.length;d+=1)s+=String.fromCharCode(o[d]);return window.btoa(s)}function e4(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,d=new TextEncoder().encode(o);if(d.length>s)d=d.slice(0,s);else if(d.length<s){const g=new Uint8Array(s);g.set(d),d=g}return d}function n4(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];const g=F0(s).call(s,(Vt,zt)=>Vt+zt.length,0),b=new Uint8Array(new ArrayBuffer(g));let $=0;return s.forEach(Vt=>{b.set(Vt,$),$+=Vt.length}),b}function dR(o){return window.TextEncoder?new TextEncoder().encode(o).length:o.length}function r4(o){let s=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&o.realFormData&&(o=o.realFormData),o.forEach(d=>{s+=typeof d=="string"?dR(d):d.size}),s+138}function Kat(o){const s=new TE(rE.TIMEOUT,"timeout");return new GE((d,g)=>{window.setTimeout(()=>g(s),o)})}function WS(o){return new GE(s=>{window.setTimeout(s,o)})}function z_(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,s=arguments.length>1?arguments[1]:void 0;const d=Math.random().toString(16).substr(2,o).toLowerCase();return d.length===o?"".concat(s).concat(d):"".concat(s).concat(d)+z_(o-d.length,"")}function oP(){return z_(32,"").toUpperCase()}const TD=()=>{},i4=new class{constructor(){tS(this,"fnMap",new Map)}throttleByKey(o,s,d,g){for(var b=arguments.length,$=new Array(b>4?b-4:0),Vt=4;Vt<b;Vt++)$[Vt-4]=arguments[Vt];if(this.fnMap.has(s)){const zt=this.fnMap.get(s);if(zt.threshold!==d){zt.fn(...zt.args),clearTimeout(zt.timer);const _e=window.setTimeout(()=>{const _r=this.fnMap.get(s);_r&&_r.fn(..._r.args),this.fnMap.delete(s)},d);this.fnMap.set(s,{fn:o,threshold:d,timer:_e,args:$,skipFn:g})}else zt.skipFn&&zt.skipFn(...zt.args),this.fnMap.set(s,e_(e_({},zt),{},{fn:o,args:$,skipFn:g}))}else{const zt=window.setTimeout(()=>{const _e=this.fnMap.get(s);_e&&_e.fn(..._e.args),this.fnMap.delete(s)},d);this.fnMap.set(s,{fn:o,threshold:d,timer:zt,args:$,skipFn:g})}}},o4=i4.throttleByKey.bind(i4);function s4(o){return typeof o=="object"&&o!==null&&!(o instanceof RegExp)}function CV(o,s){if(!s4(o)||!s4(s)||Array.isArray(o)&&!Array.isArray(s)||!Array.isArray(o)&&Array.isArray(s))return s;if(Array.isArray(s)&&Array.isArray(o)){const d=[...o];for(let g=0;g<s.length;g++)d[g]=CV(o[g],s[g]);return d}{const d=e_({},o);for(const g in s)Object.prototype.hasOwnProperty.call(s,g)&&(Object.prototype.hasOwnProperty.call(o,g)?d[g]=CV(o[g],s[g]):d[g]=s[g]);return d}}function a4(o,s){let d=[0];if(d=new Array(s).fill(0),o===0)return d;let g=0;for(;o>0&&(d[g]=255&o,o>>=8,g++,g!==s););return d}function wV(o){return typeof o=="number"?o:o.exact||o.ideal||o.max||o.min||0}function c4(o){const s="0123456789abcdef";function d(fE){let mE,_E="";for(mE=0;mE<=3;mE++)_E+=s.charAt(fE>>8*mE+4&15)+s.charAt(fE>>8*mE&15);return _E}function g(fE,mE){const _E=(65535&fE)+(65535&mE);return(fE>>16)+(mE>>16)+(_E>>16)<<16|65535&_E}function b(fE,mE,_E,SE,wE,NE){return g(function(DE,JE){return DE<<JE|DE>>>32-JE}(g(g(mE,fE),g(SE,NE)),wE),_E)}function $(fE,mE,_E,SE,wE,NE,DE){return b(mE&_E|~mE&SE,fE,mE,wE,NE,DE)}function Vt(fE,mE,_E,SE,wE,NE,DE){return b(mE&SE|_E&~SE,fE,mE,wE,NE,DE)}function zt(fE,mE,_E,SE,wE,NE,DE){return b(mE^_E^SE,fE,mE,wE,NE,DE)}function _e(fE,mE,_E,SE,wE,NE,DE){return b(_E^(mE|~SE),fE,mE,wE,NE,DE)}const _r=function(fE){let mE;const _E=1+(fE.length+8>>6),SE=new Array(16*_E);for(mE=0;mE<16*_E;mE++)SE[mE]=0;for(mE=0;mE<fE.length;mE++)SE[mE>>2]|=fE.charCodeAt(mE)<<mE%4*8;return SE[mE>>2]|=128<<mE%4*8,SE[16*_E-2]=8*fE.length,SE}(o);let _o,ga,_a,_c,tE,_p=1732584193,_f=-271733879,eE=-1732584194,iE=271733878;for(_o=0;_o<_r.length;_o+=16)ga=_p,_a=_f,_c=eE,tE=iE,_p=$(_p,_f,eE,iE,_r[_o+0],7,-680876936),iE=$(iE,_p,_f,eE,_r[_o+1],12,-389564586),eE=$(eE,iE,_p,_f,_r[_o+2],17,606105819),_f=$(_f,eE,iE,_p,_r[_o+3],22,-1044525330),_p=$(_p,_f,eE,iE,_r[_o+4],7,-176418897),iE=$(iE,_p,_f,eE,_r[_o+5],12,1200080426),eE=$(eE,iE,_p,_f,_r[_o+6],17,-1473231341),_f=$(_f,eE,iE,_p,_r[_o+7],22,-45705983),_p=$(_p,_f,eE,iE,_r[_o+8],7,1770035416),iE=$(iE,_p,_f,eE,_r[_o+9],12,-1958414417),eE=$(eE,iE,_p,_f,_r[_o+10],17,-42063),_f=$(_f,eE,iE,_p,_r[_o+11],22,-1990404162),_p=$(_p,_f,eE,iE,_r[_o+12],7,1804603682),iE=$(iE,_p,_f,eE,_r[_o+13],12,-40341101),eE=$(eE,iE,_p,_f,_r[_o+14],17,-1502002290),_f=$(_f,eE,iE,_p,_r[_o+15],22,1236535329),_p=Vt(_p,_f,eE,iE,_r[_o+1],5,-165796510),iE=Vt(iE,_p,_f,eE,_r[_o+6],9,-1069501632),eE=Vt(eE,iE,_p,_f,_r[_o+11],14,643717713),_f=Vt(_f,eE,iE,_p,_r[_o+0],20,-373897302),_p=Vt(_p,_f,eE,iE,_r[_o+5],5,-701558691),iE=Vt(iE,_p,_f,eE,_r[_o+10],9,38016083),eE=Vt(eE,iE,_p,_f,_r[_o+15],14,-660478335),_f=Vt(_f,eE,iE,_p,_r[_o+4],20,-405537848),_p=Vt(_p,_f,eE,iE,_r[_o+9],5,568446438),iE=Vt(iE,_p,_f,eE,_r[_o+14],9,-1019803690),eE=Vt(eE,iE,_p,_f,_r[_o+3],14,-187363961),_f=Vt(_f,eE,iE,_p,_r[_o+8],20,1163531501),_p=Vt(_p,_f,eE,iE,_r[_o+13],5,-1444681467),iE=Vt(iE,_p,_f,eE,_r[_o+2],9,-51403784),eE=Vt(eE,iE,_p,_f,_r[_o+7],14,1735328473),_f=Vt(_f,eE,iE,_p,_r[_o+12],20,-1926607734),_p=zt(_p,_f,eE,iE,_r[_o+5],4,-378558),iE=zt(iE,_p,_f,eE,_r[_o+8],11,-2022574463),eE=zt(eE,iE,_p,_f,_r[_o+11],16,1839030562),_f=zt(_f,eE,iE,_p,_r[_o+14],23,-35309556),_p=zt(_p,_f,eE,iE,_r[_o+1],4,-1530992060),iE=zt(iE,_p,_f,eE,_r[_o+4],11,1272893353),eE=zt(eE,iE,_p,_f,_r[_o+7],16,-155497632),_f=zt(_f,eE,iE,_p,_r[_o+10],23,-1094730640),_p=zt(_p,_f,eE,iE,_r[_o+13],4,681279174),iE=zt(iE,_p,_f,eE,_r[_o+0],11,-358537222),eE=zt(eE,iE,_p,_f,_r[_o+3],16,-722521979),_f=zt(_f,eE,iE,_p,_r[_o+6],23,76029189),_p=zt(_p,_f,eE,iE,_r[_o+9],4,-640364487),iE=zt(iE,_p,_f,eE,_r[_o+12],11,-421815835),eE=zt(eE,iE,_p,_f,_r[_o+15],16,530742520),_f=zt(_f,eE,iE,_p,_r[_o+2],23,-995338651),_p=_e(_p,_f,eE,iE,_r[_o+0],6,-198630844),iE=_e(iE,_p,_f,eE,_r[_o+7],10,1126891415),eE=_e(eE,iE,_p,_f,_r[_o+14],15,-1416354905),_f=_e(_f,eE,iE,_p,_r[_o+5],21,-57434055),_p=_e(_p,_f,eE,iE,_r[_o+12],6,1700485571),iE=_e(iE,_p,_f,eE,_r[_o+3],10,-1894986606),eE=_e(eE,iE,_p,_f,_r[_o+10],15,-1051523),_f=_e(_f,eE,iE,_p,_r[_o+1],21,-2054922799),_p=_e(_p,_f,eE,iE,_r[_o+8],6,1873313359),iE=_e(iE,_p,_f,eE,_r[_o+15],10,-30611744),eE=_e(eE,iE,_p,_f,_r[_o+6],15,-1560198380),_f=_e(_f,eE,iE,_p,_r[_o+13],21,1309151649),_p=_e(_p,_f,eE,iE,_r[_o+4],6,-145523070),iE=_e(iE,_p,_f,eE,_r[_o+11],10,-1120210379),eE=_e(eE,iE,_p,_f,_r[_o+2],15,718787259),_f=_e(_f,eE,iE,_p,_r[_o+9],21,-343485551),_p=g(_p,ga),_f=g(_f,_a),eE=g(eE,_c),iE=g(iE,tE);return d(_p)+d(_f)+d(eE)+d(iE)}let zat=1,RD=console,KS=class{static setLogger(o){RD=o}constructor(o){tS(this,"lockingPromise",GE.resolve()),tS(this,"locks",0),tS(this,"name",""),tS(this,"lockId",void 0),this.lockId=zat++,o&&(this.name=o),RD.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(o){let s;this.locks+=1,RD.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof o=="string"?o:""));const d=new GE(b=>{s=()=>{this.locks-=1,RD.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof o=="string"?o:"")),b()}}),g=this.lockingPromise.then(()=>s);return this.lockingPromise=this.lockingPromise.then(()=>d),g}};function FO(o,s){return function(d,g,b){const $=b.value;if(typeof $!="function")throw new Error("Cannot use mutex on object property.");return b.value=async function(){const Vt=this[s];if(!Vt)throw new Error("mutex property key ".concat(s," doesn't exist on ").concat(o));const zt=await Vt.lock("From ".concat(o,".").concat(g));try{for(var _e=arguments.length,_r=new Array(_e),_o=0;_o<_e;_o++)_r[_o]=arguments[_o];return await $.apply(this,_r)}finally{zt()}},b}}const CS={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function CD(o,s){const d=Math.floor(s.timeout*Math.pow(s.timeoutFactor,o));return Math.min(s.maxRetryTimeout,d)}function W0(o,s,d,g){const b=Object.assign({},CS,g);let $=b.timeout;const Vt=async()=>{await function(_r){return new GE(_o=>{window.setTimeout(_o,_r)})}($),$*=b.timeoutFactor,$=Math.min(b.maxRetryTimeout,$)};let zt=!1;const _e=new GE(async(_r,_o)=>{s=s||(()=>!1),d=d||(()=>!0);for(let ga=0;ga<b.maxRetryCount;ga+=1){if(zt)return _o(new TE(rE.OPERATION_ABORTED));try{const _a=await o();if(!s(_a,ga)||ga+1===b.maxRetryCount)return _r(_a);await Vt()}catch(_a){if(!d(_a,ga)||ga+1===b.maxRetryCount)return _o(_a);await Vt()}}});return _e.cancel=()=>zt=!0,_e}class IV{constructor(s){tS(this,"input",[]),tS(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}mean(){var s;return this.input.length===0?0:F0(s=this.input).call(s,(d,g)=>d+g)/this.input.length}}let wD,ID=0,OV=0;function AV(o,s,d,g){return new GE((b,$)=>{s.responseType=s.responseType||"json",s.data&&!d?(s.data=JSON.stringify(s.data),ID+=dR(s.data)):d&&(s.data.size?ID+=s.data.size:s.data instanceof FormData?ID+=r4(s.data):ID+=dR(JSON.stringify(s.data))),s.headers=s.headers||{},s.headers["Content-Type"]=s.headers["Content-Type"]||"application/json",s.method="POST",s.url=o,RT.request(s).then(Vt=>{typeof Vt.data=="string"?OV+=dR(Vt.data):Vt.data instanceof ArrayBuffer||Vt.data instanceof Uint8Array?OV+=Vt.data.byteLength:OV+=dR(JSON.stringify(Vt.data)),b(Vt.data)}).catch(Vt=>{RT.isCancel(Vt)?$(new TE(rE.OPERATION_ABORTED,"cancel token canceled")):Vt.code==="ECONNABORTED"?$(new TE(rE.NETWORK_TIMEOUT,Vt.message)):Vt.response?$(new TE(rE.NETWORK_RESPONSE_ERROR,Vt.response.status)):$(new TE(rE.NETWORK_ERROR,Vt.message))})})}async function Yat(o,s){const d=new Blob([s.data],{type:"buffer"});return await AV(o,e_(e_({},s),{},{data:d,headers:{"Content-Type":"application/octet-stream"}}),!0)}const u4=()=>window.isSecureContext!==void 0,i0=function(o){if(o.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return o;const s=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(s&&s[1]&&s[2]){const g=s[1],b=s[2];return"".concat(g,".").concat(b)}const d=o.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(d&&d[1]&&d[2]){const g=d[1],b=d[2];return"".concat(g,".").concat(100*(Number(b)+1))}return"4.0.0.999"}("4.21.0"),NV=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let GI=function(o){return o.Default="default",o.Auto="auto",o.Relay="relay",o.SdRtn="sd-rtn",o}({});const kV={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},PV="v4.21.0-0-g16fdae2c-dirty(6/3/2024, 2:55:18 PM)",xS={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:void 0,ENABLE_CC_FALLBACK:void 0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:kV,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0};function q_(o,s,d){var g,b,$;KE(g=Object.keys(xS)).call(g,o)&&(!d&&KE(b=Object.keys(rI)).call(b,o)||(xS[o]=s,o==="ENABLE_VIDEO_SEI"&&s===!0&&(xS.ENABLE_ENCODED_TRANSFORM=!0),o==="USE_NEW_NETWORK_CONFIG"&&s&&($=!!s,xS.USE_NEW_NETWORK_CONFIG=$,$&&(xS.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],xS.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],xS.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],xS.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],xS.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",xS.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",xS.GATEWAY_DOMAINS=["edge.sd-rtn.com"]))))}function cE(o){return xS[o]}const rI={};var __=function(o){return o.SET_SESSION_ID="SET_SESSION_ID",o.SET_P2P_ID="SET_P2P_id",o.SET_DC_ID="SET_DC_id",o.SET_UID="SET_UID",o.SET_INT_UID="SET_INT_UID",o.SET_PUB_ID="SET_PUB_ID",o.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",o.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",o.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",o.AVOID_JOIN_START="AVOID_JOIN_START",o.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",o.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",o.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",o.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",o.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",o.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",o.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",o.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",o.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",o.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",o.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",o.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",o.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",o.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",o.RESET_KEY_METRICS="RESET_KEY_METRICS",o.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",o.SET_USE_P2P="SET_USE_P2P",o.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",o}(__||{});class Jat{constructor(s,d,g,b){tS(this,"state",void 0),this.state={codec:s,audioCodec:d,mode:g,clientId:b,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1,p2pTransport:GI.Default}}dispatch(s){this.state=function(d,g){switch(g.type){case __.SET_SESSION_ID:return e_(e_({},d),{},{sessionId:g.sessionId});case __.SET_P2P_ID:return e_(e_({},d),{},{p2pId:g.p2pId});case __.SET_UID:return e_(e_({},d),{},{uid:g.uid});case __.SET_INT_UID:return e_(e_({},d),{},{intUid:g.intUid});case __.SET_PUB_ID:return e_(e_({},d),{},{pubId:g.pubId});case __.KEY_METRIC_CLIENT_CREATED:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{clientCreated:g.metric})});case __.KEY_METRIC_JOIN_START:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{joinStart:g.metric})});case __.AVOID_JOIN_START:return e_(e_({},d),{},{avoidJoinStart:g.avoidJoinStart});case __.KEY_METRIC_JOIN_END:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{joinEnd:g.metric})});case __.KEY_METRIC_REQUEST_AP_START:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{requestAPStart:g.metric})});case __.KEY_METRIC_REQUEST_AP_END:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{requestAPEnd:g.metric})});case __.KEY_METRIC_JOIN_GATEWAY_START:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{joinGatewayStart:g.metric})});case __.KEY_METRIC_JOIN_GATEWAY_END:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{joinGatewayEnd:g.metric})});case __.KEY_METRIC_PEER_CONNECTION_START:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{peerConnectionStart:g.metric})});case __.KEY_METRIC_PEER_CONNECTION_END:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{peerConnectionEnd:g.metric})});case __.KEY_METRIC_DESCRIPTION_START:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{descriptionStart:g.metric})});case __.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{signalChannelOpen:g.metric})});case __.KEY_METRIC_ICE_CONNECTION_END:return e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{iceConnectionEnd:g.metric})});case __.KEY_METRIC_PUBLISH:{const b=d.keyMetrics.publish,$=b.findIndex(Vt=>Vt.trackId===g.metric.trackId);return $!==-1?(b[$]=e_(e_({},b[$]),g.metric),e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{publish:[...b]})})):e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,g.metric]})})}case __.KEY_METRIC_SUBSCRIBE:{const b=d.keyMetrics.subscribe,$=b.findIndex(Vt=>Vt.userId===g.metric.userId&&Vt.type===g.metric.type);return $!==-1?(b[$]=e_(e_({},b[$]),g.metric),e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{subscribe:[...b]})})):e_(e_({},d),{},{keyMetrics:e_(e_({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,g.metric]})})}case __.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=g.mode,d;case __.RECORD_JOIN_CHANNEL_SERVICE:return typeof g.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,g.record]:(d.joinChannelServiceRecords[g.index]=e_(e_({},d.joinChannelServiceRecords[g.index]),g.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case __.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case __.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[]},d;case __.SET_USE_DATACHANNEL:return e_(e_({},d),{},{useDataChannel:g.val});case __.SET_USE_P2P:return e_(e_({},d),{},{useP2P:g.val});case __.SET_TRANSPORT_TYPE:return e_(e_({},d),{},{p2pTransport:g.val});default:return d}}(this.state,s)}set sessionId(s){this.dispatch({type:__.SET_SESSION_ID,sessionId:s})}get sessionId(){return this.state.sessionId}set codec(s){this.state.codec=s}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(s){this.dispatch({type:__.SET_P2P_ID,p2pId:s})}get p2pId(){return this.state.p2pId}set dcId(s){this.dispatch({type:__.SET_DC_ID,dcId:s})}get dcId(){return this.state.dcId}set uid(s){this.dispatch({type:__.SET_UID,uid:s})}get uid(){return this.state.uid}set intUid(s){this.dispatch({type:__.SET_INT_UID,intUid:s})}get intUid(){return this.state.intUid}set pubId(s){this.dispatch({type:__.SET_PUB_ID,pubId:s})}get pubId(){return this.state.pubId}set cloudProxyServerMode(s){this.dispatch({type:__.SET_CLOUD_PROXY_SERVER_MODE,mode:s})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(s){this.dispatch({type:__.SET_USE_DATACHANNEL,val:s})}get useDataChannel(){return this.state.useDataChannel}set useP2P(s){this.dispatch({type:__.SET_USE_P2P,val:s})}get useP2P(){return this.state.useP2P}set p2pTransport(s){this.dispatch({type:__.SET_TRANSPORT_TYPE,val:s})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:__.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:__.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:__.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:__.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:__.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:__.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:__.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:__.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:__.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:__.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:__.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:__.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(s,d,g,b){this.dispatch({type:__.KEY_METRIC_PUBLISH,metric:e_(e_({trackId:s,type:d},g&&{publishStart:g}),b&&{publishEnd:b})})}subscribe(s,d,g,b,$,Vt,zt){this.dispatch({type:__.KEY_METRIC_SUBSCRIBE,metric:e_(e_(e_(e_(e_({userId:s,type:d},g&&{subscribeStart:g}),b&&{subscribeEnd:b}),$&&{firstFrame:$}),Vt&&{streamAdded:Vt}),zt&&{firstDecoded:zt})})}massSubscribe(s,d,g,b){s.forEach($=>{this.dispatch({type:__.KEY_METRIC_SUBSCRIBE,metric:e_(e_(e_({userId:$.userId,type:$.type},d&&{subscribeStart:d}),g&&{subscribeEnd:g}),b&&{firstFrame:b})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(s,d){s.service==="gateway"&&Array.isArray(s.urls)&&(s.urls=s.urls.map(g=>g.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof d!="number"?(this.dispatch({type:__.RECORD_JOIN_CHANNEL_SERVICE,record:e_(e_({},s),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:__.RECORD_JOIN_CHANNEL_SERVICE,record:s,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:__.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:__.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(s){this.dispatch({type:__.AVOID_JOIN_START,avoidJoinStart:s})}}let BO=function(o){return o.h264="h264",o.h265="h265",o.vp8="vp8",o.vp9="vp9",o.av1="av1",o}({});(function(o){o.opus="opus",o.pcma="pcma",o.pcmu="pcmu",o.g722="g722"})({});const l4=128,Xat=96,d4=1e3,GO=10;let Qat=0;function h4(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function p_(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?h4(Object(d),!0).forEach(function(g){gS(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):h4(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}function gS(o,s,d){return(s=function(g){var b=function($,Vt){if(typeof $!="object"||$===null)return $;var zt=$[Symbol.toPrimitive];if(zt!==void 0){var _e=zt.call($,"string");if(typeof _e!="object")return _e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String($)}(g);return typeof b=="symbol"?b:String(b)}(s))in o?Object.defineProperty(o,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):o[s]=d,o}const p4=new class extends nS{constructor(){super(...arguments),gS(this,"currentUploadLogID",0)}reportLogUploadError(o){const{errorRange:s}=o;s[s.length-1]&&s[s.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=s[s.length-1],this.emit("REPORT_LOG_UPLOAD",o))}};class Zat{constructor(s){gS(this,"logger",void 0),gS(this,"prefixLists",[]),this.logger=s}debug(){for(var s=arguments.length,d=new Array(s),g=0;g<s;g++)d[g]=arguments[g];this.logger.debug(...this.prefixLists,...d)}info(){for(var s=arguments.length,d=new Array(s),g=0;g<s;g++)d[g]=arguments[g];this.logger.info(...this.prefixLists,...d)}warning(){for(var s=arguments.length,d=new Array(s),g=0;g<s;g++)d[g]=arguments[g];this.logger.warning(...this.prefixLists,...d)}error(){for(var s=arguments.length,d=new Array(s),g=0;g<s;g++)d[g]=arguments[g];this.logger.error(...this.prefixLists,...d)}prefix(s){return this.prefixLists.push(s),this}popPrefix(){return this.prefixLists.pop(),this}}function DV(){const o=new Date;return o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}function f4(){const o=new Date,s=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return s?(s==null?void 0:s[0])+":"+o.getUTCMilliseconds():o.toTimeString().split(" ")[0]+":"+o.getMilliseconds()}const o0={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},OD=Date.now(),sP=o=>{for(const s in o0)if(Object.prototype.hasOwnProperty.call(o0,s)&&o0[s]===o)return s;return"DEFAULT"},_l=new class{constructor(){gS(this,"proxyServerURL",void 0),gS(this,"logLevel",o0.DEBUG),gS(this,"uploadState","collecting"),gS(this,"uploadLogWaitingList",[]),gS(this,"uploadLogUploadingList",[]),gS(this,"uploadErrorCount",0),gS(this,"currentLogID",0),gS(this,"url",void 0),gS(this,"extLog",(o,s)=>{this.appendLogToWaitingList(o,...s)})}debug(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];const g=[o0.DEBUG].concat(s);this.log.apply(this,g)}info(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];const g=[o0.INFO].concat(s);this.log.apply(this,g)}warning(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];const g=[o0.WARNING].concat(s);this.log.apply(this,g)}warn(){this.warning(...arguments)}error(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];const g=[o0.ERROR].concat(s);this.log.apply(this,g)}upload(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];const g=[o0.DEBUG].concat(s);this.uploadLog.apply(this,g)}setLogLevel(o){o=Math.min(Math.max(0,o),4),this.logLevel=o}enableLogUpload(){q_("UPLOAD_LOG",!0)}disableLogUpload(){q_("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(o){this.proxyServerURL=o}prefix(o){return new Zat(this).prefix(o)}log(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];if(Date.now()-OD<100)return void setTimeout(()=>{this.log(...s)},Date.now()-OD);const g=Math.max(0,Math.min(4,s[0]));if(s[0]=DV()+" Agora-SDK [".concat(sP(g),"]:"),this.appendLogToWaitingList(g,...s),g<this.logLevel)return;const b=DV()+" %cAgora-SDK [".concat(sP(g),"]:");let $=[];if(!cE("USE_NEW_LOG"))switch(g){case o0.DEBUG:$=[b,"color: #64B5F6;"].concat(s.slice(1)),console.log.apply(console,$);break;case o0.INFO:$=[b,"color: #1E88E5; font-weight: bold;"].concat(s.slice(1)),console.log.apply(console,$);break;case o0.WARNING:$=[b,"color: #FB8C00; font-weight: bold;"].concat(s.slice(1)),console.warn.apply(console,$);break;case o0.ERROR:$=[b,"color: #B00020; font-weight: bold;"].concat(s.slice(1)),console.error.apply(console,$)}}uploadLog(){for(var o=arguments.length,s=new Array(o),d=0;d<o;d++)s[d]=arguments[d];if(Date.now()-OD<100)return void setTimeout(()=>{this.uploadLog(...s)},Date.now()-OD);const g=Math.max(0,Math.min(4,s[0]));s[0]=DV()+" Agora-SDK [".concat(sP(g),"]:"),this.appendLogToWaitingList(g,...s)}appendLogToWaitingList(o){if(!cE("UPLOAD_LOG"))return;for(var s=arguments.length,d=new Array(s>1?s-1:0),g=1;g<s;g++)d[g-1]=arguments[g];Array.isArray(d[0])?d[0][0]=f4()+" Agora-SDK [".concat(sP(o),"]:"):d[0]=f4()+" Agora-SDK [".concat(sP(o),"]:");let b="";d.forEach($=>{typeof $=="object"&&($=JSON.stringify($)),b+="".concat($," ")}),this.uploadLogWaitingList.push({payload_str:b,log_level:o,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const o=this.uploadLogUploadingList,s={sdk_version:i0,process_id:cE("PROCESS_ID"),payload:JSON.stringify(o)};return W0(async()=>{const d=await RT.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(cE("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(cE("LOG_UPLOAD_SERVER"),"/upload/v1")),s,{responseType:"text"});if(d.data!=="OK"){const g=new Error("unexpected upload log response");throw g.response=d,g}},()=>(this.uploadLogUploadingList=[],!1),d=>{const g={status:-1,message:d.message,errorRange:o.map(b=>b.log_item_id)};return d.response?(g.status=d.response.status,g.data=d.response.data,g.headers=d.response.headers):d.request&&(g.status=d.request.status),p4.reportLogUploadError(g),!0},{timeout:cE("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:cE("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,cE("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),cE("UPLOAD_LOG_INTERVAL"))}).catch(o=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),cE("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),cE("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var m4;function $at(o){return QS(o.reportId,"params.reportId",0,100,!1),QS(o.category,"params.category",0,100,!1),QS(o.event,"params.event",0,100,!1),QS(o.label,"params.label",0,100,!1),W_(o.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(m4={}).FREE="free",m4.UPLOADING="uploading",function(o){o[o.MISC=0]="MISC",o[o.INTERNAL_EVENT=1]="INTERNAL_EVENT",o[o.PUBLIC_EVENT=2]="PUBLIC_EVENT",o[o.WEB_EVENT=3]="WEB_EVENT",o[o.INTERNAL_API=4]="INTERNAL_API",o[o.WEB_API=5]="WEB_API",o[o.PUBLIC_API=6]="PUBLIC_API"}({});const tct={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let zS=function(o){return o.PUBLISH="publish",o.SUBSCRIBE="subscribe",o.WS_COMPRESSOR_INIT="ws_compressor_init",o.SESSION_INIT="session_init",o.JOIN_CHOOSE_SERVER="join_choose_server",o.REQ_USER_ACCOUNT="req_user_account",o.JOIN_GATEWAY="join_gateway",o.REJOIN_GATEWAY="rejoin_gateway",o.STREAM_SWITCH="stream_switch",o.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",o.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",o.FIRST_VIDEO_RECEIVED="first_video_received",o.FIRST_AUDIO_RECEIVED="first_audio_received",o.FIRST_VIDEO_DECODE="first_video_decode",o.FIRST_AUDIO_DECODE="first_audio_decode",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_UPDATE_STREAM="on_update_stream",o.ON_REMOVE_STREAM="on_remove_stream",o.USER_ANALYTICS="req_user_analytics",o.PC_STATS="pc_stats",o.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",o}({}),cS=function(o){return o.SESSION="io.agora.pb.Wrtc.Session",o.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",o.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",o.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",o.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",o.PUBLISH="io.agora.pb.Wrtc.Publish",o.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",o.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",o.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",o.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",o.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",o.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",o.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",o.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",o.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",o.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",o.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",o.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",o.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",o.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",o.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",o.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",o.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",o.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",o.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",o.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",o.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",o.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",o.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",o.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",o.PC_STATS="io.agora.pb.Wrtc.PCStats",o.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",o}({});(function(o){o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({}),function(o){o[o.SESSION=26]="SESSION",o[o.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",o[o.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",o[o.JOIN_GATEWAY=28]="JOIN_GATEWAY",o[o.PUBLISH=30]="PUBLISH",o[o.SUBSCRIBE=29]="SUBSCRIBE",o[o.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",o[o.STREAM_SWITCH=32]="STREAM_SWITCH",o[o.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",o[o.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",o[o.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",o[o.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",o[o.API_INVOKE=41]="API_INVOKE",o[o.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",o[o.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",o[o.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",o[o.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",o[o.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",o[o.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",o[o.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",o[o.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",o[o.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",o[o.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",o[o.WORKER_EVENT=156]="WORKER_EVENT",o[o.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",o[o.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",o[o.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",o[o.USER_ANALYTICS=1e4]="USER_ANALYTICS",o[o.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}({});class aP{constructor(){gS(this,"baseInfoMap",new Map),gS(this,"proxyServer",void 0),gS(this,"eventUploadTimer",void 0),gS(this,"setSessionIdTimer",void 0),gS(this,"url",void 0),gS(this,"backupUrl",void 0),gS(this,"_appId",void 0),gS(this,"keyEventUploadPendingItems",[]),gS(this,"normalEventUploadPendingItems",[]),gS(this,"apiInvokeUploadPendingItems",[]),gS(this,"apiInvokeCount",0),gS(this,"ltsList",[]),gS(this,"lastSendNormalEventTime",Date.now()),gS(this,"customReportCounterTimer",void 0),gS(this,"customReportCount",0),gS(this,"extApiInvoke",async s=>{for(const d of s){const g=p_(p_({},d),{},{sid:null,invokeId:++this.apiInvokeCount,tag:hS.TRACER});this.sendApiInvoke(g)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),cE("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),cE("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(s){return this.baseInfoMap.get(s)}adjustSessionStartTime(s){if(!this.baseInfoMap.has(s)&&!this.baseInfoMap.get(s))return void _l.error("adjust session ".concat(s," start time, sid is not exist or info is undefined"));const d=this.baseInfoMap.get(s),g=Date.now(),b=d.startTime;d.startTime=g,_l.debug("rewrite session ".concat(s," startTime: ").concat(g," , ").concat(g-b,"ms")),this.baseInfoMap.set(s,d)}setAppId(s){this._appId=s}reportApiInvoke(s,d,g){d.timeout=d.timeout||6e4,d.reportResult=d.reportResult===void 0||d.reportResult;const b=Date.now();this.apiInvokeCount+=1;const $=this.apiInvokeCount,Vt=()=>({tag:d.tag,invokeId:$,sid:s,name:d.name,apiInvokeTime:b,options:d.options,states:d.states||null}),zt=!!cE("SHOW_REPORT_INVOKER_LOG");zt&&_l.info("".concat(d.name," start"),d.options);let _e=!1;WS(d.timeout).then(()=>{_e||(this.sendApiInvoke(p_(p_({},Vt()),{},{error:rE.API_INVOKE_TIMEOUT,success:!1})),_l.debug("".concat(d.name," timeout")))});const _r=new TE(rE.UNEXPECTED_ERROR,"".concat(d.name,": this api invoke is end"));return{onSuccess:_o=>{const ga=()=>{if(_e)throw _r;return _e=!0,this.sendApiInvoke(p_(p_({},Vt()),{},{success:!0},d.reportResult&&{result:_o})),zt&&_l.info("".concat(d.name," onSuccess")),_o};return g?o4(ga,d.name+"Success",g,()=>_e=!0):ga()},onError:_o=>{const ga=()=>{if(_e)throw _o;_e=!0,this.sendApiInvoke(p_(p_({},Vt()),{},{success:!1,error:_o})),zt&&_l.info("".concat(d.name," onFailure"),_o.toString())};return g?o4(ga,d.name+"Error",g,()=>_e=!0):ga()}}}sessionInit(s,d){if(this.baseInfoMap.has(s))return;const g=Date.now(),b=this.createBaseInfo(s,g);b.cname=d.cname;const $=Object.assign({},{willUploadConsoleLog:cE("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:NV?"global":"oversea",areas:cE("AREAS")&&cE("AREAS").join(",")},d.extend),{stringUid:Vt,channelProfile:zt,channelMode:_e,isABTestSuccess:_r,lsid:_o,clientRole:ga}=d,_a=Date.now(),_c=p_(p_({},b),{},{eventType:zS.SESSION_INIT,appid:d.appid,browser:navigator.userAgent,buildFormat:d.buildFormat,build:PV,lts:_a,elapse:_a-g,extend:JSON.stringify($),mode:d.mode,process:cE("PROCESS_ID"),appType:cE("APP_TYPE"),success:!0,version:i0,stringUid:Vt,channelProfile:zt,channelMode:_e,isABTestSuccess:_r,lsid:_o,clientType:20,clientRole:ga,serviceId:cE("PROCESS_ID"),extensionID:cE("PLUGIN_INFO").join(",")||"",preload:d.preload?1:0});this.send({type:cS.SESSION,data:_c},!0)}joinChooseServer(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_({},b),{},{eventType:zS.JOIN_CHOOSE_SERVER,lts:$,eventElapse:d.elapse||$-d.lts,chooseServerAddr:d.csAddr,errorCode:d.ec,elapse:$-g.startTime,success:d.succ,chooseServerAddrList:JSON.stringify(d.serverList),uid:d.uid?parseInt(d.uid):null,cid:d.cid?parseInt(d.cid):null,chooseServerIp:d.csIp||"",opid:d.opid,unilbsServerIds:d.unilbsServerIds,extend:d.extend||void 0,isHttp3:d.isHttp3});this.send({type:cS.JOIN_CHOOSE_SERVER,data:Vt},!0)}reqUserAccount(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_({},b),{},{eventType:zS.REQ_USER_ACCOUNT,lts:$,success:d.success,serverAddress:d.serverAddr,stringUid:d.stringUid,uid:d.uid,errorCode:d.errorCode,elapse:d.elapse||$-g.startTime,eventElapse:$-d.lts,extend:JSON.stringify(d.extend)});this.send({type:cS.REQ_USER_ACCOUNT,data:Vt},!0)}joinGateway(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info;d.vid&&(b.vid=d.vid),b.uid=d.uid,b.cid=d.cid;const $=Date.now(),{firstSuccess:Vt,avoidJoinStartTime:zt,isProxy:_e,addr:_r}=d,_o=$-(Vt&&zt?zt:g.startTime),ga=p_(p_({},b),{},{eventType:zS.JOIN_GATEWAY,lts:$,gatewayAddr:d.addr,success:d.succ,errorCode:d.ec,elapse:_o,eventElapse:$-d.lts,firstSuccess:Vt,signalChannel:d.signalChannel}),_a=ga.success?1:0;if(d.succ&&(g.lastJoinSuccessTime=$),Vt)this.send({type:cS.JOIN_GATEWAY,data:ga},!0);else{let _c;if(_r)if(_e){const _p=_r.match(/h=(\d{1,3}-){3}\d{1,3}/g),_f=_r.match(/p=[0-9]{1,6}/g);_c={isSuccess:_a,gatewayIp:_p&&_p.length?_p[0].split("=")[1].replace(/-/g,"."):"",port:_f&&_f.length?_f[0].split("=")[1]:"",isProxy:_e?1:0}}else{const _p=_r.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),_f=_r.match(/(:|p=)[0-9]{1,6}/g);_c={isSuccess:_a,gatewayIp:_p&&_p.length?_p[0].split("//")[1].replace(/-/g,"."):"",port:_f&&_f.length?_f[0].split(/:|p=/g)[1]:"",isProxy:_e?1:0}}else _c={isSuccess:_a,gatewayIp:"",port:"",isProxy:_e?1:0};delete ga.success,delete ga.eventType,delete ga.firstSuccess,ga.vid=Number(ga.vid);const tE=Object.assign({},ga,_c,{eventType:zS.REJOIN_GATEWAY});this.send({type:cS.RE_JOIN_GATEWAY,data:tE},!0)}}joinChannelTimeout(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=Date.now(),$=p_(p_({},g.info),{},{lts:b,timeout:d,elapse:b-g.startTime});this.send({type:cS.JOIN_CHANNEL_TIMEOUT,data:$},!0)}publish(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_({},b),{},{eventType:zS.PUBLISH,lts:$,eventElapse:d.eventElapse,elapse:$-g.startTime,success:d.succ,errorCode:d.ec,videoName:d.videoName,audioName:d.audioName,screenName:d.screenName,screenshare:d.screenshare,audio:d.audio,video:d.video,p2pid:d.p2pid,publishRequestid:d.publishRequestid});this.send({type:cS.PUBLISH,data:Vt},!0)}subscribe(s,d,g){const b=this.baseInfoMap.get(s);if(!b)return;const $=b.info,Vt=Date.now(),zt=p_(p_({},$),{},{eventType:zS.SUBSCRIBE,lts:Vt,eventElapse:d.eventElapse,elapse:Vt-b.startTime,success:d.succ,errorCode:d.ec,video:d.video,audio:d.audio,subscribeRequestid:d.subscribeRequestid,p2pid:d.p2pid},g&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof d.peerid=="string"?zt.peerSuid=d.peerid:zt.peer=d.peerid,this.send({type:cS.SUBSCRIBE,data:zt},!0)}wsCompressorInit(s){var d;const g=[...qT(d=this.baseInfoMap).call(d)],b=g.length?g[0]:"UnableToGetSid",$=this.baseInfoMap.get(b);if(!$)return;const Vt=$.info,zt=Date.now(),_e=p_(p_({},Vt),{},{eventType:zS.WS_COMPRESSOR_INIT,lts:zt,eventElapse:s.eventElapse,elapse:zt-$.startTime,status:s.status?1:2});this.send({type:cS.WS_COMPRESSOR_INIT,data:_e},!0)}firstRemoteVideoDecode(s,d,g,b){const $=this.baseInfoMap.get(s);if(!$)return;const Vt=$.info,zt=Date.now(),_e=p_(p_(p_({},Vt),b),{},{elapse:zt-$.startTime,eventType:d,lts:zt,firstDecodeFrame:Math.max(zt-$.startTime,0),apEnd:Math.max(b.apEnd-$.startTime,0),apStart:Math.max(b.apStart-$.startTime,0),joinGwEnd:Math.max(b.joinGwEnd-$.startTime,0),joinGwStart:Math.max(b.joinGwStart-$.startTime,0),pcEnd:Math.max(b.pcEnd-$.startTime,0),pcStart:Math.max(b.pcStart-$.startTime,0),subscriberEnd:Math.max(b.subscriberEnd-$.startTime,0),subscriberStart:Math.max(b.subscriberStart-$.startTime,0),videoAddNotify:Math.max(b.videoAddNotify-$.startTime,0)});this.send({type:g,data:_e},!0)}firstRemoteFrame(s,d,g,b){const $=this.baseInfoMap.get(s);if(!$)return;const Vt=$.info,zt=Date.now(),_e=p_(p_(p_({},Vt),b),{},{elapse:zt-$.startTime,eventType:d,lts:zt});this.send({type:g,data:_e},!0)}pcStats(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_(p_({},b),d),{},{vid:b.vid===void 0?0:Number(b.vid),elapse:$-g.startTime,eventType:zS.PC_STATS,lts:$});this.send({type:cS.PC_STATS,data:Vt},!0)}updateRemoteRTPCapabilities(s,d){if(s){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_(p_({},b),d),{},{vid:b.vid===void 0?0:Number(b.vid),eventType:zS.UPDATE_REMOTE_RTPCAPABILITIES,lts:$});this.send({type:cS.UPDATE_REMOTE_RTPCAPABILITIES,data:Vt},!0)}}onGatewayStream(s,d,g,b){const $=this.baseInfoMap.get(s);if(!$)return;const Vt=$.info,zt=Date.now(),_e=p_(p_(p_({},Vt),b),{},{eventType:d,lts:zt});this.send({type:g,data:_e},!0)}streamSwitch(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_({},b),{},{eventType:zS.STREAM_SWITCH,lts:$,isDual:d.isdual,elapse:$-g.startTime,success:d.succ});this.send({type:cS.STREAM_SWITCH,data:Vt},!0)}requestProxyAppCenter(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_({},b),{},{eventType:zS.REQUEST_PROXY_APPCENTER,lts:$,eventElapse:$-d.lts,elapse:$-g.startTime,APAddr:d.APAddr,workerManagerList:d.workerManagerList,response:d.response,errorCode:d.ec,success:d.succ});this.send({type:cS.REQUEST_PROXY_APPCENTER,data:Vt},!0)}requestProxyWorkerManager(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_({},b),{},{eventType:zS.REQUEST_PROXY_WORKER_MANAGER,lts:$,eventElapse:$-d.lts,elapse:$-g.startTime,workerManagerAddr:d.workerManagerAddr,response:d.response,errorCode:d.ec,success:d.succ});this.send({type:cS.REQUEST_PROXY_WORKER_MANAGER,data:Vt},!0)}setProxyServer(s){this.proxyServer=s,s?_l.debug("reportProxyServerurl: ".concat(s)):_l.debug("disable reportProxyServerurl: ".concat(s))}peerPublishStatus(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_({},b),{},{subscribeElapse:d.subscribeElapse,peer:d.peer,peerPublishDuration:Math.max(d.audioPublishDuration,d.videoPublishDuration),audiotag:d.audioPublishDuration>0?1:-1,videotag:d.videoPublishDuration>0?1:-1,lts:$,elapse:$-g.startTime,joinChannelSuccessElapse:$-(g.lastJoinSuccessTime||$),peerPublishDurationVideo:d.videoPublishDuration,peerPublishDurationAudio:d.audioPublishDuration});this.send({type:cS.PEER_PUBLISH_STATUS,data:Vt},!0)}workerEvent(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now();(function(Vt,zt,_e){const _r=Vt[zt];if(!_r||typeof _r!="string")return[Vt];Vt[zt]="";const _o=dR(JSON.stringify(Vt));let ga=0;const _a=[];let _c=0;for(let tE=0;tE<_r.length;tE++)_c+=_r.charCodeAt(tE)<=127?1:3,_c<=_e-_o||(_a[_a.length]=e_(e_({},Vt),{},{[zt]:_r.substring(ga,tE)}),ga=tE,_c=_r.charCodeAt(tE)<=127?1:3);return ga!==_r.length-1&&(_a[_a.length]=e_(e_({},Vt),{},{[zt]:_r.substring(ga)})),_a})(p_(p_(p_({},b),d),{},{elapse:$-g.startTime,lts:$,productType:"WebRTC"}),"payload",1300).forEach(Vt=>this.send({type:cS.WORKER_EVENT,data:Vt},!0))}apworkerEvent(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_(p_({},b),d),{},{elapse:$-g.startTime,lts:$});this.send({type:cS.AP_WORKER_EVENT,data:Vt},!0)}joinWebProxyAP(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_(p_({},b),d),{},{elapse:$-g.startTime,lts:$,extend:d.extend||void 0});this.send({type:cS.JOIN_WEB_PROXY_AP,data:Vt},!0)}WebSocketQuit(s,d){const g=this.baseInfoMap.get(s);if(!g)return;const b=g.info,$=Date.now(),Vt=p_(p_(p_({},b),d),{},{elapse:$-g.startTime,lts:$});this.send({type:cS.WEBSOCKET_QUIT,data:Vt},!0)}async sendCustomReportMessage(s,d){if(this.customReportCount+=d.length,this.customReportCount>cE("CUSTOM_REPORT_LIMIT"))throw new TE(rE.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const g=Date.now(),b=d.map($=>({type:cS.USER_ANALYTICS,data:p_(p_({sid:s},$),{},{lts:g})}));try{cE("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(b):await this.postDataToStatsCollector(b)}catch($){throw _l.error("send custom report message failed",$.toString()),new TE(rE.CUSTOM_REPORT_SEND_FAILED,$.message)}}sendApiInvoke(s){const d=cE("NOT_REPORT_EVENT");if(s.tag&&KE(d)&&KE(d).call(d,s.tag))return!1;if(s.sid===null)return this.apiInvokeUploadPendingItems.push(s),!1;const g=this.baseInfoMap.get(s.sid);if(!g)return this.apiInvokeUploadPendingItems.push(s),!1;const{cname:b,uid:$,cid:Vt}=g.info;let zt;if(s.lts=s.lts||Date.now(),s.error)if(s.error instanceof TE){const{code:_r,message:_o}=s.error;zt=_r||_o||s.error.toString()}else zt=s.error.toString();const _e={invokeId:s.invokeId,sid:s.sid,cname:b,cid:Vt,uid:$,lts:s.lts,success:s.success,elapse:s.lts-g.startTime,execElapse:s.lts-s.apiInvokeTime,apiName:s.name,options:s.options?JSON.stringify(s.options):void 0,execStates:s.states?JSON.stringify(s.states):void 0,execResult:s.result?JSON.stringify(s.result):void 0,errorCode:s.error?zt:void 0,errorMsg:s.error?JSON.stringify(s.error):void 0};return this.send({type:cS.API_INVOKE,data:_e},!1),!0}appendSessionId(){aP.__CLIENT_LIST__.forEach(s=>{if(s._sessionId){const d=this.apiInvokeUploadPendingItems.length;for(let g=0;g<d;g++){const b=this.apiInvokeUploadPendingItems.shift();b&&(b.sid=s._sessionId,this.sendApiInvoke(Object.assign({},b)))}}})}send(s,d){if(d)return this.keyEventUploadPendingItems.push(s),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(s),this.normalEventUploadPendingItems.length>cE("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(s,d){const g=[],b=[];for(;s.length;){const Vt=s.shift();g.length<20?g.push(Vt):b.push(Vt)}s.push(...b);for(const Vt of[...g]){var $;this.ltsList.indexOf(Vt.data.lts)!==-1?(Vt.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(Vt.data.lts)):(this.ltsList.push(Vt.data.lts),GN($=this.ltsList).call($,(zt,_e)=>zt-_e))}return d||(this.lastSendNormalEventTime=Date.now()),cE("ENABLE_EVENT_REPORT")&&g.length&&(cE("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(g):this.postDataToStatsCollector(g)).catch((Vt=>zt=>{cE("EVENT_REPORT_RETRY")&&(d?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(Vt):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(Vt),this.normalEventUploadPendingItems.length>cE("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-cE("NORMAL_EVENT_QUEUE_CAPACITY")),_l.warning("report: drop normal events"))))})(g)),s}async postDataToStatsCollector2(s){pS.networkState===gT.OFFLINE&&await GE.race([pS.onlineWaiter,WS(2*CS.maxRetryTimeout)]);const d=$=>{let Vt=new Uint8Array;return $.forEach(zt=>{const _e=bV(JSON.stringify(zt.data)),_r=new ArrayBuffer(5),_o=(_a=>{let _c=0;return Object.entries(cS).forEach(tE=>{let[_p,_f]=tE;_f===_a.type&&(_c=EventNameToID[_p])}),_c})(zt),ga=new DataView(_r);ga.setUint16(0,_e.byteLength,!0),ga.setUint8(2,255&_o),ga.setUint8(3,_o>>>8&255),ga.setUint8(4,_o>>>16&255),Vt=J8(Vt,new Uint8Array(_r)),Vt=J8(Vt,_e)}),Vt},g="event";let b=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(cE("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(g):"https://".concat(cE("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(g);for(let $=0;$<2;$+=1){$===1&&(b=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(cE("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(g):"https://".concat(cE("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(g));try{await AV(b,{timeout:1e4,data:d(s),headers:p_(p_({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(Vt){if($===1)throw Vt;continue}return}}async postDataToStatsCollector(s){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const g={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:s.map(Vt=>JSON.stringify(Vt)),vid:(Vt=>{const zt=Vt&&Vt.data.sid&&this.baseInfoMap.get(Vt.data.sid);return zt&&zt.info.vid&&+zt.info.vid||0})(s[0])};pS.networkState===gT.OFFLINE&&await GE.race([pS.onlineWaiter,WS(2*CS.maxRetryTimeout)]);const b=d?"/events/proto-raws":"/events/messages";let $=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(cE("EVENT_REPORT_DOMAIN"),"&p=").concat(cE("STATS_COLLECTOR_PORT"),"&d=").concat(b):"https://".concat(cE("EVENT_REPORT_DOMAIN"),":").concat(cE("STATS_COLLECTOR_PORT")).concat(b));for(let Vt=0;Vt<2;Vt+=1){Vt===1&&($=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(cE("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(cE("STATS_COLLECTOR_PORT"),"&d=").concat(b):"https://".concat(cE("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(cE("STATS_COLLECTOR_PORT")).concat(b)));try{d?await Yat($,{timeout:1e4,data:g}):await AV($,{timeout:1e4,data:g})}catch(zt){if(Vt===1)throw zt;continue}return}}createBaseInfo(s,d){const g=Object.assign({},tct);return g.sid=s,this.baseInfoMap.set(s,{info:g,startTime:d}),g}reportResourceTiming(s,d){const g=performance.getEntriesByName(s),b=g[g.length-1];b&&this.reportApiInvoke(d,{name:"Client.resourceTiming",options:b,tag:hS.TRACER}).onSuccess()}}function s_(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(s,d,g){const b=g.value;if(typeof b=="function"){const $=o.className||s.__className__||(s.constructor.name==="AgoraRTCClient"?"Client":s.constructor.name);g.value=function(){for(var Vt=arguments.length,zt=new Array(Vt),_e=0;_e<Vt;_e++)zt[_e]=arguments[_e];let _r=zt;if(o.argsMap)try{_r=o.argsMap(this,...zt)}catch(ga){_l.warning(ga),_r=[]}try{JSON.stringify(_r)}catch{_l.warning("arguments for method ".concat($,".").concat(String(d)," not serializable for apiInvoke.")),_r=[]}const _o=(o.report||t_).reportApiInvoke(this._sessionId||null,{name:"".concat($,".").concat(String(d)),options:_r,tag:hS.TRACER,reportResult:o.reportResult},o.throttleTime);try{const ga=b.apply(this,zt);return ga instanceof GE?ga.then(_a=>(_o.onSuccess(o.reportResult&&_a),_a)).catch(_a=>{throw _o.onError(_a),_a}):(_o.onSuccess(o.reportResult&&ga),ga)}catch(ga){throw _o.onError(ga),ga}}}return g}}gS(aP,"__CLIENT_LIST__",[]);const t_=new aP;p4.on("REPORT_LOG_UPLOAD",o=>{o.networkState=pS.networkState,t_.reportApiInvoke(null,{name:"logUploadError",options:o,tag:hS.TRACER}).onSuccess("logUploadError")});const ect=["CHINA","GLOBAL"],eT=function(){const o="us".concat("erna","me"),s="pa".concat("sswo","rd"),d=["t","s","t"];d.splice(1,0,"e");const g=d.join(""),b=[];for(let zt=0;zt<6;zt++)b.push("1");const $=b.join(""),Vt={};return Vt[o]=g,Vt[s]=$,Object.assign(Vt,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=eT,NV||(xS.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],xS.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],xS.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],xS.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],xS.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],xS.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],xS.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",xS.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",xS.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",xS.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",xS.AREAS=["NORTH_AMERICA","OVERSEA"]);const E4=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],iI=[];function WI(o,s){return!!s&&iI.some(d=>d.uid===o&&d.channelName===s)}aP.__CLIENT_LIST__=iI;var nct=H3.forEach,g4=n1("forEach")?[].forEach:function(o){return nct(this,o,arguments.length>1?arguments[1]:void 0)};X_({target:"Array",proto:!0,forced:[].forEach!=g4},{forEach:g4});var rct=E0("Array").forEach,ict=iR,oct=iT,sct=_d,act=rct,LV=Array.prototype,cct={DOMTokenList:!0,NodeList:!0},uct=function(o){var s=o.forEach;return o===LV||sct(LV,o)&&s===LV.forEach||oct(cct,ict(o))?act:s},lct=j(uct),dct=rR,_4=a1;X_({target:"Object",stat:!0,forced:_t(function(){_4(1)})},{keys:function(o){return _4(dct(o))}});var v4=j(V0.Object.keys),hct=j(h6),pct=X_,fct=HN,mct=_h([].reverse),y4=[1,2];pct({target:"Array",proto:!0,forced:String(y4)===String(y4.reverse())},{reverse:function(){return fct(this)&&(this.length=this.length),mct(this)}});var Ect=E0("Array").reverse,gct=_d,_ct=Ect,MV=Array.prototype,vct=function(o){var s=o.reverse;return o===MV||gct(MV,o)&&s===MV.reverse?_ct:s},S4=vct,yct=j(S4),Sct=X_,T4=HN,Tct=v1,bct=OT,b4=aM,Rct=IR,Cct=AS,wct=P1,Ict=RS,Oct=BM,Act=M3("slice"),Nct=Ict("species"),xV=Array,kct=Math.max;Sct({target:"Array",proto:!0,forced:!Act},{slice:function(o,s){var d,g,b,$=Cct(this),Vt=Rct($),zt=b4(o,Vt),_e=b4(s===void 0?Vt:s,Vt);if(T4($)&&(d=$.constructor,(Tct(d)&&(d===xV||T4(d.prototype))||bct(d)&&(d=d[Nct])===null)&&(d=void 0),d===xV||d===void 0))return Oct($,zt,_e);for(g=new(d===void 0?xV:d)(kct(_e-zt,0)),b=0;zt<_e;zt++,b++)zt in $&&wct(g,b,$[zt]);return g.length=b,g}});var Pct=E0("Array").slice,Dct=_d,Lct=Pct,UV=Array.prototype,Mct=function(o){var s=o.slice;return o===UV||Dct(UV,o)&&s===UV.slice?Lct:s},xct=j(Mct);function BE(o,s,d,g,b){var $,Vt,zt,_e={};return lct($=v4(g)).call($,function(_r){_e[_r]=g[_r]}),_e.enumerable=!!_e.enumerable,_e.configurable=!!_e.configurable,("value"in _e||_e.initializer)&&(_e.writable=!0),_e=hct(Vt=yct(zt=xct(d).call(d)).call(zt)).call(Vt,function(_r,_o){return _o(o,s,_r)||_r},_e),b&&_e.initializer!==void 0&&(_e.value=_e.initializer?_e.initializer.call(b):void 0,_e.initializer=void 0),_e.initializer===void 0&&(k3(o,s,_e),_e=null),_e}var Uct=E0("Array").values,jct=iR,Vct=iT,Fct=_d,Bct=Uct,jV=Array.prototype,Gct={DOMTokenList:!0,NodeList:!0},Wct=function(o){var s=o.values;return o===jV||Fct(jV,o)&&s===jV.values||Vct(Gct,jct(o))?Bct:s},q0=j(Wct);let qct=function(o){return o.L1T1="L1T1",o.L1T2="L1T2",o.L1T3="L1T3",o.L2T1_KEY="L2T1_KEY",o.L2T2_KEY="L2T2_KEY",o.L2T3_KEY="L2T3_KEY",o.L3T1_KEY="L3T1_KEY",o.L3T2_KEY="L3T2_KEY",o.L3T3_KEY="L3T3_KEY",o}({}),KT=function(o){return o.CERTIFICATE="certificate",o.CODEC="codec",o.CANDIDATE_PAIR="candidate-pair",o.LOCAL_CANDIDATE="local-candidate",o.REMOTE_CANDIDATE="remote-candidate",o.INBOUND="inbound-rtp",o.TRACK="track",o.OUTBOUND="outbound-rtp",o.PC="peer-connection",o.REMOTE_INBOUND="remote-inbound-rtp",o.REMOTE_OUTBOUND="remote-outbound-rtp",o.TRANSPORT="transport",o.CSRC="csrc",o.DATA_CHANNEL="data-channel",o.STREAM="stream",o.SENDER="sender",o.RECEIVER="receiver",o}({}),AD=function(o){return o[o.ACCESS_POINT=101]="ACCESS_POINT",o[o.UNILBS=201]="UNILBS",o[o.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",o}({}),VV=function(o){return o[o.IIIEGAL_APPID=1]="IIIEGAL_APPID",o[o.IIIEGAL_UID=2]="IIIEGAL_UID",o[o.INTERNAL_ERROR=3]="INTERNAL_ERROR",o}({}),y0=function(o){return o[o.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",o[o.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",o[o.INTERNAL_ERROR=8]="INTERNAL_ERROR",o[o.NO_AUTHORIZED=9]="NO_AUTHORIZED",o[o.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",o[o.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",o[o.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",o[o.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",o[o.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",o[o.USER_OVERLOAD=16]="USER_OVERLOAD",o[o.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",o[o.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",o}({}),_T=function(o){return o[o.NO_FLAG_SET=100]="NO_FLAG_SET",o[o.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",o[o.INVALID_FALG_SET=102]="INVALID_FALG_SET",o[o.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",o[o.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",o[o.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",o[o.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",o[o.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",o[o.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",o[o.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",o[o.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",o[o.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",o[o.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",o[o.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",o[o.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",o[o.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",o[o.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",o[o.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",o[o.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",o}({}),r_=function(o){return o[o.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",o[o.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",o[o.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",o[o.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",o[o.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",o[o.K_TICKET_INVALID=7]="K_TICKET_INVALID",o[o.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",o[o.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",o[o.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",o[o.K_UID_BANNED=14]="K_UID_BANNED",o[o.K_IP_BANNED=15]="K_IP_BANNED",o[o.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",o[o.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",o[o.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",o[o.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",o[o.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",o[o.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",o[o.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",o[o.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",o[o.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",o[o.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",o[o.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",o[o.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",o[o.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",o[o.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",o[o.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",o[o.ERR_INVALID_UID=117]="ERR_INVALID_UID",o[o.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",o[o.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",o[o.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",o[o.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",o[o.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",o[o.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",o[o.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",o[o.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",o[o.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",o[o.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",o[o.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",o[o.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",o[o.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",o[o.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",o[o.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",o[o.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",o[o.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",o[o.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",o[o.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",o[o.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",o[o.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",o[o.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",o[o.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",o[o.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",o[o.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",o[o.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",o[o.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",o[o.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",o[o.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",o[o.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",o[o.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",o[o.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",o[o.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",o[o.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",o[o.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",o[o.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",o[o.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",o}({}),v_=function(o){return o.CONNECTING="connecting",o.CONNECTED="connected",o.RECONNECTING="reconnecting",o.CLOSED="closed",o}({}),XE=function(o){return o.WS_CONNECTED="ws_connected",o.WS_RECONNECTING="ws_reconnecting",o.WS_CLOSED="ws_closed",o.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",o.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",o.ON_BINARY_DATA="on_binary_data",o.REQUEST_RECOVER="request_recover",o.REQUEST_JOIN_INFO="request_join_info",o.REQUEST_REJOIN_INFO="req_rejoin_info",o.IS_P2P_DISCONNECTED="is_p2p_dis",o.DISCONNECT_P2P="dis_p2p",o.ABORT_P2P_EXECUTION="abort_p2p_execution",o.NEED_RENEW_SESSION="need-sid",o.REPORT_JOIN_GATEWAY="report_join_gateway",o.REQUEST_TIMEOUT="request_timeout",o.REQUEST_SUCCESS="request_success",o.JOIN_RESPONSE="join_response",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_CONNECTING="datachannel_connecting",o.DATACHANNEL_FAILBACK="datachannel_failback",o.P2P_CONNECTION="p2p_connection",o.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",o.P2P_SUBSCRIBE="p2p_subscribe",o.P2P_UNSUBSCRIBE="p2p_unsubscribe",o.P2P_EXCHANGE_SDP="p2p_exchange_sdp",o.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",o.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",o}({}),n_=function(o){return o.PING="ping",o.PING_BACK="ping_back",o.JOIN="join_v3",o.REJOIN="rejoin_v3",o.LEAVE="leave",o.SET_CLIENT_ROLE="set_client_role",o.PUBLISH="publish",o.PUBLISH_DATASTREAM="publish_datastream",o.UNPUBLISH="unpublish",o.UNPUBLISH_DATASTREAM="unpublish_datastream",o.SUBSCRIBE="subscribe",o.PRE_SUBSCRIBE="pre_subscribe",o.SUBSCRIBE_DATASTREAM="subscribe_datastream",o.SUBSCRIBE_STREAMS="subscribe_streams",o.UNSUBSCRIBE="unsubscribe",o.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",o.UNSUBSCRIBE_STREAMS="unsubscribe_streams",o.SUBSCRIBE_CHANGE="subscribe_change",o.TRAFFIC_STATS="traffic_stats",o.RENEW_TOKEN="renew_token",o.SWITCH_VIDEO_STREAM="switch_video_stream",o.DEFAULT_VIDEO_STREAM="default_video_stream",o.SET_FALLBACK_OPTION="set_fallback_option",o.GATEWAY_INFO="gateway_info",o.CONTROL="control",o.SEND_METADATA="send_metadata",o.DATA_STREAM="data_stream",o.PICK_SVC_LAYER="pick_svc_layer",o.RESTART_ICE="restart_ice",o.CONNECT_PC="connect_pc",o.SET_VIDEO_PROFILE="set_video_profile",o.SET_PARAMETER="set_parameter",o.SET_RTM2_FLAG="set_rtm2_flag",o}({}),qI=function(o){return o.WRTC_STATS="wrtc_stats",o.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",o.DENOISER_STATS="denoiser_stats",o.EXTENSION_USAGE_STATS="extension_usage_stats",o}({}),d_=function(o){return o.ON_USER_ONLINE="on_user_online",o.ON_USER_OFFLINE="on_user_offline",o.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",o.ON_PUBLISH_STREAM="on_publish_stream",o.ON_UPLINK_STATS="on_uplink_stats",o.ON_P2P_LOST="on_p2p_lost",o.ON_REMOVE_STREAM="on_remove_stream",o.ON_ADD_AUDIO_STREAM="on_add_audio_stream",o.ON_ADD_VIDEO_STREAM="on_add_video_stream",o.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",o.ON_USER_BANNED="on_user_banned",o.ON_USER_LICENSE_BANNED="on_user_license_banned",o.ON_NOTIFICATION="on_notification",o.ON_CRYPT_ERROR="on_crypt_error",o.MUTE_AUDIO="mute_audio",o.MUTE_VIDEO="mute_video",o.UNMUTE_AUDIO="unmute_audio",o.UNMUTE_VIDEO="unmute_video",o.ON_P2P_OK="on_p2p_ok",o.RECEIVE_METADATA="receive_metadata",o.ON_DATA_STREAM="on_data_stream",o.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",o.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",o.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",o.ENABLE_LOCAL_VIDEO="enable_local_video",o.DISABLE_LOCAL_VIDEO="disable_local_video",o.ENABLE_LOCAL_AUDIO="enable_local_audio",o.DISABLE_LOCAL_AUDIO="disable_local_audio",o.ON_PUBLISHED_USER_LIST="on_published_user_list",o}({}),vT=function(o){return o.SEND_ONLY="SEND_ONLY",o.RECEIVE_ONLY="RECEIVE_ONLY",o}({}),c_=function(o){return o.CONNECTED="websocket:connected",o.RECONNECTING="websocket:reconnecting",o.WILL_RECONNECT="websocket:will_reconnect",o.CLOSED="websocket:closed",o.FAILED="websocket:failed",o.ON_MESSAGE="websocket:on_message",o.REQUEST_NEW_URLS="websocket:request_new_urls",o.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",o}({});class EE extends TE{constructor(s){super(s,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Qm(this,"name","AgoraRTCException")}print(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(s,_l)}throw(){super.throw(_l)}}function ND(o){if(typeof o!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(o))throw _l.error("Invalid Channel Name ".concat(o)),new EE(rE.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function PD(o){if(!function(s){return typeof s=="number"&&Math.floor(s)===s&&0<=s&&s<=4294967295}(o)&&!H8(o,1,255))throw new EE(rE.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof o=="string"&&_l.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let YS=function(o){return o.TRANSCODE="mix_streaming",o.RAW="raw_streaming",o.INJECT="inject_streaming",o}({}),WO=function(o){return o[o.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",o[o.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",o[o.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",o[o.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",o[o.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",o[o.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",o[o.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",o[o.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",o[o.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",o[o.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN",o}({});const Hct={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},FV={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function BV(o,s){QS(o.url,"".concat(s,".url"),1,1e3,!1),dS(o.x)||W_(o.x,"".concat(s,".x"),0,1e4),dS(o.y)||W_(o.y,"".concat(s,".y"),0,1e4),dS(o.width)||W_(o.width,"".concat(s,".width"),0,1e4),dS(o.height)||W_(o.height,"".concat(s,".height"),0,1e4),dS(o.zOrder)||W_(o.zOrder,"".concat(s,".zOrder"),0,255),dS(o.alpha)||W_(o.alpha,"".concat(s,".alpha"),0,1,!1)}const Kct={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},zct={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let hR=function(o){return o.WARNING="@live_uap-warning",o.ERROR="@line_uap-error",o.PUBLISH_STREAM_STATUS="@live_uap-publish-status",o.INJECT_STREAM_STATUS="@live_uap-inject-status",o.WORKER_STATUS="@live_uap-worker-status",o.REQUEST_NEW_ADDRESS="@live_uap-request-address",o}({}),DD=function(o){return o.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",o}({}),US=function(o){return o[o.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",o[o.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",o[o.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",o[o.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",o[o.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",o[o.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",o[o.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",o[o.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",o[o.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",o[o.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",o[o.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",o[o.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",o[o.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",o[o.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",o[o.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",o[o.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",o[o.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",o[o.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",o}({});function R4(o){if(!o.channelName)throw new EE(rE.INVALID_PARAMS,"invalid channelName in info");if(typeof o.uid!="number")throw new EE(rE.INVALID_PARAMS,"invalid uid in info, uid must be a number");return o.token&&QS(o.token,"info.token",1,2047),PD(o.uid),ND(o.channelName),!0}let yT=function(o){return o[o.SetSdkProfile=0]="SetSdkProfile",o[o.SetSourceChannel=1]="SetSourceChannel",o[o.SetSourceUserId=2]="SetSourceUserId",o[o.SetDestChannel=3]="SetDestChannel",o[o.StartPacketTransfer=4]="StartPacketTransfer",o[o.StopPacketTransfer=5]="StopPacketTransfer",o[o.UpdateDestChannel=6]="UpdateDestChannel",o[o.Reconnect=7]="Reconnect",o[o.SetVideoProfile=8]="SetVideoProfile",o}({}),PR=function(o){return o.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",o.NETWORK_CONNECTED="NETWORK_CONNECTED",o.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",o.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",o.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",o.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",o.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",o.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",o.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",o.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",o}({}),NT=function(o){return o.RELAY_STATE_IDLE="RELAY_STATE_IDLE",o.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",o.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",o.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",o}({}),qO=function(o){return o.RELAY_OK="RELAY_OK",o.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",o.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",o.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",o}({}),x_=function(o){return o.High="high",o.Low="low",o.Audio="audio",o.Screen="screen",o.ScreenLow="screen_low",o}({}),_S=function(o){return o.DISCONNECT="disconnect",o.CONNECTION_STATE_CHANGE="connection-state-change",o.NETWORK_QUALITY="network-quality",o.STREAM_TYPE_CHANGE="stream-type-change",o.IS_P2P_DISCONNECTED="is-p2p-dis",o.DISCONNECT_P2P="dis-p2p",o.REQUEST_NEW_GATEWAY_LIST="req-gate-url",o.NEED_RENEW_SESSION="need-sid",o.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",o.JOIN_RESPONSE="join-response",o.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",o.RESET_CONNECTION_EVENTS="reset-connection-events",o.DATACHANNEL_PRECONNECT="datachannel_preconnect",o.DATACHANNEL_FAILBACK="datachannel_failback",o.RESET_SIGNAL="reset-signal",o}({}),cP=function(o){return o.P2P_DISCONNECTED="P2P_DISCONNECTED",o.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",o.TIMEOUT="TIMEOUT",o.UNKNOWN_REASON="UNKNOWN_REASON",o}({}),qS=function(o){return o[o.Nothing=0]="Nothing",o[o.Audio=1]="Audio",o[o.LwoVideo=2]="LwoVideo",o[o.Video=4]="Video",o[o.Data=8]="Data",o[o.DataStream0=256]="DataStream0",o[o.DataStream1=512]="DataStream1",o[o.DataStream2=1024]="DataStream2",o[o.DataStream3=2048]="DataStream3",o[o.DataStream4=4096]="DataStream4",o[o.DataStream5=8192]="DataStream5",o[o.DataStream6=16384]="DataStream6",o[o.DataStream7=32768]="DataStream7",o}({}),C4=function(o){return o[o.websocket=0]="websocket",o[o.datachannel=1]="datachannel",o}({}),k_=function(o){return o.CHINA="CHINA",o.ASIA="ASIA",o.NORTH_AMERICA="NORTH_AMERICA",o.EUROPE="EUROPE",o.JAPAN="JAPAN",o.INDIA="INDIA",o.KOREA="KOREA",o.HKMC="HKMC",o.US="US",o.OCEANIA="OCEANIA",o.SOUTH_AMERICA="SOUTH_AMERICA",o.AFRICA="AFRICA",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="EXTENSIONS",o}({});const w4=[k_.AFRICA,k_.ASIA,k_.CHINA,k_.EUROPE,k_.GLOBAL,k_.INDIA,k_.JAPAN,k_.NORTH_AMERICA,k_.OCEANIA,k_.OVERSEA,k_.SOUTH_AMERICA];let sT=function(o){return o.CHINA="CN",o.ASIA="AS",o.NORTH_AMERICA="NA",o.EUROPE="EU",o.JAPAN="JP",o.INDIA="IN",o.KOREA="KR",o.HKMC="HK",o.US="US",o.OCEANIA="OC",o.SOUTH_AMERICA="SA",o.AFRICA="AF",o.OVERSEA="OVERSEA",o.GLOBAL="GLOBAL",o.EXTENSIONS="GLOBAL",o}({});const LD={CHINA:{},ASIA:{CODE:sT.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:sT.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:sT.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:sT.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:sT.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:sT.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:sT.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:sT.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:sT.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:sT.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:sT.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:sT.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:sT.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};NV&&(LD.CHINA={CODE:sT.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let GV=function(o){return o.UPDATE_BITRATE_LIMIT="update_bitrate_limit",o}({});class I4 extends nS{constructor(s,d){super(),Qm(this,"onICEConnectionStateChange",void 0),Qm(this,"onConnectionStateChange",void 0),Qm(this,"onDTLSTransportStateChange",void 0),Qm(this,"onDTLSTransportError",void 0),Qm(this,"onICETransportStateChange",void 0),Qm(this,"onFirstAudioReceived",void 0),Qm(this,"onFirstVideoReceived",void 0),Qm(this,"onFirstAudioDecoded",void 0),Qm(this,"onFirstVideoDecoded",void 0),Qm(this,"onFirstVideoDecodedTimeout",void 0),Qm(this,"onSelectedLocalCandidateChanged",void 0),Qm(this,"onSelectedRemoteCandidateChanged",void 0),Qm(this,"getLocalVideoStats",void 0)}}class MD extends I4{constructor(s,d){super(s,d),Qm(this,"establishPromise",void 0)}}let _g=function(o){return o.VIDEO="video",o.AUDIO="audio",o}({}),hT=function(o){return o[o.UDP=0]="UDP",o[o.TCP=1]="TCP",o[o.RELAY=2]="RELAY",o}({}),DR=function(o){return o[o.FIRST_CONNECTION=0]="FIRST_CONNECTION",o[o.TCP_RESTART=1]="TCP_RESTART",o[o.RELAY_RESTART=2]="RELAY_RESTART",o[o.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",o[o.OLD_RESTART=11]="OLD_RESTART",o[o.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",o}({}),ME=function(o){return o.LocalVideoTrack="videoTrack",o.LocalAudioTrack="audioTrack",o.LocalVideoLowTrack="videoLowTrack",o}({}),j_=function(o){return o.New="new",o.Connected="connected",o.Reconnecting="reconnecting",o.Disconnected="disconnected",o}({}),a_=function(o){return o.StateChange="stateChange",o.IceConnectionStateChange="iceConnectionStateChange",o.RequestMuteLocal="requestMuteLocal",o.RequestUnmuteLocal="requestUnmuteLocal",o.RequestRePublish="requestRePublish",o.RequestRePublishDataChannel="requestRePublishDataChannel",o.RequestReSubscribe="requestReSubscribe",o.RequestUploadStats="requestUploadStats",o.RequestUpload="requestUpload",o.MediaReconnectStart="MediaReconnectStart",o.MediaReconnectEnd="MediaReconnectEnd",o.NeedSignalRTT="NeedSignalRTT",o.RequestRestartICE="RequestRestartIce",o.PeerConnectionStateChange="PeerConnectionStateChange",o.RequestReconnect="RequestReconnect",o.RequestReconnectPC="RequestReconnectPC",o.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",o.P2PLost="P2PLost",o.UpdateVideoEncoder="UpdateVideoEncoder",o.ConnectionTypeChange="ConnectionTypeChange",o.RequestLowStreamParameter="RequestLowStreamParameter",o.QueryClientConnectionState="QueryClientConnectionState",o.LocalCandidate="LocalCandidate",o.RequestP2PMuteLocal="requestP2PMuteLocal",o.RequestP2PUnPublish="RequestP2PUnPublish",o.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",o.RequestP2PMuteRemote="RequestP2PMuteRemote",o.RequestP2PRestartICE="RequestP2PRestartICE",o}({}),S0=function(o){return o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED",o}({}),T0=function(o){return o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED",o}({}),JS=function(o){return o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url",o}({}),oI=function(o){return o.NETWORK_ERROR="NETWORK_ERROR",o.SERVER_ERROR="SERVER_ERROR",o.MULTI_IP="MULTI_IP",o.TIMEOUT="TIMEOUT",o.OFFLINE="OFFLINE",o.LEAVE="LEAVE",o.P2P_FAILED="P2P_FAILED",o.FALLBACK="FALLBACK",o}({}),PS=function(o){return o.CONNECTED="transmitter:connected",o.RECONNECTING="transmitter:reconnecting",o.WILL_RECONNECT="transmitter:will_reconnect",o.CLOSED="transmitter:closed",o.FAILED="transmitter:failed",o.ON_MESSAGE="transmitter:on_message",o.REQUEST_NEW_URLS="transmitter:request_new_urls",o.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",o.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",o.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",o.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",o.FAILBACK="transmitter:failback",o}({}),pR=function(o){return o.CAMERA_CHANGED="camera-changed",o.MICROPHONE_CHANGED="microphone-changed",o.PLAYBACK_DEVICE_CHANGED="playback-device-changed",o.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",o.AUTOPLAY_FAILED="autoplay-failed",o.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",o.SECURITY_POLICY_VIOLATION="security-policy-violation",o}({}),s0=function(o){return o.CONNECTING="CONNECTING",o.RECONNECTING="RECONNECTING",o.CONNECTED="CONNECTED",o.CLOSED="CLOSED",o}({}),H0=function(o){return o.CONNECTION_STATE_CHANGE="connection-state-change",o.STATE_CHANGE="state-change",o.INSPECT_RESULT="inspect-result",o.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",o.REQUEST_NEW_WORKER_URL="request-new-worker-url",o}({}),HO=function(o){return o[o.CONNECT_AP=0]="CONNECT_AP",o[o.AP_CONNECTED=1]="AP_CONNECTED",o[o.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",o[o.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",o[o.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",o[o.CONNECT_WORKER=5]="CONNECT_WORKER",o[o.WORKER_CONNECTED=6]="WORKER_CONNECTED",o[o.CLOSED=7]="CLOSED",o}({}),vS=function(o){return o.CALL="call",o.CANDIDATE="candidate",o.PUBLISH="publish",o.UNPUBLISH="unpublish",o.CONTROL="control",o.RESTART_ICE="restart_ice",o.ACK="ack",o.RESPONSE="response",o.JOIN="join",o.CHECK="check",o}({}),KO=function(o){return o.ABORT="abort",o}({}),sI=function(o){return o.MUTE_LOCAL_AUDIO="mute_local_audio",o.MUTE_LOCAL_VIDEO="mute_local_video",o.UNMUTE_LOCAL_AUDIO="unmute_local_audio",o.UNMUTE_LOCAL_VIDEO="unmute_local_video",o}({}),Yct=function(o){return o.P2P_TOKEN_TIMEOUT="p2p_token_timeout",o.P2P_TOKEN_CHANGED="p2p_token_changed",o}({});const Jct={[AD.ACCESS_POINT]:{[_T.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[_T.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[_T.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[_T.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[_T.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[_T.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[_T.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[AD.UNILBS]:{[y0.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[y0.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[y0.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[y0.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[y0.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[y0.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[y0.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[y0.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[y0.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[y0.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[y0.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[y0.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[AD.STRING_UID_ALLOCATOR]:{[VV.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[VV.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[VV.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function zO(o){const s=Jct[Math.floor(o/1e4)];if(!s)return{desc:"unknown error",retry:!1};const d=s[o%1e4];if(!d){if(Math.floor(o/1e4)===AD.ACCESS_POINT){const g=o%1e4;if(g.toString()[0]==="1")return{desc:o.toString(),retry:!1};if(g.toString()[0]==="2")return{desc:o.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return d}const Xct={[r_.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[r_.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[r_.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[r_.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[r_.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[r_.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[r_.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[r_.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[r_.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[r_.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[r_.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[r_.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[r_.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[r_.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[r_.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[r_.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[r_.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[r_.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[r_.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[r_.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[r_.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[r_.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[r_.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[r_.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[r_.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[r_.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[r_.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[r_.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[r_.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[r_.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[r_.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[r_.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[r_.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[r_.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[r_.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[r_.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[r_.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[r_.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[r_.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[r_.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[r_.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[r_.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[r_.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[r_.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[r_.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[r_.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[r_.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[r_.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[r_.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[r_.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[r_.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[r_.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[r_.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[r_.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[r_.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[r_.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[r_.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[r_.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[r_.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[r_.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[r_.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[r_.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[r_.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function HI(o){return Xct[o]||{desc:"UNKNOW_ERROR_".concat(o),action:"failed"}}function O4(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function WV(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?O4(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):O4(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}function A4(o){return o.every(s=>s.readyState===WebSocket.CLOSED||s.readyState===WebSocket.CLOSING)}function N4(o,s){if(typeof o=="string")return o;const{proxy:d,host:g,port:b}=o;if(s){const $=cE("JOIN_GATEWAY_FALLBACK_PORT")||443;return $===443?"wss://".concat(g,"/ws/?p=").concat(Number(b)+150):"wss://".concat(g,":").concat($,"/ws/?p=").concat(Number(b)+150)}return d?"wss://".concat(d,"/ws/?h=").concat(g,"&p=").concat(b):"wss://".concat(g,":").concat(b)}const Qct=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Zct=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,$ct=/wss:\/\/(.+):([0-9]+)\/?/,tut=/wss:\/\/(.[^\/]+)\/?/;let eut=0;class nut{constructor(s,d){Qm(this,"id",0),Qm(this,"store",void 0),Qm(this,"recordIndex",void 0),Qm(this,"websockets",[]),Qm(this,"try443PortDuration",2e3),Qm(this,"forceCloseWSDuration",5e3),Qm(this,"try443PortTimeout",null),Qm(this,"forceCloseTimeout",null),Qm(this,"isTry443PortFailed",!1),Qm(this,"isNormalPortFailed",!1),Qm(this,"useDoubleDomain",!1),Qm(this,"useProxy",!1),Qm(this,"startTime",Date.now()),this.id=++eut,this.try443PortDuration=cE("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=s||5e3,this.store=d}closeAllWebsockets(){this.websockets.forEach(s=>{s.onopen=null,s.onclose=null,s.onmessage=null,s.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var s;const d=Date.now()-this.startTime;for(var g=arguments.length,b=new Array(g),$=0;$<g;$++)b[$]=arguments[$];_l.debug("[choose-best-ws ".concat((s=this.store)===null||s===void 0?void 0:s.clientId," ").concat(this.id,"] ").concat(d,"ms:"),...b)}createWebSocket(s,d,g){this.logger("createWebSocket:",s,{isTry443Port:d,hasTimeoutDetection:g});const b=cE("GATEWAY_DOMAINS"),$=Date.now(),Vt=[],zt=b.find(_o=>{var ga;return KE(ga=s.host).call(ga,_o)});zt||(this.useDoubleDomain=!1);const _e=[];if(this.useDoubleDomain)b.forEach(_o=>{_e.push(N4(WV(WV({},s),{},{host:s.host.replace(zt,_o)}),d))});else{const _o=WV({},s);if(d&&zt){const ga=b.find(_a=>_a!==zt);ga&&(_o.host=_o.host.replace(zt,ga))}_e.push(N4(_o,d))}try{_e.forEach(_o=>{const ga=new WebSocket(_o);ga.binaryType="arraybuffer",Vt.push(ga),this.logger("ws is connecting:",ga.url)})}catch(_o){if(this.logger("ws create failed"),Vt.forEach(ga=>ga.close()),Vt.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(s,d,g);if(!d&&Number(s.port)!==443)return this.createWebSocket(s,!0,g);throw new EE(rE.WS_ERR,"init websocket failed! Error: ".concat(_o.toString()))}const _r=eP();return this.store&&this.store.recordJoinChannelService({urls:Vt.map(_o=>_o.url),service:"gateway"},this.recordIndex),Vt.forEach(_o=>{_o.onopen=()=>{this.logger("onopen: ws ".concat(_o.url," open cost ").concat(Date.now()-$,"ms")),this.websockets.forEach(ga=>{ga!==_o&&(ga.onopen=null,ga.onclose=null,ga.onmessage=null,ga.close(),this.logger("close backup websocket: ".concat(ga.url)))}),this.websockets.length=0,_r.resolve(_o)},_o.onclose=ga=>{this.logger("onclose: ws ".concat(_o.url," closed cost ").concat(Date.now()-$,"ms state: ").concat(_o.readyState)),d?this.isTry443PortFailed=A4(Vt):this.isNormalPortFailed=A4(Vt),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(d&&this.isTry443PortFailed||!d&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(ga.reason)),_r.reject({code:ga.code,reason:cP.A_ROUND_WS_FAILED}))},_o.onmessage=ga=>this.logger("".concat(_o.url," onmessage: ").concat(ga.data))}),this.websockets.push(...Vt),g||(()=>{const _o=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",_r.isResolved),this.websockets.forEach(ga=>ga.readyState!==WebSocket.OPEN&&ga.close())};if(d||this.useProxy)return this.logger("add 5s timeout at ".concat(d?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(_o,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",_r.isResolved),_r.isResolved)return _o();O_().os===BS.MAC_OS&&H_()&&_o(),this.createWebSocket(s,!0,!0).then(ga=>_r.resolve(ga)).catch(ga=>{this.isNormalPortFailed&&_r.reject(ga),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(_o,this.forceCloseWSDuration)},this.try443PortDuration)})(),_r.promise}chooseBestWebsocket(s,d,g,b){return this.useDoubleDomain=!!d,typeof s=="string"&&(s=function($){let Vt,zt,_e;return[,Vt,zt,_e]=$.match(Qct)||[],Vt||([,zt,_e]=$.match(Zct)||[]),zt&&_e||([,zt,_e]=$.match($ct)||[]),zt&&_e||([,zt]=$.match(tut)||[]),zt||_l.warning("un-destructible url: ",$),{proxy:Vt,host:zt,port:_e||"443"}}(s)),this.recordIndex=b,this.useProxy=!!s.proxy,g&&this.useProxy&&(_l.warn("cannot use 443 only when use proxy"),g=!1),this.createWebSocket(s,!!g,!1).finally(()=>this.clearTimeout())}}function k4(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}class P4 extends nS{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(s){var d;KE(d=["tryNext","recover"]).call(d,s)&&this.resetReconnectCount(s),this._reconnectMode=s}get state(){return this._state}set state(s){s!==this._state&&(this._state=s,this._state==="reconnecting"?this.emit(c_.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(c_.CONNECTED):this._state==="closed"?this.emit(c_.CLOSED):this._state==="failed"&&this.emit(c_.FAILED))}resetReconnectCount(s){_l.debug("websocket reset reconnect count, reason: "+s),this.reconnectCount=0}constructor(s,d){let g=arguments.length>2&&arguments[2]!==void 0&&arguments[2],b=arguments.length>3&&arguments[3]!==void 0&&arguments[3],$=arguments.length>4&&arguments[4]!==void 0&&arguments[4],Vt=arguments.length>5?arguments[5]:void 0;super(),Qm(this,"connectionID",0),Qm(this,"currentURLIndex",0),Qm(this,"urls",[]),Qm(this,"_reconnectMode","tryNext"),Qm(this,"reconnectReason",void 0),Qm(this,"_initMutex",new KS("websocket")),Qm(this,"name",void 0),Qm(this,"_state","closed"),Qm(this,"reconnectInterrupter",void 0),Qm(this,"websocket",void 0),Qm(this,"retryConfig",void 0),Qm(this,"reconnectCount",0),Qm(this,"forceCloseTimeout",5e3),Qm(this,"onlineReconnectListener",void 0),Qm(this,"useCompress",void 0),Qm(this,"tryDoubleDomain",!1),Qm(this,"use443PortOnly",!1),Qm(this,"wsInflateLength",0),Qm(this,"wsDeflateLength",0),Qm(this,"closeEstablishingWs",()=>{}),Qm(this,"store",void 0),Qm(this,"joinGatewayRecordIndex",void 0),this.store=Vt,this.name=s,this.retryConfig=function(ga){for(var _a=1;_a<arguments.length;_a++){var _c=arguments[_a]!=null?arguments[_a]:{};_a%2?k4(Object(_c),!0).forEach(function(tE){Qm(ga,tE,_c[tE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ga,Object.getOwnPropertyDescriptors(_c)):k4(Object(_c)).forEach(function(tE){Object.defineProperty(ga,tE,Object.getOwnPropertyDescriptor(_c,tE))})}return ga}({},d),this.useCompress=g,this.tryDoubleDomain=b,this.use443PortOnly=$;const{timeout:zt,timeoutFactor:_e}=d,_r=Math.max(300,Math.floor(3*zt/5)),_o=Math.max(1.2,Math.floor(8*_e)/10);gT.ONLINE&&(this.retryConfig.timeout=_r,this.retryConfig.timeoutFactor=_o),pS.on(jI.NETWORK_STATE_CHANGE,(ga,_a)=>{ga!==_a&&(this.resetReconnectCount("network state change: ".concat(_a," -> ").concat(ga)),ga===gT.ONLINE?(this.retryConfig.timeout=_r,this.retryConfig.timeoutFactor=_o):(this.retryConfig.timeout=zt,this.retryConfig.timeoutFactor=_e))})}getConnection(){return this.websocket||void 0}async init(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const g=await this._initMutex.lock();this.forceCloseTimeout=d,this.urls=s,this.state="connecting";try{const b=eP(),$=this.urls[this.currentURLIndex];this.createWebSocketConnection($).then(b.resolve).catch(b.reject),this.once(c_.CLOSED,()=>{b.reject(new TE(rE.WS_DISCONNECT))}),this.once(c_.CONNECTED,b.resolve),await b.promise}catch{}finally{g()}}close(s,d){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const g=this.websocket;d?setTimeout(()=>g.close(),500):g.close(),this.websocket=void 0}this.state=s?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(s,d){if(!this.websocket)return void _l.warning("[".concat(this.name,"] can not reconnect, no websocket"));s!==void 0&&(this.reconnectMode=s),_l.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(d)]},this.joinGatewayRecordIndex);const g=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),g&&g.bind(this.websocket)({code:9999,reason:d})}sendMessage(s){let d=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new TE(rE.WS_ABORT,"websocket is not ready");try{d||(s=JSON.stringify(s)),this.websocket.send(s)}catch(g){throw new TE(rE.WS_ERR,"send websocket message error"+g.toString())}}setWsInflateData(s){this.wsDeflateLength=this.wsDeflateLength+s.originLength,this.wsInflateLength=this.wsInflateLength+s.compressedLength}getWsInflateData(){const s=this.wsInflateLength,d=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:s,wsDeflateLength:d}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(s){var d;const g=eP();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const b=_o=>{var ga;(ga=this.store)===null||ga===void 0||ga.signalChannelOpen(),_l.debug("[".concat(this.name,"] websocket opened:"),_o),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),g.resolve()},$=async _o=>{var ga;if(_l.debug("[".concat(this.name,"] websocket close ").concat((ga=this.websocket)===null||ga===void 0?void 0:ga.url,", code: ").concat(_o.code,", reason: ").concat(_o.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)g.reject(new TE(rE.WS_DISCONNECT,"websocket close: ".concat(_o.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_o.reason,this.state="reconnecting");const _a=VT(this,c_.WILL_RECONNECT,this.reconnectMode,_o.reason)||this.reconnectMode,_c=await this.reconnectWithAction(_a);if(this.state==="closed")return void _l.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!_c)return g.reject(new TE(rE.WS_DISCONNECT,"websocket reconnect failed: ".concat(_o.code))),this.close(!0);g.resolve()}},Vt=_o=>{this.emit(c_.ON_MESSAGE,_o)},zt=_o=>{_l.warn("[".concat(this.connectionID,"] ws open error ").concat(_o))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),cE("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(s=cE("GATEWAY_WSS_ADDRESS")),_l.debug("[".concat(this.name,"] start connect, url:"),s);const _e=(d=this.store)===null||d===void 0?void 0:d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var _r;const _o=await this.chooseBestWebsocketConnection(s);this.websocket=_o,b&&b(this.websocket.url),this.websocket.onclose=$,this.websocket.onmessage=Vt,this.websocket.onerror=zt,(_r=this.store)===null||_r===void 0||_r.recordJoinChannelService({endTs:Date.now(),status:"success"},_e),this.joinGatewayRecordIndex=_e}catch(_o){const ga=this.state==="closed",_a=_o instanceof TE,_c=_a&&_o.code===rE.WS_ABORT,tE=_a&&_o.code===rE.WS_ERR,_p=_a?_o.message:_o&&(_o.reason||_o.toString());_l.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(_p)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:_c?"aborted":"error",errors:[_o]},_e),ga||tE?(g.reject(ga?new TE(rE.WS_DISCONNECT,"websocket is closed: ".concat(_p)):new TE(rE.WS_ERR,"init websocket failed: ".concat(_p))),tE&&_l.error("[".concat(this.name,"] init websocket failed: ").concat(_p))):$&&$(_o)}return g.promise}async reconnectWithAction(s){let d=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;_l.warning("[choose-best-ws] action: =>",s),this.onlineReconnectListener||pS.isOnline||!pS.onlineWaiter||(this.onlineReconnectListener=pS.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let g=!0;if(this.reconnectInterrupter=()=>g=!1,d){const Vt=CD(this.reconnectCount,this.retryConfig);_l.debug("[".concat(this.name,"] wait ").concat(Vt,"ms to reconnect websocket, mode: ").concat(s)),await GE.race([WS(Vt),this.onlineReconnectListener||new GE(()=>{})])}if(this._state==="closed"||!g)return!1;this.reconnectCount+=1;const b=async(Vt,zt)=>{this.emit(c_.RECONNECT_CREATE_CONNECTION,zt),await this.createWebSocketConnection(Vt)};try{if(s==="retry")this.emit(c_.RECONNECT_WAITTING_FINISH,s),await b(this.urls[this.currentURLIndex],s);else if(s==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);_l.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(c_.RECONNECT_WAITTING_FINISH,s),await b(this.urls[this.currentURLIndex],s)}else s==="recover"&&(_l.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(c_.RECONNECT_WAITTING_FINISH,s),this.urls=await kS(this,c_.REQUEST_NEW_URLS),this.currentURLIndex=0,await b(this.urls[this.currentURLIndex],s))}catch(Vt){var $;_l.error("[".concat(this.name,"] reconnect failed ").concat(Vt&&Vt.toString()));const zt=Vt==null||($=Vt.data)===null||$===void 0?void 0:$.desc;return Array.isArray(zt)&&KE(zt).call(zt,"dynamic key expired")?(this.emit(c_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(s,d)}return!0}}class uP extends P4{constructor(s,d){super(s,d,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(s,d){const g=eP(),b=function(Vt,zt){return new nut(Vt,zt)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{_l.debug("[choose-best-ws] close establishing websockets"),b.closeAllWebsockets(),g.reject(new TE(rE.WS_ABORT,"choose best websocket aborted"))};const $=cE("GATEWAY_DOMAINS");return _l.debug("[choose-best-ws] currentDomain: ",s,", domains: ",$,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),b.chooseBestWebsocket(s,this.tryDoubleDomain,this.use443PortOnly,d).then(g.resolve).catch(g.reject),g.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class lP extends P4{constructor(s,d){super(s,d,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(s,d){return new GE((g,b)=>{let $=!1;const Vt=[];this.closeEstablishingWs=()=>{_l.debug("[choose-best-ws] close establishing websockets"),Vt.forEach(tE=>{tE.onclose=null,tE.onopen=null,tE.onmessage=null,tE.close()}),b(new TE(rE.WS_ABORT,"choose best websocket aborted"))};const zt=cE("GATEWAY_DOMAINS");let _e;const _r=s.indexOf("?h="),_o=zt.find(tE=>_r!==-1?KE(s).call(s,tE,_r):KE(s).call(s,tE));_l.debug("[choose-best-ws] currentDomain: ",_o,", domains: ",zt);let ga=!this.tryDoubleDomain||!_o;if(!ga&&_o){var _a;const tE=Date.now();try{zt.forEach(_p=>{const _f=_r===-1?s.replace(_o,_p):s.substr(0,_r)+s.substr(_r).replace(_o,_p),eE=new WebSocket(_f);eE.binaryType="arraybuffer",Vt.push(eE),_l.debug("[choose-best-ws] ws is connecting:",eE.url)})}catch{for(_l.debug("[choose-best-ws] ws create failed, fallback to single url"),Vt.forEach(_f=>_f.close());Vt.length;)Vt.pop();ga=!0}(_a=this.store)===null||_a===void 0||_a.recordJoinChannelService({urls:Vt.map(_p=>_p.url),service:"gateway"},d),Vt.forEach(_p=>{_p.onopen=()=>{if($)return;const _f=Date.now()-tE;_l.debug("[choose-best-ws] ws open cost ".concat(_f,"ms")),Vt.filter(eE=>eE!==_p).forEach(eE=>{_l.debug("[choose-best-ws]close backup websocket: ".concat(eE.url)),eE.close()}),$=!0,g(_p)},_p.onclose=_f=>{_e=_f,!$&&(Vt.find(eE=>!(eE.readyState===WebSocket.CLOSED||eE.readyState===WebSocket.CLOSING))||(_l.debug("[choose-best-ws] all websocket is closed"),$=!0,b(_e)))},_p.onmessage=_f=>{_l.debug("[choose-best-ws]".concat(_p.url," onmessage: ").concat(_f.data))}}),WS(this.forceCloseTimeout).then(()=>{Vt.forEach(_p=>{_p.readyState!==WebSocket.OPEN&&_p.close()})})}if(ga){var _c;let tE;_l.debug("[choose-best-ws] use single url: ",s),(_c=this.store)===null||_c===void 0||_c.recordJoinChannelService({urls:[s],service:"gateway"},d);try{tE=new WebSocket(s),Vt.push(tE),tE.binaryType="arraybuffer"}catch(_p){const _f=new TE(rE.WS_ERR,"init websocket failed! Error: ".concat(_p.toString()));return _l.error("[".concat(this.name,"]").concat(_f)),void b(_f)}tE.onopen=()=>{g(tE)},tE.onclose=_p=>{b(_p)},tE.onmessage=_p=>{_l.debug("[choose-best-ws]".concat(tE.url," onmessage: ").concat(_p.data))},WS(this.forceCloseTimeout).then(()=>{tE&&tE.readyState!==WebSocket.OPEN&&tE.close()})}}).then(g=>(this.closeEstablishingWs=void 0,g)).catch(g=>{throw this.closeEstablishingWs=void 0,g})}}class D4 extends nS{get connectionState(){return this._connectionState}set connectionState(s){s!==this._connectionState&&(this._connectionState=s,s===v_.CONNECTED?this.emit(XE.WS_CONNECTED):s===v_.RECONNECTING?this.emit(XE.WS_RECONNECTING,this._websocketReconnectReason):s===v_.CLOSED&&this.emit(XE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(s,d){super(),Qm(this,"_disconnectedReason",void 0),Qm(this,"_websocketReconnectReason",void 0),Qm(this,"_connectionState",v_.CLOSED),Qm(this,"reconnectToken",void 0),Qm(this,"websocket",void 0),Qm(this,"openConnectionTime",void 0),Qm(this,"clientId",void 0),Qm(this,"lastMsgTime",Date.now()),Qm(this,"uploadCache",[]),Qm(this,"uploadCacheInterval",void 0),Qm(this,"rttRolling",new IV(5)),Qm(this,"pingpongTimer",void 0),Qm(this,"wsInflateDataTimer",void 0),Qm(this,"pingpongTimeoutCount",0),Qm(this,"joinResponse",void 0),Qm(this,"multiIpOption",void 0),Qm(this,"initError",void 0),Qm(this,"spec",void 0),Qm(this,"store",void 0),Qm(this,"onWebsocketMessage",g=>{if(g.data instanceof ArrayBuffer)return void this.emit(XE.ON_BINARY_DATA,g.data);const b=JSON.parse(g.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(b,"_id")){const $="res-@".concat(b._id);this.emit($,b._result,b._message)}else if(Object.prototype.hasOwnProperty.call(b,"_type")){if(this.emit(b._type,b._message),b._type===d_.ON_NOTIFICATION&&this.handleNotification(b._message),b._type===d_.ON_USER_BANNED)switch(b._message.error_code){case 14:this.close(y_.UID_BANNED);break;case 15:this.close(y_.IP_BANNED);break;case 16:this.close(y_.CHANNEL_BANNED)}if(b._type===d_.ON_USER_LICENSE_BANNED)switch(b._message.error_code){case r_.ERR_LICENSE_MISSING:this.close(y_.LICENSE_MISSING);break;case r_.ERR_LICENSE_EXPIRED:this.close(y_.LICENSE_EXPIRED);break;case r_.ERR_LICENSE_MINUTES_EXCEEDED:this.close(y_.LICENSE_MINUTES_EXCEEDED);break;case r_.ERR_LICENSE_PERIOD_INVALID:this.close(y_.LICENSE_PERIOD_INVALID);break;case r_.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(y_.LICENSE_MULTIPLE_SDK_SERVICE);break;case r_.ERR_LICENSE_ILLEGAL:this.close(y_.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=s.clientId,this.spec=s,this.store=d,this.websocket=new uP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,cE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),cE("JOIN_GATEWAY_USE_443PORT_ONLY"),d),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===v_.CONNECTED&&this.reconnect("retry",tT.OFFLINE)})}async request(s,d,g,b){const $=z_(6,""),Vt={_id:$,_type:s,_message:d},zt=this.websocket.connectionID,_e=()=>new GE((tE,_p)=>{if(this.connectionState===v_.CONNECTED)return tE();const _f=()=>{this.off(XE.WS_CLOSED,eE),tE()},eE=()=>{this.off(XE.WS_CONNECTED,_f),_p(new EE(rE.WS_ABORT))};this.once(XE.WS_CONNECTED,_f),this.once(XE.WS_CLOSED,eE),s!==n_.PUBLISH&&s!==n_.PUBLISH_DATASTREAM&&s!==n_.SUBSCRIBE&&s!==n_.SUBSCRIBE_DATASTREAM&&s!==n_.UNSUBSCRIBE&&s!==n_.UNSUBSCRIBE_DATASTREAM&&s!==n_.UNPUBLISH&&s!==n_.UNPUBLISH_DATASTREAM&&s!==n_.CONTROL&&s!==n_.RESTART_ICE||this.once(XE.DISCONNECT_P2P,()=>{_p(new EE(rE.DISCONNECT_P2P))}),s!==n_.PUBLISH&&s!==n_.RESTART_ICE||this.once(XE.ABORT_P2P_EXECUTION,()=>{_p(new EE(rE.DISCONNECT_P2P))})});if(this.connectionState!==v_.CONNECTING&&this.connectionState!==v_.RECONNECTING||s===n_.JOIN||s===n_.REJOIN||await _e(),this.websocket.sendMessage(Vt,!0),b)return;const _r=new GE((tE,_p)=>{let _f=!1;const eE=(fE,mE)=>{_f=!0,tE({isSuccess:fE==="success",message:mE||{}}),this.off(XE.WS_CLOSED,iE),this.off(XE.WS_RECONNECTING,iE),this.emit(XE.REQUEST_SUCCESS,s,d)};this.once("res-@".concat($),eE);const iE=()=>{_p(new EE(rE.WS_ABORT,"type: ".concat(s))),this.off(XE.WS_CLOSED,iE),this.off(XE.WS_RECONNECTING,iE),this.off("res-@".concat($),eE)};this.once(XE.WS_CLOSED,iE),this.once(XE.WS_RECONNECTING,iE),WS(cE("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==zt||_f||(_l.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(s)),this.emit(XE.REQUEST_TIMEOUT,s,d))})});let _o=null;try{_o=await _r}catch(tE){if(this.connectionState===v_.CLOSED||s===n_.LEAVE)throw new EE(rE.WS_ABORT);return!this.spec.forceWaitGatewayResponse||g?tE.throw():s===n_.JOIN||s===n_.REJOIN?null:(await _e(),await this.request(s,d))}if(_o.isSuccess)return _o.message;const ga=Number(_o.message.error_code||_o.message.code),_a=HI(ga),_c=new EE(rE.UNEXPECTED_RESPONSE,"".concat(_a.desc,": ").concat(_o.message.error_str),{code:ga,data:_o.message});return _a.action==="success"?_o.message:(_l.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(s,", error_code: ").concat(ga,", message: ").concat(_a.desc,", action: ").concat(_a.action)),ga===r_.ERR_TOO_MANY_BROADCASTERS?((s===n_.JOIN||s===n_.REJOIN)&&(this.initError=_c,this.close()),_c.throw()):_a.action==="failed"?_c.throw():_a.action==="quit"?(this.initError=_c,this.close(),_c.throw()):(ga===r_.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_o.message.option,_l.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",tT.MULTI_IP)):this.reconnect(_a.action,tT.SERVER_ERROR),s===n_.JOIN||s===n_.REJOIN?null:await this.request(s,d)))}waitMessage(s,d){return new GE(g=>{const b=$=>{(!d||d($))&&(this.off(s,b),g($))};this.on(s,b)})}uploadWRTCStats(s){if(!this.store.sessionId)return void _l.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const d={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:s};this.upload(qI.WRTC_STATS,d)}upload(s,d){const g={_type:s,_message:d};try{this.websocket.sendMessage(g)}catch{const $=cE("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(g),this.uploadCache.length>$&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==v_.CONNECTED)return;const Vt=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(Vt._type,Vt._message)},cE("UPLOAD_CACHE_INTERVAL")||2e3))}}send(s,d){const g={_type:s,_message:d};this.websocket.sendMessage(g)}init(s,d){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new GE((g,b)=>{this.once(XE.WS_CONNECTED,()=>g(this.joinResponse)),this.once(XE.WS_CLOSED,()=>b(this.initError||new EE(rE.WS_ABORT))),this.connectionState=v_.CONNECTING,this.websocket.init(s).catch(b),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=s||y_.LEAVE,this.connectionState=v_.CLOSED,_l.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),s===y_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new uP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,cE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),cE("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(XE.ABORT_P2P_EXECUTION);const s=await kS(this,XE.REQUEST_JOIN_INFO),d=await this.request(n_.JOIN,s);if(!d)return this.emit(XE.REPORT_JOIN_GATEWAY,cP.TIMEOUT,this.url||""),!1;this.joinResponse=d,this.emit(XE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=v_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new EE(rE.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const s=VI(this,XE.REQUEST_REJOIN_INFO);s.token=this.reconnectToken;const d=await this.request(n_.REJOIN,s);return!!d&&(this.connectionState=v_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),d.peers&&d.peers.forEach(g=>{this.emit(d_.ON_USER_ONLINE,{uid:g.uid}),g.audio&&this.emit(d_.ON_ADD_AUDIO_STREAM,{uid:g.uid,uint_id:g.uint_id,audio:!0,ssrcId:g.audio_ssrc}),g.video&&this.emit(d_.ON_ADD_VIDEO_STREAM,{uid:g.uid,uint_id:g.uint_id,video:!0,ssrcId:g.video_ssrc}),g.audio_mute?this.emit(d_.MUTE_AUDIO,{uid:g.uid}):this.emit(d_.UNMUTE_AUDIO,{uid:g.uid}),g.video_mute?this.emit(d_.MUTE_VIDEO,{uid:g.uid}):this.emit(d_.UNMUTE_VIDEO,{uid:g.uid}),g.audio_enable_local?this.emit(d_.ENABLE_LOCAL_AUDIO,{uid:g.uid}):this.emit(d_.DISABLE_LOCAL_AUDIO,{uid:g.uid}),g.video_enable_local?this.emit(d_.ENABLE_LOCAL_VIDEO,{uid:g.uid}):this.emit(d_.DISABLE_LOCAL_VIDEO,{uid:g.uid}),g.audio||g.video||this.emit(d_.ON_REMOVE_STREAM,{uid:g.uid,uint_id:g.uint_id})}),!0)}reconnect(s,d){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(s,d)}handleNotification(s){_l.debug("[".concat(this.clientId,"] receive notification: "),s);const d=HI(s.code);if(d.action!=="success"){if(d.action!=="failed")return d.action==="quit"?(d.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(y_.UID_BANNED),void this.close()):void this.reconnect(d.action,tT.SERVER_ERROR);_l.error("[".concat(this.clientId,"] ignore error: "),d.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const s=cE("PING_PONG_TIME_OUT"),d=Date.now();this.pingpongTimeoutCount>=s&&(_l.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(d-this.lastMsgTime,"ms")),d-this.lastMsgTime>cE("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",tT.TIMEOUT):this.request(n_.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const g=Date.now()-d;this.rttRolling.add(g),cE("REPORT_STATS")&&this.send(n_.PING_BACK,{pingpongElapse:g})}).catch(g=>{})}handleWsInflateData(){const{wsInflateLength:s,wsDeflateLength:d}=this.websocket.getWsInflateData();s!==0&&d!==0&&this.upload(qI.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:d,ws_inflate_length:s})}handleWebsocketEvents(){this.websocket.on(c_.RECONNECT_WAITTING_FINISH,s=>{this.emit(XE.WS_RECONNECT_WAITTING_FINISH,s)}),this.websocket.on(c_.RECONNECT_CREATE_CONNECTION,s=>{this.emit(XE.WS_RECONNECT_CREATE_CONNECTION,s)}),this.websocket.on(c_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(c_.CLOSED,()=>{this.connectionState=v_.CLOSED}),this.websocket.on(c_.FAILED,()=>{this._disconnectedReason=y_.NETWORK_ERROR,this.connectionState=v_.CLOSED}),this.websocket.on(c_.RECONNECTING,s=>{this._websocketReconnectReason=s,this.joinResponse=void 0,this.connectionState===v_.CONNECTED?this.connectionState=v_.RECONNECTING:this.connectionState=v_.CONNECTING}),this.websocket.on(c_.WILL_RECONNECT,(s,d,g)=>{const b=VI(this,XE.IS_P2P_DISCONNECTED),$=b||s!=="retry";b&&s==="retry"&&(_l.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),s="tryNext",d=cP.P2P_DISCONNECTED),$&&(_l.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(s)),this.emit(XE.REPORT_JOIN_GATEWAY,d||cP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(XE.NEED_RENEW_SESSION,this.websocket.currentURLIndex>=this.websocket.urls.length-1?"recover":s),this.emit(XE.DISCONNECT_P2P)),g(s)}),this.websocket.on(c_.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(s=>{_l.warning("[".concat(this.clientId,"] rejoin failed ").concat(s)),this.reconnect("tryNext",tT.SERVER_ERROR)}):this.join().catch(s=>{if(this.emit(XE.REPORT_JOIN_GATEWAY,s.message||s.code||cP.UNKNOWN_REASON,this.url||""),s instanceof EE){if(s.code===rE.UNEXPECTED_RESPONSE&&s.data.code===r_.ERR_NO_AUTHORIZED)return this.initError=new EE(rE.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),_l.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",tT.SERVER_ERROR);_l.error("[".concat(this.clientId,"] join gateway request failed"),s.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",tT.SERVER_ERROR):(this.initError=s,this.close())}})}),this.websocket.on(c_.REQUEST_NEW_URLS,(s,d)=>{kS(this,XE.REQUEST_RECOVER,this.multiIpOption).then(s).catch(d)}),this.websocket.on(c_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(d_.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let wS=function(o){return o[o.CHOOSE_SERVER=11]="CHOOSE_SERVER",o[o.CLOUD_PROXY=18]="CLOUD_PROXY",o[o.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",o[o.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",o}({});function L4(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function xD(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?L4(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):L4(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}function aI(o){return o.match(/^[\.\:\d]+$/)?"".concat(o.replace(/[^\d]/g,"-"),".").concat(cE("TURN_DOMAIN")):(_l.info("Unidentified as ip: ".concat(o,", use as host")),o)}function qV(o,s){o.addresses||(o.addresses=[]);const d=function($,Vt){if(cE("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return $.map(_r=>{let{ip:_o,port:ga}=_r;return{address:"".concat(_o,":").concat(ga)}});const zt=cE("GATEWAY_DOMAINS");let _e=zt[1]&&KE(Vt).call(Vt,zt[1])?1:0;return $.map(_r=>{let{domain_prefix:_o,port:ga,ip:_a}=_r;if(_o)return{address:"".concat(_o,".").concat(zt[_e++%zt.length],":").concat(ga)};const _c=/^[\.\:\d]+$/.test(_a),tE=_c?"".concat(_a.replace(/[^\d]/g,"-"),".").concat(zt[_e++%zt.length],":").concat(ga):"".concat(_a,":").concat(ga);return _c||_l.info("Unidentified as ip: ".concat(_a,", use as host")),{ip:_a,port:ga,address:tE}})}(o.addresses,s),g=Array.isArray(o.detail)&&o.detail[18];if(g&&typeof g=="string"){const $=g.split(";");for(let Vt=0;Vt<$.length;Vt++){var b;const zt=dT(b=$[Vt]).call(b);d[Vt]&&zt&&(d[Vt].ip6=zt)}}return{gatewayAddrs:d,uid:o.uid,cid:o.cid,cert:o.cert,vid:o.detail&&o.detail[8],uni_lbs_ip:o.detail&&o.detail[1],res:o,csIp:o.detail&&o.detail[502]}}function kT(o){return typeof o=="number"?o:o.exact||o.ideal||o.max||o.min||0}function M4(o){const s=o._encoderConfig;if(!s)return{};const d={resolution:s.width&&s.height?"".concat(kT(s.width),"x").concat(kT(s.height)):void 0,maxVideoBW:s.bitrateMax,minVideoBW:s.bitrateMin};return typeof s.frameRate=="number"?(d.maxFrameRate=s.frameRate,d.minFrameRate=s.frameRate):s.frameRate&&(d.maxFrameRate=s.frameRate.max||s.frameRate.ideal||s.frameRate.exact||s.frameRate.min,d.minFrameRate=s.frameRate.min||s.frameRate.ideal||s.frameRate.exact||s.frameRate.max),d}function x4(o){return o>=0&&o<.17?1:o>=.17&&o<.36?2:o>=.36&&o<.59?3:o>=.59&&o<=1?4:o>1?5:0}function dP(o,s){let d,g,b;switch(s){case wS.CHOOSE_SERVER:g=4096,b="choose server";break;case wS.CLOUD_PROXY:g=1048576,b="proxy";break;case wS.CLOUD_PROXY_5:g=4194304,b="proxy5";break;case wS.CLOUD_PROXY_FALLBACK:g=4194310,b="proxy fallback";break;default:throw new EE(rE.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:o.detail&&o.detail[502],retry:!1})}if(o.response_body.forEach($=>{$.buffer&&$.buffer.flag===g&&(d={code:$.buffer.code,addresses:($.buffer.edges_services||[]).map(Vt=>xD(xD({},Vt),{},{ticket:$.buffer.cert})),server_ts:o.enter_ts,uid:$.buffer.uid,cid:$.buffer.cid,cname:$.buffer.cname,detail:xD(xD({},$.buffer.detail),o.detail),flag:$.buffer.flag,opid:o.opid,cert:$.buffer.cert})}),!d)throw new EE(rE.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(b," from multi unilbs response"),{csIp:o.detail&&o.detail[502]});return d}async function U4(o,s){return await GE.all(o.addresses.map(async d=>({address:aI(d.ip),tcpport:d.port,udpport:d.port,username:s&&cE("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?s.toString():eT.username,password:s&&cE("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await RV(s.toString()):eT.password})))}function HV(o,s){const d=s.getMediaStreamTrack(!0).getSettings(),g=s.videoHeight||d.height,b=s.videoWidth||d.width;return g&&b?Math.max(Math.min(g,b)/Math.min(kT(o.height),kT(o.width)),1):(_l.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function cI(o){let{candidateType:s,relayProtocol:d,type:g,address:b,port:$,protocol:Vt}=o;return g==="local-candidate"?{candidateType:s,relayProtocol:d,protocol:Vt}:{candidateType:s,relayProtocol:d,address:b,port:$,protocol:Vt}}function j4(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}class rut extends nS{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(s){var d;KE(d=["tryNext","recover"]).call(d,s)&&this.resetReconnectCount(s),this._reconnectMode=s}get state(){return this._state}set state(s){s!==this._state&&(this._state=s,this._state==="reconnecting"?this.emit(PS.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(PS.CONNECTED):this._state==="closed"?this.emit(PS.CLOSED):this._state==="failed"&&this.emit(PS.FAILED))}constructor(s,d,g,b){super(),Qm(this,"connectionID",0),Qm(this,"currentURLIndex",0),Qm(this,"reconnectReason",void 0),Qm(this,"_reconnectMode","tryNext"),Qm(this,"_initMutex",void 0),Qm(this,"_name",void 0),Qm(this,"_state","closed"),Qm(this,"_reconnectInterrupter",void 0),Qm(this,"_url",void 0),Qm(this,"_retryConfig",void 0),Qm(this,"_reconnectCount",0),Qm(this,"_forceCloseTimeout",5e3),Qm(this,"_onlineReconnectListener",void 0),Qm(this,"_closeEstablishingTransmitter",()=>{}),Qm(this,"_store",void 0),Qm(this,"_joinChannelServiceRecordIndex",void 0),Qm(this,"_transmitter",void 0),Qm(this,"_useCompress",void 0),Qm(this,"_inflateLength",0),Qm(this,"_deflateLength",0),this._store=b,this._name=s,this._retryConfig=function($){for(var Vt=1;Vt<arguments.length;Vt++){var zt=arguments[Vt]!=null?arguments[Vt]:{};Vt%2?j4(Object(zt),!0).forEach(function(_e){Qm($,_e,zt[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties($,Object.getOwnPropertyDescriptors(zt)):j4(Object(zt)).forEach(function(_e){Object.defineProperty($,_e,Object.getOwnPropertyDescriptor(zt,_e))})}return $}({},d),this._useCompress=g}resetReconnectCount(s){_l.debug("".concat(this._name," reset reconnect count, reason: ").concat(s)),this._reconnectCount=0}close(s,d){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const g=this._transmitter;d?setTimeout(()=>g.close(),500):g.close(),this._transmitter=void 0}this.state=s?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(s,d){if(!this._transmitter)return void _l.warning("[".concat(this._name,"] can not reconnect, no websocket"));var g;s!==void 0&&(this.reconnectMode=s),_l.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((g=this._store)===null||g===void 0||g.recordJoinChannelService({status:"error",errors:[new Error(d)]},this._joinChannelServiceRecordIndex));const b=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),b&&b.bind(this._transmitter)({code:9999,reason:d})}getInflateData(){const s=this._inflateLength,d=this._deflateLength;return this.clearInflateData(),{inflateLength:s,deflateLength:d}}setInflateData(s){this._deflateLength=this._deflateLength+s.originLength,this._inflateLength=this._inflateLength+s.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}let K0=function(o){return o[o.Default=0]="Default",o[o.Ack=1]="Ack",o}({});class iut{constructor(s,d,g){Qm(this,"version",1),Qm(this,"initialRTO",void 0),Qm(this,"maxBatchAckCount",void 0),Qm(this,"maxRTO",void 0),Qm(this,"initialRTT",void 0),Qm(this,"ID",void 0),Qm(this,"rtt",void 0),Qm(this,"packetNumber",1),Qm(this,"rtoRatioMap",new Map),Qm(this,"timeoutMap",new Map),Qm(this,"unorderedPacketQueue",[]),Qm(this,"batchAckPacketQueue",[]),Qm(this,"lastOrderedPacketNumber",0),Qm(this,"batchAckTimer",void 0),Qm(this,"sendImpl",void 0),Qm(this,"receiveImpl",void 0),this.sendImpl=s,this.receiveImpl=d,this.ID=z_(7,"transmitter-"),this.initialRTO=(g==null?void 0:g.initialRTO)!==void 0?g.initialRTO:cE("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(g==null?void 0:g.initialRTT)!==void 0?g.initialRTT:cE("TRANSMITTER_INITIAL_RTT"),this.rtt=(g==null?void 0:g.initialRTT)!==void 0?g.initialRTT:cE("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(g==null?void 0:g.maxBatchAckCount)!==void 0?g.maxBatchAckCount:cE("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(g==null?void 0:g.maxRTO)!==void 0?g.maxRTO:cE("TRANSMITTER_MAX_RTO")}packetize(s,d){return{type:K0.Default,version:this.version,packetNumber:d,payload:s}}serialize(s){switch(s.type){case K0.Default:{let d;typeof s.payload=="string"?d=new TextEncoder().encode(s.payload):d=s.payload;const g=new ArrayBuffer(d.length+15),b=new DataView(g);return b.setUint16(0,s.version),b.setUint8(2,s.type),b.setUint32(3,s.packetNumber),z8(b,7,BigInt(s.sendTs)),new Uint8Array(b.buffer).set(d,15),g}case K0.Ack:{const d=new ArrayBuffer(16),g=new DataView(d);return g.setUint16(0,s.version),g.setUint8(2,s.type),g.setUint32(3,s.maxAckPacketNumber),g.setUint8(7,s.shift),z8(g,8,BigInt(s.ackSendTs)),d}}}deserialize(s){const d=new DataView(s),g=d.getUint16(0),b=d.getUint8(2);switch(b){case K0.Default:{const $=d.getUint32(3),Vt=K8(d,7),zt=s.slice(15),_e=new TextDecoder().decode(zt);return{version:g,type:b,packetNumber:$,sendTs:Number(Vt),payload:_e}}case K0.Ack:{const $=d.getUint32(3),Vt=d.getUint8(7),zt=K8(d,8);return{version:g,type:b,maxAckPacketNumber:$,shift:Vt,ackSendTs:Number(zt)}}default:throw _l.error("[".concat(this.ID,"] Unrecognized packet type ").concat(b)),new Error("Unrecognized packet type ".concat(b))}}sendMessage(s){const d=this.packetize(s,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const g=this.calculateRTO(d),b=window.setTimeout(()=>{this.resendMessage(d)},g);this.timeoutMap.set(d.packetNumber,b),this.sendPacket(d)}onData(s){const d=this.deserialize(s);d.type===K0.Default?this.ack(d):d.type===K0.Ack&&(this.updateRTT(d,Math.round(performance.now())),this.clearRTO(d))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(s=>{let[d,g]=s;window.clearTimeout(g)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(s){const d=this.calculateRTO(s),g=window.setTimeout(()=>{this.resendMessage(s)},d);this.timeoutMap.set(s.packetNumber,g),this.sendPacket(s)}calculateRTO(s){const d=this.rtoRatioMap.get(s.packetNumber);if(d===void 0)return this.rtoRatioMap.set(s.packetNumber,1),this.initialRTO;{const g=9*this.rtt/8*d;return this.rtoRatioMap.set(s.packetNumber,d+1),g>this.maxRTO?this.maxRTO:g}}updateRTT(s,d){const g=s.ackSendTs;this.rtt=this.rtt*(7/8)+(d-g-this.rtt)/8}ack(s){if(s.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(s):(this.batchAckPacketQueue.push(s),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(s.payload);;){const d=this.unorderedPacketQueue[0];if(!d){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(d.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(s.packetNumber<=this.lastOrderedPacketNumber){const d={ackSendTs:s.sendTs,maxAckPacketNumber:s.packetNumber,shift:0,type:K0.Ack,version:this.version};this.sendPacket(d)}else if(s.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[s.packetNumber-this.lastOrderedPacketNumber-2]=s;const d={ackSendTs:s.sendTs,maxAckPacketNumber:s.packetNumber,shift:0,type:K0.Ack,version:this.version};this.sendPacket(d)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const s={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:K0.Ack,version:this.version};this.sendPacket(s),this.batchAckPacketQueue=[]}sendPacket(s){s.type===K0.Default&&(s.sendTs=Math.round(performance.now()));const d=this.serialize(s);this.sendImpl(d)}clearRTO(s){for(let d=s.maxAckPacketNumber-s.shift;d<=s.maxAckPacketNumber;d++){const g=this.timeoutMap.get(d);g!==void 0&&window.clearTimeout(g),this.timeoutMap.delete(d),this.rtoRatioMap.delete(d)}}}class V4 extends rut{constructor(s,d){super(s,d,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),Qm(this,"_initMutex",void 0),Qm(this,"_reconnectInterrupter",void 0),Qm(this,"_url",void 0),Qm(this,"_transmitter",void 0),Qm(this,"_addresses",void 0),Qm(this,"_reliableTransmission",void 0),this._initMutex=new KS("datachannel");const{timeout:g,timeoutFactor:b}=d,$=Math.max(300,Math.floor(3*g/5)),Vt=Math.max(1.2,Math.floor(8*b)/10);gT.ONLINE&&(this._retryConfig.timeout=$,this._retryConfig.timeoutFactor=Vt),pS.on(jI.NETWORK_STATE_CHANGE,(zt,_e)=>{zt!==_e&&(this.resetReconnectCount("network state change: ".concat(_e," -> ").concat(zt)),zt===gT.ONLINE?(this._retryConfig.timeout=$,this._retryConfig.timeoutFactor=Vt):(this._retryConfig.timeout=g,this._retryConfig.timeoutFactor=b))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=d;const g=(b,$)=>{this._addresses=s,this.currentURLIndex=this._addresses.findIndex(zt=>zt.fingerprint||cE("FINGERPRINT"));const Vt=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(Vt).then(b).catch($),this.once(PS.CLOSED,()=>$(new EE(rE.WS_DISCONNECT))),this.once(PS.CONNECTED,()=>b())};return this._initMutex.lock().then(b=>new GE(($,Vt)=>{g($,Vt)}).then(()=>{b()}).catch(()=>{b()}))}sendMessage(s){let d=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new EE(rE.WS_ABORT,"datachannel is not ready");try{d||(s=JSON.stringify(s)),this._reliableTransmission.sendMessage(s)}catch(g){throw new EE(rE.WS_ERR,"send datachannel signal message error"+g.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(s){const d=JSON.stringify(s);return{compressed:d,compressedLength:d.length,origin:s}}sendMessageWithUint8Array(s){return{compressed:s,compressedLength:s.byteLength,origin:s}}createTransmitterConnection(s){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(s.ip,":").concat(s.port),new GE((d,g)=>{var b;const $=()=>{_l.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),d()},Vt=async _o=>{var ga;if((ga=this._closeEstablishingTransmitter)===null||ga===void 0||ga.call(this),_l.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(_o.code,", reason: ").concat(_o.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=_o.reason,this.state="reconnecting");const _a=VT(this,PS.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,_c=await this.reconnectWithAction(_a);if(this.state==="closed")return void _l.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!_c)return g(new EE(rE.WS_DISCONNECT,"datachannel reconnect failed: ".concat(_o.code))),void this.close(!0);d()}else g(new EE(rE.WS_DISCONNECT,"datachannel close: ".concat(_o.code))),this.close()},zt=_o=>{var ga;(ga=this._reliableTransmission)===null||ga===void 0||ga.onData(_o.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),_l.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(s)));const _e=(b=this._store)===null||b===void 0?void 0:b.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),_r=Date.now();kS(this,PS.TO_CONNECT_DATACHANNEL,s).then(_o=>{var ga,_a;if(!_o)throw new Error("transmissonInfo not exist yet");const{transmitter:_c,close:tE}=_o;this._transmitter=_c,(ga=this._store)===null||ga===void 0||ga.signalChannelOpen();const _p=Date.now()-_r;_l.debug("[choose dc] dc open cost ".concat(_p,"ms")),this._reliableTransmission=new iut(_f=>{var eE;this._transmitter&&this._transmitter.readyState==="open"&&((eE=this._transmitter)===null||eE===void 0||eE.send(_f))},_f=>{typeof _f=="string"&&this.emit(PS.ON_MESSAGE,_f)}),this._closeEstablishingTransmitter=()=>{var _f;(_f=this._reliableTransmission)===null||_f===void 0||_f.close(),this._reliableTransmission=void 0,tE()},$&&$(),_c.onclose=Vt,_c.onmessage=zt,(_a=this._store)===null||_a===void 0||_a.recordJoinChannelService({endTs:Date.now(),status:"success"},_e),this._joinChannelServiceRecordIndex=_e}).catch(_o=>{var ga;if((ga=this._store)===null||ga===void 0||ga.recordJoinChannelService({endTs:Date.now(),status:_o instanceof EE&&_o.code===rE.WS_ABORT?"aborted":"error",errors:[_o]},_e),this.state!=="closed"){if(_o instanceof EE&&_o.code===rE.WS_ERR){const _a=new EE(rE.WS_ERR,"init datachannel failed! Error: ".concat(_o.toString()));return _l.error("[".concat(this._name,"]").concat(_a)),void g(_a)}Vt&&Vt(_o)}else g(new EE(rE.WS_DISCONNECT,"datachannel is closed: ".concat(_o.toString())))})})}async reconnectWithAction(s){let d=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||pS.networkState!==gT.OFFLINE||(this._onlineReconnectListener=pS.onlineWaiter&&pS.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let g=!0;if(this._reconnectInterrupter=()=>{g=!1},d){const zt=CD(this._reconnectCount,this._retryConfig);_l.debug("[".concat(this._name,"] wait ").concat(zt,"ms to reconnect datachannel, mode: ").concat(s)),await GE.race([WS(zt),this._onlineReconnectListener||new GE(()=>{})])}if(this.state==="closed"||!g)return!1;this._reconnectCount+=1;const b=async(zt,_e)=>{this.emit(PS.RECONNECT_CREATE_CONNECTION,_e),await this.createTransmitterConnection(zt)};try{if(s==="retry"){const zt=this._addresses[this.currentURLIndex];this.emit(PS.RECONNECT_WAITTING_FINISH,s),await b(zt,s)}else if(s==="tryNext"){this.currentURLIndex+=1;for(let _e=this.currentURLIndex;_e<this._addresses.length;_e++){if(this._addresses[_e].fingerprint||cE("FINGERPRINT")){this.currentURLIndex=_e;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return _l.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);_l.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const zt=this._addresses[this.currentURLIndex];this.emit(PS.RECONNECT_WAITTING_FINISH,s),await b(zt,s)}else s==="recover"&&(_l.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(PS.RECONNECT_WAITTING_FINISH,s),this.emit(PS.FAILBACK));return!0}catch(zt){var $,Vt;return _l.error("[".concat(this._name,"] reconnect failed"),zt.toString()),zt!=null&&($=zt.data)!==null&&$!==void 0&&$.desc&&Array.isArray(zt.data.desc)&&zt.data.desc.length&&KE(Vt=zt.data.desc).call(Vt,"dynamic key expired")?(this.emit(PS.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(s,d)}}}class LR extends nS{get connectionState(){return this._connectionState}set connectionState(s){s!==this._connectionState&&(this._connectionState=s,s===v_.CONNECTED?this.emit(XE.WS_CONNECTED):s===v_.RECONNECTING?this.emit(XE.WS_RECONNECTING,this._websocketReconnectReason):s===v_.CLOSED&&this.emit(XE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(s,d){super(),Qm(this,"_disconnectedReason",void 0),Qm(this,"_websocketReconnectReason",void 0),Qm(this,"_connectionState",v_.CLOSED),Qm(this,"reconnectToken",void 0),Qm(this,"websocket",void 0),Qm(this,"openConnectionTime",void 0),Qm(this,"clientId",void 0),Qm(this,"lastMsgTime",Date.now()),Qm(this,"uploadCache",[]),Qm(this,"uploadCacheInterval",void 0),Qm(this,"rttRolling",new IV(5)),Qm(this,"pingpongTimer",void 0),Qm(this,"inflateDataTimer",void 0),Qm(this,"pingpongTimeoutCount",0),Qm(this,"joinResponse",void 0),Qm(this,"multiIpOption",void 0),Qm(this,"initError",void 0),Qm(this,"spec",void 0),Qm(this,"store",void 0),Qm(this,"onWebsocketMessage",g=>{if(g instanceof ArrayBuffer)return void this.emit(XE.ON_BINARY_DATA,g);const b=JSON.parse(g);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(b,"_id")){const $="res-@".concat(b._id);this.emit($,b._result,b._message)}else if(Object.prototype.hasOwnProperty.call(b,"_type")&&(this.emit(b._type,b._message),b._type===d_.ON_NOTIFICATION&&this.handleNotification(b._message),b._type===d_.ON_USER_BANNED))switch(b._message.error_code){case 14:this.close(y_.UID_BANNED);break;case 15:this.close(y_.IP_BANNED);break;case 16:this.close(y_.CHANNEL_BANNED)}}),this.clientId=s.clientId,this.spec=s,this.store=d,this.websocket=new V4("gateway-".concat(this.clientId),this.spec.retryConfig,!0,d),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===v_.CONNECTED&&this.reconnect("retry",oI.OFFLINE)})}async request(s,d,g,b){const $=z_(6,""),Vt={_id:$,_type:s,_message:d},zt=this.websocket.connectionID,_e=()=>new GE((tE,_p)=>{if(this.connectionState===v_.CONNECTED)return tE();const _f=()=>{this.off(XE.WS_CLOSED,eE),tE()},eE=()=>{this.off(XE.WS_CONNECTED,_f),_p(new EE(rE.WS_ABORT))};this.once(XE.WS_CONNECTED,_f),this.once(XE.WS_CLOSED,eE),s!==n_.PUBLISH&&s!==n_.SUBSCRIBE&&s!==n_.UNSUBSCRIBE&&s!==n_.UNPUBLISH&&s!==n_.CONTROL&&s!==n_.RESTART_ICE||this.once(XE.DISCONNECT_P2P,()=>{_p(new EE(rE.DISCONNECT_P2P))}),s!==n_.PUBLISH&&s!==n_.RESTART_ICE||this.once(XE.ABORT_P2P_EXECUTION,()=>{_p(new EE(rE.DISCONNECT_P2P))})});if(this.connectionState!==v_.CONNECTING&&this.connectionState!==v_.RECONNECTING||s===n_.JOIN||s===n_.REJOIN||await _e(),s===n_.LEAVE&&(this.websocket.unbindDcCloseEventListener(),b=!0),this.websocket.sendMessage(Vt,!0,!1),b)return;const _r=new GE((tE,_p)=>{let _f=!1;const eE=(fE,mE)=>{_f=!0,tE({isSuccess:fE==="success",message:mE||{}}),this.off(XE.WS_CLOSED,iE),this.off(XE.WS_RECONNECTING,iE),this.emit(XE.REQUEST_SUCCESS,s,d)};this.once("res-@".concat($),eE);const iE=()=>{_p(new EE(rE.WS_ABORT,"type: ".concat(s))),this.off(XE.WS_CLOSED,iE),this.off(XE.WS_RECONNECTING,iE),this.off("res-@".concat($),eE)};this.once(XE.WS_CLOSED,iE),this.once(XE.WS_RECONNECTING,iE),WS(cE("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==zt||_f||(_l.warning("dc request timeout, type: ".concat(s)),this.emit(XE.REQUEST_TIMEOUT,s,d))})});let _o=null;try{_o=await _r}catch(tE){if(this.connectionState===v_.CLOSED||s===n_.LEAVE)throw new EE(rE.WS_ABORT);return!this.spec.forceWaitGatewayResponse||g?tE.throw():s===n_.JOIN||s===n_.REJOIN?null:(await _e(),await this.request(s,d))}if(_o.isSuccess)return _o.message;const ga=Number(_o.message.error_code||_o.message.code),_a=HI(ga),_c=new EE(rE.UNEXPECTED_RESPONSE,"".concat(_a.desc,": ").concat(_o.message.error_str),{code:ga,data:_o.message});return _a.action==="success"?_o.message:(_l.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(s,", error_code: ").concat(ga,", message: ").concat(_a.desc,", action: ").concat(_a.action)),ga===r_.ERR_TOO_MANY_BROADCASTERS?((s===n_.JOIN||s===n_.REJOIN)&&(this.initError=_c,this.close()),_c.throw()):_a.action==="failed"?_c.throw():_a.action==="quit"?(this.initError=_c,this.close(),_c.throw()):(ga===r_.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_o.message.option,_l.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",oI.MULTI_IP)):this.reconnect(_a.action,oI.SERVER_ERROR),s===n_.JOIN||s===n_.REJOIN?null:await this.request(s,d)))}waitMessage(s,d){return new GE(g=>{const b=$=>{(!d||d($))&&(this.off(s,b),g($))};this.on(s,b)})}uploadWRTCStats(s){if(!this.store.sessionId)return void _l.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const d={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:s};this.upload(qI.WRTC_STATS,d)}upload(s,d){const g={_type:s,_message:d};try{this.websocket.sendMessage(g)}catch{const $=cE("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(g),this.uploadCache.length>$&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==v_.CONNECTED)return;const Vt=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(Vt._type,Vt._message)},cE("UPLOAD_CACHE_INTERVAL")||2e3))}}send(s,d){const g={_type:s,_message:d};this.websocket.sendMessage(g)}init(s,d){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new GE((g,b)=>{this.once(XE.WS_CONNECTED,()=>g(this.joinResponse)),this.once(XE.WS_CLOSED,()=>b(this.initError||new EE(rE.WS_ABORT))),this.connectionState=v_.CONNECTING,this.websocket.init(s).catch(b),this.websocket.once(PS.FAILBACK,()=>{this.openConnectionTime===void 0&&b(new EE(rE.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{d&&this.openConnectionTime===void 0&&(_l.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),b(new EE(rE.INIT_DATACHANNEL_TIMEOUT)))},cE("DC_JOIN_WITH_FAILBACK"))})}close(s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=s||y_.LEAVE,this.connectionState=v_.CLOSED,_l.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),s===y_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new V4("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(XE.ABORT_P2P_EXECUTION);const s=await kS(this,XE.DATACHANNEL_CONNECTING),d=await this.request(n_.JOIN,s);if(!d)return this.emit(XE.REPORT_JOIN_GATEWAY,rE.TIMEOUT,this.url||""),!1;this.joinResponse=d,this.emit(XE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=v_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new EE(rE.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const s=VI(this,XE.REQUEST_REJOIN_INFO);s.token=this.reconnectToken;const d=await this.request(n_.REJOIN,s);return!!d&&(this.connectionState=v_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),d.peers&&d.peers.forEach(g=>{this.emit(d_.ON_USER_ONLINE,{uid:g.uid}),g.audio&&this.emit(d_.ON_ADD_AUDIO_STREAM,{uid:g.uid,uint_id:g.uint_id,audio:!0,ssrcId:g.audio_ssrc}),g.video&&this.emit(d_.ON_ADD_VIDEO_STREAM,{uid:g.uid,uint_id:g.uint_id,video:!0,ssrcId:g.video_ssrc}),g.audio_mute?this.emit(d_.MUTE_AUDIO,{uid:g.uid}):this.emit(d_.UNMUTE_AUDIO,{uid:g.uid}),g.video_mute?this.emit(d_.MUTE_VIDEO,{uid:g.uid}):this.emit(d_.UNMUTE_VIDEO,{uid:g.uid}),g.audio_enable_local?this.emit(d_.ENABLE_LOCAL_AUDIO,{uid:g.uid}):this.emit(d_.DISABLE_LOCAL_AUDIO,{uid:g.uid}),g.video_enable_local?this.emit(d_.ENABLE_LOCAL_VIDEO,{uid:g.uid}):this.emit(d_.DISABLE_LOCAL_VIDEO,{uid:g.uid}),g.audio||g.video||this.emit(d_.ON_REMOVE_STREAM,{uid:g.uid,uint_id:g.uint_id})}),!0)}reconnect(s,d){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(s,d)}handleNotification(s){_l.debug("[".concat(this.clientId,"] receive notification: "),s);const d=HI(s.code);if(d.action!=="success"){if(d.action!=="failed")return d.action==="quit"?(d.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(y_.UID_BANNED),void this.close()):void this.reconnect(d.action,oI.SERVER_ERROR);_l.error("[".concat(this.clientId,"] ignore error: "),d.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const s=cE("PING_PONG_TIME_OUT"),d=Date.now();this.pingpongTimeoutCount>=s&&(_l.warning("PINGPONG Timeout. Last Socket Message: ".concat(d-this.lastMsgTime,"ms")),d-this.lastMsgTime>cE("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",oI.TIMEOUT):this.request(n_.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const g=Date.now()-d;this.rttRolling.add(g),cE("REPORT_STATS")&&this.send(n_.PING_BACK,{pingpongElapse:g})}).catch(g=>{})}handleInflateData(){const{inflateLength:s,deflateLength:d}=this.websocket.getInflateData();s!==0&&d!==0&&this.upload(qI.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:d,ws_inflate_length:s})}handleWebsocketEvents(){this.websocket.on(PS.RECONNECT_WAITTING_FINISH,s=>{this.emit(XE.WS_RECONNECT_WAITTING_FINISH,s)}),this.websocket.on(PS.RECONNECT_CREATE_CONNECTION,s=>{this.emit(XE.WS_RECONNECT_CREATE_CONNECTION,s)}),this.websocket.on(PS.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(PS.CLOSED,()=>{this.connectionState=v_.CLOSED}),this.websocket.on(PS.FAILED,()=>{this._disconnectedReason=y_.NETWORK_ERROR,this.connectionState=v_.CLOSED}),this.websocket.on(PS.RECONNECTING,s=>{this._websocketReconnectReason=s,this.joinResponse=void 0,this.connectionState===v_.CONNECTED?this.connectionState=v_.RECONNECTING:this.connectionState=v_.CONNECTING}),this.websocket.on(PS.WILL_RECONNECT,(s,d)=>{if(VI(this,XE.IS_P2P_DISCONNECTED)&&s==="retry")return _l.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(XE.NEED_RENEW_SESSION),this.emit(XE.DISCONNECT_P2P),d("tryNext");s!=="retry"&&(_l.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(s)),this.reconnectToken=void 0,this.emit(XE.NEED_RENEW_SESSION),this.emit(XE.DISCONNECT_P2P)),d(s)}),this.websocket.on(PS.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(s=>{_l.warning("[".concat(this.clientId,"] rejoin failed ").concat(s)),this.reconnect("tryNext",oI.SERVER_ERROR)}):this.join().catch(s=>{if(this.emit(XE.REPORT_JOIN_GATEWAY,s.message||s.code,this.url||""),s instanceof EE&&s.code===rE.UNEXPECTED_RESPONSE&&s.data.code===r_.ERR_NO_AUTHORIZED)return _l.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",oI.SERVER_ERROR);_l.error("[".concat(this.clientId,"] join gateway request failed"),s.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",oI.SERVER_ERROR):(this.initError=s,this.close())})}),this.websocket.on(PS.REQUEST_NEW_URLS,(s,d)=>{kS(this,XE.REQUEST_RECOVER,this.multiIpOption).then(s).catch(d)}),this.websocket.on(PS.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(d_.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(PS.TO_CONNECT_DATACHANNEL,async(s,d,g)=>kS(this,XE.DATACHANNEL_PRECONNECT,s).then(d).catch(g)),this.websocket.on(PS.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(XE.DATACHANNEL_FAILBACK)})}}class KI extends nS{constructor(s,d){super(),Qm(this,"signal",void 0),Qm(this,"token",void 0),Qm(this,"tokenTimeout",void 0),Qm(this,"tokenInterval",void 0),Qm(this,"_sequence",0),Qm(this,"userMap",new Map),Qm(this,"encoder",new TextEncoder),this.signal=s,this.token=d;const g=()=>{this.signal.connectionState===v_.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(g,1e3):this.tokenInterval=window.setTimeout(g,3*cE("P2P_TOKEN_INTERVAL"))};g()}async send(s,d,g,b,$){var Vt,zt,_e;if(this.userMap.size===0)return;const _r=Array.from(q0(Vt=this.userMap).call(Vt))[0].token;typeof d!="string"&&(d=JSON.stringify(d)),b=(zt=b)!==null&&zt!==void 0?zt:z_(6,""),$=(_e=$)!==null&&_e!==void 0?_e:this._sequence++;const _o={_id:b,_type:s,_seq:$,_message:d,token:"".concat(this.token,"_").concat(_r)};cE("SHOW_P2P_LOG")&&_l.debug("send message",_o,"noNeedResponse : ".concat(g)),this.splitMessage(JSON.stringify(_o)).forEach(_a=>{this.signal.request(n_.DATA_STREAM,{payload:nI(this.encoder.encode(_a))})});const ga=new GE((_a,_c)=>{const tE=window.setTimeout(()=>{this.off("res-@".concat(b,"_ack"),_p),this.off("res-@".concat(b),eE),this.off(KO.ABORT,_f),_l.debug("[external-signal] request timeout, type: ".concat(s,", requestId: ").concat(b)),this.userMap.size===0?_c(new TE(rE.INVALID_REMOTE_USER)):_c(new TE(rE.TIMEOUT))},cE("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),_p=()=>{tE&&window.clearTimeout(tE),this.off(KO.ABORT,_f),g&&_a()},_f=()=>{tE&&window.clearTimeout(tE),this.off("res-@".concat(b,"_ack"),_p),this.off("res-@".concat(b),eE),_c(new TE(rE.EXTERNAL_SIGNAL_ABORT,"type: ".concat(s,", requestId: ").concat(b)))};this.once(KO.ABORT,_f),this.once("res-@".concat(b,"_ack"),_p);const eE=(fE,mE)=>{iE=!0,tE&&window.clearTimeout(tE),this.off("res-@".concat(b,"_ack"),_p),this.off(KO.ABORT,_f),fE==="success"?_a(mE):_c(new TE(rE.P2P_MESSAGE_FAILED,"request ".concat(s," failed, requestId: ").concat(b)))};let iE=!1;g||(this.once("res-@".concat(b),eE),WS(cE("SIGNAL_REQUEST_TIMEOUT")).then(()=>{iE||_l.warning("external_signal request timeout, type: ".concat(s,", requestId: ").concat(b,", ").concat(_o))}))});try{return await ga}catch(_a){if(_a.code===rE.TIMEOUT)return await this.send(s,d,g,b,$);throw _a}}onMessage(s){var d;const{_uid:g}=s;let b,$=this.userMap.get(g);if($)b=$.splitMessageMap;else{if(this.userMap.size>0||!("_type"in s)||s._type!==vS.CHECK)return;const{token:_r}=s;b=new Map,$={uid:g,isStart:!0,token:_r,splitMessageMap:b,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(g,$),this.signal.emit(d_.ON_USER_ONLINE,{uid:g}),this.handleUserOnline()}if("id"in s&&"total"in s){var Vt;const{id:_r,total:_o}=s,ga=(Vt=b.get(_r))!==null&&Vt!==void 0?Vt:[];if(ga.push(s),b.has(_r)||b.set(_r,ga),ga.length!==_o)return;{const _a=GN(ga).call(ga,(_c,tE)=>_c.index-tE.index).map(_c=>_c.payload).join("");b.delete(_r),(s=JSON.parse(_a))._uid=g}}const{_type:zt,token:_e}=s;if(KE(d=[vS.ACK,vS.CHECK]).call(d,zt))return zt===vS.CHECK&&this.handleCheckToken($,_e),void this.receiveMessage(s);_e==="".concat($.token,"_").concat(this.token)?this.handleReceivedMessage(s):_l.debug('Receive unexpected message", '.concat(_e,", cur_token: ").concat($.token,"_").concat(this.token),s)}check(){const s={_id:z_(6,""),token:this.token,_type:vS.CHECK};cE("SHOW_P2P_LOG")&&_l.debug("send message",s),this.signal.request(n_.DATA_STREAM,{payload:nI(this.encoder.encode(JSON.stringify(s)))})}ack(s){const d={_id:s,_type:vS.ACK,token:this.token};cE("SHOW_P2P_LOG")&&_l.debug("send message",d),this.signal.request(n_.DATA_STREAM,{payload:nI(this.encoder.encode(JSON.stringify(d)))})}response(s,d,g){this.send(vS.RESPONSE,JSON.stringify({success:!g,message:d}),!0,s)}handleReceivedMessage(s){const d=()=>{this.userMap.forEach(_r=>{const{receivedMessagesMap:_o,nextExpectedSequenceNumber:ga}=_r;for(;_o.has(ga);){const _a=_o.get(ga);_o.delete(ga),this.receiveMessage(_a),_r.nextExpectedSequenceNumber++}})};if(!s)return void d();const{_uid:g,_seq:b}=s,$=this.userMap.get(g),{receivedMessagesMap:Vt,isStart:zt,nextExpectedSequenceNumber:_e}=$;if(b<_e)return this.ack(s._id),void _l.debug("[external-signal] receive old message, seq: ".concat(b,", ").concat(s._message));Vt.set(b,s),zt&&b===_e&&(this.receiveMessage(s),Vt.delete(_e),$.nextExpectedSequenceNumber++,d())}receiveMessage(s){const{_id:d,_type:g,_message:b,_uid:$}=s;if(cE("SHOW_P2P_LOG")&&_l.debug("receive message",s),d){let Vt;switch(s._type!==vS.ACK&&(b&&(Vt=JSON.parse(b)),this.ack(s._id)),s._type){case vS.CANDIDATE:case vS.CONTROL:this.signal.emit(g,Vt,$);break;case vS.PUBLISH:case vS.UNPUBLISH:case vS.RESTART_ICE:case vS.CALL:Vt.uid=$,kS(this.signal,g,Vt).then(zt=>{this.response(s._id,zt)}).catch(()=>{this.response(s._id,void 0,!0)});break;case vS.ACK:this.getListeners("res-@".concat(d,"_ack")).length>0&&this.emit("res-@".concat(d,"_ack"));break;case vS.RESPONSE:{const{success:zt,message:_e}=Vt;this.emit("res-@".concat(d),zt?"success":"failed",_e);break}}}}splitMessage(s){if(s.length<KI.MAX_MESSAGE_SIZE)return[s];const d=[],{remoteToken:g}=JSON.parse(s),b=z_(6,"");let $=0,Vt=800;const zt=Math.ceil(s.length/Vt);for(;s.length>0;){$++;const _e={id:b,index:$,total:zt,payload:s.slice(0,Vt),token:"".concat(this.token,"_").concat(g)};JSON.stringify(_e).length>KI.MAX_MESSAGE_SIZE?Vt-=50:(d.push(_e),s=s.slice(Vt))}return d.map(_e=>JSON.stringify(_e))}handleCheckToken(s,d){return s.token!==d?(_l.debug("token changed, from ".concat(s.token," to ").concat(d)),this.reset(s.uid,d),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{_l.debug("token timeout, ".concat(d)),this.reset(s.uid)},cE("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const s=await kS(this.signal,vS.CALL,void 0),d=await this.send(vS.CALL,s);this.signal.emit(XE.P2P_CONNECTION,d,!0)}async reset(s,d){const g=this.userMap.get(s);g&&(this.emit(KO.ABORT),this.signal.emit(d_.ON_USER_OFFLINE,{uid:g.uid,reason:Yct.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),d||(_l.debug("change local token from ".concat(d," to ").concat(d)),this.token=z_(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(KO.ABORT)}}Qm(KI,"MAX_SIZE",1),Qm(KI,"MAX_MESSAGE_SIZE",1024);class F4 extends nS{get connectionState(){return this._connectionState}set connectionState(s){s!==this._connectionState&&(this._connectionState=s,s===v_.CONNECTED?this.emit(XE.WS_CONNECTED):s===v_.RECONNECTING?this.emit(XE.WS_RECONNECTING,this._websocketReconnectReason):s===v_.CLOSED&&this.emit(XE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(s,d){super(),Qm(this,"_disconnectedReason",void 0),Qm(this,"_websocketReconnectReason",void 0),Qm(this,"_connectionState",v_.CLOSED),Qm(this,"reconnectToken",void 0),Qm(this,"p2pToken",void 0),Qm(this,"websocket",void 0),Qm(this,"openConnectionTime",void 0),Qm(this,"clientId",void 0),Qm(this,"lastMsgTime",Date.now()),Qm(this,"uploadCache",[]),Qm(this,"uploadCacheInterval",void 0),Qm(this,"rttRolling",new IV(5)),Qm(this,"pingpongTimer",void 0),Qm(this,"pingpongTimeoutCount",0),Qm(this,"joinResponse",void 0),Qm(this,"multiIpOption",void 0),Qm(this,"initError",void 0),Qm(this,"spec",void 0),Qm(this,"store",void 0),Qm(this,"_external_signal",void 0),Qm(this,"onWebsocketMessage",g=>{if(g.data instanceof ArrayBuffer)return void this.emit(XE.ON_BINARY_DATA,g.data);const b=JSON.parse(g.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(b,"_id")){const $="res-@".concat(b._id);this.emit($,b._result,b._message)}else if(Object.prototype.hasOwnProperty.call(b,"_type")){switch(b._type){case d_.ON_DATA_STREAM:return void this.handleDataStream(b._message);case d_.MUTE_AUDIO:case d_.MUTE_VIDEO:case d_.ON_P2P_LOST:case d_.ON_USER_ONLINE:return;case d_.ON_USER_OFFLINE:const{uid:$}=b._message;return _l.debug("[".concat(this.clientId,"] user-offline uid: ").concat($)),void this._external_signal.reset($)}if(this.emit(b._type,b._message),b._type===d_.ON_NOTIFICATION&&this.handleNotification(b._message),b._type===d_.ON_USER_BANNED)switch(b._message.error_code){case 14:this.close(y_.UID_BANNED);break;case 15:this.close(y_.IP_BANNED);break;case 16:this.close(y_.CHANNEL_BANNED)}if(b._type===d_.ON_USER_LICENSE_BANNED)switch(b._message.error_code){case r_.ERR_LICENSE_MISSING:this.close(y_.LICENSE_MISSING);break;case r_.ERR_LICENSE_EXPIRED:this.close(y_.LICENSE_EXPIRED);break;case r_.ERR_LICENSE_MINUTES_EXCEEDED:this.close(y_.LICENSE_MINUTES_EXCEEDED);break;case r_.ERR_LICENSE_PERIOD_INVALID:this.close(y_.LICENSE_PERIOD_INVALID);break;case r_.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(y_.LICENSE_MULTIPLE_SDK_SERVICE);break;case r_.ERR_LICENSE_ILLEGAL:this.close(y_.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=s.clientId,this.spec=s,this.store=d,this.websocket=new uP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,cE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),cE("JOIN_GATEWAY_USE_443PORT_ONLY"),d),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===v_.CONNECTED&&this.reconnect("retry",tT.OFFLINE)}),this.p2pToken=z_(6,""),this._external_signal=new KI(this,this.p2pToken)}async request(s,d,g,b){const $=z_(6,""),Vt={_id:$,_type:s,_message:d},zt=this.websocket.connectionID,_e=()=>new GE((tE,_p)=>{if(this.connectionState===v_.CONNECTED)return tE();const _f=()=>{this.off(XE.WS_CLOSED,eE),tE()},eE=()=>{this.off(XE.WS_CONNECTED,_f),_p(new TE(rE.WS_ABORT))};this.once(XE.WS_CONNECTED,_f),this.once(XE.WS_CLOSED,eE)});if(this.connectionState!==v_.CONNECTING&&this.connectionState!==v_.RECONNECTING||s===n_.JOIN||s===n_.REJOIN||await _e(),this.websocket.sendMessage(Vt,!0),b)return;const _r=new GE((tE,_p)=>{let _f=!1;const eE=(fE,mE)=>{_f=!0,tE({isSuccess:fE==="success",message:mE||{}}),this.off(XE.WS_CLOSED,iE),this.off(XE.WS_RECONNECTING,iE),this.emit(XE.REQUEST_SUCCESS,s,d)};this.once("res-@".concat($),eE);const iE=()=>{_p(new TE(rE.WS_ABORT,"type: ".concat(s))),this.off(XE.WS_CLOSED,iE),this.off(XE.WS_RECONNECTING,iE),this.off("res-@".concat($),eE)};this.once(XE.WS_CLOSED,iE),this.once(XE.WS_RECONNECTING,iE),WS(cE("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==zt||_f||(_l.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(s)),this.emit(XE.REQUEST_TIMEOUT,s,d))})});let _o=null;try{_o=await _r}catch(tE){if(this.connectionState===v_.CLOSED||s===n_.LEAVE)throw new TE(rE.WS_ABORT);return!this.spec.forceWaitGatewayResponse||g?tE.throw():s===n_.JOIN||s===n_.REJOIN?null:(await _e(),await this.request(s,d))}if(_o.isSuccess)return _o.message;const ga=Number(_o.message.error_code||_o.message.code),_a=HI(ga),_c=new TE(rE.UNEXPECTED_RESPONSE,"".concat(_a.desc,": ").concat(_o.message.error_str),{code:ga,data:_o.message});return _a.action==="success"?_o.message:(_l.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(s,", error_code: ").concat(ga,", message: ").concat(_a.desc,", action: ").concat(_a.action)),ga===r_.ERR_TOO_MANY_BROADCASTERS?((s===n_.JOIN||s===n_.REJOIN)&&(this.initError=_c,this.close()),_c.throw()):_a.action==="failed"?_c.throw():_a.action==="quit"?(this.initError=_c,this.close(),_c.throw()):(ga===r_.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_o.message.option,_l.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",tT.MULTI_IP)):this.reconnect(_a.action,tT.SERVER_ERROR),s===n_.JOIN||s===n_.REJOIN?null:await this.request(s,d)))}waitMessage(s,d){return new GE(g=>{const b=$=>{(!d||d($))&&(this.off(s,b),g($))};this.on(s,b)})}uploadWRTCStats(s){if(!this.store.sessionId)return void _l.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const d={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:s};this.upload(qI.WRTC_STATS,d)}upload(s,d){const g={_type:s,_message:d};try{this.websocket.sendMessage(g)}catch{const $=cE("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(g),this.uploadCache.length>$&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==v_.CONNECTED)return;const Vt=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(Vt._type,Vt._message)},cE("UPLOAD_CACHE_INTERVAL")||2e3))}}send(s,d){const g={_type:s,_message:d};this.websocket.sendMessage(g)}async sendExtensionMessage(s,d,g){return await this._external_signal.send(s,d,g)}init(s){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new GE((d,g)=>{this.once(XE.WS_CONNECTED,()=>d(this.joinResponse)),this.once(XE.WS_CLOSED,()=>g(this.initError||new TE(rE.WS_ABORT))),this.connectionState=v_.CONNECTING,this.websocket.init(s).catch(g)})}close(s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=s||y_.LEAVE,this.connectionState=v_.CLOSED,_l.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),s===y_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new uP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,cE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),cE("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents()),this.p2pToken=z_(6,""),this._external_signal.clear(),this._external_signal=new KI(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(XE.ABORT_P2P_EXECUTION);const s=await kS(this,XE.REQUEST_JOIN_INFO),d=await this.request(n_.JOIN,s);if(!d)return this.emit(XE.REPORT_JOIN_GATEWAY,rE.TIMEOUT,this.url||""),!1;this.joinResponse=d,this.emit(XE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=v_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(s,d){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(s,d)}handleDataStream(s){try{var d;const g=BI(s.payload),b=new TextDecoder().decode(g),$=JSON.parse(b);"total"in $&&"id"in $||KE(d=Object.values(vS)).call(d,$._type)?($._uid=s.uid,this._external_signal.onMessage($)):this.emit(d_.ON_DATA_STREAM,s)}catch{this.emit(d_.ON_DATA_STREAM,s)}}handleNotification(s){_l.debug("[".concat(this.clientId,"] receive notification: "),s);const d=HI(s.code);if(d.action!=="success"){if(d.action!=="failed")return d.action==="quit"?(d.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(y_.UID_BANNED),void this.close()):void this.reconnect(d.action,tT.SERVER_ERROR);_l.error("[".concat(this.clientId,"] ignore error: "),d.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const s=cE("PING_PONG_TIME_OUT"),d=Date.now();this.pingpongTimeoutCount>=s&&(_l.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(d-this.lastMsgTime,"ms")),d-this.lastMsgTime>cE("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",tT.TIMEOUT):this.request(n_.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const g=Date.now()-d;this.rttRolling.add(g),cE("REPORT_STATS")&&this.send(n_.PING_BACK,{pingpongElapse:g})}).catch(g=>{})}handleWebsocketEvents(){this.websocket.on(c_.RECONNECT_WAITTING_FINISH,s=>{this.emit(XE.WS_RECONNECT_WAITTING_FINISH,s)}),this.websocket.on(c_.RECONNECT_CREATE_CONNECTION,s=>{this.emit(XE.WS_RECONNECT_CREATE_CONNECTION,s)}),this.websocket.on(c_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(c_.CLOSED,()=>{this.connectionState=v_.CLOSED}),this.websocket.on(c_.FAILED,()=>{this._disconnectedReason=y_.NETWORK_ERROR,this.connectionState=v_.CLOSED}),this.websocket.on(c_.RECONNECTING,s=>{this._websocketReconnectReason=s,this.joinResponse=void 0,this.connectionState===v_.CONNECTED?this.connectionState=v_.RECONNECTING:this.connectionState=v_.CONNECTING}),this.websocket.on(c_.WILL_RECONNECT,(s,d,g)=>{s!=="retry"?(_l.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(s)),this.reconnectToken=void 0,this.emit(XE.NEED_RENEW_SESSION)):_l.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),g(s)}),this.websocket.on(c_.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(s=>{if(this.emit(XE.REPORT_JOIN_GATEWAY,s.message||s.code,this.url||""),s instanceof TE&&s.code===rE.UNEXPECTED_RESPONSE&&s.data.code===r_.ERR_NO_AUTHORIZED)return _l.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",tT.SERVER_ERROR);_l.error("[".concat(this.clientId,"] join gateway request failed"),s.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",tT.SERVER_ERROR):(this.initError=s,this.close())})}),this.websocket.on(c_.REQUEST_NEW_URLS,(s,d)=>{kS(this,XE.REQUEST_RECOVER,this.multiIpOption).then(s).catch(d)}),this.websocket.on(c_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(d_.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function B4(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function b0(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?B4(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):B4(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}const KV=new Map;class out extends nS{get state(){return this._state}set state(s){if(s===this._state)return;const d=this._state;this._state=s,s==="DISCONNECTED"&&this._disconnectedReason?this.emit(_S.CONNECTION_STATE_CHANGE,s,d,this._disconnectedReason):this.emit(_S.CONNECTION_STATE_CHANGE,s,d)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(s){_l.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(s)),this._joinGatewayStartTime=s}constructor(s,d){super(),Qm(this,"store",void 0),Qm(this,"joinInfo",void 0),Qm(this,"key",void 0),Qm(this,"ntpOffset",0),Qm(this,"signal",void 0),Qm(this,"role",void 0),Qm(this,"inChannelInfo",{joinAt:null,duration:0}),Qm(this,"spec",void 0),Qm(this,"_state","DISCONNECTED"),Qm(this,"_statsCollector",void 0),Qm(this,"_disconnectedReason",void 0),Qm(this,"isSignalRecover",!1),Qm(this,"hasChangeBGPAddress",!1),Qm(this,"trafficStatsInterval",void 0),Qm(this,"networkQualityInterval",void 0),Qm(this,"_joinGatewayStartTime",0),Qm(this,"_signalTimeout",!1),Qm(this,"_clientRoleOptions",void 0),Qm(this,"_isProactiveJoin",!1),this.store=s,this.spec=d,this.signal=this.store.useP2P?new F4(b0(b0({},d),{},{retryConfig:d.websocketRetryConfig}),s):this.store.useDataChannel?new LR(b0(b0({},d),{},{retryConfig:d.websocketRetryConfig}),s):new D4(b0(b0({},d),{},{retryConfig:d.websocketRetryConfig}),s),this._statsCollector=d.statsCollector,this.role=d.role||"audience",this._clientRoleOptions=d.clientRoleOptions,this.handleSignalEvents()}async join(s,d,g){if(this.signal instanceof LR){let _e=!1;s.cloudProxyServer!=="disabled"?(_l.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(s.cloudProxyServer,")")),_e=!0):"".concat(s.apResponse.cid,"_").concat(s.apResponse.cert).length>255||"".concat(s.apResponse.cid,"_").concat(s.apResponse.cert).length<22?(_l.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),_e=!0):s.apResponse.addresses.some(_r=>_r.fingerprint)||cE("FINGERPRINT")||(_l.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),_e=!0),_e&&this.resetSignal()}this.store.joinGatewayStart(),s.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const b=Date.now();let $=KV.get(s.cname);if($||($=new Map,KV.set(s.cname,$)),this._isProactiveJoin=!0,$.has(s.uid)){const _e=new EE(rE.UID_CONFLICT);throw t_.joinGateway(s.sid,{lts:b,succ:!1,ec:_e.message,addr:null,uid:s.uid,cid:s.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!s.proxyServer,signalChannel:this.signal instanceof LR?"1":"0"}),this._isProactiveJoin=!1,_e}$.set(s.uid,!0),this.joinInfo=s,this.key=d;let Vt=0;this.joinGatewayStartTime=b;const zt=s.proxyServer;try{let _e;if(_l.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof LR?"datachannel":"websocket"," join uid ").concat(Vt)),this.signal instanceof LR)_e=await this.signal.init(s.apResponse.addresses,g);else{const _r=s.gatewayAddrs.map(_o=>{let{address:ga}=_o;const[_a,_c]=ga.split(":"),tE={host:_a,port:_c};return s.proxyServer&&(tE.proxy=s.proxyServer),tE});_e=await this.signal.init(_r,g)}Vt=_e.uid,_l.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof LR?"datachannel":"websocket"," join uid ").concat(Vt," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(_e){throw _e&&_e.code===rE.INIT_WEBSOCKET_TIMEOUT?(_l.warning("[".concat(this.store.clientId,"] User join failed"),_e.toString()),_e):_e&&_e.code===rE.INIT_DATACHANNEL_TIMEOUT?(_l.warning("[".concat(this.store.clientId,"] User join datachannel failed"),_e.toString()),this.resetSignal(),_e):(_l.error("[".concat(this.store.clientId,"] User join failed"),_e.toString()),t_.joinGateway(s.sid,{lts:b,succ:!1,ec:_e.message,addr:this.signal.url,uid:s.uid,cid:s.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!zt,signalChannel:this.signal instanceof LR?"1":"0"}),this._isProactiveJoin=!1,$.delete(s.uid),this.signal.close(),_e)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),_l.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(_e=>{_l.warning("[".concat(this.store.clientId,"] get traffic stats error"),_e.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(_S.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(_S.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(_S.NETWORK_QUALITY,{uplinkNetworkQuality:x4(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:x4(this._statsCollector.trafficStats.B_dnq)}):this.emit(_S.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),Vt}async leave(){let s=arguments.length>0&&arguments[0]!==void 0&&arguments[0],d=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){d!==y_.FALLBACK&&(this.state="DISCONNECTING");try{s||this.signal.connectionState!==v_.CONNECTED||await function(g,b){return b===1/0?g:GE.race([g,Kat(b)])}(this.signal.request(n_.LEAVE,void 0,!0),3e3)}catch(g){_l.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),g)}this.signal.close(d),d!==y_.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(s,d,g){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const b={state:"offer",p2p_id:this.store.p2pId,ortc:d,mode:this.spec.mode,extend:cE("PUB_EXTEND"),twcc:!!cE("PUBLISH_TWCC"),rtx:!!cE("USE_PUB_RTX")};try{return(await this.signal.request(n_.PUBLISH,b,!0))._message}catch($){if(g&&$.data&&$.data.code===r_.ERR_PUBLISH_REQUEST_INVALID)return _l.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),$.toString()),await this.tryUnpubBeforeRepub(s,d),this.publish(s,d,!1);throw $}}async publishDataChannel(s,d,g){var b;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const $={stream_id:d.streamId,ordered:d.ordered?1:0,max_retrans_times:(b=d.maxRetransmits)!==null&&b!==void 0?b:10,channel_id:d.channelId,metadata:d.metadata};try{await this.signal.request(n_.PUBLISH_DATASTREAM,$,!0)}catch(Vt){if(g&&Vt.data&&Vt.data.code===r_.ERR_PUBLISH_REQUEST_INVALID)return _l.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),Vt.toString()),await this.tryUnpubDataChannelBeforeRepub(s,d),this.publishDataChannel(s,d,!1);throw Vt}}async unpublish(s,d){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(n_.UNPUBLISH,{stream_id:d,ortc:s},!0)}catch(g){_l.warning("[".concat(this.store.clientId,"] unpublish warning: "),g)}}async unpublishDataChannel(s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await GE.all(s.map(d=>this.signal.request(n_.UNPUBLISH_DATASTREAM,{channel_id:d},!0)))}catch(d){_l.warning("unpublish datachannels warning: ",d)}}async presubscribe(s,d,g){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const b={stream_id:s,stream_type:d,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!cE("SUBSCRIBE_TWCC"),rtx:!!cE("USE_SUB_RTX")||void 0,extend:cE("SUB_EXTEND"),svc:Array.isArray(cE("SVC"))&&cE("SVC").length!==0?cE("SVC"):void 0};try{return await this.signal.request(n_.PRE_SUBSCRIBE,b,!0)}catch($){if(g&&$.data&&$.data.code===r_.ERR_SUBSCRIBE_REQUEST_INVALID)return _l.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),$.toString()),this.presubscribe(s,d,!1);throw $}}async subscribe(s,d,g){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const b={stream_id:s,stream_type:d.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!cE("SUBSCRIBE_TWCC"),rtx:!!cE("USE_SUB_RTX"),extend:cE("SUB_EXTEND"),ssrcId:d.ssrcId,svc:Array.isArray(cE("SVC"))&&cE("SVC").length!==0?cE("SVC"):void 0};try{return(await this.signal.request(n_.SUBSCRIBE,b,!0))._message}catch($){if(g&&$.data&&$.data.code===r_.ERR_SUBSCRIBE_REQUEST_INVALID)return _l.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),$.toString()),await this.tryUnsubBeforeResub(s,d),await this.subscribe(s,d,!1);throw $}}async subscribeDataChannel(s,d,g){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const b={uid:s,stream_id:d.id,channel_id:d.datachannelId};try{return void await this.signal.request(n_.SUBSCRIBE_DATASTREAM,b,!0)}catch($){if(g&&$.data&&$.data.code===r_.ERR_SUBSCRIBE_REQUEST_INVALID)return _l.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),$.toString()),await this.tryUnsubDataChannelBeforeResub(s,d),await this.subscribeDataChannel(s,d,!1);throw $}}async subscribeAll(s,d){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const g={p2p_id:this.store.p2pId,users:s,dtx:!1,rtx:!!cE("USE_SUB_RTX"),twcc:!!cE("SUBSCRIBE_TWCC"),svc:Array.isArray(cE("SVC"))&&cE("SVC").length!==0?cE("SVC"):void 0};try{return await this.signal.request(n_.SUBSCRIBE_STREAMS,g,!0)}catch(b){if(d&&b.data&&b.data.code===r_.ERR_SUBSCRIBE_REQUEST_INVALID)return _l.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),b.toString()),await this.tryMassUnsubBeforeResub(s),await this.subscribeAll(s,!1);throw b}}async setVideoProfile(s){const d=function(g){if(!(g.bitrateMax&&g.bitrateMin&&g.frameRate&&g.height&&g.width))return;let b=g.frameRate,$=g.width,Vt=g.height,zt=!0;return typeof b!="number"&&(b=b.exact||b.ideal||b.max||b.min||0,b||(zt=!1)),typeof $!="number"&&($=$.exact||$.ideal||$.max||$.min||0,$||(zt=!1)),typeof Vt!="number"&&(Vt=Vt.exact||Vt.ideal||Vt.max||Vt.min||0,b||(zt=!1)),zt?{stream_type:0,width:$,height:Vt,fps:b,start_bps:1e3*g.bitrateMax,min_bps:1e3*g.bitrateMin,target_bps:1e3*g.bitrateMax}:void 0}(s);if(d)return this.signal.request(n_.SET_VIDEO_PROFILE,d);_l.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(s,d){try{await this.signal.request(n_.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:s,stream_id:d},!0)}catch(g){_l.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),g)}}async unsubscribeDataChannel(s,d){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await GE.all(s.map(g=>this.signal.request(n_.UNSUBSCRIBE_DATASTREAM,{stream_id:g,uid:d},!0)))}catch(g){_l.warning("unsubscribeDataChannel warning: ",g)}}async massUnsubscribe(s){try{await this.signal.request(n_.UNSUBSCRIBE_STREAMS,s,!0)}catch(d){_l.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),d)}}async reconnectPC(s){const{iceParameters:d,dtlsParameters:g,rtpCapabilities:b}=s;return{gatewayEstablishParams:await this.signal.request(n_.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:d,dtlsParameters:g,rtpCapabilities:b}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(n_.GATEWAY_INFO)}async renewToken(s){await this.signal.request(n_.RENEW_TOKEN,s),this.key=s.token}async setClientRole(s,d){if(d&&(this._clientRoleOptions=Object.assign({},d)),this.state!=="CONNECTED")return void(this.role=s);let g,b=0;s==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(g=this._clientRoleOptions.delay,b=1):b=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:b=0,await this.signal.request(n_.SET_CLIENT_ROLE,{role:s,level:b,delay:g,client_ts:Date.now()}),this.role=s}async setRemoteVideoStreamType(s,d){await this.signal.request(n_.SWITCH_VIDEO_STREAM,{stream_id:s,stream_type:d})}async setDefaultRemoteVideoStreamType(s){await this.signal.request(n_.DEFAULT_VIDEO_STREAM,{stream_type:s})}async setStreamFallbackOption(s,d){await this.signal.request(n_.SET_FALLBACK_OPTION,{stream_id:s,fallback_type:d})}async pickSVCLayer(s,d){await this.signal.request(n_.PICK_SVC_LAYER,{stream_id:s,spatial_layer:d.spatialLayer,temporal_layer:d.temporalLayer})}async setRTM2Flag(s){await this.signal.request(n_.SET_RTM2_FLAG,{rtm2_flag:s})}async sendExtensionMessage(s,d,g){if(this.signal instanceof F4)return this.signal.sendExtensionMessage(s,d,g)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),b0({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(n_.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const s=KV.get(this.joinInfo.cname);s&&s.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const s=function(d){let g;return g=d.startsWith("dc")?d.match(/(dc\:\/\/)?([^:]+):(\d+)/):d.match(/(wss\:\/\/)?([^:]+):(\d+)/),g?{username:eT.username,password:eT.password,turnServerURL:g[2],tcpport:parseInt(g[3])+30,udpport:parseInt(g[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],s&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(b0(b0({},eT),{},{turnServerURL:s.turnServerURL,tcpport:s.tcpport,udpport:s.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const s=await this.signal.request(n_.TRAFFIC_STATS,void 0,!0);s.timestamp=Date.now(),s.ntp_offset!=null&&(this.ntpOffset=s.ntp_offset),s.peer_delay.forEach(d=>{const g=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(b=>b.peer_uid===d.peer_uid);g&&g.B_st!==d.B_st&&SD(()=>{this.emit(_S.STREAM_TYPE_CHANGE,d.peer_uid,d.B_st)})}),this._statsCollector.updateTrafficStats(s)}getJoinMessage(s){if(!this.joinInfo||!this.key)throw new EE(rE.UNEXPECTED_ERROR,"can not generate join message, no join info");const d=Object.assign({},this.joinInfo.apResponse);let g=cE("REPORT_APP_SCENARIO");if(typeof g!="string")try{g=JSON.stringify(g)}catch{g=void 0}g&&g.length>128&&(g=void 0);const b=b0({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:i0,browser:navigator.userAgent,process_id:cE("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:d,extend:cE("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:g,attributes:{userAttributes:{enablePublishedUserList:cE("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:cE("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof cE("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?cE("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof cE("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?cE("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof cE("ENABLE_USER_LICENSE_CHECK")=="boolean"?cE("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:cE("USE_PUB_RTX")===!0||cE("USE_SUB_RTX")===!0||void 0,disableFEC:cE("DISABLE_FEC"),enableNTPReport:!!cE("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!cE("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof cE("ENABLE_DATASTREAM_2")=="boolean"?cE("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!cE("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof cE("USE_XR")=="boolean"?cE("USE_XR"):void 0,enableLossbasedBwe:typeof cE("ENABLE_LOSSBASED_BWE")=="boolean"?cE("ENABLE_LOSSBASED_BWE"):void 0,enableAutCC:typeof cE("ENABLE_AUT_CC")=="boolean"?cE("ENABLE_AUT_CC"):void 0,enableCCFallback:typeof cE("ENABLE_CC_FALLBACK")=="boolean"?cE("ENABLE_CC_FALLBACK"):void 0}},join_ts:this.joinGatewayStartTime},s);return this.joinInfo.stringUid&&(b.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(b.aes_mode=this.joinInfo.aesmode,cE("ENCRYPT_AES")?(b.aes_secret=this.joinInfo.aespassword,b.aes_encrypt=!0):b.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(b.aes_salt=this.joinInfo.aessalt)),d.addresses[this.signal.websocket.currentURLIndex]&&(b.ap_response.ticket=d.addresses[this.signal.websocket.currentURLIndex].ticket,delete d.addresses),this.joinInfo.defaultVideoStream!==void 0&&(b.default_video_stream=this.joinInfo.defaultVideoStream),b}getRejoinMessage(){if(!this.joinInfo)throw new EE(rE.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(XE.WS_RECONNECT_WAITTING_FINISH,s=>{var d;KE(d=["tryNext","recover"]).call(d,s)&&this.joinInfo&&t_.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(XE.WS_RECONNECT_CREATE_CONNECTION,s=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(XE.WS_RECONNECTING,s=>{this.joinInfo&&t_.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s||tT.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",t_.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(XE.WS_CLOSED,s=>{let d;switch(s){case y_.LEAVE:d=tT.LEAVE;break;case y_.UID_BANNED:case y_.IP_BANNED:case y_.CHANNEL_BANNED:case y_.SERVER_ERROR:d=tT.SERVER_ERROR;break;case y_.FALLBACK:d=tT.FALLBACK;break;case y_.LICENSE_MISSING:case y_.LICENSE_EXPIRED:case y_.LICENSE_MINUTES_EXCEEDED:case y_.LICENSE_PERIOD_INVALID:case y_.LICENSE_MULTIPLE_SDK_SERVICE:case y_.LICENSE_ILLEGAL:case y_.TOKEN_EXPIRE:d=s;break;default:d=tT.NETWORK_ERROR}_l.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(d||"undefined -> "+tT.NETWORK_ERROR)),this.joinInfo&&t_.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:s===y_.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:d}),this._disconnectedReason=s,s!==y_.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(XE.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(_l.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),t_.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof LR?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const s=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!s)return void _l.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(s));q_("EVENT_REPORT_DOMAIN",s[1]),q_("EVENT_REPORT_BACKUP_DOMAIN",s[1]),q_("LOG_UPLOAD_SERVER","".concat(s[1],":6444"))}}),this.signal.on(d_.ON_UPLINK_STATS,s=>{this._statsCollector.updateUplinkStats(s)}),this.signal.on(XE.REQUEST_RECOVER,(s,d,g)=>{if(!this.joinInfo)return g(new EE(rE.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));s&&(this.joinInfo.multiIP=s,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,kS(this,_S.REQUEST_NEW_GATEWAY_LIST).then(d).catch(g)}),this.signal.on(XE.REQUEST_JOIN_INFO,async s=>{var d;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void s(this.getJoinMessage({ortc:{}}));const{iceParameters:g,dtlsParameters:b,rtpCapabilities:$}=await kS(this,_S.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(d=this.joinInfo)===null||d===void 0?void 0:d.turnServer});s(this.getJoinMessage({ortc:{iceParameters:g,dtlsParameters:b,rtpCapabilities:$,version:"2"}}))}),this.signal.on(XE.REQUEST_REJOIN_INFO,s=>{s(this.getRejoinMessage())}),this.signal.on(XE.REPORT_JOIN_GATEWAY,(s,d)=>{this.joinInfo&&(t_.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:s,addr:d,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof LR?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(XE.IS_P2P_DISCONNECTED,s=>{s(VI(this,_S.IS_P2P_DISCONNECTED))}),this.signal.on(XE.DISCONNECT_P2P,()=>{this.emit(_S.DISCONNECT_P2P)}),this.signal.on(XE.NEED_RENEW_SESSION,s=>{this.emit(_S.NEED_RENEW_SESSION,s)}),this.signal.on(XE.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(XE.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(XE.JOIN_RESPONSE,s=>{const d=this.getCurrentGatewayAddress();this.emit(_S.JOIN_RESPONSE,s,d)}),this.signal.on(XE.DATACHANNEL_PRECONNECT,async(s,d,g)=>{this.updateTurnConfigFromSignal();const b=this.getCurrentGatewayAddress();return kS(this,_S.DATACHANNEL_PRECONNECT,s,b).then(d).catch(g)}),this.signal.on(XE.DATACHANNEL_CONNECTING,async s=>{const{iceParameters:d,dtlsParameters:g,rtpCapabilities:b}=await kS(this,_S.REQUEST_DC_CONNECTION_PARAMS);s(this.getJoinMessage({ortc:{iceParameters:d,dtlsParameters:g,rtpCapabilities:b,version:"2"}}))}),this.signal.on(XE.DATACHANNEL_FAILBACK,()=>{_l.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(_S.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(s,d){try{await this.signal.request(n_.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:s,ortc:[d]},!0)}catch(g){throw _l.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),g),g}}async tryUnsubDataChannelBeforeResub(s,d){try{await this.signal.request(n_.UNSUBSCRIBE,{stream_id:d.id},!0)}catch(g){throw _l.warning("unsubscribe datachannel warning",g),g}}async tryUnpubBeforeRepub(s,d){try{await this.signal.request(n_.UNPUBLISH,{stream_id:s,ortc:d},!0)}catch(g){throw _l.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),g),g}}async tryUnpubDataChannelBeforeRepub(s,d){try{await this.signal.request(n_.UNPUBLISH_DATASTREAM,{channnel_id:d.channelId},!0)}catch(g){throw _l.warning("unpublish datastream warning: ",g),g}}async tryMassUnsubBeforeResub(s){const d={users:s.map(g=>({stream_id:g.stream_id,stream_type:g.stream_type}))};try{await this.signal.request(n_.UNSUBSCRIBE_STREAMS,d,!0)}catch(g){throw _l.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),g),g}}async muteLocal(s,d){const g={action:s.find(b=>b.stream_type===x_.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:s,stream_id:d};try{await this.signal.request(n_.CONTROL,g,!0,!0)}catch(b){throw _l.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),b),b}}async unmuteLocal(s,d){const g={action:s.find(b=>b.stream_type===x_.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:s,stream_id:d};try{await this.signal.request(n_.CONTROL,g,!0,!0)}catch(b){throw _l.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),b),b}}async muteRemote(s,d){const g={action:s===_g.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:d};try{await this.signal.request(n_.CONTROL,g,!0,!0)}catch(b){throw _l.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),b),b}}async unmuteRemote(s,d){const g={action:s===_g.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:d};try{await this.signal.request(n_.CONTROL,g,!0,!0)}catch(b){throw _l.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),b),b}}uploadWRTCStats(s){this.signal.uploadWRTCStats(s)}upload(s,d){this.signal.upload(s,d)}getSignalRTT(){return this.signal.rtt}async restartICE(s){const d={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:s};try{return await this.signal.request(n_.RESTART_ICE,d,!0)}catch(g){throw _l.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),g),g}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,tT.P2P_FAILED)}getCurrentGatewayAddress(){var s;if(!cE("GATEWAY_WSS_ADDRESS"))return(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(s){await this.signal.request(n_.SET_PARAMETER,{enablePublishAudioFilter:s})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(y_.FALLBACK)),this.store.useDataChannel=!1,this.signal=new D4(b0(b0({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(_S.RESET_SIGNAL,C4.websocket)}}let UD=0,zV=0;function z0(o,s,d,g){return new GE((b,$)=>{s.timeout=s.timeout||cE("HTTP_CONNECT_TIMEOUT"),s.responseType=s.responseType||"json",s.data&&!d?(s.data=JSON.stringify(s.data),UD+=dR(s.data)):d&&(s.data.size?UD+=s.data.size:s.data instanceof FormData?UD+=r4(s.data):UD+=dR(JSON.stringify(s.data))),s.headers=s.headers||{},s.headers["Content-Type"]=s.headers["Content-Type"]||"application/json",s.method="POST",s.url=o,RT.request(s).then(Vt=>{typeof Vt.data=="string"?zV+=dR(Vt.data):Vt.data instanceof ArrayBuffer||Vt.data instanceof Uint8Array?zV+=Vt.data.byteLength:zV+=dR(JSON.stringify(Vt.data)),g&&b({data:Vt.data,headers:Vt.headers}),b(Vt.data)}).catch(Vt=>{RT.isCancel(Vt)?$(new EE(rE.OPERATION_ABORTED,"cancel token canceled")):Vt.code==="ECONNABORTED"?$(new EE(rE.NETWORK_TIMEOUT,Vt.message)):Vt.response?$(new EE(rE.NETWORK_RESPONSE_ERROR,Vt.response.status)):$(new EE(rE.NETWORK_ERROR,Vt.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var o;function s(kE){var VE=0;return function(){return VE<kE.length?{done:!1,value:kE[VE++]}:{done:!0}}}var d=typeof Object.defineProperties=="function"?Object.defineProperty:function(kE,VE,$E){return kE==Array.prototype||kE==Object.prototype||(kE[VE]=$E.value),kE},g,b=function(kE){kE=[typeof globalThis=="object"&&globalThis,kE,typeof window=="object"&&window,typeof self=="object"&&self,typeof _=="object"&&_];for(var VE=0;VE<kE.length;++VE){var $E=kE[VE];if($E&&$E.Math==Math)return $E}throw Error("Cannot find global object")}(this);function $(kE,VE){if(VE)t:{var $E=b;kE=kE.split(".");for(var u_=0;u_<kE.length-1;u_++){var P_=kE[u_];if(!(P_ in $E))break t;$E=$E[P_]}(VE=VE(u_=$E[kE=kE[kE.length-1]]))!=u_&&VE!=null&&d($E,kE,{configurable:!0,writable:!0,value:VE})}}function Vt(kE){return(kE={next:kE})[Symbol.iterator]=function(){return this},kE}function zt(kE){var VE=typeof Symbol<"u"&&Symbol.iterator&&kE[Symbol.iterator];return VE?VE.call(kE):{next:s(kE)}}if($("Symbol",function(kE){function VE(P_,WE){this.A=P_,d(this,"description",{configurable:!0,writable:!0,value:WE})}if(kE)return kE;VE.prototype.toString=function(){return this.A};var $E="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",u_=0;return function P_(WE){if(this instanceof P_)throw new TypeError("Symbol is not a constructor");return new VE($E+(WE||"")+"_"+u_++,WE)}}),$("Symbol.iterator",function(kE){if(kE)return kE;kE=Symbol("Symbol.iterator");for(var VE="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),$E=0;$E<VE.length;$E++){var u_=b[VE[$E]];typeof u_=="function"&&typeof u_.prototype[kE]!="function"&&d(u_.prototype,kE,{configurable:!0,writable:!0,value:function(){return Vt(s(this))}})}return kE}),typeof Object.setPrototypeOf=="function")g=Object.setPrototypeOf;else{var _e;t:{var _r={};try{_r.__proto__={a:!0},_e=_r.a;break t}catch{}_e=!1}g=_e?function(kE,VE){if(kE.__proto__=VE,kE.__proto__!==VE)throw new TypeError(kE+" is not extensible");return kE}:null}var _o=g;function ga(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function _a(kE){if(kE.m)throw new TypeError("Generator is already running");kE.m=!0}function _c(kE,VE){return kE.h=3,{value:VE}}function tE(kE){this.g=new ga,this.G=kE}function _p(kE,VE,$E,u_){try{var P_=VE.call(kE.g.j,$E);if(!(P_ instanceof Object))throw new TypeError("Iterator result "+P_+" is not an object");if(!P_.done)return kE.g.m=!1,P_;var WE=P_.value}catch(_m){return kE.g.j=null,kE.g.s(_m),_f(kE)}return kE.g.j=null,u_.call(kE.g,WE),_f(kE)}function _f(kE){for(;kE.g.h;)try{var VE=kE.G(kE.g);if(VE)return kE.g.m=!1,{value:VE.value,done:!1}}catch($E){kE.g.v=void 0,kE.g.s($E)}if(kE.g.m=!1,kE.g.l){if(VE=kE.g.l,kE.g.l=null,VE.F)throw VE.D;return{value:VE.return,done:!0}}return{value:void 0,done:!0}}function eE(kE){this.next=function(VE){return kE.o(VE)},this.throw=function(VE){return kE.s(VE)},this.return=function(VE){return function($E,u_){_a($E.g);var P_=$E.g.j;return P_?_p($E,"return"in P_?P_.return:function(WE){return{value:WE,done:!0}},u_,$E.g.return):($E.g.return(u_),_f($E))}(kE,VE)},this[Symbol.iterator]=function(){return this}}function iE(kE,VE){return VE=new eE(new tE(VE)),_o&&kE.prototype&&_o(VE,kE.prototype),VE}if(ga.prototype.o=function(kE){this.v=kE},ga.prototype.s=function(kE){this.l={D:kE,F:!0},this.h=this.C||this.u},ga.prototype.return=function(kE){this.l={return:kE},this.h=this.u},tE.prototype.o=function(kE){return _a(this.g),this.g.j?_p(this,this.g.j.next,kE,this.g.o):(this.g.o(kE),_f(this))},tE.prototype.s=function(kE){return _a(this.g),this.g.j?_p(this,this.g.j.throw,kE,this.g.o):(this.g.s(kE),_f(this))},$("Array.prototype.entries",function(kE){return kE||function(){return function(VE,$E){VE instanceof String&&(VE+="");var u_=0,P_=!1,WE={next:function(){if(!P_&&u_<VE.length){var _m=u_++;return{value:$E(_m,VE[_m]),done:!1}}return P_=!0,{done:!0,value:void 0}}};return WE[Symbol.iterator]=function(){return WE},WE}(this,function(VE,$E){return[VE,$E]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var fE=function(kE,VE){for(var $E=0;$E<kE.length;$E++)VE(kE[$E])},mE=function(kE){return kE.replace(/\r?\n|\r/g,`\r
`)},_E=function(kE,VE,$E){return VE instanceof Blob?($E=$E!==void 0?$E+"":typeof VE.name=="string"?VE.name:"blob",VE.name===$E&&Object.prototype.toString.call(VE)!=="[object Blob]"||(VE=new File([VE],$E)),[String(kE),VE]):[String(kE),String(VE)]},SE=function(kE,VE){if(kE.length<VE)throw new TypeError(VE+" argument required, but only "+kE.length+" present.")},wE=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,NE=wE.FormData,DE=wE.XMLHttpRequest&&wE.XMLHttpRequest.prototype.send,JE=wE.Request&&wE.fetch,b_=wE.navigator&&wE.navigator.sendBeacon,L_=wE.Element&&wE.Element.prototype,$_=wE.Symbol&&Symbol.toStringTag;$_&&(Blob.prototype[$_]||(Blob.prototype[$_]="Blob"),"File"in wE&&!File.prototype[$_]&&(File.prototype[$_]="File"));try{new File([],"")}catch{wE.File=function(VE,$E,u_){return VE=new Blob(VE,u_||{}),Object.defineProperties(VE,{name:{value:$E},lastModified:{value:+(u_&&u_.lastModified!==void 0?new Date(u_.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),$_&&Object.defineProperty(VE,$_,{value:"File"}),VE}}var OS=function(kE){return kE.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},lS=function(kE){this.i=[];var VE=this;kE&&fE(kE.elements,function($E){if($E.name&&!$E.disabled&&$E.type!=="submit"&&$E.type!=="button"&&!$E.matches("form fieldset[disabled] *"))if($E.type==="file"){var u_=$E.files&&$E.files.length?$E.files:[new File([],"",{type:"application/octet-stream"})];fE(u_,function(P_){VE.append($E.name,P_)})}else $E.type==="select-multiple"||$E.type==="select-one"?fE($E.options,function(P_){!P_.disabled&&P_.selected&&VE.append($E.name,P_.value)}):$E.type==="checkbox"||$E.type==="radio"?$E.checked&&VE.append($E.name,$E.value):(u_=$E.type==="textarea"?mE($E.value):$E.value,VE.append($E.name,u_))})};if((o=lS.prototype).append=function(kE,VE,$E){SE(arguments,2),this.i.push(_E(kE,VE,$E))},o.delete=function(kE){SE(arguments,1);var VE=[];kE=String(kE),fE(this.i,function($E){$E[0]!==kE&&VE.push($E)}),this.i=VE},o.entries=function kE(){var VE,$E=this;return iE(kE,function(u_){if(u_.h==1&&(VE=0),u_.h!=3)return VE<$E.i.length?u_=_c(u_,$E.i[VE]):(u_.h=0,u_=void 0),u_;VE++,u_.h=2})},o.forEach=function(kE,VE){SE(arguments,1);for(var $E=zt(this),u_=$E.next();!u_.done;u_=$E.next()){var P_=zt(u_.value);u_=P_.next().value,P_=P_.next().value,kE.call(VE,P_,u_,this)}},o.get=function(kE){SE(arguments,1);var VE=this.i;kE=String(kE);for(var $E=0;$E<VE.length;$E++)if(VE[$E][0]===kE)return VE[$E][1];return null},o.getAll=function(kE){SE(arguments,1);var VE=[];return kE=String(kE),fE(this.i,function($E){$E[0]===kE&&VE.push($E[1])}),VE},o.has=function(kE){SE(arguments,1),kE=String(kE);for(var VE=0;VE<this.i.length;VE++)if(this.i[VE][0]===kE)return!0;return!1},o.keys=function kE(){var VE,$E,u_,P_,WE=this;return iE(kE,function(_m){if(_m.h==1&&(VE=zt(WE),$E=VE.next()),_m.h!=3)return $E.done?void(_m.h=0):(u_=$E.value,P_=zt(u_),_c(_m,P_.next().value));$E=VE.next(),_m.h=2})},o.set=function(kE,VE,$E){SE(arguments,2),kE=String(kE);var u_=[],P_=_E(kE,VE,$E),WE=!0;fE(this.i,function(_m){_m[0]===kE?WE&&(WE=!u_.push(P_)):u_.push(_m)}),WE&&u_.push(P_),this.i=u_},o.values=function kE(){var VE,$E,u_,P_,WE=this;return iE(kE,function(_m){if(_m.h==1&&(VE=zt(WE),$E=VE.next()),_m.h!=3)return $E.done?void(_m.h=0):(u_=$E.value,(P_=zt(u_)).next(),_c(_m,P_.next().value));$E=VE.next(),_m.h=2})},lS.prototype._asNative=function(){for(var kE=new NE,VE=zt(this),$E=VE.next();!$E.done;$E=VE.next()){var u_=zt($E.value);$E=u_.next().value,u_=u_.next().value,kE.append($E,u_)}return kE},lS.prototype._blob=function(){var kE="----formdata-polyfill-"+Math.random(),VE=[],$E="--"+kE+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(u_,P_){return typeof u_=="string"?VE.push($E+OS(mE(P_))+`"\r
\r
`+mE(u_)+`\r
`):VE.push($E+OS(mE(P_))+'"; filename="'+OS(u_.name)+`"\r
Content-Type: `+(u_.type||"application/octet-stream")+`\r
\r
`,u_,`\r
`)}),VE.push("--"+kE+"--"),new Blob(VE,{type:"multipart/form-data; boundary="+kE})},lS.prototype[Symbol.iterator]=function(){return this.entries()},lS.prototype.toString=function(){return"[object FormData]"},L_&&!L_.matches&&(L_.matches=L_.matchesSelector||L_.mozMatchesSelector||L_.msMatchesSelector||L_.oMatchesSelector||L_.webkitMatchesSelector||function(kE){for(var VE=(kE=(this.document||this.ownerDocument).querySelectorAll(kE)).length;0<=--VE&&kE.item(VE)!==this;);return-1<VE}),$_&&(lS.prototype[$_]="FormData"),DE){var U0=wE.XMLHttpRequest.prototype.setRequestHeader;wE.XMLHttpRequest.prototype.setRequestHeader=function(kE,VE){U0.call(this,kE,VE),kE.toLowerCase()==="content-type"&&(this.B=!0)},wE.XMLHttpRequest.prototype.send=function(kE){kE instanceof lS?(kE=kE._blob(),this.B||this.setRequestHeader("Content-Type",kE.type),DE.call(this,kE)):DE.call(this,kE)}}JE&&(wE.fetch=function(kE,VE){return VE&&VE.body&&VE.body instanceof lS&&(VE.body=VE.body._blob()),JE.call(this,kE,VE)}),b_&&(wE.navigator.sendBeacon=function(kE,VE){return VE instanceof lS&&(VE=VE._asNative()),b_.call(this,kE,VE)}),wE.FormData=lS}})();const hP=()=>{const o=cE("AREAS");return o.length===0&&o.push(k_.GLOBAL),F0(o).call(o,(s,d,g)=>{const b=G4(d);return b?g===0?b:"".concat(s,",").concat(b):s},"")},G4=o=>o===k_.OVERSEA?"".concat(sT.ASIA,",").concat(sT.EUROPE,",").concat(sT.AFRICA,",").concat(sT.NORTH_AMERICA,",").concat(sT.SOUTH_AMERICA,",").concat(sT.OCEANIA):sT[o],sut=o=>{const s={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return o.map(d=>{const g=LD[d],b=Object.keys(g);b&&b.map($=>{$!=="CODE"&&(s[$]=s[$].concat(g[$]))})}),s},VD={GLOBAL:{ASIA:[k_.CHINA,k_.JAPAN,k_.INDIA,k_.KOREA,k_.HKMC],EUROPE:[],NORTH_AMERICA:[k_.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},FD=Object.keys(VD[k_.GLOBAL]),YV=[k_.CHINA,k_.NORTH_AMERICA,k_.EUROPE,k_.ASIA,k_.JAPAN,k_.INDIA,k_.OCEANIA,k_.SOUTH_AMERICA,k_.AFRICA,k_.KOREA,k_.HKMC,k_.US],aut=function(o,s){let d=[];if(KE(o).call(o,k_.GLOBAL)){const $=[k_.GLOBAL,k_.OVERSEA],Vt=Object.keys(LD);if(s===k_.GLOBAL)throw new EE(rE.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(s===k_.CHINA)d=[k_.OVERSEA];else if(b=s,KE(FD).call(FD,b)){const zt=(g=s,VD[k_.GLOBAL][g]||[]),_e=[...$,s,...zt];d=Vt.filter(_r=>!KE(_e).call(_e,_r))}else if(function(zt){let _e=!1;return FD.forEach(_r=>{var _o;KE(_o=VD[k_.GLOBAL][_r]).call(_o,zt)&&(_e=!0)}),_e}(s)){const zt=function(_r){let _o;return FD.forEach(ga=>{var _a;KE(_a=VD[k_.GLOBAL][ga]).call(_a,_r)&&(_o=ga)}),_o}(s),_e=[...$,zt,s];d=Vt.filter(_r=>!KE(_e).call(_e,_r))}else d=o;d=function(zt){const _e=[];return YV.forEach(_r=>{KE(zt).call(zt,_r)&&_e.push(_r)}),_e.concat(zt.filter(_r=>!KE(YV).call(YV,_r)))}(d)}else d=o;var g,b;return d};function W4(o){var s,d;if(!o&&KE(s=cE("AREAS")).call(s,k_.EXTENSIONS))return _l.debug("update area from ap : reset"),void JV(ect,!0);if(!KE(d=cE("AREAS")).call(d,k_.GLOBAL)||!o)return;let g=LD.EXTENSIONS;g&&(g={CODE:G4(k_.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(o,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(o,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(o,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(o,".agora.io"),"cds-ap-web-2-".concat(o,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(o,".agora.io"),"sua-ap-web-2-".concat(o,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(o,".agora.io"),"uap-ap-web-2-".concat(o,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(o,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(o,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(o,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(o,".agora.io")]},_l.debug("update area from ap success: ".concat(o,",config is "),g),q_("AREAS",[k_.EXTENSIONS],!0),Object.keys(g).map(b=>{b==="LOG_UPLOAD_SERVER"||b==="EVENT_REPORT_DOMAIN"||b==="EVENT_REPORT_BACKUP_DOMAIN"||b==="PROXY_SERVER_TYPE3"?q_(b,g[b][0]):q_(b,g[b])}))}function JV(o){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const d=t_.reportApiInvoke(null,{name:NS.SET_AREA,options:o,tag:hS.TRACER});try{let g=[];if(typeof o=="string"&&(g=[o]),Array.isArray(o)&&(o.forEach($=>{if(!KE(w4).call(w4,$))throw new EE(rE.INVALID_PARAMS,"invalid area code")}),g=o),Object.prototype.toString.call(o)==="[object Object]"){const{areaCode:$,excludedArea:Vt}=o;if(!$)throw new EE(rE.INVALID_PARAMS,"area code is needed");let zt=$;typeof $=="string"&&(zt=[$]),g=Vt?aut(zt,Vt):zt}if(!s){if(rI.AREAS){const $=new EE(rE.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return d.onError($),void _l.warning("setArea is prohibited because of config-distribute")}if(KE(g).call(g,k_.GLOBAL)&&cE("AREAS")===k_.EXTENSIONS){const $=new EE(rE.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return d.onError($),void _l.warning("setArea is prohibited because of ap extensions")}}q_("AREAS",g,s);const b=sut(g);Object.keys(b).map($=>{$==="LOG_UPLOAD_SERVER"||$==="EVENT_REPORT_DOMAIN"||$==="EVENT_REPORT_BACKUP_DOMAIN"||$==="PROXY_SERVER_TYPE3"?q_($,b[$][0]):q_($,b[$])}),_l.debug("set area success:",g.join(","))}catch(g){throw d.onError(g),g}d.onSuccess()}function q4(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function XV(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?q4(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):q4(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}let QV=1;function cut(o,s,d,g,b){QV+=1;const $={sid:d.sid,command:"convergeAllocateEdge",uid:"666",appId:d.appId,ts:Math.floor(Date.now()/1e3),seq:QV,requestId:QV,version:i0,cname:d.cname},Vt={service_name:s,json_body:JSON.stringify($)};let zt,_e,_r=o[0];return W0(async()=>{zt=Date.now();const _o=await z0(_r,{data:Vt,cancelToken:g,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_e=Date.now()-zt,_o.code!==0){const _c=new EE(rE.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_o.code,{retry:!0,responseTime:_e});throw _l.error(_c.toString()),_c}const ga=JSON.parse(_o.json_body);if(ga.code!==200){const _c=new EE(rE.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(ga.code,", reason: ").concat(ga.reason),{code:ga.code,responseTime:_e});throw _l.error(_c.toString()),_c}if(!ga.servers||ga.servers.length===0){const _c=new EE(rE.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:ga.code,responseTime:_e});throw _l.error(_c.toString()),_c}const _a=function(_c,tE){return{addressList:_c.servers.map(_p=>"wss://".concat(_p.address.replace(/\./g,"-"),".").concat(cE("WORKER_DOMAIN"),":").concat(_p.wss,"?serviceName=").concat(encodeURIComponent(tE))),workerToken:_c.workerToken,vid:_c.vid}}(ga,s);return cE("LIVE_STREAMING_ADDRESS")&&(_a.addressList=cE("LIVE_STREAMING_ADDRESS")instanceof Array?cE("LIVE_STREAMING_ADDRESS"):[cE("LIVE_STREAMING_ADDRESS")]),XV(XV({},_a),{},{responseTime:_e})},(_o,ga)=>(t_.apworkerEvent(d.sid,{success:!0,sc:200,serviceName:s,responseDetail:JSON.stringify(_o.addressList),firstSuccess:ga===0,responseTime:_e,serverIp:o[ga%o.length]}),!1),(_o,ga)=>(t_.apworkerEvent(d.sid,{success:!1,sc:_o.data&&_o.data.code||200,serviceName:s,responseTime:_e,serverIp:o[ga%o.length]}),!!(_o.code!==rE.OPERATION_ABORTED&&_o.code!==rE.UNEXPECTED_RESPONSE||_o.data&&_o.data.retry)&&(_r=o[(ga+1)%o.length],!0)),b)}let ZV=1;function H4(o,s,d,g){let{url:b,areaCode:$}=o;const{clientId:Vt,sid:zt}=s,_e=Date.now();let _r;const[_o,ga]=tF(s,$,[wS.CHOOSE_SERVER]);let _a=pS.networkState;return W0(async()=>{_a&&pS.networkState===gT.OFFLINE&&pS.onlineWaiter&&await GE.race([pS.onlineWaiter,WS(g&&g.maxRetryTimeout||CS.maxRetryTimeout)]),_a=pS.networkState;const{data:_c,headers:tE}=await z0(b,{data:_o,cancelToken:d,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_r=tE.http3==="1"?1:-1,t_.reportResourceTiming(b,zt),z4(_c,b,s,_e,[wS.CHOOSE_SERVER],_r);const _p=dP(_c,wS.CHOOSE_SERVER);return $V(_p),qV(_p,b)},_c=>(_c&&t_.joinChooseServer(zt,{lts:_e,succ:!0,csAddr:b,opid:ga,serverList:_c.gatewayAddrs.map(tE=>tE.address),ec:null,cid:_c.cid.toString(),uid:_c.uid.toString(),csIp:_c.csIp,unilbsServerIds:[wS.CHOOSE_SERVER].toString(),isHttp3:_r}),!1),_c=>_c.code!==rE.OPERATION_ABORTED&&(_c.code===rE.CAN_NOT_GET_GATEWAY_SERVER?_c.data.retry:(t_.joinChooseServer(zt,{lts:_e,succ:!1,csAddr:b,serverList:null,opid:ga,ec:_c.code,csIp:_c.data&&_c.data.csIp,unilbsServerIds:[wS.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:_a}),isHttp3:_r}),_l.warning("[".concat(Vt||"sid-".concat(zt.slice(0,6)),"] Choose server network error, retry"),_c),!0)),g)}function K4(o,s,d,g){let b,{url:$,areaCode:Vt,serviceIds:zt}=o;const _e=Date.now(),[_r,_o]=tF(s,Vt,zt);let ga;return W0(async()=>{ga&&pS.networkState===gT.OFFLINE&&pS.onlineWaiter&&await GE.race([pS.onlineWaiter,WS(g&&g.maxRetryTimeout||CS.maxRetryTimeout)]),ga=pS.networkState;const{data:_a,headers:_c}=await z0($,{data:_r,cancelToken:d,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);b=_c.http3==="1"?1:-1,t_.reportResourceTiming($,s.sid),z4(_a,$,s,_e,zt,b);const tE=dP(_a,wS.CHOOSE_SERVER),_p=dP(_a,s.cloudProxyServer==="proxy5"?wS.CLOUD_PROXY_5:s.cloudProxyServer==="proxy3"||s.cloudProxyServer==="proxy4"?wS.CLOUD_PROXY:wS.CLOUD_PROXY_FALLBACK);return $V(tE),{gatewayInfo:qV(tE,$),proxyInfo:_p,url:$}},_a=>(_a.gatewayInfo&&t_.joinChooseServer(s.sid,{lts:_e,succ:!0,csAddr:$,serverList:_a.gatewayInfo.gatewayAddrs.map(_c=>_c.address),ec:null,opid:_o,cid:_a.gatewayInfo.cid.toString(),uid:_a.gatewayInfo.uid.toString(),csIp:_a.gatewayInfo.csIp,unilbsServerIds:zt.toString(),isHttp3:b}),_a.proxyInfo&&t_.joinWebProxyAP(s.sid,{lts:_e,sucess:1,apServerAddr:$,turnServerAddrList:_a.proxyInfo.addresses.map(_c=>_c.ip).join(","),errorCode:null,eventType:s.cloudProxyServer,unilbsServerIds:zt.toString()}),!1),_a=>_a.code!==rE.OPERATION_ABORTED&&(_a.code===rE.CAN_NOT_GET_GATEWAY_SERVER?_a.data.retry:(t_.joinWebProxyAP(s.sid,{lts:_e,sucess:0,apServerAddr:$,turnServerAddrList:null,errorCode:_a.code,eventType:s.cloudProxyServer,unilbsServerIds:zt.toString(),extend:JSON.stringify({networkState:ga})}),_l.warning("[".concat(s.clientId,"] multi unilbs network error, retry"),_a),!0)),g)}const z4=(o,s,d,g,b,$)=>{const{sid:Vt,clientId:zt,cloudProxyServer:_e}=d,_r=[],_o=ga=>{ga.flag===4096?t_.joinChooseServer(Vt,{lts:g,succ:!1,csAddr:s,opid:o.opid,serverList:null,ec:ga.error.message,csIp:ga.error.data&&ga.error.data.csIp,unilbsServerIds:b.toString(),isHttp3:$}):ga.flag!==1048576&&ga.flag!==4194304&&ga.flag!==4194310||t_.joinWebProxyAP(Vt,{lts:g,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:ga.error.code,eventType:_e,unilbsServerIds:b.toString()})};if(o.response_body.forEach(ga=>{const _a=ga.buffer.code;if(ga.uri===23&&_a===0&&!ga.buffer.edges_services)if(ga.buffer.flag===4194310)_l.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),ga.buffer.edges_services=[];else{const _c={error:new EE(rE.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:o.detail[502]}),flag:ga.buffer.flag};_r.push(_c),_o(_c)}if(_a!==0){const _c=zO(_a),tE={error:new EE(rE.CAN_NOT_GET_GATEWAY_SERVER,_c.desc,{desc:_c.desc,retry:_c.retry,csIp:o.detail[502]}),flag:ga.buffer.flag};ga.buffer.flag===4194310?_l.warning(tE.error.toString()):_r.push(tE),_o(tE)}}),_r.length)throw _l.warning("[".concat(zt||"sid-".concat(Vt.slice(0,6)),"] multi unilbs ").concat(s," failed, ").concat(_r.map(ga=>"flag: ".concat(ga.flag,", message: ").concat(ga.error.message,", retry: ").concat(ga.error.data.retry)).join(" | "))),new EE(rE.CAN_NOT_GET_GATEWAY_SERVER,_r.map(ga=>"flag: ".concat(ga.flag,", message: ").concat(ga.error.message)).join(" | "),{retry:!!_r.find(ga=>ga.error.data.retry),csIp:o.detail[502],desc:[...new Set(_r.map(ga=>{var _a;return ga==null||(_a=ga.error)===null||_a===void 0||(_a=_a.data)===null||_a===void 0?void 0:_a.desc}).filter(ga=>!!ga))]})},$V=o=>{var s,d,g,b;if(o.addresses&&o.addresses.length===0&&o.code===0)throw new EE(rE.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:o.detail&&o.detail[502]});if(cE("AP_AREA")&&((g=o.detail)!==null&&g!==void 0&&g[23]&&typeof((b=o.detail)===null||b===void 0?void 0:b[23])=="string"?W4(o.detail[23].toLowerCase()):W4()),(s=o.detail)!==null&&s!==void 0&&s[19]&&typeof((d=o.detail)===null||d===void 0?void 0:d[19])=="string"){const Vt=o.detail[19],zt=Vt==null?void 0:Vt.split(";");for(let _e=0;_e<zt.length;_e++){var $;const _r=dT($=zt[_e]).call($);o.addresses[_e]&&zt&&(o.addresses[_e].fingerprint=_r)}}if(cE("GATEWAY_ADDRESS")&&cE("GATEWAY_ADDRESS").length>0){_l.debug("assign gateway address to",cE("GATEWAY_ADDRESS"));const Vt=cE("GATEWAY_ADDRESS").map(zt=>{var _e,_r;const _o=(_e=(_r=o.addresses.find(ga=>ga.ip===zt.ip&&ga.port===zt.port))===null||_r===void 0?void 0:_r.fingerprint)!==null&&_e!==void 0?_e:"";return{ip:zt.ip,port:zt.port,ticket:o.addresses[0]&&o.addresses[0].ticket,fingerprint:_o}});o.addresses=Vt}},uut=(o,s)=>{if(o.response_body&&o.response_body.length){const d=o.response_body[0];if(d.buffer.code!==0){const g=zO(d.buffer.code);throw new EE(rE.UPDATE_TICKET_FAILED,"[".concat(d.buffer.code,"]: ").concat(g.desc),{retry:g.retry})}return d.buffer.ticket}throw _l.debug("update ticket request received ap response without response body:",s),new EE(rE.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},tF=(o,s,d)=>{const g=Math.floor(Math.random()*1e12),b={appid:o.appId,client_ts:Date.now(),opid:g,sid:o.sid,request_bodies:[{uri:22,buffer:{cname:o.cname,detail:XV({6:o.stringUid,11:s,12:cE("USE_NEW_TOKEN")?"1":void 0,22:s},o.apRTM?{26:"RTM2"}:{}),key:o.token,service_ids:d,uid:o.uid||0}}]};b.request_bodies.forEach(Vt=>{o.multiIP&&o.multiIP.gateway_ip&&(Vt.buffer.detail[5]=JSON.stringify({vocs_ip:[o.multiIP.uni_lbs_ip],vos_ip:[o.multiIP.gateway_ip]}))});const $=new FormData;return $.append("request",JSON.stringify(b)),[$,g]},lut=(o,s)=>{const d=Math.floor(Math.random()*1e12),g={appid:o.appId,client_ts:Date.now(),opid:d,sid:o.sid,request_bodies:[{uri:28,buffer:{cname:o.cname,detail:{1:"",6:o.stringUid,12:"1"},token:o.token,service_ids:s,uid:o.uid||0,edges_services:o.apResponse.addresses.map($=>({ip:$.ip,port:$.port}))}}]},b=new FormData;return b.append("request",JSON.stringify(g)),[b,d]};let YO=0;function JO(o){return GE.all(o.map(s=>s.then(d=>{throw d},d=>d))).then(s=>{throw s},s=>s)}const pP=async o=>{let{fragementLength:s,referenceList:d,asyncMapHandler:g,allFailedhandler:b,promisesCollector:$}=o,Vt=0;const zt=s;let _e,_r=0;const _o=async()=>{const ga=(()=>{const _a=Vt*zt,_c=_a+zt;return d.slice(_a,_c).map(g)})();$&&$.push(...ga);try{_e=await JO(ga)}catch(_a){if(_r+=zt,Vt++,!(_r>=d.length))return void await _o();b(_a)}ga.forEach(_a=>_a.cancel())};return await _o(),_e},Y4=async o=>{let{referenceList:s,asyncMapHandler:d,closeFn:g}=o;const b=s.length;let $=0;const Vt=async()=>{const zt=d(s.shift());try{return await zt}catch(_e){if($++,$>=b||g!=null&&g(_e))throw _e;return Vt()}};return Vt()};async function eF(o,s,d,g){return{gatewayInfo:await async function($,Vt,zt,_e){let _r=null;const _o=[],ga=async()=>{const _c=cE("WEBCS_DOMAIN").slice(0,cE("AJAX_REQUEST_CONCURRENT")).map(_f=>({url:$.proxyServer?"https://".concat($.proxyServer,"/ap/?url=").concat(_f+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_f,"/api/v2/transpond/webrtc?v=2"),areaCode:hP()})),tE=_e.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:_c.map(_f=>_f.url)}),_p=await pP({fragementLength:cE("FRAGEMENT_LENGTH"),referenceList:_c,asyncMapHandler:_f=>(_l.debug("[".concat($.clientId,"] Connect to choose_server:"),_f.url),H4(_f,$,Vt,zt)),allFailedhandler:_f=>{throw _e.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_f},tE),_f[0]},promisesCollector:_o});return _e.recordJoinChannelService({endTs:Date.now(),status:"success"},tE),_p},_a=async()=>{if(await WS(1e3),_r!==null)return _r;const _c=cE("WEBCS_DOMAIN_BACKUP_LIST").map(_f=>({url:$.proxyServer?"https://".concat($.proxyServer,"/ap/?url=").concat(_f+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_f,"/api/v2/transpond/webrtc?v=2"),areaCode:hP()})),tE=_e.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:_c.map(_f=>_f.url)}),_p=await pP({fragementLength:cE("FRAGEMENT_LENGTH"),referenceList:_c,asyncMapHandler:_f=>(_l.debug("[".concat($.clientId,"] Connect to backup choose_server:"),_f.url),H4(_f,$,Vt,zt)),allFailedhandler:_f=>{throw _e.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_f},tE),_f[0]},promisesCollector:_o});return _e.recordJoinChannelService({endTs:Date.now(),status:"success"},tE),_p};try{return _r=await JO([ga(),_a()]),_o.length&&_o.forEach(_c=>_c.cancel&&typeof _c.cancel=="function"&&_c.cancel()),_r}catch(_c){throw _c[0]}}(o,s,d,g)}}async function J4(o,s,d,g,b){const $=o.cloudProxyServer;if($==="disabled"){if(o.useLocalAccessPoint)return await eF(o,s,d,b);if(cE("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:_a,proxyInfo:_c}=await Z4(o,s,d,b);if(o.turnServer&&o.turnServer.mode!=="auto")return{gatewayInfo:_a};const tE=_c.map(_p=>({turnServerURL:_p.address,tcpport:_p.tcpport||eT.tcpport,udpport:_p.udpport||eT.udpport,username:_p.username||eT.username,password:_p.password||eT.password,forceturn:!1,security:!0}));if(b.useP2P){var Vt;const _p=(Vt=o.uid)!==null&&Vt!==void 0?Vt:_a.uid,_f="glb:".concat(_p.toString()),eE=await RV(_f),iE=_c.map(fE=>({turnServerURL:fE.address,tcpport:fE.tcpport||eT.tcpport,udpport:fE.udpport||eT.udpport,username:_f,password:eE,forceturn:!1,security:!0}));tE.push(...iE)}return o.turnServer={mode:"manual",servers:tE},{gatewayInfo:_a}}return await eF(o,s,d,b)}const{proxyInfo:zt,gatewayInfo:_e}=await Z4(o,s,d,b),_r={gatewayInfo:_e},_o=zt.map(_a=>({turnServerURL:_a.address,tcpport:$==="proxy3"?void 0:_a.tcpport?_a.tcpport:eT.tcpport,udpport:$==="proxy4"?void 0:_a.udpport?_a.udpport:eT.udpport,username:_a.username||eT.username,password:_a.password||eT.password,forceturn:$!=="proxy4",security:$==="proxy5"}));if(b.useP2P){var ga;const _a=(ga=o.uid)!==null&&ga!==void 0?ga:_e.uid,_c="glb:".concat(_a.toString()),tE=await RV(_c),_p=zt.map(_f=>({turnServerURL:_f.address,tcpport:$==="proxy3"?void 0:_f.tcpport||eT.tcpport,udpport:$==="proxy4"?void 0:_f.udpport||eT.udpport,username:_c,password:tE,forceturn:$!=="proxy4",security:$==="proxy5"}));_o.push(..._p)}return o.turnServer={mode:"manual",servers:_o},_l.debug("[".concat(o.clientId,"] set proxy server: ").concat(o.proxyServer,", mode: ").concat($)),_r}async function X4(o,s,d,g,b){const $=cE("ACCOUNT_REGISTER").slice(0,cE("AJAX_REQUEST_CONCURRENT"));let Vt=[];Vt=s.proxyServer?$.map(_e=>"https://".concat(s.proxyServer,"/ap/?url=").concat(_e+"/api/v1")):$.map(_e=>"https://".concat(_e,"/api/v1"));const zt=b==null?void 0:b.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:Vt});try{const _e=await async function(_r,_o,ga,_a,_c){const tE=Date.now(),_p={sid:ga.sid,opid:10,appid:ga.appId,string_uid:_o};let _f=_r[0];const eE=await W0(()=>z0(_f+"".concat(_f.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_p,cancelToken:_a,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(iE,fE)=>{if(iE.code===0){if(iE.uid<=0||iE.uid>=Math.pow(2,32))throw _l.error("Invalid Uint Uid ".concat(_o," => ").concat(iE.uid),iE),t_.reqUserAccount(_p.sid,{lts:tE,success:!1,serverAddr:_f,stringUid:_p.string_uid,uid:iE.uid,errorCode:rE.INVALID_UINT_UID_FROM_STRING_UID,extend:_p}),new EE(rE.INVALID_UINT_UID_FROM_STRING_UID);return t_.reqUserAccount(_p.sid,{lts:tE,success:!0,serverAddr:_f,stringUid:_p.string_uid,uid:iE.uid,errorCode:null,extend:_p}),!1}const mE=zO(iE.code);return mE.retry&&(_f=_r[(fE+1)%_r.length]),t_.reqUserAccount(_p.sid,{lts:tE,success:!1,serverAddr:_f,stringUid:_p.string_uid,uid:iE.uid,errorCode:mE.desc,extend:_p}),mE.retry},(iE,fE)=>iE.code!==rE.OPERATION_ABORTED&&(t_.reqUserAccount(_p.sid,{lts:tE,success:!1,serverAddr:_f,stringUid:_p.string_uid,uid:null,errorCode:iE.code,extend:_p}),_f=_r[(fE+1)%_r.length],!0),_c);if(eE.code!==0){const iE=zO(eE.code);throw new EE(rE.UNEXPECTED_RESPONSE,iE.desc)}return eE}(Vt,o,s,d,g);return b==null||b.recordJoinChannelService({status:"success",endTs:Date.now()},zt),_e.uid}catch(_e){throw b==null||b.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_e]},zt),_e}}async function dut(o,s,d){const g=cE("ACCOUNT_REGISTER");let b=[];b=s.proxyServer?g.map($=>"https://".concat(s.proxyServer,"/ap/?url=").concat($+"/api/v1")):g.map($=>"https://".concat($,"/api/v1"));try{return await Y4({referenceList:b,asyncMapHandler:Vt=>async function(zt,_e,_r,_o){const ga=Date.now(),_a={sid:_r.sid,opid:10,appid:_r.appId,string_uid:_e};try{const _c=await z0(zt+"".concat(zt.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_a,cancelToken:_o,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(_c.code!==0){const tE=zO(_c.code);throw new EE(rE.UNEXPECTED_RESPONSE,"preload sua error:".concat(tE.desc),tE)}if(_c.uid<=0||_c.uid>=Math.pow(2,32))throw new EE(rE.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:ga,url:zt,req:_a,uid:_c.uid,elapse:Date.now()-ga}}catch(_c){throw _c}}(Vt,o,s,d),closeFn:Vt=>Vt.code===rE.OPERATION_ABORTED||Vt.code===rE.UNEXPECTED_RESPONSE&&!Vt.data.retry})}catch($){throw $}}async function hut(o,s,d){const g=cE("CDS_AP").slice(0,cE("AJAX_REQUEST_CONCURRENT")).map(_e=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(_e+"/api/v1"):"https://".concat(_e,"/api/v1?action=config")),b=g.map(_e=>function(_r,_o,ga,_a){const _c=O_(),tE={flag:64,cipher_method:0,features:{device:_c.name,system:_c.os,system_general:navigator.userAgent,vendor:_o.appId,version:i0,cname:_o.cname,sid:_o.sid,session_id:_o.sid,detail:"",proxyServer:_o.proxyServer}};return W0(()=>z0(_r,{data:tE,timeout:1e3,cancelToken:ga,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,_p=>_p.code!==rE.OPERATION_ABORTED,_a)}(_e,o,s,d));let $=null,Vt=null,zt={};try{$=await JO(b)}catch(_e){if(_e.code===rE.OPERATION_ABORTED)throw _e;Vt=_e}if(b.forEach(_e=>_e.cancel()),t_.reportApiInvoke(o.sid,{name:NS.REQUEST_CONFIG_DISTRIBUTE,options:{error:Vt,res:$}}).onSuccess(),$&&$.test_tags)try{zt=function(_e){if(!_e.test_tags)return{};const _r=_e.test_tags,_o=Object.keys(_r),ga={};return _o.forEach(_a=>{var _c;const tE=dT(_c=_a.slice(4)).call(_c),_p=JSON.parse(_r[_a])[1];ga[tE]=_p}),ga}($)}catch{}return zt}async function Q4(o,s){const d=cE("WEBCS_DOMAIN").concat(cE("WEBCS_DOMAIN_BACKUP_LIST")).map(g=>({url:"https://".concat(g,"/api/v2/transpond/webrtc?v=2"),areaCode:hP(),serviceIds:[wS.CHOOSE_SERVER,wS.CLOUD_PROXY_FALLBACK]}));try{return await Y4({referenceList:d,asyncMapHandler:b=>async function($,Vt,zt){let _e,{url:_r,areaCode:_o,serviceIds:ga}=$;const _a=Date.now(),[_c,tE]=tF(Vt,_o,ga);let _p=pS.networkState;try{_p&&pS.networkState===gT.OFFLINE&&pS.onlineWaiter&&await GE.race([pS.onlineWaiter,WS(CS.maxRetryTimeout)]),_p=pS.networkState;const{data:_f,headers:eE}=await z0(_r,{data:_c,cancelToken:zt,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_e=eE.http3==="1"?1:-1,(_E=>{const SE=[];if(_E.response_body.forEach(wE=>{const NE=wE.buffer.code;if(wE.uri===23&&NE===0&&!wE.buffer.edges_services)if(wE.buffer.flag===4194310)wE.buffer.edges_services=[];else{const DE={error:new EE(rE.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_E.detail[502]}),flag:wE.buffer.flag};SE.push(DE)}if(NE!==0){const DE=zO(NE),JE={error:new EE(rE.CAN_NOT_GET_GATEWAY_SERVER,DE.desc,{desc:DE.desc,retry:DE.retry,csIp:_E.detail[502]}),flag:wE.buffer.flag};wE.buffer.flag===4194310?_l.warning(JE.error.toString()):SE.push(JE)}}),SE.length)throw new EE(rE.CAN_NOT_GET_GATEWAY_SERVER,SE.map(wE=>"flag: ".concat(wE.flag,", message: ").concat(wE.error.message)).join(" | "),{retry:!!SE.find(wE=>wE.error.data.retry),csIp:_E.detail[502],desc:[...new Set(SE.map(wE=>{var NE;return wE==null||(NE=wE.error)===null||NE===void 0||(NE=NE.data)===null||NE===void 0?void 0:NE.desc}).filter(wE=>!!wE))]})})(_f);const fE=dP(_f,wS.CHOOSE_SERVER),mE=dP(_f,wS.CLOUD_PROXY_FALLBACK);return $V(fE),{gatewayInfo:qV(fE,_r),proxyInfo:mE,opid:tE,requestTime:_a,url:_r,isHttp3:_e,elapse:Date.now()-_a}}catch(_f){throw _f}}(b,o,s),closeFn:b=>b.code===rE.OPERATION_ABORTED||b.code===rE.CAN_NOT_GET_GATEWAY_SERVER&&!b.data.retry})}catch(g){throw g}}async function Z4(o,s,d,g){const b=cE("PROXY_SERVER_TYPE3"),$=(_c,tE,_p)=>{let _f=_p||b;return Array.isArray(_f)&&(_f=tE%2==0?b[1]:b[0]),"https://".concat(_f,"/ap/?url=").concat(_c)};let Vt=null;const zt=[],_e=async()=>{const _c=cE("WEBCS_DOMAIN").slice(0,cE("AJAX_REQUEST_CONCURRENT")).map((_f,eE)=>{let iE;return iE=o.cloudProxyServer==="disabled"&&o.proxyServer?$("".concat(_f,"/api/v2/transpond/webrtc?v=2"),eE,o.proxyServer):o.cloudProxyServer==="disabled"||o.cloudProxyServer==="fallback"?"https://".concat(_f,"/api/v2/transpond/webrtc?v=2"):$("".concat(_f,"/api/v2/transpond/webrtc?v=2"),eE),{url:iE,areaCode:hP(),serviceIds:[wS.CHOOSE_SERVER,o.cloudProxyServer==="proxy5"?wS.CLOUD_PROXY_5:o.cloudProxyServer==="proxy3"||o.cloudProxyServer==="proxy4"?wS.CLOUD_PROXY:wS.CLOUD_PROXY_FALLBACK]}}),tE=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:_c.map(_f=>_f.url)}),_p=await pP({fragementLength:cE("FRAGEMENT_LENGTH"),referenceList:_c,asyncMapHandler:_f=>(_l.debug("[".concat(o.clientId,"] Connect to choose_server:"),_f.url),K4(_f,o,s,d)),allFailedhandler:_f=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_f},tE),_f[0]},promisesCollector:zt});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},tE),_p},_r=async()=>{if(await WS(1e3),Vt!==null)return Vt;const _c=cE("WEBCS_DOMAIN_BACKUP_LIST").map((_f,eE)=>{let iE;return iE=o.cloudProxyServer==="disabled"&&o.proxyServer?$("".concat(_f,"/api/v2/transpond/webrtc?v=2"),eE,o.proxyServer):o.cloudProxyServer==="disabled"||o.cloudProxyServer==="fallback"?"https://".concat(_f,"/api/v2/transpond/webrtc?v=2"):$("".concat(_f,"/api/v2/transpond/webrtc?v=2"),eE),{url:iE,areaCode:hP(),serviceIds:[wS.CHOOSE_SERVER,o.cloudProxyServer==="proxy5"?wS.CLOUD_PROXY_5:o.cloudProxyServer==="proxy3"||o.cloudProxyServer==="proxy4"?wS.CLOUD_PROXY:wS.CLOUD_PROXY_FALLBACK]}}),tE=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:_c.map(_f=>_f.url)}),_p=await pP({fragementLength:cE("FRAGEMENT_LENGTH"),referenceList:_c,asyncMapHandler:_f=>(_l.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),_f.url),K4(_f,o,s,d)),allFailedhandler:_f=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_f},tE),_f[0]},promisesCollector:zt});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},tE),_p};let _o,ga,_a;try{({gatewayInfo:_o,proxyInfo:ga,url:_a}=await JO([_e(),_r()]))}catch(_c){throw _c[0]}if(zt.length&&zt.forEach(_c=>_c.cancel&&typeof _c.cancel=="function"&&_c.cancel()),!_o||!ga)throw new EE(rE.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(o.apUrl=_a,o.cloudProxyServer!=="disabled"&&Array.isArray(b)&&_a){const _c=/^https?:\/\/(.+?)(\/.*)?$/.exec(_a)[1];KE(b).call(b,_c)&&(o.proxyServer=_c,_l.setProxyServer(_c),t_.setProxyServer(_c))}return Vt={gatewayInfo:_o,proxyInfo:await U4(ga,_o.uid)},Vt}async function $4(o,s,d,g){const b=cE("UAP_AP").slice(0,cE("AJAX_REQUEST_CONCURRENT")).map($=>s.proxyServer?"https://".concat(s.proxyServer,"/ap/?url=").concat($+"/api/v1?action=uap"):"https://".concat($,"/api/v1?action=uap"));return await cut(b,o,s,d,g)}async function put(o,s,d){const g=cE("UAP_AP").slice(0,cE("AJAX_REQUEST_CONCURRENT")).map($=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat($+"/api/v1?action=uap"):"https://".concat($,"/api/v1?action=uap")),b=g.map($=>function(Vt,zt,_e,_r){const _o={command:"convergeAllocateEdge",sid:zt.sid,appId:zt.appId,token:zt.token,ts:Date.now(),version:i0,cname:zt.cname,uid:zt.uid.toString(),requestId:ZV,seq:ZV};ZV+=1;const ga={service_name:"tele_channel",json_body:JSON.stringify(_o)};return W0(async()=>{const _a=await z0(Vt,{data:ga,cancelToken:_e,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(_a.code!==0){const tE=new EE(rE.UNEXPECTED_RESPONSE,"cross channel ap error, code"+_a.code,{retry:!0});throw _l.error(tE.toString()),tE}const _c=JSON.parse(_a.json_body);if(_c.code!==200){const tE=new EE(rE.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(_c.code,", reason: ").concat(_c.reason));throw _l.error(tE.toString()),tE}if(!_c.servers||_c.servers.length===0){const tE=new EE(rE.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw _l.error(tE.toString()),tE}return{vid:_c.vid,workerToken:_c.workerToken,addressList:(cE("CHANNEL_MEDIA_RELAY_SERVERS")||_c.servers).map(tE=>"wss://".concat(tE.address.replace(/\./g,"-"),".").concat(cE("WORKER_DOMAIN"),":").concat(tE.wss))}},void 0,_a=>!!(_a.code!==rE.OPERATION_ABORTED&&_a.code!==rE.UNEXPECTED_RESPONSE||_a.data&&_a.data.retry),_r)}($,o,s,d));try{const $=await JO(b);return b.forEach(Vt=>Vt.cancel()),$}catch($){throw $[0]}}async function fut(o,s,d){let g=null;const b=[],$=async Vt=>{const zt=cE(Vt?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_e=>o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(_e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_e,"/api/v2/transpond/webrtc?v=2"));return Vt&&(await WS(1e3),g!==null)?g:await pP({fragementLength:cE("FRAGEMENT_LENGTH"),referenceList:zt,asyncMapHandler:_e=>(_l.debug("[".concat(o.clientId,"] update ticket, Connect to ").concat(Vt?"backup":""," choose_server:"),_e),function(_r,_o,ga,_a){const[_c]=lut(_o,[wS.CHOOSE_SERVER]);let tE=pS.networkState;return W0(async()=>{tE&&pS.networkState===gT.OFFLINE&&pS.onlineWaiter&&await GE.race([pS.onlineWaiter,WS(_a&&_a.maxRetryTimeout||CS.maxRetryTimeout)]),tE=pS.networkState;const _p=await z0(_r,{data:_c,cancelToken:ga,headers:{"Content-Type":"multipart/form-data;"}},!0);return uut(_p,_r)},()=>!1,_p=>_p.code!==rE.OPERATION_ABORTED&&(_p.code===rE.UPDATE_TICKET_FAILED?_p.data.retry:(_l.warning("[".concat(_o.clientId,"] update ticket network error, retry"),_p),!0)),_a)}(_e,o,s,d)),allFailedhandler:_e=>{throw _e[0]},promisesCollector:b})};try{return g=await JO([$(!1),$(!0)]),b.length&&b.forEach(Vt=>Vt.cancel&&typeof Vt.cancel=="function"&&Vt.cancel()),g}catch(Vt){throw Vt[0]}}function tK(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function eK(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?tK(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):tK(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}class mut extends nS{get isSuccess(){return!!this.configs}constructor(){super(),Qm(this,"configs",void 0),Qm(this,"joinInfo",void 0),Qm(this,"cancelToken",void 0),Qm(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Qm(this,"interval",void 0),Qm(this,"mutex",new KS("config-distribute")),Qm(this,"mutableParamsRead",!1)}startGetConfigDistribute(s,d){this.joinInfo=s,this.cancelToken=d,this.interval&&this.stopGetConfigDistribute(),cE("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},cE("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,t_.reportApiInvoke(null,{options:void 0,name:NS.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:hS.TRACER}).onSuccess(JSON.stringify(rI))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void _l.debug("[config-distribute] get config distribute interrupted have no joininfo");let s;const d=await this.mutex.lock();try{s=await hut(this.joinInfo,this.cancelToken,this.retryConfig),_l.debug("[config-distribute] get config distribute",JSON.stringify(s)),s.limit_bitrate&&this.handleBitrateLimit(s.limit_bitrate),this.cacheGlobalParameterConfig(s),this.configs=s}catch(g){const b=new EE(rE.NETWORK_RESPONSE_ERROR,g);_l.warning("[config-distribute] ".concat(b.toString()))}finally{d()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(s){var d;(d=s)&&d.uplink&&d.id&&d.uplink.max_bitrate!==void 0&&d.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==s.id&&this.emit(GV.UPDATE_BITRATE_LIMIT,s):this.emit(GV.UPDATE_BITRATE_LIMIT,s))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&eK({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(s){var d;const g=GN(d=Object.keys(s).filter($=>/^webrtc_ng_global_parameter/.test($))).call(d);for(let $=0;$<g.length;$++)for(let Vt=g.length-1;Vt>$;Vt--){const zt=g[Vt];if(typeof s[zt].__priority=="number"){const _e=s[zt].__priority,_r=g[Vt-1];if(typeof s[_r].__priority=="number"){if(!(_e>s[_r].__priority))continue;{const _o=zt;g[Vt]=g[Vt-1],g[Vt-1]=_o}}else{const _o=zt;g[Vt]=g[Vt-1],g[Vt-1]=_o}}}const b={};g.forEach($=>{const Vt=s[$],zt=Vt.__expires;Object.keys(Vt).forEach(_e=>{_e==="__priority"||_e==="__expires"||Object.prototype.hasOwnProperty.call(b,_e)||(b[_e]=eK({value:Vt[_e]},zt&&{expires:zt}))})});try{(function(zt){try{const _e=Date.now();Object.keys(zt).forEach(_r=>{switch(_r){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(xS,_r)){const{value:_o,expires:ga}=zt[_r];if(ga&&ga<=_e)return;rI[_r]=_o,xS[_r]=_o,_l.debug("Update global parameters from config distribute",_r,_o)}}})}catch(_e){_l.error("Error update config immediately: ".concat(zt),_e.message)}})(b);const $=JSON.stringify(b),Vt=window.btoa($);window.localStorage.setItem("websdk_ng_global_parameter",Vt),_l.debug("Caching global parameters ".concat($))}catch($){_l.error("Error caching global parameters:",$.message)}}}var R0,Eut=j(S4),nK=OE,gut=_h,_ut=jE,vut=_t,nF=a1,yut=kN,Sut=LE,Tut=rR,but=nR,XO=Object.assign,rK=Object.defineProperty,Rut=gut([].concat),Cut=!XO||vut(function(){if(nK&&XO({b:1},XO(rK({},"a",{enumerable:!0,get:function(){rK(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var o={},s={},d=Symbol(),g="abcdefghijklmnopqrst";return o[d]=7,g.split("").forEach(function(b){s[b]=b}),XO({},o)[d]!=7||nF(XO({},s)).join("")!=g})?function(o,s){for(var d=Tut(o),g=arguments.length,b=1,$=yut.f,Vt=Sut.f;g>b;)for(var zt,_e=but(arguments[b++]),_r=$?Rut(nF(_e),$(_e)):nF(_e),_o=_r.length,ga=0;_o>ga;)zt=_r[ga++],nK&&!_ut(Vt,_e,zt)||(d[zt]=_e[zt]);return d}:XO,wut=AT,Iut=M6,Out=KR,Aut=jE,Nut=rR,kut=function(o,s,d,g){try{return g?s(wut(d)[0],d[1]):s(d)}catch(b){Iut(o,"throw",b)}},Put=P6,Dut=v1,Lut=IR,iK=P1,Mut=bM,xut=l1,oK=Array,zI=_h,rF=2147483647,Uut=/[^\0-\u007E]/,sK=/[.\u3002\uFF0E\uFF61]/g,aK="Overflow: input needs wider integers to process",cK=RangeError,jut=zI(sK.exec),QO=Math.floor,iF=String.fromCharCode,uK=zI("".charCodeAt),lK=zI([].join),uI=zI([].push),Vut=zI("".replace),Fut=zI("".split),But=zI("".toLowerCase),dK=function(o){return o+22+75*(o<26)},Gut=function(o,s,d){var g=0;for(o=d?QO(o/700):o>>1,o+=QO(o/s);o>455;)o=QO(o/35),g+=36;return QO(g+36*o/(o+38))},Wut=function(o){var s=[];o=function(eE){for(var iE=[],fE=0,mE=eE.length;fE<mE;){var _E=uK(eE,fE++);if(_E>=55296&&_E<=56319&&fE<mE){var SE=uK(eE,fE++);(64512&SE)==56320?uI(iE,((1023&_E)<<10)+(1023&SE)+65536):(uI(iE,_E),fE--)}else uI(iE,_E)}return iE}(o);var d,g,b=o.length,$=128,Vt=0,zt=72;for(d=0;d<o.length;d++)(g=o[d])<128&&uI(s,iF(g));var _e=s.length,_r=_e;for(_e&&uI(s,"-");_r<b;){var _o=rF;for(d=0;d<o.length;d++)(g=o[d])>=$&&g<_o&&(_o=g);var ga=_r+1;if(_o-$>QO((rF-Vt)/ga))throw cK(aK);for(Vt+=(_o-$)*ga,$=_o,d=0;d<o.length;d++){if((g=o[d])<$&&++Vt>rF)throw cK(aK);if(g==$){for(var _a=Vt,_c=36;;){var tE=_c<=zt?1:_c>=zt+26?26:_c-zt;if(_a<tE)break;var _p=_a-tE,_f=36-tE;uI(s,iF(dK(tE+_p%_f))),_a=QO(_p/_f),_c+=36}uI(s,iF(dK(_a))),zt=Gut(Vt,ga,_r==_e),Vt=0,_r++}}Vt++,$++}return lK(s,"")},qut=X_,oF=OE,Hut=XU,sF=aE,hK=KR,C0=_h,BD=YR,w0=_1,Kut=xM,aF=iT,cF=Cut,ZO=function(o){var s=Nut(o),d=Dut(this),g=arguments.length,b=g>1?arguments[1]:void 0,$=b!==void 0;$&&(b=Out(b,g>2?arguments[2]:void 0));var Vt,zt,_e,_r,_o,ga,_a=xut(s),_c=0;if(!_a||this===oK&&Put(_a))for(Vt=Lut(s),zt=d?new this(Vt):oK(Vt);Vt>_c;_c++)ga=$?b(s[_c],_c):s[_c],iK(zt,_c,ga);else for(_o=(_r=Mut(s,_a)).next,zt=d?new this:[];!(_e=Aut(_o,_r)).done;_c++)ga=$?kut(_r,b,[_e.value,_c],!0):_e.value,iK(zt,_c,ga);return zt.length=_c,zt},Y0=RU,zut=hU.codeAt,Yut=function(o){var s,d,g=[],b=Fut(Vut(But(o),sK,"."),".");for(s=0;s<b.length;s++)d=b[s],uI(g,jut(Uut,d)?"xn--"+Wut(d):d);return lK(g,".")},MR=n0,Jut=JR,Xut=y1,pK=eat,fK=PI,Qut=fK.set,GD=fK.getterFor("URL"),Zut=pK.URLSearchParams,$ut=pK.getState,fP=sF.URL,uF=sF.TypeError,WD=sF.parseInt,tlt=Math.floor,mK=Math.pow,I0=C0("".charAt),J0=C0(/./.exec),mP=C0([].join),elt=C0(1 .toString),nlt=C0([].pop),$O=C0([].push),lF=C0("".replace),rlt=C0([].shift),ilt=C0("".split),EP=C0("".slice),HD=C0("".toLowerCase),olt=C0([].unshift),dF="Invalid scheme",YI="Invalid host",EK="Invalid port",gK=/[a-z]/i,slt=/[\d+-.a-z]/i,hF=/\d/,alt=/^0x/i,clt=/^[0-7]+$/,ult=/^\d+$/,_K=/^[\da-f]+$/i,llt=/[\0\t\n\r #%/:<>?@[\\\]^|]/,dlt=/[\0\t\n\r #/:<>?@[\\\]^|]/,hlt=/^[\u0000-\u0020]+/,plt=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,flt=/[\t\n\r]/g,gP=function(o){var s,d,g,b;if(typeof o=="number"){for(s=[],d=0;d<4;d++)olt(s,o%256),o=tlt(o/256);return mP(s,".")}if(typeof o=="object"){for(s="",g=function($){for(var Vt=null,zt=1,_e=null,_r=0,_o=0;_o<8;_o++)$[_o]!==0?(_r>zt&&(Vt=_e,zt=_r),_e=null,_r=0):(_e===null&&(_e=_o),++_r);return _r>zt&&(Vt=_e,zt=_r),Vt}(o),d=0;d<8;d++)b&&o[d]===0||(b&&(b=!1),g===d?(s+=d?":":"::",b=!0):(s+=elt(o[d],16),d<7&&(s+=":")));return"["+s+"]"}return o},KD={},vK=cF({},KD,{" ":1,'"':1,"<":1,">":1,"`":1}),yK=cF({},vK,{"#":1,"?":1,"{":1,"}":1}),pF=cF({},yK,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),lI=function(o,s){var d=zut(o,0);return d>32&&d<127&&!aF(s,o)?o:encodeURIComponent(o)},zD={ftp:21,file:null,http:80,https:443,ws:80,wss:443},_P=function(o,s){var d;return o.length==2&&J0(gK,I0(o,0))&&((d=I0(o,1))==":"||!s&&d=="|")},SK=function(o){var s;return o.length>1&&_P(EP(o,0,2))&&(o.length==2||(s=I0(o,2))==="/"||s==="\\"||s==="?"||s==="#")},mlt=function(o){return o==="."||HD(o)==="%2e"},fF={},TK={},mF={},bK={},RK={},EF={},CK={},wK={},YD={},JD={},gF={},_F={},vF={},yF={},IK={},SF={},_A={},fR={},OK={},JI={},xR={},TF=function(o,s,d){var g,b,$,Vt=MR(o);if(s){if(b=this.parse(Vt))throw uF(b);this.searchParams=null}else{if(d!==void 0&&(g=new TF(d,!0)),b=this.parse(Vt,null,g))throw uF(b);($=$ut(new Zut)).bindURL(this),this.searchParams=$}};TF.prototype={type:"URL",parse:function(o,s,d){var g,b,$,Vt,zt,_e=this,_r=s||fF,_o=0,ga="",_a=!1,_c=!1,tE=!1;for(o=MR(o),s||(_e.scheme="",_e.username="",_e.password="",_e.host=null,_e.port=null,_e.path=[],_e.query=null,_e.fragment=null,_e.cannotBeABaseURL=!1,o=lF(o,hlt,""),o=lF(o,plt,"$1")),o=lF(o,flt,""),g=ZO(o);_o<=g.length;){switch(b=g[_o],_r){case fF:if(!b||!J0(gK,b)){if(s)return dF;_r=mF;continue}ga+=HD(b),_r=TK;break;case TK:if(b&&(J0(slt,b)||b=="+"||b=="-"||b=="."))ga+=HD(b);else{if(b!=":"){if(s)return dF;ga="",_r=mF,_o=0;continue}if(s&&(_e.isSpecial()!=aF(zD,ga)||ga=="file"&&(_e.includesCredentials()||_e.port!==null)||_e.scheme=="file"&&!_e.host))return;if(_e.scheme=ga,s)return void(_e.isSpecial()&&zD[_e.scheme]==_e.port&&(_e.port=null));ga="",_e.scheme=="file"?_r=yF:_e.isSpecial()&&d&&d.scheme==_e.scheme?_r=bK:_e.isSpecial()?_r=wK:g[_o+1]=="/"?(_r=RK,_o++):(_e.cannotBeABaseURL=!0,$O(_e.path,""),_r=OK)}break;case mF:if(!d||d.cannotBeABaseURL&&b!="#")return dF;if(d.cannotBeABaseURL&&b=="#"){_e.scheme=d.scheme,_e.path=Y0(d.path),_e.query=d.query,_e.fragment="",_e.cannotBeABaseURL=!0,_r=xR;break}_r=d.scheme=="file"?yF:EF;continue;case bK:if(b!="/"||g[_o+1]!="/"){_r=EF;continue}_r=YD,_o++;break;case RK:if(b=="/"){_r=JD;break}_r=fR;continue;case EF:if(_e.scheme=d.scheme,b==R0)_e.username=d.username,_e.password=d.password,_e.host=d.host,_e.port=d.port,_e.path=Y0(d.path),_e.query=d.query;else if(b=="/"||b=="\\"&&_e.isSpecial())_r=CK;else if(b=="?")_e.username=d.username,_e.password=d.password,_e.host=d.host,_e.port=d.port,_e.path=Y0(d.path),_e.query="",_r=JI;else{if(b!="#"){_e.username=d.username,_e.password=d.password,_e.host=d.host,_e.port=d.port,_e.path=Y0(d.path),_e.path.length--,_r=fR;continue}_e.username=d.username,_e.password=d.password,_e.host=d.host,_e.port=d.port,_e.path=Y0(d.path),_e.query=d.query,_e.fragment="",_r=xR}break;case CK:if(!_e.isSpecial()||b!="/"&&b!="\\"){if(b!="/"){_e.username=d.username,_e.password=d.password,_e.host=d.host,_e.port=d.port,_r=fR;continue}_r=JD}else _r=YD;break;case wK:if(_r=YD,b!="/"||I0(ga,_o+1)!="/")continue;_o++;break;case YD:if(b!="/"&&b!="\\"){_r=JD;continue}break;case JD:if(b=="@"){_a&&(ga="%40"+ga),_a=!0,$=ZO(ga);for(var _p=0;_p<$.length;_p++){var _f=$[_p];if(_f!=":"||tE){var eE=lI(_f,pF);tE?_e.password+=eE:_e.username+=eE}else tE=!0}ga=""}else if(b==R0||b=="/"||b=="?"||b=="#"||b=="\\"&&_e.isSpecial()){if(_a&&ga=="")return"Invalid authority";_o-=ZO(ga).length+1,ga="",_r=gF}else ga+=b;break;case gF:case _F:if(s&&_e.scheme=="file"){_r=SF;continue}if(b!=":"||_c){if(b==R0||b=="/"||b=="?"||b=="#"||b=="\\"&&_e.isSpecial()){if(_e.isSpecial()&&ga=="")return YI;if(s&&ga==""&&(_e.includesCredentials()||_e.port!==null))return;if(Vt=_e.parseHost(ga))return Vt;if(ga="",_r=_A,s)return;continue}b=="["?_c=!0:b=="]"&&(_c=!1),ga+=b}else{if(ga=="")return YI;if(Vt=_e.parseHost(ga))return Vt;if(ga="",_r=vF,s==_F)return}break;case vF:if(!J0(hF,b)){if(b==R0||b=="/"||b=="?"||b=="#"||b=="\\"&&_e.isSpecial()||s){if(ga!=""){var iE=WD(ga,10);if(iE>65535)return EK;_e.port=_e.isSpecial()&&iE===zD[_e.scheme]?null:iE,ga=""}if(s)return;_r=_A;continue}return EK}ga+=b;break;case yF:if(_e.scheme="file",b=="/"||b=="\\")_r=IK;else{if(!d||d.scheme!="file"){_r=fR;continue}if(b==R0)_e.host=d.host,_e.path=Y0(d.path),_e.query=d.query;else if(b=="?")_e.host=d.host,_e.path=Y0(d.path),_e.query="",_r=JI;else{if(b!="#"){SK(mP(Y0(g,_o),""))||(_e.host=d.host,_e.path=Y0(d.path),_e.shortenPath()),_r=fR;continue}_e.host=d.host,_e.path=Y0(d.path),_e.query=d.query,_e.fragment="",_r=xR}}break;case IK:if(b=="/"||b=="\\"){_r=SF;break}d&&d.scheme=="file"&&!SK(mP(Y0(g,_o),""))&&(_P(d.path[0],!0)?$O(_e.path,d.path[0]):_e.host=d.host),_r=fR;continue;case SF:if(b==R0||b=="/"||b=="\\"||b=="?"||b=="#"){if(!s&&_P(ga))_r=fR;else if(ga==""){if(_e.host="",s)return;_r=_A}else{if(Vt=_e.parseHost(ga))return Vt;if(_e.host=="localhost"&&(_e.host=""),s)return;ga="",_r=_A}continue}ga+=b;break;case _A:if(_e.isSpecial()){if(_r=fR,b!="/"&&b!="\\")continue}else if(s||b!="?")if(s||b!="#"){if(b!=R0&&(_r=fR,b!="/"))continue}else _e.fragment="",_r=xR;else _e.query="",_r=JI;break;case fR:if(b==R0||b=="/"||b=="\\"&&_e.isSpecial()||!s&&(b=="?"||b=="#")){if((zt=HD(zt=ga))===".."||zt==="%2e."||zt===".%2e"||zt==="%2e%2e"?(_e.shortenPath(),b=="/"||b=="\\"&&_e.isSpecial()||$O(_e.path,"")):mlt(ga)?b=="/"||b=="\\"&&_e.isSpecial()||$O(_e.path,""):(_e.scheme=="file"&&!_e.path.length&&_P(ga)&&(_e.host&&(_e.host=""),ga=I0(ga,0)+":"),$O(_e.path,ga)),ga="",_e.scheme=="file"&&(b==R0||b=="?"||b=="#"))for(;_e.path.length>1&&_e.path[0]==="";)rlt(_e.path);b=="?"?(_e.query="",_r=JI):b=="#"&&(_e.fragment="",_r=xR)}else ga+=lI(b,yK);break;case OK:b=="?"?(_e.query="",_r=JI):b=="#"?(_e.fragment="",_r=xR):b!=R0&&(_e.path[0]+=lI(b,KD));break;case JI:s||b!="#"?b!=R0&&(b=="'"&&_e.isSpecial()?_e.query+="%27":_e.query+=b=="#"?"%23":lI(b,KD)):(_e.fragment="",_r=xR);break;case xR:b!=R0&&(_e.fragment+=lI(b,vK))}_o++}},parseHost:function(o){var s,d,g;if(I0(o,0)=="["){if(I0(o,o.length-1)!="]"||(s=function(b){var $,Vt,zt,_e,_r,_o,ga,_a=[0,0,0,0,0,0,0,0],_c=0,tE=null,_p=0,_f=function(){return I0(b,_p)};if(_f()==":"){if(I0(b,1)!=":")return;_p+=2,tE=++_c}for(;_f();){if(_c==8)return;if(_f()!=":"){for($=Vt=0;Vt<4&&J0(_K,_f());)$=16*$+WD(_f(),16),_p++,Vt++;if(_f()=="."){if(Vt==0||(_p-=Vt,_c>6))return;for(zt=0;_f();){if(_e=null,zt>0){if(!(_f()=="."&&zt<4))return;_p++}if(!J0(hF,_f()))return;for(;J0(hF,_f());){if(_r=WD(_f(),10),_e===null)_e=_r;else{if(_e==0)return;_e=10*_e+_r}if(_e>255)return;_p++}_a[_c]=256*_a[_c]+_e,++zt!=2&&zt!=4||_c++}if(zt!=4)return;break}if(_f()==":"){if(_p++,!_f())return}else if(_f())return;_a[_c++]=$}else{if(tE!==null)return;_p++,tE=++_c}}if(tE!==null)for(_o=_c-tE,_c=7;_c!=0&&_o>0;)ga=_a[_c],_a[_c--]=_a[tE+_o-1],_a[tE+--_o]=ga;else if(_c!=8)return;return _a}(EP(o,1,-1)),!s))return YI;this.host=s}else if(this.isSpecial()){if(o=Yut(o),J0(llt,o)||(s=function(b){var $,Vt,zt,_e,_r,_o,ga,_a=ilt(b,".");if(_a.length&&_a[_a.length-1]==""&&_a.length--,($=_a.length)>4)return b;for(Vt=[],zt=0;zt<$;zt++){if((_e=_a[zt])=="")return b;if(_r=10,_e.length>1&&I0(_e,0)=="0"&&(_r=J0(alt,_e)?16:8,_e=EP(_e,_r==8?1:2)),_e==="")_o=0;else{if(!J0(_r==10?ult:_r==8?clt:_K,_e))return b;_o=WD(_e,_r)}$O(Vt,_o)}for(zt=0;zt<$;zt++)if(_o=Vt[zt],zt==$-1){if(_o>=mK(256,5-$))return null}else if(_o>255)return null;for(ga=nlt(Vt),zt=0;zt<Vt.length;zt++)ga+=Vt[zt]*mK(256,3-zt);return ga}(o),s===null))return YI;this.host=s}else{if(J0(dlt,o))return YI;for(s="",d=ZO(o),g=0;g<d.length;g++)s+=lI(d[g],KD);this.host=s}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return aF(zD,this.scheme)},shortenPath:function(){var o=this.path,s=o.length;!s||this.scheme=="file"&&s==1&&_P(o[0],!0)||o.length--},serialize:function(){var o=this,s=o.scheme,d=o.username,g=o.password,b=o.host,$=o.port,Vt=o.path,zt=o.query,_e=o.fragment,_r=s+":";return b!==null?(_r+="//",o.includesCredentials()&&(_r+=d+(g?":"+g:"")+"@"),_r+=gP(b),$!==null&&(_r+=":"+$)):s=="file"&&(_r+="//"),_r+=o.cannotBeABaseURL?Vt[0]:Vt.length?"/"+mP(Vt,"/"):"",zt!==null&&(_r+="?"+zt),_e!==null&&(_r+="#"+_e),_r},setHref:function(o){var s=this.parse(o);if(s)throw uF(s);this.searchParams.update()},getOrigin:function(){var o=this.scheme,s=this.port;if(o=="blob")try{return new tN(o.path[0]).origin}catch{return"null"}return o!="file"&&this.isSpecial()?o+"://"+gP(this.host)+(s!==null?":"+s:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(o){this.parse(MR(o)+":",fF)},getUsername:function(){return this.username},setUsername:function(o){var s=ZO(MR(o));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var d=0;d<s.length;d++)this.username+=lI(s[d],pF)}},getPassword:function(){return this.password},setPassword:function(o){var s=ZO(MR(o));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var d=0;d<s.length;d++)this.password+=lI(s[d],pF)}},getHost:function(){var o=this.host,s=this.port;return o===null?"":s===null?gP(o):gP(o)+":"+s},setHost:function(o){this.cannotBeABaseURL||this.parse(o,gF)},getHostname:function(){var o=this.host;return o===null?"":gP(o)},setHostname:function(o){this.cannotBeABaseURL||this.parse(o,_F)},getPort:function(){var o=this.port;return o===null?"":MR(o)},setPort:function(o){this.cannotHaveUsernamePasswordPort()||((o=MR(o))==""?this.port=null:this.parse(o,vF))},getPathname:function(){var o=this.path;return this.cannotBeABaseURL?o[0]:o.length?"/"+mP(o,"/"):""},setPathname:function(o){this.cannotBeABaseURL||(this.path=[],this.parse(o,_A))},getSearch:function(){var o=this.query;return o?"?"+o:""},setSearch:function(o){(o=MR(o))==""?this.query=null:(I0(o,0)=="?"&&(o=EP(o,1)),this.query="",this.parse(o,JI)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var o=this.fragment;return o?"#"+o:""},setHash:function(o){(o=MR(o))!=""?(I0(o,0)=="#"&&(o=EP(o,1)),this.fragment="",this.parse(o,xR)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var tN=function(o){var s=Kut(this,FT),d=Xut(arguments.length,1)>1?arguments[1]:void 0,g=Qut(s,new TF(o,!1,d));oF||(s.href=g.serialize(),s.origin=g.getOrigin(),s.protocol=g.getProtocol(),s.username=g.getUsername(),s.password=g.getPassword(),s.host=g.getHost(),s.hostname=g.getHostname(),s.port=g.getPort(),s.pathname=g.getPathname(),s.search=g.getSearch(),s.searchParams=g.getSearchParams(),s.hash=g.getHash())},FT=tN.prototype,O0=function(o,s){return{get:function(){return GD(this)[o]()},set:s&&function(d){return GD(this)[s](d)},configurable:!0,enumerable:!0}};if(oF&&(w0(FT,"href",O0("serialize","setHref")),w0(FT,"origin",O0("getOrigin")),w0(FT,"protocol",O0("getProtocol","setProtocol")),w0(FT,"username",O0("getUsername","setUsername")),w0(FT,"password",O0("getPassword","setPassword")),w0(FT,"host",O0("getHost","setHost")),w0(FT,"hostname",O0("getHostname","setHostname")),w0(FT,"port",O0("getPort","setPort")),w0(FT,"pathname",O0("getPathname","setPathname")),w0(FT,"search",O0("getSearch","setSearch")),w0(FT,"searchParams",O0("getSearchParams")),w0(FT,"hash",O0("getHash","setHash"))),BD(FT,"toJSON",function(){return GD(this).serialize()},{enumerable:!0}),BD(FT,"toString",function(){return GD(this).serialize()},{enumerable:!0}),fP){var AK=fP.createObjectURL,NK=fP.revokeObjectURL;AK&&BD(tN,"createObjectURL",hK(AK,fP)),NK&&BD(tN,"revokeObjectURL",hK(NK,fP))}Jut(tN,"URL"),qut({global:!0,constructor:!0,forced:!Hut,sham:!oF},{URL:tN});var Elt=X_,glt=_t,_lt=y1,kK=n0,vlt=XU,PK=UT("URL");Elt({target:"URL",stat:!0,forced:!(vlt&&glt(function(){PK.canParse()}))},{canParse:function(o){var s=_lt(arguments.length,1),d=kK(o),g=s<2||arguments[1]===void 0?void 0:kK(arguments[1]);try{return!!new PK(d,g)}catch{return!1}}});var DK=j(V0.URL),ylt=_d,Slt=a8,LK=RegExp.prototype,Tlt=function(o){return o===LK||ylt(LK,o)?Slt(o):o.flags},pT=j(Tlt);function eN(o){let s=o.length;for(;--s>=0;)o[s]=0}const bF=256,MK=286,vP=30,yP=15,RF=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),XD=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),blt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),xK=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),UR=new Array(576);eN(UR);const SP=new Array(60);eN(SP);const TP=new Array(512);eN(TP);const bP=new Array(256);eN(bP);const CF=new Array(29);eN(CF);const QD=new Array(vP);function wF(o,s,d,g,b){this.static_tree=o,this.extra_bits=s,this.extra_base=d,this.elems=g,this.max_length=b,this.has_stree=o&&o.length}let UK,jK,VK;function IF(o,s){this.dyn_tree=o,this.max_code=0,this.stat_desc=s}eN(QD);const FK=o=>o<256?TP[o]:TP[256+(o>>>7)],RP=(o,s)=>{o.pending_buf[o.pending++]=255&s,o.pending_buf[o.pending++]=s>>>8&255},zT=(o,s,d)=>{o.bi_valid>16-d?(o.bi_buf|=s<<o.bi_valid&65535,RP(o,o.bi_buf),o.bi_buf=s>>16-o.bi_valid,o.bi_valid+=d-16):(o.bi_buf|=s<<o.bi_valid&65535,o.bi_valid+=d)},mR=(o,s,d)=>{zT(o,d[2*s],d[2*s+1])},BK=(o,s)=>{let d=0;do d|=1&o,o>>>=1,d<<=1;while(--s>0);return d>>>1},GK=(o,s,d)=>{const g=new Array(16);let b,$,Vt=0;for(b=1;b<=yP;b++)Vt=Vt+d[b-1]<<1,g[b]=Vt;for($=0;$<=s;$++){let zt=o[2*$+1];zt!==0&&(o[2*$]=BK(g[zt]++,zt))}},WK=o=>{let s;for(s=0;s<MK;s++)o.dyn_ltree[2*s]=0;for(s=0;s<vP;s++)o.dyn_dtree[2*s]=0;for(s=0;s<19;s++)o.bl_tree[2*s]=0;o.dyn_ltree[512]=1,o.opt_len=o.static_len=0,o.sym_next=o.matches=0},qK=o=>{o.bi_valid>8?RP(o,o.bi_buf):o.bi_valid>0&&(o.pending_buf[o.pending++]=o.bi_buf),o.bi_buf=0,o.bi_valid=0},HK=(o,s,d,g)=>{const b=2*s,$=2*d;return o[b]<o[$]||o[b]===o[$]&&g[s]<=g[d]},OF=(o,s,d)=>{const g=o.heap[d];let b=d<<1;for(;b<=o.heap_len&&(b<o.heap_len&&HK(s,o.heap[b+1],o.heap[b],o.depth)&&b++,!HK(s,g,o.heap[b],o.depth));)o.heap[d]=o.heap[b],d=b,b<<=1;o.heap[d]=g},KK=(o,s,d)=>{let g,b,$,Vt,zt=0;if(o.sym_next!==0)do g=255&o.pending_buf[o.sym_buf+zt++],g+=(255&o.pending_buf[o.sym_buf+zt++])<<8,b=o.pending_buf[o.sym_buf+zt++],g===0?mR(o,b,s):($=bP[b],mR(o,$+bF+1,s),Vt=RF[$],Vt!==0&&(b-=CF[$],zT(o,b,Vt)),g--,$=FK(g),mR(o,$,d),Vt=XD[$],Vt!==0&&(g-=QD[$],zT(o,g,Vt)));while(zt<o.sym_next);mR(o,256,s)},AF=(o,s)=>{const d=s.dyn_tree,g=s.stat_desc.static_tree,b=s.stat_desc.has_stree,$=s.stat_desc.elems;let Vt,zt,_e,_r=-1;for(o.heap_len=0,o.heap_max=573,Vt=0;Vt<$;Vt++)d[2*Vt]!==0?(o.heap[++o.heap_len]=_r=Vt,o.depth[Vt]=0):d[2*Vt+1]=0;for(;o.heap_len<2;)_e=o.heap[++o.heap_len]=_r<2?++_r:0,d[2*_e]=1,o.depth[_e]=0,o.opt_len--,b&&(o.static_len-=g[2*_e+1]);for(s.max_code=_r,Vt=o.heap_len>>1;Vt>=1;Vt--)OF(o,d,Vt);_e=$;do Vt=o.heap[1],o.heap[1]=o.heap[o.heap_len--],OF(o,d,1),zt=o.heap[1],o.heap[--o.heap_max]=Vt,o.heap[--o.heap_max]=zt,d[2*_e]=d[2*Vt]+d[2*zt],o.depth[_e]=(o.depth[Vt]>=o.depth[zt]?o.depth[Vt]:o.depth[zt])+1,d[2*Vt+1]=d[2*zt+1]=_e,o.heap[1]=_e++,OF(o,d,1);while(o.heap_len>=2);o.heap[--o.heap_max]=o.heap[1],((_o,ga)=>{const _a=ga.dyn_tree,_c=ga.max_code,tE=ga.stat_desc.static_tree,_p=ga.stat_desc.has_stree,_f=ga.stat_desc.extra_bits,eE=ga.stat_desc.extra_base,iE=ga.stat_desc.max_length;let fE,mE,_E,SE,wE,NE,DE=0;for(SE=0;SE<=yP;SE++)_o.bl_count[SE]=0;for(_a[2*_o.heap[_o.heap_max]+1]=0,fE=_o.heap_max+1;fE<573;fE++)mE=_o.heap[fE],SE=_a[2*_a[2*mE+1]+1]+1,SE>iE&&(SE=iE,DE++),_a[2*mE+1]=SE,mE>_c||(_o.bl_count[SE]++,wE=0,mE>=eE&&(wE=_f[mE-eE]),NE=_a[2*mE],_o.opt_len+=NE*(SE+wE),_p&&(_o.static_len+=NE*(tE[2*mE+1]+wE)));if(DE!==0){do{for(SE=iE-1;_o.bl_count[SE]===0;)SE--;_o.bl_count[SE]--,_o.bl_count[SE+1]+=2,_o.bl_count[iE]--,DE-=2}while(DE>0);for(SE=iE;SE!==0;SE--)for(mE=_o.bl_count[SE];mE!==0;)_E=_o.heap[--fE],_E>_c||(_a[2*_E+1]!==SE&&(_o.opt_len+=(SE-_a[2*_E+1])*_a[2*_E],_a[2*_E+1]=SE),mE--)}})(o,s),GK(d,_r,o.bl_count)},zK=(o,s,d)=>{let g,b,$=-1,Vt=s[1],zt=0,_e=7,_r=4;for(Vt===0&&(_e=138,_r=3),s[2*(d+1)+1]=65535,g=0;g<=d;g++)b=Vt,Vt=s[2*(g+1)+1],++zt<_e&&b===Vt||(zt<_r?o.bl_tree[2*b]+=zt:b!==0?(b!==$&&o.bl_tree[2*b]++,o.bl_tree[32]++):zt<=10?o.bl_tree[34]++:o.bl_tree[36]++,zt=0,$=b,Vt===0?(_e=138,_r=3):b===Vt?(_e=6,_r=3):(_e=7,_r=4))},YK=(o,s,d)=>{let g,b,$=-1,Vt=s[1],zt=0,_e=7,_r=4;for(Vt===0&&(_e=138,_r=3),g=0;g<=d;g++)if(b=Vt,Vt=s[2*(g+1)+1],!(++zt<_e&&b===Vt)){if(zt<_r)do mR(o,b,o.bl_tree);while(--zt!=0);else b!==0?(b!==$&&(mR(o,b,o.bl_tree),zt--),mR(o,16,o.bl_tree),zT(o,zt-3,2)):zt<=10?(mR(o,17,o.bl_tree),zT(o,zt-3,3)):(mR(o,18,o.bl_tree),zT(o,zt-11,7));zt=0,$=b,Vt===0?(_e=138,_r=3):b===Vt?(_e=6,_r=3):(_e=7,_r=4)}};let JK=!1;const XK=(o,s,d,g)=>{zT(o,0+(g?1:0),3),qK(o),RP(o,d),RP(o,~d),d&&o.pending_buf.set(o.window.subarray(s,s+d),o.pending),o.pending+=d};var Rlt=o=>{JK||((()=>{let s,d,g,b,$;const Vt=new Array(16);for(g=0,b=0;b<28;b++)for(CF[b]=g,s=0;s<1<<RF[b];s++)bP[g++]=b;for(bP[g-1]=b,$=0,b=0;b<16;b++)for(QD[b]=$,s=0;s<1<<XD[b];s++)TP[$++]=b;for($>>=7;b<vP;b++)for(QD[b]=$<<7,s=0;s<1<<XD[b]-7;s++)TP[256+$++]=b;for(d=0;d<=yP;d++)Vt[d]=0;for(s=0;s<=143;)UR[2*s+1]=8,s++,Vt[8]++;for(;s<=255;)UR[2*s+1]=9,s++,Vt[9]++;for(;s<=279;)UR[2*s+1]=7,s++,Vt[7]++;for(;s<=287;)UR[2*s+1]=8,s++,Vt[8]++;for(GK(UR,287,Vt),s=0;s<vP;s++)SP[2*s+1]=5,SP[2*s]=BK(s,5);UK=new wF(UR,RF,257,MK,yP),jK=new wF(SP,XD,0,vP,yP),VK=new wF(new Array(0),blt,0,19,7)})(),JK=!0),o.l_desc=new IF(o.dyn_ltree,UK),o.d_desc=new IF(o.dyn_dtree,jK),o.bl_desc=new IF(o.bl_tree,VK),o.bi_buf=0,o.bi_valid=0,WK(o)},Clt=(o,s,d,g)=>{let b,$,Vt=0;o.level>0?(o.strm.data_type===2&&(o.strm.data_type=(zt=>{let _e,_r=4093624447;for(_e=0;_e<=31;_e++,_r>>>=1)if(1&_r&&zt.dyn_ltree[2*_e]!==0)return 0;if(zt.dyn_ltree[18]!==0||zt.dyn_ltree[20]!==0||zt.dyn_ltree[26]!==0)return 1;for(_e=32;_e<bF;_e++)if(zt.dyn_ltree[2*_e]!==0)return 1;return 0})(o)),AF(o,o.l_desc),AF(o,o.d_desc),Vt=(zt=>{let _e;for(zK(zt,zt.dyn_ltree,zt.l_desc.max_code),zK(zt,zt.dyn_dtree,zt.d_desc.max_code),AF(zt,zt.bl_desc),_e=18;_e>=3&&zt.bl_tree[2*xK[_e]+1]===0;_e--);return zt.opt_len+=3*(_e+1)+5+5+4,_e})(o),b=o.opt_len+3+7>>>3,$=o.static_len+3+7>>>3,$<=b&&(b=$)):b=$=d+5,d+4<=b&&s!==-1?XK(o,s,d,g):o.strategy===4||$===b?(zT(o,2+(g?1:0),3),KK(o,UR,SP)):(zT(o,4+(g?1:0),3),((zt,_e,_r,_o)=>{let ga;for(zT(zt,_e-257,5),zT(zt,_r-1,5),zT(zt,_o-4,4),ga=0;ga<_o;ga++)zT(zt,zt.bl_tree[2*xK[ga]+1],3);YK(zt,zt.dyn_ltree,_e-1),YK(zt,zt.dyn_dtree,_r-1)})(o,o.l_desc.max_code+1,o.d_desc.max_code+1,Vt+1),KK(o,o.dyn_ltree,o.dyn_dtree)),WK(o),g&&qK(o)},wlt=(o,s,d)=>(o.pending_buf[o.sym_buf+o.sym_next++]=s,o.pending_buf[o.sym_buf+o.sym_next++]=s>>8,o.pending_buf[o.sym_buf+o.sym_next++]=d,s===0?o.dyn_ltree[2*d]++:(o.matches++,s--,o.dyn_ltree[2*(bP[d]+bF+1)]++,o.dyn_dtree[2*FK(s)]++),o.sym_next===o.sym_end),Ilt=o=>{zT(o,2,3),mR(o,256,UR),(s=>{s.bi_valid===16?(RP(s,s.bi_buf),s.bi_buf=0,s.bi_valid=0):s.bi_valid>=8&&(s.pending_buf[s.pending++]=255&s.bi_buf,s.bi_buf>>=8,s.bi_valid-=8)})(o)},Olt={_tr_init:Rlt,_tr_stored_block:XK,_tr_flush_block:Clt,_tr_tally:wlt,_tr_align:Ilt},CP=(o,s,d,g)=>{let b=65535&o|0,$=o>>>16&65535|0,Vt=0;for(;d!==0;){Vt=d>2e3?2e3:d,d-=Vt;do b=b+s[g++]|0,$=$+b|0;while(--Vt);b%=65521,$%=65521}return b|$<<16|0};const Alt=new Uint32Array((()=>{let o,s=[];for(var d=0;d<256;d++){o=d;for(var g=0;g<8;g++)o=1&o?3988292384^o>>>1:o>>>1;s[d]=o}return s})());var ST=(o,s,d,g)=>{const b=Alt,$=g+d;o^=-1;for(let Vt=g;Vt<$;Vt++)o=o>>>8^b[255&(o^s[Vt])];return-1^o},XI={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},nN={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Nlt,_tr_stored_block:NF,_tr_flush_block:klt,_tr_tally:dI,_tr_align:Plt}=Olt,{Z_NO_FLUSH:hI,Z_PARTIAL_FLUSH:Dlt,Z_FULL_FLUSH:Llt,Z_FINISH:A0,Z_BLOCK:QK,Z_OK:CT,Z_STREAM_END:ZK,Z_STREAM_ERROR:ER,Z_DATA_ERROR:Mlt,Z_BUF_ERROR:kF,Z_DEFAULT_COMPRESSION:xlt,Z_FILTERED:Ult,Z_HUFFMAN_ONLY:ZD,Z_RLE:jlt,Z_FIXED:Vlt,Z_DEFAULT_STRATEGY:Flt,Z_UNKNOWN:Blt,Z_DEFLATED:$D}=nN,PF=286,Glt=30,Wlt=19,qlt=2*PF+1,Hlt=15,QI=258,gR=262,rN=42,ZI=113,wP=666,$I=(o,s)=>(o.msg=XI[s],s),$K=o=>2*o-(o>4?9:0),pI=o=>{let s=o.length;for(;--s>=0;)o[s]=0},Klt=o=>{let s,d,g,b=o.w_size;s=o.hash_size,g=s;do d=o.head[--g],o.head[g]=d>=b?d-b:0;while(--s);s=b,g=s;do d=o.prev[--g],o.prev[g]=d>=b?d-b:0;while(--s)};let fI=(o,s,d)=>(s<<o.hash_shift^d)&o.hash_mask;const a0=o=>{const s=o.state;let d=s.pending;d>o.avail_out&&(d=o.avail_out),d!==0&&(o.output.set(s.pending_buf.subarray(s.pending_out,s.pending_out+d),o.next_out),o.next_out+=d,s.pending_out+=d,o.total_out+=d,o.avail_out-=d,s.pending-=d,s.pending===0&&(s.pending_out=0))},c0=(o,s)=>{klt(o,o.block_start>=0?o.block_start:-1,o.strstart-o.block_start,s),o.block_start=o.strstart,a0(o.strm)},ES=(o,s)=>{o.pending_buf[o.pending++]=s},IP=(o,s)=>{o.pending_buf[o.pending++]=s>>>8&255,o.pending_buf[o.pending++]=255&s},DF=(o,s,d,g)=>{let b=o.avail_in;return b>g&&(b=g),b===0?0:(o.avail_in-=b,s.set(o.input.subarray(o.next_in,o.next_in+b),d),o.state.wrap===1?o.adler=CP(o.adler,s,b,d):o.state.wrap===2&&(o.adler=ST(o.adler,s,b,d)),o.next_in+=b,o.total_in+=b,b)},_z=(o,s)=>{let d,g,b=o.max_chain_length,$=o.strstart,Vt=o.prev_length,zt=o.nice_match;const _e=o.strstart>o.w_size-gR?o.strstart-(o.w_size-gR):0,_r=o.window,_o=o.w_mask,ga=o.prev,_a=o.strstart+QI;let _c=_r[$+Vt-1],tE=_r[$+Vt];o.prev_length>=o.good_match&&(b>>=2),zt>o.lookahead&&(zt=o.lookahead);do if(d=s,_r[d+Vt]===tE&&_r[d+Vt-1]===_c&&_r[d]===_r[$]&&_r[++d]===_r[$+1]){$+=2,d++;do;while(_r[++$]===_r[++d]&&_r[++$]===_r[++d]&&_r[++$]===_r[++d]&&_r[++$]===_r[++d]&&_r[++$]===_r[++d]&&_r[++$]===_r[++d]&&_r[++$]===_r[++d]&&_r[++$]===_r[++d]&&$<_a);if(g=QI-(_a-$),$=_a-QI,g>Vt){if(o.match_start=s,Vt=g,g>=zt)break;_c=_r[$+Vt-1],tE=_r[$+Vt]}}while((s=ga[s&_o])>_e&&--b!=0);return Vt<=o.lookahead?Vt:o.lookahead},iN=o=>{const s=o.w_size;let d,g,b;do{if(g=o.window_size-o.lookahead-o.strstart,o.strstart>=s+(s-gR)&&(o.window.set(o.window.subarray(s,s+s-g),0),o.match_start-=s,o.strstart-=s,o.block_start-=s,o.insert>o.strstart&&(o.insert=o.strstart),Klt(o),g+=s),o.strm.avail_in===0)break;if(d=DF(o.strm,o.window,o.strstart+o.lookahead,g),o.lookahead+=d,o.lookahead+o.insert>=3)for(b=o.strstart-o.insert,o.ins_h=o.window[b],o.ins_h=fI(o,o.ins_h,o.window[b+1]);o.insert&&(o.ins_h=fI(o,o.ins_h,o.window[b+3-1]),o.prev[b&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=b,b++,o.insert--,!(o.lookahead+o.insert<3)););}while(o.lookahead<gR&&o.strm.avail_in!==0)},tY=(o,s)=>{let d,g,b,$=o.pending_buf_size-5>o.w_size?o.w_size:o.pending_buf_size-5,Vt=0,zt=o.strm.avail_in;do{if(d=65535,b=o.bi_valid+42>>3,o.strm.avail_out<b||(b=o.strm.avail_out-b,g=o.strstart-o.block_start,d>g+o.strm.avail_in&&(d=g+o.strm.avail_in),d>b&&(d=b),d<$&&(d===0&&s!==A0||s===hI||d!==g+o.strm.avail_in)))break;Vt=s===A0&&d===g+o.strm.avail_in?1:0,NF(o,0,0,Vt),o.pending_buf[o.pending-4]=d,o.pending_buf[o.pending-3]=d>>8,o.pending_buf[o.pending-2]=~d,o.pending_buf[o.pending-1]=~d>>8,a0(o.strm),g&&(g>d&&(g=d),o.strm.output.set(o.window.subarray(o.block_start,o.block_start+g),o.strm.next_out),o.strm.next_out+=g,o.strm.avail_out-=g,o.strm.total_out+=g,o.block_start+=g,d-=g),d&&(DF(o.strm,o.strm.output,o.strm.next_out,d),o.strm.next_out+=d,o.strm.avail_out-=d,o.strm.total_out+=d)}while(Vt===0);return zt-=o.strm.avail_in,zt&&(zt>=o.w_size?(o.matches=2,o.window.set(o.strm.input.subarray(o.strm.next_in-o.w_size,o.strm.next_in),0),o.strstart=o.w_size,o.insert=o.strstart):(o.window_size-o.strstart<=zt&&(o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,o.insert>o.strstart&&(o.insert=o.strstart)),o.window.set(o.strm.input.subarray(o.strm.next_in-zt,o.strm.next_in),o.strstart),o.strstart+=zt,o.insert+=zt>o.w_size-o.insert?o.w_size-o.insert:zt),o.block_start=o.strstart),o.high_water<o.strstart&&(o.high_water=o.strstart),Vt?4:s!==hI&&s!==A0&&o.strm.avail_in===0&&o.strstart===o.block_start?2:(b=o.window_size-o.strstart,o.strm.avail_in>b&&o.block_start>=o.w_size&&(o.block_start-=o.w_size,o.strstart-=o.w_size,o.window.set(o.window.subarray(o.w_size,o.w_size+o.strstart),0),o.matches<2&&o.matches++,b+=o.w_size,o.insert>o.strstart&&(o.insert=o.strstart)),b>o.strm.avail_in&&(b=o.strm.avail_in),b&&(DF(o.strm,o.window,o.strstart,b),o.strstart+=b,o.insert+=b>o.w_size-o.insert?o.w_size-o.insert:b),o.high_water<o.strstart&&(o.high_water=o.strstart),b=o.bi_valid+42>>3,b=o.pending_buf_size-b>65535?65535:o.pending_buf_size-b,$=b>o.w_size?o.w_size:b,g=o.strstart-o.block_start,(g>=$||(g||s===A0)&&s!==hI&&o.strm.avail_in===0&&g<=b)&&(d=g>b?b:g,Vt=s===A0&&o.strm.avail_in===0&&d===g?1:0,NF(o,o.block_start,d,Vt),o.block_start+=d,a0(o.strm)),Vt?3:1)},LF=(o,s)=>{let d,g;for(;;){if(o.lookahead<gR){if(iN(o),o.lookahead<gR&&s===hI)return 1;if(o.lookahead===0)break}if(d=0,o.lookahead>=3&&(o.ins_h=fI(o,o.ins_h,o.window[o.strstart+3-1]),d=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),d!==0&&o.strstart-d<=o.w_size-gR&&(o.match_length=_z(o,d)),o.match_length>=3)if(g=dI(o,o.strstart-o.match_start,o.match_length-3),o.lookahead-=o.match_length,o.match_length<=o.max_lazy_match&&o.lookahead>=3){o.match_length--;do o.strstart++,o.ins_h=fI(o,o.ins_h,o.window[o.strstart+3-1]),d=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart;while(--o.match_length!=0);o.strstart++}else o.strstart+=o.match_length,o.match_length=0,o.ins_h=o.window[o.strstart],o.ins_h=fI(o,o.ins_h,o.window[o.strstart+1]);else g=dI(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++;if(g&&(c0(o,!1),o.strm.avail_out===0))return 1}return o.insert=o.strstart<2?o.strstart:2,s===A0?(c0(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(c0(o,!1),o.strm.avail_out===0)?1:2},oN=(o,s)=>{let d,g,b;for(;;){if(o.lookahead<gR){if(iN(o),o.lookahead<gR&&s===hI)return 1;if(o.lookahead===0)break}if(d=0,o.lookahead>=3&&(o.ins_h=fI(o,o.ins_h,o.window[o.strstart+3-1]),d=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart),o.prev_length=o.match_length,o.prev_match=o.match_start,o.match_length=2,d!==0&&o.prev_length<o.max_lazy_match&&o.strstart-d<=o.w_size-gR&&(o.match_length=_z(o,d),o.match_length<=5&&(o.strategy===Ult||o.match_length===3&&o.strstart-o.match_start>4096)&&(o.match_length=2)),o.prev_length>=3&&o.match_length<=o.prev_length){b=o.strstart+o.lookahead-3,g=dI(o,o.strstart-1-o.prev_match,o.prev_length-3),o.lookahead-=o.prev_length-1,o.prev_length-=2;do++o.strstart<=b&&(o.ins_h=fI(o,o.ins_h,o.window[o.strstart+3-1]),d=o.prev[o.strstart&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=o.strstart);while(--o.prev_length!=0);if(o.match_available=0,o.match_length=2,o.strstart++,g&&(c0(o,!1),o.strm.avail_out===0))return 1}else if(o.match_available){if(g=dI(o,0,o.window[o.strstart-1]),g&&c0(o,!1),o.strstart++,o.lookahead--,o.strm.avail_out===0)return 1}else o.match_available=1,o.strstart++,o.lookahead--}return o.match_available&&(g=dI(o,0,o.window[o.strstart-1]),o.match_available=0),o.insert=o.strstart<2?o.strstart:2,s===A0?(c0(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(c0(o,!1),o.strm.avail_out===0)?1:2};function _R(o,s,d,g,b){this.good_length=o,this.max_lazy=s,this.nice_length=d,this.max_chain=g,this.func=b}const OP=[new _R(0,0,0,0,tY),new _R(4,4,8,4,LF),new _R(4,5,16,8,LF),new _R(4,6,32,32,LF),new _R(4,4,16,16,oN),new _R(8,16,32,32,oN),new _R(8,16,128,128,oN),new _R(8,32,128,256,oN),new _R(32,128,258,1024,oN),new _R(32,258,258,4096,oN)];function zlt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=$D,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*qlt),this.dyn_dtree=new Uint16Array(2*(2*Glt+1)),this.bl_tree=new Uint16Array(2*(2*Wlt+1)),pI(this.dyn_ltree),pI(this.dyn_dtree),pI(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Hlt+1),this.heap=new Uint16Array(2*PF+1),pI(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*PF+1),pI(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const AP=o=>{if(!o)return 1;const s=o.state;return!s||s.strm!==o||s.status!==rN&&s.status!==57&&s.status!==69&&s.status!==73&&s.status!==91&&s.status!==103&&s.status!==ZI&&s.status!==wP?1:0},eY=o=>{if(AP(o))return $I(o,ER);o.total_in=o.total_out=0,o.data_type=Blt;const s=o.state;return s.pending=0,s.pending_out=0,s.wrap<0&&(s.wrap=-s.wrap),s.status=s.wrap===2?57:s.wrap?rN:ZI,o.adler=s.wrap===2?0:1,s.last_flush=-2,Nlt(s),CT},nY=o=>{const s=eY(o);return s===CT&&(d=>{d.window_size=2*d.w_size,pI(d.head),d.max_lazy_match=OP[d.level].max_lazy,d.good_match=OP[d.level].good_length,d.nice_match=OP[d.level].nice_length,d.max_chain_length=OP[d.level].max_chain,d.strstart=0,d.block_start=0,d.lookahead=0,d.insert=0,d.match_length=d.prev_length=2,d.match_available=0,d.ins_h=0})(o.state),s},rY=(o,s,d,g,b,$)=>{if(!o)return ER;let Vt=1;if(s===xlt&&(s=6),g<0?(Vt=0,g=-g):g>15&&(Vt=2,g-=16),b<1||b>9||d!==$D||g<8||g>15||s<0||s>9||$<0||$>Vlt||g===8&&Vt!==1)return $I(o,ER);g===8&&(g=9);const zt=new zlt;return o.state=zt,zt.strm=o,zt.status=rN,zt.wrap=Vt,zt.gzhead=null,zt.w_bits=g,zt.w_size=1<<zt.w_bits,zt.w_mask=zt.w_size-1,zt.hash_bits=b+7,zt.hash_size=1<<zt.hash_bits,zt.hash_mask=zt.hash_size-1,zt.hash_shift=~~((zt.hash_bits+3-1)/3),zt.window=new Uint8Array(2*zt.w_size),zt.head=new Uint16Array(zt.hash_size),zt.prev=new Uint16Array(zt.w_size),zt.lit_bufsize=1<<b+6,zt.pending_buf_size=4*zt.lit_bufsize,zt.pending_buf=new Uint8Array(zt.pending_buf_size),zt.sym_buf=zt.lit_bufsize,zt.sym_end=3*(zt.lit_bufsize-1),zt.level=s,zt.strategy=$,zt.method=d,nY(o)};var Ylt=(o,s)=>{if(AP(o)||s>QK||s<0)return o?$I(o,ER):ER;const d=o.state;if(!o.output||o.avail_in!==0&&!o.input||d.status===wP&&s!==A0)return $I(o,o.avail_out===0?kF:ER);const g=d.last_flush;if(d.last_flush=s,d.pending!==0){if(a0(o),o.avail_out===0)return d.last_flush=-1,CT}else if(o.avail_in===0&&$K(s)<=$K(g)&&s!==A0)return $I(o,kF);if(d.status===wP&&o.avail_in!==0)return $I(o,kF);if(d.status===rN&&d.wrap===0&&(d.status=ZI),d.status===rN){let b=$D+(d.w_bits-8<<4)<<8,$=-1;if($=d.strategy>=ZD||d.level<2?0:d.level<6?1:d.level===6?2:3,b|=$<<6,d.strstart!==0&&(b|=32),b+=31-b%31,IP(d,b),d.strstart!==0&&(IP(d,o.adler>>>16),IP(d,65535&o.adler)),o.adler=1,d.status=ZI,a0(o),d.pending!==0)return d.last_flush=-1,CT}if(d.status===57){if(o.adler=0,ES(d,31),ES(d,139),ES(d,8),d.gzhead)ES(d,(d.gzhead.text?1:0)+(d.gzhead.hcrc?2:0)+(d.gzhead.extra?4:0)+(d.gzhead.name?8:0)+(d.gzhead.comment?16:0)),ES(d,255&d.gzhead.time),ES(d,d.gzhead.time>>8&255),ES(d,d.gzhead.time>>16&255),ES(d,d.gzhead.time>>24&255),ES(d,d.level===9?2:d.strategy>=ZD||d.level<2?4:0),ES(d,255&d.gzhead.os),d.gzhead.extra&&d.gzhead.extra.length&&(ES(d,255&d.gzhead.extra.length),ES(d,d.gzhead.extra.length>>8&255)),d.gzhead.hcrc&&(o.adler=ST(o.adler,d.pending_buf,d.pending,0)),d.gzindex=0,d.status=69;else if(ES(d,0),ES(d,0),ES(d,0),ES(d,0),ES(d,0),ES(d,d.level===9?2:d.strategy>=ZD||d.level<2?4:0),ES(d,3),d.status=ZI,a0(o),d.pending!==0)return d.last_flush=-1,CT}if(d.status===69){if(d.gzhead.extra){let b=d.pending,$=(65535&d.gzhead.extra.length)-d.gzindex;for(;d.pending+$>d.pending_buf_size;){let zt=d.pending_buf_size-d.pending;if(d.pending_buf.set(d.gzhead.extra.subarray(d.gzindex,d.gzindex+zt),d.pending),d.pending=d.pending_buf_size,d.gzhead.hcrc&&d.pending>b&&(o.adler=ST(o.adler,d.pending_buf,d.pending-b,b)),d.gzindex+=zt,a0(o),d.pending!==0)return d.last_flush=-1,CT;b=0,$-=zt}let Vt=new Uint8Array(d.gzhead.extra);d.pending_buf.set(Vt.subarray(d.gzindex,d.gzindex+$),d.pending),d.pending+=$,d.gzhead.hcrc&&d.pending>b&&(o.adler=ST(o.adler,d.pending_buf,d.pending-b,b)),d.gzindex=0}d.status=73}if(d.status===73){if(d.gzhead.name){let b,$=d.pending;do{if(d.pending===d.pending_buf_size){if(d.gzhead.hcrc&&d.pending>$&&(o.adler=ST(o.adler,d.pending_buf,d.pending-$,$)),a0(o),d.pending!==0)return d.last_flush=-1,CT;$=0}b=d.gzindex<d.gzhead.name.length?255&d.gzhead.name.charCodeAt(d.gzindex++):0,ES(d,b)}while(b!==0);d.gzhead.hcrc&&d.pending>$&&(o.adler=ST(o.adler,d.pending_buf,d.pending-$,$)),d.gzindex=0}d.status=91}if(d.status===91){if(d.gzhead.comment){let b,$=d.pending;do{if(d.pending===d.pending_buf_size){if(d.gzhead.hcrc&&d.pending>$&&(o.adler=ST(o.adler,d.pending_buf,d.pending-$,$)),a0(o),d.pending!==0)return d.last_flush=-1,CT;$=0}b=d.gzindex<d.gzhead.comment.length?255&d.gzhead.comment.charCodeAt(d.gzindex++):0,ES(d,b)}while(b!==0);d.gzhead.hcrc&&d.pending>$&&(o.adler=ST(o.adler,d.pending_buf,d.pending-$,$))}d.status=103}if(d.status===103){if(d.gzhead.hcrc){if(d.pending+2>d.pending_buf_size&&(a0(o),d.pending!==0))return d.last_flush=-1,CT;ES(d,255&o.adler),ES(d,o.adler>>8&255),o.adler=0}if(d.status=ZI,a0(o),d.pending!==0)return d.last_flush=-1,CT}if(o.avail_in!==0||d.lookahead!==0||s!==hI&&d.status!==wP){let b=d.level===0?tY(d,s):d.strategy===ZD?(($,Vt)=>{let zt;for(;;){if($.lookahead===0&&(iN($),$.lookahead===0)){if(Vt===hI)return 1;break}if($.match_length=0,zt=dI($,0,$.window[$.strstart]),$.lookahead--,$.strstart++,zt&&(c0($,!1),$.strm.avail_out===0))return 1}return $.insert=0,Vt===A0?(c0($,!0),$.strm.avail_out===0?3:4):$.sym_next&&(c0($,!1),$.strm.avail_out===0)?1:2})(d,s):d.strategy===jlt?(($,Vt)=>{let zt,_e,_r,_o;const ga=$.window;for(;;){if($.lookahead<=QI){if(iN($),$.lookahead<=QI&&Vt===hI)return 1;if($.lookahead===0)break}if($.match_length=0,$.lookahead>=3&&$.strstart>0&&(_r=$.strstart-1,_e=ga[_r],_e===ga[++_r]&&_e===ga[++_r]&&_e===ga[++_r])){_o=$.strstart+QI;do;while(_e===ga[++_r]&&_e===ga[++_r]&&_e===ga[++_r]&&_e===ga[++_r]&&_e===ga[++_r]&&_e===ga[++_r]&&_e===ga[++_r]&&_e===ga[++_r]&&_r<_o);$.match_length=QI-(_o-_r),$.match_length>$.lookahead&&($.match_length=$.lookahead)}if($.match_length>=3?(zt=dI($,1,$.match_length-3),$.lookahead-=$.match_length,$.strstart+=$.match_length,$.match_length=0):(zt=dI($,0,$.window[$.strstart]),$.lookahead--,$.strstart++),zt&&(c0($,!1),$.strm.avail_out===0))return 1}return $.insert=0,Vt===A0?(c0($,!0),$.strm.avail_out===0?3:4):$.sym_next&&(c0($,!1),$.strm.avail_out===0)?1:2})(d,s):OP[d.level].func(d,s);if(b!==3&&b!==4||(d.status=wP),b===1||b===3)return o.avail_out===0&&(d.last_flush=-1),CT;if(b===2&&(s===Dlt?Plt(d):s!==QK&&(NF(d,0,0,!1),s===Llt&&(pI(d.head),d.lookahead===0&&(d.strstart=0,d.block_start=0,d.insert=0))),a0(o),o.avail_out===0))return d.last_flush=-1,CT}return s!==A0?CT:d.wrap<=0?ZK:(d.wrap===2?(ES(d,255&o.adler),ES(d,o.adler>>8&255),ES(d,o.adler>>16&255),ES(d,o.adler>>24&255),ES(d,255&o.total_in),ES(d,o.total_in>>8&255),ES(d,o.total_in>>16&255),ES(d,o.total_in>>24&255)):(IP(d,o.adler>>>16),IP(d,65535&o.adler)),a0(o),d.wrap>0&&(d.wrap=-d.wrap),d.pending!==0?CT:ZK)},Jlt=(o,s)=>{let d=s.length;if(AP(o))return ER;const g=o.state,b=g.wrap;if(b===2||b===1&&g.status!==rN||g.lookahead)return ER;if(b===1&&(o.adler=CP(o.adler,s,d,0)),g.wrap=0,d>=g.w_size){b===0&&(pI(g.head),g.strstart=0,g.block_start=0,g.insert=0);let _e=new Uint8Array(g.w_size);_e.set(s.subarray(d-g.w_size,d),0),s=_e,d=g.w_size}const $=o.avail_in,Vt=o.next_in,zt=o.input;for(o.avail_in=d,o.next_in=0,o.input=s,iN(g);g.lookahead>=3;){let _e=g.strstart,_r=g.lookahead-2;do g.ins_h=fI(g,g.ins_h,g.window[_e+3-1]),g.prev[_e&g.w_mask]=g.head[g.ins_h],g.head[g.ins_h]=_e,_e++;while(--_r);g.strstart=_e,g.lookahead=2,iN(g)}return g.strstart+=g.lookahead,g.block_start=g.strstart,g.insert=g.lookahead,g.lookahead=0,g.match_length=g.prev_length=2,g.match_available=0,o.next_in=Vt,o.input=zt,o.avail_in=$,g.wrap=b,CT},NP={deflateInit:(o,s)=>rY(o,s,$D,15,8,Flt),deflateInit2:rY,deflateReset:nY,deflateResetKeep:eY,deflateSetHeader:(o,s)=>AP(o)||o.state.wrap!==2?ER:(o.state.gzhead=s,CT),deflate:Ylt,deflateEnd:o=>{if(AP(o))return ER;const s=o.state.status;return o.state=null,s===ZI?$I(o,Mlt):CT},deflateSetDictionary:Jlt,deflateInfo:"pako deflate (from Nodeca project)"};const Xlt=(o,s)=>Object.prototype.hasOwnProperty.call(o,s);var tL={assign:function(o){const s=Array.prototype.slice.call(arguments,1);for(;s.length;){const d=s.shift();if(d){if(typeof d!="object")throw new TypeError(d+"must be non-object");for(const g in d)Xlt(d,g)&&(o[g]=d[g])}}return o},flattenChunks:o=>{let s=0;for(let g=0,b=o.length;g<b;g++)s+=o[g].length;const d=new Uint8Array(s);for(let g=0,b=0,$=o.length;g<$;g++){let Vt=o[g];d.set(Vt,b),b+=Vt.length}return d}};let iY=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{iY=!1}const kP=new Uint8Array(256);for(let o=0;o<256;o++)kP[o]=o>=252?6:o>=248?5:o>=240?4:o>=224?3:o>=192?2:1;kP[254]=kP[254]=1;var PP={string2buf:o=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(o);let s,d,g,b,$,Vt=o.length,zt=0;for(b=0;b<Vt;b++)d=o.charCodeAt(b),(64512&d)==55296&&b+1<Vt&&(g=o.charCodeAt(b+1),(64512&g)==56320&&(d=65536+(d-55296<<10)+(g-56320),b++)),zt+=d<128?1:d<2048?2:d<65536?3:4;for(s=new Uint8Array(zt),$=0,b=0;$<zt;b++)d=o.charCodeAt(b),(64512&d)==55296&&b+1<Vt&&(g=o.charCodeAt(b+1),(64512&g)==56320&&(d=65536+(d-55296<<10)+(g-56320),b++)),d<128?s[$++]=d:d<2048?(s[$++]=192|d>>>6,s[$++]=128|63&d):d<65536?(s[$++]=224|d>>>12,s[$++]=128|d>>>6&63,s[$++]=128|63&d):(s[$++]=240|d>>>18,s[$++]=128|d>>>12&63,s[$++]=128|d>>>6&63,s[$++]=128|63&d);return s},buf2string:(o,s)=>{const d=s||o.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(o.subarray(0,s));let g,b;const $=new Array(2*d);for(b=0,g=0;g<d;){let Vt=o[g++];if(Vt<128){$[b++]=Vt;continue}let zt=kP[Vt];if(zt>4)$[b++]=65533,g+=zt-1;else{for(Vt&=zt===2?31:zt===3?15:7;zt>1&&g<d;)Vt=Vt<<6|63&o[g++],zt--;zt>1?$[b++]=65533:Vt<65536?$[b++]=Vt:(Vt-=65536,$[b++]=55296|Vt>>10&1023,$[b++]=56320|1023&Vt)}}return((Vt,zt)=>{if(zt<65534&&Vt.subarray&&iY)return String.fromCharCode.apply(null,Vt.length===zt?Vt:Vt.subarray(0,zt));let _e="";for(let _r=0;_r<zt;_r++)_e+=String.fromCharCode(Vt[_r]);return _e})($,b)},utf8border:(o,s)=>{(s=s||o.length)>o.length&&(s=o.length);let d=s-1;for(;d>=0&&(192&o[d])==128;)d--;return d<0||d===0?s:d+kP[o[d]]>s?d:s}},oY=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const sY=Object.prototype.toString,{Z_NO_FLUSH:Qlt,Z_SYNC_FLUSH:Zlt,Z_FULL_FLUSH:$lt,Z_FINISH:tdt,Z_OK:eL,Z_STREAM_END:edt,Z_DEFAULT_COMPRESSION:ndt,Z_DEFAULT_STRATEGY:rdt,Z_DEFLATED:idt}=nN;function DP(o){this.options=tL.assign({level:ndt,method:idt,chunkSize:16384,windowBits:15,memLevel:8,strategy:rdt},o||{});let s=this.options;s.raw&&s.windowBits>0?s.windowBits=-s.windowBits:s.gzip&&s.windowBits>0&&s.windowBits<16&&(s.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new oY,this.strm.avail_out=0;let d=NP.deflateInit2(this.strm,s.level,s.method,s.windowBits,s.memLevel,s.strategy);if(d!==eL)throw new Error(XI[d]);if(s.header&&NP.deflateSetHeader(this.strm,s.header),s.dictionary){let g;if(g=typeof s.dictionary=="string"?PP.string2buf(s.dictionary):sY.call(s.dictionary)==="[object ArrayBuffer]"?new Uint8Array(s.dictionary):s.dictionary,d=NP.deflateSetDictionary(this.strm,g),d!==eL)throw new Error(XI[d]);this._dict_set=!0}}function MF(o,s){const d=new DP(s);if(d.push(o,!0),d.err)throw d.msg||XI[d.err];return d.result}DP.prototype.push=function(o,s){const d=this.strm,g=this.options.chunkSize;let b,$;if(this.ended)return!1;for($=s===~~s?s:s===!0?tdt:Qlt,typeof o=="string"?d.input=PP.string2buf(o):sY.call(o)==="[object ArrayBuffer]"?d.input=new Uint8Array(o):d.input=o,d.next_in=0,d.avail_in=d.input.length;;)if(d.avail_out===0&&(d.output=new Uint8Array(g),d.next_out=0,d.avail_out=g),($===Zlt||$===$lt)&&d.avail_out<=6)this.onData(d.output.subarray(0,d.next_out)),d.avail_out=0;else{if(b=NP.deflate(d,$),b===edt)return d.next_out>0&&this.onData(d.output.subarray(0,d.next_out)),b=NP.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===eL;if(d.avail_out!==0){if($>0&&d.next_out>0)this.onData(d.output.subarray(0,d.next_out)),d.avail_out=0;else if(d.avail_in===0)break}else this.onData(d.output)}return!0},DP.prototype.onData=function(o){this.chunks.push(o)},DP.prototype.onEnd=function(o){o===eL&&(this.result=tL.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg};var odt={Deflate:DP,deflate:MF,deflateRaw:function(o,s){return(s=s||{}).raw=!0,MF(o,s)},gzip:function(o,s){return(s=s||{}).gzip=!0,MF(o,s)},constants:nN};const nL=16209;var sdt=function(o,s){let d,g,b,$,Vt,zt,_e,_r,_o,ga,_a,_c,tE,_p,_f,eE,iE,fE,mE,_E,SE,wE,NE,DE;const JE=o.state;d=o.next_in,NE=o.input,g=d+(o.avail_in-5),b=o.next_out,DE=o.output,$=b-(s-o.avail_out),Vt=b+(o.avail_out-257),zt=JE.dmax,_e=JE.wsize,_r=JE.whave,_o=JE.wnext,ga=JE.window,_a=JE.hold,_c=JE.bits,tE=JE.lencode,_p=JE.distcode,_f=(1<<JE.lenbits)-1,eE=(1<<JE.distbits)-1;t:do{_c<15&&(_a+=NE[d++]<<_c,_c+=8,_a+=NE[d++]<<_c,_c+=8),iE=tE[_a&_f];e:for(;;){if(fE=iE>>>24,_a>>>=fE,_c-=fE,fE=iE>>>16&255,fE===0)DE[b++]=65535&iE;else{if(!(16&fE)){if(!(64&fE)){iE=tE[(65535&iE)+(_a&(1<<fE)-1)];continue e}if(32&fE){JE.mode=16191;break t}o.msg="invalid literal/length code",JE.mode=nL;break t}mE=65535&iE,fE&=15,fE&&(_c<fE&&(_a+=NE[d++]<<_c,_c+=8),mE+=_a&(1<<fE)-1,_a>>>=fE,_c-=fE),_c<15&&(_a+=NE[d++]<<_c,_c+=8,_a+=NE[d++]<<_c,_c+=8),iE=_p[_a&eE];n:for(;;){if(fE=iE>>>24,_a>>>=fE,_c-=fE,fE=iE>>>16&255,!(16&fE)){if(!(64&fE)){iE=_p[(65535&iE)+(_a&(1<<fE)-1)];continue n}o.msg="invalid distance code",JE.mode=nL;break t}if(_E=65535&iE,fE&=15,_c<fE&&(_a+=NE[d++]<<_c,_c+=8,_c<fE&&(_a+=NE[d++]<<_c,_c+=8)),_E+=_a&(1<<fE)-1,_E>zt){o.msg="invalid distance too far back",JE.mode=nL;break t}if(_a>>>=fE,_c-=fE,fE=b-$,_E>fE){if(fE=_E-fE,fE>_r&&JE.sane){o.msg="invalid distance too far back",JE.mode=nL;break t}if(SE=0,wE=ga,_o===0){if(SE+=_e-fE,fE<mE){mE-=fE;do DE[b++]=ga[SE++];while(--fE);SE=b-_E,wE=DE}}else if(_o<fE){if(SE+=_e+_o-fE,fE-=_o,fE<mE){mE-=fE;do DE[b++]=ga[SE++];while(--fE);if(SE=0,_o<mE){fE=_o,mE-=fE;do DE[b++]=ga[SE++];while(--fE);SE=b-_E,wE=DE}}}else if(SE+=_o-fE,fE<mE){mE-=fE;do DE[b++]=ga[SE++];while(--fE);SE=b-_E,wE=DE}for(;mE>2;)DE[b++]=wE[SE++],DE[b++]=wE[SE++],DE[b++]=wE[SE++],mE-=3;mE&&(DE[b++]=wE[SE++],mE>1&&(DE[b++]=wE[SE++]))}else{SE=b-_E;do DE[b++]=DE[SE++],DE[b++]=DE[SE++],DE[b++]=DE[SE++],mE-=3;while(mE>2);mE&&(DE[b++]=DE[SE++],mE>1&&(DE[b++]=DE[SE++]))}break}}break}}while(d<g&&b<Vt);mE=_c>>3,d-=mE,_c-=mE<<3,_a&=(1<<_c)-1,o.next_in=d,o.next_out=b,o.avail_in=d<g?g-d+5:5-(d-g),o.avail_out=b<Vt?Vt-b+257:257-(b-Vt),JE.hold=_a,JE.bits=_c};const rL=15,adt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),cdt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),udt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ldt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var LP=(o,s,d,g,b,$,Vt,zt)=>{const _e=zt.bits;let _r,_o,ga,_a,_c,tE,_p=0,_f=0,eE=0,iE=0,fE=0,mE=0,_E=0,SE=0,wE=0,NE=0,DE=null;const JE=new Uint16Array(16),b_=new Uint16Array(16);let L_,$_,OS,lS=null;for(_p=0;_p<=rL;_p++)JE[_p]=0;for(_f=0;_f<g;_f++)JE[s[d+_f]]++;for(fE=_e,iE=rL;iE>=1&&JE[iE]===0;iE--);if(fE>iE&&(fE=iE),iE===0)return b[$++]=20971520,b[$++]=20971520,zt.bits=1,0;for(eE=1;eE<iE&&JE[eE]===0;eE++);for(fE<eE&&(fE=eE),SE=1,_p=1;_p<=rL;_p++)if(SE<<=1,SE-=JE[_p],SE<0)return-1;if(SE>0&&(o===0||iE!==1))return-1;for(b_[1]=0,_p=1;_p<rL;_p++)b_[_p+1]=b_[_p]+JE[_p];for(_f=0;_f<g;_f++)s[d+_f]!==0&&(Vt[b_[s[d+_f]]++]=_f);if(o===0?(DE=lS=Vt,tE=20):o===1?(DE=adt,lS=cdt,tE=257):(DE=udt,lS=ldt,tE=0),NE=0,_f=0,_p=eE,_c=$,mE=fE,_E=0,ga=-1,wE=1<<fE,_a=wE-1,o===1&&wE>852||o===2&&wE>592)return 1;for(;;){L_=_p-_E,Vt[_f]+1<tE?($_=0,OS=Vt[_f]):Vt[_f]>=tE?($_=lS[Vt[_f]-tE],OS=DE[Vt[_f]-tE]):($_=96,OS=0),_r=1<<_p-_E,_o=1<<mE,eE=_o;do _o-=_r,b[_c+(NE>>_E)+_o]=L_<<24|$_<<16|OS|0;while(_o!==0);for(_r=1<<_p-1;NE&_r;)_r>>=1;if(_r!==0?(NE&=_r-1,NE+=_r):NE=0,_f++,--JE[_p]==0){if(_p===iE)break;_p=s[d+Vt[_f]]}if(_p>fE&&(NE&_a)!==ga){for(_E===0&&(_E=fE),_c+=eE,mE=_p-_E,SE=1<<mE;mE+_E<iE&&(SE-=JE[mE+_E],!(SE<=0));)mE++,SE<<=1;if(wE+=1<<mE,o===1&&wE>852||o===2&&wE>592)return 1;ga=NE&_a,b[ga]=fE<<24|mE<<16|_c-$|0}}return NE!==0&&(b[_c+NE]=_p-_E<<24|64<<16|0),zt.bits=fE,0};const{Z_FINISH:aY,Z_BLOCK:ddt,Z_TREES:iL,Z_OK:tO,Z_STREAM_END:hdt,Z_NEED_DICT:pdt,Z_STREAM_ERROR:N0,Z_DATA_ERROR:cY,Z_MEM_ERROR:uY,Z_BUF_ERROR:fdt,Z_DEFLATED:lY}=nN,oL=16180,sL=16190,jR=16191,xF=16192,UF=16194,aL=16199,cL=16200,jF=16206,XS=16209,dY=o=>(o>>>24&255)+(o>>>8&65280)+((65280&o)<<8)+((255&o)<<24);function mdt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const eO=o=>{if(!o)return 1;const s=o.state;return!s||s.strm!==o||s.mode<oL||s.mode>16211?1:0},hY=o=>{if(eO(o))return N0;const s=o.state;return o.total_in=o.total_out=s.total=0,o.msg="",s.wrap&&(o.adler=1&s.wrap),s.mode=oL,s.last=0,s.havedict=0,s.flags=-1,s.dmax=32768,s.head=null,s.hold=0,s.bits=0,s.lencode=s.lendyn=new Int32Array(852),s.distcode=s.distdyn=new Int32Array(592),s.sane=1,s.back=-1,tO},pY=o=>{if(eO(o))return N0;const s=o.state;return s.wsize=0,s.whave=0,s.wnext=0,hY(o)},fY=(o,s)=>{let d;if(eO(o))return N0;const g=o.state;return s<0?(d=0,s=-s):(d=5+(s>>4),s<48&&(s&=15)),s&&(s<8||s>15)?N0:(g.window!==null&&g.wbits!==s&&(g.window=null),g.wrap=d,g.wbits=s,pY(o))},mY=(o,s)=>{if(!o)return N0;const d=new mdt;o.state=d,d.strm=o,d.window=null,d.mode=oL;const g=fY(o,s);return g!==tO&&(o.state=null),g};let VF,FF,EY=!0;const Edt=o=>{if(EY){VF=new Int32Array(512),FF=new Int32Array(32);let s=0;for(;s<144;)o.lens[s++]=8;for(;s<256;)o.lens[s++]=9;for(;s<280;)o.lens[s++]=7;for(;s<288;)o.lens[s++]=8;for(LP(1,o.lens,0,288,VF,0,o.work,{bits:9}),s=0;s<32;)o.lens[s++]=5;LP(2,o.lens,0,32,FF,0,o.work,{bits:5}),EY=!1}o.lencode=VF,o.lenbits=9,o.distcode=FF,o.distbits=5},gY=(o,s,d,g)=>{let b;const $=o.state;return $.window===null&&($.wsize=1<<$.wbits,$.wnext=0,$.whave=0,$.window=new Uint8Array($.wsize)),g>=$.wsize?($.window.set(s.subarray(d-$.wsize,d),0),$.wnext=0,$.whave=$.wsize):(b=$.wsize-$.wnext,b>g&&(b=g),$.window.set(s.subarray(d-g,d-g+b),$.wnext),(g-=b)?($.window.set(s.subarray(d-g,d),0),$.wnext=g,$.whave=$.wsize):($.wnext+=b,$.wnext===$.wsize&&($.wnext=0),$.whave<$.wsize&&($.whave+=b))),0};var gdt=(o,s)=>{let d,g,b,$,Vt,zt,_e,_r,_o,ga,_a,_c,tE,_p,_f,eE,iE,fE,mE,_E,SE,wE,NE=0;const DE=new Uint8Array(4);let JE,b_;const L_=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(eO(o)||!o.output||!o.input&&o.avail_in!==0)return N0;d=o.state,d.mode===jR&&(d.mode=xF),Vt=o.next_out,b=o.output,_e=o.avail_out,$=o.next_in,g=o.input,zt=o.avail_in,_r=d.hold,_o=d.bits,ga=zt,_a=_e,wE=tO;t:for(;;)switch(d.mode){case oL:if(d.wrap===0){d.mode=xF;break}for(;_o<16;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}if(2&d.wrap&&_r===35615){d.wbits===0&&(d.wbits=15),d.check=0,DE[0]=255&_r,DE[1]=_r>>>8&255,d.check=ST(d.check,DE,2,0),_r=0,_o=0,d.mode=16181;break}if(d.head&&(d.head.done=!1),!(1&d.wrap)||(((255&_r)<<8)+(_r>>8))%31){o.msg="incorrect header check",d.mode=XS;break}if((15&_r)!==lY){o.msg="unknown compression method",d.mode=XS;break}if(_r>>>=4,_o-=4,SE=8+(15&_r),d.wbits===0&&(d.wbits=SE),SE>15||SE>d.wbits){o.msg="invalid window size",d.mode=XS;break}d.dmax=1<<d.wbits,d.flags=0,o.adler=d.check=1,d.mode=512&_r?16189:jR,_r=0,_o=0;break;case 16181:for(;_o<16;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}if(d.flags=_r,(255&pT(d))!==lY){o.msg="unknown compression method",d.mode=XS;break}if(57344&pT(d)){o.msg="unknown header flags set",d.mode=XS;break}d.head&&(d.head.text=_r>>8&1),512&pT(d)&&4&d.wrap&&(DE[0]=255&_r,DE[1]=_r>>>8&255,d.check=ST(d.check,DE,2,0)),_r=0,_o=0,d.mode=16182;case 16182:for(;_o<32;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}d.head&&(d.head.time=_r),512&pT(d)&&4&d.wrap&&(DE[0]=255&_r,DE[1]=_r>>>8&255,DE[2]=_r>>>16&255,DE[3]=_r>>>24&255,d.check=ST(d.check,DE,4,0)),_r=0,_o=0,d.mode=16183;case 16183:for(;_o<16;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}d.head&&(d.head.xflags=255&_r,d.head.os=_r>>8),512&pT(d)&&4&d.wrap&&(DE[0]=255&_r,DE[1]=_r>>>8&255,d.check=ST(d.check,DE,2,0)),_r=0,_o=0,d.mode=16184;case 16184:if(1024&pT(d)){for(;_o<16;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}d.length=_r,d.head&&(d.head.extra_len=_r),512&pT(d)&&4&d.wrap&&(DE[0]=255&_r,DE[1]=_r>>>8&255,d.check=ST(d.check,DE,2,0)),_r=0,_o=0}else d.head&&(d.head.extra=null);d.mode=16185;case 16185:if(1024&pT(d)&&(_c=d.length,_c>zt&&(_c=zt),_c&&(d.head&&(SE=d.head.extra_len-d.length,d.head.extra||(d.head.extra=new Uint8Array(d.head.extra_len)),d.head.extra.set(g.subarray($,$+_c),SE)),512&pT(d)&&4&d.wrap&&(d.check=ST(d.check,g,_c,$)),zt-=_c,$+=_c,d.length-=_c),d.length))break t;d.length=0,d.mode=16186;case 16186:if(2048&pT(d)){if(zt===0)break t;_c=0;do SE=g[$+_c++],d.head&&SE&&d.length<65536&&(d.head.name+=String.fromCharCode(SE));while(SE&&_c<zt);if(512&pT(d)&&4&d.wrap&&(d.check=ST(d.check,g,_c,$)),zt-=_c,$+=_c,SE)break t}else d.head&&(d.head.name=null);d.length=0,d.mode=16187;case 16187:if(4096&pT(d)){if(zt===0)break t;_c=0;do SE=g[$+_c++],d.head&&SE&&d.length<65536&&(d.head.comment+=String.fromCharCode(SE));while(SE&&_c<zt);if(512&pT(d)&&4&d.wrap&&(d.check=ST(d.check,g,_c,$)),zt-=_c,$+=_c,SE)break t}else d.head&&(d.head.comment=null);d.mode=16188;case 16188:if(512&pT(d)){for(;_o<16;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}if(4&d.wrap&&_r!==(65535&d.check)){o.msg="header crc mismatch",d.mode=XS;break}_r=0,_o=0}d.head&&(d.head.hcrc=pT(d)>>9&1,d.head.done=!0),o.adler=d.check=0,d.mode=jR;break;case 16189:for(;_o<32;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}o.adler=d.check=dY(_r),_r=0,_o=0,d.mode=sL;case sL:if(d.havedict===0)return o.next_out=Vt,o.avail_out=_e,o.next_in=$,o.avail_in=zt,d.hold=_r,d.bits=_o,pdt;o.adler=d.check=1,d.mode=jR;case jR:if(s===ddt||s===iL)break t;case xF:if(d.last){_r>>>=7&_o,_o-=7&_o,d.mode=jF;break}for(;_o<3;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}switch(d.last=1&_r,_r>>>=1,_o-=1,3&_r){case 0:d.mode=16193;break;case 1:if(Edt(d),d.mode=aL,s===iL){_r>>>=2,_o-=2;break t}break;case 2:d.mode=16196;break;case 3:o.msg="invalid block type",d.mode=XS}_r>>>=2,_o-=2;break;case 16193:for(_r>>>=7&_o,_o-=7&_o;_o<32;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}if((65535&_r)!=(_r>>>16^65535)){o.msg="invalid stored block lengths",d.mode=XS;break}if(d.length=65535&_r,_r=0,_o=0,d.mode=UF,s===iL)break t;case UF:d.mode=16195;case 16195:if(_c=d.length,_c){if(_c>zt&&(_c=zt),_c>_e&&(_c=_e),_c===0)break t;b.set(g.subarray($,$+_c),Vt),zt-=_c,$+=_c,_e-=_c,Vt+=_c,d.length-=_c;break}d.mode=jR;break;case 16196:for(;_o<14;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}if(d.nlen=257+(31&_r),_r>>>=5,_o-=5,d.ndist=1+(31&_r),_r>>>=5,_o-=5,d.ncode=4+(15&_r),_r>>>=4,_o-=4,d.nlen>286||d.ndist>30){o.msg="too many length or distance symbols",d.mode=XS;break}d.have=0,d.mode=16197;case 16197:for(;d.have<d.ncode;){for(;_o<3;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}d.lens[L_[d.have++]]=7&_r,_r>>>=3,_o-=3}for(;d.have<19;)d.lens[L_[d.have++]]=0;if(d.lencode=d.lendyn,d.lenbits=7,JE={bits:d.lenbits},wE=LP(0,d.lens,0,19,d.lencode,0,d.work,JE),d.lenbits=JE.bits,wE){o.msg="invalid code lengths set",d.mode=XS;break}d.have=0,d.mode=16198;case 16198:for(;d.have<d.nlen+d.ndist;){for(;NE=d.lencode[_r&(1<<d.lenbits)-1],_f=NE>>>24,eE=NE>>>16&255,iE=65535&NE,!(_f<=_o);){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}if(iE<16)_r>>>=_f,_o-=_f,d.lens[d.have++]=iE;else{if(iE===16){for(b_=_f+2;_o<b_;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}if(_r>>>=_f,_o-=_f,d.have===0){o.msg="invalid bit length repeat",d.mode=XS;break}SE=d.lens[d.have-1],_c=3+(3&_r),_r>>>=2,_o-=2}else if(iE===17){for(b_=_f+3;_o<b_;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}_r>>>=_f,_o-=_f,SE=0,_c=3+(7&_r),_r>>>=3,_o-=3}else{for(b_=_f+7;_o<b_;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}_r>>>=_f,_o-=_f,SE=0,_c=11+(127&_r),_r>>>=7,_o-=7}if(d.have+_c>d.nlen+d.ndist){o.msg="invalid bit length repeat",d.mode=XS;break}for(;_c--;)d.lens[d.have++]=SE}}if(d.mode===XS)break;if(d.lens[256]===0){o.msg="invalid code -- missing end-of-block",d.mode=XS;break}if(d.lenbits=9,JE={bits:d.lenbits},wE=LP(1,d.lens,0,d.nlen,d.lencode,0,d.work,JE),d.lenbits=JE.bits,wE){o.msg="invalid literal/lengths set",d.mode=XS;break}if(d.distbits=6,d.distcode=d.distdyn,JE={bits:d.distbits},wE=LP(2,d.lens,d.nlen,d.ndist,d.distcode,0,d.work,JE),d.distbits=JE.bits,wE){o.msg="invalid distances set",d.mode=XS;break}if(d.mode=aL,s===iL)break t;case aL:d.mode=cL;case cL:if(zt>=6&&_e>=258){o.next_out=Vt,o.avail_out=_e,o.next_in=$,o.avail_in=zt,d.hold=_r,d.bits=_o,sdt(o,_a),Vt=o.next_out,b=o.output,_e=o.avail_out,$=o.next_in,g=o.input,zt=o.avail_in,_r=d.hold,_o=d.bits,d.mode===jR&&(d.back=-1);break}for(d.back=0;NE=d.lencode[_r&(1<<d.lenbits)-1],_f=NE>>>24,eE=NE>>>16&255,iE=65535&NE,!(_f<=_o);){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}if(eE&&!(240&eE)){for(fE=_f,mE=eE,_E=iE;NE=d.lencode[_E+((_r&(1<<fE+mE)-1)>>fE)],_f=NE>>>24,eE=NE>>>16&255,iE=65535&NE,!(fE+_f<=_o);){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}_r>>>=fE,_o-=fE,d.back+=fE}if(_r>>>=_f,_o-=_f,d.back+=_f,d.length=iE,eE===0){d.mode=16205;break}if(32&eE){d.back=-1,d.mode=jR;break}if(64&eE){o.msg="invalid literal/length code",d.mode=XS;break}d.extra=15&eE,d.mode=16201;case 16201:if(d.extra){for(b_=d.extra;_o<b_;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}d.length+=_r&(1<<d.extra)-1,_r>>>=d.extra,_o-=d.extra,d.back+=d.extra}d.was=d.length,d.mode=16202;case 16202:for(;NE=d.distcode[_r&(1<<d.distbits)-1],_f=NE>>>24,eE=NE>>>16&255,iE=65535&NE,!(_f<=_o);){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}if(!(240&eE)){for(fE=_f,mE=eE,_E=iE;NE=d.distcode[_E+((_r&(1<<fE+mE)-1)>>fE)],_f=NE>>>24,eE=NE>>>16&255,iE=65535&NE,!(fE+_f<=_o);){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}_r>>>=fE,_o-=fE,d.back+=fE}if(_r>>>=_f,_o-=_f,d.back+=_f,64&eE){o.msg="invalid distance code",d.mode=XS;break}d.offset=iE,d.extra=15&eE,d.mode=16203;case 16203:if(d.extra){for(b_=d.extra;_o<b_;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}d.offset+=_r&(1<<d.extra)-1,_r>>>=d.extra,_o-=d.extra,d.back+=d.extra}if(d.offset>d.dmax){o.msg="invalid distance too far back",d.mode=XS;break}d.mode=16204;case 16204:if(_e===0)break t;if(_c=_a-_e,d.offset>_c){if(_c=d.offset-_c,_c>d.whave&&d.sane){o.msg="invalid distance too far back",d.mode=XS;break}_c>d.wnext?(_c-=d.wnext,tE=d.wsize-_c):tE=d.wnext-_c,_c>d.length&&(_c=d.length),_p=d.window}else _p=b,tE=Vt-d.offset,_c=d.length;_c>_e&&(_c=_e),_e-=_c,d.length-=_c;do b[Vt++]=_p[tE++];while(--_c);d.length===0&&(d.mode=cL);break;case 16205:if(_e===0)break t;b[Vt++]=d.length,_e--,d.mode=cL;break;case jF:if(d.wrap){for(;_o<32;){if(zt===0)break t;zt--,_r|=g[$++]<<_o,_o+=8}if(_a-=_e,o.total_out+=_a,d.total+=_a,4&d.wrap&&_a&&(o.adler=d.check=pT(d)?ST(d.check,b,_a,Vt-_a):CP(d.check,b,_a,Vt-_a)),_a=_e,4&d.wrap&&(pT(d)?_r:dY(_r))!==d.check){o.msg="incorrect data check",d.mode=XS;break}_r=0,_o=0}d.mode=16207;case 16207:if(d.wrap&&pT(d)){for(;_o<32;){if(zt===0)break t;zt--,_r+=g[$++]<<_o,_o+=8}if(4&d.wrap&&_r!==(4294967295&d.total)){o.msg="incorrect length check",d.mode=XS;break}_r=0,_o=0}d.mode=16208;case 16208:wE=hdt;break t;case XS:wE=cY;break t;case 16210:return uY;default:return N0}return o.next_out=Vt,o.avail_out=_e,o.next_in=$,o.avail_in=zt,d.hold=_r,d.bits=_o,(d.wsize||_a!==o.avail_out&&d.mode<XS&&(d.mode<jF||s!==aY))&&gY(o,o.output,o.next_out,_a-o.avail_out),ga-=o.avail_in,_a-=o.avail_out,o.total_in+=ga,o.total_out+=_a,d.total+=_a,4&d.wrap&&_a&&(o.adler=d.check=pT(d)?ST(d.check,b,_a,o.next_out-_a):CP(d.check,b,_a,o.next_out-_a)),o.data_type=d.bits+(d.last?64:0)+(d.mode===jR?128:0)+(d.mode===aL||d.mode===UF?256:0),(ga===0&&_a===0||s===aY)&&wE===tO&&(wE=fdt),wE},VR={inflateReset:pY,inflateReset2:fY,inflateResetKeep:hY,inflateInit:o=>mY(o,15),inflateInit2:mY,inflate:gdt,inflateEnd:o=>{if(eO(o))return N0;let s=o.state;return s.window&&(s.window=null),o.state=null,tO},inflateGetHeader:(o,s)=>{if(eO(o))return N0;const d=o.state;return 2&d.wrap?(d.head=s,s.done=!1,tO):N0},inflateSetDictionary:(o,s)=>{const d=s.length;let g,b,$;return eO(o)?N0:(g=o.state,g.wrap!==0&&g.mode!==sL?N0:g.mode===sL&&(b=1,b=CP(b,s,d,0),b!==g.check)?cY:($=gY(o,s,d,d),$?(g.mode=16210,uY):(g.havedict=1,tO)))},inflateInfo:"pako inflate (from Nodeca project)"},_dt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const _Y=Object.prototype.toString,{Z_NO_FLUSH:vdt,Z_FINISH:ydt,Z_OK:MP,Z_STREAM_END:BF,Z_NEED_DICT:GF,Z_STREAM_ERROR:Sdt,Z_DATA_ERROR:vY,Z_MEM_ERROR:Tdt}=nN;function xP(o){this.options=tL.assign({chunkSize:65536,windowBits:15,to:""},o||{});const s=this.options;s.raw&&s.windowBits>=0&&s.windowBits<16&&(s.windowBits=-s.windowBits,s.windowBits===0&&(s.windowBits=-15)),!(s.windowBits>=0&&s.windowBits<16)||o&&o.windowBits||(s.windowBits+=32),s.windowBits>15&&s.windowBits<48&&!(15&s.windowBits)&&(s.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new oY,this.strm.avail_out=0;let d=VR.inflateInit2(this.strm,s.windowBits);if(d!==MP)throw new Error(XI[d]);if(this.header=new _dt,VR.inflateGetHeader(this.strm,this.header),s.dictionary&&(typeof s.dictionary=="string"?s.dictionary=PP.string2buf(s.dictionary):_Y.call(s.dictionary)==="[object ArrayBuffer]"&&(s.dictionary=new Uint8Array(s.dictionary)),s.raw&&(d=VR.inflateSetDictionary(this.strm,s.dictionary),d!==MP)))throw new Error(XI[d])}function WF(o,s){const d=new xP(s);if(d.push(o),d.err)throw d.msg||XI[d.err];return d.result}xP.prototype.push=function(o,s){const d=this.strm,g=this.options.chunkSize,b=this.options.dictionary;let $,Vt,zt;if(this.ended)return!1;for(Vt=s===~~s?s:s===!0?ydt:vdt,_Y.call(o)==="[object ArrayBuffer]"?d.input=new Uint8Array(o):d.input=o,d.next_in=0,d.avail_in=d.input.length;;){for(d.avail_out===0&&(d.output=new Uint8Array(g),d.next_out=0,d.avail_out=g),$=VR.inflate(d,Vt),$===GF&&b&&($=VR.inflateSetDictionary(d,b),$===MP?$=VR.inflate(d,Vt):$===vY&&($=GF));d.avail_in>0&&$===BF&&d.state.wrap>0&&o[d.next_in]!==0;)VR.inflateReset(d),$=VR.inflate(d,Vt);switch($){case Sdt:case vY:case GF:case Tdt:return this.onEnd($),this.ended=!0,!1}if(zt=d.avail_out,d.next_out&&(d.avail_out===0||$===BF))if(this.options.to==="string"){let _e=PP.utf8border(d.output,d.next_out),_r=d.next_out-_e,_o=PP.buf2string(d.output,_e);d.next_out=_r,d.avail_out=g-_r,_r&&d.output.set(d.output.subarray(_e,_e+_r),0),this.onData(_o)}else this.onData(d.output.length===d.next_out?d.output:d.output.subarray(0,d.next_out));if($!==MP||zt!==0){if($===BF)return $=VR.inflateEnd(this.strm),this.onEnd($),this.ended=!0,!0;if(d.avail_in===0)break}}return!0},xP.prototype.onData=function(o){this.chunks.push(o)},xP.prototype.onEnd=function(o){o===MP&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=tL.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg};var bdt={Inflate:xP,inflate:WF,inflateRaw:function(o,s){return(s=s||{}).raw=!0,WF(o,s)},ungzip:WF,constants:nN};const{Deflate:Yht,deflate:Rdt,deflateRaw:Jht,gzip:Xht}=odt,{Inflate:Qht,inflate:Cdt,inflateRaw:Zht,ungzip:$ht}=bdt;var wdt=Rdt,Idt=Cdt;const nT={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function R_(){return nT}function yY(){return"setSinkId"in HTMLAudioElement.prototype&&(!cE("RESTRICTION_SET_PLAYBACK_DEVICE")||(_w()||D8())&&!yV())}let ZS=function(o){return o.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",o.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",o.IOS_INTERRUPTION_START="ios-interruption-start",o.IOS_INTERRUPTION_END="ios-interruption-end",o.STATE_CHANGE="state-change",o}({});function sN(o,s,d){return{sampleRate:o,stereo:s,bitrate:d}}function I_(o,s,d,g,b){return{width:o,height:s,frameRate:d,bitrateMin:g,bitrateMax:b}}function k0(o,s,d,g,b){return{width:{max:o},height:{max:s},frameRate:d,bitrateMin:g,bitrateMax:b}}function qF(o,s){return{numSpatialLayers:o,numTemporalLayers:s}}const Odt={"90p":I_(160,90),"90p_1":I_(160,90),"120p":I_(160,120,15,30,65),"120p_1":I_(160,120,15,30,65),"120p_3":I_(120,120,15,30,50),"120p_4":I_(212,120),"180p":I_(320,180,15,30,140),"180p_1":I_(320,180,15,30,140),"180p_3":I_(180,180,15,30,100),"180p_4":I_(240,180,15,30,120),"240p":I_(320,240,15,40,200),"240p_1":I_(320,240,15,40,200),"240p_3":I_(240,240,15,40,140),"240p_4":I_(424,240,15,40,220),"360p":I_(640,360,15,80,400),"360p_1":I_(640,360,15,80,400),"360p_3":I_(360,360,15,80,260),"360p_4":I_(640,360,30,80,600),"360p_6":I_(360,360,30,80,400),"360p_7":I_(480,360,15,80,320),"360p_8":I_(480,360,30,80,490),"360p_9":I_(640,360,15,80,800),"360p_10":I_(640,360,24,80,800),"360p_11":I_(640,360,24,80,1e3),"480p":I_(640,480,15,100,500),"480p_1":I_(640,480,15,100,500),"480p_2":I_(640,480,30,100,1e3),"480p_3":I_(480,480,15,100,400),"480p_4":I_(640,480,30,100,750),"480p_6":I_(480,480,30,100,600),"480p_8":I_(848,480,15,100,610),"480p_9":I_(848,480,30,100,930),"480p_10":I_(640,480,10,100,400),"720p":I_(1280,720,15,120,1130),"720p_auto":I_(1280,720,30,900,3e3),"720p_1":I_(1280,720,15,120,1130),"720p_2":I_(1280,720,30,120,2e3),"720p_3":I_(1280,720,30,120,1710),"720p_5":I_(960,720,15,120,910),"720p_6":I_(960,720,30,120,1380),"1080p":I_(1920,1080,15,120,2080),"1080p_1":I_(1920,1080,15,120,2080),"1080p_2":I_(1920,1080,30,120,3e3),"1080p_3":I_(1920,1080,30,120,3150),"1080p_5":I_(1920,1080,60,120,4780),"1440p":I_(2560,1440,30,120,4850),"1440p_1":I_(2560,1440,30,120,4850),"1440p_2":I_(2560,1440,60,120,7350),"4k":I_(3840,2160,30,120,8910),"4k_1":I_(3840,2160,30,120,8910),"4k_3":I_(3840,2160,60,120,13500)},uL=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],Adt={"480p":k0(640,480,5),"480p_1":k0(640,480,5),"480p_2":k0(640,480,30),"480p_3":k0(640,480,15),"720p":k0(1280,720,5),"720p_auto":I_(1280,720,30,900,3e3),"720p_1":k0(1280,720,5),"720p_2":k0(1280,720,30),"720p_3":k0(1280,720,15),"1080p":k0(1920,1080,5),"1080p_1":k0(1920,1080,5),"1080p_2":k0(1920,1080,30),"1080p_3":k0(1920,1080,15)},Ndt={"1SL1TL":qF(1,1),"3SL3TL":qF(3,3),"2SL3TL":qF(2,3)};function vR(o){return o||(o="480p_1"),typeof o=="string"?Object.assign({},Odt[o]):o}function HF(o){return typeof o=="string"?Object.assign({},Adt[o]):o}function lL(o){return typeof o=="string"?Object.assign({},Ndt[o]):o}const kdt={speech_low_quality:sN(16e3,!1),speech_standard:sN(32e3,!1,18),music_standard:sN(48e3,!1),standard_stereo:sN(48e3,!0,56),high_quality:sN(48e3,!1,128),high_quality_stereo:sN(48e3,!0,192)};function dL(o){return typeof o=="string"?Object.assign({},kdt[o]):o}const aN=[];function SY(o){return VS(o,"mediaSource",["screen","window","application"]),!0}let YE=function(o){return o.NEED_RENEGOTIATE="@need_renegotiate",o.NEED_REPLACE_TRACK="@need_replace_track",o.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",o.NEED_CLOSE="@need_close",o.NEED_ENABLE_TRACK="@need_enable_track",o.NEED_DISABLE_TRACK="@need_disable_track",o.NEED_SESSION_ID="@need_sid",o.SET_OPTIMIZATION_MODE="@set_optimization_mode",o.GET_STATS="@get_stats",o.GET_RTC_STATS="@get_rtc_stats",o.GET_LOW_VIDEO_TRACK="@get_low_video_track",o.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",o.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",o.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",o.NEED_MUTE_TRACK="@need_mute_track",o.NEED_UNMUTE_TRACK="@need_unmute_track",o}({}),Z_=function(o){return o.SCREEN_TRACK="screen_track",o.CUSTOM_TRACK="custome_track",o.LOW_STREAM="low_stream",o}({}),cN=function(o){return o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM",o}({}),Pdt=function(o){return o[o.HIGH_STREAM=0]="HIGH_STREAM",o[o.LOW_STREAM=1]="LOW_STREAM",o}({}),Ddt=function(o){return o[o.DISABLE=0]="DISABLE",o[o.LOW_STREAM=1]="LOW_STREAM",o[o.AUDIO_ONLY=2]="AUDIO_ONLY",o}({}),nO=function(o){return o.TRANSCEIVER_UPDATED="transceiver-updated",o.SEI_TO_SEND="sei-to-send",o.SEI_RECEIVED="sei-received",o.TRACK_UPDATED="track-updated",o}({}),uN=function(o){return o.SOURCE_STATE_CHANGE="source-state-change",o.TRACK_ENDED="track-ended",o.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",o.CLOSED="closed",o}({}),lN=function(o){return o.FIRST_FRAME_DECODED="first-frame-decoded",o.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",o.VIDEO_STATE_CHANGED="video-state-changed",o}({}),YT=function(o){return o.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",o.RECEIVE_TRACK_BUFFER="receive_track_buffer",o.ON_AUDIO_BUFFER="on_audio_buffer",o.UPDATE_SOURCE="update_source",o}({});(function(o){o.UPDATE_TRACK_SOURCE="update-track-source"})({});const KF={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},zF={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},TY={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Ldt={uplinkNetworkQuality:0,downlinkNetworkQuality:0},bY={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let TT=function(o){return o.ON_TRACK="on_track",o.ON_NODE="on_node",o}({}),JT=function(o){return o.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",o.REQUEST_CONSTRAINTS="request_constraints",o}({}),UP=function(o){return o.IDLE="IDLE",o.INITING="INITING",o.INITEND="INITEND",o}({}),rO=function(o){return o.STATE_CHANGE="state_change",o.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",o.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",o.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",o}({}),fT=function(o){return o.NONE="none",o.INIT="init",o.CANPLAY="canplay",o.PLAYING="playing",o.PAUSED="paused",o.SUSPEND="suspend",o.STALLED="stalled",o.WAITING="waiting",o.ERROR="error",o.DESTROYED="destroyed",o.ABORT="abort",o.ENDED="ended",o.EMPTIED="emptied",o.LOADEDDATA="loadeddata",o}({}),yR=function(o){return o[o.VideoStateStopped=0]="VideoStateStopped",o[o.VideoStateStarting=1]="VideoStateStarting",o[o.VideoStateDecoding=2]="VideoStateDecoding",o[o.VideoStateFrozen=3]="VideoStateFrozen",o}({});const YF={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let hL=function(o){return o.OPEN="open",o.MESSAGE="message",o.CLOSE="close",o.CLOSING="closing",o.ERROR="error",o}({});function RY(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function rS(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?RY(Object(d),!0).forEach(function(g){bE(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):RY(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}function bE(o,s,d){return(s=function(g){var b=function($,Vt){if(typeof $!="object"||$===null)return $;var zt=$[Symbol.toPrimitive];if(zt!==void 0){var _e=zt.call($,"string");if(typeof _e!="object")return _e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String($)}(g);return typeof b=="symbol"?b:String(b)}(s))in o?Object.defineProperty(o,s,{value:d,enumerable:!0,configurable:!0,writable:!0}):o[s]=d,o}function C_(o,s,d,g,b){var $,Vt,zt={};return Object.keys(g).forEach(function(_e){zt[_e]=g[_e]}),zt.enumerable=!!zt.enumerable,zt.configurable=!!zt.configurable,("value"in zt||zt.initializer)&&(zt.writable=!0),zt=F0($=Eut(Vt=d.slice()).call(Vt)).call($,function(_e,_r){return _r(o,s,_e)||_e},zt),b&&zt.initializer!==void 0&&(zt.value=zt.initializer?zt.initializer.call(b):void 0,zt.initializer=void 0),zt.initializer===void 0&&(Object.defineProperty(o,s,zt),zt=null),zt}class CY extends nS{set _mediaStreamTrack(s){s!==this.mediaStreamTrack&&(this.safeEmit(nO.TRACK_UPDATED,s),this.mediaStreamTrack=s)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(s,d){super(),bE(this,"trackMediaType",void 0),bE(this,"_ID",void 0),bE(this,"_rtpTransceiver",void 0),bE(this,"_lowRtpTransceiver",void 0),bE(this,"_hints",[]),bE(this,"_isClosed",!1),bE(this,"_originMediaStreamTrack",void 0),bE(this,"mediaStreamTrack",void 0),bE(this,"_external",{}),this._ID=d||z_(8,"track-"),this._originMediaStreamTrack=s,this.mediaStreamTrack=s,function(g){KE(aN).call(aN,g)||aN.push(g)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(s){return s||eI(()=>{var d;t_.reportApiInvoke(null,{name:NS.GET_MEDIA_STREAM_TRACK,options:[],tag:hS.TRACER}).onSuccess(((d=this._mediaStreamTrack)===null||d===void 0?void 0:d.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(s){return s===cN.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(s){const d=aN.indexOf(s);d!==-1&&aN.splice(d,1)}(this),this.emit(uN.CLOSED),this.removeAllListeners(nO.SEI_RECEIVED)}_updateRtpTransceiver(s,d){if(d===cN.LOW_STREAM){if(this._lowRtpTransceiver===s)return;this._lowRtpTransceiver=s}else{if(this._rtpTransceiver===s)return;this._rtpTransceiver=s}this.emit(nO.TRANSCEIVER_UPDATED,s,d)}}class dN extends CY{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(s,d){super(s,d),bE(this,"_enabled",!0),bE(this,"_muted",!1),bE(this,"_isExternalTrack",!1),bE(this,"_isClosed",!1),bE(this,"_enabledMutex",void 0),bE(this,"processor",void 0),bE(this,"_processorContext",void 0),bE(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new KS("".concat(this.getTrackId())),s.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var s,d;return(s=(d=this._originMediaStreamTrack)===null||d===void 0?void 0:d.label)!==null&&s!==void 0?s:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,_l.debug("[".concat(this.getTrackId(),"] close")),this.emit(YE.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(s,d){let g=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=g,s!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),d&&this._originMediaStreamTrack.stop()),s.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=s,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await K_(this,YE.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){_l.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(uN.TRACK_ENDED)}stateCheck(s,d){if(_l.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(s,": ").concat(d,"]")),NR(d,s),this._enabled&&this._muted&&s==="enabled"&&d===!1)throw new TE(rE.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",_l);if(!this._enabled&&!this._muted&&s==="muted"&&d===!0)throw new TE(rE.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",_l)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():GE.resolve([])}}const wY=window.AudioContext||window.webkitAudioContext;let XT=null;const B_=new class extends nS{constructor(){super(...arguments),bE(this,"prevState",void 0),bE(this,"curState",void 0),bE(this,"currentTime",void 0),bE(this,"currentTimeStuckAt",void 0),bE(this,"interruptDetectorTrack",void 0),bE(this,"onLocalAudioTrackMute",()=>{_l.info("ios15-interruption-start"),this.emit(ZS.IOS_15_16_INTERRUPTION_START)}),bE(this,"onLocalAudioTrackUnmute",async()=>{_l.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?_l.info("ios15-interruption-end-canceled"):(XT&&await XT.suspend(),this.emit(ZS.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(o){_l.debug("webaudio bindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=o,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(o){_l.debug("webaudio unbindInterruptDetectorTrack ".concat(o.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===o&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function hN(){if(!XT){if(function(){if(!wY)return void _l.error("your browser is not support web audio");_l.info("create audio context");const o=rS({},cE("WEBAUDIO_INIT_OPTIONS"));_l.debug("audio context init option:",JSON.stringify(o)),XT=new wY(o),B_.curState=XT.state,XT.onstatechange=()=>{B_.prevState=B_.curState,B_.curState=XT?XT.state:void 0;const{prevState:s,curState:d}=B_,g=d==="running",b=d==="interrupted",$=s==="running",Vt=s==="suspended",zt=s==="interrupted",_e=O_().osVersion;(oT()||v0())&&$&&b&&(_l.info("ios".concat(_e,"-interruption-start")),B_.emit(ZS.IOS_INTERRUPTION_START)),(oT()||v0())&&(Vt||zt)&&g&&(_l.info("ios".concat(_e,"-interruption-end")),B_.emit(ZS.IOS_INTERRUPTION_END)),s!==d&&B_.emit(ZS.STATE_CHANGE,d,s)},setInterval(()=>{var s;const d=(s=XT)===null||s===void 0?void 0:s.currentTime;B_.currentTime!==d?(B_.currentTimeStuckAt&&(_l.debug("AudioContext current time resume at ".concat(d)),B_.currentTimeStuckAt=void 0),B_.currentTime=d):(d!==B_.currentTimeStuckAt&&(t_.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:d},tag:hS.TRACER}).onSuccess(),_l.warning("AudioContext current time stuck at ".concat(d))),B_.currentTimeStuckAt=d)},5e3),async function(s){const d=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let g,b=!1,$=!1,Vt=!1;function zt(_p){s.state==="running"?_e(!1):oT()||v0()?s.state==="suspended"&&(_e(!0),_p&&s.resume().then(_r,_r)):s.state!=="closed"&&(_e(!0),_p&&s.resume().then(_r,_r))}function _e(_p){if(b!==_p){b=_p;for(let _f=0,eE=d;_f<eE.length;_f+=1){const iE=eE[_f];_p?window.addEventListener(iE,_o,{capture:!0,passive:!0}):window.removeEventListener(iE,_o,{capture:!0,passive:!0})}}}function _r(){zt(!1)}function _o(){zt(!0)}function ga(_p){if(!Vt)if(g.paused)if(_p){let _f;_a(!1),Vt=!0;try{_f=g.play(),_f?_f.then(_c,_c):(g.addEventListener("playing",_c),g.addEventListener("abort",_c),g.addEventListener("error",_c))}catch{_c()}}else _a(!0);else _a(!1)}function _a(_p){if($!==_p){$=_p;for(let _f=0,eE=d;_f<eE.length;_f++){const iE=eE[_f];_p?window.addEventListener(iE,tE,{capture:!0,passive:!0}):window.removeEventListener(iE,tE,{capture:!0,passive:!0})}}}function _c(){g.removeEventListener("playing",_c),g.removeEventListener("abort",_c),g.removeEventListener("error",_c),Vt=!1,ga(!1)}function tE(){ga(!0)}if(oT()){const _p=s.createMediaStreamDestination(),_f=document.createElement("div");_f.innerHTML="<audio x-webkit-airplay='deny'></audio>",g=_f.children.item(0),g.controls=!1,g.disableRemotePlayback=!0,g.preload="auto",g.srcObject=_p.stream,ga(!0)}B_.on(ZS.STATE_CHANGE,function(){zt(!0)}),zt(!1)}(XT)}(),!XT)throw new TE(rE.NOT_SUPPORTED,"can not create audio context");return XT}return XT}function iO(o){if(function(){if(JF!==null)return JF;const g=hN(),b=g.createBufferSource(),$=g.createGain(),Vt=g.createGain();b.connect($),b.connect(Vt),b.disconnect($);let zt=!1;try{b.disconnect($)}catch{zt=!0}return b.disconnect(),JF=zt,zt}())return;const s=o.connect,d=o.disconnect;o.connect=(g,b,$)=>{var Vt;return o._inputNodes||(o._inputNodes=[]),KE(Vt=o._inputNodes).call(Vt,g)||(g instanceof AudioNode?(o._inputNodes.push(g),s.call(o,g,b,$)):s.call(o,g,b)),o},o.disconnect=(g,b,$)=>{d.call(o),g?yD(o._inputNodes,g):o._inputNodes=[];for(const Vt of o._inputNodes)s.call(o,Vt)}}let JF=null;function XF(o,s){let d=!1;const g=1/s;if(cE("DISABLE_WEBAUDIO")){const b=window.setInterval(()=>{d?window.clearInterval(b):o(performance.now()/1e3)},1e3*g)}else{const b=hN();let $=b.createGain();$.gain.value=0,$.connect(b.destination);const Vt=()=>{if(d)return void($=null);const zt=b.createOscillator();zt.onended=Vt,zt.connect($),zt.start(0),zt.stop(b.currentTime+g),o(b.currentTime)};Vt()}return()=>{d=!0}}class IY{constructor(){bE(this,"context",void 0),bE(this,"analyserNode",void 0),bE(this,"sourceNode",void 0),this.context=hN(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(s){if(s!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=s,s==null||s.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||oT()||v0()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const s=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(s);else{const g=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(g);for(let b=0;b<s.length;++b)s[b]=g[b]/128-1}const d=F0(s).call(s,(g,b)=>g+b*b,0)/s.length;return Math.max(10*Math.log10(d)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var s,d;(s=this.sourceNode)===null||s===void 0||s.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(d=this.sourceNode)===null||d===void 0||d.connect(this.analyserNode)}catch{_l.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class OY extends nS{get processSourceNode(){return this.sourceNode}set processedNode(s){var d;if(!this.isDestroyed&&this._processedNode!==s){try{var g;(g=this.sourceNode)===null||g===void 0||g.disconnect(this.outputNode)}catch{}(d=this._processedNode)===null||d===void 0||d.disconnect(),this._processedNode=s,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),bE(this,"outputNode",void 0),bE(this,"outputTrack",void 0),bE(this,"isPlayed",!1),bE(this,"sourceNode",void 0),bE(this,"context",void 0),bE(this,"audioBufferNode",void 0),bE(this,"destNode",void 0),bE(this,"audioOutputLevel",0),bE(this,"volumeLevelAnalyser",void 0),bE(this,"_processedNode",void 0),bE(this,"playNode",void 0),bE(this,"isDestroyed",!1),bE(this,"onNoAudioInput",void 0),bE(this,"isNoAudioInput",!1),bE(this,"_noAudioInputCount",0),this.context=hN(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),iO(this.outputNode),this.volumeLevelAnalyser=new IY}startGetAudioBuffer(s){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(s),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=d=>{this.emit(YT.ON_AUDIO_BUFFER,function(g){for(let b=0;b<g.outputBuffer.numberOfChannels;b+=1){const $=g.outputBuffer.getChannelData(b);for(let Vt=0;Vt<$.length;Vt+=1)$[Vt]=0}return g.inputBuffer}(d))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!R_().webAudioMediaStreamDest)throw new TE(rE.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(s){this.context.state!=="running"&&SD(()=>{B_.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=s||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(s>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;oT()||v0()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const d=this.volumeLevelAnalyser.getAnalyserNode();let g;d.getFloatTimeDomainData?(g=new Float32Array(d.fftSize),d.getFloatTimeDomainData(g)):(g=new Uint8Array(d.fftSize),d.getByteTimeDomainData(g));let b=!1;for(let $=0;$<g.length;$++)g[$]!==0&&(b=!0);return b?(this.isNoAudioInput=!1,!0):(await WS(200),await this.checkHasAudioInput(s?s+1:1)&&b)}getAudioVolume(){return this.outputNode.gain.value}setVolume(s){this.outputNode.gain.setValueAtTime(s,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var s,d;(s=this.processedNode)===null||s===void 0||s.disconnect(),(d=this.sourceNode)===null||d===void 0||d.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var s;this.processedNode?(s=this.processedNode)===null||s===void 0||s.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class AY extends OY{get isFreeze(){return!1}constructor(s,d,g){var b;if(super(),bE(this,"sourceNode",void 0),bE(this,"track",void 0),bE(this,"clonedTrack",void 0),bE(this,"audioElement",void 0),bE(this,"isCurrentTrackCloned",!1),bE(this,"isRemoteTrack",!1),bE(this,"originVolumeLevelAnalyser",void 0),bE(this,"rebuildWebAudio",async()=>{if(_l.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void _l.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>_l.info("resume success")),_l.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const zt=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?zt.stop():this.isCurrentTrackCloned=!0;const _e=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_e),iO(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const _r=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(_r,this.context.currentTime),iO(this.outputNode),this.emit(YT.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_e,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),s.kind!=="audio")throw new TE(rE.UNEXPECTED_ERROR);this.track=s;const $=new MediaStream([this.track]);if(this.isRemoteTrack=!!d,this.sourceNode=this.context.createMediaStreamSource($),iO(this.sourceNode),g){const zt=g.clone();zt.enabled=!0,this.clonedTrack=zt,_l.debug("create an unmuted track ".concat(zt.id," from the original track ").concat(g.id," to get the volume"));const _e=this.context.createMediaStreamSource(new MediaStream([zt]));iO(_e),this.originVolumeLevelAnalyser=new IY,this.originVolumeLevelAnalyser.updateSource(_e)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=$;const Vt=O_();d&&Vt.os===BS.IOS&&Number((b=Vt.osVersion)===null||b===void 0?void 0:b.split(".")[0])<15&&(B_.on(ZS.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(zt=>{zt||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(s){this.sourceNode.disconnect(),this.track=s,this.isCurrentTrackCloned=!1;const d=new MediaStream([s]);this.sourceNode=this.context.createMediaStreamSource(d),iO(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(YT.UPDATE_SOURCE),this.audioElement.srcObject=d}destroy(){var s;this.audioElement.srcObject=null,this.audioElement.remove(),B_.off("state-change",this.rebuildWebAudio),(s=this.originVolumeLevelAnalyser)===null||s===void 0||s.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(s){return this.context.createMediaStreamSource(new MediaStream([s]))}updateOriginTrack(s){const d=s.clone();d.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=d),_l.debug("create an unmuted track ".concat(d.id," from the original track ").concat(s.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([d]));iO(g),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(g)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function NY(o,s,d){const g=($,Vt)=>$?typeof $!="number"?$.max||$.exact||$.ideal||$.min||Vt:$:Vt,b={audio:!!d&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxHeight:g(s.height,1080),maxWidth:g(s.width,1920)}}};return s.frameRate&&typeof s.frameRate!="number"?(b.video.mandatory.maxFrameRate=s.frameRate.max,b.video.mandatory.minFrameRate=s.frameRate.min):typeof s.frameRate=="number"&&(b.video.mandatory.maxFrameRate=s.frameRate),await navigator.mediaDevices.getUserMedia(b)}async function Mdt(o,s){const d=await kY(o.mediaSource),{sourceId:g,audio:b}=await function($){let Vt=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new GE((zt,_e)=>{const _r=document.createElement("div");_r.innerText="share screen",_r.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const _o=document.createElement("div");_o.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const ga=document.createElement("div");ga.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",ga.setAttribute("style","height: 12%;");const _a=document.createElement("div");_a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const _c=document.createElement("div");_c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const tE=document.createElement("button");tE.innerHTML="cancel",tE.setAttribute("style","width: 85px;"),tE.onclick=()=>{document.body.removeChild(eE);const iE=new Error("NotAllowedError");iE.name="NotAllowedError",_e(iE)};let _p=Vt;const _f=document.createElement("div");if(Vt){const iE=document.createElement("input");iE.setAttribute("type","checkbox");const fE=document.createElement("span");iE.setAttribute("style","margin-right: 6px;"),fE.innerText="Share audio",iE.checked=_p,iE.onchange=()=>{_p=iE.checked},_f.appendChild(iE),_f.appendChild(fE)}_c.appendChild(_f),_c.appendChild(tE),_o.appendChild(ga),_o.appendChild(_a),_o.appendChild(_c);const eE=document.createElement("div");eE.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),eE.appendChild(_r),eE.appendChild(_o),document.body.appendChild(eE),$.map(iE=>{if(iE.id){const fE=document.createElement("div");fE.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let mE=iE.thumbnail;try{const{width:_E}=mE.getSize();_E>1920&&(mE=mE.resize({width:1920}))}catch(_E){throw _E&&_E.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),_E}fE.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+mE.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+iE.name.replace(/[\u00A0-\u9999<>\&]/g,function(_E){return"&#"+_E.charCodeAt(0)+";"})+"</span>",fE.onclick=()=>{document.body.removeChild(eE),zt({sourceId:iE.id,audio:_p})},_a.appendChild(fE)}})})}(d,s);return await NY(g,o,b)}async function kY(o){let s=["window","screen"];o!=="application"&&o!=="window"||(s=["window"]),o==="screen"&&(s=["screen"]);const d=X8();if(!d)throw console.error("failed to fetch electron, please mount it to window"),new TE(rE.ELECTRON_IS_NULL);let g=null;try{var b;g=((b=d.desktopCapturer)===null||b===void 0?void 0:b.getSources({types:s}))||d.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:s})}catch{g=null}g&&g.then||(g=new GE(($,Vt)=>{d.desktopCapturer.getSources({types:s},(zt,_e)=>{zt?Vt(zt):$(_e)})}));try{return await g}catch($){throw new TE(rE.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,$.toString())}}const QF=new KS("safari");let PY=!1,DY=!1;async function QT(o,s){let d=0,g=null;for(;d<2;)try{g=await xdt(o,s,d>0);break}catch(b){if(b instanceof TE)throw _l.error("[".concat(s,"] ").concat(b.toString())),b;const $=pL(b.name||b.code||b,b.message);if($.code===rE.MEDIA_OPTION_INVALID){_l.debug("[".concat(s,"] detect media option invalid, retry")),d+=1,await WS(500);continue}throw _l.error("[".concat(s,"] ").concat($.toString())),$}if(!g)throw new TE(rE.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return g}async function xdt(o,s,d){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new TE(rE.NOT_SUPPORTED,"can not find getUserMedia");d&&(o.video&&(delete o.video.width,delete o.video.height),o.screen&&(delete o.screen.width,delete o.screen.height));const g=R_(),b=new MediaStream;if(o.audioSource&&b.addTrack(o.audioSource),o.videoSource&&b.addTrack(o.videoSource),!o.audio&&!o.video&&!o.screen)return _l.debug("Using Video Source/ Audio Source"),b;if(o.screen)if(X8())o.screen.sourceId?pN(b,await NY(o.screen.sourceId,o.screen,o.screenAudio)):pN(b,await Mdt(o.screen,o.screenAudio));else if(_w()&&o.screen.extensionId&&o.screen.mandatory){if(!g.getStreamFromExtension)throw new TE(rE.NOT_SUPPORTED,"This browser does not support screen sharing");_l.debug("[".concat(s,'] Screen access on chrome stable, looking for extension"'));const _a=await(Vt=o.screen.extensionId,zt=s,new GE((_c,tE)=>{try{chrome.runtime.sendMessage(Vt,{getStream:!0},_p=>{if(!_p||!_p.streamId)return _l.error("[".concat(zt,"] No response from Chrome Plugin. Plugin not installed properly"),_p),void tE(new TE(rE.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));_c(_p.streamId)})}catch(_p){_l.error("[".concat(zt,"] AgoraRTC screensharing plugin is not accessible(").concat(Vt,")"),_p.toString()),tE(new TE(rE.CHROME_PLUGIN_NOT_INSTALL))}}));o.screen.mandatory.chromeMediaSourceId=_a,pN(b,await navigator.mediaDevices.getUserMedia({video:{mandatory:o.screen.mandatory}}))}else if(g.getDisplayMedia){var $;o.screen.mediaSource&&SY(o.screen.mediaSource);const _a={width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate,displaySurface:($=o.screen.displaySurface)!==null&&$!==void 0?$:o.screen.mediaSource==="screen"?"monitor":o.screen.mediaSource},{selfBrowserSurface:_c,surfaceSwitching:tE,systemAudio:_p}=o.screen,_f={selfBrowserSurface:_c,surfaceSwitching:tE,systemAudio:_p};!_c&&delete _f.selfBrowserSurface,!tE&&delete _f.surfaceSwitching,!_p&&delete _f.systemAudio,_l.debug("[".concat(s,"] getDisplayMedia:"),JSON.stringify({video:_a,audio:!!o.screenAudio,controls:_f})),pN(b,await navigator.mediaDevices.getDisplayMedia(rS({video:_a,audio:!!o.screenAudio},_f)))}else{if(!H_())throw _l.error("[".concat(s,"] This browser does not support screenSharing")),new TE(rE.NOT_SUPPORTED,"This browser does not support screen sharing");{o.screen.mediaSource&&SY(o.screen.mediaSource);const _a={video:{mediaSource:o.screen.mediaSource,width:o.screen.width,height:o.screen.height,frameRate:o.screen.frameRate}};_l.debug("[".concat(s,"] getUserMedia: ").concat(JSON.stringify(_a))),pN(b,await navigator.mediaDevices.getUserMedia(_a))}}var Vt,zt;if(!o.video&&!o.audio)return b;let _e={video:o.video,audio:o.audio},_r=cE("MEDIA_DEVICE_CONSTRAINTS");if(_r)try{typeof _r=="string"&&(_r=JSON.parse(_r)),_e=CV(_e,_r)}catch{}_l.debug("[".concat(s,"] GetUserMedia"),JSON.stringify(_e)),O_();let _o,ga=null;(GS()||oT()||_D())&&(ga=await QF.lock());try{_o=await navigator.mediaDevices.getUserMedia(_e)}catch(_a){throw ga&&ga(),_a}return _e.audio&&(PY=!0),_e.video&&(DY=!0),pN(b,_o),ga&&ga(),b}function pL(o,s){switch(o){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new TE(rE.MEDIA_OPTION_INVALID,"".concat(o,": ").concat(s));case"NotFoundError":case"DevicesNotFoundError":return new TE(rE.DEVICE_NOT_FOUND,"".concat(o,": ").concat(s));case"NotSupportedError":return new TE(rE.NOT_SUPPORTED,"".concat(o,": ").concat(s));case"NotReadableError":return new TE(rE.NOT_READABLE,"".concat(o,": ").concat(s));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new TE(rE.PERMISSION_DENIED,"".concat(o,": ").concat(s));case"ConstraintNotSatisfiedError":return new TE(rE.CONSTRAINT_NOT_SATISFIED,"".concat(o,": ").concat(s));default:return _l.error("getUserMedia unexpected error",o),new TE(rE.UNEXPECTED_ERROR,"".concat(o,": ").concat(s))}}function pN(o,s){const d=o.getVideoTracks()[0],g=o.getAudioTracks()[0],b=s.getVideoTracks()[0],$=s.getAudioTracks()[0];$&&(g&&o.removeTrack(g),o.addTrack($)),b&&(d&&o.removeTrack(d),o.addTrack(b))}const ZT=new class extends nS{get state(){return this._state}set state(o){o!==this._state&&(this.emit(rO.STATE_CHANGE,o),this._state=o)}constructor(){super(),bE(this,"_state",UP.IDLE),bE(this,"isAccessMicrophonePermission",!1),bE(this,"isAccessCameraPermission",!1),bE(this,"lastAccessMicrophonePermission",!1),bE(this,"lastAccessCameraPermission",!1),bE(this,"checkdeviceMatched",!1),bE(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(cE("ENUMERATE_DEVICES_INTERVAL")||(vD()||ED()===BS.HARMONY_OS)&&tI())&&this.updateDevicesInfo()},cE("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(o=>_l.error(o.toString()))}async enumerateDevices(o,s){let d=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new TE(rE.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const g=await navigator.mediaDevices.enumerateDevices(),b=this.checkMediaDeviceInfoIsOk(g);let $=!this.isAccessMicrophonePermission&&o,Vt=!this.isAccessCameraPermission&&s;b.audio&&($=!1),b.video&&(Vt=!1);let zt=null,_e=null,_r=null;if(!d&&($||Vt)){if(QF.isLocked&&(_l.debug("[device manager] wait GUM lock"),(await QF.lock())(),_l.debug("[device manager] GUM unlock")),PY&&($=!1,this.isAccessMicrophonePermission=!0),DY&&(Vt=!1,this.isAccessCameraPermission=!0),_l.debug("[device manager] check media device permissions",o,s,$,Vt),$&&Vt){try{_r=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_o){const ga=pL(_o.name||_o.code||_o,_o.message);if(ga.code===rE.PERMISSION_DENIED)throw ga;_l.warning("getUserMedia failed in getDevices",ga)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if($){try{zt=await navigator.mediaDevices.getUserMedia({audio:o})}catch(_o){const ga=pL(_o.name||_o.code||_o,_o.message);if(ga.code===rE.PERMISSION_DENIED)throw ga;_l.warning("getUserMedia failed in getDevices",ga)}this.isAccessMicrophonePermission=!0}else if(Vt){try{_e=await navigator.mediaDevices.getUserMedia({video:s})}catch(_o){const ga=pL(_o.name||_o.code||_o,_o.message);if(ga.code===rE.PERMISSION_DENIED)throw ga;_l.warning("getUserMedia failed in getDevices",ga)}this.isAccessCameraPermission=!0}_l.debug("[device manager] mic permission",o,"cam permission",s)}try{const _o=await navigator.mediaDevices.enumerateDevices();return zt&&zt.getTracks().forEach(ga=>ga.stop()),_e&&_e.getTracks().forEach(ga=>ga.stop()),_r&&_r.getTracks().forEach(ga=>ga.stop()),zt=null,_e=null,_r=null,_o}catch(_o){return zt&&zt.getTracks().forEach(ga=>ga.stop()),_e&&_e.getTracks().forEach(ga=>ga.stop()),_r&&_r.getTracks().forEach(ga=>ga.stop()),zt=null,_e=null,_r=null,new TE(rE.ENUMERATE_DEVICES_FAILED,_o.toString()).throw()}}async getRecordingDevices(){let o=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,o)).filter(s=>s.kind==="audioinput")}async getCamerasDevices(){let o=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,o)).filter(s=>s.kind==="videoinput")}async getSpeakers(){let o=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,o)).filter(s=>s.kind==="audiooutput")}searchDeviceIdByName(o){let s=null;return this.deviceInfoMap.forEach(d=>{d.device.label===o&&(s=d.device.deviceId)}),s}async getDeviceById(o){const s=(await this.enumerateDevices(!0,!0,!0)).find(d=>d.deviceId===o);if(!s)throw new TE(rE.DEVICE_NOT_FOUND,"deviceId: ".concat(o));return s}async init(){this.state=UP.INITING;try{await this.updateDevicesInfo(),this.state=UP.INITEND}catch(o){throw _l.warning("Device Detection functionality cannot start properly.",o.toString()),this.state=UP.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new TE(rE.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),o}}async updateDevicesInfo(){const o=await this.enumerateDevices(!0,!0,!0),s=Date.now(),d=[];if(o[0]&&o[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const b=o.find(Vt=>Vt.kind==="audioinput"&&Vt.deviceId==="default"),$=o.find(Vt=>Vt.kind==="audiooutput"&&Vt.deviceId==="default");b&&$?$.groupId===b.groupId?_l.debug("[device-check] default input ".concat(b.label," and output ").concat($.label," is the same group")):_l.warning("[device-check] default input ".concat(b.label," and output ").concat($.label," is not the same group")):_l.debug("[device-check] default input or output not found")}const g=this.checkMediaDeviceInfoIsOk(o);if(o.forEach(b=>{if(!b.deviceId)return;const $=this.deviceInfoMap.get("".concat(b.kind,"_").concat(b.deviceId));if(($?$.state:"INACTIVE")!=="ACTIVE"){const Vt={initAt:s,updateAt:s,device:b,state:"ACTIVE"};this.deviceInfoMap.set("".concat(b.kind,"_").concat(b.deviceId),Vt),d.push(Vt)}$&&($.updateAt=s)}),this.deviceInfoMap.forEach((b,$)=>{b.state==="ACTIVE"&&b.updateAt!==s&&(b.state="INACTIVE",d.push(b))}),this.state!==UP.INITEND)return g.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(g.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));d.forEach(b=>{switch(b.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(rO.RECORDING_DEVICE_CHANGED,b);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(rO.CAMERA_DEVICE_CHANGED,b);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(rO.PLAYOUT_DEVICE_CHANGED,b)}}),g.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),g.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(o){const s=o.filter(b=>b.kind==="audioinput"),d=o.filter(b=>b.kind==="videoinput"),g={audio:!1,video:!1};for(const b of s)if(b.label&&b.deviceId){g.audio=!0;break}for(const b of d)if(b.label&&b.deviceId){g.video=!0;break}return g}};let ZF=!1;const $T=new class extends nS{constructor(){super(...arguments),bE(this,"onAutoplayFailed",void 0),bE(this,"onAudioAutoplayFailed",void 0)}};function LY(){if(O_(),!ZF){const o=s=>{s.preventDefault(),ZF=!1,nP()?document.body.removeEventListener("click",o,!0):(document.body.removeEventListener("touchstart",o,!0),document.body.removeEventListener("mousedown",o,!0))};ZF=!0,nP()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0)),_l.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),$T.onAutoplayFailed?$T.onAutoplayFailed():$T.onAudioAutoplayFailed?_l.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):_l.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),$T.emit("autoplay-failed")}}function MY(o,s,d,g){if(!o)return;const b=t_.getBaseInfoBySessionId(o);if(!b)return;const $=b.info,Vt=Date.now(),zt=rS(rS({},$),{},{vid:$.vid===void 0?0:Number($.vid),lts:Vt,elapse:Vt-b.startTime,cbRegistered:$T.onAutoplayFailed||$T.onAudioAutoplayFailed?1:-1,errorMsg:d,mediaType:s,trackId:g,extend:void 0});t_.send({type:cS.AUTOPLAY_FAILED,data:zt},!0)}const Udt=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],wT=new class{constructor(){bE(this,"onAutoplayFailed",void 0),bE(this,"elementMap",new Map),bE(this,"elementStateMap",new Map),bE(this,"elementsNeedToResume",[]),bE(this,"sinkIdMap",new Map),bE(this,"autoResumeAfterInterruption",o=>{Array.from(this.elementMap.entries()).forEach(s=>{let[d,g]=s;const b=this.elementStateMap.get(d),$=g.srcObject.getAudioTracks()[0],Vt=$&&$.readyState;if(_l.debug("resume after interrupted, ele: ".concat(b," audio: ").concat(Vt," ").concat(o)),Vt==="live"){if(o)return g.pause(),void g.play();if(B_.curState==="running")return UO()?(g.pause(),void g.play()):void(b&&b==="paused"&&g.play())}})}),bE(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(o=>{let[s,d]=o;const g=d.srcObject.getAudioTracks()[0];g&&g.readyState==="live"&&(_l.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),d.pause(),d.play())})}),this.autoResumeAudioElement(),B_.on(ZS.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),B_.on(ZS.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),B_.on(ZS.STATE_CHANGE,()=>{oT()&&B_.prevState==="suspended"&&B_.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(o,s){const d=this.elementMap.get(o);if(this.sinkIdMap.set(o,s),d)try{await d.setSinkId(s)}catch(g){throw new TE(rE.PERMISSION_DENIED,"can not set sink id: "+g.toString())}}play(o,s,d,g){if(this.elementMap.has(s))return;const b=document.createElement("audio");b.autoplay=!0,b.srcObject=new MediaStream([o]),this.bindAudioElementEvents(s,b),this.elementMap.set(s,b),this.elementStateMap.set(s,fT.INIT),this.setVolume(s,d);const $=this.sinkIdMap.get(s);if($)try{b.setSinkId($).catch(zt=>{_l.warning("[".concat(s,"] set sink id failed"),zt.toString())})}catch(zt){_l.warning("[".concat(s,"] set sink id failed"),zt.toString())}const Vt=b.play();Vt&&Vt.then&&Vt.catch(zt=>{g&&MY(g,"audio",zt.message,s),_l.warning("audio element play warning",zt.toString()),this.elementMap.has(s)&&zt.name==="NotAllowedError"&&(_l.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(b),SD(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),LY()}))})}updateTrack(o,s){const d=this.elementMap.get(o);d&&(d.srcObject=new MediaStream([s]))}isPlaying(o){return this.elementMap.has(o)&&this.elementStateMap.get(o)==="playing"}setVolume(o,s){const d=this.elementMap.get(o);d&&(s=Math.max(0,Math.min(100,s)),d.volume=s/100)}stop(o){const s=this.elementMap.get(o);if(this.sinkIdMap.delete(o),!s)return;const d=this.elementsNeedToResume.indexOf(s);this.elementsNeedToResume.splice(d,1),s.srcObject=null,s.remove(),this.elementMap.delete(o),this.elementStateMap.delete(o)}bindAudioElementEvents(o,s){Udt.forEach(d=>{s.addEventListener(d,g=>{const b=this.elementStateMap.get(o),$=g.type==="pause"?"paused":g.type;if(_l.debug("[".concat(o,"] audio-element-status change ").concat(b," => ").concat($)),g.type==="error"){const Vt=s==null?void 0:s.error;Vt&&_l.error("[".concat(o,"] media error, code: ").concat(Vt.code,", message: ").concat(Vt.message))}this.elementStateMap.set(o,$)})})}getPlayerState(o){return this.elementStateMap.get(o)||"uninit"}autoResumeAudioElement(){const o=()=>{this.elementsNeedToResume.forEach(s=>{s.play().then(d=>{_l.debug("Auto resume audio element success")}).catch(d=>{_l.warning("Auto resume audio element failed!",d)})}),this.elementsNeedToResume=[]};new GE(s=>{document.body?s():window.addEventListener("load",()=>s())}).then(()=>{nP()?document.body.addEventListener("click",o,!0):(document.body.addEventListener("touchstart",o,!0),document.body.addEventListener("mousedown",o,!0))})}};function yS(){return function(o,s,d){const g=d.value;return typeof g=="function"&&(d.value=function(){this._isClosed&&new TE(rE.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",_l);for(var b=arguments.length,$=new Array(b),Vt=0;Vt<b;Vt++)$[Vt]=arguments[Vt];const zt=g.apply(this,$);return zt instanceof GE?new GE((_e,_r)=>{zt.then(_e).catch(_r)}):zt}),d}}class xY extends nS{constructor(s){super(),bE(this,"name","VideoProcessorDestination"),bE(this,"ID","0"),bE(this,"_source",void 0),bE(this,"videoContext",void 0),bE(this,"inputTrack",void 0),this.videoContext=s}get kind(){return"video"}get enabled(){return!0}pipe(){throw new TE(rE.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new TE(rE.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(s){if(s.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);s.track&&s.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=s.track,this.emit(TT.ON_TRACK,s.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(TT.ON_TRACK,void 0)}}class UY extends nS{set chained(s){this._chained=s}get chained(){return this._chained}constructor(s,d){super(),bE(this,"constraintsMap",new Map),bE(this,"statsRegistry",[]),bE(this,"usageRegistry",[]),bE(this,"trackId",void 0),bE(this,"direction",void 0),bE(this,"_chained",!1),this.trackId=s,this.direction=d}async getConstraints(){return await kS(this,JT.REQUEST_CONSTRAINTS)}async requestApplyConstraints(s,d){var g;return _l.info("processor ".concat(d.name," requestApplyConstraints for ").concat(this.trackId)),s&&this.constraintsMap.set(d,s),K_(this,JT.REQUEST_UPDATE_CONSTRAINTS,Array.from(q0(g=this.constraintsMap).call(g)))}async requestRevertConstraints(s){var d;if(this.constraintsMap.has(s))return _l.info("processor ".concat(s.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(s),K_(this,JT.REQUEST_UPDATE_CONSTRAINTS,Array.from(q0(d=this.constraintsMap).call(d)))}registerStats(s,d,g){this.statsRegistry.find(b=>b.processorID===s.ID&&b.processorName===s.name&&b.type===d)||this.statsRegistry.push({processorName:s.name,processorID:s.ID,type:d,cb:g})}unregisterStats(s,d){const g=this.statsRegistry.findIndex(b=>b.processorID===s.ID&&b.processorName===s.name&&b.type===d);g!==-1&&this.statsRegistry.splice(g,1)}gatherStats(){const s=[];for(const{processorID:d,processorName:g,type:b,cb:$}of this.statsRegistry)try{const Vt=$();s.push({processorID:d,processorName:g,type:b,stats:Vt})}catch(Vt){_l.error(new TE(rE.UNEXPECTED_ERROR,Vt.message))}return s}registerUsage(s,d){this.usageRegistry.find(g=>g.processorID===s.ID&&g.processorName===s.name)||this.usageRegistry.push({processorID:s.ID,processorName:s.name,cb:d})}unregisterUsage(s){const d=this.usageRegistry.findIndex(g=>g.processorID===s.ID&&g.processorName===s.name);d!==-1&&this.usageRegistry.splice(d,1)}async gatherUsage(){const s=[];if(!this.chained)return[];for(const{cb:d}of this.usageRegistry)try{let g=d();g instanceof GE&&(g=await g),s.push(rS(rS({},g),{},{direction:this.direction}))}catch(g){_l.error("gather extension usage error",g)}return s}getDirection(){return this.direction}}class jY extends nS{constructor(s){super(),bE(this,"name","AudioProcessorDestination"),bE(this,"ID","0"),bE(this,"inputTrack",void 0),bE(this,"inputNode",void 0),bE(this,"audioProcessorContext",void 0),bE(this,"_source",void 0),this.audioProcessorContext=s}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new TE(rE.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new TE(rE.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(TT.ON_TRACK,void 0),this.emit(TT.ON_NODE,void 0)}updateInput(s){if(s.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);s.track&&this.inputTrack!==s.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=s.track,this.emit(TT.ON_TRACK,this.inputTrack)),s.node&&this.inputNode!==s.node&&(this.audioProcessorContext.chained=!0,this.inputNode=s.node,this.emit(TT.ON_NODE,this.inputNode))}}class VY extends nS{set chained(s){this._chained=s}get chained(){return this._chained}constructor(s,d,g){super(),bE(this,"constraintsMap",new Map),bE(this,"statsRegistry",[]),bE(this,"audioContext",void 0),bE(this,"trackId",void 0),bE(this,"direction",void 0),bE(this,"usageRegistry",[]),bE(this,"_chained",!1),this.audioContext=s,this.trackId=d,this.direction=g}async getConstraints(){return kS(this,JT.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(s,d){var g;return _l.info("processor ".concat(d.name," requestApplyConstraints for ").concat(this.trackId)),s&&this.constraintsMap.set(d,s),K_(this,JT.REQUEST_UPDATE_CONSTRAINTS,Array.from(q0(g=this.constraintsMap).call(g)))}async requestRevertConstraints(s){var d;if(this.constraintsMap.has(s))return this.constraintsMap.delete(s),K_(this,JT.REQUEST_UPDATE_CONSTRAINTS,Array.from(q0(d=this.constraintsMap).call(d)))}registerStats(s,d,g){this.statsRegistry.find(b=>b.processorID===s.ID&&b.processorName===s.name&&b.type===d)||this.statsRegistry.push({processorName:s.name,processorID:s.ID,type:d,cb:g})}unregisterStats(s,d){const g=this.statsRegistry.findIndex(b=>b.processorID===s.ID&&b.processorName===s.name&&b.type===d);g!==-1&&this.statsRegistry.splice(g,1)}gatherStats(){const s=[];for(const{processorID:d,processorName:g,type:b,cb:$}of this.statsRegistry)try{const Vt=$();s.push({processorID:d,processorName:g,type:b,stats:Vt})}catch(Vt){_l.error(new TE(rE.UNEXPECTED_ERROR,Vt.message))}return s}registerUsage(s,d){this.usageRegistry.find(g=>g.processorID===s.ID&&g.processorName===s.name)||this.usageRegistry.push({processorID:s.ID,processorName:s.name,cb:d})}unregisterUsage(s){const d=this.usageRegistry.findIndex(g=>g.processorID===s.ID&&g.processorName===s.name);d!==-1&&this.usageRegistry.splice(d,1)}async gatherUsage(){const s=[];if(!this.chained)return[];for(const{cb:d}of this.usageRegistry)try{let g=d();g instanceof GE&&(g=await g),s.push(rS(rS({},g),{},{direction:this.direction}))}catch(g){_l.error("gather extension usage error",g)}return s}getDirection(){return this.direction}}class $F extends nS{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),bE(this,"context",void 0),bE(this,"processSourceNode",void 0),bE(this,"outputTrack",void 0),bE(this,"processedNode",void 0),bE(this,"clonedTrack",void 0),bE(this,"outputNode",void 0),this.outputNode=new jdt}setVolume(){}createOutputTrack(){throw new TE(rE.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class jdt{disconnect(){}connect(){}}function FY(o){return new GE((s,d)=>{let g=!1;const b=document.createElement("video");b.setAttribute("autoplay",""),b.setAttribute("muted",""),b.muted=!0,b.autoplay=!0,b.setAttribute("playsinline",""),b.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(b);const $=oT()?"canplay":"playing";b.addEventListener($,()=>{const Vt=b.videoWidth,zt=b.videoHeight;!Vt&&H_()||(g=!0,b.srcObject=null,b.remove(),s([Vt,zt]))}),b.srcObject=new MediaStream([o]),b.play().catch(TD),setTimeout(()=>{g||(b.srcObject=null,b.remove(),s([b.videoWidth,b.videoHeight]))},4e3)})}function fL(o){const s={};o.facingMode&&(s.facingMode=o.facingMode),o.cameraId&&(s.deviceId={exact:o.cameraId});const d=vR(o.encoderConfig);return d.width!=null&&(s.width=d.width),d.height!=null&&(s.height=d.height),!W8()&&d.frameRate&&(s.frameRate=d.frameRate),D8()&&typeof s.frameRate=="object"&&(s.frameRate.max=60),H_()&&(s.frameRate={ideal:30,max:30}),s}function BY(o){const s={};if(W8()||(o.AGC!==void 0&&(s.autoGainControl=o.AGC),o.AEC!==void 0&&(s.echoCancellation=o.AEC),o.ANS!==void 0&&(s.noiseSuppression=o.ANS,_w()&&o.ANS&&(s.googHighpassFilter=o.ANS))),o.encoderConfig){const d=dL(o.encoderConfig);s.channelCount=d.stereo?2:1,s.sampleRate=d.sampleRate,s.sampleSize=d.sampleSize}return o.microphoneId&&(s.deviceId={exact:o.microphoneId}),vD()&&(s.sampleRate=void 0),s}const Vdt=o=>{const s=o._encoderConfig;if(!s)return;const{frameRate:d,width:g,height:b}=o.getMediaStreamTrackSettings();let{frameRate:$=d,width:Vt=g,height:zt=b}=s;if(!$||!Vt||!zt)return;Vt=wV(Vt),zt=wV(zt),$=wV($);const{max:_e,min:_r}=function(_c,tE,_p){const _f=200*Math.pow(_p/15,.6)*Math.pow(_c*tE/640/360,.75);return{min:Math.floor(_f),max:Math.floor(4*_f)}}(Vt,zt,$),{bitrateMax:_o,bitrateMin:ga}=s||{};_o||_l.debug("calculate bitrate: [w: ".concat(Vt,", h: ").concat(zt,", fps: ").concat($,"] => [brMax: ").concat(_o,", brMin: ").concat(ga,"]"));const{maxFramerate:_a}=cE("ENCODER_CONFIG_LIMIT");return _a&&typeof _a=="number"&&($=Math.min($,_a)),{frameRate:$,bitrateMax:_o||_e,bitrateMin:ga||_r,scaleResolutionDownBy:1,scale:0}},GY=async(o,s,d)=>await(async(g,b,$)=>{const Vt=function(_r){const _o=[];for(let ga=0;ga<_r.length;ga+=2)_o.push(parseInt(_r.slice(ga,ga+2),16));return Uint8Array.from(_o)}(c4(""+b+$)).slice(0,16),zt=Vt.slice(0,12),_e=await window.crypto.subtle.importKey("raw",Vt,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:zt},_e,g))})(o.buffer,s,d),_B=o=>{const s=document.createElement("canvas");return s.width=2,s.height=2,new GE((d,g)=>{s.toBlob(async b=>{if(s.remove(),b){const $=await WY(b);d({buffer:$,width:s.width,height:s.height})}else g(new TE(rE.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},o,1)})},WY=async o=>{const s=await o.arrayBuffer();return new Uint8Array(s)};var qY,HY,KY,zY,YY,JY,XY,QY,ZY,$Y,t7,e7,n7,r7,i7,o7,s7,a7,uS,c7,u7,l7,d7,h7,p7,SR,f7,m7,E7,g7,_7,v7,y7,S7,T7,b7,R7,C7,w7,rT;let mS=(qY=s_({argsMap:(o,s)=>[o.getTrackId(),s],throttleTime:300}),HY=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),KY=yS(),zY=FO("LocalAudioTrack","_enabledMutex"),YY=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),JY=yS(),XY=FO("LocalAudioTrack","_enabledMutex"),QY=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),ZY=yS(),$Y=yS(),t7=yS(),e7=s_({argsMap:o=>[o.getTrackId()]}),n7=yS(),r7=s_({argsMap:o=>[o.getTrackId()]}),i7=yS(),o7=s_({argsMap:o=>[o.getTrackId()]}),s7=s_({argsMap:(o,s)=>[o.getTrackId(),s.name]}),a7=s_({argsMap:o=>[o.getTrackId()]}),C_((uS=class extends dN{get _source(){return this.initWebAudio()}set _source(o){this._trackSource=o}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?wT.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(o,s,d,g){super(o,d),bE(this,"trackMediaType","audio"),bE(this,"_encoderConfig",void 0),bE(this,"_trackSource",void 0),bE(this,"_enabled",!0),bE(this,"_volume",100),bE(this,"_useAudioElement",!0),bE(this,"_bypassWebAudio",!1),bE(this,"processor",void 0),bE(this,"_processorContext",void 0),bE(this,"_processorDestination",void 0),bE(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=s,this._getOriginVolumeLevel=!!g,this._trackSource=new $F,cE("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),cE("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),GS()&&!XT?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(o){W_(o,"volume",0,1e3),this._volume=o,this._source.setVolume(o/100),this._useAudioElement&&wT.setVolume(this.getTrackId(),o);try{if(this._bypassWebAudio)return void _l.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const s=this._source.createOutputTrack();this._mediaStreamTrack!==s&&(this._mediaStreamTrack=s,K_(this,YE.NEED_REPLACE_TRACK,this).then(()=>{_l.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(d=>{_l.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),d)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(o){if(!this._useAudioElement||!yY())throw new TE(rE.NOT_SUPPORTED,"your browser does not support setting the audio output device");await wT.setSinkID(this.getTrackId(),o)}async setEnabled(o,s,d){return this._setEnabled(o,s,d)}async _setEnabled(o,s,d){if(!d){if(o===this._enabled)return;this.stateCheck("enabled",o)}if(_l.info("[".concat(this.getTrackId(),"] start setEnabled"),o),o){this._originMediaStreamTrack.enabled=!0;try{d||(this._enabled=!0),await K_(this,YE.NEED_ENABLE_TRACK,this),_l.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(o," success"))}catch(g){throw d||(this._enabled=!1),_l.error("[".concat(this.getTrackId(),"] setEnabled to true error"),g.toString()),g}}else{this._originMediaStreamTrack.enabled=!1,d||(this._enabled=!1);try{await K_(this,YE.NEED_DISABLE_TRACK,this)}catch(g){throw d||(this._enabled=!0),_l.error("[".concat(this.getTrackId(),"] setEnabled to false error"),g.toString()),g}}}async setMuted(o){o!==this._muted&&(this.stateCheck("muted",o),this._muted=o,this._originMediaStreamTrack.enabled=!o,_l.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(o)),o?await K_(this,YE.NEED_MUTE_TRACK,this):await K_(this,YE.NEED_UNMUTE_TRACK,this))}getStats(){return eI(()=>{_l.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),VT(this,YE.GET_STATS)||rS({},KF)}setAudioFrameCallback(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!o)return this._source.removeAllListeners(YT.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(s),this._source.removeAllListeners(YT.ON_AUDIO_BUFFER),this._source.on(YT.ON_AUDIO_BUFFER,d=>o(d))}play(){_l.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(_l.debug("[".concat(this.getTrackId(),"] start audio playback in element")),wT.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){_l.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?wT.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let o=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_l.debug("[".concat(this.getTrackId(),"] update player source track")),o&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&wT.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(o,s){this._originMediaStreamTrack!==o&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),o.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=o,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:o,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await K_(this,YE.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(o))}renewMediaStreamTrack(o){return GE.resolve(void 0)}pipe(o){if(this._bypassWebAudio)throw new TE(rE.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===o)return o;if(o._source)throw new TE(rE.INVALID_OPERATION,"Processor ".concat(o.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=o,this.processor._source=this,o.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),o}unpipe(){var o;if(!this.processor)return;const s=this.processor;(o=this._source.processSourceNode)===null||o===void 0||o.disconnect(),this.processor._source=!1,this.processor=void 0,s.reset()}bindProcessorDestinationEvents(o){o.on(TT.ON_TRACK,async s=>{s?s!==this._mediaStreamTrack&&(this._mediaStreamTrack=s,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(s),await K_(this,YE.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await K_(this,YE.NEED_REPLACE_TRACK,this))}),o.on(TT.ON_NODE,s=>{this._source.processedNode=s})}unbindProcessorDestinationEvents(o){o.removeAllListeners(TT.ON_TRACK),o.removeAllListeners(TT.ON_NODE)}bindProcessorContextEvents(o){o.on(JT.REQUEST_CONSTRAINTS,async s=>{s(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(o){o.removeAllListeners(JT.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof $F&&(this._trackSource=new AY(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const o=new VY(this._source.context,this.getTrackId(),"local"),s=new jY(o);return this._processorContext=o,this._processorDestination=s,this.bindProcessorContextEvents(o),this.bindProcessorDestinationEvents(s),this._source.on(YT.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:o})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(wT.stop(this.getTrackId()),this._source.play()),K_(this,YE.NEED_REPLACE_MIXING_TRACK,this).then(()=>{_l.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(d=>{_l.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),d)})),{processorContext:o,processorDestination:s}}}).prototype,"setVolume",[qY],Object.getOwnPropertyDescriptor(uS.prototype,"setVolume"),uS.prototype),C_(uS.prototype,"setPlaybackDevice",[HY,KY],Object.getOwnPropertyDescriptor(uS.prototype,"setPlaybackDevice"),uS.prototype),C_(uS.prototype,"setEnabled",[zY,YY,JY],Object.getOwnPropertyDescriptor(uS.prototype,"setEnabled"),uS.prototype),C_(uS.prototype,"setMuted",[XY,QY,ZY],Object.getOwnPropertyDescriptor(uS.prototype,"setMuted"),uS.prototype),C_(uS.prototype,"getStats",[$Y],Object.getOwnPropertyDescriptor(uS.prototype,"getStats"),uS.prototype),C_(uS.prototype,"setAudioFrameCallback",[t7],Object.getOwnPropertyDescriptor(uS.prototype,"setAudioFrameCallback"),uS.prototype),C_(uS.prototype,"play",[e7,n7],Object.getOwnPropertyDescriptor(uS.prototype,"play"),uS.prototype),C_(uS.prototype,"stop",[r7,i7],Object.getOwnPropertyDescriptor(uS.prototype,"stop"),uS.prototype),C_(uS.prototype,"close",[o7],Object.getOwnPropertyDescriptor(uS.prototype,"close"),uS.prototype),C_(uS.prototype,"pipe",[s7],Object.getOwnPropertyDescriptor(uS.prototype,"pipe"),uS.prototype),C_(uS.prototype,"unpipe",[a7],Object.getOwnPropertyDescriptor(uS.prototype,"unpipe"),uS.prototype),uS),mL=(c7=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),u7=yS(),l7=FO("MicrophoneAudioTrack","_enabledMutex"),d7=s_({argsMap:(o,s,d)=>[o.getTrackId(),s,d]}),h7=yS(),p7=s_({argsMap:o=>[o.getTrackId()]}),C_((SR=class extends mS{get __className__(){return"MicrophoneAudioTrack"}constructor(o,s,d,g){super(o,s.encoderConfig?dL(s.encoderConfig):{},g,cE("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),bE(this,"_config",void 0),bE(this,"_deviceName","default"),bE(this,"_constraints",void 0),bE(this,"_originalConstraints",void 0),bE(this,"_enabled",!0),this._config=s,this._constraints=d,this._originalConstraints=d,this._deviceName=o.label,typeof s.bypassWebAudio=="boolean"&&(this._bypassWebAudio=s.bypassWebAudio),(UO()||vV())&&B_.bindInterruptDetectorTrack(this)}async setDevice(o){if(_l.info("[".concat(this.getTrackId(),"] start set device to ").concat(o)),this._enabled)try{const s=await ZT.getDeviceById(o),d={};d.audio=rS({},this._constraints),d.audio.deviceId={exact:o},this._originMediaStreamTrack.stop();let g=null;try{g=await QT(d,this.getTrackId())}catch(b){throw _l.error("[".concat(this.getTrackId(),"] setDevice failed"),b.toString()),g=await QT({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!1),b}await this._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!1),this._deviceName=s.label,this._config.microphoneId=o,this._constraints.deviceId={exact:o}}catch(s){throw _l.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await ZT.getDeviceById(o);this._deviceName=s.label,this._config.microphoneId=o,this._constraints.deviceId={exact:o}}catch(s){throw _l.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}_l.info("[".concat(this.getTrackId(),"] set device to ").concat(o," success"))}async setEnabled(o,s,d){if(s)return _l.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(o);if(!d){if(o===this._enabled)return;this.stateCheck("enabled",o)}if(_l.info("[".concat(this.getTrackId(),"] start setEnabled"),o),cE("AUTO_RESET_AUDIO_ROUTE")&&(oT()||v0())){const Vt=navigator.audioSession;Vt&&(o||(Vt.type="playback"),Vt.type="auto")}if(!o){var g;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(g=this._source.clonedTrack)===null||g===void 0||g.stop(),d||(this._enabled=!1);try{await K_(this,YE.NEED_DISABLE_TRACK,this)}catch(Vt){throw _l.error("[".concat(this.getTrackId(),"] setEnabled false failed"),Vt.toString()),Vt}return}const b=rS({},this._constraints),$=ZT.searchDeviceIdByName(this._deviceName);$&&!b.deviceId&&(b.deviceId=$);try{d||(this._enabled=!0);const Vt=await QT({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(Vt.getAudioTracks()[0],!1),await K_(this,YE.NEED_ENABLE_TRACK,this)}catch(Vt){throw d||(this._enabled=!1),_l.error("[".concat(this.getTrackId(),"] setEnabled true failed"),Vt.toString()),Vt}_l.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(UO()||vV())&&B_.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((oT()||v0())&&this._enabled&&!this._isClosed&&B_.duringInterruption){const o=async()=>{B_.off(ZS.IOS_INTERRUPTION_END,o),this._enabled&&!this._isClosed&&(_l.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};B_.on(ZS.IOS_INTERRUPTION_END,o)}else _l.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(uN.TRACK_ENDED)}async renewMediaStreamTrack(o){const s=o||this._constraints,d=ZT.searchDeviceIdByName(this._deviceName);if(d&&!s.deviceId&&(s.deviceId=d),this._constraints=s,this._enabled){this._originMediaStreamTrack.stop();const g=await QT({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!0)}}bindProcessorContextEvents(o){super.bindProcessorContextEvents(o),o.on(JT.REQUEST_UPDATE_CONSTRAINTS,async(s,d,g)=>{try{const b=Object.assign({},this._originalConstraints,...s);await this.renewMediaStreamTrack(b),d()}catch(b){g(b)}})}unbindProcessorContextEvents(o){super.unbindProcessorContextEvents(o),o.removeAllListeners(JT.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[c7,u7],Object.getOwnPropertyDescriptor(SR.prototype,"setDevice"),SR.prototype),C_(SR.prototype,"setEnabled",[l7,d7,h7],Object.getOwnPropertyDescriptor(SR.prototype,"setEnabled"),SR.prototype),C_(SR.prototype,"close",[p7],Object.getOwnPropertyDescriptor(SR.prototype,"close"),SR.prototype),SR),Fdt=(f7=s_({argsMap:(o,s)=>[o.getTrackId(),s,o.duration]}),m7=yS(),E7=s_({argsMap:o=>[o.getTrackId()]}),g7=yS(),_7=s_({argsMap:o=>[o.getTrackId()]}),v7=yS(),y7=s_({argsMap:o=>[o.getTrackId()]}),S7=yS(),T7=s_({argsMap:o=>[o.getTrackId()]}),b7=yS(),R7=s_({argsMap:o=>[o.getTrackId()]}),C7=s_({argsMap:o=>[o.getTrackId()]}),w7=yS(),C_((rT=class extends mS{get __className__(){return"BufferSourceAudioTrack"}constructor(o,s,d,g){super(s.createOutputTrack(),d,g),bE(this,"source",void 0),bE(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=o,this._bufferSource=s,this._bufferSource.on(YT.AUDIO_SOURCE_STATE_CHANGE,b=>{this.safeEmit(uN.SOURCE_STATE_CHANGE,b)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(o){o&&this._bufferSource.updateOptions(o),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(o){this._bufferSource.seekAudioBuffer(o)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(o){W_(o,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(o)}}).prototype,"startProcessAudioBuffer",[f7,m7],Object.getOwnPropertyDescriptor(rT.prototype,"startProcessAudioBuffer"),rT.prototype),C_(rT.prototype,"pauseProcessAudioBuffer",[E7,g7],Object.getOwnPropertyDescriptor(rT.prototype,"pauseProcessAudioBuffer"),rT.prototype),C_(rT.prototype,"seekAudioBuffer",[_7,v7],Object.getOwnPropertyDescriptor(rT.prototype,"seekAudioBuffer"),rT.prototype),C_(rT.prototype,"resumeProcessAudioBuffer",[y7,S7],Object.getOwnPropertyDescriptor(rT.prototype,"resumeProcessAudioBuffer"),rT.prototype),C_(rT.prototype,"stopProcessAudioBuffer",[T7,b7],Object.getOwnPropertyDescriptor(rT.prototype,"stopProcessAudioBuffer"),rT.prototype),C_(rT.prototype,"close",[R7],Object.getOwnPropertyDescriptor(rT.prototype,"close"),rT.prototype),C_(rT.prototype,"setAudioBufferPlaybackSpeed",[C7,w7],Object.getOwnPropertyDescriptor(rT.prototype,"setAudioBufferPlaybackSpeed"),rT.prototype),rT);class jS extends mS{get __className__(){return"MixingAudioTrack"}get isActive(){for(const s of this.trackList)if(s._enabled&&!s._isClosed&&!s.muted)return!0;return!1}constructor(){const s=hN().createMediaStreamDestination();super(s.stream.getAudioTracks()[0],void 0,z_(8,"track-mix-")),bE(this,"trackList",void 0),bE(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=s,this.trackList=[]}hasAudioTrack(s){return this.trackList.indexOf(s)!==-1}addAudioTrack(s){this.trackList.indexOf(s)===-1?(_l.debug("add ".concat(s.getTrackId()," to mixing track")),s._source.outputNode.connect(this.destNode),this.trackList.push(s),this.updateEncoderConfig()):_l.debug("track ".concat(s.getTrackId()," is already added"))}removeAudioTrack(s){if(this.trackList.indexOf(s)!==-1){_l.debug("remove ".concat(s.getTrackId()," from mixing track"));try{s._source.outputNode.disconnect(this.destNode)}catch{}yD(this.trackList,s),this.updateEncoderConfig()}}updateEncoderConfig(){const s={};this.trackList.forEach(d=>{d._encoderConfig&&((d._encoderConfig.bitrate||0)>(s.bitrate||0)&&(s.bitrate=d._encoderConfig.bitrate),(d._encoderConfig.sampleRate||0)>(s.sampleRate||0)&&(s.sampleRate=d._encoderConfig.sampleRate),(d._encoderConfig.sampleSize||0)>(s.sampleSize||0)&&(s.sampleSize=d._encoderConfig.sampleSize),d._encoderConfig.stereo&&(s.stereo=!0))}),this._encoderConfig=s}_updateRtpTransceiver(s){this._rtpTransceiver!==s&&(this._rtpTransceiver=s,this.trackList.forEach(d=>{d instanceof jS?d.emit(nO.TRANSCEIVER_UPDATED,s):d._updateRtpTransceiver(s)}))}}class Bdt extends OY{set currentState(s){s!==this._currentState&&(this._currentState=s,this.safeEmit(YT.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),bE(this,"audioBuffer",void 0),bE(this,"sourceNode",void 0),bE(this,"startPlayTime",0),bE(this,"startPlayOffset",0),bE(this,"pausePlayTime",0),bE(this,"options",void 0),bE(this,"currentLoopCount",0),bE(this,"currentPlaybackSpeed",100),bE(this,"_currentState","stopped"),this.audioBuffer=s,this.options=d,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(s){this.currentState==="stopped"?(this.options=s,this.startPlayOffset=this.options.startPlayTime||0):_l.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(s){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=s,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=s))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(s){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=s/100),this.currentPlaybackSpeed=s}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const s=this.context.createBufferSource();return s.buffer=this.audioBuffer,s.loop=!!this.options.loop,s.connect(this.outputNode),s.playbackRate.value=this.currentPlaybackSpeed/100,s}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const I7=new Map;class tG{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const s=this.renderStats.curTs-this.renderStats.lastTs,d=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/s;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,d}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(s){s!==this._videoElementStatus&&(_l.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(s)),this._videoElementStatus=s)}get videoState(){return this._videoState}set videoState(s){var d;s!==this._videoState&&(this._videoState=s,(d=this.onVideoStateChanged)===null||d===void 0||d.call(this,this.videoState))}constructor(s){bE(this,"trackId",void 0),bE(this,"config",void 0),bE(this,"onFirstVideoFrameDecoded",void 0),bE(this,"onVideoStateChanged",void 0),bE(this,"freezeTimeCounterList",[]),bE(this,"renderFreezeAccTime",0),bE(this,"isKeepLastFrame",!1),bE(this,"timeUpdatedCount",0),bE(this,"freezeTime",0),bE(this,"playbackTime",0),bE(this,"lastTimeUpdatedTime",0),bE(this,"autoplayFailed",!1),bE(this,"videoTrack",void 0),bE(this,"videoElement",void 0),bE(this,"cacheVideoElement",void 0),bE(this,"renderStats",void 0),bE(this,"_videoState",yR.VideoStateStopped),bE(this,"videoElementCheckInterval",void 0),bE(this,"videoElementFreezeTimeout",void 0),bE(this,"_videoElementStatus",fT.NONE),bE(this,"isGettingVideoDimensions",!1),bE(this,"startGetVideoDimensions",()=>{const d=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return _l.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(d,500)};!this.isGettingVideoDimensions&&d()}),bE(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&B_.curState==="running"&&(_l.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(P8())),B8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),bE(this,"handleVideoEvents",d=>{switch(d.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=fT.PLAYING;break;case"loadeddata":if(this.videoState=yR.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=fT.CANPLAY;break;case"stalled":this.videoElementStatus=fT.STALLED;break;case"suspend":this.videoElementStatus=fT.SUSPEND;break;case"pause":this.videoElementStatus=fT.PAUSED,oT()||v0()||GS()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(_l.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=fT.WAITING;break;case"abort":this.videoElementStatus=fT.ABORT;break;case"ended":this.videoElementStatus=fT.ENDED;break;case"emptied":this.videoElementStatus=fT.EMPTIED;break;case"error":{const g=this.videoElement.error;g?(this.videoElementStatus=fT.ERROR,_l.error("[".concat(this.trackId,"] media error: ").concat(g.message," (").concat(g.code,")"))):_l.debug("[".concat(this.trackId,"] media not been an error."));break}case"timeupdate":{const g=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=g);const b=g-this.lastTimeUpdatedTime,$=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=g,FR.lastVisibleTime<FR.lastHiddenTime||$<FR.lastHiddenTime||$<FR.lastVisibleTime)return;for(b>cE("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=b),this.playbackTime+=b;this.playbackTime>=6e3;){this.playbackTime-=6e3;const Vt=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(Vt),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),bE(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(_l.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(P8())),B8()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=s.trackId,this.config=s,s.element instanceof HTMLVideoElement?this.videoElement=s.element:this.videoElement=document.createElement("video"),B_.on(ZS.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),B_.on(ZS.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var s;return(s=this.videoElement.parentElement)!==null&&s!==void 0?s:void 0}updateConfig(s){this.config=s,this.trackId=s.trackId,s.element!==this.videoElement&&(this.destroy(),this.videoElement=s.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(s){this.videoTrack!==s&&(this.videoTrack=s,this.initVideoElement())}play(s){const d=this.videoElement.play();d&&d.catch&&d.catch(b=>{s&&MY(s,"video",b.message,this.trackId),b.name==="NotAllowedError"?(_l.warning("detected video element autoplay failed",b),this.autoplayFailed=!0,this.handleAutoPlayFailed()):_l.warning("[".concat(this.trackId,"] play warning: "),b)});const g=O_();if((g.name==="Safari"&&Number(g.version)===15||UO())&&d&&d.then){const b=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};d.then(b).catch(b)}}getCurrentFrame(){const s=document.createElement("canvas");s.width=this.videoElement.videoWidth,s.height=this.videoElement.videoHeight;const d=s.getContext("2d");if(!d)return _l.error("create canvas context failed!"),new ImageData(2,2);d.drawImage(this.videoElement,0,0,s.width,s.height);const g=d.getImageData(0,0,s.width,s.height);return s.remove(),g}async getCurrentFrameToUint8Array(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const g=document.createElement("canvas");g.width=this.videoElement.videoWidth,g.height=this.videoElement.videoHeight;const b=g.getContext("2d");return b?(b.drawImage(this.videoElement,0,0,g.width,g.height),new GE(($,Vt)=>{g.toBlob(async zt=>{if(g.remove(),zt){const _e=await WY(zt);$({buffer:_e,width:g.width,height:g.height})}else Vt(new TE(rE.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},s,d<0?.1:d>1?1:d)})):await _B(s)}destroy(){this.renderStats=void 0,B_.off(ZS.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),B_.off(ZS.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=yR.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=fT.INIT,!this.videoElementCheckInterval&&(O7.forEach($=>{this.videoElement.addEventListener($,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function($){return $!==document.body&&document.body.contains($)})(this.videoElement)||(this.videoElementStatus=fT.DESTROYED)},1e3),cE("ENABLE_VIDEO_FRAME_CALLBACK"))){var s,d;let $;const Vt=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",Vt),this.videoElementFreezeTimeout=window.setTimeout(zt,cE("VIDEO_FREEZE_DURATION")))},zt=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===yR.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=yR.VideoStateFrozen:document.addEventListener("visibilitychange",Vt))},_e=(_r,_o)=>{if(this.videoElementStatus===fT.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=_o.mediaTime):this.renderStats={lastTs:_o.mediaTime,curTs:_o.mediaTime,lastRenderNum:0,renderNum:0},$){const _c=_o.presentationTime-$.presentationTime;this.videoState===yR.VideoStateStarting&&(this.videoState=yR.VideoStateDecoding),this.videoState===yR.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(zt,cE("VIDEO_FREEZE_DURATION"))),_c<cE("VIDEO_FREEZE_DURATION")&&this.videoState===yR.VideoStateFrozen&&(this.videoState=yR.VideoStateDecoding),_c>cE("VIDEO_FREEZE_DURATION")&&FR.lastVisibleTime>=FR.lastHiddenTime&&$.timestamp>FR.lastVisibleTime&&$.timestamp>FR.lastHiddenTime&&(this.renderFreezeAccTime+=_c)}$=rS(rS({},_o),{},{timestamp:_r})}var ga,_a;cE("ENABLE_VIDEO_FRAME_CALLBACK")&&((ga=(_a=this.videoElement).requestVideoFrameCallback)===null||ga===void 0||ga.call(_a,_e))};(s=(d=this.videoElement).requestVideoFrameCallback)===null||s===void 0||s.call(d,_e)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),vD()&&!cE("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const g=O_();g.name==="Safari"&&Number(g.version)===15||UO()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,H_()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,H_()&&this.videoElement.load());const b=this.videoElement.play();b!==void 0&&b.catch($=>{_l.debug("[".concat(this.trackId,"] playback interrupted"),$.toString())})}resetVideoElement(){O7.forEach(s=>{this.videoElement&&this.videoElement.removeEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=fT.NONE}handleAutoPlayFailed(){const s=d=>{d.preventDefault(),this.videoElement.play().then(()=>{_l.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(g=>{_l.error(g)}),this.autoplayFailed=!1,nP()?document.body.removeEventListener("click",s,!0):(document.body.removeEventListener("touchstart",s,!0),document.body.removeEventListener("mousedown",s,!0))};nP()?document.body.addEventListener("click",s,!0):(document.body.addEventListener("touchstart",s,!0),document.body.addEventListener("mousedown",s,!0)),LY()}}const O7=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class A7 extends tG{constructor(s){super(s),bE(this,"container",void 0),bE(this,"slot",void 0),this.slot=s.element,this.updateConfig(s)}updateConfig(s){this.config=s,this.trackId=s.trackId;const d=s.element;d!==this.slot&&(this.destroy(),this.slot=d),this.createElements()}updateVideoTrack(s){this.videoTrack!==s&&(this.videoTrack=s,this.createElements())}play(s){var d;(d=this.container)!==null&&d!==void 0&&d.contains(this.videoElement)&&super.play(s)}getCurrentFrame(){var s;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(s){var d;let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(d=this.container)!==null&&d!==void 0&&d.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(s,g):await _B(s)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",cE("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var s;!this.container||(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var s;if((s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var N7,k7,P7,D7,L7,M7,x7,U7,j7,V7,F7,B7,G7,W7,q7,H7,K7,z7,Y7,J7,X7,Q7,Z7,$7,t9,T_,e9,n9,r9,i9,o9,s9,a9,c9,_b;let Y_=(N7=s_({argsMap:(o,s,d)=>[o.getTrackId(),typeof s=="string"?s:s instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",d]}),k7=yS(),P7=s_({argsMap:o=>[o.getTrackId()]}),D7=FO("LocalVideoTrack","_enabledMutex"),L7=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),M7=yS(),x7=FO("LocalVideoTrack","_enabledMutex"),U7=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),j7=yS(),V7=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),F7=yS(),B7=yS(),G7=s_({argsMap:(o,s,d)=>[o.getTrackId(),s,d]}),W7=yS(),q7=yS(),H7=yS(),K7=yS(),z7=yS(),Y7=yS(),J7=yS(),X7=s_({argsMap:(o,s)=>[o.getTrackId(),s.name]}),Q7=s_({argsMap:o=>[o.getTrackId()]}),Z7=s_({argsMap:o=>[o.getTrackId()]}),$7=s_({argsMap:(o,s,d)=>[o.getTrackId(),s.label,d]}),t9=s_(),T_=class sQ extends dN{get videoHeight(){if(GS()){const{height:s}=this._mediaStreamTrack.getSettings();return this._videoHeight=s,this._videoHeight}return this._videoHeight}get videoWidth(){if(GS()){const{width:s}=this._mediaStreamTrack.getSettings();return this._videoWidth=s,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==fT.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(s){this._processorContext=s}get __className__(){return"LocalVideoTrack"}constructor(s,d,g,b,$,Vt){if(super(s,$),bE(this,"trackMediaType","video"),bE(this,"_player",void 0),bE(this,"isUseScaleResolutionDownBy",!1),bE(this,"_videoVisibleTimer",null),bE(this,"_statsTimer",null),bE(this,"_previousVideoVisibleStatus",void 0),bE(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),bE(this,"_encoderConfig",void 0),bE(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),bE(this,"_optimizationMode",void 0),bE(this,"_videoHeight",void 0),bE(this,"_videoWidth",void 0),bE(this,"_forceBitrateLimit",void 0),bE(this,"_enabled",!0),bE(this,"_processorDestination",void 0),bE(this,"_processorContext",void 0),GS()){const{width:zt,height:_e}=s.getSettings();this._videoWidth=zt,this._videoHeight=_e}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=d,this._scalabilityMode=g,this._optimizationMode=b,this._hints=Vt||[],this._hints.indexOf(Z_.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(zt,_e,_r){const _o=O_();return!(_o.name!==zt||!_o.osVersion)&&Number(_o.version)===_e}(M_.CHROME,115)&&ED().indexOf("Windows")!==-1){const zt=function(_e,_r){if("VideoFrame"in window&&"TransformStream"in window&&R_().supportWebRTCInsertableStream){const _o=new MediaStreamTrackProcessor(_e),ga=new MediaStreamTrackGenerator({kind:"video"});let _a,_c,tE=Date.now();const _p=()=>{_f&&(clearInterval(_f),_f=void 0),_a&&(_a.close(),_a=void 0),_e.stop(),_c=void 0,ga.removeEventListener("ended",_p)};let _f=window.setInterval(()=>{if(_c&&_a&&Date.now()-tE>1e3)try{ga.readyState==="live"?_c.enqueue(_a.clone()):_p()}catch{_p()}},1e3);const eE=new TransformStream({transform:(iE,fE)=>{ga.readyState==="live"?(_c=fE,tE=Date.now(),_a===void 0?(_a=iE,fE.enqueue(iE.clone())):(fE.enqueue(_a),_a=iE)):iE.close()}});return ga.addEventListener("ended",_p),_o.readable.pipeThrough(eE).pipeTo(ga.writable),ga}}(s);zt&&(_l.info("local screen video track begin to inject frame"),this._mediaStreamTrack=zt)}d&&this._hints.indexOf(Z_.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(d),this._processorContext=new UY(this.getTrackId(),"local"),this._processorDestination=new xY(this.processorContext),this.bindProcessorDestinationEvents()}play(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof s=="string"){const b=document.getElementById(s);b?s=b:(_l.warning("[".concat(this.getTrackId(),'] can not find "#').concat(s,'" element, use document.body')),s=document.body)}_l.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(s instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(d));const g=rS(rS(rS({},this._getDefaultPlayerConfig()),d),{},{trackId:this.getTrackId(),element:s});this._player?this._player.updateConfig(g):(s instanceof HTMLVideoElement?this._player=new tG(g):this._player=new A7(g),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const b=this.getVideoElementVisibleStatus();this.safeEmit(uN.VIDEO_ELEMENT_VISIBLE_STATUS,b)}catch{}},cE("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_l.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(s,d){if(!d){if(s===this._enabled)return;this.stateCheck("enabled",s)}if(_l.info("[".concat(this.getTrackId(),"] start setEnabled"),s),!s){this._originMediaStreamTrack.enabled=!1;try{await K_(this,YE.NEED_DISABLE_TRACK,this)}catch(g){throw _l.error("[".concat(this.getTrackId(),"] setEnabled to false error"),g.toString()),g}return d||(this._enabled=!1),void _l.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await K_(this,YE.NEED_ENABLE_TRACK,this)}catch(g){throw _l.error("[".concat(this.getTrackId(),"] setEnabled to true error"),g.toString()),g}_l.info("[".concat(this.getTrackId(),"] setEnabled to true success")),d||(this._enabled=!0)}async setMuted(s){s!==this._muted&&(this.stateCheck("muted",s),this._muted=s,this._originMediaStreamTrack.enabled=!s,_l.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(s)),s?await K_(this,YE.NEED_MUTE_TRACK,this):await K_(this,YE.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(s,d){if(!this._enabled)throw new TE(rE.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(s==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),s=vR(s),this._forceBitrateLimit&&(s.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:s.bitrateMax,s.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:s.bitrateMin),s.width||s.height||s.frameRate){const g=fL({encoderConfig:s});(GS()||oT()||v0())&&(g.deviceId=void 0),_l.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(s),JSON.stringify(g));try{await this._originMediaStreamTrack.applyConstraints(g),this.updateMediaStreamTrackResolution()}catch(b){const $=new TE(rE.UNEXPECTED_ERROR,b.toString());throw _l.error("[".concat(this.getTrackId(),"] applyConstraints error"),$.toString()),$}}this._encoderConfig=s,this._hints.indexOf(Z_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await K_(this,YE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(g){return g.throw(_l)}}getStats(){return eI(()=>{_l.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),VT(this,YE.GET_STATS)||rS({},zF)}async setBeautyEffect(s){_l.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(s,d):await _B(s)}async setBitrateLimit(s){if(_l.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(s))),s){this._forceBitrateLimit=s,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<s.max_bitrate?this._encoderConfig.bitrateMax:s.max_bitrate:this._encoderConfig.bitrateMax=s.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=s.min_bitrate);try{await K_(this,YE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(_l)}}}async setOptimizationMode(s){if(s!=="motion"&&s!=="detail"&&s!=="balanced")return void _l.error(rE.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const d=this._optimizationMode;try{this._optimizationMode=s,await K_(this,YE.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(g){throw this._optimizationMode=d,_l.error("[".concat(this.getTrackId(),"] set optimization mode failed"),g.toString()),g}_l.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(s,")"))}setScalabiltyMode(s){if(s.numSpatialLayers===1&&s.numTemporalLayers!==1)return _l.error(rE.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=s,_l.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(s,")"))}updateMediaStreamTrackResolution(){FY(this._originMediaStreamTrack).then(s=>{let[d,g]=s;this._videoHeight=g,this._videoWidth=d}).catch(TD)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(s){if(!this._enabled)throw new TE(rE.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");_l.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(s)),s=vR(s),this._forceBitrateLimit&&(s.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:s.bitrateMax,s.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:s.bitrateMin),this._encoderConfig=s,this._hints.indexOf(Z_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await K_(this,YE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(_l)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:s,height:d,frameRate:g}=this.getMediaStreamTrackSettings();if(!s||!d||!g)return;const{bitrateMax:b,bitrateMin:$}=this._encoderConfig;if($==null||b==null){const{max:Vt,min:zt}=function(_e,_r,_o,ga,_a){const _c=cE("BITRATE_ADAPTER_TYPE");if(_c==="DEFAULT_BITRATE")return{min:ga,max:_a};if(_a===void 0){var tE;const _f=Math.floor(200*Math.pow(_o/15,.6)*Math.pow(_e*_r/640/360,.75));_a=_c==="STANDARD_BITRATE"?4*_f:2*_f,ga=(tE=ga)!==null&&tE!==void 0?tE:_f}else{var _p;ga=(_p=ga)!==null&&_p!==void 0?_p:Math.floor(_a/10)}return{min:ga,max:_a}}(s,d,g,$,b);this._encoderConfig.bitrateMin=zt,this._encoderConfig.bitrateMax=Vt,_l.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(s,", h: ").concat(d,", fps: ").concat(g,"] => [brMax: ").concat(Vt,", brMin: ").concat(zt,"]"))}}getVideoElementVisibleStatus(){try{var s,d;const g=this==null||(s=this._player)===null||s===void 0?void 0:s.getContainerElement(),b={track:this,element:this==null||(d=this._player)===null||d===void 0?void 0:d.getVideoElement(),slot:g==null?void 0:g.parentElement},{element:$,slot:Vt}=b;if(this.isPlaying&&$ instanceof HTMLVideoElement&&Vt instanceof HTMLElement){const zt=Y8.checkOneElementVisible($),_e=Object.assign({},zt);if(_e.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_e.visible;const _r=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_e.visible?_r.onSuccess("Video is visible"):_r.onSuccess("Invisible because of ".concat(_e.reason))}return _e}return}catch(g){throw new TE(rE.GET_VIDEO_ELEMENT_VISIBLE_ERROR,g.message)}}async renewMediaStreamTrack(s){}pipe(s){if(this.processor===s)return s;if(s._source)throw new TE(rE.INVALID_OPERATION,"Processor ".concat(s.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=s,this.processor._source=this,s.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),s}unpipe(){if(!this.processor)return;const s=this.processor;this.processor._source=void 0,this.processor=void 0,s.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(s){let d=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],g=this._encoderConfig;s&&(g=rS(rS({},g),vR(s))),g=FI(g);const b=z_(8,"track-video-cloned-"),$=new sQ(d?this._mediaStreamTrack.clone():this._mediaStreamTrack,g,FI(this._scalabilityMode),this._optimizationMode,b,FI(this._hints));return s&&g&&$.setEncoderConfiguration(g),_l.debug("clone video track from ".concat(this.getTrackId()," to ").concat(b,", clone ").concat(d)),$}async replaceTrack(s,d){if(!(s instanceof MediaStreamTrack))throw new TE(rE.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(s.kind!=="video")throw new TE(rE.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(s,d,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!GS()&&!oT())return;this._statsTimer&&window.clearInterval(this._statsTimer);let s=2,d=uL[s],g=-1,b=Date.now();const $=Vt=>{Vt>2||Vt<0||(b=Date.now(),d=uL[Vt],this.setSenderConfiguration(d))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const Vt=this.getStats(),zt=VT(this,YE.GET_RTC_STATS);if(Vt.sendPackets>0&&zt){g===-1&&(g=Date.now());const _e=Date.now();if(_e-g<1e3||_e-b<cE("PROFILE_SWITCH_INTERVAL"))return;const _r=Vt.sendFrameRate,_o=.6*d.frameRate,ga=.9*d.frameRate;typeof _r=="number"&&_r>0&&_r<_o?s>0&&(s--,$(s),_l.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(_r,", switchProfile to ").concat(s))):zt.OutgoingAvailableBandwidth<d.bitrateMin?s>0&&(s--,$(s),_l.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(zt.OutgoingAvailableBandwidth,", bitrateMin ").concat(d.bitrateMin,", switchProfile to ").concat(s))):typeof _r=="number"&&_r>ga&&s<uL.length-1&&zt.OutgoingAvailableBandwidth>1.2*uL[s+1].bitrateMin&&(s++,$(s),_l.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(_r,", OutgoingAvailableBandwidth ").concat(zt.OutgoingAvailableBandwidth,", switchProfile to ").concat(s)))}},cE("CHECK_LOCAL_STATS_INTERVAL"))}sendSeiData(s){if(eI(()=>{t_.reportApiInvoke(null,{name:NS.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:hS.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!cE("ENABLE_VIDEO_SEI")||!cE("ENABLE_ENCODED_TRANSFORM"))return void _l.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(s instanceof Uint8Array==0)return new TE(rE.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const d=this.getRTCRtpTransceiver();if(!d)return void _l.warning("Video track is not published, SEI can not be send");const g=d.sender.getParameters();if(g.codecs.length===0)return;const b=g.codecs[0].mimeType.toLocaleLowerCase();b==="video/h264"?this.safeEmit("sei-to-send",s):_l.warning("SEI is not supported by ".concat(b))}bindProcessorDestinationEvents(){this.processorDestination.on(TT.ON_TRACK,async s=>{s?s!==this._mediaStreamTrack&&(this._mediaStreamTrack=s,this._updatePlayerSource(),await K_(this,YE.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await K_(this,YE.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(TT.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(JT.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(JT.REQUEST_CONSTRAINTS)}},C_(T_.prototype,"play",[N7,k7],Object.getOwnPropertyDescriptor(T_.prototype,"play"),T_.prototype),C_(T_.prototype,"stop",[P7],Object.getOwnPropertyDescriptor(T_.prototype,"stop"),T_.prototype),C_(T_.prototype,"setEnabled",[D7,L7,M7],Object.getOwnPropertyDescriptor(T_.prototype,"setEnabled"),T_.prototype),C_(T_.prototype,"setMuted",[x7,U7,j7],Object.getOwnPropertyDescriptor(T_.prototype,"setMuted"),T_.prototype),C_(T_.prototype,"setEncoderConfiguration",[V7,F7],Object.getOwnPropertyDescriptor(T_.prototype,"setEncoderConfiguration"),T_.prototype),C_(T_.prototype,"getStats",[B7],Object.getOwnPropertyDescriptor(T_.prototype,"getStats"),T_.prototype),C_(T_.prototype,"setBeautyEffect",[G7,W7],Object.getOwnPropertyDescriptor(T_.prototype,"setBeautyEffect"),T_.prototype),C_(T_.prototype,"getCurrentFrameData",[q7],Object.getOwnPropertyDescriptor(T_.prototype,"getCurrentFrameData"),T_.prototype),C_(T_.prototype,"getCurrentFrameImage",[H7],Object.getOwnPropertyDescriptor(T_.prototype,"getCurrentFrameImage"),T_.prototype),C_(T_.prototype,"setBitrateLimit",[K7],Object.getOwnPropertyDescriptor(T_.prototype,"setBitrateLimit"),T_.prototype),C_(T_.prototype,"setOptimizationMode",[z7],Object.getOwnPropertyDescriptor(T_.prototype,"setOptimizationMode"),T_.prototype),C_(T_.prototype,"setScalabiltyMode",[Y7],Object.getOwnPropertyDescriptor(T_.prototype,"setScalabiltyMode"),T_.prototype),C_(T_.prototype,"updateMediaStreamTrackResolution",[J7],Object.getOwnPropertyDescriptor(T_.prototype,"updateMediaStreamTrackResolution"),T_.prototype),C_(T_.prototype,"pipe",[X7],Object.getOwnPropertyDescriptor(T_.prototype,"pipe"),T_.prototype),C_(T_.prototype,"unpipe",[Q7],Object.getOwnPropertyDescriptor(T_.prototype,"unpipe"),T_.prototype),C_(T_.prototype,"close",[Z7],Object.getOwnPropertyDescriptor(T_.prototype,"close"),T_.prototype),C_(T_.prototype,"replaceTrack",[$7],Object.getOwnPropertyDescriptor(T_.prototype,"replaceTrack"),T_.prototype),C_(T_.prototype,"startMonitorStats",[t9],Object.getOwnPropertyDescriptor(T_.prototype,"startMonitorStats"),T_.prototype),T_),eG=(e9=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),n9=yS(),r9=FO("CameraVideoTrack","_enabledMutex"),i9=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),o9=yS(),s9=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),a9=yS(),c9=s_({argsMap:o=>[o.getTrackId()]}),_b=class aQ extends Y_{get __className__(){return"CameraVideoTrack"}constructor(s,d,g,b,$,Vt){super(s,vR(d.encoderConfig),b,$,Vt),bE(this,"_config",void 0),bE(this,"_originalConstraints",void 0),bE(this,"_constraints",void 0),bE(this,"_enabled",!0),bE(this,"_deviceName","default"),bE(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(UO()||vV())&&!function(){const zt=O_();if(zt.os!==BS.IOS||!zt.osVersion)return!1;const _e=zt.osVersion.split(".");return Number(_e[0])===15&&Number(_e[1])>=2}()&&G8()&&this._enabled&&!this._isClosed&&(_l.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=d,this._originalConstraints=g,this._constraints=g,this._deviceName=s.label,this._encoderConfig=vR(this._config.encoderConfig),B_.on(ZS.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),B_.on(ZS.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(s){return typeof s=="string"?this._setDeviceById(s):s.deviceId?this._setDeviceById(s.deviceId):s.facingMode?this._setDeviceByFacingModel(s.facingMode):void 0}async _setDeviceById(s){if(_l.info("[".concat(this.getTrackId(),"] set device to ").concat(s)),this._enabled)try{const d=await ZT.getDeviceById(s),g={};g.video=rS({},this._constraints),g.video.deviceId={exact:s},g.video.facingMode=void 0,this._originMediaStreamTrack.stop();let b=null;try{b=await QT(g,this.getTrackId())}catch($){throw _l.error("[".concat(this.getTrackId(),"] setDevice failed"),$.toString()),b=await QT({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(b.getVideoTracks()[0],!1),$}await this._updateOriginMediaStreamTrack(b.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=d.label,this._config.cameraId=s,this._constraints.deviceId={exact:s}}catch(d){throw _l.error("[".concat(this.getTrackId(),"] setDevice error"),d.toString()),d}else try{const d=await ZT.getDeviceById(s);this._deviceName=d.label,this._config.cameraId=s,this._constraints.deviceId={exact:s}}catch(d){throw _l.error("[".concat(this.getTrackId(),"] setDevice error"),d.toString()),d}_l.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(s){_l.info("[".concat(this.getTrackId(),"] set facingMode ").concat(s));const d={video:rS(rS({},this._constraints),{},{deviceId:void 0,facingMode:{exact:s}})};if(this._enabled){this._originMediaStreamTrack.stop();let g=null;try{g=await QT(d,this.getTrackId())}catch(b){throw _l.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),b.toString()),g=await QT({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(g.getVideoTracks()[0],!1),b}await this._updateOriginMediaStreamTrack(g.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=s,this._config.cameraId=void 0,this._constraints=rS({},d.video),_l.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(s,d){if(!d){if(s===this._enabled)return;this.stateCheck("enabled",s)}if(_l.info("[".concat(this.getTrackId(),"] start setEnabled"),s),s){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const g=await QT({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(g.getVideoTracks()[0],!1)}await K_(this,YE.NEED_ENABLE_TRACK,this)}catch(g){throw _l.error("[".concat(this.getTrackId(),"] setEnabled true error"),g.toString()),g}this.updateMediaStreamTrackResolution(),_l.info("[".concat(this.getTrackId(),"] setEnabled to true success")),d||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),d||(this._enabled=!1);try{await K_(this,YE.NEED_DISABLE_TRACK,this)}catch(g){throw _l.error("[".concat(this.getTrackId(),"] setEnabled to false error"),g.toString()),g}_l.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(s,d){if(!this._enabled)throw new TE(rE.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");s==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),s=vR(s),this._forceBitrateLimit&&(s.bitrateMax=this._forceBitrateLimit.max_bitrate||s.bitrateMax,s.bitrateMin=this._forceBitrateLimit.min_bitrate||s.bitrateMin);const g=Q_(this._config);g.encoderConfig=s;const b=fL(g);(GS()||oT()||v0())&&(b.deviceId=void 0),_l.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(s),JSON.stringify(b));try{await this._originMediaStreamTrack.applyConstraints(b),this.updateMediaStreamTrackResolution()}catch($){const Vt=new TE(rE.UNEXPECTED_ERROR,$.toString());throw _l.error("[".concat(this.getTrackId(),"] applyConstraints error"),Vt.toString()),Vt}this._config=g,this._constraints=b,this._originalConstraints=b,this._encoderConfig=s,this._hints.indexOf(Z_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await K_(this,YE.NEED_UPDATE_VIDEO_ENCODER,this)}catch($){return $.throw(_l)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((oT()||v0())&&this._enabled&&!this._isClosed&&B_.duringInterruption){const s=async()=>{B_.off(ZS.IOS_INTERRUPTION_END,s),this._enabled&&!this._isClosed&&(_l.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};B_.on(ZS.IOS_INTERRUPTION_END,s)}else _l.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(uN.TRACK_ENDED)}async renewMediaStreamTrack(s){const d=s||this._constraints,g=ZT.searchDeviceIdByName(this._deviceName);if(g&&!d.deviceId&&(d.deviceId={exact:g}),this._enabled){const b=await QT({video:d},this.getTrackId());this._constraints=d,await this._updateOriginMediaStreamTrack(b.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),B_.off(ZS.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),B_.off(ZS.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(s){let d=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],g=this._encoderConfig;s&&(g=rS(rS({},g),vR(s))),g=FI(g);const b=z_(8,"track-cam-cloned-"),$=new aQ(d?this._mediaStreamTrack.clone():this._mediaStreamTrack,FI(rS(rS({},this._config),{},{encoderConfig:g})),FI(this._constraints),FI(this._scalabilityMode),this._optimizationMode,b);return s&&g&&$.setEncoderConfiguration(g),_l.debug("clone track from ".concat(this.getTrackId()," to ").concat(b,", clone ").concat(d)),$}bindProcessorContextEvents(){this.processorContext.on(JT.REQUEST_UPDATE_CONSTRAINTS,async(s,d,g)=>{try{const b=Object.assign({},this._originalConstraints,...s);await this.renewMediaStreamTrack(b),d()}catch(b){g(b)}}),this.processorContext.on(JT.REQUEST_CONSTRAINTS,async s=>{s(this._originMediaStreamTrack.getSettings())})}},C_(_b.prototype,"setDevice",[e9,n9],Object.getOwnPropertyDescriptor(_b.prototype,"setDevice"),_b.prototype),C_(_b.prototype,"setEnabled",[r9,i9,o9],Object.getOwnPropertyDescriptor(_b.prototype,"setEnabled"),_b.prototype),C_(_b.prototype,"setEncoderConfiguration",[s9,a9],Object.getOwnPropertyDescriptor(_b.prototype,"setEncoderConfiguration"),_b.prototype),C_(_b.prototype,"close",[c9],Object.getOwnPropertyDescriptor(_b.prototype,"close"),_b.prototype),_b);function nG(o,s,d,g){d.optimizationMode&&(g&&g.width&&g.height?(d.encoderConfig=rS(rS({},g),{},{bitrateMin:g.bitrateMin,bitrateMax:g.bitrateMax}),d.optimizationMode!=="motion"&&d.optimizationMode!=="detail"||(s.contentHint=d.optimizationMode,s.contentHint===d.optimizationMode?_l.debug("[".concat(o,"] set content hint to"),d.optimizationMode):_l.debug("[".concat(o,"] set content hint failed")))):_l.warning("[".concat(o,"] can not apply optimization mode bitrate config, no encoderConfig")))}var u9,l9,d9,h9,u0,p9,f9,m9,E9,g9,_9,mT;class v9 extends CY{getUserId(){return this._userId}constructor(s,d,g,b){super(s,"track-".concat(s.kind,"-").concat(d,"-").concat(b.clientId,"_").concat(z_(5,""))),bE(this,"_userId",void 0),bE(this,"_uintId",void 0),bE(this,"_isDestroyed",!1),bE(this,"store",void 0),bE(this,"processor",void 0),bE(this,"processorContext",void 0),this._userId=d,this._uintId=g,this.store=b}_updateOriginMediaStreamTrack(s){this._originMediaStreamTrack=s,this._mediaStreamTrack=s,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,_l.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let fN=(u9=s_({argsMap:(o,s,d)=>[o.getTrackId(),typeof s=="string"?s:s instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",d]}),l9=s_({argsMap:o=>[o.getTrackId()]}),d9=s_({argsMap:(o,s)=>[o.getTrackId(),s.name]}),h9=s_({argsMap:o=>[o.getTrackId()]}),C_((u0=class extends v9{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==fT.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(o,s,d,g){super(o,s,d,g),bE(this,"_videoVisibleTimer",null),bE(this,"_previousVideoVisibleStatus",void 0),bE(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),bE(this,"trackMediaType","video"),bE(this,"_videoWidth",void 0),bE(this,"_videoHeight",void 0),bE(this,"_player",void 0),bE(this,"processorDestination",void 0),bE(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new UY(this.getTrackId(),"remote"),this.processorDestination=new xY(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return eI(()=>{_l.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),VT(this,YE.GET_STATS)||rS({},bY)}play(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof o=="string"){const g=document.getElementById(o);g?o=g:(_l.warning("[".concat(this.getTrackId(),'] can not find "#').concat(o,'" element, use document.body')),o=document.body)}_l.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(o instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const d=rS(rS({fit:"cover"},s),{},{trackId:this.getTrackId(),element:o});this._player?this._player.updateConfig(d):(o instanceof HTMLVideoElement?this._player=new tG(d):this._player=new A7(d),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(lN.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=g=>{this.safeEmit(lN.VIDEO_STATE_CHANGED,g)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const g=this.getVideoElementVisibleStatus();this.safeEmit(lN.VIDEO_ELEMENT_VISIBLE_STATUS,g)}catch{}},cE("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,_l.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){FY(this._originMediaStreamTrack).then(o=>{let[s,d]=o;this._videoHeight=d,this._videoWidth=s}).catch(TD)}_updatePlayerSource(){_l.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var o,s;const d=this==null||(o=this._player)===null||o===void 0?void 0:o.getContainerElement(),g={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:d==null?void 0:d.parentElement},{element:b,slot:$}=g;if(this.isPlaying&&b instanceof HTMLVideoElement&&$ instanceof HTMLElement){const Vt=Y8.checkOneElementVisible(b),zt=Object.assign({},Vt);if(zt.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=zt.visible;const _e=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});zt.visible?_e.onSuccess("Video is visible"):_e.onSuccess("Invisible because of ".concat(zt.reason))}return zt}return}catch(d){throw new TE(rE.GET_VIDEO_ELEMENT_VISIBLE_ERROR,d.message)}}pipe(o){if(this.processor===o)return o;if(o._source)throw new TE(rE.INVALID_OPERATION,"Processor ".concat(o.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=o,this.processor._source=this,o.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),o}unpipe(){if(!this.processor)return;const o=this.processor;this.processor._source=void 0,this.processor=void 0,o.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(TT.ON_TRACK,async o=>{o?o!==this._mediaStreamTrack&&(this._mediaStreamTrack=o,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(TT.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(o){this.emit(nO.SEI_RECEIVED,o)}}).prototype,"play",[u9],Object.getOwnPropertyDescriptor(u0.prototype,"play"),u0.prototype),C_(u0.prototype,"stop",[l9],Object.getOwnPropertyDescriptor(u0.prototype,"stop"),u0.prototype),C_(u0.prototype,"pipe",[d9],Object.getOwnPropertyDescriptor(u0.prototype,"pipe"),u0.prototype),C_(u0.prototype,"unpipe",[h9],Object.getOwnPropertyDescriptor(u0.prototype,"unpipe"),u0.prototype),u0),mN=(p9=s_({argsMap:(o,s)=>[o.getTrackId(),s],throttleTime:300}),f9=s_({argsMap:(o,s)=>[o.getTrackId(),s]}),m9=s_({argsMap:o=>[o.getTrackId()]}),E9=s_({argsMap:o=>[o.getTrackId()]}),g9=s_({argsMap:(o,s)=>[o.getTrackId(),s.name]}),_9=s_({argsMap:o=>[o.getTrackId()]}),C_((mT=class extends v9{get isPlaying(){return this._useAudioElement?wT.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(o,s,d,g){super(o,s,d,g),bE(this,"trackMediaType","audio"),bE(this,"_source",void 0),bE(this,"_useAudioElement",!0),bE(this,"_volume",100),bE(this,"processorContext",void 0),bE(this,"processorDestination",void 0),bE(this,"_played",!1),bE(this,"_bypassWebAudio",!1),cE("DISABLE_WEBAUDIO")?(this._source=new $F,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new AY(o,!0),cE("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(YT.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(lN.FIRST_FRAME_DECODED)}),this.processorContext=new VY(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new jY(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(YT.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!o)return this._source.removeAllListeners(YT.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(s),this._source.removeAllListeners(YT.ON_AUDIO_BUFFER),this._source.on(YT.ON_AUDIO_BUFFER,d=>o(d))}setVolume(o){this._volume=o,this._useAudioElement?wT.setVolume(this.getTrackId(),o):this._source.setVolume(o/100)}async setPlaybackDevice(o){if(!this._useAudioElement||!yY())throw new TE(rE.NOT_SUPPORTED,"your browser does not support setting the audio output device");await wT.setSinkID(this.getTrackId(),o)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return eI(()=>{_l.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),VT(this,YE.GET_STATS)||rS({},TY)}play(){_l.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(_l.debug("[".concat(this.getTrackId(),"] use audio element to play")),wT.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){_l.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?wT.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let o=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];_l.debug("[".concat(this.getTrackId(),"] update player source track")),o&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&wT.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(o){if(this._bypassWebAudio)throw new TE(rE.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===o)return o;if(o._source)throw new TE(rE.INVALID_OPERATION,"Processor ".concat(o.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=o,this.processor._source=this,o.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),o}unpipe(){var o;if(this._bypassWebAudio)throw new TE(rE.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const s=this.processor;(o=this._source.processSourceNode)===null||o===void 0||o.disconnect(),this.processor._source=!1,this.processor=void 0,s.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(TT.ON_TRACK,async o=>{o?o!==this._mediaStreamTrack&&(this._mediaStreamTrack=o,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(o)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(TT.ON_NODE,o=>{this._source.processedNode=o;const s=!o;this._useAudioElement!==s&&(this._played?(this.stop(),this._useAudioElement=s,this.play()):this._useAudioElement=s)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(TT.ON_TRACK),this.processorDestination.removeAllListeners(TT.ON_NODE)}}).prototype,"setVolume",[p9],Object.getOwnPropertyDescriptor(mT.prototype,"setVolume"),mT.prototype),C_(mT.prototype,"setPlaybackDevice",[f9],Object.getOwnPropertyDescriptor(mT.prototype,"setPlaybackDevice"),mT.prototype),C_(mT.prototype,"play",[m9],Object.getOwnPropertyDescriptor(mT.prototype,"play"),mT.prototype),C_(mT.prototype,"stop",[E9],Object.getOwnPropertyDescriptor(mT.prototype,"stop"),mT.prototype),C_(mT.prototype,"pipe",[g9],Object.getOwnPropertyDescriptor(mT.prototype,"pipe"),mT.prototype),C_(mT.prototype,"unpipe",[_9],Object.getOwnPropertyDescriptor(mT.prototype,"unpipe"),mT.prototype),mT);const FR=new class extends nS{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),bE(this,"_lastHiddenTime",0),bE(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),_l.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};var y9=function(o){return o[o.ONE_BYTE=0]="ONE_BYTE",o[o.TWO_BYTE=1]="TWO_BYTE",o}(y9||{});class Gdt{constructor(){bE(this,"_sequence",0),bE(this,"_startTime",Date.now()),bE(this,"isUseOneByte",!0)}get startTime(){const s=Date.now()-this._startTime;return s<Math.pow(2,16)?s:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(s){const d={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:s};if(s.byteLength>128){const zt=new Uint8Array(4);zt.set([1,0,0,0]);const _e={id:0,length:4,data:zt.buffer},_r={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_e]};d.commonPacketHeader.extension=1,d.extension=_r,d.payload=this.compress(s),d.commonPacketHeader.length=8+(d.extension.length+2)+d.payload.byteLength}else d.commonPacketHeader.length=8+d.payload.byteLength;cE("SHOW_DATASTREAM2_LOG")&&_l.debug("send data header: ".concat(JSON.stringify(d.commonPacketHeader)));const g=new ArrayBuffer(d.commonPacketHeader.length),b=new Uint8Array(g),$=new DataView(g);let Vt=0;if($.setUint16(Vt,d.commonPacketHeader.extension<<15|d.commonPacketHeader.reserved<<14|d.commonPacketHeader.length,!0),Vt+=2,$.setUint32(Vt,d.commonPacketHeader.sequence,!0),Vt+=4,$.setUint16(Vt,d.commonStreamHeader,!0),Vt+=2,d.extension){const zt=this.serializeExtension(d.extension);b.set(new Uint8Array(zt),Vt),Vt+=zt.byteLength}if(b.set(new Uint8Array(d.payload),Vt),Vt+=d.payload.byteLength,Vt!==d.commonPacketHeader.length)throw Error("serialize error!");return g}deserialize(s){if(s.byteLength<4)return new ArrayBuffer(0);const d=new DataView(s);let g=0;const b=d.getUint16(g,!0);g+=2;const $={length:16383&b,reserved:(16384&b)>>14,extension:(32768&b)>>15,sequence:d.getUint16(g+2,!0)<<16|d.getUint16(g,!0)};let Vt,zt;if(g+=4,cE("SHOW_DATASTREAM2_LOG")&&_l.debug("receive data header: ".concat(JSON.stringify($))),d.getUint16(g,!0),g+=2,$.extension){zt=this.deserializeExtension(s.slice(g)),g+=2+zt.length,Vt=s.slice(g);let _e=!1;if(zt.datas.length>0){const _r=zt.datas.find(_o=>_o.id===0);_r&&(_e=(1&new DataView(_r.data).getUint32(0,!0))==1)}Vt=_e?this.decompress(Vt):Vt}else Vt=s.slice(8);return Vt}serializeExtension(s){const{profile:d,length:g,datas:b}=s,$=new ArrayBuffer(g+2),Vt=new Uint8Array($),zt=new DataView($);let _e=0;if(zt.setUint8(_e++,d),zt.setUint8(_e++,g),b.forEach(_r=>{d?(zt.setUint8(_e++,_r.id),zt.setUint8(_e++,_r.length),Vt.set(new Uint8Array(_r.data),_e),_e+=_r.data.byteLength):(zt.setUint8(_e++,_r.id|_r.length<<4),Vt.set(new Uint8Array(_r.data),_e),_e+=_r.data.byteLength)}),_e!==g+2)throw Error("serialize extension error, is ".concat(_e,"!==").concat(g+2));return $}deserializeExtension(s){const d=new DataView(s);let g=0;const b=d.getUint8(g);g++;const $=d.getUint8(g);g++;const Vt=b===y9.TWO_BYTE,zt=[],_e=new DataView(s,2);let _r=0;for(;_r<$;){let _o=0,ga=0,_a=new ArrayBuffer(0);Vt?(_o=_e.getUint8(_r),_r++,ga=_e.getUint8(_r),_r++):(_o=15&_e.getUint8(_r),ga=_e.getUint8(_r)>>4,_r++),ga>0&&(_a=_e.buffer.slice(_r+2,_r+2+ga),_r+=_a.byteLength),zt.push({id:_o,length:ga,data:_a})}if(_r!==$)throw Error("parse error");return{profile:b,length:$,datas:zt}}decompress(s){return Idt(new Uint8Array(s))}compress(s){return wdt(new Uint8Array(s))}}class S9 extends nS{constructor(s,d){super(),bE(this,"_version",1),bE(this,"_type",3),bE(this,"_config",void 0),bE(this,"_originDataChannel",void 0),bE(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),bE(this,"_dataStreamPacketHandler",void 0),bE(this,"_datachannelEventMap",new Map),this._config=s,d&&(this._originDataChannel=d,this._bandDataChannelEvents(d)),this._initPacketHeader(),this._dataStreamPacketHandler=new Gdt}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return cE("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var s,d;return(s=(d=this._originDataChannel)===null||d===void 0?void 0:d.readyState)!==null&&s!==void 0?s:"connecting"}get _originDataChannelId(){var s,d;return(s=(d=this._originDataChannel)===null||d===void 0?void 0:d.id)!==null&&s!==void 0?s:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new GE((s,d)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&s();const g=setTimeout(()=>{var b;d(new TE(rE.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((b=this._originDataChannel)===null||b===void 0?void 0:b.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(g),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),s()},this._originDataChannel.onerror=()=>{throw clearTimeout(g),new TE(rE.DATACHANNEL_CONNECTION_TIMEOUT)}}else d(new TE(rE.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(s){this._originDataChannel=s,this._bandDataChannelEvents(s)}_initPacketHeader(){const s=new DataView(this._dataStreamPacketHeader);s.setUint16(0,this._version),s.setUint8(2,this._type),s.setUint8(3,this._config.id)}_bandDataChannelEvents(s){this._unbindDataChannelEvents(s),[hL.OPEN,hL.CLOSE,hL.ERROR].forEach(d=>{const g=()=>{this.emit(d)};this._datachannelEventMap.set(d,g),s.addEventListener(d,g)})}_unbindDataChannelEvents(s){Array.from(this._datachannelEventMap.entries()).forEach(d=>{let[g,b]=d;s.removeEventListener(g,b)}),this._datachannelEventMap.clear()}}class Wdt extends S9{constructor(s){super(s),bE(this,"_messageListener",void 0),this._messageListener=d=>{if(d.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const g=d.data.slice(0,this._dataStreamPacketHeader.byteLength),b=new DataView(g).getUint8(3);if(b!==this.id)return void(cE("SHOW_DATASTREAM2_LOG")&&_l.debug("invalid datachannel id: ".concat(b," !== ").concat(this.id)));let $=d.data.slice(this._dataStreamPacketHeader.byteLength);$=this._dataStreamPacketHandler.deserialize($),this.emit(hL.MESSAGE,$)}}_updateOriginDataChannel(s){super._updateOriginDataChannel(s),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class T9 extends S9{send(s){if(this._originDataChannel){let d=s;d=this._dataStreamPacketHandler.serialize(s);const g=new Uint8Array(this._dataStreamPacketHeader.byteLength+d.byteLength);g.set(new Uint8Array(this._dataStreamPacketHeader),0),g.set(new Uint8Array(d),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(g.buffer)}}}function EL(){const o=new Blob([atob("ZnVuY3Rpb24gZShlKXtjb25zdCB0PW5ldyBEYXRhVmlldyhlLmRhdGEpO2lmKDA9PT10LmdldFVpbnQ4KDApJiYwPT09dC5nZXRVaW50OCgxKSYmMD09PXQuZ2V0VWludDgoMikmJjE9PT10LmdldFVpbnQ4KDMpJiY2PT09dC5nZXRVaW50OCg0KSl7bGV0IG49NixyPTAsbz0wO2Zvcig7MjU1PT09KG89dC5nZXRVaW50OChuKyspKTspcis9MjU1O3IrPW87Y29uc3QgYT1mdW5jdGlvbihlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLG89W10sYT0wO2Zvcig7YTxuOylhKzM8biYmMD09PXJbYV0mJjA9PT1yW2ErMV0mJjM9PT1yW2ErMl0mJigwPT09clthKzNdfHwxPT09clthKzNdfHwyPT09clthKzNdfHwzPT09clthKzNdKT8oby5wdXNoKHJbYV0sclthKzFdLHJbYSszXSksYSs9NCk6KG8ucHVzaChyW2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShvKX0oZS5kYXRhLG4scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGEpfXJldHVybiBudWxsfWZ1bmN0aW9uIHQoZSx0KXtjb25zdCBuPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9ZS5sZW5ndGg7bGV0IG49W10scj0wO2Zvcig7cjx0OylyKzI8dCYmMD09PWVbcl0mJjA9PT1lW3IrMV0mJigwPT09ZVtyKzJdfHwxPT09ZVtyKzJdfHwyPT09ZVtyKzJdfHwzPT09ZVtyKzJdKT8obi5wdXNoKGVbcl0sZVtyKzFdLDMsZVtyKzJdKSxyKz0zKToobi5wdXNoKGVbcl0pLHIrKyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KG4pfSh0KSxyPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihyLzI1NSksYT1yJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK3IrZS5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBpPTA7Zm9yKDtpPG87KXNbNitpXT0yNTUsaSsrO3JldHVybiBzWzYraV09YSxpKysscy5zZXQobiw2K2kpLHMuc2V0KG5ldyBVaW50OEFycmF5KGUpLDYraStyKSxzLmJ1ZmZlcn1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIlNhZmFyaSIpPi0xJiYtMT09PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiQ2hyb21lIikmJihzZWxmLm9ucnRjdHJhbnNmb3JtPW49Pntjb25zdCByPW4udHJhbnNmb3JtZXI7bGV0IG89W107ci5vcHRpb25zLnBvcnQub25tZXNzYWdlPWU9PntlLmRhdGEuc2VpJiZvLnB1c2goZS5kYXRhLnNlaSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBhPXIucmVhZGFibGUuZ2V0UmVhZGVyKCkscz1yLndyaXRhYmxlLmdldFdyaXRlcigpOyJyeCI9PT1yLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2EucmVhZCgpLnRoZW4oKHI9PntpZighci5kb25lKXtpZihyLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7YS5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1vLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>DK.revokeObjectURL(o),0),new Worker(DK.createObjectURL(o))}const gL=new Map,_L=new Map,vL=new Map;async function qdt(o,s){if(!R_().supportWebRTCEncodedTransform)return void _l.warning("browser not support video encoded transform");if(vL.has(o)||!o.track)return;const d={track:o.track};if(_w()){if(!o.createEncodedStreams)return void _l.warning("browser not support createEncodedStreams() API");let b=null;try{b=o.createEncodedStreams()}catch(zt){return void _l.error("create video-encoded-streams error",zt&&zt.message)}let $=[];s.on("sei-to-send",zt=>{$.push(zt)});const Vt=new TransformStream({transform(zt,_e){d.controller||(d.controller=_e),o.track&&o.track.id!==d.track.id&&(_l.debug("video track changed: ".concat(d.track.id," => ").concat(o.track.id)),d.track.removeEventListener("ended",g),d.track=o.track,d.track.addEventListener("ended",g));const _r=$.shift();_r&&(zt.data=function(_o,ga){const _a=function(iE){const fE=iE.length;let mE=[],_E=0;for(;_E<fE;)_E+2<fE&&iE[_E]===0&&iE[_E+1]===0&&(iE[_E+2]===0||iE[_E+2]===1||iE[_E+2]===2||iE[_E+2]===3)?(mE.push(iE[_E],iE[_E+1],3,iE[_E+2]),_E+=3):(mE.push(iE[_E]),_E++);return new Uint8Array(mE)}(ga),_c=_a.length,tE=Math.floor(_c/255),_p=_c%255,_f=new Uint8Array(6+tE+1+_c+_o.byteLength);_f[0]=0,_f[1]=0,_f[2]=0,_f[3]=1,_f[4]=6,_f[5]=101;let eE=0;for(;eE<tE;)_f[6+eE]=255,eE++;return _f[6+eE]=_p,eE++,_f.set(_a,6+eE),_f.set(new Uint8Array(_o),6+eE+_c),_f.buffer}(zt.data,_r)),_e.enqueue(zt)}});b.readable.pipeThrough(Vt).pipeTo(b.writable)}else{if(!GS())return;{if(typeof RTCRtpScriptTransform>"u")return void _l.warning("browser not support RTCRtpScriptTransform");const b=EL(),$=new MessageChannel;await new GE(zt=>b.onmessage=_e=>{_e.data==="registered"&&zt(void 0)});const Vt=new RTCRtpScriptTransform(b,{name:"tx",port:$.port2},[$.port2]);o.transform=Vt,await new GE(zt=>b.onmessage=_e=>{_e.data==="started"&&zt(void 0)}),s.on("sei-to-send",zt=>{$.port1.postMessage({sei:zt})}),$.port1.onmessage=zt=>{var _e;zt.data.transformed&&o.track&&((_e=o.track)===null||_e===void 0?void 0:_e.id)!==d.track.id&&(_l.debug("video track changed: ".concat(d.track.id," => ").concat(o.track.id)),d.track.removeEventListener("ended",g),d.track=o.track,d.track.addEventListener("ended",g))},d.worker=b}}function g(){if(o.track){if(this.id!==o.track.id)return;o.track.removeEventListener("ended",g)}const b=vL.get(o);if(b){vL.delete(o);try{var $,Vt;($=b.controller)===null||$===void 0||$.terminate(),(Vt=b.worker)===null||Vt===void 0||Vt.terminate()}catch(zt){_l.warning(zt&&zt.message)}}}vL.set(o,d),o.track.addEventListener("ended",g)}const jP=new Map;async function Hdt(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!R_().supportWebRTCEncodedTransform)return void _l.warning("browser not support video encoded transform");if(!o.track)return;if(jP.has(o)){const b=jP.get(o);return void(b&&(b.onSei=s.onSei))}const d={track:o.track,onSei:s.onSei};if(_w()){if(!o.createEncodedStreams)return void _l.warning("browser not support createEncodedStreams() API");let b=null;try{b=o.createEncodedStreams()}catch(Vt){return void _l.error("create video-encoded-streams error",Vt&&Vt.message)}const $=new TransformStream({transform(Vt,zt){d.controller||(d.controller=zt),o.track&&o.track.id!==d.track.id&&(_l.debug("video track changed: ".concat(d.track.id," => ").concat(o.track.id)),d.track.removeEventListener("ended",g),d.track=o.track,d.track.addEventListener("ended",g));const _e=function(_r){const _o=new DataView(_r.data);if(_o.getUint8(0)===0&&_o.getUint8(1)===0&&_o.getUint8(2)===0&&_o.getUint8(3)===1&&_o.getUint8(4)===6){let ga=6,_a=0,_c=0;for(;(_c=_o.getUint8(ga++))===255;)_a+=255;_a+=_c;const tE=function(_p,_f,eE){let iE=new Uint8Array(_p,_f,eE),fE=[],mE=0;for(;mE<eE;)mE+3<eE&&iE[mE]===0&&iE[mE+1]===0&&iE[mE+2]===3&&(iE[mE+3]===0||iE[mE+3]===1||iE[mE+3]===2||iE[mE+3]===3)?(fE.push(iE[mE],iE[mE+1],iE[mE+3]),mE+=4):(fE.push(iE[mE]),mE++);return new Uint8Array(fE)}(_r.data,ga,_a);return new Uint8Array(tE)}return null}(Vt);_e&&d.onSei&&d.onSei(_e),zt.enqueue(Vt)}});b.readable.pipeThrough($).pipeTo(b.writable)}else if(GS()){if(typeof RTCRtpScriptTransform>"u")return void _l.warning("browser not support RTCRtpScriptTransform");const b=EL(),$=new MessageChannel;await new GE(zt=>b.onmessage=_e=>{_e.data==="registered"&&zt(void 0)});const Vt=new RTCRtpScriptTransform(b,{name:"rx",port:$.port2},[$.port2]);o.transform=Vt,await new GE(zt=>b.onmessage=_e=>{_e.data==="started"&&zt(void 0)}),$.port1.onmessage=zt=>{var _e;zt.data.transformed&&o.track&&((_e=o.track)===null||_e===void 0?void 0:_e.id)!==d.track.id?(_l.debug("video track changed: ".concat(d.track.id," => ").concat(o.track.id)),d.track.removeEventListener("ended",g),d.track=o.track,d.track.addEventListener("ended",g)):zt.data.sei&&d.onSei&&d.onSei(zt.data.sei)},d.worker=b}function g(){if(o.track){if(this.id!==o.track.id)return;o.track.removeEventListener("ended",g)}(function(b){const $=jP.get(b);if($){jP.delete(b);try{var Vt,zt;(Vt=$.controller)===null||Vt===void 0||Vt.terminate(),(zt=$.worker)===null||zt===void 0||zt.terminate()}catch(_e){_l.warning(_e&&_e.message)}}})(o)}jP.set(o,d),o.track.addEventListener("ended",g)}(function(){const o=O_();nT.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),nT.getStreamFromExtension=o.name===M_.CHROME&&Number(o.version)>34,nT.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const s=new RTCPeerConnection;let d=!1;try{s.addTransceiver("audio"),d=!0}catch{}return s.close(),d}(),nT.supportMinBitrate=o.name===M_.CHROME||o.name===M_.EDGE,nT.supportSetRtpSenderParameters=function(){const s=O_();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!tI()||!(!GS()&&!_D())||s.name===M_.FIREFOX&&Number(s.version)>=64)}(),o.name===M_.SAFARI&&(Number(o.version)>=14?nT.supportDualStream=!0:nT.supportDualStream=!1),nT.webAudioMediaStreamDest=function(){const s=O_();return!(s.name===M_.SAFARI&&Number(s.version)<12)}(),nT.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",nT.supportWebGL=typeof WebGLRenderingContext<"u",nT.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,tI()||(nT.webAudioWithAEC=!0),nT.supportShareAudio=function(){const s=O_();return(s.os===BS.WIN_10||s.os===BS.WIN_81||s.os===BS.WIN_7||s.os===BS.LINUX||s.os===BS.MAC_OS||s.os===BS.CHROMIUM_OS)&&s.name===M_.CHROME&&Number(s.version)>=74}(),nT.supportDataChannel=!!(_V(76)||function(s){const d=O_();return!(d.name!==M_.FIREFOX||!d.osVersion)&&Number(d.version)>=s}(68)||M8(14)),nT.supportPCSetConfiguration=function(){const s=window.RTCPeerConnection;return!H_()&&!!s&&s.prototype.setConfiguration instanceof Function}(),nT.supportWebRTCEncodedTransform=function(){const s=O_();return s.name==="Chrome"&&Number(s.version)>=86||s.name==="Safari"&&Number(s.version)>=15}(),nT.supportWebRTCInsertableStream=function(){const s=O_();return(s.name===M_.CHROME||s.name===M_.EDGE)&&Number(s.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),nT.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,nT.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,SD(()=>{nT.supportDualStreamEncoding=function(){const s=O_();return!!cE("DISABLE_WEBAUDIO")||s.name==="Safari"&&Number(s.version)>=14||!!(s.name==="Chrome"&&/Windows/i.test(s.os||"")&&Number(s.version)>=100&&cE("CHROME_DUAL_STREAM_USE_ENCODING"))}(),_l.info("browser compatibility",JSON.stringify(nT),JSON.stringify(o))})})();class Kdt extends nS{constructor(){super(...arguments),Qm(this,"resultStorage",new Map)}setLocalAudioStats(s,d,g){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",s,this.checkAudioInputLevel(g,d)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",s,this.checkSendAudioBitrate(g,d))}setLocalVideoStats(s,d,g){this.record("SEND_VIDEO_BITRATE_TOO_LOW",s,this.checkSendVideoBitrate(g,d)),this.record("FRAMERATE_INPUT_TOO_LOW",s,this.checkFramerateInput(g,d)),this.record("FRAMERATE_SENT_TOO_LOW",s,this.checkFramerateSent(g))}setRemoteAudioStats(s,d){const g=s.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",g,this.checkAudioOutputLevel(d))}setRemoteVideoStats(s,d){const g=s.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",g,this.checkVideoDecode(d))}record(s,d,g){if(cE("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(s)||this.resultStorage.set(s,{result:[],isPrevNormal:!0});const b=this.resultStorage.get(s);if(b&&(b.result.push(g),b.result.length>=5)){var $;const Vt=KE($=b.result).call($,!0);b.isPrevNormal&&!Vt&&this.emit("exception",b9[s],s,d),!b.isPrevNormal&&Vt&&this.emit("exception",b9[s]+2e3,s+"_RECOVER",d),b.isPrevNormal=Vt,b.result=[]}}checkAudioOutputLevel(s){return!(s.receiveBitrate>0&&s.receiveLevel===0)}checkAudioInputLevel(s,d){return d instanceof jS&&!d.isActive||!!d.muted||s.sendVolumeLevel!==0}checkFramerateInput(s,d){let g=null;d._encoderConfig&&d._encoderConfig.frameRate&&(g=kT(d._encoderConfig.frameRate));const b=s.captureFrameRate;return!g||!b||!(g>10&&b<5||g<10&&g>=5&&b<=1)}checkFramerateSent(s){return!(s.captureFrameRate&&s.sendFrameRate&&s.captureFrameRate>5&&s.sendFrameRate<=1)}checkSendVideoBitrate(s,d){return!!d.muted||s.sendBitrate!==0}checkSendAudioBitrate(s,d){return d instanceof jS&&!d.isActive||!!d.muted||s.sendBitrate!==0}checkVideoDecode(s){return s.receiveBitrate===0||s.decodeFrameRate!==0}}const b9={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},aT=new class{markSubscribeStart(o,s){performance.mark("agora-web-sdk/".concat(o,"/subscribe-").concat(s))}markPublishStart(o,s){performance.mark("agora-web-sdk/".concat(o,"/publish-").concat(s))}measureFromSubscribeStart(o,s){const d=performance.getEntriesByName("agora-web-sdk/".concat(o,"/subscribe-").concat(s));if(d.length>0){const g=d[d.length-1];return Math.round(performance.now()-g.startTime)}return 0}measureFromPublishStart(o,s){const d=performance.getEntriesByName("agora-web-sdk/".concat(o,"/publish-").concat(s));if(d.length>0){const g=d[d.length-1];return Math.round(performance.now()-g.startTime)}return 0}};function rG(o,s){this.v=o,this.k=s}function f_(o){return new rG(o,0)}var zdt=lW,Ydt=sR;X_({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var o=Ydt.f(this);return{promise:o.promise,resolve:o.resolve,reject:o.reject}}});var Jdt=sR,Xdt=bO;X_({target:"Promise",stat:!0,forced:!0},{try:function(o){var s=Jdt.f(this),d=Xdt(o);return(d.error?s.reject:s.resolve)(d.value),s.promise}});var iG=j(zdt),R9=OO.f("asyncIterator"),Qdt=j(R9);function VP(o){var s,d;function g($,Vt){try{var zt=o[$](Vt),_e=zt.value,_r=_e instanceof rG;iG.resolve(_r?_e.v:_e).then(function(_o){if(_r){var ga=$==="return"?"return":"next";if(!_e.k||_o.done)return g(ga,_o);_o=o[ga](_o).value}b(zt.done?"return":"normal",_o)},function(_o){g("throw",_o)})}catch(_o){b("throw",_o)}}function b($,Vt){switch($){case"return":s.resolve({value:Vt,done:!0});break;case"throw":s.reject(Vt);break;default:s.resolve({value:Vt,done:!1})}(s=s.next)?g(s.key,s.arg):d=null}this._invoke=function($,Vt){return new iG(function(zt,_e){var _r={key:$,arg:Vt,resolve:zt,reject:_e,next:null};d?d=d.next=_r:(s=d=_r,g($,Vt))})},typeof o.return!="function"&&(this.return=void 0)}function BT(o){return function(){return new VP(o.apply(this,arguments))}}VP.prototype[typeof kO=="function"&&Qdt||"@@asyncIterator"]=function(){return this},VP.prototype.next=function(o){return this._invoke("next",o)},VP.prototype.throw=function(o){return this._invoke("throw",o)},VP.prototype.return=function(o){return this._invoke("return",o)};var C9=j(V0.Object.getOwnPropertySymbols),Zdt=X_,$dt=cM.indexOf,tht=n1,oG=yE([].indexOf),w9=!!oG&&1/oG([1],1,-0)<0;Zdt({target:"Array",proto:!0,forced:w9||!tht("indexOf")},{indexOf:function(o){var s=arguments.length>1?arguments[1]:void 0;return w9?oG(this,o,s)||0:$dt(this,o,s)}});var eht=E0("Array").indexOf,nht=_d,rht=eht,sG=Array.prototype,iht=function(o){var s=o.indexOf;return o===sG||nht(sG,o)&&s===sG.indexOf?rht:s},I9=j(iht);function oht(o,s){if(o==null)return{};var d,g,b=function(Vt,zt){if(Vt==null)return{};var _e,_r,_o={},ga=v4(Vt);for(_r=0;_r<ga.length;_r++)_e=ga[_r],I9(zt).call(zt,_e)>=0||(_o[_e]=Vt[_e]);return _o}(o,s);if(C9){var $=C9(o);for(g=0;g<$.length;g++)d=$[g],I9(s).call(s,d)>=0||Object.prototype.propertyIsEnumerable.call(o,d)&&(b[d]=o[d])}return b}var O9={exports:{}};(function(o,s){o.exports=(()=>{var d={8:($,Vt,zt)=>{zt.r(Vt),zt.d(Vt,{Parser:()=>b_,Printer:()=>U0,parse:()=>u_,print:()=>P_});const _e=`
`,_r="".concat("\r").concat(_e),_o=" ";let ga;function _a(WE){return WE>="0"&&WE<="9"}function _c(WE){return WE>="!"&&WE<="~"}function tE(WE){return _c(WE)||WE>=""&&WE<=""}function _p(WE){return WE==="!"||WE>="#"&&WE<="'"||WE>="*"&&WE<="+"||WE>="-"&&WE<="."||WE>="0"&&WE<="9"||WE>="A"&&WE<="Z"||WE>="^"&&WE<="~"}function _f(WE){return WE>="1"&&WE<="9"}function eE(WE){return WE>="A"&&WE<="Z"||WE>="a"&&WE<="z"}function iE(WE){return WE==="d"||WE==="h"||WE==="m"||WE==="s"}function fE(WE){return WE>""&&WE<"	"||WE>"\v"&&WE<"\f"||WE>""&&WE<""}function mE(WE){return eE(WE)||_a(WE)||WE==="+"||WE==="/"}function _E(WE){return _a(WE)||eE(WE)||WE==="+"||WE==="/"||WE==="-"||WE==="_"}function SE(WE){return eE(WE)||_a(WE)||WE==="+"||WE==="/"}function wE(WE,_m){var lE=Object.keys(WE);if(Object.getOwnPropertySymbols){var pE=Object.getOwnPropertySymbols(WE);_m&&(pE=pE.filter(function(xE){return Object.getOwnPropertyDescriptor(WE,xE).enumerable})),lE.push.apply(lE,pE)}return lE}function NE(WE){for(var _m=1;_m<arguments.length;_m++){var lE=arguments[_m]!=null?arguments[_m]:{};_m%2?wE(Object(lE),!0).forEach(function(pE){DE(WE,pE,lE[pE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(WE,Object.getOwnPropertyDescriptors(lE)):wE(Object(lE)).forEach(function(pE){Object.defineProperty(WE,pE,Object.getOwnPropertyDescriptor(lE,pE))})}return WE}function DE(WE,_m,lE){return _m in WE?Object.defineProperty(WE,_m,{value:lE,enumerable:!0,configurable:!0,writable:!0}):WE[_m]=lE,WE}(function(WE){WE.VERSION="v",WE.ORIGIN="o",WE.SESSION_NAME="s",WE.INFORMATION="i",WE.URI="u",WE.EMAIL="e",WE.PHONE="p",WE.CONNECTION="c",WE.BANDWIDTH="b",WE.TIME="t",WE.REPEAT="r",WE.ZONE_ADJUSTMENTS="z",WE.KEY="k",WE.ATTRIBUTE="a",WE.MEDIA="m"})(ga||(ga={}));class JE{consumeText(_m,lE){let pE=lE;for(;pE<_m.length;){const xE=_m[pE];if(xE==="\0"||xE==="\r"||xE===_e)break;pE+=1}if(pE-lE==0)throw new Error("Invalid text, at ".concat(_m));return pE}consumeUnicastAddress(_m,lE,pE){return this.consumeTill(_m,lE,_o)}consumeOneOrMore(_m,lE,pE){let xE=lE;for(;pE(_m[xE]);)xE++;if(xE-lE==0)throw new Error("Invalid rule at ".concat(lE,"."));return xE}consumeSpace(_m,lE){if(_m[lE]===_o)return lE+1;throw new Error("Invalid space at ".concat(lE,"."))}consumeIP4Address(_m,lE){let pE=lE;for(let xE=0;xE<4;xE++)if(pE=this.consumeDecimalUChar(_m,pE),xE!==3){if(_m[pE]!==".")throw new Error("Invalid IP4 address.");pE++}return pE}consumeDecimalUChar(_m,lE){let pE=lE;for(let l_=0;l_<3&&_a(_m[pE]);l_++,pE++);if(pE-lE==0)throw new Error("Invalid decimal uchar.");const xE=parseInt(_m.slice(lE,pE));if(xE>=0&&xE<=255)return pE;throw new Error("Invalid decimal uchar")}consumeIP6Address(_m,lE){let pE=this.consumeHexpart(_m,lE);return _m[pE]===":"&&(pE+=1,pE=this.consumeIP4Address(_m,pE)),pE}consumeHexpart(_m,lE){let pE=lE;if(_m[pE]===":"&&_m[pE+1]===":"){pE+=2;try{pE=this.consumeHexseq(_m,pE)}catch{}return pE}if(pE=this.consumeHexseq(_m,pE),_m[pE]===":"&&_m[pE+1]===":"){pE+=2;try{pE=this.consumeHexseq(_m,pE)}catch{}return pE}return pE}consumeHexseq(_m,lE){let pE=lE;for(;pE=this.consumeHex4(_m,pE),_m[pE]===":"&&_m[pE+1]!==":";)pE+=1;return pE}consumeHex4(_m,lE){let pE=0;for(;pE<4;pE++)if(!((xE=_m[lE+pE])>="0"&&xE<="9"||xE>="a"&&xE<="f"||xE>="A"&&xE<="F")){if(pE===0)throw new Error("Invalid hex 4");break}var xE;return lE+pE}consumeFQDN(_m,lE){let pE=lE;for(;_a(_m[pE])||eE(_m[pE])||_m[pE]==="-"||_m[pE]===".";)pE+=1;if(pE-lE<4)throw new Error("Invalid FQDN");return pE}consumeExtnAddr(_m,lE){return this.consumeOneOrMore(_m,lE,tE)}consumeMulticastAddress(_m,lE,pE){switch(pE){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(_m,lE);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(_m,lE);default:try{return this.consumeFQDN(_m,lE)}catch{return this.consumeExtnAddr(_m,lE)}}}consumeIP6MulticastAddress(_m,lE){const pE=this.consumeHexpart(_m,lE);return _m[pE]==="/"?this.consumeInteger(_m,pE+1):pE}consumeIP4MulticastAddress(_m,lE){let pE=lE+3;const xE=_m.slice(lE,pE),l_=parseInt(xE);if(l_<224||l_>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let G_=0;G_<3;G_++){if(_m[pE]!==".")throw new Error("Invalid IP4 multicast address.");pE+=1,pE=this.consumeDecimalUChar(_m,pE)}return _m[pE]==="/"&&(pE+=1),pE=this.consumeTTL(_m,pE),_m[pE]==="/"&&(pE=this.consumeInteger(_m,pE)),pE}consumeInteger(_m,lE){if(!_f(_m[lE]))throw new Error("Invalid integer.");for(lE+=1;_a(_m[lE]);)lE+=1;return lE}consumeTTL(_m,lE){if(_m[lE]==="0")return lE+1;if(!_f(_m[lE]))throw new Error("Invalid TTL.");lE+=1;for(let pE=0;pE<2&&_a(_m[lE]);pE++)lE+=1;return lE}consumeToken(_m,lE){return this.consumeOneOrMore(_m,lE,_p)}consumeTime(_m,lE){let pE=lE;if(_m[pE]==="0")return pE+1;for(_f(_m[pE])&&(pE+=1);_a(_m[pE]);)pE++;if(pE-lE<10)throw new Error("Invalid time");return pE}consumeAddress(_m,lE){return this.consumeTill(_m,lE,_o)}consumeTypedTime(_m,lE){let pE=lE;return pE=this.consumeOneOrMore(_m,pE,_a),iE(_m[pE])?pE+1:pE}consumeRepeatInterval(_m,lE){if(!_f(_m[lE]))throw new Error("Invalid repeat interval");for(lE+=1;_a(_m[lE]);)lE+=1;return iE(_m[lE])&&(lE+=1),lE}consumePort(_m,lE){return this.consumeOneOrMore(_m,lE,_a)}consume(_m,lE,pE){for(let xE=0;xE<pE.length;xE++){if(lE+xE>=_m.length)throw new Error("consume exceeding value length");if(_m[lE+xE]!==pE[xE])throw new Error("consume ".concat(pE," failed at ").concat(xE))}return lE+pE.length}consumeTill(_m,lE,pE){let xE=lE;for(;xE<_m.length&&(typeof pE!="string"||_m[xE]!==pE)&&(typeof pE!="function"||!pE(_m[xE]));)xE++;return xE}}class b_ extends JE{constructor(){super(),DE(this,"records",[]),DE(this,"currentLine",0)}parse(_m){const lE=this.probeEOL(_m);this.records=_m.split(lE).filter(LS=>!!dT(LS).call(LS)).map(this.parseLine),this.currentLine=0;const pE=this.parseVersion(),xE=this.parseOrigin(),l_=this.parseSessionName(),G_=this.parseInformation(),FS=this.parseUri(),MT=this.parseEmail(),WR=this.parsePhone(),WL=this.parseConnection(),qL=this.parseBandWidth(),p0=this.parseTimeFields(),CI=this.parseKey(),RN=this.parseSessionAttribute(),SS=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:pE,origin:xE,sessionName:l_,information:G_,uri:FS,emails:MT,phones:WR,connection:WL,bandwidths:qL,timeFields:p0,key:CI,attributes:RN,mediaDescriptions:SS}}getCurrentRecord(){const _m=this.records[this.currentLine];if(!_m)throw new Error("Record doesn't exit.");return _m}probeEOL(_m){for(let lE=0;lE<_m.length;lE++)if(_m[lE]===_e)return _m[lE-1]==="\r"?_r:_e;throw new Error("Invalid newline character.")}parseLine(_m,lE){if(_m.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const pE=_m[0];if(_m[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:pE,value:_m.slice(2),line:lE,cur:0}}parseSessionAttribute(){const _m=new $_;for(;this.currentLine<this.records.length;){const lE=this.getCurrentRecord();if(lE.type!==ga.ATTRIBUTE)break;const pE={attField:this.extractOneOrMore(lE,xE=>_p(xE)&&xE!==":"),_cur:0};lE.value[lE.cur]===":"&&(lE.cur+=1,pE.attValue=this.extractOneOrMore(lE,fE)),_m.parse(pE),this.currentLine++}return _m.digest()}parseMediaAttributes(_m){const lE=new OS(_m);for(;this.currentLine<this.records.length;){const pE=this.getCurrentRecord();if(pE.type!==ga.ATTRIBUTE)break;const xE={attField:this.extractOneOrMore(pE,l_=>_p(l_)&&l_!==":"),_cur:0};pE.value[pE.cur]===":"&&(pE.cur+=1,xE.attValue=this.extractOneOrMore(pE,fE)),lE.parse(xE),this.currentLine++}return lE.digest()}parseKey(){const _m=this.getCurrentRecord();if(_m.type===ga.KEY){if(_m.value==="prompt"||_m.value==="clear:"||_m.value==="base64:"||_m.value==="uri:")return _m.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const _m=this.getCurrentRecord();if(_m.type===ga.ZONE_ADJUSTMENTS){const lE=[];for(;;)try{const pE=this.extract(_m,this.consumeTime);this.consumeSpaceForRecord(_m);let xE=!1;_m.value[_m.cur]==="-"&&(xE=!0,_m.cur+=1);const l_=this.extract(_m,this.consumeTypedTime);lE.push({time:pE,typedTime:l_,back:xE})}catch{break}if(lE.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,lE}return[]}parseRepeat(){const _m=[];for(;;){const lE=this.getCurrentRecord();if(lE.type!==ga.REPEAT)break;{const pE=this.extract(lE,this.consumeRepeatInterval),xE=this.parseTypedTime(lE);_m.push({repeatInterval:pE,typedTimes:xE}),this.currentLine++}}return _m}parseTypedTime(_m){const lE=[];for(;;)try{this.consumeSpaceForRecord(_m),lE.push(this.extract(_m,this.consumeTypedTime))}catch{break}if(lE.length===0)throw new Error("Invalid typed time.");return lE}parseTime(){const _m=this.getCurrentRecord(),lE=this.extract(_m,this.consumeTime);this.consumeSpaceForRecord(_m);const pE=this.extract(_m,this.consumeTime);return this.currentLine++,{startTime:lE,stopTime:pE}}parseBandWidth(){const _m=[];for(;this.currentLine<this.records.length;){const lE=this.getCurrentRecord();if(lE.type!==ga.BANDWIDTH)break;{const pE=this.extractOneOrMore(lE,_p);if(lE.value[lE.cur]!==":")throw new Error("Invalid bandwidth field.");lE.cur++;const xE=this.extractOneOrMore(lE,_a);_m.push({bwtype:pE,bandwidth:xE}),this.currentLine++}}return _m}parseVersion(){const _m=this.getCurrentRecord();if(_m.type!==ga.VERSION)throw new Error("first sdp record must be version");const lE=_m.value.slice(0,this.consumeOneOrMore(_m.value,0,_a));if(lE.length!==_m.value.length)throw new Error('invalid proto version, "v='.concat(_m.value,'"'));return this.currentLine++,lE}parseOrigin(){const _m=this.getCurrentRecord();if(_m.type!==ga.ORIGIN)throw new Error("second line of sdp must be origin");const lE=this.extractOneOrMore(_m,tE);this.consumeSpaceForRecord(_m);const pE=this.extractOneOrMore(_m,_a);this.consumeSpaceForRecord(_m);const xE=this.extractOneOrMore(_m,_a);this.consumeSpaceForRecord(_m);const l_=this.extractOneOrMore(_m,_p);this.consumeSpaceForRecord(_m);const G_=this.extractOneOrMore(_m,_p);this.consumeSpaceForRecord(_m);const FS=this.extract(_m,this.consumeUnicastAddress);return this.currentLine++,{username:lE,sessId:pE,sessVersion:xE,nettype:l_,addrtype:G_,unicastAddress:FS}}parseSessionName(){const _m=this.getCurrentRecord();if(_m.type===ga.SESSION_NAME){const lE=this.extract(_m,this.consumeText);return this.currentLine++,lE}}parseInformation(){const _m=this.getCurrentRecord();if(_m.type!==ga.INFORMATION)return;const lE=this.extract(_m,this.consumeText);return this.currentLine++,lE}parseUri(){const _m=this.getCurrentRecord();if(_m.type===ga.URI)return this.currentLine++,_m.value}parseEmail(){const _m=[];for(;;){const lE=this.getCurrentRecord();if(lE.type!==ga.EMAIL)break;_m.push(lE.value),this.currentLine++}return _m}parsePhone(){const _m=[];for(;;){const lE=this.getCurrentRecord();if(lE.type!==ga.PHONE)break;_m.push(lE.value),this.currentLine++}return _m}parseConnection(){const _m=this.getCurrentRecord();if(_m.type===ga.CONNECTION){const lE=this.extractOneOrMore(_m,_p);this.consumeSpaceForRecord(_m);const pE=this.extractOneOrMore(_m,_p);this.consumeSpaceForRecord(_m);const xE=this.extract(_m,this.consumeAddress);return this.currentLine++,{nettype:lE,addrtype:pE,address:xE}}}parseMedia(){const _m=this.getCurrentRecord(),lE=this.extract(_m,this.consumeToken);this.consumeSpaceForRecord(_m);let pE=this.extract(_m,this.consumePort);_m.value[_m.cur]==="/"&&(_m.cur+=1,pE+=this.extract(_m,this.consumeInteger)),this.consumeSpaceForRecord(_m);const xE=[];for(xE.push(this.extract(_m,this.consumeToken));_m.value[_m.cur]==="/";)_m.cur+=1,xE.push(this.extract(_m,this.consumeToken));if(xE.length===0)throw new Error("Invalid proto");const l_=this.parseFmt(_m);return this.currentLine++,{mediaType:lE,port:pE,protos:xE,fmts:l_}}parseTimeFields(){const _m=[];for(;this.getCurrentRecord().type===ga.TIME;){const lE=this.parseTime(),pE=this.parseRepeat(),xE=this.parseZone();_m.push({time:lE,repeats:pE,zones:xE})}return _m}parseMediaDescription(){const _m=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===ga.MEDIA;){const lE=this.parseMedia(),pE=this.parseInformation(),xE=this.parseConnections(),l_=this.parseBandWidth(),G_=this.parseKey(),FS=this.parseMediaAttributes(lE);_m.push({media:lE,information:pE,connections:xE,bandwidths:l_,key:G_,attributes:FS})}return _m}parseConnections(){const _m=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===ga.CONNECTION;)_m.push(this.parseConnection());return _m}parseFmt(_m){const lE=[];for(;;)try{this.consumeSpaceForRecord(_m),lE.push(this.extract(_m,this.consumeToken))}catch{break}if(lE.length===0)throw new Error("Invalid fmts");return lE}extract(_m,lE){for(var pE=arguments.length,xE=new Array(pE>2?pE-2:0),l_=2;l_<pE;l_++)xE[l_-2]=arguments[l_];const G_=lE.call(this,_m.value,_m.cur,...xE),FS=_m.value.slice(_m.cur,G_);return _m.cur=G_,FS}extractOneOrMore(_m,lE){const pE=this.consumeOneOrMore(_m.value,_m.cur,lE),xE=_m.value.slice(_m.cur,pE);return _m.cur=pE,xE}consumeSpaceForRecord(_m){if(_m.value[_m.cur]!==_o)throw new Error("Invalid space at ".concat(_m.cur,"."));_m.cur+=1}}class L_ extends JE{constructor(){super(...arguments),DE(this,"attributes",void 0),DE(this,"digested",!1)}extractOneOrMore(_m,lE,pE){const xE=this.consumeOneOrMore(_m.attValue,_m._cur,lE),l_=_m.attValue.slice(_m._cur,xE),[G_,FS]=pE||[];if(typeof G_=="number"&&l_.length<G_)throw new Error("error in length, should be more or equal than ".concat(G_," characters."));if(typeof FS=="number"&&l_.length>FS)throw new Error("error in length, should be less or equal than ".concat(FS," characters."));return _m._cur=xE,l_}consumeAttributeSpace(_m){if(_m.attValue[_m._cur]!==_o)throw new Error("Invalid space at ".concat(_m._cur,"."));_m._cur+=1}extract(_m,lE){if(!_m.attValue)throw new Error("Nothing to extract from attValue.");for(var pE=arguments.length,xE=new Array(pE>2?pE-2:0),l_=2;l_<pE;l_++)xE[l_-2]=arguments[l_];const G_=lE.call(this,_m.attValue,_m._cur,...xE),FS=_m.attValue.slice(_m._cur,G_);return _m._cur=G_,FS}atEnd(_m){if(!_m.attValue)throw new Error;return _m._cur>=_m.attValue.length}peekChar(_m){if(!_m.attValue)throw new Error;return _m.attValue[_m._cur]}peek(_m,lE){if(!_m.attValue)throw new Error;for(let pE=0;pE<lE.length;pE++)if(lE[pE]!==_m.attValue[_m._cur+pE])return!1;return!0}parseIceUfrag(_m){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(_m,mE,[4,256])}parseIcePwd(_m){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(_m,mE,[22,256])}parseIceOptions(_m){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const lE=[];for(;!this.atEnd(_m);){lE.push(this.extractOneOrMore(_m,mE));try{this.consumeAttributeSpace(_m)}catch(pE){if(this.atEnd(_m))break;throw pE}}this.attributes.iceOptions=lE}parseFingerprint(_m){const lE=this.extract(_m,this.consumeToken);this.consumeAttributeSpace(_m);const pE=this.extract(_m,this.consumeTill);this.attributes.fingerprints.push({hashFunction:lE,fingerprint:pE})}parseExtmap(_m){const lE=this.extractOneOrMore(_m,_a);let pE;this.peekChar(_m)==="/"&&(this.extract(_m,this.consume,"/"),pE=this.extract(_m,this.consumeToken)),this.consumeAttributeSpace(_m);const xE=this.extract(_m,this.consumeTill,_o),l_=NE(NE({entry:parseInt(lE,10)},pE&&{direction:pE}),{},{extensionName:xE});this.peekChar(_m)===_o&&(this.consumeAttributeSpace(_m),l_.extensionAttributes=this.extract(_m,this.consumeTill)),this.attributes.extmaps.push(l_)}parseSetup(_m){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const lE=this.extract(_m,this.consumeTill);if(lE!=="active"&&lE!=="passive"&&lE!=="actpass"&&lE!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=lE}}class $_ extends L_{constructor(){super(...arguments),DE(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(_m){if(this.digested)throw new Error("already digested");try{switch(_m.attField){case"group":this.parseGroup(_m);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(_m);break;case"ice-pwd":this.parseIcePwd(_m);break;case"ice-options":this.parseIceOptions(_m);break;case"fingerprint":this.parseFingerprint(_m);break;case"setup":this.parseSetup(_m);break;case"tls-id":this.parseTlsId(_m);break;case"identity":this.parseIdentity(_m);break;case"extmap":this.parseExtmap(_m);break;case"msid-semantic":this.parseMsidSemantic(_m);break;default:_m.ignored=!0,this.attributes.unrecognized.push(_m)}}catch(lE){throw console.error("parsing session attribute ".concat(_m.attField,' error, "a=').concat(_m.attField,":").concat(_m.attValue,'"')),lE}if(!_m.ignored&&_m.attValue&&!this.atEnd(_m))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(_m){const lE=this.extract(_m,this.consumeToken),pE=[];for(;!this.atEnd(_m)&&this.peekChar(_m)===_o;)this.consumeAttributeSpace(_m),pE.push(this.extract(_m,this.consumeToken));this.attributes.groups.push({semantic:lE,identificationTag:pE})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(_m){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(_m,_E)}parseIdentity(_m){const lE=this.extractOneOrMore(_m,SE),pE=[];for(;!this.atEnd(_m)&&this.peekChar(_m)===_o;){this.consumeAttributeSpace(_m);const xE=this.extract(_m,this.consumeToken);this.extract(_m,this.consume,"=");const l_=this.extractOneOrMore(_m,G_=>G_!==_o&&fE(G_));pE.push({name:xE,value:l_})}this.attributes.identities.push({assertionValue:lE,extensions:pE})}parseMsidSemantic(_m){this.peekChar(_m)===_o&&this.consumeAttributeSpace(_m);const lE={semantic:this.extract(_m,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(_m)}catch{break}if(this.peekChar(_m)==="*"){this.extract(_m,this.consume,"*"),lE.applyForAll=!0;break}{const pE=this.extract(_m,this.consumeTill,_o);lE.identifierList.push(pE)}}this.attributes.msidSemantic=lE}}class OS extends L_{constructor(_m){super(),DE(this,"attributes",void 0),_m.protos.indexOf("RTP")!==-1||_m.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(_m){if(this.digested)throw new Error("already digested");try{switch(_m.attField){case"extmap":this.parseExtmap(_m);break;case"setup":this.parseSetup(_m);break;case"ice-ufrag":this.parseIceUfrag(_m);break;case"ice-pwd":this.parseIcePwd(_m);break;case"ice-options":this.parseIceOptions(_m);break;case"candidate":this.parseCandidate(_m);break;case"remote-candidate":this.parseRemoteCandidate(_m);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(_m);break;case"rtpmap":this.parseRtpmap(_m);break;case"ptime":this.parsePtime(_m);break;case"maxptime":this.parseMaxPtime(_m);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(_m);break;case"ssrc":this.parseSSRC(_m);break;case"fmtp":this.parseFmtp(_m);break;case"rtcp-fb":this.parseRtcpFb(_m);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(_m);break;case"mid":this.parseMid(_m);break;case"msid":this.parseMsid(_m);break;case"imageattr":this.parseImageAttr(_m);break;case"rid":this.parseRid(_m);break;case"simulcast":this.parseSimulcast(_m);break;case"sctp-port":this.parseSctpPort(_m);break;case"max-message-size":this.parseMaxMessageSize(_m);break;case"ssrc-group":this.parseSSRCGroup(_m);break;default:_m.ignored=!0,this.attributes.unrecognized.push(_m)}}catch(lE){throw console.error("parsing media attribute ".concat(_m.attField,' error, "a=').concat(_m.attField,":").concat(_m.attValue,'"')),lE}if(!_m.ignored&&_m.attValue&&!this.atEnd(_m))throw new Error("attribute parsing error")}parseCandidate(_m){const lE=this.extractOneOrMore(_m,mE,[1,32]);this.consumeAttributeSpace(_m);const pE=this.extractOneOrMore(_m,_a,[1,5]);this.consumeAttributeSpace(_m);const xE=this.extract(_m,this.consumeToken);this.consumeAttributeSpace(_m);const l_=this.extractOneOrMore(_m,_a,[1,10]);this.consumeAttributeSpace(_m);const G_=this.extract(_m,this.consumeAddress);this.consumeAttributeSpace(_m);const FS=this.extract(_m,this.consumePort);this.consumeAttributeSpace(_m),this.extract(_m,this.consume,"typ"),this.consumeAttributeSpace(_m);const MT={foundation:lE,componentId:pE,transport:xE,priority:l_,connectionAddress:G_,port:FS,type:this.extract(_m,this.consumeToken),extension:{}};for(this.peek(_m," raddr")&&(this.extract(_m,this.consume," raddr"),this.consumeAttributeSpace(_m),MT.relAddr=this.extract(_m,this.consumeAddress)),this.peek(_m," rport")&&(this.extract(_m,this.consume," rport"),this.consumeAttributeSpace(_m),MT.relPort=this.extract(_m,this.consumePort));this.peekChar(_m)===_o;){this.consumeAttributeSpace(_m);const WR=this.extract(_m,this.consumeToken);this.consumeAttributeSpace(_m),MT.extension[WR]=this.extractOneOrMore(_m,_c)}this.attributes.candidates.push(MT)}parseRemoteCandidate(_m){const lE=[];for(;;){const pE=this.extractOneOrMore(_m,_a,[1,5]);this.consumeAttributeSpace(_m);const xE=this.extract(_m,this.consumeAddress);this.consumeAttributeSpace(_m);const l_=this.extract(_m,this.consumePort);lE.push({componentId:pE,connectionAddress:xE,port:l_});try{this.consumeAttributeSpace(_m)}catch{break}}this.attributes.remoteCandidatesList.push(lE)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(_m){const lE=this.extract(_m,this.consumeToken);this.consumeAttributeSpace(_m);const pE=this.extract(_m,this.consumeTill,"/");this.extract(_m,this.consume,"/");const xE={encodingName:pE,clockRate:this.extractOneOrMore(_m,_a)};this.atEnd(_m)||this.peekChar(_m)!=="/"||(this.extract(_m,this.consume,"/"),xE.encodingParameters=parseInt(this.extract(_m,this.consumeTill),10));const l_=this.attributes.payloads.find(G_=>G_.payloadType===parseInt(lE,10));l_?l_.rtpMap=xE:this.attributes.payloads.push({payloadType:parseInt(lE,10),rtpMap:xE,rtcpFeedbacks:[]})}parsePtime(_m){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(_m,this.consumeTill)}parseMaxPtime(_m){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(_m,this.consumeTill)}parseDirection(_m){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=_m.attField}parseSSRC(_m){const lE=this.extractOneOrMore(_m,_a);this.consumeAttributeSpace(_m);const pE=this.extract(_m,this.consumeTill,":");let xE;this.peekChar(_m)===":"&&(this.extract(_m,this.consume,":"),xE=this.extract(_m,this.consumeTill));const l_=this.attributes.ssrcs.find(G_=>G_.ssrcId===parseInt(lE,10));l_?l_.attributes[pE]=xE:this.attributes.ssrcs.push({ssrcId:parseInt(lE,10),attributes:{[pE]:xE}})}parseFmtp(_m){const lE=this.extract(_m,this.consumeTill,_o);this.consumeAttributeSpace(_m);const pE=this.extract(_m,this.consumeTill),xE={};pE.split(";").forEach(G_=>{let[FS,MT]=G_.split("=");FS=dT(FS).call(FS);const WR=typeof MT=="string"?dT(MT).call(MT):null;typeof FS=="string"&&FS.length>0&&(xE[FS]=WR)});const l_=this.attributes.payloads.find(G_=>G_.payloadType===parseInt(lE,10));l_?l_.fmtp={parameters:xE}:this.attributes.payloads.push({payloadType:parseInt(lE,10),rtcpFeedbacks:[],fmtp:{parameters:xE}})}parseFmtParameters(_m){const lE={},pE=this.extract(_m,this.consumeTill,"=");_m._cur++;const xE=this.extract(_m,this.consumeTill,";");for(lE[pE]=xE;_m.attValue[_m._cur]===";";){const l_=this.extract(_m,this.consumeTill,"=");_m._cur++;const G_=this.extract(_m,this.consumeTill,";");lE[l_]=G_}return lE}parseRtcpFb(_m){let lE="";lE=this.peekChar(_m)==="*"?this.extract(_m,this.consume,"*"):this.extract(_m,this.consumeTill,_o),this.consumeAttributeSpace(_m);const pE=this.extract(_m,this.consumeTill,_o);let xE;if(pE==="trr-int")xE={type:pE,interval:this.extract(_m,this.consumeTill)};else{const l_={type:pE};this.peekChar(_m)===_o&&(this.consumeAttributeSpace(_m),l_.parameter=this.extract(_m,this.consumeToken),this.peekChar(_m)===_o&&(l_.additional=this.extract(_m,this.consumeTill))),xE=l_}if(lE==="*")this.attributes.rtcpFeedbackWildcards.push(xE);else{const l_=this.attributes.payloads.find(G_=>G_.payloadType===parseInt(lE,10));l_?l_.rtcpFeedbacks.push(xE):this.attributes.payloads.push({payloadType:parseInt(lE,10),rtcpFeedbacks:[xE]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(_m){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const lE={port:this.extract(_m,this.consumePort)};this.peekChar(_m)===_o&&(this.consumeAttributeSpace(_m),lE.netType=this.extractOneOrMore(_m,_p),this.consumeAttributeSpace(_m),lE.addressType=this.extractOneOrMore(_m,_p),this.consumeAttributeSpace(_m),lE.address=this.extract(_m,this.consumeAddress)),this.attributes.rtcp=lE}parseMsid(_m){const lE={id:this.extractOneOrMore(_m,_p,[1,64])};this.peekChar(_m)===_o&&(this.consumeAttributeSpace(_m),lE.appdata=this.extractOneOrMore(_m,_p,[1,64])),this.attributes.msids.push(lE)}parseImageAttr(_m){this.attributes.imageattr.push(_m.attValue)}parseRid(_m){const lE=this.extractOneOrMore(_m,xE=>eE(xE)||_a(xE)||xE==="_"||xE==="-");this.consumeAttributeSpace(_m);const pE={id:lE,direction:this.extract(_m,this.consumeToken),params:[]};if(this.peekChar(_m)===_o){if(this.consumeAttributeSpace(_m),this.peek(_m,"pt=")){this.extract(_m,this.consume,"pt=");const xE=[];for(;;){const l_=this.extract(_m,this.consumeToken);xE.push(l_);try{this.extract(_m,this.consume,",")}catch{break}}pE.payloads=xE,this.peekChar(_m)===_o&&this.extract(_m,this.consume,_o)}for(;;){const xE=this.extract(_m,this.consumeToken);switch(xE){case"depend":{const l_={type:xE,rids:this.extract(_m,this.consume,"=").split(",")};pE.params.push(l_);break}default:{const l_={type:xE};this.peekChar(_m)==="="&&(this.extract(_m,this.consume,"="),l_.val=this.extract(_m,this.consumeTill,";")),pE.params.push(l_)}}try{this.extract(_m,this.consume,";")}catch{break}}}this.attributes.rids.push(pE)}parseSimulcast(_m){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=_m.attValue,this.extract(_m,this.consumeTill)}parseSctpPort(_m){this.attributes.sctpPort=this.extractOneOrMore(_m,_a,[1,5])}parseMaxMessageSize(_m){this.attributes.maxMessageSize=this.extractOneOrMore(_m,_a,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(_m){this.attributes.mid=this.extract(_m,this.consumeToken)}parseSSRCGroup(_m){const lE=this.extract(_m,this.consumeToken),pE=[];for(;;)try{this.consumeAttributeSpace(_m);const xE=this.extract(_m,this.consumeInteger);pE.push(parseInt(xE,10))}catch{break}this.attributes.ssrcGroups.push({semantic:lE,ssrcIds:pE})}}function lS(WE,_m,lE){return _m in WE?Object.defineProperty(WE,_m,{value:lE,enumerable:!0,configurable:!0,writable:!0}):WE[_m]=lE,WE}class U0{constructor(){lS(this,"eol",_r)}print(_m,lE){let pE="";return lE&&(this.eol=lE),pE+=this.printVersion(_m.version),pE+=this.printOrigin(_m.origin),pE+=this.printSessionName(_m.sessionName),pE+=this.printInformation(_m.information),pE+=this.printUri(_m.uri),pE+=this.printEmail(_m.emails),pE+=this.printPhone(_m.phones),pE+=this.printConnection(_m.connection),pE+=this.printBandwidth(_m.bandwidths),pE+=this.printTimeFields(_m.timeFields),pE+=this.printKey(_m.key),pE+=this.printSessionAttributes(_m.attributes),pE+=this.printMediaDescription(_m.mediaDescriptions),pE}printVersion(_m){return"v=".concat(_m).concat(this.eol)}printOrigin(_m){return"o=".concat(_m.username," ").concat(_m.sessId," ").concat(_m.sessVersion," ").concat(_m.nettype," ").concat(_m.addrtype," ").concat(_m.unicastAddress).concat(this.eol)}printSessionName(_m){return _m?"s=".concat(_m).concat(this.eol):""}printInformation(_m){return _m?"i=".concat(_m).concat(this.eol):""}printUri(_m){return _m?"u=".concat(_m).concat(this.eol):""}printEmail(_m){let lE="";for(const pE of _m)lE+="e=".concat(pE).concat(this.eol);return lE}printPhone(_m){let lE="";for(const pE of _m)lE+="e=".concat(pE).concat(this.eol);return lE}printConnection(_m){return _m?"c=".concat(_m.nettype," ").concat(_m.addrtype," ").concat(_m.address).concat(this.eol):""}printBandwidth(_m){let lE="";for(const pE of _m)lE+="b=".concat(pE.bwtype,":").concat(pE.bandwidth).concat(this.eol);return lE}printTimeFields(_m){let lE="";for(const pE of _m){lE+="t=".concat(pE.time.startTime," ").concat(pE.time.startTime).concat(this.eol);for(const xE of pE.repeats)lE+="r=".concat(xE.repeatInterval," ").concat(xE.typedTimes.join(" ")).concat(this.eol);pE.zoneAdjustments&&(lE+="z=",lE+="z=".concat(pE.zoneAdjustments.map(xE=>"".concat(xE.time," ").concat(xE.back?"-":""," ").concat(xE.typedTime)).join(" ")).concat(this.eol),lE+=this.eol)}return lE}printKey(_m){return _m?"k=".concat(_m).concat(this.eol):""}printAttributes(_m){let lE="";for(const pE of _m)lE+="a=".concat(pE.attField).concat(pE.attValue?":".concat(pE.attValue):"").concat(this.eol);return lE}printMediaDescription(_m){let lE="";for(const pE of _m)lE+=this.printMedia(pE.media),lE+=this.printInformation(pE.information),lE+=this.printConnections(pE.connections),lE+=this.printBandwidth(pE.bandwidths),lE+=this.printKey(pE.key),lE+=this.printMediaAttributes(pE);return lE}printConnections(_m){let lE="";for(const pE of _m)lE+=this.printConnection(pE);return lE}printMedia(_m){return"m=".concat(_m.mediaType," ").concat(_m.port," ").concat(_m.protos.join("/")," ").concat(_m.fmts.join(" ")).concat(this.eol)}printSessionAttributes(_m){return new VE(this.eol).print(_m)}printMediaAttributes(_m){return new $E(this.eol).print(_m)}}class kE{constructor(_m){lS(this,"eol",void 0),this.eol=_m}printIceUfrag(_m){return _m===void 0?"":"a=ice-ufrag:".concat(_m).concat(this.eol)}printIcePwd(_m){return _m===void 0?"":"a=ice-pwd:".concat(_m).concat(this.eol)}printIceOptions(_m){return _m===void 0?"":"a=ice-options:".concat(_m.join(_o)).concat(this.eol)}printFingerprints(_m){return _m.length>0?_m.map(lE=>"a=fingerprint:".concat(lE.hashFunction).concat(_o).concat(lE.fingerprint)).join(this.eol)+this.eol:""}printExtmap(_m){return _m.map(lE=>"a=extmap:".concat(lE.entry).concat(lE.direction?"/".concat(lE.direction):"").concat(_o).concat(lE.extensionName).concat(lE.extensionAttributes?"".concat(_o).concat(lE.extensionAttributes):"").concat(this.eol)).join("")}printSetup(_m){return _m===void 0?"":"a=setup:".concat(_m).concat(this.eol)}printUnrecognized(_m){return _m.map(lE=>"a=".concat(lE.attField).concat(lE.attValue?":".concat(lE.attValue):"").concat(this.eol)).join("")}}class VE extends kE{print(_m){let lE="";return lE+=this.printGroups(_m.groups),lE+=this.printMsidSemantic(_m.msidSemantic),lE+=this.printIceLite(_m.iceLite),lE+=this.printIceUfrag(_m.iceUfrag),lE+=this.printIcePwd(_m.icePwd),lE+=this.printIceOptions(_m.iceOptions),lE+=this.printFingerprints(_m.fingerprints),lE+=this.printSetup(_m.setup),lE+=this.printTlsId(_m.tlsId),lE+=this.printIdentity(_m.identities),lE+=this.printExtmap(_m.extmaps),lE+=this.printUnrecognized(_m.unrecognized),lE}printGroups(_m){let lE="";return _m.length>0&&(lE+=_m.map(pE=>"a=group:".concat(pE.semantic).concat(pE.identificationTag.map(xE=>"".concat(_o).concat(xE)).join("")).concat(this.eol)).join("")),lE}printIceLite(_m){return _m===void 0?"":"a=ice-lite"+this.eol}printTlsId(_m){return _m?"a=tls-id:".concat(_m).concat(this.eol):""}printIdentity(_m){return _m.length===0?"":_m.map(lE=>"a=identity:".concat(lE.assertionValue).concat(lE.extensions.map(pE=>"".concat(_o).concat(pE.name).concat(pE.value?"=".concat(pE.value):"")))).join(this.eol)+this.eol}printMsidSemantic(_m){if(!_m)return"";let lE="a=msid-semantic:".concat(_m.semantic);return _m.applyForAll?lE+="".concat(_o,"*"):_m.identifierList.length>0&&(lE+=_m.identifierList.map(pE=>"".concat(_o).concat(pE))),lE+this.eol}}class $E extends kE{print(_m){const lE=_m.attributes;let pE="";return pE+=this.printRTCP(lE.rtcp),pE+=this.printIceUfrag(lE.iceUfrag),pE+=this.printIcePwd(lE.icePwd),pE+=this.printIceOptions(lE.iceOptions),pE+=this.printCandidates(lE.candidates),pE+=this.printRemoteCandidatesList(lE.remoteCandidatesList),pE+=this.printEndOfCandidates(lE.endOfCandidates),pE+=this.printFingerprints(lE.fingerprints),pE+=this.printSetup(lE.setup),pE+=this.printMid(lE.mid),pE+=this.printExtmap(lE.extmaps),pE+=this.printRTPRelated(lE),pE+=this.printPtime(lE.ptime),pE+=this.printMaxPtime(lE.maxPtime),pE+=this.printDirection(lE.direction),pE+=this.printSSRCGroups(lE.ssrcGroups),pE+=this.printSSRC(lE.ssrcs),pE+=this.printRTCPMux(lE.rtcpMux),pE+=this.printRTCPMuxOnly(lE.rtcpMuxOnly),pE+=this.printRTCPRsize(lE.rtcpRsize),pE+=this.printMSId(lE.msids),pE+=this.printImageattr(lE.imageattr),pE+=this.printRid(lE.rids),pE+=this.printSimulcast(lE.simulcast),pE+=this.printSCTPPort(lE.sctpPort),pE+=this.printMaxMessageSize(lE.maxMessageSize),pE+=this.printUnrecognized(lE.unrecognized),pE}printCandidates(_m){return _m.map(lE=>"a=candidate:".concat(lE.foundation).concat(_o).concat(lE.componentId).concat(_o).concat(lE.transport).concat(_o).concat(lE.priority).concat(_o).concat(lE.connectionAddress).concat(_o).concat(lE.port).concat(_o,"typ").concat(_o).concat(lE.type).concat(lE.relAddr?"".concat(_o,"raddr").concat(_o).concat(lE.relAddr):"").concat(lE.relPort?"".concat(_o,"rport").concat(_o).concat(lE.relPort):"").concat(Object.keys(lE.extension).map(pE=>"".concat(_o).concat(pE).concat(_o).concat(lE.extension[pE])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(_m){return _m.map(lE=>"a=remote-candidates:".concat(lE.join(_o)).concat(this.eol)).join("")}printEndOfCandidates(_m){return _m===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(_m){if(!_m.payloads)return"";const lE=_m.payloads;let pE="";pE+=_m.rtcpFeedbackWildcards.map(xE=>this.printRTCPFeedback("*",xE)).join("");for(const xE of lE)pE+=this.printRtpMap(xE.payloadType,xE.rtpMap),pE+=this.printFmtp(xE.payloadType,xE.fmtp),pE+=xE.rtcpFeedbacks.map(l_=>this.printRTCPFeedback(xE.payloadType,l_)).join("");return pE}printFmtp(_m,lE){if(!lE)return"";const pE=Object.keys(lE.parameters);return pE.length===1&&lE.parameters[pE[0]]===null?"a=fmtp:".concat(_m).concat(_o).concat(pE[0]).concat(this.eol):"a=fmtp:".concat(_m).concat(_o).concat(Object.keys(lE.parameters).map(xE=>"".concat(xE,"=").concat(lE.parameters[xE])).join(";")).concat(this.eol)}printRtpMap(_m,lE){return lE?"a=rtpmap:".concat(_m).concat(_o).concat(lE.encodingName,"/").concat(lE.clockRate).concat(lE.encodingParameters?"/".concat(lE.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(_m,lE){let pE="a=rtcp-fb:".concat(_m).concat(_o),xE=lE;return xE.type==="trr-int"?pE+="ttr-int".concat(_o).concat(xE.interval):(pE+="".concat(xE.type),xE.parameter&&(pE+="".concat(_o).concat(xE.parameter),xE.additional&&(pE+="".concat(_o).concat(xE.additional)))),pE+this.eol}printPtime(_m){return _m===void 0?"":"a=ptime:".concat(_m).concat(this.eol)}printMaxPtime(_m){return _m===void 0?"":"a=maxptime:".concat(_m).concat(this.eol)}printDirection(_m){return _m===void 0?"":"a=".concat(_m).concat(this.eol)}printSSRC(_m){return _m.map(lE=>Object.keys(lE.attributes).map(pE=>"a=ssrc:".concat(lE.ssrcId.toString(10)).concat(_o).concat(pE).concat(lE.attributes[pE]?":".concat(lE.attributes[pE]):"").concat(this.eol)).join("")).join("")}printRTCPMux(_m){return _m===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(_m){return _m===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(_m){return _m===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(_m){if(_m===void 0)return"";let lE="a=rtcp:".concat(_m.port);return _m.netType&&(lE+="".concat(_o).concat(_m.netType)),_m.addressType&&(lE+="".concat(_o).concat(_m.addressType)),_m.address&&(lE+="".concat(_o).concat(_m.address)),lE+this.eol}printMSId(_m){return _m.map(lE=>"a=msid:".concat(lE.id).concat(lE.appdata?"".concat(_o).concat(lE.appdata):"").concat(this.eol)).join("")}printImageattr(_m){return _m.map(lE=>"a=imageattr:".concat(lE).concat(this.eol)).join("")}printRid(_m){return _m.map(lE=>{let pE="a=rid:".concat(lE.id).concat(_o).concat(lE.direction);return lE.payloads&&(pE+="".concat(_o,"pt=").concat(lE.payloads.join(","))),lE.params.length>0&&(pE+="".concat(_o).concat(lE.params.map(xE=>xE.type==="depend"?"depend=".concat(xE.rids.join(",")):"".concat(xE.type,"=").concat(xE.val)).join(";"))),pE+this.eol}).join("")}printSimulcast(_m){return _m===void 0?"":"a=simulcast:".concat(_m).concat(this.eol)}printSCTPPort(_m){return _m===void 0?"":"a=sctp-port:".concat(_m).concat(this.eol)}printMaxMessageSize(_m){return _m===void 0?"":"a=max-message-size:".concat(_m).concat(this.eol)}printMid(_m){return _m===void 0?"":"a=mid:".concat(_m).concat(this.eol)}printSSRCGroups(_m){return _m.map(lE=>"a=ssrc-group:".concat(lE.semantic).concat(lE.ssrcIds.map(pE=>"".concat(_o).concat(pE.toString(10))).join("")).concat(this.eol)).join("")}}function u_(WE){return new b_().parse(WE)}function P_(WE,_m){return new U0().print(WE,_m)}}},g={};function b($){if(g[$])return g[$].exports;var Vt=g[$]={exports:{}};return d[$](Vt,Vt.exports,b),Vt.exports}return b.d=($,Vt)=>{for(var zt in Vt)b.o(Vt,zt)&&!b.o($,zt)&&Object.defineProperty($,zt,{enumerable:!0,get:Vt[zt]})},b.o=($,Vt)=>Object.prototype.hasOwnProperty.call($,Vt),b.r=$=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty($,Symbol.toStringTag,{value:"Module"}),Object.defineProperty($,"__esModule",{value:!0})},b(8)})()})(O9);var iS=O9.exports;function P0(o){if(Array.isArray(o))return o.map(d=>d);if(!A9(o))return o;const s={};for(const d in o){const g=o[d];A9(g)||Array.isArray(g)?s[d]=P0(g):s[d]=g}return s}function A9(o){return!(typeof o!="object"||Array.isArray(o)||!o)}class aG{constructor(s){Qm(this,"input",[]),Qm(this,"size",void 0),this.size=s}add(s){this.input.push(s),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const TR={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},FP={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:TR,remoteCandidate:TR}},N9={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},k9={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},P9={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},D9={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function L9(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function M9(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?L9(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):L9(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}class cG{constructor(s,d){Qm(this,"onFirstVideoReceived",void 0),Qm(this,"onFirstVideoDecoded",void 0),Qm(this,"onFirstAudioReceived",void 0),Qm(this,"onFirstVideoDecodedTimeout",void 0),Qm(this,"onFirstAudioDecoded",void 0),Qm(this,"onSelectedLocalCandidateChanged",void 0),Qm(this,"onSelectedRemoteCandidateChanged",void 0),Qm(this,"videoIsReady",!1),Qm(this,"videoIsReady2",{}),Qm(this,"pc",void 0),Qm(this,"options",void 0),Qm(this,"intervalTimer",void 0),Qm(this,"stats",P0(FP)),Qm(this,"isFirstVideoReceived",{}),Qm(this,"isFirstVideoDecoded",{}),Qm(this,"isFirstAudioReceived",{}),Qm(this,"isFirstAudioDecoded",{}),Qm(this,"isFirstVideoDecodedTimeout",{}),Qm(this,"lossRateWindowStats",[]),this.pc=s,this.options=d,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new GE(s=>{s({local:M9({},TR),remote:M9({},TR)})})}setVideoIsReady(s){this.videoIsReady=s}setVideoIsReady2(s,d){this.videoIsReady2[s]=d}getVideoIsReady(s){return this.videoIsReady2[s]||!1}setIsFirstAudioDecoded(s){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(s){this.lossRateWindowStats.push(s),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const d=this.lossRateWindowStats.length,g=["videoSend","audioSend","videoRecv","audioRecv"];let b=0,$=0,Vt=0,zt=0;for(const _e of g)s[_e].forEach((_r,_o)=>{if(!this.lossRateWindowStats[d-1][_e][_o]||!this.lossRateWindowStats[0][_e][_o])return;const ga=this.lossRateWindowStats[d-1][_e][_o].packets-this.lossRateWindowStats[0][_e][_o].packets,_a=this.lossRateWindowStats[d-1][_e][_o].packetsLost-this.lossRateWindowStats[0][_e][_o].packetsLost;_e==="videoSend"||_e==="audioSend"?(b+=ga,Vt+=_a):($+=ga,zt+=_a),Number.isNaN(ga)||Number.isNaN(ga)?_r.packetLostRate=0:_r.packetLostRate=ga<=0||_a<=0?0:_a/(ga+_a)});s.sendPacketLossRate=b<=0||Vt<=0?0:Vt/(b+Vt),s.recvPacketLossRate=$<=0||zt<=0?0:zt/($+zt)}}function x9(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function sht(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?x9(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):x9(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}class aht extends cG{constructor(){super(...arguments),Qm(this,"_stats",FP),Qm(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const s=await this._getStats(),d=this.statsResponsesToObjects(s);this._stats=P0(FP);const g=d.filter($=>$.type==="ssrc");this.processSSRCStats(g);const b=d.find($=>$.type==="VideoBwe");b&&this.processBandwidthStats(b),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(s){this._stats.bitrate={actualEncoded:Number(s.googActualEncBitrate),targetEncoded:Number(s.googTargetEncBitrate),retransmit:Number(s.googRetransmitBitrate),transmit:Number(s.googTransmitBitrate)},this._stats.sendBandwidth=Number(s.googAvailableSendBandwidth)}processSSRCStats(s){s.forEach(d=>{var g;const b=KE(g=d.id).call(g,"send");switch("".concat(d.mediaType,"_").concat(b?"send":"recv")){case"video_send":{const $=P0(k9);$.codec=d.googCodecName,$.adaptionChangeReason="none",d.googCpuLimitedResolution&&($.adaptionChangeReason="cpu"),d.googBandwidthLimitedResolution&&($.adaptionChangeReason="bandwidth"),$.avgEncodeMs=Number(d.googAvgEncodeMs),$.inputFrame={width:Number(d.googFrameWidthInput)||Number(d.googFrameWidthSent),height:Number(d.googFrameHeightInput)||Number(d.googFrameHeightSent),frameRate:Number(d.googFrameRateInput)},$.sentFrame={width:Number(d.googFrameWidthSent),height:Number(d.googFrameHeightSent),frameRate:Number(d.googFrameRateInput)},$.firsCount=Number(d.googFirReceived),$.nacksCount=Number(d.googNacksReceived),$.plisCount=Number(d.googPlisReceived),$.frameCount=Number(d.framesEncoded),$.bytes=Number(d.bytesSent),$.packets=Number(d.packetsSent),$.packetsLost=Number(d.packetsLost),$.ssrc=Number(d.ssrc),$.rttMs=Number(d.googRtt||0),this._stats.videoSend.push($),this._stats.rtt=$.rttMs;break}case"video_recv":{const $=P0(N9),Vt=this.lastDecodeVideoReceiverStats.get(Number(d.ssrc));if($.codec=d.googCodecName,$.targetDelayMs=Number(d.googTargetDelayMs),$.renderDelayMs=Number(d.googRenderDelayMs),$.currentDelayMs=Number(d.googCurrentDelayMs),$.minPlayoutDelayMs=Number(d.googMinPlayoutDelayMs),$.decodeMs=Number(d.googDecodeMs),$.maxDecodeMs=Number(d.googMaxDecodeMs),$.receivedFrame={width:Number(d.googFrameWidthReceived),height:Number(d.googFrameHeightReceived),frameRate:Number(d.googFrameRateReceived)},$.decodedFrame={width:Number(d.googFrameWidthReceived),height:Number(d.googFrameHeightReceived),frameRate:Number(d.googFrameRateDecoded)},$.decodeFrameRate=Number(d.googFrameRateDecoded),$.outputFrame={width:Number(d.googFrameWidthReceived),height:Number(d.googFrameHeightReceived),frameRate:Number(d.googFrameRateOutput)},$.jitterBufferMs=Number(d.googJitterBufferMs),$.firsCount=Number(d.googFirsSent),$.nacksCount=Number(d.googNacksSent),$.plisCount=Number(d.googPlisSent),$.framesDecodeCount=Number(d.framesDecoded),$.bytes=Number(d.bytesReceived),$.packets=Number(d.packetsReceived),$.packetsLost=Number(d.packetsLost),$.ssrc=Number(d.ssrc),$.packets>0&&!this.isFirstVideoReceived[$.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived($.ssrc),this.isFirstVideoReceived[$.ssrc]=!0),$.framesDecodeCount>0&&!this.isFirstVideoDecoded[$.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded($.ssrc,$.decodedFrame.width,$.decodedFrame.height),this.isFirstVideoDecoded[$.ssrc]=!0),Vt){const zt=Vt.stats,_e=Date.now()-Vt.lts;$.framesDecodeFreezeTime=zt.framesDecodeFreezeTime,$.framesDecodeInterval=zt.framesDecodeInterval,$.framesDecodeCount>zt.framesDecodeCount&&this.isFirstVideoDecoded[$.ssrc]?(Vt.lts=Date.now(),$.framesDecodeInterval=_e,$.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(d.ssrc,10))?$.framesDecodeFreezeTime+=$.framesDecodeInterval:this.setVideoIsReady2(parseInt(d.ssrc,10),!0))):$.framesDecodeCount<Vt.stats.framesDecodeCount&&($.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set($.ssrc,{stats:sht({},$),lts:Date.now()}),this._stats.videoRecv.push($);break}case"audio_recv":{const $=P0(D9);$.codec=d.googCodecName,$.outputLevel=Math.abs(Number(d.audioOutputLevel))/32767,$.decodingCNG=Number(d.googDecodingCNG),$.decodingCTN=Number(d.googDecodingCTN),$.decodingCTSG=Number(d.googDecodingCTSG),$.decodingNormal=Number(d.googDecodingNormal),$.decodingPLC=Number(d.googDecodingPLC),$.decodingPLCCNG=Number(d.googDecodingPLCCNG),$.expandRate=Number(d.googExpandRate),$.accelerateRate=Number(d.googAccelerateRate),$.preemptiveExpandRate=Number(d.googPreemptiveExpandRate),$.secondaryDecodedRate=Number(d.googSecondaryDecodedRate),$.speechExpandRate=Number(d.googSpeechExpandRate),$.preferredJitterBufferMs=Number(d.googPreferredJitterBufferMs),$.jitterBufferMs=Number(d.googJitterBufferMs),$.jitterMs=Number(d.googJitterReceived),$.bytes=Number(d.bytesReceived),$.packets=Number(d.packetsReceived),$.packetsLost=Number(d.packetsLost),$.ssrc=Number(d.ssrc),$.receivedFrames=Number(d.googDecodingCTN)||Number(d.packetsReceived),$.droppedFrames=Number(d.googDecodingPLC)+Number(d.googDecodingPLCCNG)||Number(d.packetsLost),$.receivedFrames>0&&!this.isFirstAudioReceived[$.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived($.ssrc),this.isFirstAudioReceived[$.ssrc]=!0),$.decodingNormal>0&&!this.isFirstAudioDecoded[$.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded($.ssrc),this.isFirstAudioDecoded[$.ssrc]=!0),this._stats.audioRecv.push($);break}case"audio_send":{const $=P0(P9);$.codec=d.googCodecName,$.inputLevel=Math.abs(Number(d.audioInputLevel))/32767,$.aecReturnLoss=Number(d.googEchoCancellationReturnLoss||0),$.aecReturnLossEnhancement=Number(d.googEchoCancellationReturnLossEnhancement||0),$.residualEchoLikelihood=Number(d.googResidualEchoLikelihood||0),$.residualEchoLikelihoodRecentMax=Number(d.googResidualEchoLikelihoodRecentMax||0),$.bytes=Number(d.bytesSent),$.packets=Number(d.packetsSent),$.packetsLost=Number(d.packetsLost),$.ssrc=Number(d.ssrc),$.rttMs=Number(d.googRtt||0),this._stats.rtt=$.rttMs,this._stats.audioSend.push($);break}}})}_getStats(){return new GE((s,d)=>{this.pc.getStats(s,d)})}statsResponsesToObjects(s){const d=[];return s.result().forEach(g=>{const b={id:g.id,timestamp:g.timestamp.valueOf().toString(),type:g.type};g.names().forEach($=>{b[$]=g.stat($)}),d.push(b)}),d}}function U9(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function oO(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?U9(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):U9(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}class j9 extends cG{constructor(){super(...arguments),Qm(this,"_stats",FP),Qm(this,"report",void 0),Qm(this,"lastDecodeVideoReceiverStats",new Map),Qm(this,"lastVideoFramesRecv",new Map),Qm(this,"lastVideoFramesSent",new Map),Qm(this,"lastVideoFramesDecode",new Map),Qm(this,"lastVideoFramesOutput",new Map),Qm(this,"lastVideoJBDelay",new Map),Qm(this,"lastAudioJBDelay",new Map),Qm(this,"mediaBytesSent",new Map),Qm(this,"mediaBytesRetransmit",new Map),Qm(this,"mediaBytesTargetEncode",new Map),Qm(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=P0(FP),this.report.forEach(s=>{switch(s.type){case KT.OUTBOUND:case KT.INBOUND:{const d=s.mediaType||s.kind,g=!d&&"frameWidth"in s,b=!d&&!("frameWidth"in s);s.type===KT.OUTBOUND?d==="audio"||b?this.processAudioOutboundStats(s):(d==="video"||g)&&this.processVideoOutboundStats(s):s.type===KT.INBOUND&&(d==="audio"||b?this.processAudioInboundStats(s):(d==="video"||g)&&this.processVideoInboundStats(s));break}case KT.TRANSPORT:{const d=this.report.get(s.selectedCandidatePairId);d&&this.processCandidatePairStats(d);break}case KT.CANDIDATE_PAIR:s.selected&&this.processCandidatePairStats(s)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const s=await this.pc.getStats(),d={local:oO({},TR),remote:oO({},TR)};return s.forEach(g=>{let b;if(g.type===KT.TRANSPORT&&(b=s.get(g.selectedCandidatePairId)),g.type===KT.CANDIDATE_PAIR&&g.selected&&(b=g),b){const $=(Vt,zt)=>{Vt.type=zt.type,Vt.id=zt.id,zt.address&&(Vt.address=zt.address),zt.candidateType&&(Vt.candidateType=zt.candidateType),zt.port&&(Vt.port=zt.port),zt.priority&&(Vt.priority=zt.priority),zt.protocol&&(Vt.protocol=zt.protocol),zt.relayProtocol&&(Vt.relayProtocol=zt.relayProtocol)};if(b.localCandidateId){const Vt=s.get(b.localCandidateId);Vt&&$(d.local,Vt)}if(b.remoteCandidateId){const Vt=s.get(b.remoteCandidateId);Vt&&$(d.remote,Vt)}}}),d}processCandidatePairStats(s){if(this._stats.sendBandwidth=s.availableOutgoingBitrate||0,s.currentRoundTripTime&&(this._stats.rtt=1e3*s.currentRoundTripTime),this._stats.videoSend.forEach(d=>{s.currentRoundTripTime&&(d.rttMs=1e3*s.currentRoundTripTime)}),this._stats.audioSend.forEach(d=>{s.currentRoundTripTime&&(d.rttMs=1e3*s.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=s.id,s.localCandidateId){const d=this.report.get(s.localCandidateId);d&&this.processCandidateStats(d)}if(s.remoteCandidateId){const d=this.report.get(s.remoteCandidateId);d&&this.processCandidateStats(d)}}processCandidateStats(s){let d;s.type===KT.LOCAL_CANDIDATE&&(d=this._stats.selectedCandidatePair.localCandidate),s.type===KT.REMOTE_CANDIDATE&&(d=this._stats.selectedCandidatePair.remoteCandidate),d&&(d.type=s.type,d.id=s.id,s.address&&(d.address=s.address),s.candidateType&&(d.candidateType=s.candidateType),s.port&&(d.port=s.port),s.priority&&(d.priority=s.priority),s.protocol&&(d.protocol=s.protocol),s.relayProtocol&&(d.relayProtocol=s.relayProtocol),s.type===KT.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==d.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(oO({},d),oO({},this.stats.selectedCandidatePair.localCandidate)),s.type===KT.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==d.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(oO({},d),oO({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(s){let d=this._stats.audioRecv.find(g=>g.ssrc===s.ssrc);d||(d=P0(D9),this._stats.audioRecv.push(d)),d.ssrc=s.ssrc,d.packets=s.packetsReceived,d.packetsLost=s.packetsLost,d.bytes=s.bytesReceived,d.jitterMs=1e3*s.jitter,this.processAudioTrackReceiverStats(s,s.trackId,d),s.codecId&&(d.codec=this.getCodecFromCodecStats(s.codecId)),d.receivedFrames||(d.receivedFrames=s.packetsReceived),d.droppedFrames||(d.droppedFrames=s.packetsLost),d.receivedFrames>0&&!this.isFirstAudioReceived[d.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(d.ssrc),this.isFirstAudioReceived[d.ssrc]=!0),d.outputLevel&&d.outputLevel>0&&!this.isFirstAudioDecoded[d.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(d.ssrc),this.isFirstAudioDecoded[d.ssrc]=!0),typeof s.concealedSamples=="number"&&(d.concealedSamples=s.concealedSamples)}processVideoInboundStats(s){let d=this._stats.videoRecv.find(zt=>zt.ssrc===s.ssrc);d||(d=P0(N9),this._stats.videoRecv.push(d)),d.ssrc=s.ssrc,d.packets=s.packetsReceived,d.packetsLost=s.packetsLost,d.bytes=s.bytesReceived,d.firsCount=s.firCount,d.nacksCount=s.nackCount,d.plisCount=s.pliCount,d.framesDecodeCount=s.framesDecoded,d.framesDroppedCount=s.framesDropped,d.totalInterFrameDelay=s.totalInterFrameDelay,d.totalSquaredInterFrameDelay=s.totalSquaredInterFrameDelay,d.totalFreezesDuration=s.totalFreezesDuration;const g=this.lastDecodeVideoReceiverStats.get(d.ssrc),b=this.lastVideoFramesDecode.get(d.ssrc),$=this.lastVideoFramesOutput.get(d.ssrc),Vt=Date.now();if(d.framesDecodeCount>0&&!this.isFirstVideoDecoded[d.ssrc]){const zt=d.decodedFrame?d.decodedFrame.width:0,_e=d.decodedFrame?d.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(d.ssrc,zt,_e),this.isFirstVideoDecoded[d.ssrc]=!0}if(g){const zt=g.stats,_e=Vt-g.lts;d.framesDecodeFreezeTime=zt.framesDecodeFreezeTime,d.framesDecodeInterval=zt.framesDecodeInterval,!this.isFirstVideoDecoded[d.ssrc]&&_e>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[d.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(d.ssrc),this.isFirstVideoDecodedTimeout[d.ssrc]=!0),d.framesDecodeCount>zt.framesDecodeCount&&this.isFirstVideoDecoded[d.ssrc]?(g.lts=Date.now(),d.framesDecodeInterval=_e,d.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(s.ssrc))?d.framesDecodeFreezeTime+=d.framesDecodeInterval:this.setVideoIsReady2(parseInt(s.ssrc,10),!0))):d.framesDecodeCount<zt.framesDecodeCount&&(d.framesDecodeInterval=0),s.framesDecoded&&s.qpSum&&(g.stats.framesDecodeCount>s.framesDecoded?d.qpSumPerFrame=s.qpSum/s.framesDecoded:d.qpSumPerFrame=(s.qpSum-g.qpSum)/(s.framesDecoded-g.stats.framesDecodeCount))}b&&Vt-b.lts>=800?(d.decodeFrameRate=Math.round((d.framesDecodeCount-b.count)/((Vt-b.lts)/1e3)),this.lastVideoFramesDecode.set(d.ssrc,{count:d.framesDecodeCount,lts:Vt,rate:d.decodeFrameRate})):b?d.decodeFrameRate=b.rate:this.lastVideoFramesDecode.set(d.ssrc,{count:d.framesDecodeCount,lts:Vt,rate:0}),d.framesDroppedCount&&s.framesReceived&&($&&Vt-$.lts>=800?(d.outputFrameRate=Math.round((s.framesReceived-d.framesDroppedCount-$.count)/((Vt-$.lts)/1e3)),this.lastVideoFramesOutput.set(d.ssrc,{count:s.framesReceived-d.framesDroppedCount,lts:Vt,rate:Math.max(d.outputFrameRate,0)})):$?d.outputFrameRate=$.rate:this.lastVideoFramesOutput.set(d.ssrc,{count:s.framesReceived-d.framesDroppedCount,lts:Vt,rate:0})),s.totalDecodeTime&&(d.decodeMs=1e3*s.totalDecodeTime),this.processVideoTrackReceiverStats(s,s.trackId,d),s.codecId&&(d.codec=this.getCodecFromCodecStats(s.codecId)),s.framerateMean&&(d.framesRateFirefox=s.framerateMean),d.packets>0&&!this.isFirstVideoReceived[d.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(d.ssrc),this.isFirstVideoReceived[d.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(d.ssrc,{stats:oO({},d),lts:g?g.lts:Date.now(),qpSum:s.qpSum})}processVideoOutboundStats(s){let d=this._stats.videoSend.find(b=>b.ssrc===s.ssrc);d||(d=P0(k9),this._stats.videoSend.push(d));const g=this.mediaBytesSent.get(s.ssrc);if(g)g.add(s.bytesSent);else{const b=new aG(10);b.add(s.bytesSent),this.mediaBytesSent.set(s.ssrc,b)}if(s.retransmittedBytesSent!==void 0){const b=this.mediaBytesRetransmit.get(s.ssrc);if(b)b.add(s.retransmittedBytesSent);else{const $=new aG(10);$.add(s.retransmittedBytesSent),this.mediaBytesRetransmit.set(s.ssrc,$)}}if(s.totalEncodedBytesTarget){const b=this.mediaBytesTargetEncode.get(s.ssrc);if(b)b.add(s.totalEncodedBytesTarget);else{const $=new aG(10);$.add(s.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(s.ssrc,$)}}if(d.ssrc=s.ssrc,d.bytes=s.bytesSent,d.packets=s.packetsSent,d.firsCount=s.firCount,d.nacksCount=s.nackCount,d.plisCount=s.pliCount,d.frameCount=s.framesEncoded,d.adaptionChangeReason=s.qualityLimitationReason,d.scalabilityMode=s.scalabilityMode,s.totalEncodeTime&&s.framesEncoded){const b=this.lastEncoderMs.get(s.ssrc);if(!b||b.lastFrameCount>s.framesEncoded)d.avgEncodeMs=1e3*s.totalEncodeTime/s.framesEncoded;else{const $=s.framesEncoded-b.lastFrameCount,Vt=s.totalEncodeTime-b.lastEncoderTime;d.avgEncodeMs=1e3*Vt/$}}if(s.framesEncoded&&s.qpSum){const b=this.lastEncoderMs.get(s.ssrc);!b||b.lastFrameCount>s.framesEncoded?d.qpSumPerFrame=s.qpSum/s.framesEncoded:d.qpSumPerFrame=(s.qpSum-b.lastQpSum)/(s.framesEncoded-b.lastFrameCount)}if(this.lastEncoderMs.set(s.ssrc,{lastFrameCount:s.framesEncoded,lastEncoderTime:s.totalEncodeTime,lastQpSum:s.qpSum,lts:Date.now()}),s.codecId&&(d.codec=this.getCodecFromCodecStats(s.codecId)),s.mediaSourceId&&this.processVideoMediaSource(s.mediaSourceId,d),this.processVideoTrackSenderStats(s,s.trackId,d),s.remoteId)this.processRemoteInboundStats(s.remoteId,d);else{const b=this.findRemoteStatsId(s.ssrc,KT.REMOTE_INBOUND);b&&this.processRemoteInboundStats(b,d)}}processAudioOutboundStats(s){let d=this._stats.audioSend.find(g=>g.ssrc===s.ssrc);if(d||(d=P0(P9),this._stats.audioSend.push(d)),d.ssrc=s.ssrc,d.packets=s.packetsSent,d.bytes=s.bytesSent,s.mediaSourceId&&this.processAudioMediaSource(s.mediaSourceId,d),s.codecId&&(d.codec=this.getCodecFromCodecStats(s.codecId)),this.processAudioTrackSenderStats(s,s.trackId,d),s.remoteId)this.processRemoteInboundStats(s.remoteId,d);else{const g=this.findRemoteStatsId(s.ssrc,KT.REMOTE_INBOUND);g&&this.processRemoteInboundStats(g,d)}}findRemoteStatsId(s,d){var g;const b=Array.from(q0(g=this.report).call(g)).find($=>$.type===d&&$.ssrc===s);return b?b.id:null}processVideoMediaSource(s,d){const g=this.report.get(s);g&&g.width&&g.height&&g.framesPerSecond&&(d.inputFrame={width:g.width,height:g.height,frameRate:g.framesPerSecond})}processAudioMediaSource(s,d){const g=this.report.get(s);g&&(d.inputLevel=g.audioLevel)}processVideoTrackSenderStats(s,d,g){var b,$,Vt,zt;const _e=d?this.report.get(d):void 0,_r=(b=_e==null?void 0:_e.framesSent)!==null&&b!==void 0?b:s.framesSent;if(typeof _r!="number")return;let _o=($=_e==null?void 0:_e.frameWidth)!==null&&$!==void 0?$:s.frameWidth,ga=(Vt=_e==null?void 0:_e.frameHeight)!==null&&Vt!==void 0?Vt:s.frameHeight,_a=(zt=_e==null?void 0:_e.framesPerSecond)!==null&&zt!==void 0?zt:s.framesPerSecond;if(typeof _o=="number"&&typeof ga=="number"||(_o=0,ga=0),_a==null){const _c=Date.now(),tE=this.lastVideoFramesSent.get(g.ssrc);tE&&_c-tE.lts>=800?(_a=Math.round((_r-tE.count)/((_c-tE.lts)/1e3)),this.lastVideoFramesSent.set(g.ssrc,{count:_r,lts:_c,rate:_a})):tE?_a=tE.rate:this.lastVideoFramesSent.set(g.ssrc,{count:_r,lts:_c,rate:0})}g.sentFrame={width:_o,height:ga,frameRate:Math.max(0,_a)}}processVideoTrackReceiverStats(s,d,g){var b,$,Vt,zt,_e;const _r=d?this.report.get(d):void 0,_o=(b=_r==null?void 0:_r.framesReceived)!==null&&b!==void 0?b:s.framesReceived,ga=($=_r==null?void 0:_r.frameWidth)!==null&&$!==void 0?$:s.frameWidth,_a=(Vt=_r==null?void 0:_r.frameHeight)!==null&&Vt!==void 0?Vt:s.frameHeight,_c=(zt=_r==null?void 0:_r.jitterBufferDelay)!==null&&zt!==void 0?zt:s.jitterBufferDelay,tE=(_e=_r==null?void 0:_r.jitterBufferEmittedCount)!==null&&_e!==void 0?_e:s.jitterBufferEmittedCount;if(typeof _o=="number"){const _p=this.lastVideoFramesRecv.get(g.ssrc),_f=Date.now();g.framesReceivedCount=_o;let eE=0;_p&&_f-_p.lts>=800?(eE=Math.round((_o-_p.count)/((_f-_p.lts)/1e3)),this.lastVideoFramesRecv.set(g.ssrc,{count:_o,lts:_f,rate:eE})):_p?eE=_p.rate:this.lastVideoFramesRecv.set(g.ssrc,{count:_o,lts:_f,rate:0}),g.receivedFrame={width:ga||0,height:_a||0,frameRate:eE||0},g.decodedFrame={width:ga||0,height:_a||0,frameRate:g.decodeFrameRate||0},g.outputFrame={width:ga||0,height:_a||0,frameRate:g.outputFrameRate||g.decodeFrameRate||0}}if(_c&&tE){const _p=this.lastVideoJBDelay.get(g.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let _f=_p.jitterBufferMs;const eE=tE-_p.jitterBufferEmittedCount;eE>0&&(_f=1e3*(_c-_p.jitterBufferDelay)/eE),g.jitterBufferMs=_f,g.currentDelayMs=Math.round(_f),this.lastVideoJBDelay.set(g.ssrc,{jitterBufferDelay:_c,jitterBufferEmittedCount:tE,jitterBufferMs:g.currentDelayMs})}}processAudioTrackSenderStats(s,d,g){var b,$,Vt,zt;const _e=d?this.report.get(d):void 0,_r=(b=($=_e==null?void 0:_e.echoReturnLoss)!==null&&$!==void 0?$:s.echoReturnLoss)!==null&&b!==void 0?b:0,_o=(Vt=(zt=_e==null?void 0:_e.echoReturnLossEnhancement)!==null&&zt!==void 0?zt:s.echoReturnLossEnhancement)!==null&&Vt!==void 0?Vt:0;g.aecReturnLoss=_r,g.aecReturnLossEnhancement=_o}processAudioTrackReceiverStats(s,d,g){var b,$,Vt,zt,_e,_r,_o;const ga=d?this.report.get(d):void 0,_a=(b=ga==null?void 0:ga.removedSamplesForAcceleration)!==null&&b!==void 0?b:s.removedSamplesForAcceleration,_c=($=ga==null?void 0:ga.totalSamplesReceived)!==null&&$!==void 0?$:s.totalSamplesReceived,tE=(Vt=ga==null?void 0:ga.jitterBufferDelay)!==null&&Vt!==void 0?Vt:s.jitterBufferDelay,_p=(zt=ga==null?void 0:ga.jitterBufferEmittedCount)!==null&&zt!==void 0?zt:s.jitterBufferEmittedCount,_f=(_e=ga==null?void 0:ga.audioLevel)!==null&&_e!==void 0?_e:s==null?void 0:s.audioLevel,eE=(_r=ga==null?void 0:ga.totalSamplesDuration)!==null&&_r!==void 0?_r:s==null?void 0:s.totalSamplesDuration,iE=(_o=ga==null?void 0:ga.concealedSamples)!==null&&_o!==void 0?_o:s.concealedSamples;if(_a&&_c&&(g.accelerateRate=_a/_c),tE&&_p){const mE=this.lastAudioJBDelay.get(g.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let _E=mE.jitterBufferMs;const SE=_p-mE.jitterBufferEmittedCount;SE>0&&(_E=1e3*(tE-mE.jitterBufferDelay)/SE),g.jitterBufferMs=Math.round(_E),this.lastAudioJBDelay.set(g.ssrc,{jitterBufferDelay:tE,jitterBufferEmittedCount:_p,jitterBufferMs:g.jitterBufferMs})}g.outputLevel=_f;let fE=1920;eE&&_c&&(fE=_c/eE/50,g.receivedFrames=Math.round(_c/fE)),iE&&(g.droppedFrames=Math.round(iE/fE))}processRemoteInboundStats(s,d){const g=this.report.get(s);g&&(d.packetsLost=g.packetsLost,g.roundTripTime&&(d.rttMs=1e3*g.roundTripTime),g.jitter&&(d.jitterMs=1e3*g.jitter),g.timestamp&&(d.timestamp=g.timestamp))}getCodecFromCodecStats(s){const d=this.report.get(s);if(!d)return"";const g=d.mimeType.match(/\/(.*)$/);return g&&g[1]?g[1]:""}updateSendBitrate(){let s=0,d=null,g=null;this.mediaBytesSent.forEach($=>{s+=$.diffMean()}),this.mediaBytesRetransmit.forEach($=>{d=d===null?$.diffMean():d+$.diffMean()}),this.mediaBytesTargetEncode.forEach($=>{g=g===null?$.diffMean():g+$.diffMean()});const b=d!==null?s-d:s;this._stats.bitrate={actualEncoded:8*b/(this.options.updateInterval/1e3),transmit:8*s/(this.options.updateInterval/1e3)},d!==null&&(this._stats.bitrate.retransmit=8*d/(this.options.updateInterval/1e3)),g!==null&&(this._stats.bitrate.targetEncoded=8*g/(this.options.updateInterval/1e3))}}class cht extends cG{updateStats(){return GE.resolve()}}function yL(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const $=function(){const Vt=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return Vt&&Vt[0]?Number(Vt[0].split("/")[1]):null}();return $?$<76?new aht(o,{updateInterval:s,lossRateInterval:d,freezeRateLimit:g,firstVideoDecodedTimeout:b}):new j9(o,{updateInterval:s,lossRateInterval:d,freezeRateLimit:g,firstVideoDecodedTimeout:b}):function(Vt){return!!window.RTCStatsReport&&Vt.getStats()instanceof GE}(o)?new j9(o,{updateInterval:s,lossRateInterval:d,freezeRateLimit:g,firstVideoDecodedTimeout:b}):new cht(o,{updateInterval:s,lossRateInterval:d,freezeRateLimit:g,firstVideoDecodedTimeout:b})}function V9(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function F9(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?V9(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):V9(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}function BP(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},g=arguments.length>3?arguments[3]:void 0;const{filterRTX:b,filterVideoFec:$,filterAudioFec:Vt,filterAudioCodec:zt,filterVideoCodec:_e}=s,{useXR:_r}=d;let _o=[],ga=[],_a=[],_c=[],tE=!1,_p=!1;if(iS.parse(o).mediaDescriptions.forEach(eE=>{g&&g!==eE.attributes.direction||(eE.media.mediaType!=="video"||tE||(ga=eE.attributes.payloads,_c=eE.attributes.extmaps,tE=!0),eE.media.mediaType!=="audio"||_p||(_o=eE.attributes.payloads,_a=eE.attributes.extmaps,_p=!0))}),!_c||ga.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!_a||_o.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(ga.forEach(eE=>{var iE;(iE=eE.rtpMap)!==null&&iE!==void 0&&iE.clockRate&&(eE.rtpMap.clockRate=parseInt(eE.rtpMap.clockRate)),_r&&eE.rtcpFeedbacks.push({type:"rrtr"})}),_o.forEach(eE=>{var iE;(iE=eE.rtpMap)!==null&&iE!==void 0&&iE.clockRate&&(eE.rtpMap.clockRate=parseInt(eE.rtpMap.clockRate)),_r&&eE.rtcpFeedbacks.push({type:"rrtr"})}),b&&(_o=_o.filter(eE=>{var iE;return((iE=eE.rtpMap)===null||iE===void 0?void 0:iE.encodingName.toLowerCase())!=="rtx"}),ga=ga.filter(eE=>{var iE;return((iE=eE.rtpMap)===null||iE===void 0?void 0:iE.encodingName.toLowerCase())!=="rtx"})),$&&(ga=ga.filter(eE=>{var iE;return!/(red)|(ulpfec)|(flexfec)/i.test(((iE=eE.rtpMap)===null||iE===void 0?void 0:iE.encodingName)||"")})),Vt&&(_o=_o.filter(eE=>{var iE;return!/(red)|(ulpfec)|(flexfec)/i.test(((iE=eE.rtpMap)===null||iE===void 0?void 0:iE.encodingName)||"")})),zt&&(zt==null?void 0:zt.length)>0&&(_o=_o.filter(eE=>{var iE;return KE(zt).call(zt,((iE=eE.rtpMap)===null||iE===void 0?void 0:iE.encodingName.toLowerCase())||"")})),_e&&(_e==null?void 0:_e.length)>0){const eE=ga.filter(iE=>{var fE;return KE(_e).call(_e,((fE=iE.rtpMap)===null||fE===void 0?void 0:fE.encodingName.toLowerCase())||"")});ga=eE.concat(b?[]:pG(eE,ga))}const _f=cE("UNSUPPORTED_VIDEO_CODEC");return _f&&_f.length>0&&(ga=ga.filter(eE=>!(eE.rtpMap&&KE(_f).call(_f,eE.rtpMap.encodingName.toLowerCase())))),{audioCodecs:_o,videoCodecs:ga,audioExtensions:_a,videoExtensions:_c}}function X0(o){const s=iS.parse(o);let d,g;for(const b of s.mediaDescriptions){if(!d){const $=b.attributes.iceUfrag,Vt=b.attributes.icePwd;if(!$||!Vt)throw new Error("Cannot get iceUfrag or icePwd from SDP.");d={iceUfrag:$,icePwd:Vt}}if(!g){const $=b.attributes.fingerprints;$.length>0&&(g={fingerprints:$})}}if(!g&&s.attributes.fingerprints.length>0&&(g={fingerprints:s.attributes.fingerprints}),!g||!d)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:d,dtlsParameters:g}}function uG(o,s){const d=[],g=o.attributes.ssrcGroups.filter(Vt=>Vt.semantic==="FID"),b=o.attributes.ssrcGroups.find(Vt=>Vt.semantic==="SIM"),$=o.attributes.ssrcs;if(b)b.ssrcIds.forEach(Vt=>{var zt;const _e=(zt=g.find(_r=>_r.ssrcIds[0]===Vt))===null||zt===void 0?void 0:zt.ssrcIds[1];d.push({ssrcId:Vt,rtx:s?_e:void 0})});else if(g.length>0){const Vt=g[0].ssrcIds[0],zt=g[0].ssrcIds[1];d.push({ssrcId:Vt,rtx:s?zt:void 0})}else{if($.length===0)throw new Error("No ssrcs found on local media description.");d.push({ssrcId:$[0].ssrcId})}return d}function B9(o,s){const{cname:d}=o;let g;s&&s.ip&&typeof s.port=="number"?(g=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:s.ip,port:s.port.toString(),type:"host",extension:{}}],_l.debug("Using remote candidate from AP ".concat(s.ip,":").concat(s.port)),s.ip6&&(g.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:s.ip6,port:s.port.toString(),type:"host",extension:{}}),_l.debug("Using IPV6 remote candidate from AP ".concat(s.ip6,":").concat(s.port)))):g=o.iceParameters.candidates.map(zt=>({foundation:zt.foundation,componentId:"1",transport:zt.protocol,priority:zt.priority.toString(),connectionAddress:zt.ip,port:zt.port.toString(),type:zt.type,extension:{}}));const b={fingerprints:o.dtlsParameters.fingerprints.map(zt=>({hashFunction:zt.algorithm,fingerprint:zt.fingerprint}))},$={iceUfrag:o.iceParameters.iceUfrag,icePwd:o.iceParameters.icePwd};let Vt;switch(o.dtlsParameters.role){case"server":Vt="passive";break;case"client":Vt="active";break;case"auto":Vt="actpass"}return{dtlsParameters:b,iceParameters:$,candidates:g,rtpCapabilities:gN(o.rtpCapabilities),setup:Vt,cname:d}}function t0(o,s,d){const g=[],b=[];return o.forEach($=>{let{ssrcId:Vt,rtx:zt}=$;const _e=z_(8,"track-"),_r={ssrcId:Vt,attributes:F9({label:_e,mslabel:d=d||z_(10,""),msid:"".concat(d," ").concat(_e)},s&&{cname:s})};if(g.push(_r),zt!==void 0){const _o={ssrcId:zt,attributes:F9({label:_e,mslabel:d,msid:"".concat(d," ").concat(_e)},s&&{cname:s})};g.push(_o),b.push({semantic:"FID",ssrcIds:[Vt,zt]})}}),o.length>1&&b.push({semantic:"SIM",ssrcIds:o.map($=>{let{ssrcId:Vt}=$;return Vt})}),{ssrcs:g,ssrcGroups:b}}function mI(o,s){s instanceof mS&&o.attributes.payloads.forEach(d=>{var g;const b=(g=d.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase();if(!b||["opus","pcmu","pcma","g722"].indexOf(b)===-1)return;d.fmtp||(d.fmtp={parameters:{}}),d.fmtp.parameters.minptime="10",d.fmtp.parameters.useinbandfec="1";const $=s._encoderConfig;$&&b!=="pcmu"&&b!=="pcma"&&b!=="g722"&&($.bitrate&&!H_()&&(d.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*$.bitrate))),$.sampleRate&&(d.fmtp.parameters.maxplaybackrate="".concat($.sampleRate),d.fmtp.parameters["sprop-maxcapturerate"]="".concat($.sampleRate)),$.stereo&&(d.fmtp.parameters.stereo="1",d.fmtp.parameters["sprop-stereo"]="1"))})}function SL(o){const s=o.attributes.unrecognized.findIndex(d=>d.attField==="x-google-flag"&&d.attValue==="conference");s!==-1&&o.attributes.unrecognized.splice(s,1)}function TL(o,s){var d;if(!(s instanceof Y_&&s._encoderConfig&&s._hints.indexOf(Z_.SCREEN_TRACK)===-1))return;const g=s._encoderConfig;R_().supportMinBitrate&&g.bitrateMin&&o.attributes.payloads.forEach(b=>{var $,Vt;KE($=["h264","h265","vp8","vp9","av1"]).call($,((Vt=b.rtpMap)===null||Vt===void 0?void 0:Vt.encodingName.toLowerCase())||"")&&(b.fmtp||(b.fmtp={parameters:{}}),b.fmtp.parameters["x-google-min-bitrate"]="".concat(g.bitrateMin))}),R_().supportMinBitrate&&!KE(d=s._hints).call(d,Z_.LOW_STREAM)&&g.bitrateMax&&o.attributes.payloads.forEach(b=>{var $,Vt;KE($=["h264","h265","vp8","vp9","av1"]).call($,((Vt=b.rtpMap)===null||Vt===void 0?void 0:Vt.encodingName.toLowerCase())||"")&&(b.fmtp||(b.fmtp={parameters:{}}),b.fmtp.parameters["x-google-start-bitrate"]="".concat(cE("X_GOOGLE_START_BITRATE")||Math.floor(g.bitrateMax)))})}function lG(o){if(o.media.mediaType!=="video")return;const s=O_();if(s.name!==M_.SAFARI&&s.os!==BS.IOS)return;const d=o.attributes.extmaps.findIndex(g=>/video-orientation/g.test(g.extensionName));d!==-1&&o.attributes.extmaps.splice(d,1)}function EN(o,s,d){if(!s)return;let g,b;if(o.media.mediaType==="video"?(g=d.videoExtensions,b=d.videoCodecs):(g=d.audioExtensions,b=d.audioCodecs),s.twcc===!0){const $=g.find(Vt=>Vt.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");$&&(o.attributes.extmaps.find(zt=>zt.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||o.attributes.extmaps.push({entry:$.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(zt,_e){return _e.filter(_r=>!!zt.find(_o=>_o.payloadType===_r.payloadType&&!!_o.rtcpFeedbacks.find(ga=>ga.type==="transport-cc")))}(b,o.attributes.payloads).forEach(zt=>{zt.rtcpFeedbacks.find(_e=>_e.type==="transport-cc")||zt.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(s.twcc===!1){const $=o.attributes.extmaps.findIndex(Vt=>Vt.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");$!==-1&&o.attributes.extmaps.splice($,1),o.attributes.payloads.forEach(Vt=>{const zt=Vt.rtcpFeedbacks.findIndex(_e=>_e.type==="transport-cc");zt!==-1&&Vt.rtcpFeedbacks.splice(zt,1)})}if(s.remb===!0){const $=g.find(Vt=>Vt.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");$&&(o.attributes.extmaps.find(zt=>zt.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||o.attributes.extmaps.push({entry:$.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(zt,_e){return _e.filter(_r=>!!zt.find(_o=>_o.payloadType===_r.payloadType&&!!_o.rtcpFeedbacks.find(ga=>ga.type==="goog-remb")))}(b,o.attributes.payloads).forEach(zt=>{zt.rtcpFeedbacks.find(_e=>_e.type==="goog-remb")||zt.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(s.remb===!1){const $=o.attributes.extmaps.findIndex(Vt=>Vt.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");$!==-1&&o.attributes.extmaps.splice($,1),o.attributes.payloads.forEach(Vt=>{const zt=Vt.rtcpFeedbacks.findIndex(_e=>_e.type==="goog-remb");zt!==-1&&Vt.rtcpFeedbacks.splice(zt,1)})}}function dG(o,s,d){if(H_()||o.media.mediaType!=="video"||!(s instanceof Y_)||d!=="vp9"&&d!=="vp8"||d==="vp8"&&!cE("SIMULCAST")||s._scalabilityMode===void 0||s._scalabilityMode.numSpatialLayers<=1)return;const g=d==="vp8"?2:s._scalabilityMode.numSpatialLayers,b=o.attributes.ssrcs[0],$=o.attributes.ssrcGroups.find(zt=>zt.semantic==="FID"&&zt.ssrcIds[0]===b.ssrcId),Vt={semantic:"SIM",ssrcIds:[b.ssrcId]};for(let zt=1;zt<g;zt++)o.attributes.ssrcs.push({ssrcId:b.ssrcId+zt,attributes:Q_(b.attributes)}),Vt.ssrcIds.push(b.ssrcId+zt),$&&(o.attributes.ssrcs.push({ssrcId:$.ssrcIds[1]+zt,attributes:Q_(b.attributes)}),o.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[b.ssrcId+zt,$.ssrcIds[1]+zt]}));o.attributes.ssrcGroups.unshift(Vt)}async function hG(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly"}),d.addTransceiver("audio",{direction:"sendonly"}),d.addTransceiver("video",{direction:"recvonly"}),d.addTransceiver("audio",{direction:"recvonly"});const g=(await d.createOffer()).sdp,{send:b,recv:$,sendrecv:Vt}=function(){let zt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},_r=arguments.length>2?arguments[2]:void 0;const _o=BP(_r,zt,_e,"sendonly"),ga=BP(_r,zt,_e,"recvonly"),_a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},tE={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(D0(_o,ga,"videoExtensions",_a,_c,tE),D0(_o,ga,"videoCodecs",_a,_c,tE),D0(_o,ga,"audioExtensions",_a,_c,tE),D0(_o,ga,"audioCodecs",_a,_c,tE),cE("RAISE_H264_BASELINE_PRIORITY")){const _p=tE.videoCodecs.findIndex(_f=>{var eE,iE;return((eE=_f.rtpMap)===null||eE===void 0?void 0:eE.encodingName.toLocaleLowerCase())==="h264"&&((iE=_f.fmtp)===null||iE===void 0?void 0:iE.parameters["profile-level-id"])==="42001f"});if(_p!==-1){const _f=tE.videoCodecs.findIndex(eE=>{var iE;return((iE=eE.rtpMap)===null||iE===void 0?void 0:iE.encodingName.toLocaleLowerCase())==="h264"});if(_f<_p){_l.debug("raising H264 baseline profile priority");const eE=tE.videoCodecs[_p];tE.videoCodecs.splice(_p,1),tE.videoCodecs.splice(_f,0,eE)}_f!==-1&&(_c.videoCodecs=_c.videoCodecs.filter(eE=>{var iE,fE;return!(((iE=eE.rtpMap)===null||iE===void 0?void 0:iE.encodingName.toLocaleLowerCase())==="h264"&&((fE=eE.fmtp)===null||fE===void 0?void 0:fE.parameters["profile-level-id"])!=="42001f")})),_f!==-1&&cE("FILTER_SEND_H264_BASELINE")&&(_a.videoCodecs=_a.videoCodecs.filter(eE=>{var iE,fE;return!(((iE=eE.rtpMap)===null||iE===void 0?void 0:iE.encodingName.toLocaleLowerCase())==="h264"&&((fE=eE.fmtp)===null||fE===void 0?void 0:fE.parameters["profile-level-id"])!=="42001f")}))}}return{send:_a,recv:_c,sendrecv:tE}}(o,s,g);try{d.close()}catch{}return{send:b,recv:$,sendrecv:Vt}}function G9(){const o={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},s=BP(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(D0(o,s,"videoExtensions",d,g,b),D0(o,s,"videoCodecs",d,g,b),D0(o,s,"audioExtensions",d,g,b),D0(o,s,"audioCodecs",d,g,b),cE("RAISE_H264_BASELINE_PRIORITY")){const $=b.videoCodecs.findIndex(Vt=>Vt.rtpMap&&Vt.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Vt.fmtp&&Vt.fmtp.parameters["profile-level-id"]==="42001f");if($!==-1){const Vt=b.videoCodecs.findIndex(zt=>zt.rtpMap&&zt.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(Vt<$){_l.debug("raising H264 baseline profile priority");const zt=b.videoCodecs[$];b.videoCodecs.splice($,1),b.videoCodecs.splice(Vt,0,zt)}Vt!==-1&&(g.videoCodecs=g.videoCodecs.filter(zt=>!(zt.rtpMap&&zt.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&zt.fmtp&&zt.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:d,recv:g,sendrecv:b}}function D0(o,s,d,g,b,$){if(d==="videoExtensions"||d==="audioExtensions"){const Vt=[];return o[d].forEach(zt=>{s[d].some((_e,_r)=>{if(zt.entry===_e.entry&&zt.extensionName===_e.extensionName)return Vt.push(_r),!0})?$[d].push(zt):g[d].push(zt)}),void s[d].forEach((zt,_e)=>{Vt.indexOf(_e)===-1&&b[d].push(zt)})}if(d==="videoCodecs"||d==="audioCodecs"){const Vt=[];return o[d].forEach(zt=>{s[d].some((_e,_r)=>{if(zt.payloadType===_e.payloadType&&JSON.stringify(zt)===JSON.stringify(_e))return Vt.push(_r),!0})?$[d].push(zt):g[d].push(zt)}),void s[d].forEach((zt,_e)=>{Vt.indexOf(_e)===-1&&b[d].push(zt)})}}function gN(o){const{send:s,recv:d,sendrecv:g}=o;if(!g){if(!s||!d)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:s,recv:d}}let b,$;return s?(b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b.audioCodecs=[...s.audioCodecs,...g.audioCodecs],b.videoCodecs=[...s.videoCodecs,...g.videoCodecs],b.audioExtensions=[...s.audioExtensions,...g.audioExtensions],b.videoExtensions=[...s.videoExtensions,...g.videoExtensions]):b=g,d?($={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},$.audioCodecs=[...d.audioCodecs,...g.audioCodecs],$.videoCodecs=[...d.videoCodecs,...g.videoCodecs],$.audioExtensions=[...d.audioExtensions,...g.audioExtensions],$.videoExtensions=[...d.videoExtensions,...g.videoExtensions]):$=g,{send:b,recv:$}}function Q0(o){o.media.mediaType==="audio"&&o.attributes.payloads.filter(s=>{var d;return((d=s.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase())==="opus"}).forEach(s=>{s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"})}function bL(o){o.mediaDescriptions.forEach(s=>{s.media.mediaType!=="video"&&s.media.mediaType!=="audio"||s.attributes.payloads.forEach(d=>{d.rtcpFeedbacks.findIndex(g=>g.type==="rrtr")===-1&&d.rtcpFeedbacks.push({type:"rrtr"})})})}function sO(o,s,d,g){let b=[];if(o===_g.VIDEO){if(cE("H264_PROFILE_LEVEL_ID")&&g==="h264"&&(b=s.videoCodecs.filter($=>{var Vt;return KE(Vt=$.rtpMap&&$.rtpMap.encodingName.toLowerCase()||"").call(Vt,g)&&$&&$.fmtp&&$.fmtp.parameters["profile-level-id"]===cE("H264_PROFILE_LEVEL_ID")})),!Array.isArray(b)||b.length===0){let $=[];const Vt=[],zt=[],_e=[];if(d.videoCodecs.forEach(_r=>{const _o=_r.rtpMap&&_r.rtpMap.encodingName.toLowerCase()||"";KE(_o).call(_o,g)?$.push(_r):KE(_o).call(_o,"vp9")?Vt.push(_r):KE(_o).call(_o,"vp8")?zt.push(_r):KE(_o).call(_o,"h264")&&_e.push(_r)}),$.length===0){let _r="";Vt.length!==0?($=Vt,_r="vp9"):zt.length!==0?($=zt,_r="vp8"):_e.length!==0&&($=_e,_r="h264"),_l.warning("codec ".concat(g," not included in rtpCapabilities, fallback to default payloads: ").concat(_r))}$.length!==0&&(b=s.videoCodecs.filter(_r=>$.some(_o=>_o.payloadType===_r.payloadType)))}if(b.length===0&&(_l.warning("codec ".concat(g," not included in rtpCapabilities, fallback to default payloads: ").concat(s.videoCodecs[0].rtpMap&&s.videoCodecs[0].rtpMap.encodingName)),b=s.videoCodecs),cE("USE_PUB_RTX")||cE("USE_SUB_RTX")){const $=pG(b,s.videoCodecs);b=[...b,...$]}}else b=s.audioCodecs.filter($=>{var Vt;return KE(Vt=$.rtpMap&&$.rtpMap.encodingName.toLowerCase()||"").call(Vt,g)}),b.length===0&&(_l.warning("codec ".concat(g," not included in rtpCapabilities, fallback to opus")),b=s.audioCodecs.filter($=>{var Vt;return KE(Vt=$.rtpMap&&$.rtpMap.encodingName.toLowerCase()||"").call(Vt,"opus")}));return b}function pG(o,s){const d=o.map(g=>g.payloadType.toString());return s.filter(g=>g.rtpMap&&g.rtpMap.encodingName==="rtx"&&g.fmtp&&g.fmtp.parameters.apt&&KE(d).call(d,g.fmtp&&g.fmtp.parameters.apt))}let W9=class{get localCapabilities(){return Q_(this._localCapabilities)}get rtpCapabilities(){return Q_(this._rtpCapabilities)}get candidates(){return Q_(this._candidates)}get iceParameters(){return Q_(this._iceParameters)}get dtlsParameters(){return Q_(this._dtlsParameters)}constructor(o){Qm(this,"sessionDesc",void 0),Qm(this,"_localCapabilities",void 0),Qm(this,"_rtpCapabilities",void 0),Qm(this,"_candidates",void 0),Qm(this,"_iceParameters",void 0),Qm(this,"_dtlsParameters",void 0),Qm(this,"setup",void 0),Qm(this,"currentMidIndex",void 0),Qm(this,"cname","o/i14u9pJrxRKAsu"),Qm(this,"firefoxSsrcMidMap",new Map),o=Q_(o);const{remoteIceParameters:s,remoteDtlsParameters:d,candidates:g,remoteRTPCapabilities:b,localCapabilities:$,direction:Vt,setup:zt,videoCodec:_e,audioCodec:_r}=o;let _o;this.setup=zt,_o=Vt===vT.RECEIVE_ONLY?iS.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):iS.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=b,this._candidates=g,this._iceParameters=s,this._dtlsParameters=d,this._localCapabilities=$;const ga=Vt===vT.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,_a=Vt===vT.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,_c=Vt===vT.RECEIVE_ONLY?b.send.videoCodecs:sO(_g.VIDEO,ga,_a,_e),tE=Vt===vT.RECEIVE_ONLY?b.send.audioCodecs:sO(_g.AUDIO,ga,_a,_r);for(const _p of _o.mediaDescriptions)_p.attributes.iceUfrag=s.iceUfrag,_p.attributes.icePwd=s.icePwd,_p.attributes.fingerprints=d.fingerprints,_p.attributes.candidates=g,_p.attributes.setup=this.setup,_p.media.mediaType==="application"&&(_p.attributes.sctpPort="5000"),_p.media.mediaType==="video"&&(_p.media.fmts=_c.map(_f=>_f.payloadType.toString(10)),_p.attributes.payloads=_c,_p.attributes.extmaps=ga.videoExtensions),_p.media.mediaType==="audio"&&(_p.media.fmts=tE.map(_f=>_f.payloadType.toString(10)),_p.attributes.payloads=tE,_p.attributes.extmaps=ga.audioExtensions,Q0(_p));this.sessionDesc=_o,this.currentMidIndex=_o.mediaDescriptions.length-1}toString(){return iS.print(this.sessionDesc)}hasMid(o){return Array.isArray(o)?o.every(s=>this.hasMid(s)):this.sessionDesc.mediaDescriptions.some(s=>s.attributes.mid===o)}send(o,s,d,g,b){d=d.replace(/ /g,"-");const{ssrcs:$,ssrcGroups:Vt}=t0(s,this.cname,cE("SYNC_GROUP")?d:void 0),zt=this.findPreloadMediaDesc($);if(zt){if(H_()&&this.firefoxSsrcMidMap.set($[0].ssrcId,zt.attributes.mid),b&&(b.twcc||b.remb)){const _e=this.sessionDesc.mediaDescriptions.indexOf(zt);return this.sessionDesc.mediaDescriptions[_e]=this.mungSendMediaDesc(zt,b),{mid:zt.attributes.mid,needExchangeSDP:!0}}return{mid:zt.attributes.mid,needExchangeSDP:!1}}{const _e=this.findAvailableMediaIndex(o,$,g);let _r;return _e===-1?(_r=this.createOrRecycleSendMedia(o,$,Vt,"sendonly",g,b),this.updateBundleMids()):(_r=Q_(this.sessionDesc.mediaDescriptions[_e]),_r.attributes.direction="sendonly",_r.attributes.ssrcs=$,_r.attributes.ssrcGroups=Vt,this.sessionDesc.mediaDescriptions[_e]=this.mungSendMediaDesc(_r,b)),H_()&&this.firefoxSsrcMidMap.set($[0].ssrcId,_r.attributes.mid),{needExchangeSDP:!0,mid:_r.attributes.mid}}}stopSending(o){const s=this.sessionDesc.mediaDescriptions.filter(d=>d.attributes.mid&&o.indexOf(d.attributes.mid)!==-1);if(s.length!==o.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");s.forEach(d=>{d.attributes.ssrcs=[]}),this.updateBundleMids()}receive(o,s,d){const g=[];return o.forEach(b=>{const $=b._mediaStreamTrack.kind,Vt=this.findAvailableRecvMediaIndex($);let zt,_e=!1;Vt===-1?(_e=!0,zt=this.createOrRecycleRecvMedia(b,[],"recvonly",s,d),this.updateBundleMids()):(zt=Q_(this.sessionDesc.mediaDescriptions[Vt]),zt.attributes.direction="recvonly"),g.push({mid:zt.attributes.mid,needCreateTransceiver:_e})}),g}stopReceiving(o){const s=this.sessionDesc.mediaDescriptions.filter(d=>o.indexOf(d.attributes.mid)!==-1);if(s.length!==o.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");s.forEach(d=>{d.media.port="0",d.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(o){const{foundation:s,protocol:d,address:g,port:b,type:$,relatedAddress:Vt,relatedPort:zt,priority:_e}=new RTCIceCandidate(o),_r={foundation:s??"",componentId:"1",transport:d??"",priority:_e?_e+"":"",connectionAddress:g??"",port:b?b+"":"",type:$?$+"":"",relAddr:Vt??"",relPort:zt?zt+"":"",extension:{}};this.candidates.some(_o=>_o.priority===_r.priority&&_o.connectionAddress===_r.connectionAddress&&_o.port===_r.port)||(this._candidates.push(_r),this.sessionDesc.mediaDescriptions.forEach(_o=>{_o.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(o,s,d,g,b){const $=o._mediaStreamTrack.kind,Vt=this.rtpCapabilities.recv,zt=sO($,Vt,this.localCapabilities.send,$===_g.AUDIO?b:g),_e=$===_g.VIDEO?Vt.videoExtensions:Vt.audioExtensions,_r="".concat(++this.currentMidIndex);let _o={media:{mediaType:$,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:zt.map(_a=>_a.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_e,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:zt,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:d,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_r)}};_o=this.mungRecvMediaDsec(_o,o);const ga=this.findFirstClosedMedia($);if(ga){const _a=this.sessionDesc.mediaDescriptions.indexOf(ga);this.sessionDesc.mediaDescriptions[_a]=_o}else this.sessionDesc.mediaDescriptions.push(_o);return _o}muteRemote(o){const s=this.sessionDesc.mediaDescriptions.filter(d=>KE(o).call(o,d.attributes.mid||""));if(s.length!==o.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");s.forEach(d=>{d.attributes.direction="inactive"})}unmuteRemote(o){const s=this.sessionDesc.mediaDescriptions.filter(d=>KE(o).call(o,d.attributes.mid||""));if(s.length!==o.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");s.forEach(d=>{d.attributes.direction="recvonly"})}findAvailableMediaIndex(o,s,d){return this.sessionDesc.mediaDescriptions.findIndex(g=>{const b=g.media.mediaType===o&&g.media.port!=="0"&&(g.attributes.direction==="sendonly"||g.attributes.direction==="sendrecv")&&g.attributes.ssrcs.length===0;if(H_()){if(b){const $=this.firefoxSsrcMidMap.get(s[0].ssrcId);return!($||g.attributes.mid!=="0"&&g.attributes.mid!=="1")||!(!$||$!==g.attributes.mid)}return!1}return b&&g.attributes.mid===d})}findAvailableRecvMediaIndex(o){return this.sessionDesc.mediaDescriptions.findIndex(s=>{const d=s.media.mediaType===o&&s.media.port!=="0"&&(s.attributes.direction==="recvonly"||s.attributes.direction==="sendrecv");return s.attributes.mid!=="0"&&s.attributes.mid!=="1"&&d})}predictReceivingMids(o){const s=[];for(let d=0;d<o;d++)s.push((this.currentMidIndex+d+1).toString(10));return s}restartICE(o){o=Q_(o),this._iceParameters=o,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=o.iceUfrag,s.attributes.icePwd=o.icePwd})}createOrRecycleSendMedia(o,s,d,g,b,$){const Vt=this.rtpCapabilities.send,zt=o===_g.VIDEO?Vt.videoCodecs:Vt.audioCodecs,_e=o===_g.VIDEO?Vt.videoExtensions:Vt.audioExtensions;H_()&&(b="".concat(++this.currentMidIndex));let _r={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:zt.map(ga=>ga.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_e,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:s,ssrcGroups:d,rtcpFeedbackWildcards:[],payloads:zt,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:g,rtcpMux:!0,rtcpRsize:!0,mid:b}};_r=this.mungSendMediaDesc(_r,$);const _o=this.findFirstClosedMedia(o);if(_o){const ga=this.sessionDesc.mediaDescriptions.indexOf(_o);this.sessionDesc.mediaDescriptions[ga]=_r}else this.sessionDesc.mediaDescriptions.push(_r);return _r}mungRecvMediaDsec(o,s,d){const g=Q_(o);return SL(g),mI(g,s),TL(g,s),lG(g),EN(g,d,this.localCapabilities.send),g}mungSendMediaDesc(o,s){const d=Q_(o);return EN(d,s,this.localCapabilities.recv),Q0(d),d}updateRecvMedia(o,s){const d=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===o);if(d!==-1){const g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[d],s);this.sessionDesc.mediaDescriptions[d]=g}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(o=>o.media.port!=="0").map(o=>o.attributes.mid)}findPreloadMediaDesc(o){return this.sessionDesc.mediaDescriptions.find(s=>{var d;return((d=s.attributes)===null||d===void 0||(d=d.ssrcs[0])===null||d===void 0?void 0:d.ssrcId)===o[0].ssrcId})}findFirstClosedMedia(o){return this.sessionDesc.mediaDescriptions.find(s=>H_()?s.media.port==="0"&&s.media.mediaType===o:s.media.port==="0")}};const uht=["sdp"];var _v;function q9(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function EI(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?q9(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):q9(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}let H9=(_v=class CN extends I4{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var s,d;return(s=(d=this.peerConnection.getReceivers()[0])===null||d===void 0||(d=d.transport)===null||d===void 0?void 0:d.state)!==null&&s!==void 0?s:null}get localCodecs(){return[]}set isInRestartIce(s){this._isInRestartIce=s}get isInRestartIce(){return this._isInRestartIce}constructor(s,d,g){super(s,d),Qm(this,"direction",void 0),Qm(this,"name",void 0),Qm(this,"store",void 0),Qm(this,"spec",void 0),Qm(this,"peerConnection",void 0),Qm(this,"initialOffer",void 0),Qm(this,"transport",void 0),Qm(this,"statsFilter",void 0),Qm(this,"localCandidateCount",0),Qm(this,"_isInRestartIce",!1),Qm(this,"mutex",new KS("P2PConnection-mutex")),Qm(this,"onLocalCandidate",void 0),Qm(this,"remoteSDP",void 0),Qm(this,"pendingCandidates",[]),Qm(this,"localCapabilities",void 0),Qm(this,"isReady",!1),Qm(this,"restartCnt",0),Qm(this,"curTurnServerIndex",0),this.store=d,this.spec=s,this.peerConnection=new RTCPeerConnection(CN.resolvePCConfiguration(s,d.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=g??vT.SEND_ONLY,this.name=this.direction===vT.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=yL(this.peerConnection,cE("STATS_UPDATE_INTERVAL"),void 0,H_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(s){try{const d=await hG();if(this.localCapabilities=gN(d),s){const{sdp:g}=s,b=oht(s,uht),$=function(){const _o={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},ga=BP(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),_a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},tE={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(D0(ga,_o,"videoExtensions",_a,_c,tE),D0(ga,_o,"videoCodecs",_a,_c,tE),D0(ga,_o,"audioExtensions",_a,_c,tE),D0(ga,_o,"audioCodecs",_a,_c,tE),cE("RAISE_H264_BASELINE_PRIORITY")){const _p=tE.videoCodecs.findIndex(_f=>_f.rtpMap&&_f.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&_f.fmtp&&_f.fmtp.parameters["profile-level-id"]==="42001f");if(_p!==-1){const _f=tE.videoCodecs.findIndex(eE=>eE.rtpMap&&eE.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(_f<_p){_l.debug("raising H264 baseline profile priority");const eE=tE.videoCodecs[_p];tE.videoCodecs.splice(_p,1),tE.videoCodecs.splice(_f,0,eE)}_f!==-1&&cE("FILTER_SEND_H264_BASELINE")&&(_a.videoCodecs=_a.videoCodecs.filter(eE=>!(eE.rtpMap&&eE.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&eE.fmtp&&eE.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:_a,recv:_c,sendrecv:tE}}({},{},g);this.remoteSDP=new W9({remoteIceParameters:b.iceParameters,remoteDtlsParameters:b.dtlsParameters,candidates:[],remoteRTPCapabilities:$,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const Vt=await this.peerConnection.createAnswer();if(!Vt.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const zt=X0(Vt.sdp);await this.peerConnection.setLocalDescription(Vt);const _e=await G9({},{},Vt.sdp);this.localCapabilities=gN(_e);const _r=this.peerConnection.getTransceivers()[0];return _r!=null&&_r.receiver&&_r.receiver.transport&&this.tryBindTransportEvents(_r.receiver.transport),EI(EI({},zt),{},{sdp:Vt.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const g=await this.peerConnection.createOffer();if(!g.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const b=X0(g.sdp);return this.initialOffer=g,EI(EI({},b),{},{sdp:g.sdp})}}catch(d){throw new TE(rE.GET_LOCAL_CONNECTION_PARAMS_FAILED,d.toString())}}async connect(s){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:d,iceParameters:g,dtlsParameters:b}=s,$=await G9({},{},d);this.remoteSDP=new W9({remoteIceParameters:g,remoteDtlsParameters:b,candidates:[],remoteRTPCapabilities:$,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const Vt=this.peerConnection.getTransceivers()[0];Vt!=null&&Vt.sender&&Vt.sender.transport&&this.tryBindTransportEvents(Vt.sender.transport)}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(d.toString()))}}async addRemoteCandidate(s){try{s&&this.pendingCandidates.push(s),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(d=>{this.peerConnection.addIceCandidate(d)}),this.pendingCandidates=[])}catch(d){throw new TE(rE.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(d.toString()))}}send(s,d,g){var b=this;return BT(function*(){const $=yield f_(b.mutex.lock("From P2PConnection.send"));try{if(!b.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const Vt=[],zt=b.remoteSDP.receive(s,d,g);s.forEach((_f,eE)=>{if(zt[eE].needCreateTransceiver){const iE=b.peerConnection.addTransceiver(_f._mediaStreamTrack,{direction:"sendonly"});Vt.push(iE),_f._updateRtpTransceiver(iE)}else{const iE=b.peerConnection.getTransceivers().find(fE=>fE.mid===zt[eE].mid);if(!iE)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(zt[eE].mid));Vt.push(iE),_f._updateRtpTransceiver(iE)}}),H_()&&cE("SIMULCAST")===!0&&(yield f_(b.applySimulcastForFirefox(Vt,s)));const _e=zt.map(_f=>_f.mid),_r=yield f_(b.peerConnection.createOffer()),_o=b.mungSendOfferSDP(_r.sdp,s,_e),ga=iS.parse(_o),_a=_e.map(_f=>{const eE=ga.mediaDescriptions.find(iE=>iE.attributes.mid===_f);if(!eE)throw new Error("Cannot extract ssrc from mediaDescription.");return uG(eE,cE("USE_PUB_RTX"))}),_c=Vt.map((_f,eE)=>{const iE=_e[eE];return{localSSRC:_a[eE],id:iE}});yield f_(b.peerConnection.setLocalDescription({type:"offer",sdp:_o}));try{yield _c}catch(_f){const eE=b.remoteSDP.toString();throw yield f_(b.peerConnection.setLocalDescription({type:"offer",sdp:_o})),yield f_(b.peerConnection.setRemoteDescription({type:"answer",sdp:eE})),yield f_(b.stopSending(_e,!0)),_f}yield f_(b.applySimulcastEncodings(Vt,s)),yield f_(b.applySendEncodings(Vt,s));const tE=b.remoteSDP.toString(),_p=b.logSDPExchange(_o,"offer","local","send");return _p==null||_p(tE),yield f_(b.setRemoteDescription({type:"answer",sdp:tE})),Vt.map((_f,eE)=>{const iE=_e[eE];return{localSSRC:_a[eE],id:iE}})}catch(Vt){throw Vt instanceof TE?Vt:new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(Vt.toString()))}finally{$()}})()}async stopSending(s,d){const g=d?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const b=this.peerConnection.getTransceivers().filter(_e=>s.indexOf(_e.mid)!==-1);if(b.length!==s.length)throw new Error("Transceivers' length (".concat(b.length,") doesn't match mids' length (").concat(s.length,") when trying to call P2PConnection.stopSending."));b.map(_e=>{var _r;_e.direction="inactive",(_r=_e.stop)===null||_r===void 0||_r.call(_e)});const $=await this.peerConnection.createOffer(),Vt=this.logSDPExchange($.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription($),this.remoteSDP.stopReceiving(s);const zt=this.remoteSDP.toString();Vt==null||Vt(zt),await this.setRemoteDescription({type:"answer",sdp:zt})}catch(b){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(b.toString()))}finally{g&&g()}}async receive(s,d,g,b){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(s," before remoteSDP created."));const{mid:$,needExchangeSDP:Vt}=this.remoteSDP.send(s,d,g,b);if(Vt){const _e=this.remoteSDP.toString(),_r=this.logSDPExchange(_e,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_e});const _o=await this.peerConnection.createAnswer(),ga=this.mungReceiveAnswerSDP(_o.sdp,$,s);_r==null||_r(ga||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:ga}),_l.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(s," by exchanging SDP."))}else _l.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(s," no need to exchange SDP."));const zt=this.peerConnection.getTransceivers().find(_e=>_e.mid===$);if(!zt||zt.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:zt.receiver.track,mid:zt.mid,transceiver:zt}}catch($){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat($.toString()))}}async mockReceive(s,d,g,b){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(s," before remoteSDP created."));const{mid:$,needExchangeSDP:Vt}=this.remoteSDP.send(s,d,g,b);if(Vt){const zt=this.remoteSDP.toString(),_e=this.logSDPExchange(zt,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:zt});const _r=await this.peerConnection.createAnswer(),_o=this.mungReceiveAnswerSDP(_r.sdp,$,s);_e==null||_e(_o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_o}),_l.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(s," by exchanging SDP."))}else _l.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(s," no need to exchange SDP."))}catch($){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat($.toString()))}}async stopReceiving(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(s);const d=this.remoteSDP.toString(),g=this.logSDPExchange(d,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:d});const b=await this.peerConnection.createAnswer();g==null||g(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(d.toString()))}}async restartICE(s){try{if(this.store.p2pTransport===GI.Auto&&(this.store.p2pTransport=GI.SdRtn,R_().supportPCSetConfiguration&&this.peerConnection.setConfiguration(CN.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,R_().supportPCSetConfiguration&&this.peerConnection.setConfiguration(CN.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!s){this.restartCnt++,this.isReady=!1;const d=await this.peerConnection.createOffer({iceRestart:!0});if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:g}=X0(d.sdp);return this.store.descriptionStart(),this.direction===vT.SEND_ONLY&&await this.peerConnection.setLocalDescription(d),g}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(s),this.store.descriptionStart(),this.direction===vT.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const d=await this.peerConnection.createAnswer();if(!d.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:g}=X0(d.sdp);return await this.peerConnection.setLocalDescription(d),g}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(d.toString()))}}close(){var s;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(s){return this.statsFilter.getVideoIsReady(s)}async updateEncoderConfig(s,d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const g=await this.peerConnection.createOffer(),b=this.mungSendOfferSDP(g.sdp,[d],[s]);this.remoteSDP.updateRecvMedia(s,d);const $=this.remoteSDP.toString(),Vt=this.logSDPExchange(b,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:b}),Vt==null||Vt($),await this.peerConnection.setRemoteDescription({type:"answer",sdp:$})}catch(g){throw new TE(rE.EXCHANGE_SDP_FAILED,g.toString())}}async updateSendParameters(s,d){const g=this.peerConnection.getTransceivers().filter(b=>b.mid===s);g.length===1&&(this.isVP8Simulcast(d)?H_()||await this.applySimulcastEncodings(g,[d]):await this.applySendEncodings(g,[d]))}setStatsRemoteVideoIsReady(s,d){this.statsFilter.setVideoIsReady2(s,d)}async replaceTrack(s,d){const g=this.peerConnection.getTransceivers().find(b=>b.mid===d);g&&await g.sender.replaceTrack(s._mediaStreamTrack)}async getSelectedCandidatePair(){const s=this.peerConnection.getReceivers();if(s.length>0&&s[0].transport&&s[0].transport.iceTransport&&s[0].transport.iceTransport.getSelectedCandidatePair&&s[0].transport.iceTransport.getSelectedCandidatePair()){const d=s[0].transport.iceTransport,{local:g,remote:b}=d.getSelectedCandidatePair();return{local:EI(EI({},TR),{},{candidateType:g.type,protocol:g.protocol,address:g.address,port:g.port}),remote:EI(EI({},TR),{},{candidateType:b.type,protocol:b.protocol,address:b.address,port:b.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var s,d;KE(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(d=this.onICEConnectionStateChange)===null||d===void 0||d.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var s;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=s=>{if(s.candidate){var d;s.candidate.candidate&&((d=this.onLocalCandidate)===null||d===void 0||d.call(this,s.candidate.toJSON())),this.localCandidateCount+=1}else _l.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(s,d){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const b={iceServers:[]};var $;return s.iceServers?b.iceServers=s.iceServers:s.turnServer&&s.turnServer.mode!=="off"&&(jO(s.turnServer.servers)?b.iceServers=s.turnServer.servers:(b.iceServers&&b.iceServers.push(...CN.turnServerConfigToIceServers(s.turnServer.servers,d,g)),cE("USE_TURN_SERVER_OF_GATEWAY")&&b.iceServers&&s.turnServer.serversFromGateway&&b.iceServers.push(...CN.turnServerConfigToIceServers(s.turnServer.serversFromGateway,d,g)),KE($=[GI.Relay,GI.SdRtn]).call($,d)&&(b.iceTransportPolicy="relay"),cE("FORCE_TURN_TCP")?b.iceTransportPolicy="relay":s.turnServer.servers.concat(s.turnServer.serversFromGateway||[]).forEach(Vt=>{Vt.forceturn&&(b.iceTransportPolicy="relay")}))),cE("ENABLE_ENCODED_TRANSFORM")&&R_().supportWebRTCEncodedTransform&&(b.encodedInsertableStreams=!0),_l.debug("P2PConnection p2pTransport is ".concat(d)),b}static turnServerConfigToIceServers(s,d){let g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const b=[],$=s.filter(zt=>zt.tcpport);_l.debug("P2PConnection turnServers is ".concat($,", current index is ").concat(g));const Vt=$.length>g?$[g]:$[0];switch(d){case GI.SdRtn:const zt=s.filter(_r=>{var _o;return KE(_o=_r.username).call(_o,"glb:")&&_r.turnServerURL==_r.turnServerURL}),_e=zt.length>g?zt[g]:zt[0];_e&&(b.push({username:_e.username,credential:_e.password,credentialType:"password",urls:"turn:".concat(aI(_e.turnServerURL),":").concat(_e.tcpport,"?transport=udp")}),b.push({username:_e.username,credential:_e.password,credentialType:"password",urls:"turns:".concat(aI(_e.turnServerURL),":").concat(_e.tcpport,"?transport=tcp")}));break;case GI.Relay:Vt&&(b.push({username:Vt.username,credential:Vt.password,credentialType:"password",urls:"turn:".concat(Vt.turnServerURL,":").concat(Vt.tcpport,"?transport=udp")}),b.push({username:Vt.username,credential:Vt.password,credentialType:"password",urls:"turns:".concat(aI(Vt.turnServerURL),":").concat(Vt.tcpport,"?transport=tcp")}));break;default:Vt&&(b.push({username:Vt.username,credential:Vt.password,credentialType:"password",urls:"turn:".concat(Vt.turnServerURL,":").concat(Vt.tcpport,"?transport=udp")}),b.push({username:Vt.username,credential:Vt.password,credentialType:"password",urls:"turns:".concat(aI(Vt.turnServerURL),":").concat(Vt.tcpport,"?transport=tcp")}),b.push({username:Vt.username,credential:Vt.password,credentialType:"password",urls:"stun:".concat(Vt.turnServerURL,":").concat(Vt.tcpport)}))}return b}tryBindTransportEvents(s){if(s){this.transport=s,s.onstatechange=()=>{var g;s!=null&&s.state&&((g=this.onDTLSTransportStateChange)===null||g===void 0||g.call(this,s.state))},s.onerror=g=>{var b;(b=this.onDTLSTransportError)===null||b===void 0||b.call(this,"error"in g?g.error:g)};const d=s.iceTransport;d&&(d.onstatechange=()=>{const g=s==null?void 0:s.iceTransport.state;var b;g&&((b=this.onICETransportStateChange)===null||b===void 0||b.call(this,g))},d.getSelectedCandidatePair&&(d.onselectedcandidatepairchange=()=>{if(d.getSelectedCandidatePair()){const{local:g,remote:b}=d.getSelectedCandidatePair();_l.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:g.type,protocol:g.protocol}),", remote ").concat(JSON.stringify({candidateType:b.type,protocol:b.protocol,address:b.address,port:b.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(s,d){var g;if(d||(d=this.peerConnection.getSenders().find(_o=>_o.track===s._mediaStreamTrack)),!d)return _l.warn("[".concat(s.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(s))return _l.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!R_().supportSetRtpSenderParameters)return _l.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const b={},$={};switch(s._optimizationMode){case"motion":b.degradationPreference="maintain-framerate";break;case"detail":b.degradationPreference="maintain-resolution";break;default:b.degradationPreference="balanced"}if(s._encoderConfig){var Vt;const{bitrateMax:_o,frameRate:ga,scaleResolutionDownBy:_a}=s._encoderConfig;_o&&($.maxBitrate=1e3*_o),KE(Vt=s._hints).call(Vt,Z_.LOW_STREAM)&&(ga&&($.maxFramerate=kT(ga)),_a&&_a>=1&&($.scaleResolutionDownBy=_a))}if(cE("DSCP_TYPE")&&tI()){var zt;const _o=cE("DSCP_TYPE");KE(zt=["very-low","low","medium","high"]).call(zt,_o)&&($.networkPriority=_o)}const _e=d.getParameters(),_r=(g=_e.encodings)===null||g===void 0?void 0:g[0];H_()&&!_r&&(b.encodings=[$]),_r&&Object.assign(_r,$),Object.assign(_e,b),_l.debug("[".concat(s.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_e.encodings))),await d.setParameters(_e)}async applySendEncodings(s,d){try{if(!R_().supportSetRtpSenderParameters||s.length!==d.length)return;for(let g=0;g<s.length;g++){const b=s[g],$=d[g];$ instanceof Y_&&!this.isVP8Simulcast($)&&await this.updateRtpSenderEncodings($,b.sender)}}catch{_l.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(s,d,g){const b=iS.parse(s);return d.forEach(($,Vt)=>{const zt=g[Vt],_e=b.mediaDescriptions.find(_r=>_r.attributes.mid===zt);_e&&(mI(_e,$),dG(_e,$,this.store.codec))}),iS.print(b)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=s=>{var d;(d=this.onFirstAudioReceived)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstVideoReceived=s=>{var d;(d=this.onFirstVideoReceived)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstAudioDecoded=s=>{var d;(d=this.onFirstAudioDecoded)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstVideoDecoded=(s,d,g)=>{var b;(b=this.onFirstVideoDecoded)===null||b===void 0||b.call(this,s,d,g)},this.statsFilter.onSelectedLocalCandidateChanged=(s,d)=>{var g;(g=this.onSelectedLocalCandidateChanged)===null||g===void 0||g.call(this,s,d)},this.statsFilter.onSelectedRemoteCandidateChanged=(s,d)=>{var g;(g=this.onSelectedRemoteCandidateChanged)===null||g===void 0||g.call(this,s,d)},this.statsFilter.onFirstVideoDecodedTimeout=s=>{var d;(d=this.onFirstVideoDecodedTimeout)===null||d===void 0||d.call(this,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(s,d){if(s.length===d.length)for(let _e=0;_e<s.length;_e++){var g,b,$,Vt,zt;const _r=s[_e],_o=d[_e];if(_o instanceof Y_&&!KE(g=_o._hints).call(g,Z_.LOW_STREAM)&&(b=_o._encoderConfig)!==null&&b!==void 0&&b.bitrateMax&&(($=_o._encoderConfig)===null||$===void 0?void 0:$.bitrateMax)>200&&(Vt=_o._scalabilityMode)!==null&&Vt!==void 0&&Vt.numSpatialLayers&&((zt=_o._scalabilityMode)===null||zt===void 0?void 0:zt.numSpatialLayers)>1&&this.store.codec==="vp8"){const ga={},_a={high:1e3*(_o._encoderConfig.bitrateMax-50),medium:5e4};ga.encodings=[{rid:"m",active:!0,maxBitrate:_a.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_a.high}];const _c=_r.sender.getParameters();await _r.sender.setParameters(Object.assign(_c,ga))}}}async applySimulcastEncodings(s,d){if(!H_()&&s.length===d.length)for(let g=0;g<s.length;g++){const b=d[g];if(b instanceof Y_&&this.isVP8Simulcast(b)){const $=s[g],Vt={},zt={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};Vt.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:zt.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:zt.medium,scaleResolutionDownBy:4}];const _e=$.sender.getParameters();await $.sender.setParameters(Object.assign(_e,Vt))}}}isVP8Simulcast(s){var d,g,b,$,Vt;return!!(s instanceof Y_&&cE("SIMULCAST")&&this.store.codec==="vp8"&&!KE(d=s._hints).call(d,Z_.LOW_STREAM)&&(g=s._encoderConfig)!==null&&g!==void 0&&g.bitrateMax&&((b=s._encoderConfig)===null||b===void 0?void 0:b.bitrateMax)>200&&($=s._scalabilityMode)!==null&&$!==void 0&&$.numSpatialLayers&&((Vt=s._scalabilityMode)===null||Vt===void 0?void 0:Vt.numSpatialLayers)>1)}logSDPExchange(s,d,g,b){if(cE("SDP_LOGGING"))return _l.upload("[".concat(this.store.clientId,"] exchanging ").concat(g," ").concat(d," SDP during P2PConnection.").concat(b,`
`),s),d==="offer"?$=>{this.logSDPExchange($,"answer",g==="local"?"remote":"local",b)}:void 0}async muteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const d=this.peerConnection.getTransceivers().filter(Vt=>Vt.mid&&s.indexOf(Vt.mid)!==-1);if(d.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length.");d.map(Vt=>{Vt.direction="inactive"});const g=await this.peerConnection.createOffer(),b=this.logSDPExchange(g.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(g),this.remoteSDP.muteRemote(s);const $=this.remoteSDP.toString();b==null||b($),await this.setRemoteDescription({type:"answer",sdp:$})}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(d.toString()))}}async unmuteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const d=this.peerConnection.getTransceivers().filter(Vt=>Vt.mid&&s.indexOf(Vt.mid)!==-1);if(d.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length.");d.map(async Vt=>{Vt.direction="sendonly"});const g=await this.peerConnection.createOffer(),b=this.logSDPExchange(g.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(g),this.remoteSDP.unmuteRemote(s);const $=this.remoteSDP.toString();b==null||b($),await this.setRemoteDescription({type:"answer",sdp:$})}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(d.toString()))}}async getRemoteSSRC(s,d){var g,b;if(d=(g=d)!==null&&g!==void 0?g:(b=this.currentRemoteDescription)===null||b===void 0?void 0:b.sdp){var $;const Vt=($=iS.parse(d).mediaDescriptions.find(zt=>zt.attributes.mid===s))===null||$===void 0?void 0:$.attributes.ssrcs;return Vt==null?void 0:Vt[0].ssrcId}}async setRemoteDescription(s){var d;await this.peerConnection.setRemoteDescription(s),KE(d=["connected","completed"]).call(d,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(s,d,g){const b=iS.parse(s),$=b.mediaDescriptions.find(Vt=>Vt.attributes.mid===d);return $&&g===_g.AUDIO&&$.media.mediaType==="audio"&&Q0($),iS.print(b)}},BE(_v.prototype,"establish",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"establish"),_v.prototype),BE(_v.prototype,"connect",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"connect"),_v.prototype),BE(_v.prototype,"receive",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"receive"),_v.prototype),BE(_v.prototype,"mockReceive",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"mockReceive"),_v.prototype),BE(_v.prototype,"stopReceiving",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"stopReceiving"),_v.prototype),BE(_v.prototype,"restartICE",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"restartICE"),_v.prototype),BE(_v.prototype,"close",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"close"),_v.prototype),BE(_v.prototype,"updateEncoderConfig",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"updateEncoderConfig"),_v.prototype),BE(_v.prototype,"updateSendParameters",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"updateSendParameters"),_v.prototype),BE(_v.prototype,"replaceTrack",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"replaceTrack"),_v.prototype),BE(_v.prototype,"muteLocal",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"muteLocal"),_v.prototype),BE(_v.prototype,"unmuteLocal",[L0],Object.getOwnPropertyDescriptor(_v.prototype,"unmuteLocal"),_v.prototype),_v);function L0(o,s,d){const g=o[s];if(typeof g!="function")throw new Error("Cannot use mutex on object property.");return d.value=async function(){const b=this.mutex,$=await b.lock("From P2PConnection.".concat(s));try{for(var Vt=arguments.length,zt=new Array(Vt),_e=0;_e<Vt;_e++)zt[_e]=arguments[_e];return await g.apply(this,zt)}finally{$()}},d}function fG(o,s){let d=document.createElement("video"),g=document.createElement("canvas");d.setAttribute("style","display:none"),g.setAttribute("style","display:none"),d.setAttribute("muted",""),d.muted=!0,d.setAttribute("autoplay",""),d.autoplay=!0,d.setAttribute("playsinline",""),g.width=kT(s.width),g.height=kT(s.height);const b=kT(s.framerate||15);document.body.append(d),document.body.append(g);let $=o._mediaStreamTrack;d.srcObject=new MediaStream([$]),d.play();const Vt=g.getContext("2d");if(!Vt)throw new EE(rE.UNEXPECTED_ERROR,"can not get canvas context");const zt=R_(),_e=g.captureStream(zt.supportRequestFrame?0:b).getVideoTracks()[0];_e.canvas||(_e.canvas=g),g.startCapture=()=>{if(!d)return g.stopCapture&&g.stopCapture();if(d.paused&&d.play(),d.videoHeight>2&&d.videoWidth>2){const _o=d.videoWidth,ga=d.videoHeight/_o,_a=g.width*ga;Math.abs(_a-g.height)>=2&&(_l.debug("adjust low stream resolution","".concat(g.width,"x").concat(g.height," -> ").concat(g.width,"x").concat(_a)),g.height=_a)}Vt.drawImage(d,0,0,g.width,g.height),_e.requestFrame&&_e.requestFrame(),$!==o._mediaStreamTrack&&($=o._mediaStreamTrack,d.srcObject=new MediaStream([$]))},g.stopCapture=XF(()=>g.startCapture&&g.startCapture(),b);const _r=_e.stop;return _e.stop=()=>{_r.call(_e),d&&(d.remove(),d.srcObject=null,d=null),g&&(g.width=0,g.remove(),g.stopCapture&&g.stopCapture(),g.startCapture=void 0,g.stopCapture=void 0,g=null),_l.debug("clean low stream renderer")},_e}var RL=function(o){return o[o.HEIGHT=2033]="HEIGHT",o[o.FRAME_RATE=2034]="FRAME_RATE",o[o.WIDTH=2035]="WIDTH",o}(RL||{}),HS=function(o){return o[o.FRAME_RATE=2002]="FRAME_RATE",o[o.WIDTH=2003]="WIDTH",o[o.HEIGHT=2004]="HEIGHT",o[o.PACKAGE_LOST=2005]="PACKAGE_LOST",o[o.AVG_ENCODE=2007]="AVG_ENCODE",o[o.NACKS=2009]="NACKS",o[o.PLIS=2010]="PLIS",o[o.FIRS=2011]="FIRS",o[o.BITRATE=2012]="BITRATE",o[o.PACKAGE_RATE=2031]="PACKAGE_RATE",o[o.ADAPTATION=2032]="ADAPTATION",o[o.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",o[o.BANDWIDTH=2061]="BANDWIDTH",o[o.RETRANSMIT=2062]="RETRANSMIT",o[o.TARGET_ENCODED=2064]="TARGET_ENCODED",o[o.TRANSMIT=2066]="TRANSMIT",o[o.FREEZE=2082]="FREEZE",o[o.DISABLED=2095]="DISABLED",o[o.PLAYER_STATUS=2128]="PLAYER_STATUS",o[o.QP_SUM=2143]="QP_SUM",o}(HS||{}),aO=function(o){return o[o.BITRATE=2069]="BITRATE",o[o.PACKAGE_LOST=2070]="PACKAGE_LOST",o[o.PACKAGE_RATE=2071]="PACKAGE_RATE",o[o.HEIGHT=2073]="HEIGHT",o[o.FRAME_RATE=2075]="FRAME_RATE",o[o.WIDTH=2077]="WIDTH",o}(aO||{}),uT=function(o){return o[o.JITTER=-1]="JITTER",o[o.PACKAGE_LOST=2014]="PACKAGE_LOST",o[o.WIDTH=2018]="WIDTH",o[o.HEIGHT=2019]="HEIGHT",o[o.FRAME_RATE=2020]="FRAME_RATE",o[o.JITTER_BUFFER=2023]="JITTER_BUFFER",o[o.CURRENT_DELAY=2024]="CURRENT_DELAY",o[o.NACKS=2026]="NACKS",o[o.PLIS=2027]="PLIS",o[o.FIRS=2028]="FIRS",o[o.BITRATE=2029]="BITRATE",o[o.PACKAGE_RATE=2078]="PACKAGE_RATE",o[o.FREEZE=2084]="FREEZE",o[o.DISABLED=2101]="DISABLED",o[o.PLAYER_STATUS=2129]="PLAYER_STATUS",o[o.QP_SUM=2144]="QP_SUM",o[o.I_FRAME_DELAY=2149]="I_FRAME_DELAY",o}(uT||{}),cO=function(o){return o[o.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",o[o.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",o[o.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",o[o.FREEZE_TIME=2109]="FREEZE_TIME",o[o.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",o[o.FREEZE_DURATION=2156]="FREEZE_DURATION",o}(cO||{}),K9=function(o){return o[o.PCM_LEVEL=2104]="PCM_LEVEL",o}(K9||{}),gI=function(o){return o[o.PACKAGE_LOST=-1]="PACKAGE_LOST",o[o.LEVEL=2038]="LEVEL",o[o.BITRATE=2039]="BITRATE",o[o.PACKAGE_RATE=2040]="PACKAGE_RATE",o[o.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",o[o.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",o[o.FREEZE=2081]="FREEZE",o[o.DISABLED=2096]="DISABLED",o}(gI||{}),M0=function(o){return o[o.BITRATE=2044]="BITRATE",o[o.PACKAGE_LOST=2045]="PACKAGE_LOST",o[o.PACKAGE_RATE=2046]="PACKAGE_RATE",o[o.CURRENT_DELAY=2047]="CURRENT_DELAY",o[o.JITTER_BUFFER=2054]="JITTER_BUFFER",o[o.JITTER=2055]="JITTER",o[o.FREEZE=2083]="FREEZE",o[o.DISABLED=2102]="DISABLED",o[o.PCM_LEVEL=2105]="PCM_LEVEL",o[o.PLAYER_STATUS=2130]="PLAYER_STATUS",o[o.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",o}(M0||{}),z9=function(o){return o[o.FREEZE_TIME=-1]="FREEZE_TIME",o[o.LEVEL=2043]="LEVEL",o}(z9||{}),l0=function(o){return o[o.RTT=2006]="RTT",o[o.CONN_TYPE=801]="CONN_TYPE",o}(l0||{});const BR=1e3,uO=3;function g_(o,s,d){d!=null&&Number.isFinite(d)&&(o[s]=Math.round(Math.max(0,d)))}function Y9(o){const s={[l0.CONN_TYPE]:0,[l0.RTT]:o.rtt};switch(o.selectedCandidatePair.localCandidate.candidateType){case"relay":{const d=o.selectedCandidatePair.localCandidate.relayProtocol;d==="udp"&&(s[l0.CONN_TYPE]=1),d==="tcp"&&(s[l0.CONN_TYPE]=3),d==="tls"&&(s[l0.CONN_TYPE]=4);break}case"srflx":s[l0.CONN_TYPE]=2}return s}function J9(o){let s=0;switch(o){case"none":s=0;break;case"cpu":s=1;break;case"bandwidth":s=2;break;case"other":s=3}return s}class X9 extends nS{constructor(s){super(),Qm(this,"store",void 0),Qm(this,"uploadWRTCStatsTimer",void 0),Qm(this,"uploadOutboundDenoiserStatsTimer",void 0),Qm(this,"uploadExtStatsTimer",void 0),Qm(this,"uploadExtUsageStatsTimer",void 0),Qm(this,"uploadInboundExtStatsTimer",void 0),Qm(this,"requestStats",void 0),Qm(this,"requestTransportStats",void 0),Qm(this,"requestLocalMedia",void 0),Qm(this,"requestRemoteMedia",void 0),Qm(this,"requestAllTracks",void 0),Qm(this,"requestVideoIsReady",void 0),Qm(this,"requestUploadStats",void 0),Qm(this,"requestUpload",void 0),Qm(this,"uploadOutboundStarted",!1),Qm(this,"uploadInboundStarted",!1),Qm(this,"uploadTransportStarted",!1),Qm(this,"uploadExtensionUsageStarted",!1),Qm(this,"lastRecvStats",void 0),Qm(this,"lastSendStats",void 0),Qm(this,"lastFullRecvStats",void 0),Qm(this,"lastFullSendStats",void 0),Qm(this,"needUploadRenderFreezeTime",!0),this.store=s}uploadWRTCStats(s){if(!this.requestStats||!this.requestUploadStats)return;let d,g;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(g=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!g&&this.uploadInboundStarted&&(g=this.requestStats(!0)),d||g){const b={};if(this.uploadTransportStarted&&d){const $=this.getTransportStats(d,g,s);$&&(b.misc=[$])}if(this.uploadOutboundStarted&&d){const $=this.getOutboundStats(d,s?this.lastSendStats:this.lastFullSendStats,s);$&&(b.outbound=[$])}if(this.uploadInboundStarted&&g){const $=this.getInboundStats(g,s?this.lastRecvStats:this.lastFullRecvStats,s);$&&(b.inbound=$)}this.requestUploadStats(b)}this.lastRecvStats=g,this.lastSendStats=d,s||(this.lastFullRecvStats=g,this.lastFullSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let s=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(s!==uO),++s===uO+1&&(s=1)},BR)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(s,d,g){if(!this.requestStats)return;if(g)return s.rtt==null?void 0:{addition:{[l0.RTT]:s.rtt,[l0.CONN_TYPE]:void 0}};const b=Y9(s);if(this.store.useP2P){if(d){const $=Y9(d);b[l0.CONN_TYPE]+=$[l0.CONN_TYPE]<<3}b[l0.CONN_TYPE]+=110}else b[l0.CONN_TYPE]+=100;return{addition:b}}getOutboundStats(s,d,g){if(!this.requestUploadStats||!this.requestLocalMedia)return;const b=this.requestLocalMedia();if(!b||b.length===0)return;let $,Vt,zt;return b.forEach(_e=>{let[_r,{track:_o,ssrcs:ga}]=_e;switch(_r){case ME.LocalVideoLowTrack:case ME.LocalVideoTrack:if(_r===ME.LocalVideoTrack){const _a=function(_p,_f,eE,iE,fE){const mE=_f.videoSend.find(JE=>JE.ssrc===_p);if(!mE)return;const _E={},{sentFrame:SE,inputFrame:wE}=mE;if(wE&&SE){const JE=wE.frameRate,b_=SE.frameRate;_E[HS.FREEZE]=function(L_,$_){let OS=!0;return OS=!(L_<=5)&&(L_<=10?$_<3:L_<=20?$_<4:$_<5),OS}(JE,b_)?1:0}if(g_(_E,HS.QP_SUM,mE.qpSumPerFrame),fE)return _E;switch(SE&&(g_(_E,HS.HEIGHT,SE.height),g_(_E,HS.WIDTH,SE.width),g_(_E,HS.FRAME_RATE,SE.frameRate)),_E[HS.DISABLED]=iE._originMediaStreamTrack&&!iE._originMediaStreamTrack.enabled||iE._mediaStreamTrack&&!iE._mediaStreamTrack.enabled?1:0,mE.adaptionChangeReason){case"none":_E[HS.ADAPTATION]=0;break;case"cpu":_E[HS.ADAPTATION]=1;break;case"bandwidth":_E[HS.ADAPTATION]=2;break;case"other":_E[HS.ADAPTATION]=3}let NE=0;mE.adaptionChangeReason&&(NE+=J9(mE.adaptionChangeReason)),_f.qualityLimitationReason&&(NE+=J9(_f.qualityLimitationReason)<<3),_E[HS.ADAPTATION]=NE,_E[HS.PLAYER_STATUS]=YF[iE._player?iE._player.videoElementStatus:"uninit"],g_(_E,HS.NACKS,mE.nacksCount),g_(_E,HS.PLIS,mE.plisCount),g_(_E,HS.FIRS,mE.firsCount),g_(_E,HS.AVG_ENCODE,mE.avgEncodeMs);const DE=eE&&eE.videoSend.find(JE=>JE.ssrc===_p);if(DE){let JE=fE?BR:BR*uO;DE.timestamp&&mE.timestamp&&(JE=mE.timestamp-DE.timestamp),DE.packets!=null&&mE.packets!=null&&g_(_E,HS.PACKAGE_RATE,1e3*(mE.packets-DE.packets)/JE),mE.packetsLost!=null&&DE.packetsLost!=null&&g_(_E,HS.PACKAGE_LOST,mE.packetsLost-DE.packetsLost),DE.bytes!=null&&mE.bytes!=null&&g_(_E,HS.BITRATE,8*(mE.bytes-DE.bytes)/JE)}return _E}(ga[0].ssrcId,s,d,_o,g),_c=g?null:function(_p,_f,eE){const iE=_f.videoSend.find(NE=>NE.ssrc===_p);if(!iE)return null;const fE={},mE=iE.inputFrame,_E=mE&&mE.height||eE&&eE.videoHeight||0,SE=mE&&mE.width||eE&&eE.videoWidth||0,wE=mE&&mE.frameRate||0;return g_(fE,RL.HEIGHT,_E),g_(fE,RL.WIDTH,SE),g_(fE,RL.FRAME_RATE,wE),fE}(ga[0].ssrcId,s,_o),tE=g?null:function(_p){const _f={};return g_(_f,HS.RETRANSMIT,_p.bitrate.retransmit),g_(_f,HS.TARGET_ENCODED,_p.bitrate.targetEncoded),g_(_f,HS.ACTUAL_ENCODED,_p.bitrate.actualEncoded),g_(_f,HS.TRANSMIT,_p.bitrate.transmit),g_(_f,HS.BANDWIDTH,_p.sendBandwidth),_f}(s);Vt=Object.assign({},_a,_c,tE)}else zt=g?void 0:function(_a,_c,tE){const _p=_c.videoSend.find(iE=>iE.ssrc===_a);if(!_p)return;const _f={},eE=_p.sentFrame;if(eE&&(g_(_f,aO.HEIGHT,eE.height),g_(_f,aO.WIDTH,eE.width),g_(_f,aO.FRAME_RATE,eE.frameRate)),tE){const iE=tE.videoSend.find(fE=>fE.ssrc===_a);if(iE){let fE=BR*uO;iE.timestamp&&_p.timestamp&&(fE=_p.timestamp-iE.timestamp),iE.packets!=null&&_p.packets!=null&&g_(_f,aO.PACKAGE_RATE,1e3*(_p.packets-iE.packets)/fE),_p.packetsLost!=null&&iE.packetsLost!=null&&g_(_f,aO.PACKAGE_LOST,_p.packetsLost-iE.packetsLost),iE.bytes!=null&&_p.bytes!=null&&g_(_f,aO.BITRATE,8*(_p.bytes-iE.bytes)/fE)}}return _f}(ga[0].ssrcId,s,d);break;case ME.LocalAudioTrack:$=g?void 0:function(_a,_c,tE,_p){const _f=_c.audioSend.find(_E=>_E.ssrc===_a);if(!_f)return;const eE={};eE[gI.DISABLED]=_p._originMediaStreamTrack&&!_p._originMediaStreamTrack.enabled||_p._mediaStreamTrack&&!_p._mediaStreamTrack.enabled?1:0;const iE=100*_p._source.getAccurateVolumeLevel(),fE=_f.inputLevel;if(fE!=null){const _E=Math.ceil(50*Math.log10(100*fE+1));g_(eE,gI.LEVEL,_E)}g_(eE,K9.PCM_LEVEL,iE),g_(eE,gI.AEC_RETURN_LOSS,_f.aecReturnLoss),g_(eE,gI.AEC_RETURN_LOSS_ENH,_f.aecReturnLossEnhancement),eE[gI.FREEZE]=0;const mE=tE&&tE.audioSend.find(_E=>_E.ssrc===_a);if(mE){let _E=BR*uO;mE.timestamp&&_f.timestamp&&(_E=_f.timestamp-mE.timestamp),mE.bytes!=null&&_f.bytes!=null&&g_(eE,gI.BITRATE,8*(_f.bytes-mE.bytes)/_E),mE.packets!=null&&_f.packets!=null&&g_(eE,gI.PACKAGE_RATE,1e3*(_f.packets-mE.packets)/_E)}return eE}(ga[0].ssrcId,s,d,_o)}}),{high:Vt,low:zt,audio:$}}getInboundStats(s,d,g){if(!this.requestRemoteMedia)return;const b=this.requestRemoteMedia()||[],$=[];return b.forEach(Vt=>{let[zt,_e]=Vt;const _r={peer:zt.uid};if(_e.has(_g.VIDEO)&&zt.videoTrack){const _o=zt._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(zt._videoSSRC)||!1,ga=zt.videoTrack?function(_a,_c,tE,_p,_f,eE,iE){var fE;const mE=_c.videoRecv.find(b_=>b_.ssrc===_a);if(!mE)return;const _E={},{receivedFrame:SE,outputFrame:wE,decodeFrameRate:NE}=mE,DE=tE&&tE.videoRecv.find(b_=>b_.ssrc===_a);if(_E[uT.FREEZE]=_f&&GP.isRemoteVideoFreeze(_p,mE,DE)?1:0,g_(_E,cO.FRAME_RATE_DECODE,NE),g_(_E,uT.QP_SUM,mE.qpSumPerFrame),mE.framesRateFirefox&&g_(_E,uT.FRAME_RATE,mE.framesRateFirefox),SE&&g_(_E,uT.FRAME_RATE,SE.frameRate),DE){const b_=_c.timestamp-tE.timestamp||(iE?BR:uO*BR);mE.packetsLost!=null&&DE.packetsLost!=null&&g_(_E,uT.PACKAGE_LOST,mE.packetsLost-DE.packetsLost),DE.bytes!=null&&mE.bytes!=null&&g_(_E,uT.BITRATE,8*(mE.bytes-DE.bytes)/b_),DE.packets!=null&&mE.packets!=null&&g_(_E,uT.PACKAGE_RATE,1e3*(mE.packets-DE.packets)/b_)}if(iE)return _E;SE?(g_(_E,uT.HEIGHT,SE.height),g_(_E,uT.WIDTH,SE.width)):_p&&(g_(_E,uT.HEIGHT,_p._videoHeight||0),g_(_E,uT.WIDTH,_p._videoWidth||0)),wE&&g_(_E,cO.FRAME_RATE_OUTPUT,wE.frameRate);const JE=(fE=_p._player)===null||fE===void 0?void 0:fE.rendFrameRate.toFixed(0);if(JE&&g_(_E,cO.FRAME_RATE_RENDER,+JE),g_(_E,uT.JITTER_BUFFER,mE.jitterBufferMs),g_(_E,uT.CURRENT_DELAY,mE.currentDelayMs),g_(_E,uT.FIRS,mE.firsCount),g_(_E,uT.NACKS,mE.nacksCount),g_(_E,uT.PLIS,mE.plisCount),_p){_E[uT.DISABLED]=_p._originMediaStreamTrack.enabled&&_p._mediaStreamTrack.enabled?0:1;const b_=_p._player;if(b_){const{freezeTimeCounterList:L_,renderFreezeAccTime:$_,videoElementStatus:OS}=b_;if(L_&&L_.length>0&&g_(_E,cO.FREEZE_TIME,L_.splice(0,1)[0]),eE&&FR.visibility==="visible"&&OS===fT.PLAYING&&R_().supportRequestVideoFrameCallback){const lS=Math.min(6e3,$_);b_.renderFreezeAccTime=Math.max(0,$_-lS),g_(_E,cO.FREEZE_TIME_RENDER,lS)}if(typeof mE.totalFreezesDuration=="number"){const lS=DE&&DE.totalFreezesDuration?mE.totalFreezesDuration-DE.totalFreezesDuration:mE.totalFreezesDuration;g_(_E,cO.FREEZE_DURATION,1e3*lS)}}}if(_E[uT.PLAYER_STATUS]=YF[_p._player?_p._player.videoElementStatus:"uninit"],DE&&mE.totalInterFrameDelay!==void 0&&mE.totalSquaredInterFrameDelay!==void 0&&DE.totalInterFrameDelay!==void 0&&DE.totalSquaredInterFrameDelay!==void 0){const b_=mE.totalInterFrameDelay-DE.totalInterFrameDelay,L_=mE.totalSquaredInterFrameDelay-DE.totalSquaredInterFrameDelay,$_=mE.framesDecodeCount-DE.framesDecodeCount,OS=b_/$_*1e3,lS=Math.round(1e3*Math.sqrt((L_-Math.pow(b_,2)/$_)/$_));!isNaN(lS)&&OS+lS>Math.max(3*OS,OS+150)&&(_E[uT.I_FRAME_DELAY]=lS)}return _E}(zt._videoSSRC,s,d,zt.videoTrack,_o===!0,this.needUploadRenderFreezeTime,g):void 0;ga&&(_r.video=ga)}if(_e.has(_g.AUDIO)&&zt.audioTrack){const _o=zt.audioTrack?function(ga,_a,_c,tE,_p){const _f=_a.audioRecv.find(DE=>DE.ssrc===ga);if(!_f)return;const eE={},iE=_c&&_c.audioRecv.find(DE=>DE.ssrc===ga),{receivedFrames:fE,droppedFrames:mE}=_f;var _E,SE;if(g_(eE,M0.JITTER,_f.jitterMs),fE!=null&&mE!=null&&(eE[M0.FREEZE]=(SE=mE,(_E=fE)===0||100*SE/_E>20?1:0)),iE){const DE=_a.timestamp-_c.timestamp||(_p?BR:BR*uO);_f.packets!=null&&iE.packets!=null&&g_(eE,M0.PACKAGE_RATE,1e3*(_f.packets-iE.packets)/DE),iE.bytes!=null&&_f.bytes!=null&&g_(eE,M0.BITRATE,8*(_f.bytes-iE.bytes)/DE),_f.packetsLost!=null&&iE.packetsLost!=null&&g_(eE,M0.PACKAGE_LOST,_f.packetsLost-iE.packetsLost)}if(_p)return eE;const wE=100*tE._source.getAccurateVolumeLevel(),NE=_f.outputLevel;if(NE!=null){const DE=Math.ceil(50*Math.log10(100*NE+1));g_(eE,z9.LEVEL,DE)}if(g_(eE,M0.PCM_LEVEL,wE),tE&&(eE[M0.DISABLED]=tE._originMediaStreamTrack.enabled&&tE._mediaStreamTrack.enabled?0:1),g_(eE,M0.JITTER_BUFFER,_f.jitterBufferMs),g_(eE,M0.CURRENT_DELAY,_f.jitterBufferMs),eE[M0.PLAYER_STATUS]=YF[wT.getPlayerState(tE.getTrackId())],iE){const DE=_f.concealedSamples-iE.concealedSamples;DE>0&&g_(eE,M0.CONCEALED_SAMPLES,DE)}return eE}(zt._audioSSRC,s,d,zt.audioTrack,g):void 0;_o&&(_r.audio=_o)}(_r.video||_r.audio)&&$.push(_r)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,$}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const s=(this.requestAllTracks()||[]).find(d=>d instanceof mL);if(s&&s._external.getDenoiserStats){const d=s._external.getDenoiserStats();d&&this.requestUpload(qI.DENOISER_STATS,d)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(s=>{s.getProcessorStats().forEach(d=>{this.requestUpload&&this.requestUpload(d.type,d.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(s=>{let[d,g]=s;g.has(_g.VIDEO)&&d.videoTrack&&d.videoTrack.getProcessorStats().forEach(b=>{this.requestUpload&&this.requestUpload(b.type,b.stats)}),g.has(_g.AUDIO)&&d.audioTrack&&d.audioTrack.getProcessorStats().forEach(b=>{this.requestUpload&&this.requestUpload(b.type,b.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const s=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const d=Date.now(),g={connectionInterval:cE("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:d};let b=[];const $=this.requestAllTracks&&this.requestAllTracks()||[];for(const _r of $)!_r.muted&&_r.enabled&&(b=b.concat(await _r.getProcessorUsage()));const Vt=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[_r,_o]of Vt)_o.has(_g.VIDEO)&&_r.videoTrack&&(b=b.concat(await _r.videoTrack.getProcessorUsage())),_o.has(_g.AUDIO)&&_r.audioTrack&&(b=b.concat(await _r.audioTrack.getProcessorUsage()));if(b.length===0)return;g.details=function(_r,_o){const ga={};for(const{id:_p,value:_f,level:eE,direction:iE}of _r){var _a;const fE=(_a=_o.get(_p))!==null&&_a!==void 0?_a:0,mE=_f===2?fE+cE("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:fE;var _c,tE;_o.set(_p,mE),ga[_p]?(_f===2&&(ga[_p].value=_f),eE>ga[_p].level&&(ga[_p].level=eE),iE==="remote"&&(ga[_p].remoteUidCount+=1),ga[_p].totalTs=(_c=_o.get(_p))!==null&&_c!==void 0?_c:0):ga[_p]={value:_f,level:eE,remoteUidCount:iE==="local"?0:1,totalTs:(tE=_o.get(_p))!==null&&tE!==void 0?tE:0}}return Object.keys(ga).map(_p=>{const{level:_f,value:eE,totalTs:iE}=ga[_p];return{id:_p,level:_f,value:eE,totalTs:iE}})}(b,s);const zt=Date.now(),_e=zt>d?zt:d+1;this.requestUpload&&this.requestUpload(qI.EXTENSION_USAGE_STATS,{usageStats:g,sendTs:_e})},cE("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class _I{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(s,d){Qm(this,"uid",void 0),Qm(this,"_uintid",void 0),Qm(this,"_trust_in_room_",!0),Qm(this,"_trust_audio_enabled_state_",!0),Qm(this,"_trust_video_enabled_state_",!0),Qm(this,"_trust_audio_mute_state_",!0),Qm(this,"_trust_video_mute_state_",!0),Qm(this,"_audio_muted_",!1),Qm(this,"_video_muted_",!1),Qm(this,"_audio_enabled_",!0),Qm(this,"_video_enabled_",!0),Qm(this,"_audio_added_",!1),Qm(this,"_video_added_",!1),Qm(this,"_is_pre_created",!1),Qm(this,"_video_pre_subscribed",!1),Qm(this,"_audio_pre_subscribed",!1),Qm(this,"_trust_video_stream_added_state_",!0),Qm(this,"_trust_audio_stream_added_state_",!0),Qm(this,"_audioTrack",void 0),Qm(this,"_videoTrack",void 0),Qm(this,"_dataChannels",[]),Qm(this,"_audioSSRC",void 0),Qm(this,"_videoSSRC",void 0),Qm(this,"_audioOrtc",void 0),Qm(this,"_videoOrtc",void 0),Qm(this,"_cname",void 0),Qm(this,"_rtxSsrcId",void 0),Qm(this,"_videoMid",void 0),Qm(this,"_audioMid",void 0),this.uid=s,this._uintid=d}}let Z0=function(o){return o.SEND_ONLY="SEND_ONLY",o.RECEIVE_ONLY="RECEIVE_ONLY",o}({});function lht(o,s){var d;let g;switch(s){case ME.LocalAudioTrack:g=x_.Audio;break;case ME.LocalVideoTrack:g=KE(d=o._hints).call(d,Z_.SCREEN_TRACK)?x_.Screen:x_.High;break;case ME.LocalVideoLowTrack:g=x_.Low}return g}function mG(o){const s=R_();if(o.some(d=>d._bypassWebAudio))throw new TE(rE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!s.webAudioMediaStreamDest)throw new TE(rE.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function EG(o,s){mG(o);const d=new jS;return o.forEach(g=>d.addAudioTrack(g)),d}var Q9,Z9,$9,tJ,eJ,nJ,rJ,iJ,oJ,sJ,aJ,oS;function cJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function CL(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?cJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):cJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}let GT=(Q9=$0(Z0.SEND_ONLY),Z9=$0(Z0.SEND_ONLY),$9=$0(),tJ=$0(Z0.RECEIVE_ONLY),eJ=$0(Z0.RECEIVE_ONLY),nJ=$0(Z0.RECEIVE_ONLY),rJ=$0(Z0.RECEIVE_ONLY),iJ=$0(Z0.RECEIVE_ONLY),oJ=$0(Z0.RECEIVE_ONLY),sJ=$0(),aJ=$0(Z0.RECEIVE_ONLY),oS=class extends nS{get state(){return this._state}set state(o){const s=this._state;this._state=o,this.emit(a_.StateChange,s,this._state)}constructor(o,s){super(),Qm(this,"store",void 0),Qm(this,"statsUploader",void 0),Qm(this,"sendConnection",void 0),Qm(this,"recvConnection",void 0),Qm(this,"localTrackMap",new Map),Qm(this,"remoteUserMap",new Map),Qm(this,"localDataChannels",[]),Qm(this,"pendingLocalTracks",[]),Qm(this,"pendingRemoteTracks",[]),Qm(this,"statsCollector",void 0),Qm(this,"dtlsFailedCount",0),Qm(this,"sendMutex",new KS("P2PChannel2-send-mutex")),Qm(this,"recvMutex",new KS("P2PChannel2-recv-mutex")),Qm(this,"_state",j_.Disconnected),Qm(this,"_restartStates",["disconnected","failed"]),Qm(this,"reconnectInterval",void 0),Qm(this,"uploadUnplinkStarted",!1),Qm(this,"uploadDownlinkStarted",!1),Qm(this,"uplinkStateUploadInterval",void 0),Qm(this,"downlinkStatsUploadInterval",void 0),Qm(this,"handleMuteLocalTrack",async(d,g,b)=>{const $=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==j_.Connected)return void b(new TE(rE.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _e=this.filterTobeMutedTracks(d);if(_e.length===0)return void g();const _r=_e.find(_c=>_c[0]==="videoLowTrack");_r&&_r[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_e.map(_c=>{let[,{id:tE}]=_c;return tE}));let _o=!1;var Vt,zt;d.trackMediaType==="video"?_o=!((Vt=this.localTrackMap.get(ME.LocalAudioTrack))===null||Vt===void 0||!Vt.track._muted):_o=((zt=this.localTrackMap.get(ME.LocalVideoTrack))===null||zt===void 0?void 0:zt.id)===void 0;const ga=this.createMuteMessage(_e);await K_(this,a_.RequestMuteLocal,ga);const _a=d.trackMediaType==="video"?sI.MUTE_LOCAL_VIDEO:sI.MUTE_LOCAL_AUDIO;await K_(this,a_.RequestP2PMuteLocal,{action:_a,message:ga,isMuteAll:_o}),g()}catch(_e){b(_e)}finally{$()}}),Qm(this,"handleUnmuteLocalTrack",async(d,g,b)=>{const $=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==j_.Connected)return void b(new TE(rE.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const Vt=this.filterTobeUnmutedTracks(d);if(Vt.length===0)return void g();await this.sendConnection.unmuteLocal(Vt.map(_r=>{let[,{id:_o}]=_r;return _o}));const zt=this.createUnmuteMessage(Vt),_e=d.trackMediaType==="video"?sI.UNMUTE_LOCAL_VIDEO:sI.UNMUTE_LOCAL_AUDIO;await K_(this,a_.RequestP2PMuteLocal,{action:_e,message:zt}),g()}catch(Vt){b(Vt)}finally{$()}}),Qm(this,"handleUpdateVideoEncoder",async(d,g,b)=>{const $=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const Vt=this.localTrackMap.get(ME.LocalVideoTrack);if(!this.sendConnection||!Vt||Vt.track!==d||this.state!==j_.Connected)return void g();const{id:zt,track:_e}=Vt;zt&&(await this.sendConnection.updateSendParameters(zt,_e),await this.sendConnection.updateEncoderConfig(zt,_e),this.emit(a_.UpdateVideoEncoder,_e)),g()}catch(Vt){b(Vt)}finally{$()}}),Qm(this,"handleUpdateVideoSendParameters",async(d,g,b)=>{const $=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const Vt=this.localTrackMap.get(ME.LocalVideoTrack);if(!this.sendConnection||!Vt||Vt.track!==d||this.state!==j_.Connected)return void g();const{id:zt,track:_e}=Vt;zt&&await this.sendConnection.updateSendParameters(zt,_e),g()}catch(Vt){b(Vt)}finally{$()}}),Qm(this,"handleReplaceTrack",async(d,g,b,$)=>{let Vt;_l.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),typeof $=="boolean"&&$||(Vt=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var zt;const _r=Array.from(this.localTrackMap.entries()).find(_o=>{let[,{track:ga}]=_o;return d===ga});if(!this.sendConnection||!_r||_r[1].id===void 0||this.state!==j_.Connected)return void g();if(await((zt=this.sendConnection)===null||zt===void 0?void 0:zt.replaceTrack(d,_r[1].id)),_r[0]===ME.LocalVideoTrack&&R_().supportDualStreamEncoding){const _o=this.localTrackMap.get(ME.LocalVideoLowTrack);if(_o){const ga=d._mediaStreamTrack.clone();_o.track._originMediaStreamTrack.stop(),_o.track._mediaStreamTrack=ga,_o.track._originMediaStreamTrack=ga,await new GE((_a,_c)=>{this.handleReplaceTrack(_o.track,_a,_c,!0)})}}g()}catch(_r){b(_r)}finally{var _e;(_e=Vt)===null||_e===void 0||_e()}}),Qm(this,"handleGetLocalVideoStats",d=>{d(this.statsCollector.getLocalVideoTrackStats())}),Qm(this,"handleGetLocalAudioStats",d=>{d(this.statsCollector.getLocalAudioTrackStats())}),Qm(this,"handleGetRemoteVideoStats",d=>this.statsCollector.getRemoteVideoTrackStats(d.uid)[d.uid]),Qm(this,"handleGetRemoteAudioStats",d=>this.statsCollector.getRemoteAudioTrackStats(d.uid)[d.uid]),this.store=o,this.statsCollector=s,this.statsCollector.addP2PChannel(this),this.statsUploader=new X9(o),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(d=>{d&&(d.iceConnectionState!=="disconnected"&&d.iceConnectionState!=="failed"||this.handleDisconnect(d.direction))})},cE("ICE_RESTART_INTERVAL"))}async startP2PConnection(o,s){throw new TE(rE.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(o,s,d,g,b,$){throw new TE(rE.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(o,s){let d;try{if(s){this.recvConnection&&(_l.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),d=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new H9(o,this.store,vT.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const g=await this.recvConnection.establish(s);return{iceParameters:g.iceParameters,dtlsParameters:g.dtlsParameters,sdp:g.sdp}}{this.state=j_.New,this.sendConnection&&(_l.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),d=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new H9(o,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const g=await this.sendConnection.establish();return{iceParameters:g.iceParameters,dtlsParameters:g.dtlsParameters,sdp:g.sdp}}}finally{d&&d()}}async p2pConnect(o){if(!this.sendConnection)throw new TE(rE.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(o),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=j_.Connected}async addRemoteCandidate(o,s){if(s===vT.RECEIVE_ONLY){if(!this.sendConnection)throw new TE(rE.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(o)}else{if(!this.recvConnection)throw new TE(rE.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(o)}}publish(o,s,d){var g=this;return BT(function*(){const b=yield f_(g.sendMutex.lock("From P2PChannel.publish"));try{if(!g.sendConnection||g.state!==j_.Connected){g.throwIfTrackTypeNotMatch(o);const _r=o.filter(_o=>g.pendingLocalTracks.indexOf(_o)===-1);return void(g.pendingLocalTracks=g.pendingLocalTracks.concat(_r))}g.store.pubId=g.store.pubId+1,aT.markPublishStart(g.store.clientId,g.store.pubId);const $=g.filterTobePublishedTracks(o,s,d);if($.length===0)return void(yield f_(g.tryToUnmuteAudio(o)));$.forEach(_r=>{let{track:_o,type:ga}=_r;const _a=Date.now();g.store.publish(_o.getTrackId(),ga===ME.LocalAudioTrack?"audio":"video",_a)}),g.bindLocalTrackEvents($);const Vt=yield f_(g.sendConnection.send($.map(_r=>{let{track:_o}=_r;return _o}),g.store.codec,g.store.audioCodec)),zt=(yield f_(Vt.next())).value,_e=g.createGatewayPublishMessage($,zt);try{yield _e}catch(_r){throw Vt.throw(_r),(_r==null?void 0:_r.code)===rE.WS_ABORT&&$.forEach(_o=>{let{track:ga}=_o;g.pendingLocalTracks.indexOf(ga)===-1&&g.pendingLocalTracks.push(ga)}),g.unbindLocalTrackEvents($),_r}yield f_(Vt.next()),$.forEach(_r=>{let{type:_o}=_r;g.statsCollector.addLocalStats(_o)}),g.statsUploader.startUploadOutboundStats(),g.assignLocalTracks($,zt),$.forEach(_r=>{let{track:_o,type:ga}=_r;const _a=Date.now();g.store.publish(_o.getTrackId(),ga===ME.LocalAudioTrack?"audio":"video",void 0,_a)}),g.startUploadUplinkState()}finally{b()}})()}async unpublish(o){if(!this.sendConnection||this.state!==j_.Connected)return void(o.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(b=>!KE(o).call(o,b)));const s=this.filterTobeUnpublishedTracks(o);if(s.length===0)return;const d=s.find(b=>b[0]==="videoLowTrack");d&&d[1].track.close();const g=this.createGatewayUnpublishMessage(s);if(await this.sendConnection.stopSending(s.map(b=>{let[,{id:$}]=b;return $})),this.withdrawLocalTracks(s),this.unbindLocalTrackEvents(s.map(b=>{let[$,{track:Vt}]=b;return{type:$,track:Vt}})),s.forEach(b=>{let[$]=b;this.statsCollector.removeLocalStats($)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===j_.Connected)return d&&d[1].track.close(),g;o.forEach(b=>{const $=this.pendingLocalTracks.indexOf(b);$!==-1&&this.pendingLocalTracks.splice($,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const o=()=>{const s=[],d=[];Array.from(this.localTrackMap.entries()).forEach(g=>{let[b,{track:$,ssrcs:Vt}]=g;const zt={stream_type:lht($,b),ssrcs:Vt};$._muted||!$._enabled?s.push(zt):d.push(zt)}),s.length>0&&s.forEach(g=>{K_(this,a_.RequestMuteLocal,[g])}),d.length>0&&d.forEach(g=>{K_(this,a_.RequestUnmuteLocal,[g])})};o(),this.uplinkStateUploadInterval=window.setInterval(()=>{o()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(o){return BT(function*(){throw new TE(rE.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(_l.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await kS(this,a_.RequestRePublish,this.pendingLocalTracks),this.emit(a_.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new TE(rE.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(o,s,d,g){var b;if(!this.recvConnection)throw new TE(rE.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((b=this.remoteUserMap.get(o))!==null&&b!==void 0&&b.has(s))return;const{track:$,mid:Vt,transceiver:zt}=await this.recvConnection.receive(s,[{ssrcId:d}],String(o.uid),g);s===_g.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack($):(o._audioTrack=new mN($,o.uid,o._uintid,this.store),_l.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),zt&&o._audioTrack._updateRtpTransceiver(zt),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoSSRC=d,o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack($):(o._videoTrack=new fN($,o.uid,o._uintid,this.store),_l.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),zt&&o._videoTrack._updateRtpTransceiver(zt),this.bindRemoteTrackEvents(o,o._videoTrack));const _e=this.remoteUserMap.get(o);_e?_e.set(s,Vt):this.remoteUserMap.set(o,new Map([[s,Vt]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const _r=this.pendingRemoteTracks.findIndex(_o=>{let{user:ga,kind:_a}=_o;return ga.uid===o.uid&&s===_a});_r!==-1&&(this.pendingRemoteTracks.splice(_r,1),this.emit(a_.MediaReconnectEnd,o.uid))}async mockSubscribe(o,s,d,g){if(!this.recvConnection)throw new TE(rE.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(s,[{ssrcId:d}],String(o.uid),g)}async unsubscribe(o,s,d){const g=this.pendingRemoteTracks.filter($=>{let{user:Vt,kind:zt}=$;return s!==void 0?Vt.uid===o.uid&&s===zt:Vt.uid===o.uid});if(g.forEach($=>{const Vt=this.pendingRemoteTracks.indexOf($);this.pendingRemoteTracks.splice(Vt,1)}),this.recvConnection||d||g.forEach($=>{let{kind:Vt}=$;var zt;if(Vt===_g.AUDIO)(zt=o._audioTrack)===null||zt===void 0||zt._destroy(),o._audioTrack=void 0;else if(Vt===_g.VIDEO){var _e;(_e=o._videoTrack)===null||_e===void 0||_e._destroy(),o._videoTrack=void 0}}),!this.recvConnection)return;const b=this.filterTobeUnSubscribedTracks(o,s);b.length!==0&&(await this.recvConnection.stopReceiving(b.map($=>{let[,{id:Vt}]=$;return Vt})),this.withdrawRemoteTracks(b),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),b.forEach($=>{let[Vt,{kind:zt}]=$;var _e,_r;if(zt===_g.VIDEO&&Vt._videoSSRC&&((_e=this.recvConnection)===null||_e===void 0||_e.setStatsRemoteVideoIsReady(Vt._videoSSRC,!1)),zt===_g.VIDEO)this.unbindRemoteTrackEvents(Vt._videoTrack),d||((_r=Vt._videoTrack)===null||_r===void 0||_r._destroy(),Vt._videoTrack=void 0);else if(zt===_g.AUDIO){var _o;this.unbindRemoteTrackEvents(Vt._audioTrack),!d&&((_o=Vt._audioTrack)===null||_o===void 0||_o._destroy(),Vt._audioTrack=void 0)}}),b.forEach($=>{let[,{kind:Vt}]=$;K_(this,a_.RequestP2PMuteRemote,Vt)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const o=()=>Array.from(this.remoteUserMap.entries()).forEach(s=>{let[,d]=s;[_g.VIDEO,_g.AUDIO].forEach(g=>{d.has(g)?K_(this,a_.RequestP2PUnmuteRemote,g):K_(this,a_.RequestP2PMuteRemote,g)})});o(),this.downlinkStatsUploadInterval=window.setInterval(()=>{o()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(o){throw new TE(rE.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(o){throw new TE(rE.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(o){throw new TE(rE.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(o){throw new TE(rE.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(o,s){if(!this.recvConnection)return;const d=this.remoteUserMap.get(o);if(!d)return void _l.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(o.uid,"."));if(!d.get(s))return void _l.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(o.uid," media type ").concat(s,"."));const g=s===_g.VIDEO?o._videoSSRC:o._audioSSRC;g!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(g,!1)}async unmuteRemote(o,s){return this.unmuteRemoteNoLock(o,s)}async unmuteRemoteNoLock(o,s){if(!this.recvConnection)return;const d=this.remoteUserMap.get(o);if(!d)return void _l.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(o.uid,"."));d.get(s)||_l.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(o.uid," media type ").concat(s,"."))}getAllTracks(o){const s=this.localTrackMap.get(ME.LocalAudioTrack);if((s==null?void 0:s.track)instanceof jS){const d=s.track;return Array.from(this.localTrackMap.entries()).filter(g=>{let[b]=g;return b!==ME.LocalAudioTrack}).filter(g=>{let[b]=g;return!(o&&b===ME.LocalVideoLowTrack)}).map(g=>{let[,{track:b}]=g;return b}).concat(d.trackList)}return Array.from(this.localTrackMap.entries()).filter(d=>{let[g]=d;return!(o&&g===ME.LocalVideoLowTrack)}).map(d=>{let[,{track:g}]=d;return g})}reportPublishEvent(o,s,d,g,b){if(o){const Vt=this.localTrackMap.get(ME.LocalAudioTrack),zt=g?this.localTrackMap.get(ME.LocalVideoLowTrack):this.localTrackMap.get(ME.LocalVideoTrack);t_.publish(this.store.sessionId,{eventElapse:aT.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:o,ec:s,audioName:Vt==null?void 0:Vt.track.getTrackLabel(),videoName:zt==null?void 0:zt.track.getTrackLabel(),screenshare:(zt==null?void 0:zt.track._hints.indexOf(Z_.SCREEN_TRACK))!==-1,audio:!!Vt,video:!!zt,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}else{var $;d||(d=[]);const Vt=d.find(_e=>_e instanceof mS),zt=g?($=this.localTrackMap.get(ME.LocalVideoTrack))===null||$===void 0?void 0:$.track:d.find(_e=>_e instanceof Y_);t_.publish(this.store.sessionId,{eventElapse:aT.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:o,ec:s,audioName:Vt==null?void 0:Vt.getTrackLabel(),videoName:zt==null?void 0:zt.getTrackLabel(),screenshare:(zt==null?void 0:zt._hints.indexOf(Z_.SCREEN_TRACK))!==-1,audio:!!Vt,video:!!zt,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}}reportSubscribeEvent(o,s,d,g){const b=g===_g.VIDEO?d._videoSSRC:d._audioSSRC;b&&t_.subscribe(this.store.sessionId,{succ:o,ec:s,video:g===_g.VIDEO,audio:g===_g.AUDIO,peerid:d.uid,subscribeRequestid:g===_g.VIDEO?d._videoSSRC:d._audioSSRC,p2pid:this.store.p2pId,eventElapse:aT.measureFromSubscribeStart(this.store.clientId,b)})}reset(){_l.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new KS("P2PChannel2-send-mutex"),this.sendMutex=new KS("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const o=this.localTrackMap.get(ME.LocalAudioTrack);if((o==null?void 0:o.track)instanceof jS){if(o.track.trackList.length>0){const s=o.track;o.track.trackList.forEach(d=>{s.removeAudioTrack(d)})}o.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=j_.Disconnected}getStats(o){var s,d;return o?(d=this.recvConnection)===null||d===void 0?void 0:d.getStats():(s=this.sendConnection)===null||s===void 0?void 0:s.getStats()}getRemoteVideoIsReady(o){var s;return((s=this.recvConnection)===null||s===void 0?void 0:s.getRemoteVideoIsReady(o))||!1}getLocalAudioVolume(){const o=this.localTrackMap.get(ME.LocalAudioTrack);if(o)return o.track.getVolumeLevel()}getLocalVideoSize(){const o=this.localTrackMap.get(ME.LocalVideoTrack);if(o)return{width:o.track.videoWidth||0,height:o.track.videoHeight||0}}getEncoderConfig(o){const s=this.localTrackMap.get(o);return s&&s.track instanceof Y_||s&&s.track instanceof mS?s.track._encoderConfig:void 0}getLocalMedia(o){return this.localTrackMap.get(o)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(o,s){if(!o)return this.remoteUserMap.size>0;const d=this.remoteUserMap.get(o);return!!d&&(!s||d.has(s))}async hasRemoteMediaWithLock(o,s){if(!o)return this.remoteUserMap.size>0;const d=this.remoteUserMap.get(o);return!!d&&(!s||d.has(s))}getRemoteMedia(o){var s;const d=Array.from(qT(s=this.remoteUserMap).call(s)).find(g=>g.uid===o);return d?{audioTrack:d.audioTrack,audioSSRC:d._audioSSRC,videoTrack:d.videoTrack,videoSSRC:d._videoSSRC}:{}}getAudioLevels(){let o=Array.from(this.remoteUserMap.entries()).map(d=>{let[g]=d;return{uid:g.uid,level:g.audioTrack?100*g.audioTrack._source.getAccurateVolumeLevel():0}});const s=this.localTrackMap.get(ME.LocalAudioTrack);return s&&o.push({level:100*s.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),o=GN(o).call(o,(d,g)=>d.level-g.level),o}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(_l.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=j_.Reconnecting,cE("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s]=o;var d;s._videoTrack&&s._videoTrack._player&&((d=s._videoTrack._player.getVideoElement())===null||d===void 0||d.pause(),s._videoTrack._player.isKeepLastFrame=!0,s._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(o=>{var s;let[d,{track:g}]=o;switch(d){case ME.LocalVideoTrack:KE(s=g._hints).call(s,Z_.LOW_STREAM)?g.close():this.pendingLocalTracks.push(g);break;case ME.LocalAudioTrack:g instanceof jS?this.pendingLocalTracks=this.pendingLocalTracks.concat(g.trackList):this.pendingLocalTracks.push(g);case ME.LocalVideoLowTrack:}}),this.emit(a_.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s,d]=o;Array.from(qT(d).call(d)).forEach(g=>{this.setPendingRemoteMedia(s,g)}),this.emit(a_.MediaReconnectStart,s.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),_l.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(o,s){for(const d of this.pendingRemoteTracks){const{user:g,kind:b}=d;if((o instanceof _I?o.uid:o)===g.uid&&s===b)return!0}return!1}setPendingRemoteMedia(o,s){this.hasPendingRemoteMedia(o,s)||this.pendingRemoteTracks.push({user:o,kind:s})}async restartICE(o,s){let d,g;if(o===vT.SEND_ONLY){if(!this.sendConnection)throw new TE(rE.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");d=await this.sendMutex.lock("From P2PChannel.restartICE"),g=this.sendConnection}else{if(!this.recvConnection)throw new TE(rE.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");d=await this.recvMutex.lock("From P2PChannel.restartICE"),g=this.recvConnection}try{if(s){const b=await g.restartICE(s);return g.isInRestartIce=!1,b}{const b=await g.restartICE();if(b){const $=await kS(this,a_.RequestP2PRestartICE,{direction:vT.RECEIVE_ONLY,iceParameter:b});await g.restartICE($),g.isInRestartIce=!1}}}finally{d()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const o=this.sendConnection.getStats(),s=this.localTrackMap.get(ME.LocalVideoTrack),d=this.localTrackMap.get(ME.LocalAudioTrack),g=o.videoSend.find(_c=>{var tE;return _c.ssrc===(s==null||(tE=s.ssrcs)===null||tE===void 0?void 0:tE[0].ssrcId)}),b=o.audioSend.find(_c=>{var tE;return _c.ssrc===(d==null||(tE=d.ssrcs)===null||tE===void 0?void 0:tE[0].ssrcId)});if(!g||!b)return 1;const $=VT(this,a_.NeedSignalRTT),Vt=g?g.rttMs:void 0,zt=b?b.rttMs:void 0,_e=Vt&&zt?(Vt+zt)/2:Vt||zt,_r=(_e&&$?(_e+$)/2:_e||$)||0,_o=100*o.sendPacketLossRate*.7/50+.3*_r/1500,ga=_o<.17?1:_o<.36?2:_o<.59?3:_o<.1?4:5,_a=s==null?void 0:s.track;if(_a&&_a._encoderConfig&&_a._hints.indexOf(Z_.SCREEN_TRACK)===-1){const _c=_a._encoderConfig.bitrateMax,tE=o.bitrate.actualEncoded;if(_c&&tE){const _p=(1e3*_c-tE)/(1e3*_c);return E4[_p<.15?0:_p<.3?1:_p<.45?2:_p<.6?3:4][ga]}}return ga}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const o=this.recvConnection.getStats();let s=0;return Array.from(this.remoteUserMap.entries()).forEach(d=>{let[g]=d;const b=g._audioSSRC,$=g._videoSSRC,Vt=o.audioRecv.find(tE=>tE.ssrc===b),zt=o.videoRecv.find(tE=>tE.ssrc===$);if(!Vt&&!zt)return void(s+=1);const _e=VT(this,a_.NeedSignalRTT),_r=o.rtt,_o=(_r&&_e?(_r+_e)/2:_r||_e)||0,ga=Vt?Vt.jitterMs:void 0,_a=o.recvPacketLossRate;let _c=.7*_a*100/50+.3*_o/1500;ga&&(_c=.6*_a*100/50+.2*_o/1500+.2*ga/400),s+=_c<.1?1:_c<.17?2:_c<.36?3:_c<.59?4:5}),this.remoteUserMap.size>0?Math.round(s/this.remoteUserMap.size):s}async muteLocalTrack(o){return new GE((s,d)=>{this.handleMuteLocalTrack(o,s,d)})}filterTobePublishedTracks(o,s,d){const g=[],b=R_(),$=this.getAllTracks();o=VO(o=o.filter(_e=>$.indexOf(_e)===-1));let Vt=!1,zt=!1;for(const _e of o){if(_e instanceof Y_&&(this.localTrackMap.has(ME.LocalVideoTrack)||Vt?new TE(rE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(g.push({track:_e,type:ME.LocalVideoTrack}),Vt=!0),s)){const _r=this.getLowVideoTrack(_e,d);g.push({track:_r,type:ME.LocalVideoLowTrack})}if(_e instanceof mS){const _r=this.localTrackMap.get(ME.LocalAudioTrack);if(_r){if(!(_r.track instanceof jS))throw new TE(rE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_e._bypassWebAudio)throw new TE(rE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_r.track.addAudioTrack(_e),this.bindLocalAudioTrackEvents(_e,!0)}else if(zt){const _o=g.find(ga=>{let{type:_a}=ga;return _a===ME.LocalAudioTrack});if(!(_o.track instanceof jS))throw new TE(rE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_e._bypassWebAudio)throw new TE(rE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_o.track.addAudioTrack(_e)}else{if(!b.webAudioMediaStreamDest||_e instanceof jS||_e._bypassWebAudio)g.push({track:_e,type:ME.LocalAudioTrack});else{const _o=new jS;_o.addAudioTrack(_e),g.push({track:_o,type:ME.LocalAudioTrack})}zt=!0}}}return g}filterTobeUnpublishedTracks(o){const s=[],d=this.getAllTracks();o=VO(o=o.filter(g=>d.indexOf(g)!==-1));for(const g of o){if(g instanceof mS){const b=this.localTrackMap.get(ME.LocalAudioTrack);if(!b)continue;b.track instanceof jS?(b.track.removeAudioTrack(g),this.unbindLocalAudioTrackEvents(g),b.track.trackList.length===0&&(s.push([ME.LocalAudioTrack,b]),b.track.close())):s.push([ME.LocalAudioTrack,b])}if(g instanceof Y_){const b=this.localTrackMap.get(ME.LocalVideoTrack);if(!b)continue;s.push([ME.LocalVideoTrack,b]);const $=this.localTrackMap.get(ME.LocalVideoLowTrack);$&&s.push([ME.LocalVideoLowTrack,$])}}return s}bindLocalTrackEvents(o){o.forEach(s=>{let{track:d,type:g}=s;switch(g){case ME.LocalVideoTrack:d.addListener(YE.GET_STATS,this.handleGetLocalVideoStats),d.addListener(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),d.addListener(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),d.addListener(YE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),d.addListener(YE.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),d.addListener(YE.NEED_REPLACE_TRACK,this.handleReplaceTrack),d.addListener(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),d.addListener(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ME.LocalAudioTrack:this.bindLocalAudioTrackEvents(d);case ME.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(o,s){o instanceof jS?o.trackList.forEach(d=>{d.addListener(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),d.addListener(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),d.addListener(YE.GET_STATS,this.handleGetLocalAudioStats),d.addListener(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),d.addListener(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(o.addListener(YE.GET_STATS,this.handleGetLocalAudioStats),o.addListener(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),s||o.addListener(YE.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(o){o||(o=Array.from(this.localTrackMap.entries()).map(s=>{let[d,{track:g}]=s;return{track:g,type:d}})),o.forEach(s=>{let{track:d,type:g}=s;switch(g){case ME.LocalVideoTrack:d.off(YE.GET_STATS,this.handleGetLocalVideoStats),d.off(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),d.off(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),d.off(YE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),d.off(YE.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),d.off(YE.NEED_REPLACE_TRACK,this.handleReplaceTrack),d.off(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),d.off(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ME.LocalAudioTrack:this.unbindLocalAudioTrackEvents(d);case ME.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(o){o instanceof jS?o.trackList.forEach(s=>{s.off(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(YE.GET_STATS,this.handleGetLocalAudioStats),s.off(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(o.off(YE.GET_STATS,this.handleGetLocalAudioStats),o.off(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(YE.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(o,s){s instanceof fN&&s.addListener(YE.GET_STATS,d=>{d(this.handleGetRemoteVideoStats(o))}),s instanceof mN&&s.addListener(YE.GET_STATS,d=>{d(this.handleGetRemoteAudioStats(o))})}unbindRemoteTrackEvents(o){o&&o.removeAllListeners(YE.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s,d]=o;d.has(_g.AUDIO)&&this.unbindRemoteTrackEvents(s._audioTrack),d.has(_g.VIDEO)&&this.unbindRemoteTrackEvents(s._videoTrack)})}createGatewayPublishMessage(o,s){return o.map((d,g)=>{var b;let $,{track:Vt,type:zt}=d;switch(zt){case ME.LocalAudioTrack:$=x_.Audio;break;case ME.LocalVideoTrack:$=KE(b=Vt._hints).call(b,Z_.SCREEN_TRACK)?x_.Screen:x_.High;break;case ME.LocalVideoLowTrack:$=x_.Low}return{kind:zt===ME.LocalAudioTrack?_g.AUDIO:_g.VIDEO,stream_type:$,mid:s[g].id,ssrcs:s[g].localSSRC,isMuted:Vt.muted||!Vt.enabled}})}createGatewayUnpublishMessage(o){return o.map(s=>{var d;let g,[b,{track:$,ssrcs:Vt,id:zt}]=s;switch(b){case ME.LocalVideoTrack:g=KE(d=$._hints).call(d,Z_.SCREEN_TRACK)?x_.Screen:x_.High;break;case ME.LocalAudioTrack:g=x_.Audio;break;case ME.LocalVideoLowTrack:g=x_.Low}return{stream_type:g,ssrcs:Vt,mid:zt}})}assignLocalTracks(o,s){o.forEach((d,g)=>{let{track:b,type:$}=d;this.localTrackMap.set($,{track:b,id:s[g].id,ssrcs:s[g].localSSRC})})}withdrawLocalTracks(o){o.forEach(s=>{let[d]=s;this.localTrackMap.delete(d)})}bindConnectionEvents(o){o.onConnectionStateChange=async s=>{var d;_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(o.name,".onConnectionStateChange(").concat(s,")")),this.emit(a_.PeerConnectionStateChange,s),s!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),s==="connected"&&(o.isInRestartIce=!1),KE(d=this._restartStates).call(d,s)&&!o.isInRestartIce&&(s==="disconnected"&&await WS(800),o.iceConnectionState!=="disconnected"&&o.iceConnectionState!=="failed"||this.handleDisconnect(o.direction))},o.onICEConnectionStateChange=s=>{s!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(s,")")),t_.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:s,tag:hS.TRACER}).onSuccess(),this.emit(a_.IceConnectionStateChange,s)},o.onICETransportStateChange=s=>{_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(s,")"))},o.onDTLSTransportStateChange=s=>{_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(s,")"))},o.onDTLSTransportError=s=>{_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(s,")"))},o.onFirstAudioDecoded=s=>{var d;const g=Array.from(qT(d=this.remoteUserMap).call(d)).find($=>$._audioSSRC===s);var b;g&&(this.store.subscribe(g.uid,"audio",void 0,void 0,void 0,Date.now()),(b=g.audioTrack)===null||b===void 0||b.emit(lN.FIRST_FRAME_DECODED),t_.firstRemoteFrame(this.store.sessionId,zS.FIRST_AUDIO_DECODE,cS.FIRST_AUDIO_DECODE,{peer:g._uintid,subscribeElapse:aT.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId}))},o.onFirstAudioReceived=s=>{var d;const g=Array.from(qT(d=this.remoteUserMap).call(d)).find(b=>b._audioSSRC===s);g&&t_.firstRemoteFrame(this.store.sessionId,zS.FIRST_AUDIO_RECEIVED,cS.FIRST_AUDIO_RECEIVED,{peer:g._uintid,subscribeElapse:aT.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},o.onFirstVideoDecoded=(s,d,g)=>{this.reportVideoFirstFrameDecoded(s,d,g)},o.onFirstVideoReceived=s=>{var d;const g=Array.from(qT(d=this.remoteUserMap).call(d)).find(b=>b._videoSSRC===s);g&&t_.firstRemoteFrame(this.store.sessionId,zS.FIRST_VIDEO_RECEIVED,cS.FIRST_VIDEO_RECEIVED,{peer:g._uintid,subscribeElapse:aT.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},o.onSelectedLocalCandidateChanged=(s,d)=>{const g=s.candidateType==="relay",b=d.candidateType==="relay";d.candidateType!=="unknown"&&g===b||this.emit(a_.ConnectionTypeChange,g),_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(cI(d))," -> ").concat(JSON.stringify(cI(s)),")"))},o.onSelectedRemoteCandidateChanged=(s,d)=>{_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(cI(d))," -> ").concat(JSON.stringify(cI(s)),")"))},o.onFirstVideoDecodedTimeout=s=>{this.reportVideoFirstFrameDecoded(s,void 0,void 0,!0)},o.onLocalCandidate=s=>{this.emit(a_.LocalCandidate,{candidate:s,direction:o.direction})}}unbindConnectionEvents(o){o.onConnectionStateChange=void 0,o.onICEConnectionStateChange=void 0,o.onICETransportStateChange=void 0,o.onDTLSTransportStateChange=void 0,o.onDTLSTransportError=void 0,o.onFirstAudioDecoded=void 0,o.onFirstAudioReceived=void 0,o.onFirstVideoDecoded=void 0,o.onFirstVideoReceived=void 0,o.onSelectedLocalCandidateChanged=void 0,o.onSelectedRemoteCandidateChanged=void 0,o.onFirstVideoDecodedTimeout=void 0,o.onLocalCandidate=void 0}async handleDisconnect(o){const s=o===vT.SEND_ONLY?this.sendConnection:this.recvConnection;s&&!s.isInRestartIce&&(s.isInRestartIce=!0,_l.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(s.name,"] start use restartICE")),o===vT.SEND_ONLY?this.restartICE(o):kS(this,a_.RequestP2PRestartICE,{direction:vT.SEND_ONLY}))}filterTobeMutedTracks(o){const s=[];if(this.getAllTracks().indexOf(o)===-1)return s;const d=this.localTrackMap.get(ME.LocalAudioTrack);if(o instanceof mS&&(d==null?void 0:d.track)instanceof jS)return d.track.isActive||s.push([ME.LocalAudioTrack,d]),s;const g=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:$}]=b;return o===$});if(g&&(s.push(g),g[0]===ME.LocalVideoTrack)){const b=this.localTrackMap.get(ME.LocalVideoLowTrack);b&&s.push([ME.LocalVideoLowTrack,b])}return s}filterTobeUnmutedTracks(o){const s=[],d=this.localTrackMap.get(ME.LocalAudioTrack);if(o instanceof mS&&(d==null?void 0:d.track)instanceof jS)return d.track.isActive&&s.push([ME.LocalAudioTrack,d]),s;const g=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:$}]=b;return o===$});if(g)if(g[0]===ME.LocalVideoTrack){s.push(g);const b=this.localTrackMap.get(ME.LocalVideoLowTrack);b&&s.push([ME.LocalVideoLowTrack,b])}else s.push(g);return s}createMuteMessage(o){return o.map(s=>{var d;let g,[b,{track:$,ssrcs:Vt,id:zt}]=s;switch(b){case ME.LocalAudioTrack:g=x_.Audio;break;case ME.LocalVideoTrack:g=KE(d=$._hints).call(d,Z_.SCREEN_TRACK)?x_.Screen:x_.High;break;case ME.LocalVideoLowTrack:g=x_.Low}return{stream_type:g,ssrcs:Vt,mid:zt}})}createUnmuteMessage(o){return o.map(s=>{var d;let g,[b,{track:$,ssrcs:Vt,id:zt}]=s;switch(b){case ME.LocalAudioTrack:g=x_.Audio;break;case ME.LocalVideoTrack:g=KE(d=$._hints).call(d,Z_.SCREEN_TRACK)?x_.Screen:x_.High;break;case ME.LocalVideoLowTrack:g=x_.Low}return{stream_type:g,ssrcs:Vt,mid:zt}})}filterTobeUnSubscribedTracks(o,s){const d=[],g=this.remoteUserMap.get(o);if(!g)return d;if(s){const b=g.get(s);if(!b)return d;d.push([o,{kind:s,id:b}])}else Array.from(g.entries()).forEach(b=>{let[$,Vt]=b;d.push([o,{kind:$,id:Vt}])});return d}createUnsubscribeMessage(o){const s=[];return o.forEach(d=>{let[g,{kind:b,id:$}]=d;switch(b){case _g.VIDEO:return void(g._videoSSRC&&s.push({stream_type:_g.VIDEO,ssrcId:g._videoSSRC}));case _g.AUDIO:return void(g._audioSSRC&&s.push({stream_type:_g.AUDIO,ssrcId:g._audioSSRC}))}}),s}withdrawRemoteTracks(o){o.forEach(s=>{let[d,{kind:g}]=s;const b=this.remoteUserMap.get(d);b&&(b.delete(g),Array.from(b.entries()).length===0&&this.remoteUserMap.delete(d))})}async updateBitrateLimit(o){const s=this.localTrackMap.get(ME.LocalVideoTrack),d=this.localTrackMap.get(ME.LocalVideoLowTrack);s&&await s.track.setBitrateLimit(o.uplink),d&&o.low_stream_uplink&&await d.track.setBitrateLimit({max_bitrate:o.low_stream_uplink.bitrate,min_bitrate:o.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const o=this.sendConnection.peerConnectionState,s=this.recvConnection.peerConnectionState;return o!=="connected"&&s!=="connected"}return!0}async tryToUnmuteAudio(o){for(let s=0;s<o.length;s++)if(o[s]instanceof mS){const d=this.filterTobeUnmutedTracks(o[s]);if(d.length===0)continue;const g=this.createUnmuteMessage(d);return void await K_(this,a_.RequestUnmuteLocal,g)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=o=>this.getStats(o),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(o=>{let[,{ssrcs:s}]=o;return!!s}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=o=>{var s;return!((s=this.recvConnection)===null||s===void 0||!s.getRemoteVideoIsReady(o))},this.statsUploader.requestUpload=(o,s)=>this.emit(a_.RequestUpload,o,s),this.statsUploader.requestUploadStats=o=>this.emit(a_.RequestUploadStats,o),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await WS(CD(this.dtlsFailedCount,CS)),this.emit(a_.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(ME.LocalVideoTrack)||this.pendingLocalTracks.some(o=>o instanceof Y_)}throwIfTrackTypeNotMatch(o){if(o.filter(s=>s instanceof Y_).length>1)throw new TE(rE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(o.filter(s=>s instanceof mS).length>1&&(o.some(s=>s instanceof mS&&s._bypassWebAudio)||!R_().webAudioMediaStreamDest))throw new TE(rE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const s of o){if(s instanceof Y_&&this.pendingLocalTracks.some(d=>d instanceof Y_))throw new TE(rE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(s instanceof mS&&this.pendingLocalTracks.some(d=>d instanceof mS)&&(!R_().webAudioMediaStreamDest||s._bypassWebAudio||this.pendingLocalTracks.some(d=>d instanceof mS&&d._bypassWebAudio)))throw new TE(rE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(o,s){const d=!cE("DISABLE_DUAL_STREAM_USE_ENCODING")&&R_().supportDualStreamEncoding,g=CL(CL({},{width:160,height:120,framerate:15,bitrate:50}),s);let b;b=d?o._mediaStreamTrack.clone():fG(o,g);const $=z_(8,"track-low-"),Vt=new Y_(b,CL(CL({},d&&{scaleResolutionDownBy:HV(g,o)}),{},{frameRate:g.framerate,bitrateMax:g.bitrate,bitrateMin:g.bitrate}),void 0,void 0,$);return Vt.on(nO.TRANSCEIVER_UPDATED,zt=>{o._updateRtpTransceiver(zt,cN.LOW_STREAM)}),Vt._hints.push(Z_.LOW_STREAM),o.addListener(YE.NEED_CLOSE,()=>{Vt.close()}),Vt}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(o,s,d,g){var b;const $=Array.from(qT(b=this.remoteUserMap).call(b)).find(Vt=>Vt._videoSSRC===o);if($){g||this.store.subscribe($.uid,"video",void 0,void 0,void 0,void 0,Date.now());const Vt=this.store.keyMetrics,zt=Vt.subscribe.find(_e=>_e.userId===$.uid&&_e.type==="video");t_.firstRemoteVideoDecode(this.store.sessionId,zS.FIRST_VIDEO_DECODE,cS.FIRST_VIDEO_DECODE,{peer:$._uintid,videowidth:s,videoheight:d,subscribeElapse:aT.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId,apEnd:Vt.requestAPEnd||0,apStart:Vt.requestAPStart||0,joinGwEnd:Vt.joinGatewayEnd||0,joinGwStart:Vt.joinGatewayStart||0,pcEnd:Vt.peerConnectionEnd||0,pcStart:Vt.peerConnectionStart||0,subscriberEnd:(zt==null?void 0:zt.subscribeEnd)||0,subscriberStart:(zt==null?void 0:zt.subscribeStart)||0,videoAddNotify:(zt==null?void 0:zt.streamAdded)||0,state:g?1:0})}}async remoteMediaSsrcChanged(o,s,d){if(!this.recvConnection)return!1;const g=this.remoteUserMap.get(o);if(!g)return!1;const b=g.get(s);if(!b)return!1;const $=await this.recvConnection.getRemoteSSRC(b);return $!==void 0&&$!==d}resetConnection(o){_l.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(o)),this.state===j_.Connected?(_l.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(o){throw new TE(rE.NOT_SUPPORTED)}async unpublishDataChannel(o){throw new TE(rE.NOT_SUPPORTED)}async subscribeDataChannel(o,s){throw new TE(rE.NOT_SUPPORTED)}async unsubscribeDataChannel(o,s){throw new TE(rE.NOT_SUPPORTED)}hasPendingRemoteDataChannel(o,s){throw new TE(rE.NOT_SUPPORTED)}setPendingRemoteDataChannel(o,s){throw new TE(rE.NOT_SUPPORTED)}async preConnect(o,s,d,g,b,$){throw new TE(rE.NOT_SUPPORTED)}getEstablishParams(){throw new TE(rE.NOT_SUPPORTED)}async reSubscribe(o){throw new TE(rE.NOT_SUPPORTED)}async updateVideoStreamParameter(o,s){throw new TE(rE.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(o=>{let[s,{track:d}]=o;s===ME.LocalVideoLowTrack?d._updateRtpTransceiver(void 0,cN.LOW_STREAM):d._updateRtpTransceiver(void 0)})}},BE(oS.prototype,"p2pConnect",[Q9],Object.getOwnPropertyDescriptor(oS.prototype,"p2pConnect"),oS.prototype),BE(oS.prototype,"unpublish",[Z9],Object.getOwnPropertyDescriptor(oS.prototype,"unpublish"),oS.prototype),BE(oS.prototype,"unpublishLowStream",[$9],Object.getOwnPropertyDescriptor(oS.prototype,"unpublishLowStream"),oS.prototype),BE(oS.prototype,"subscribe",[tJ],Object.getOwnPropertyDescriptor(oS.prototype,"subscribe"),oS.prototype),BE(oS.prototype,"mockSubscribe",[eJ],Object.getOwnPropertyDescriptor(oS.prototype,"mockSubscribe"),oS.prototype),BE(oS.prototype,"unsubscribe",[nJ],Object.getOwnPropertyDescriptor(oS.prototype,"unsubscribe"),oS.prototype),BE(oS.prototype,"muteRemote",[rJ],Object.getOwnPropertyDescriptor(oS.prototype,"muteRemote"),oS.prototype),BE(oS.prototype,"unmuteRemote",[iJ],Object.getOwnPropertyDescriptor(oS.prototype,"unmuteRemote"),oS.prototype),BE(oS.prototype,"hasRemoteMediaWithLock",[oJ],Object.getOwnPropertyDescriptor(oS.prototype,"hasRemoteMediaWithLock"),oS.prototype),BE(oS.prototype,"disconnectForReconnect",[sJ],Object.getOwnPropertyDescriptor(oS.prototype,"disconnectForReconnect"),oS.prototype),BE(oS.prototype,"remoteMediaSsrcChanged",[aJ],Object.getOwnPropertyDescriptor(oS.prototype,"remoteMediaSsrcChanged"),oS.prototype),oS);function $0(o){return function(s,d,g){const b=s[d];if(typeof b!="function")throw new Error("Cannot use mutex on object property.");return g.value=async function(){for(var $=arguments.length,Vt=new Array($),zt=0;zt<$;zt++)Vt[zt]=arguments[zt];switch(o){case Z0.SEND_ONLY:{const _e=await this.sendMutex.lock("From P2PChannel2.".concat(d));try{return await b.apply(this,Vt)}finally{_e()}}case Z0.RECEIVE_ONLY:{const _e=await this.recvMutex.lock("From P2PChannel2.".concat(d));try{return await b.apply(this,Vt)}finally{_e()}}default:{const _e=await this.sendMutex.lock("From P2PChannel2.".concat(d)),_r=await this.recvMutex.lock("From P2PChannel2.".concat(d));try{return await b.apply(this,Vt)}finally{_e(),_r()}}}},g}}function uJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function lO(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?uJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):uJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}class GP{constructor(s){Qm(this,"store",void 0),Qm(this,"onStatsException",void 0),Qm(this,"onUploadPublishDuration",void 0),Qm(this,"onStatsChanged",void 0),Qm(this,"localStats",new Map),Qm(this,"remoteStats",new Map),Qm(this,"updateStatsInterval",void 0),Qm(this,"trafficStats",void 0),Qm(this,"trafficStatsPeerList",[]),Qm(this,"uplinkStats",void 0),Qm(this,"exceptionMonitor",void 0),Qm(this,"p2pChannel",void 0),Qm(this,"scalabilityMode",qct.L1T1),Qm(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=s,this.exceptionMonitor=new Kdt,this.exceptionMonitor.on("exception",(d,g,b)=>{this.onStatsException&&this.onStatsException(d,g,b)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ME.LocalAudioTrack)||lO({},KF)}getLocalVideoTrackStats(){return this.localStats.get(ME.LocalVideoTrack)||lO({},zF)}getRemoteAudioTrackStats(s){const d=($,Vt)=>{if(!this.trafficStats)return Vt;const zt=this.trafficStats.peer_delay.find(_e=>_e.peer_uid===$);return zt&&(Vt.publishDuration=zt.B_ppad+(Date.now()-this.trafficStats.timestamp)),Vt},g={};if(s){var b;const $=(b=this.remoteStats.get(s))===null||b===void 0?void 0:b.audioStats;$&&(g[s]=d(s,$))}else Array.from(this.remoteStats.entries()).forEach($=>{let[Vt,{audioStats:zt}]=$;zt&&(g[Vt]=d(Vt,zt))});return g}getRemoteNetworkQualityStats(s){const d={};if(s){var g;const b=(g=this.remoteStats.get(s))===null||g===void 0?void 0:g.networkStats;b&&(d[s]=b)}else Array.from(this.remoteStats.entries()).forEach(b=>{let[$,{networkStats:Vt}]=b;Vt&&(d[$]=Vt)});return d}getRemoteVideoTrackStats(s){const d=($,Vt)=>{if(!this.trafficStats)return Vt;const zt=this.trafficStats.peer_delay.find(_e=>_e.peer_uid===$);return zt&&(Vt.publishDuration=zt.B_ppvd+(Date.now()-this.trafficStats.timestamp)),Vt},g={};if(s){var b;const $=(b=this.remoteStats.get(s))===null||b===void 0?void 0:b.videoStats;$&&(g[s]=d(s,$))}else Array.from(this.remoteStats.entries()).forEach($=>{let[Vt,{videoStats:zt}]=$;zt&&(g[Vt]=d(Vt,zt))});return g}getRTCStats(){let s=0,d=0,g=0,b=0;const $=this.localStats.get(ME.LocalAudioTrack);$&&(s+=$.sendBytes,d+=$.sendBitrate);const Vt=this.localStats.get(ME.LocalVideoTrack);Vt&&(s+=Vt.sendBytes,d+=Vt.sendBitrate);const zt=this.localStats.get(ME.LocalVideoLowTrack);zt&&(s+=zt.sendBytes,d+=zt.sendBitrate),this.remoteStats.forEach(_r=>{let{audioStats:_o,videoStats:ga}=_r;_o&&(g+=_o.receiveBytes,b+=_o.receiveBitrate),ga&&(g+=ga.receiveBytes,b+=ga.receiveBitrate)});let _e=1;return this.trafficStats&&(_e+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_e,SendBitrate:d,SendBytes:s,RecvBytes:g,RecvBitrate:b,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(s){this.localStats.set(s,void 0)}removeLocalStats(s){s?this.localStats.delete(s):this.localStats.clear()}addRemoteStats(s){this.remoteStats.set(s,{})}removeRemoteStats(s){s?this.remoteStats.delete(s):this.remoteStats.clear()}addP2PChannel(s){this.p2pChannel=s}updateTrafficStats(s){s.peer_delay=s.peer_delay.filter(d=>d.B_ppad!==void 0||d.B_ppvd!==void 0),s.peer_delay.filter(d=>this.trafficStatsPeerList.indexOf(d.peer_uid)===-1).forEach(d=>{var g;const b=(g=this.p2pChannel)===null||g===void 0?void 0:g.getRemoteMedia(d.peer_uid),$=b!=null&&b.videoSSRC?aT.measureFromSubscribeStart(this.store.clientId,b.videoSSRC):0,Vt=b!=null&&b.audioSSRC?aT.measureFromSubscribeStart(this.store.clientId,b.audioSSRC):0;d.B_ppad!==void 0&&d.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(d.peer_uid,d.B_ppad,d.B_ppvd,$>Vt?$:Vt),this.trafficStatsPeerList.push(d.peer_uid))}),this.trafficStats=s}updateUplinkStats(s){this.uplinkStats&&this.uplinkStats.B_fir!==s.B_fir&&_l.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(s.B_fir)),this.uplinkStats=s}static isRemoteVideoFreeze(s,d,g){if(!s)return!1;const b=!!g&&d.framesDecodeFreezeTime>g.framesDecodeFreezeTime,$=!g||d.framesDecodeCount>g.framesDecodeCount;return b||!$}static isRemoteAudioFreeze(s){return!!s&&s._isFreeze()}isLocalVideoFreeze(s){return!(!s.inputFrame||!s.sentFrame)&&s.inputFrame.frameRate>5&&s.sentFrame.frameRate<3}updateLocalStats(s){Array.from(this.localStats.entries()).forEach(d=>{let[g,b]=d;switch(g){case ME.LocalVideoTrack:case ME.LocalVideoLowTrack:{const Vt=b,zt=lO({},zF),_e=s.getStats(),_r=s.getLocalMedia(g);if(_e){const _o=_e.videoSend.find(ga=>ga.ssrc===(_r==null?void 0:_r.ssrcs[0].ssrcId));if(_o){const ga=s.getLocalVideoSize(),_a=s.getEncoderConfig(ME.LocalVideoTrack);_o.codec!=="H264"&&_o.codec!=="H265"&&_o.codec!=="VP8"&&_o.codec!=="VP9"&&_o.codec!=="AV1X"&&_o.codec!=="AV1"||(zt.codecType=_o.codec),zt.sendBytes=_o.bytes,zt.sendBitrate=Vt?8*Math.max(0,zt.sendBytes-Vt.sendBytes):0,_o.inputFrame?(zt.captureFrameRate=_o.inputFrame.frameRate,zt.captureResolutionHeight=_o.inputFrame.height,zt.captureResolutionWidth=_o.inputFrame.width):ga&&(zt.captureResolutionWidth=ga.width,zt.captureResolutionHeight=ga.height),_o.sentFrame?(zt.sendFrameRate=_o.sentFrame.frameRate,zt.sendResolutionHeight=_o.sentFrame.height,zt.sendResolutionWidth=_o.sentFrame.width):ga&&(zt.sendResolutionWidth=ga.width,zt.sendResolutionHeight=ga.height),_o.avgEncodeMs&&(zt.encodeDelay=_o.avgEncodeMs),_a&&_a.bitrateMax&&(zt.targetSendBitrate=1e3*_a.bitrateMax),zt.sendPackets=_o.packets,zt.sendPacketsLost=_o.packetsLost,zt.sendJitterMs=_o.jitterMs,zt.sendRttMs=_o.rttMs,zt.totalDuration=Vt?Vt.totalDuration+1:1,zt.totalFreezeTime=Vt?Vt.totalFreezeTime:0,this.isLocalVideoFreeze(_o)&&(zt.totalFreezeTime+=1),_o.scalabilityMode&&this.scalabilityMode!==_o.scalabilityMode&&(_l.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_o.scalabilityMode)),this.scalabilityMode=_o.scalabilityMode)}this.trafficStats&&(zt.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var $;this.localStats.set(g,zt),((Vt==null?void 0:Vt.sendResolutionWidth)!==zt.sendResolutionWidth||(Vt==null?void 0:Vt.sendResolutionHeight)!==zt.sendResolutionHeight)&&(($=this.onStatsChanged)===null||$===void 0||$.call(this,"resolution",{width:zt.sendResolutionWidth,height:zt.sendResolutionHeight})),zt&&_r&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,_r.track,zt);break}case ME.LocalAudioTrack:{const Vt=b,zt=lO({},KF),_e=s.getStats(),_r=s.getLocalMedia(g);if(_e){const _o=_e.audioSend.find(ga=>ga.ssrc===(_r==null?void 0:_r.ssrcs[0].ssrcId));if(_o){if(_o.codec!=="opus"&&_o.codec!=="aac"&&_o.codec!=="PCMU"&&_o.codec!=="PCMA"&&_o.codec!=="G722"||(zt.codecType=_o.codec),_o.inputLevel)zt.sendVolumeLevel=Math.round(32767*_o.inputLevel);else{const ga=s.getLocalAudioVolume();ga&&(zt.sendVolumeLevel=Math.round(32767*ga))}zt.sendBytes=_o.bytes,zt.sendPackets=_o.packets,zt.sendPacketsLost=_o.packetsLost,zt.sendJitterMs=_o.jitterMs,zt.sendRttMs=_o.rttMs,zt.sendBitrate=Vt?8*Math.max(0,zt.sendBytes-Vt.sendBytes):0}}this.trafficStats&&(zt.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(ME.LocalAudioTrack,zt),zt&&_r&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,_r.track,zt);break}}})}updateRemoteStats(s){Array.from(this.remoteStats.entries()).forEach(d=>{var g,b;let[$,{videoStats:Vt,audioStats:zt,videoPcStats:_e}]=d;const _r=zt,_o=Vt,ga=_e,_a=lO({},TY),_c=lO({},bY),tE=lO({},Ldt),{audioTrack:_p,videoTrack:_f,audioSSRC:eE,videoSSRC:iE}=s.getRemoteMedia($);let fE;fE=s instanceof GT?s.getStats(!0):s.getStats();const mE=(g=fE)===null||g===void 0?void 0:g.audioRecv.find(wE=>wE.ssrc===eE),_E=(b=fE)===null||b===void 0?void 0:b.videoRecv.find(wE=>wE.ssrc===iE),SE=this.trafficStats&&this.trafficStats.peer_delay.find(wE=>wE.peer_uid===$);if(mE&&(mE.codec!=="opus"&&mE.codec!=="aac"&&mE.codec!=="PCMU"&&mE.codec!=="PCMA"&&mE.codec!=="G722"||(_a.codecType=mE.codec),mE.outputLevel?_a.receiveLevel=Math.round(32767*mE.outputLevel):_p&&(_a.receiveLevel=Math.round(32767*_p.getVolumeLevel())),_a.receiveBytes=mE.bytes,_a.receivePackets=mE.packets,_a.receivePacketsLost=mE.packetsLost,_a.packetLossRate=_a.receivePacketsLost/(_a.receivePackets+_a.receivePacketsLost),_a.receiveBitrate=_r?8*Math.max(0,_a.receiveBytes-_r.receiveBytes):0,_a.totalDuration=_r?_r.totalDuration+1:1,_a.totalFreezeTime=_r?_r.totalFreezeTime:0,_a.freezeRate=_a.totalFreezeTime/_a.totalDuration,_a.receiveDelay=mE.jitterBufferMs,_a.totalDuration>10&&GP.isRemoteAudioFreeze(_p)&&(_a.totalFreezeTime+=1)),_E){_E.codec!=="H264"&&_E.codec!=="H265"&&_E.codec!=="VP8"&&_E.codec!=="VP9"&&_E.codec!=="AV1X"&&_E.codec!=="AV1"||(_c.codecType=_E.codec),_c.receiveBytes=_E.bytes,_c.receiveBitrate=_o?8*Math.max(0,_c.receiveBytes-_o.receiveBytes):0,_c.decodeFrameRate=_E.decodeFrameRate<0?0:_E.decodeFrameRate,_c.renderFrameRate=_E.decodeFrameRate<0?0:_E.decodeFrameRate,_E.outputFrame&&(_c.renderFrameRate=_E.outputFrame.frameRate),_E.receivedFrame?(_c.receiveFrameRate=_E.receivedFrame.frameRate,_c.receiveResolutionHeight=_E.receivedFrame.height,_c.receiveResolutionWidth=_E.receivedFrame.width):_f&&(_c.receiveResolutionHeight=_f._videoHeight||0,_c.receiveResolutionWidth=_f._videoWidth||0),_E.framesRateFirefox!==void 0&&(_c.receiveFrameRate=Math.round(_E.framesRateFirefox)),_c.receivePackets=_E.packets,_c.receivePacketsLost=_E.packetsLost,_c.packetLossRate=_c.receivePacketsLost/(_c.receivePackets+_c.receivePacketsLost),_c.totalDuration=_o?_o.totalDuration+1:1,_c.totalFreezeTime=_o?_o.totalFreezeTime:0,_c.receiveDelay=_E.jitterBufferMs||0;const wE=!!iE&&s.getRemoteVideoIsReady(iE);_f&&wE&&GP.isRemoteVideoFreeze(_f,_E,ga)&&(_c.totalFreezeTime+=1),_c.freezeRate=_c.totalFreezeTime/_c.totalDuration}SE&&(_a.end2EndDelay=SE.B_ad,_c.end2EndDelay=SE.B_vd,_a.transportDelay=SE.B_ed,_c.transportDelay=SE.B_ed,_a.currentPacketLossRate=SE.B_ealr4/100,_c.currentPacketLossRate=SE.B_evlr4/100,tE.uplinkNetworkQuality=SE.B_punq?SE.B_punq:0,tE.downlinkNetworkQuality=SE.B_pdnq?SE.B_pdnq:0),this.remoteStats.set($,{audioStats:_a,videoStats:_c,videoPcStats:_E,networkStats:tE}),_p&&this.exceptionMonitor.setRemoteAudioStats(_p,_a),_f&&this.exceptionMonitor.setRemoteVideoStats(_f,_c)})}}function lJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function WP(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?lJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):lJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}class dht extends nS{constructor(s,d,g,b){super(),Qm(this,"spec",void 0),Qm(this,"token",void 0),Qm(this,"websocket",void 0),Qm(this,"pingpongTimer",void 0),Qm(this,"reconnectMode","retry"),Qm(this,"serviceMode",void 0),Qm(this,"reqId",0),Qm(this,"commandReqId",0),Qm(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Qm(this,"handleWebSocketMessage",$=>{if(!$.data)return;const Vt=JSON.parse($.data);Vt.requestId?this.emit("@".concat(Vt.requestId,"-").concat(Vt.sid),Vt):this.serviceMode===YS.INJECT?this.emit(hR.INJECT_STREAM_STATUS,Vt):(t_.workerEvent(this.spec.sid,{actionType:"status",serverCode:Vt.code,workerType:this.serviceMode===YS.TRANSCODE?1:2}),this.emit(hR.PUBLISH_STREAM_STATUS,Vt))}),this.spec=d,this.token=s,this.serviceMode=b,this.websocket=new lP("live-streaming",g),this.websocket.on(c_.CONNECTED,this.handleWebSocketOpen),this.websocket.on(c_.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(c_.REQUEST_NEW_URLS,($,Vt)=>{kS(this,hR.REQUEST_NEW_ADDRESS).then($).catch(Vt)}),this.websocket.on(c_.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(s){return this.websocket.init(s)}async request(s,d,g,b){this.reqId+=1,s==="request"&&(this.commandReqId+=1);const $=this.commandReqId,Vt=this.reqId;if(!Vt||!this.websocket)throw new EE(rE.UNEXPECTED_ERROR);const zt=WP({command:s,sdkVersion:i0==="4.21.0"?"0.0.1":i0,seq:Vt,requestId:Vt,allocate:g,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},d);if(this.websocket.state==="closed")throw new EE(rE.WS_DISCONNECT);const _e=()=>new GE((_a,_c)=>{this.websocket.once(c_.CLOSED,()=>_c(new EE(rE.WS_ABORT))),this.websocket.once(c_.CONNECTED,_a)});this.websocket.state!=="connected"&&await _e(),zt.clientRequest&&(zt.clientRequest.workerToken=this.token);const _r=new GE((_a,_c)=>{const tE=()=>{_c(new EE(rE.WS_ABORT))};this.websocket.once(c_.RECONNECTING,tE),this.websocket.once(c_.CLOSED,tE),this.once("@".concat(Vt,"-").concat(this.spec.sid),_p=>{_a(_p)})});b&&t_.workerEvent(this.spec.sid,WP(WP({},b),{},{requestId:$,actionType:"request",payload:JSON.stringify(d.clientRequest),serverCode:0,code:0}));const _o=Date.now();this.websocket.sendMessage(zt);let ga=null;try{ga=await _r}catch(_a){if(this.websocket.state==="closed")throw _a;return await _e(),await this.request(s,d,g)}return b&&t_.workerEvent(this.spec.sid,WP(WP({},b),{},{requestId:$,actionType:"response",payload:JSON.stringify(ga.serverResponse),serverCode:ga.code,success:ga.code===200,responseTime:Date.now()-_o})),ga.code!==200&&this.handleResponseError(ga),ga}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const s=i0==="4.21.0"?"0.0.1":i0;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:s,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(s){switch(s.code){case US.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void _l.warning("live stream response already exists stream");case US.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case US.LIVE_STREAM_RESPONSE_BAD_STREAM:case US.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new EE(rE.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:s.code}).throw();case US.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(s.serverResponse.command==="UnpublishStream"||s.serverResponse.command==="UninjectStream")return;throw new EE(rE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case US.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new EE(rE.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:s.code}).throw();case US.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const d=new EE(rE.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(hR.WARNING,d,s.serverResponse.url)}case US.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const d=new EE(rE.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(hR.WARNING,d,s.serverResponse.url)}case US.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new EE(rE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case US.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new EE(rE.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:s.code}).throw();case US.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const d=new EE(rE.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(hR.WARNING,d,s.serverResponse.url)}case US.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new EE(rE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:s.code}).throw();case US.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new EE(rE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case US.LIVE_STREAM_RESPONSE_WORKER_LOST:case US.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(s.serverResponse.command==="UnpublishStream"||s.serverResponse.command==="UninjectStream")return;throw new EE(rE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case US.ERROR_FAIL_SEND_MESSAGE:if(s.serverResponse.command==="UnpublishStream"||s.serverResponse.command==="UninjectStream")return;if(s.serverResponse.command==="UpdateTranscoding"||s.serverResponse.command==="ControlStream")return new EE(rE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:s.code}).throw();throw new EE(rE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case US.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case US.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case US.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case US.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new EE(rE.LIVE_STREAMING_CDN_ERROR,"",{code:s.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(TD)},6e3)}}function dJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function IT(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?dJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):dJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}class hht extends nS{constructor(s){let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:CS,g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:CS;super(),Qm(this,"onLiveStreamWarning",void 0),Qm(this,"onLiveStreamError",void 0),Qm(this,"onInjectStatusChange",void 0),Qm(this,"spec",void 0),Qm(this,"retryTimeout",1e4),Qm(this,"connection",void 0),Qm(this,"httpRetryConfig",void 0),Qm(this,"wsRetryConfig",void 0),Qm(this,"streamingTasks",new Map),Qm(this,"isStartingStreamingTask",!1),Qm(this,"taskMutex",new KS("live-streaming")),Qm(this,"cancelToken",RT.CancelToken.source()),Qm(this,"transcodingConfig",void 0),Qm(this,"injectConfig",IT({},zct)),Qm(this,"injectLoopTimes",0),Qm(this,"uapResponse",void 0),Qm(this,"lastTaskId",1),Qm(this,"statusError",new Map),this.spec=s,this.httpRetryConfig=g,this.wsRetryConfig=d}async setTranscodingConfig(s){const d=IT(IT({},Kct),s);d.videoCodecProfile!==66&&d.videoCodecProfile!==77&&d.videoCodecProfile!==100&&(_l.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(d.videoCodecProfile," -> 100")),d.videoCodecProfile=100),d.transcodingUsers||(d.transcodingUsers=d.userConfigs),d.transcodingUsers&&(d.transcodingUsers=d.transcodingUsers.map(Vt=>IT(IT(IT({},Hct),Vt),{},{zOrder:Vt.zOrder?Vt.zOrder+1:1}))),function(Vt){dS(Vt.width)||W_(Vt.width,"config.width",0,1e4),dS(Vt.height)||W_(Vt.height,"config.height",0,1e4),dS(Vt.videoBitrate)||W_(Vt.videoBitrate,"config.videoBitrate",1,1e6),dS(Vt.videoFrameRate)||W_(Vt.videoFrameRate,"config.videoFrameRate"),dS(Vt.lowLatency)||NR(Vt.lowLatency,"config.lowLatency"),dS(Vt.audioSampleRate)||VS(Vt.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),dS(Vt.audioBitrate)||W_(Vt.audioBitrate,"config.audioBitrate",1,128),dS(Vt.audioChannels)||VS(Vt.audioChannels,"config.audioChannels",[1,2,3,4,5]),dS(Vt.videoGop)||W_(Vt.videoGop,"config.videoGop"),dS(Vt.videoCodecProfile)||VS(Vt.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),dS(Vt.userCount)||W_(Vt.userCount,"config.userCount",0,17),dS(Vt.backgroundColor)||W_(Vt.backgroundColor,"config.backgroundColor",0,16777215),dS(Vt.userConfigExtraInfo)||QS(Vt.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),Vt.transcodingUsers&&!dS(Vt.transcodingUsers)&&(kR(Vt.transcodingUsers,"config.transcodingUsers"),Vt.transcodingUsers.forEach((zt,_e)=>{PD(zt.uid),dS(zt.x)||W_(zt.x,"transcodingUser[".concat(_e,"].x"),0,1e4),dS(zt.y)||W_(zt.y,"transcodingUser[".concat(_e,"].y"),0,1e4),dS(zt.width)||W_(zt.width,"transcodingUser[".concat(_e,"].width"),0,1e4),dS(zt.height)||W_(zt.height,"transcodingUser[".concat(_e,"].height"),0,1e4),dS(zt.zOrder)||W_(zt.zOrder-1,"transcodingUser[".concat(_e,"].zOrder"),0,100),dS(zt.alpha)||W_(zt.alpha,"transcodingUser[".concat(_e,"].alpha"),0,1,!1)})),dS(Vt.watermark)||BV(Vt.watermark,"watermark"),dS(Vt.backgroundImage)||BV(Vt.backgroundImage,"backgroundImage"),Vt.images&&!dS(Vt.images)&&(kR(Vt.images,"config.images"),Vt.images.forEach((zt,_e)=>{BV(zt,"images[".concat(_e,"]"))}))}(d);const g=[];d.images&&g.push(...d.images.map(Vt=>IT(IT(IT({},FV),Vt),{},{zOrder:255}))),d.backgroundImage&&(g.push(IT(IT(IT({},FV),d.backgroundImage),{},{zOrder:0})),delete d.backgroundImage),d.watermark&&(g.push(IT(IT(IT({},FV),d.watermark),{},{zOrder:255})),delete d.watermark),d.images=g,d.transcodingUsers&&(d.userConfigs=d.transcodingUsers.map(Vt=>IT({},Vt)),d.userCount=d.transcodingUsers.length,delete d.transcodingUsers);const b=(d.userConfigs||[]).map(Vt=>typeof Vt.uid=="number"?GE.resolve(Vt.uid):X4(Vt.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await GE.all(b)).forEach((Vt,zt)=>{d.userConfigs&&d.userConfigs[zt]&&(d.userConfigs[zt].uid=Vt)}),this.transcodingConfig=d,this.connection)try{var $;const Vt=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(q0($=this.streamingTasks).call($)).map(zt=>zt.taskId).join("#")});_l.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(Vt.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(Vt){if(!Vt.data||!Vt.data.retry)throw Vt;Vt.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(zt=>{_l.warning("[".concat(this.spec.clientId,"] live streaming receive error"),Vt.toString(),"try to republish",zt.url),this.startLiveStreamingTask(zt.url,zt.mode,Vt).then(()=>{_l.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(zt.url," success"))}).catch(_e=>{_l.error("[".concat(this.spec.clientId,"] live streaming republish failed"),zt.url,_e.toString()),this.onLiveStreamError&&this.onLiveStreamError(zt.url,_e)})})}}setInjectStreamConfig(s,d){this.injectConfig=Object.assign({},this.injectConfig,s),this.injectLoopTimes=d}async startLiveStreamingTask(s,d,g){var b;if(Array.from(q0(b=this.streamingTasks).call(b)).find(_r=>_r.mode===YS.INJECT)&&d===YS.INJECT)return new EE(rE.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&d===YS.TRANSCODE)throw new EE(rE.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let Vt={command:"PublishStream",ts:Date.now(),url:s,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};_l.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(s,", mode: ").concat(d));const zt=await this.taskMutex.lock();if(!this.connection&&g)return void zt();if(this.streamingTasks.get(s)&&!g)return zt(),new EE(rE.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(d))}catch(_r){throw zt(),_r}switch(d){case YS.TRANSCODE:Vt.transcodingConfig=IT({},this.transcodingConfig);break;case YS.RAW:break;case YS.INJECT:Vt={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:s,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(Vt.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const _e=this.lastTaskId++;try{const _r=new GE((ga,_a)=>{WS(this.retryTimeout).then(()=>{if(g)return _a(g);const _c=this.statusError.get(s);return _c?(this.statusError.delete(s),_a(_c)):void 0})}),_o=await GE.race([this.connection.request("request",{clientRequest:Vt},!0,{url:s,command:"PublishStream",workerType:d===YS.TRANSCODE?1:2,requestByUser:!g,tid:_e.toString()}),_r]);this.isStartingStreamingTask=!1,_l.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_o.code)),this.streamingTasks.set(s,{clientRequest:Vt,mode:d,url:s,taskId:_e}),zt()}catch(_r){if(zt(),this.isStartingStreamingTask=!1,!_r.data||!_r.data.retry||g)throw _r;return _r.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(s,d,_r)):await this.startLiveStreamingTask(s,d,_r)}}stopLiveStreamingTask(s){return new GE((d,g)=>{const b=this.streamingTasks.get(s);if(!b||!this.connection)return new EE(rE.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const $=b.mode;b.abortTask=()=>{_l.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(s),d()},this.connection.request("request",{clientRequest:{command:$===YS.INJECT?"UninjectStream":"UnpublishStream",url:b.url}},!1,{url:s,command:"UnPublishStream",workerType:$===YS.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(Vt=>{_l.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(Vt.code)),this.streamingTasks.delete(s),this.streamingTasks.size===0&&$!==YS.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),d(),$===YS.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(WO.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,s)}).catch(g)})}async controlInjectStream(s,d,g,b){const $=this.streamingTasks.get(s);if(!$||!this.connection||$.mode!==YS.INJECT)throw new EE(rE.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:s,control:d,audioVolume:g,position:b}})).serverResponse}resetAllTask(){var s;const d=Array.from(q0(s=this.streamingTasks).call(s));this.terminate();for(const g of d)this.startLiveStreamingTask(g.url,g.mode).catch(b=>{this.onLiveStreamError&&this.onLiveStreamError(g.url,b)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=RT.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(s){if(this.connection)throw new EE(rE.UNEXPECTED_ERROR,"live streaming connection has already connected");const d=await kS(this,DD.REQUEST_WORKER_MANAGER_LIST,s);return this.uapResponse=d,this.connection=new dht(d.workerToken,this.spec,this.wsRetryConfig,s),this.connection.on(hR.WARNING,(g,b)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(b,g)),this.connection.on(hR.PUBLISH_STREAM_STATUS,g=>this.handlePublishStreamServer(g)),this.connection.on(hR.INJECT_STREAM_STATUS,g=>this.handleInjectStreamServerStatus(g)),this.connection.on(hR.REQUEST_NEW_ADDRESS,(g,b)=>{if(!this.connection)return b(new EE(rE.UNEXPECTED_ERROR,"can not get new live streaming address list"));kS(this,DD.REQUEST_WORKER_MANAGER_LIST,s).then($=>{this.uapResponse=$,g($.addressList)}).catch(b)}),await this.connection.init(d.addressList),this.connection}handlePublishStreamServer(s){const d=s.serverStatus&&s.serverStatus.url||"empty_url",g=this.streamingTasks.get(d),b=s.reason;switch(s.code){case US.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case US.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case US.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case US.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const Vt=new EE(rE.LIVE_STREAMING_CDN_ERROR,"",{code:s.code});if(g)return _l.error(Vt.toString()),this.onLiveStreamError&&this.onLiveStreamError(d,Vt);if(!this.isStartingStreamingTask)return;this.statusError.set(d,Vt)}case US.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const Vt=new EE(rE.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,b);return this.onLiveStreamWarning&&this.onLiveStreamWarning(d,Vt)}case US.LIVE_STREAM_RESPONSE_WORKER_LOST:case US.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var $;if(!this.connection)return;this.connection.tryNextAddress();const Vt=Array.from(q0($=this.streamingTasks).call($));for(const zt of Vt)zt.abortTask?zt.abortTask():(_l.warning("[".concat(this.spec.clientId,"] publish stream status code"),s.code,"try to republish",zt.url),this.startLiveStreamingTask(zt.url,zt.mode,new EE(rE.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:s.code})).then(()=>{_l.debug("[".concat(this.spec.clientId,"] republish live stream success"),zt.url)}).catch(_e=>{_l.error(_e.toString()),this.onLiveStreamError&&this.onLiveStreamError(zt.url,_e)}));return}}}handleInjectStreamServerStatus(s){const d=Number(s.uid),g=s.serverStatus&&s.serverStatus.url;switch(s.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(WO.INJECT_STREAM_STATUS_START_SUCCESS,d,g));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(WO.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,d,g),void this.streamingTasks.delete(g);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(WO.INJECT_STREAM_STATUS_START_UNAUTHORIZED,d,g),void this.streamingTasks.delete(g);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(WO.INJECT_STREAM_STATUS_BROKEN,d,g),void this.streamingTasks.delete(g);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(WO.INJECT_STREAM_STATUS_START_TIMEOUT,d,g),void this.streamingTasks.delete(g);default:return void _l.debug("inject stream server status",s)}}hasUrl(s){return this.streamingTasks.has(s)}}class hJ{constructor(){Qm(this,"destChannelMediaInfos",new Map),Qm(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(s){R4(s),this.srcChannelMediaInfo=s}addDestChannelInfo(s){R4(s),this.destChannelMediaInfos.set(s.channelName,s)}removeDestChannelInfo(s){ND(s),this.destChannelMediaInfos.delete(s)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function pJ(o){if(!(o instanceof hJ))return new EE(rE.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const s=o.getSrcChannelMediaInfo(),d=o.getDestChannelMediaInfo();if(!s)return new EE(rE.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(d.size===0)return new EE(rE.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class pht extends nS{constructor(s,d,g){super(),Qm(this,"ws",void 0),Qm(this,"requestId",1),Qm(this,"heartBeatTimer",void 0),Qm(this,"joinInfo",void 0),Qm(this,"clientId",void 0),Qm(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Qm(this,"onClose",b=>{this.emit("close"),this.dispose()}),Qm(this,"onMessage",b=>{const $=JSON.parse(b.data);if(!$||$.command!=="serverResponse"||!$.requestId)return $&&$.command==="serverStatus"&&$.serverStatus&&$.serverStatus.command?(this.emit("status",$.serverStatus),void this.emit($.serverStatus.command,$.serverStatus)):void 0;this.emit("req_".concat($.requestId),$)}),this.joinInfo=s,this.clientId=d,this.ws=new lP("cross-channel-".concat(this.clientId),g),this.ws.on(c_.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(c_.CONNECTED,this.onOpen),this.ws.on(c_.ON_MESSAGE,this.onMessage),this.ws.on(c_.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(s){const d=this.requestId++;return s.requestId=d,s.seq=d,this.ws.sendMessage(s),d}waitStatus(s){return new GE((d,g)=>{const b=window.setTimeout(()=>{g(new EE(rE.TIMEOUT,"wait status timeout, status: ".concat(s)))},5e3);this.once(s,$=>{window.clearTimeout(b),$.state&&$.state!==0?g(new EE(rE.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(s))):d(void 0)}),this.once("dispose",()=>{window.clearTimeout(b),g(new EE(rE.WS_ABORT))})})}async request(s){if(this.ws.state==="closed")throw new EE(rE.WS_DISCONNECT);const d=()=>new GE((Vt,zt)=>{this.ws.once(c_.CLOSED,()=>zt(new EE(rE.WS_ABORT))),this.ws.once(c_.CONNECTED,Vt)});this.ws.state!=="connected"&&await d();const g=this.sendMessage(s),b=new GE((Vt,zt)=>{const _e=()=>{zt(new EE(rE.WS_ABORT))};this.ws.once(c_.RECONNECTING,_e),this.ws.once(c_.CLOSED,_e),this.once("req_".concat(g),Vt),WS(3e3).then(()=>{this.removeAllListeners("req_".concat(g)),this.ws.off(c_.RECONNECTING,_e),this.ws.off(c_.CLOSED,_e),zt(new EE(rE.TIMEOUT,"cross channel ws request timeout"))})}),$=await b;if(!$||$.code!==200)throw new EE(rE.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify($)));return $}async connect(s){this.ws.removeAllListeners(c_.REQUEST_NEW_URLS),this.ws.on(c_.REQUEST_NEW_URLS,d=>{d(s)}),await this.ws.init(s)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(s){const d=this.requestId++;return s.requestId=d,this.ws.sendMessage(s),d}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class fht extends nS{set state(s){s!==this._state&&(s!==NT.RELAY_STATE_FAILURE&&(this.errorCode=qO.RELAY_OK),this.emit("state",s,this.errorCode),this._state=s)}get state(){return this._state}constructor(s,d,g,b,$){super(),Qm(this,"joinInfo",void 0),Qm(this,"sid",void 0),Qm(this,"clientId",void 0),Qm(this,"cancelToken",RT.CancelToken.source()),Qm(this,"workerToken",void 0),Qm(this,"requestId",0),Qm(this,"signal",void 0),Qm(this,"prevChannelMediaConfig",void 0),Qm(this,"httpRetryConfig",void 0),Qm(this,"_resolution",void 0),Qm(this,"_state",NT.RELAY_STATE_IDLE),Qm(this,"errorCode",qO.RELAY_OK),Qm(this,"onStatus",Vt=>{_l.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(Vt))),Vt&&Vt.command&&(Vt.command==="onAudioPacketReceived"&&this.emit("event",PR.PACKET_RECEIVED_AUDIO_FROM_SRC),Vt.command==="onVideoPacketReceived"&&this.emit("event",PR.PACKET_RECEIVED_VIDEO_FROM_SRC),Vt.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=qO.SRC_TOKEN_EXPIRED,this.state=NT.RELAY_STATE_FAILURE),Vt.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=qO.DEST_TOKEN_EXPIRED,this.state=NT.RELAY_STATE_FAILURE))}),Qm(this,"onReconnect",async()=>{_l.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",PR.NETWORK_DISCONNECTED),this.state=NT.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(Vt=>{this.state!==NT.RELAY_STATE_IDLE&&(_l.error("auto restart channel media relay failed",Vt.toString()),this.errorCode=qO.SERVER_CONNECTION_LOST,this.state=NT.RELAY_STATE_FAILURE)})}),this.joinInfo=s,this.clientId=d,this.sid=oP(),this.signal=new pht(this.joinInfo,this.clientId,g),this.httpRetryConfig=b,this._resolution=$}async startChannelMediaRelay(s){if(this.state!==NT.RELAY_STATE_IDLE)throw new EE(rE.INVALID_OPERATION);this.state=NT.RELAY_STATE_CONNECTING,await this.connect(),_l.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(s)}catch(d){throw d.data&&d.data.serverResponse&&d.data.serverResponse.command==="SetSourceChannel"?new EE(rE.CROSS_CHANNEL_FAILED_JOIN_SRC):d.data&&d.data.serverResponse&&d.serverResponse.command==="SetDestChannelStatus"?new EE(rE.CROSS_CHANNEL_FAILED_JOIN_DEST):d.data&&d.data.serverResponse&&d.serverResponse.command==="StartPacketTransfer"?new EE(rE.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):d}this.prevChannelMediaConfig=s}async updateChannelMediaRelay(s){if(this.state!==NT.RELAY_STATE_RUNNING)throw new EE(rE.INVALID_OPERATION);await this.sendUpdateMessage(s),this.prevChannelMediaConfig=s}async setVideoProfile(s){if(this._resolution=s,this.state!==NT.RELAY_STATE_RUNNING)throw new EE(rE.INVALID_OPERATION);const d=this.genMessage(yT.SetVideoProfile);await this.signal.request(d),_l.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),_l.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=NT.RELAY_STATE_IDLE,this.dispose()}dispose(){_l.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=RT.CancelToken.source(),this.state=NT.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const s=await put(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=s.workerToken,await this.signal.connect(s.addressList),this.emit("event",PR.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(s){const d=this.genMessage(yT.StopPacketTransfer);await this.signal.request(d),await this.signal.waitStatus("Normal Quit"),_l.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const g=this.genMessage(yT.SetSdkProfile,s);await this.signal.request(g),_l.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const b=this.genMessage(yT.SetSourceChannel,s);await this.signal.request(b),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",PR.PACKET_JOINED_SRC_CHANNEL),_l.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const $=this.genMessage(yT.SetSourceUserId,s);await this.signal.request($),_l.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const Vt=this.genMessage(yT.SetDestChannel,s);await this.signal.request(Vt),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",PR.PACKET_JOINED_DEST_CHANNEL),_l.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const zt=this.genMessage(yT.StartPacketTransfer,s);await this.signal.request(zt),this.emit("event",PR.PACKET_SENT_TO_DEST_CHANNEL),this.state=NT.RELAY_STATE_RUNNING,_l.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(s){const d=this.genMessage(yT.UpdateDestChannel,s);await this.signal.request(d),this.emit("event",PR.PACKET_UPDATE_DEST_CHANNEL),_l.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const s=this.genMessage(yT.StopPacketTransfer);await this.signal.request(s),_l.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(s,d){const g=[],b=[],$=[];this.requestId+=1;const Vt={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:i0,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};Vt.sdkVersion==="4.21.0"&&(Vt.sdkVersion="0.0.1");let zt=null,_e=null;switch(s){case yT.SetSdkProfile:return Vt.clientRequest={command:"SetSdkProfile",type:"multi_channel"},Vt;case yT.SetSourceChannel:if(_e=d&&d.getSrcChannelMediaInfo(),!_e)throw new EE(rE.UNEXPECTED_ERROR,"can not find source config");return Vt.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_e.channelName,token:_e.token||this.joinInfo.appId},Vt;case yT.SetSourceUserId:if(_e=d&&d.getSrcChannelMediaInfo(),!_e)throw new EE(rE.UNEXPECTED_ERROR,"can not find source config");return Vt.clientRequest={command:"SetSourceUserId",uid:_e.uid+""},Vt;case yT.SetDestChannel:if(zt=d&&d.getDestChannelMediaInfo(),!zt)throw new EE(rE.UNEXPECTED_ERROR,"can not find dest config");return zt.forEach(_r=>{g.push(_r.channelName),b.push(_r.uid+""),$.push(_r.token||this.joinInfo.appId)}),Vt.clientRequest={command:"SetDestChannel",channelName:g,uid:b,token:$},Vt;case yT.StartPacketTransfer:return Vt.clientRequest={command:"StartPacketTransfer"},Vt;case yT.Reconnect:return Vt.clientRequest={command:"Reconnect"},Vt;case yT.StopPacketTransfer:return Vt.clientRequest={command:"StopPacketTransfer"},Vt;case yT.UpdateDestChannel:if(zt=d&&d.getDestChannelMediaInfo(),!zt)throw new EE(rE.UNEXPECTED_ERROR,"can not find dest config");return zt.forEach(_r=>{g.push(_r.channelName),b.push(_r.uid+""),$.push(_r.token||this.joinInfo.appId)}),Vt.clientRequest={command:"UpdateDestChannel",channelName:g,uid:b,token:$},Vt;case yT.SetVideoProfile:Vt.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return Vt}}function wL(o){var s={},d=!1;function g(b,$){return d=!0,{done:!1,value:new rG($=new iG(function(Vt){Vt(o[b]($))}),1)}}return s[kO!==void 0&&xH||"@@iterator"]=function(){return this},s.next=function(b){return d?(d=!1,b):g("next",b)},typeof o.throw=="function"&&(s.throw=function(b){if(d)throw d=!1,b;return g("throw",b)}),typeof o.return=="function"&&(s.return=function(b){return d?(d=!1,b):g("return",b)}),s}var fJ=j(R9);function mJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function EJ(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?mJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):mJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}var J_;function gJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function _J(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?gJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):gJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}let _N=(J_=class YP extends MD{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(s=>s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").filter(s=>{var d;return KE(d=Object.keys(BO)).call(d,s)}))]}constructor(s,d){super(s,d),Qm(this,"store",void 0),Qm(this,"peerConnection",void 0),Qm(this,"remoteSDP",void 0),Qm(this,"initialOffer",void 0),Qm(this,"statsFilter",void 0),Qm(this,"useRTX",!1),Qm(this,"localCapabilities",void 0),Qm(this,"localCandidateCount",0),Qm(this,"allCandidatesReceived",!1),Qm(this,"establishPromise",void 0),Qm(this,"mutex",new KS("P2PConnection-mutex")),this.store=d,this.peerConnection=new RTCPeerConnection(YP.resolvePCConfiguration(s),{optional:[{googDscp:!0}]}),this.statsFilter=yL(this.peerConnection,cE("STATS_UPDATE_INTERVAL"),void 0,H_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const s=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const d=X0(s.sdp),g=BP(s.sdp,{filterRTX:!this.useRTX,filterVideoFec:cE("FILTER_VIDEO_FEC"),filterAudioFec:cE("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=g,this.initialOffer=s,_J(_J({},d),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:g},offerSDP:s.sdp})}catch(s){throw new TE(rE.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(s,d,g,b,$,Vt){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(_e){Qm(this,"sessionDesc",void 0),Qm(this,"localCapabilities",void 0),Qm(this,"rtpCapabilities",void 0),Qm(this,"candidates",void 0),Qm(this,"iceParameters",void 0),Qm(this,"dtlsParameters",void 0),Qm(this,"setup",void 0),Qm(this,"currentMidIndex",void 0),Qm(this,"cname",void 0),_e=Q_(_e);const{remoteIceParameters:_r,remoteDtlsParameters:_o,candidates:ga,remoteRTPCapabilities:_a,remoteSetup:_c,localCapabilities:tE,sdkCodec:_p,cname:_f}=_e,eE=iS.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=_a,this.candidates=ga,this.iceParameters=_r,this.dtlsParameters=_o,this.setup=_c,this.localCapabilities=tE,this.cname=_f;for(let iE=0;iE<eE.mediaDescriptions.length;iE++){const fE=eE.mediaDescriptions[iE];if(fE.attributes.iceUfrag=_r.iceUfrag,fE.attributes.icePwd=_r.icePwd,fE.attributes.fingerprints=_o.fingerprints,fE.attributes.candidates=ga,fE.attributes.setup=_c,fE.media.mediaType==="video"){fE.media.fmts=_a.videoCodecs.map(_E=>_E.payloadType.toString(10));let mE=_a.videoCodecs.filter(_E=>{var SE,wE;return(SE=_E.rtpMap)===null||SE===void 0?void 0:KE(wE=SE.encodingName.toLowerCase()).call(wE,_p)});mE.length===0&&(mE=_a.videoCodecs),fE.attributes.payloads=mE,fE.attributes.extmaps=_a.videoExtensions}fE.media.mediaType==="audio"&&(fE.media.fmts=_a.audioCodecs.map(mE=>mE.payloadType.toString(10)),fE.attributes.payloads=_a.audioCodecs,fE.attributes.extmaps=_a.audioExtensions),eE.mediaDescriptions[iE]=this.mungMediaDesc(fE)}this.sessionDesc=eE,this.currentMidIndex=eE.mediaDescriptions.length-1}toString(){return iS.print(this.sessionDesc)}send(_e,_r,_o){const{ssrcs:ga,ssrcGroups:_a}=t0(_r,this.cname),_c=this.sessionDesc.mediaDescriptions.find(_f=>_e===_g.VIDEO?_f.media.mediaType==="video":_f.media.mediaType==="audio"),tE=ga[0].attributes.label,_p=ga[0].attributes.mslabel;return _c.attributes.ssrcs=_c.attributes.ssrcs.concat(ga),_c.attributes.ssrcGroups=_c.attributes.ssrcGroups.concat(_a),{id:tE,mslabel:_p}}batchSend(_e){return _e.map(_r=>{let{kind:_o,ssrcMsg:ga}=_r;return this.send(_o,ga,void 0)})}stopSending(_e){this.sessionDesc.mediaDescriptions.forEach(_r=>{const _o=[],ga=[],_a=[];_r.attributes.ssrcs.forEach(_c=>{KE(_e).call(_e,_c.attributes.label||"")?_a.push(_c):_o.push(_c)}),_r.attributes.ssrcGroups.forEach(_c=>{var tE;KE(tE=_a.map(_p=>_p.ssrcId)).call(tE,_c.ssrcIds[0])||ga.push(_c)}),_r.attributes.ssrcs=_o,_r.attributes.ssrcGroups=ga})}mute(_e){const _r=this.sessionDesc.mediaDescriptions.find(_o=>_o.attributes.mid===_e);if(!_r)throw new Error("mediaDescription not found with ".concat(_e," in remote SDP when calling RemoteSDP.mute."));_r.attributes.direction="inactive"}unmute(_e){const _r=this.sessionDesc.mediaDescriptions.find(_o=>_o.attributes.mid===_e);if(!_r)throw new Error("mediaDescription not found with ".concat(_e," in remote SDP when calling RemoteSDP.unmute."));_r.attributes.direction="sendonly"}receive(_e,_r,_o){_e.forEach((ga,_a)=>{const _c=ga._mediaStreamTrack,tE=this.sessionDesc.mediaDescriptions.findIndex(_f=>_f.attributes.mid===_c.kind),_p=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[tE],ga);this.sessionDesc.mediaDescriptions[tE]=_p})}stopReceiving(_e){}updateCandidates(_e){_e===hT.TCP?this.candidates.forEach(_r=>{this.candidates.findIndex(_o=>_o.transport==="tcp"&&_o.connectionAddress===_r.connectionAddress&&_o.port===_r.port)===-1&&this.candidates.push(EJ(EJ({},_r),{},{foundation:"tcpcandidate",priority:Number(_r.priority)-1+"",transport:"tcp",port:Number(_r.port)+90+""}))}):this.candidates=this.candidates.filter(_r=>_r.transport!=="tcp");for(const _r of this.sessionDesc.mediaDescriptions)_r.attributes.candidates=this.candidates}restartICE(_e){_e=Q_(_e),this.iceParameters=_e,this.sessionDesc.mediaDescriptions.forEach(_r=>{_r.attributes.iceUfrag=_e.iceUfrag,_r.attributes.icePwd=_e.icePwd})}predictReceivingMids(_e){const _r=[];for(let _o=0;_o<_e;_o++)_r.push((this.currentMidIndex+_o+1).toString(10));return _r}mungRecvMediaDsec(_e,_r){const _o=Q_(_e);return mI(_o,_r),TL(_o,_r),_o}updateRecvMedia(_e,_r){const _o=this.sessionDesc.mediaDescriptions.findIndex(ga=>ga.attributes.mid===_e);if(_o!==-1){const ga=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_o],_r);this.sessionDesc.mediaDescriptions[_o]=ga}}bumpMid(_e){this.currentMidIndex+=_e}updateTrackLabel(_e,_r,_o){const ga=this.sessionDesc.mediaDescriptions.find(_c=>_e===_g.VIDEO?_c.attributes.mid==="video":_c.attributes.mid==="audio");if(ga){const _c=ga.attributes.ssrcs.find(tE=>tE.attributes.label===_r);var _a;_c&&(_c.attributes.label=_o,(_a=_c.attributes.msid)===null||_a===void 0||_a.replace(_r,_o))}}mungMediaDesc(_e){const _r=Q_(_e);return SL(_r),function(_o){const ga=_o.attributes.extmaps.find(_a=>_a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");ga&&_o.attributes.extmaps.splice(_o.attributes.extmaps.indexOf(ga),1),_o.attributes.payloads.forEach(_a=>{const _c=_a.rtcpFeedbacks.findIndex(tE=>tE.type==="transport-cc");_c!==-1&&_a.rtcpFeedbacks.splice(_c,1)})}(_r),_r}getSSRC(_e){for(const _r of this.sessionDesc.mediaDescriptions)for(const _o of _r.attributes.ssrcs)if(_o.attributes.label===_e)return[_o]}}({remoteIceParameters:s,remoteDtlsParameters:d,candidates:g,remoteRTPCapabilities:b.send,remoteSetup:$,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:Vt});const zt=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:zt})}catch(zt){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(zt.toString()))}}async updateRemoteRTPCapabilities(s,d){throw new TE(rE.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(s,d){var g=this;return BT(function*(){const b=yield f_(g.mutex.lock());try{if(!g.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const $=s.map(_a=>g.peerConnection.addTrack(_a._mediaStreamTrack)),Vt=yield f_(g.peerConnection.createOffer()),zt=iS.parse(Vt.sdp),_e=s.map(_a=>{const _c=_a._mediaStreamTrack,tE=zt.mediaDescriptions.find(_p=>_p.attributes.mid===_c.kind);if(!tE)throw new Error("Cannot extract ssrc from mediaDescription.");return function(_p,_f,eE){const iE=_p.attributes.ssrcs.filter(mE=>mE.attributes.label===_f),fE=_p.attributes.ssrcGroups;if(iE.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(fE&&iE.length>1){const mE=fE.find(_E=>_E.ssrcIds.indexOf(iE[0].ssrcId)!==-1);return mE?[{ssrcId:mE.ssrcIds[0],rtx:eE?mE.ssrcIds[1]:void 0}]:[{ssrcId:iE[0].ssrcId}]}return[{ssrcId:iE[0].ssrcId}]}(tE,_c.id,g.useRTX)});let _r;try{_r=yield _e}catch(_a){throw $.forEach(_c=>{GS()&&_c.replaceTrack(null),g.peerConnection.removeTrack(_c)}),_a}const _o=g.mungSendOfferSDP(Vt.sdp,s);g.remoteSDP.receive(s,d,_r);const ga=g.remoteSDP.toString();return yield f_(g.peerConnection.setLocalDescription({type:"offer",sdp:_o})),yield f_(g.applySendEncodings($,s)),yield f_(g.peerConnection.setRemoteDescription({type:"answer",sdp:ga})),s.map((_a,_c)=>{const tE=_a._mediaStreamTrack.id;return{localSSRC:_e[_c],id:tE}})}catch($){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat($.toString()))}finally{b()}})()}async stopSending(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const d=this.peerConnection.getSenders().filter($=>{var Vt;return s.indexOf(((Vt=$.track)===null||Vt===void 0?void 0:Vt.id)||"")!==-1});if(d.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");d.map($=>{GS()&&$.replaceTrack(null),this.peerConnection.removeTrack($)});const g=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(g),this.remoteSDP.stopReceiving(s);const b=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(d.toString()))}}async receive(s,d,g,b){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(s," before remoteSDP created."));const{id:$,mslabel:Vt}=this.remoteSDP.send(s,d,b),zt=new GE((_o,ga)=>{const _a=setTimeout(()=>{ga(new Error("Cannot receive track, id: ".concat($)))},1e4),_c=tE=>{const _p=O_();if((_p.name==="Safari"&&Number(_p.version)===11||oT())&&tE.track.id!==$&&tE.streams[0].id===Vt){var _f;const eE=tE.streams[0].getTracks()[0];return(_f=this.remoteSDP)===null||_f===void 0||_f.updateTrackLabel(s,$,tE.track.id),this.peerConnection.removeEventListener("track",_c),clearTimeout(_a),void _o(eE)}if(tE.track.id===$)return this.peerConnection.removeEventListener("track",_c),clearTimeout(_a),void _o(tE.track)};this.peerConnection.addEventListener("track",_c)}),_e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_e});const _r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(_r),{track:await zt,id:$}}catch($){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat($.toString()))}}async stopReceiving(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(s);const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const g=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(g)}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(d.toString()))}}async muteRemote(s){}async unmuteRemote(s){}async muteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const d=this.peerConnection.getSenders().filter(g=>{var b;return s.indexOf(((b=g.track)===null||b===void 0?void 0:b.id)||"")!==-1});if(d.length!==s.length)throw new Error("sender' length doesn't match mids' length.");d.map(g=>{if(GS()&&g.track)g.track.enabled=!1;else{const b=g.getParameters();b.encodings.forEach($=>$.active=!1),g.setParameters(b)}})}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(d.toString()))}}async unmuteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const d=this.peerConnection.getSenders().filter($=>{var Vt;return s.indexOf(((Vt=$.track)===null||Vt===void 0?void 0:Vt.id)||"")!==-1});if(d.length!==s.length)throw new Error("Senders' length doesn't match mids' length.");d.map(async $=>{if(GS()&&$.track)$.track.enabled=!0;else{const Vt=$.getParameters();Vt.encodings.forEach(zt=>zt.active=!0),await $.setParameters(Vt)}});const g=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(g);const b=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(d.toString()))}}restartICE(s){var d=this;return BT(function*(){const g=yield f_(d.mutex.lock("From P2PConnection.restartICE"));try{if(!d.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(R_().supportPCSetConfiguration){const _e=d.peerConnection.getConfiguration(),_r=s===hT.RELAY?"relay":"all";_e.iceTransportPolicy!==_r&&(_l.debug("[".concat(d.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_e.iceTransportPolicy,"] to [").concat(_r,"]")),_e.iceTransportPolicy=_r,d.peerConnection.setConfiguration(_e))}else if(s===hT.RELAY)return;s!==hT.RELAY&&d.remoteSDP.updateCandidates(s);const b=yield f_(d.peerConnection.createOffer({iceRestart:!0}));if(!b.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const $=X0(b.sdp),{remoteIceParameters:Vt}=yield $.iceParameters;d.remoteSDP.restartICE(Vt);const zt=d.remoteSDP.toString();yield f_(d.peerConnection.setLocalDescription(b)),yield f_(d.peerConnection.setRemoteDescription({type:"answer",sdp:zt}))}catch(b){_l.warning("[".concat(d.store.clientId,"] restart ICE failed, abort operation"),b)}finally{g()}})()}close(){var s;this.peerConnection.close(),(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(s){return this.statsFilter.getVideoIsReady(s)}async updateEncoderConfig(s,d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const g=await this.peerConnection.createOffer(),b=this.mungSendOfferSDP(g.sdp,[d]);this.remoteSDP.updateRecvMedia(d._mediaStreamTrack.kind,d);const $=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:b}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:$})}catch(g){throw new TE(rE.EXCHANGE_SDP_FAILED,g.toString())}}async updateSendParameters(s,d){const g=this.peerConnection.getSenders().filter(b=>{var $;return(($=b.track)===null||$===void 0?void 0:$.id)===s});g.length===1&&await this.applySendEncodings(g,[d])}setStatsRemoteVideoIsReady(s,d){this.statsFilter.setVideoIsReady2(s,d)}async replaceTrack(s,d){const g=this.peerConnection.getSenders().find(b=>{var $;return(($=b.track)===null||$===void 0?void 0:$.id)===d});g&&await g.replaceTrack(s._mediaStreamTrack)}createDataChannels(s,d){throw new TE(rE.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(s){throw new TE(rE.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var s;(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var s;(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=s=>{s.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_l.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_l.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},cE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(s){const d={iceServers:[],sdpSemantics:"plan-b"};return s.iceServers?d.iceServers=s.iceServers:s.turnServer&&s.turnServer.mode!=="off"&&(jO(s.turnServer.servers)?d.iceServers=s.turnServer.servers:(d.iceServers&&d.iceServers.push(...YP.turnServerConfigToIceServers(s.turnServer.servers)),cE("USE_TURN_SERVER_OF_GATEWAY")&&d.iceServers&&s.turnServer.serversFromGateway&&d.iceServers.push(...YP.turnServerConfigToIceServers(s.turnServer.serversFromGateway)),s.turnServer.servers.concat(s.turnServer.serversFromGateway||[]).forEach(g=>{g.forceturn&&(d.iceTransportPolicy="relay")}))),d}static turnServerConfigToIceServers(s){const d=[];return s.forEach(g=>{g.security?g.tcpport&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(g.turnServerURL,":").concat(g.tcpport,"?transport=tcp")}):(g.udpport&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.udpport,"?transport=udp")}),g.tcpport&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.tcpport,"?transport=tcp")}))}),d}async updateRtpSenderEncodings(s,d){var g;if(d||(d=this.peerConnection.getSenders().find(_r=>{var _o;return((_o=_r.track)===null||_o===void 0?void 0:_o.id)===s._mediaStreamTrack.id})),!d)return _l.warn("[".concat(s.getTrackId(),"] no rtpSender found}"));if(!R_().supportSetRtpSenderParameters)return _l.warn("Browser not support set rtp-sender parameters");const b={},$={};if(s instanceof Y_)switch(s._optimizationMode){case"motion":b.degradationPreference="maintain-framerate";break;case"detail":b.degradationPreference="maintain-resolution";break;default:b.degradationPreference="balanced"}if(cE("DSCP_TYPE")&&tI()){var Vt;const _r=cE("DSCP_TYPE");KE(Vt=["very-low","low","medium","high"]).call(Vt,_r)&&($.networkPriority=_r)}const zt=d.getParameters(),_e=(g=zt.encodings)===null||g===void 0?void 0:g[0];_e&&Object.assign(_e,$),Object.assign(zt,b),_l.debug("[".concat(s.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(zt.encodings))),await d.setParameters(zt)}async applySendEncodings(s,d){try{if(!R_().supportSetRtpSenderParameters||s.length!==d.length)return;for(let g=0;g<s.length;g++){const b=s[g],$=d[g];b&&$&&await this.updateRtpSenderEncodings($,b)}}catch{_l.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(s,d){const g=iS.parse(s);return d.forEach((b,$)=>{const Vt=b._mediaStreamTrack,zt=g.mediaDescriptions.find(_e=>_e.attributes.mid===Vt.kind);zt&&mI(zt,b)}),iS.print(g)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=s=>{var d;(d=this.onFirstAudioReceived)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstVideoReceived=s=>{var d;(d=this.onFirstVideoReceived)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstAudioDecoded=s=>{var d;(d=this.onFirstAudioDecoded)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstVideoDecoded=(s,d,g)=>{var b;(b=this.onFirstVideoDecoded)===null||b===void 0||b.call(this,s,d,g)},this.statsFilter.onSelectedLocalCandidateChanged=(s,d)=>{var g;(g=this.onSelectedLocalCandidateChanged)===null||g===void 0||g.call(this,s,d)},this.statsFilter.onSelectedRemoteCandidateChanged=(s,d)=>{var g;(g=this.onSelectedRemoteCandidateChanged)===null||g===void 0||g.call(this,s,d)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const d=this.remoteSDP.batchSend(s).map(($,Vt)=>{let{id:zt,mslabel:_e}=$;const{kind:_r}=s[Vt];return new GE((_o,ga)=>{const _a=setTimeout(()=>{ga(new Error("Cannot receive track, id: ".concat(zt)))},1e4),_c=tE=>{const _p=O_();if(_p.name==="Safari"&&Number(_p.version)===11&&tE.track.id!==zt&&tE.streams[0].id===_e){var _f;const eE=tE.streams[0].getTracks()[0];return(_f=this.remoteSDP)===null||_f===void 0||_f.updateTrackLabel(_r,zt,tE.track.id),this.peerConnection.removeEventListener("track",_c),clearTimeout(_a),void _o({track:eE,id:zt})}if(tE.track.id===zt)return this.peerConnection.removeEventListener("track",_c),clearTimeout(_a),void _o({track:tE.track,id:zt})};this.peerConnection.addEventListener("track",_c)})}),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const b=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(b),await GE.all(d)}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async getRemoteSSRC(s){if(!this.remoteSDP)return;const d=this.remoteSDP.getSSRC(s);return d==null?void 0:d[0].ssrcId}setConfiguration(s){if(R_().supportPCSetConfiguration){const d=YP.resolvePCConfiguration(s);this.peerConnection.setConfiguration(d)}}},BE(J_.prototype,"connect",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"connect"),J_.prototype),BE(J_.prototype,"stopSending",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"stopSending"),J_.prototype),BE(J_.prototype,"receive",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"receive"),J_.prototype),BE(J_.prototype,"stopReceiving",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"stopReceiving"),J_.prototype),BE(J_.prototype,"muteRemote",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"muteRemote"),J_.prototype),BE(J_.prototype,"unmuteRemote",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"unmuteRemote"),J_.prototype),BE(J_.prototype,"muteLocal",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"muteLocal"),J_.prototype),BE(J_.prototype,"unmuteLocal",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"unmuteLocal"),J_.prototype),BE(J_.prototype,"close",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"close"),J_.prototype),BE(J_.prototype,"updateEncoderConfig",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"updateEncoderConfig"),J_.prototype),BE(J_.prototype,"updateSendParameters",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"updateSendParameters"),J_.prototype),BE(J_.prototype,"replaceTrack",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"replaceTrack"),J_.prototype),BE(J_.prototype,"getRemoteSSRC",[d0],Object.getOwnPropertyDescriptor(J_.prototype,"getRemoteSSRC"),J_.prototype),J_);function d0(o,s,d){const g=o[s];if(typeof g!="function")throw new Error("Cannot use mutex on object property.");return d.value=async function(){const b=this.mutex,$=await b.lock("Locking from P2PConnection.".concat(s));try{for(var Vt=arguments.length,zt=new Array(Vt),_e=0;_e<Vt;_e++)zt[_e]=arguments[_e];return await g.apply(this,zt)}finally{$()}},d}function vJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function vI(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?vJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):vJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}const qP="9",yJ=4e4;function SJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function GR(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?SJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):SJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}let IL=function(o){return o.BANDWIDTH="bandwidth",o.CPU="cpu",o.NONE="none",o.OTHER="other",o}({});var vN=function(o){return o[o.DOWN=0]="DOWN",o[o.UP=1]="UP",o}(vN||{});const OL=new Map;function TJ(o,s,d,g){let{scale:b}=o;if(b===0&&g===vN.UP||b>=s.length-1&&g===vN.DOWN)return o;let $=GR(GR({},o),{},{scale:g===vN.DOWN?++b:--b});switch(d){case"maintain-framerate":$=GR(GR({},$),s[b].motion);break;case"maintain-resolution":$=GR(GR({},$),s[b].detail);break;case"balanced":$=GR(GR({},$),s[b].balanced)}return $}function bJ(o,s){if(s){const d={overUse:0,underUse:0,adaptationList:RJ(s)};OL.set(o,d)}else OL.delete(o)}function RJ(o){const s=GR({},o),{bitrateMax:d,frameRate:g,scaleResolutionDownBy:b,bitrateMin:$}=s,{MIN_FRAME_RATE:Vt,MAX_THRESHOLD_FRAMERATE:zt,MAX_SCALE:_e,BITRATE_MIN_THRESHOLD:_r,BITRATE_MAX_THRESHOLD:_o,BWE_SCALE_UP_THRESHOLD:ga,BWE_SCALE_DOWN_THRESHOLD:_a,PERF_SCALE_DOWN_THRESHOLD:_c,PERF_SCALE_UP_THRESHOLD:tE,BALANCE_BITRATE_FACTOR:_p,BALANCE_FRAMERATE_FACTOR:_f,BALANCE_RESOLUTION_FACTOR:eE,MOTION_RESOLUTION_FACTOR:iE,MOTION_BITRATE_FACTOR:fE,DETAIL_FRAMERATE_FACTOR:mE,DETAIL_BITRATE_FACTOR:_E}=kV,SE=Math.min(s.frameRate,zt),wE=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(_a,1)*d),bwe_up:d,fps_down:Math.round(Math.pow(_c,1)*SE),fps_up:g},balanced:{scaleResolutionDownBy:1,frameRate:g,bitrateMax:d,bitrateMin:$},motion:{scaleResolutionDownBy:1,frameRate:g,bitrateMax:d,bitrateMin:$},detail:{scaleResolutionDownBy:1,frameRate:g,bitrateMax:d,bitrateMin:$}}];for(let NE=1;NE<=_e;NE++){const DE={bwe_up:Math.round(Math.pow(ga,NE)*d),bwe_down:Math.round(Math.pow(_a,NE+1)*d),fps_up:Math.round(Math.pow(tE,NE)*SE),fps_down:Math.round(Math.pow(_c,NE+1)*SE)},JE={scaleResolutionDownBy:b/Math.pow(eE,NE),frameRate:Math.max(Math.round(Math.pow(_f,NE)*g),Vt),bitrateMax:Math.max(Math.round(Math.pow(_p,NE)*d),_o),bitrateMin:Math.max(Math.round(Math.pow(_p,NE)*$),_r)},b_={scaleResolutionDownBy:b/Math.pow(iE,NE),frameRate:g,bitrateMax:Math.max(Math.round(Math.pow(fE,NE)*d),_o),bitrateMin:Math.max(Math.round(Math.pow(fE,NE)*$),_r)},L_={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(mE,NE)*g),Vt),bitrateMax:Math.max(Math.round(Math.pow(_E,NE)*d),_o),bitrateMin:Math.max(Math.round(Math.pow(_E,NE)*$),_r)};wE.push({scale:NE,threshold:DE,balanced:JE,motion:b_,detail:L_})}return wE}function mht(o,s,d,g,b,$){const Vt=OL.get(o)||{overUse:0,underUse:0,adaptationList:RJ(b)},{adaptationList:zt}=Vt;OL.set(o,Vt);const{OVERUSE_TIMES_THRESHOLD:_e,UNDERUSE_TIMES_THRESHOLD:_r}=kV,{scale:_o}=g;let ga,_a;return typeof s=="number"&&s>0&&function(_c,tE,_p,_f){if(tE>=_p.length)return!1;let{threshold:{fps_down:eE}}=_p[tE];return cE("FORCE_AG_HIGH_FRAMERATE")&&_f==="maintain-framerate"&&(eE=_p[0].threshold.fps_down),_c<eE}(s,_o,zt,$)&&(Vt.overUse++,_a=IL.CPU,Vt.overUse>_e)||typeof d=="number"&&d>0&&function(_c,tE,_p){if(tE>=_p.length)return!1;const{threshold:{bwe_down:_f}}=_p[tE];return _c<_f}(d,_o,zt)&&(Vt.overUse++,_a=IL.BANDWIDTH,Vt.overUse>_e)?(Vt.overUse=0,Vt.underUse=0,ga=TJ(g,zt,$,vN.DOWN),[ga,_a]):(typeof s=="number"&&s>0&&typeof d=="number"&&d>0&&function(_c,tE,_p,_f){if(tE===0)return;let{threshold:{fps_up:eE}}=_p[tE];return cE("FORCE_AG_HIGH_FRAMERATE")&&_f==="maintain-framerate"&&(eE=_p[1].threshold.fps_up),_c>eE}(s,_o,zt,$)&&function(_c,tE,_p){if(tE===0)return;const{threshold:{bwe_up:_f}}=_p[tE];return _c>_f}(d,_o,zt)&&(Vt.underUse++,Vt.underUse>_r&&(Vt.overUse=0,Vt.underUse=0,ga=TJ(g,zt,$,vN.UP),ga.scale===0&&(_a=IL.NONE))),[ga,_a])}function CJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function gG(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?CJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):CJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}function Eht(o){var s;return!!cE("ENABLE_AG_ADAPTATION")&&!!(o instanceof eG||KE(s=o._hints).call(s,Z_.CUSTOM_TRACK))&&(!!cE("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(d){const g=O_();if(g.os!==BS.IOS||!g.osVersion)return!1;const b=g.osVersion.split(".");return Number(b[0])>=d}(14)&&x8(17,4)||M8(14)&&U8(17,4)))}const AL=new Map;function NL(o){const s=AL.get(o);if(s){const{timer:d,adaptationFunc:g,originConfig:b}=s;window.clearTimeout(d),g(b),AL.delete(o)}bJ(o)}var A_;function wJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function yI(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?wJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):wJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}let tR=(A_=class JP extends MD{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var s,d;return(s=(d=this.peerConnection.getReceivers()[0])===null||d===void 0||(d=d.transport)===null||d===void 0?void 0:d.state)!==null&&s!==void 0?s:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(s=>s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").filter(s=>{var d;return KE(d=Object.keys(BO)).call(d,s)}))]}constructor(s,d){super(s,d),Qm(this,"store",void 0),Qm(this,"peerConnection",void 0),Qm(this,"id",z_(5,"connection-")),Qm(this,"remoteSDP",void 0),Qm(this,"initialOffer",void 0),Qm(this,"transportEventReceiver",void 0),Qm(this,"statsFilter",void 0),Qm(this,"useXR",cE("USE_XR")),Qm(this,"localCapabilities",void 0),Qm(this,"remoteCodecs",void 0),Qm(this,"localCandidateCount",0),Qm(this,"allCandidatesReceived",!1),Qm(this,"dataStreamChannelMap",new Map),Qm(this,"establishPromise",void 0),Qm(this,"recoveredDataChannelIds",[]),Qm(this,"currentDataChannelId",1),Qm(this,"mutex",new KS("P2PConnection-mutex")),Qm(this,"qualityLimitationReason",IL.NONE),this.store=d,this.peerConnection=new RTCPeerConnection(JP.resolvePCConfiguration(s),{optional:[{googDscp:!0}]}),this.statsFilter=yL(this.peerConnection,cE("STATS_UPDATE_INTERVAL"),void 0,H_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(s,d){if(this.remoteCodecs=d,!this.remoteSDP)return void _l.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(d));if(this.remoteSDP.updateRemoteCodec(s,d,this.store.codec)){const g=await this.peerConnection.createOffer(),b=this.logSDPExchange(g.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(g);const $=this.remoteSDP.toString();b==null||b($),await this.peerConnection.setRemoteDescription({type:"answer",sdp:$})}else _l.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const s=await this.peerConnection.createOffer();if(!s.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const d=X0(s.sdp),g=await hG({filterRTX:!cE("USE_PUB_RTX")&&!cE("USE_SUB_RTX"),filterVideoFec:cE("FILTER_VIDEO_FEC"),filterAudioFec:cE("FILTER_AUDIO_FEC"),filterVideoCodec:cE("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=gN(g),this.initialOffer=s,yI(yI({},d),{},{rtpCapabilities:g,offerSDP:s.sdp})}catch(s){throw new TE(rE.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(s,d,g,b,$,Vt){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return Q_(this._localCapabilities)}get rtpCapabilities(){return Q_(this._rtpCapabilities)}get candidates(){return Q_(this._candidates)}get iceParameters(){return Q_(this._iceParameters)}get dtlsParameters(){return Q_(this._dtlsParameters)}constructor(_c){Qm(this,"sessionDesc",void 0),Qm(this,"_localCapabilities",void 0),Qm(this,"_rtpCapabilities",void 0),Qm(this,"_candidates",void 0),Qm(this,"_iceParameters",void 0),Qm(this,"_dtlsParameters",void 0),Qm(this,"setup",void 0),Qm(this,"currentMidIndex",void 0),Qm(this,"cname",void 0),Qm(this,"firefoxSsrcMidMap",new Map),_c=Q_(_c);const{remoteIceParameters:tE,remoteDtlsParameters:_p,candidates:_f,remoteRTPCapabilities:eE,remoteSetup:iE,localCapabilities:fE,cname:mE}=_c,_E=iS.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=eE,this._candidates=_f,this._iceParameters=tE,this._dtlsParameters=_p,this._localCapabilities=fE,this.setup=iE,this.cname=mE;const SE=this.rtpCapabilities.send;for(const wE of _E.mediaDescriptions){if(wE.attributes.iceUfrag=tE.iceUfrag,wE.attributes.icePwd=tE.icePwd,wE.attributes.fingerprints=_p.fingerprints,wE.attributes.candidates=_f,wE.attributes.setup=iE,wE.media.mediaType==="video"&&(wE.media.fmts=SE.videoCodecs.map(NE=>NE.payloadType.toString(10)),wE.attributes.payloads=SE.videoCodecs,wE.attributes.extmaps=SE.videoExtensions,cE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:NE,ssrcGroups:DE}=t0([{ssrcId:yJ,rtx:cE("USE_SUB_RTX")?40001:void 0}],this.cname);wE.attributes.ssrcs=NE,wE.attributes.ssrcGroups=DE}if(wE.media.mediaType==="audio"&&(wE.media.fmts=SE.audioCodecs.map(NE=>NE.payloadType.toString(10)),wE.attributes.payloads=SE.audioCodecs,wE.attributes.extmaps=SE.audioExtensions,Q0(wE),cE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:NE,ssrcGroups:DE}=t0([{ssrcId:2e4}],this.cname);wE.attributes.ssrcs=NE,wE.attributes.ssrcGroups=DE}}this.sessionDesc=_E,this.currentMidIndex=_E.mediaDescriptions.length-1}preloadRemoteMedia(){const _c=cE("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const tE=this.candidates,_p=this.dtlsParameters,_f=this.iceParameters,eE=this.rtpCapabilities.send;for(let iE=1;iE<_c;iE++){const fE=2*iE+2e4,mE=2*iE+yJ,{ssrcs:_E,ssrcGroups:SE}=t0([{ssrcId:fE}],this.cname),{ssrcs:wE,ssrcGroups:NE}=t0([{ssrcId:mE,rtx:cE("USE_SUB_RTX")?mE+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:qP,protos:["UDP","TLS","RTP","SAVPF"],fmts:eE.videoCodecs.map(DE=>DE.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_f.iceUfrag,icePwd:_f.icePwd,unrecognized:[],candidates:tE,extmaps:eE.videoExtensions,fingerprints:_p.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:wE,ssrcGroups:NE,rtcpFeedbackWildcards:[],payloads:eE.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*iE)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:qP,protos:["UDP","TLS","RTP","SAVPF"],fmts:eE.audioCodecs.map(DE=>DE.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_f.iceUfrag,icePwd:_f.icePwd,unrecognized:[],candidates:tE,extmaps:eE.audioExtensions,fingerprints:_p.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_E,ssrcGroups:SE,rtcpFeedbackWildcards:[],payloads:eE.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*iE+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return iS.print(this.sessionDesc)}send(_c,tE,_p,_f){const{ssrcs:eE,ssrcGroups:iE}=t0(tE,this.cname,cE("SYNC_GROUP")?_p:void 0),fE=this.findPreloadMediaDesc(eE);if(fE){if(H_()&&this.firefoxSsrcMidMap.set(eE[0].ssrcId,fE.attributes.mid),_f&&(_f.twcc||_f.remb)){const mE=this.sessionDesc.mediaDescriptions.indexOf(fE);return this.sessionDesc.mediaDescriptions[mE]=this.mungSendMediaDesc(fE,_f),{mid:fE.attributes.mid,needExchangeSDP:!0}}return{mid:fE.attributes.mid,needExchangeSDP:!1}}{const mE=this.findAvailableMediaIndex(_c,eE);let _E;return mE===-1||mE===1&&(GS()||V8())||mE===0&&cE("USE_SUB_RTX")||F8()?(_E=this.createOrRecycleSendMedia(_c,eE,iE,"sendonly",_f),this.updateBundleMids()):(_E=Q_(this.sessionDesc.mediaDescriptions[mE]),_E.attributes.direction="sendonly",_E.attributes.ssrcs=eE,_E.attributes.ssrcGroups=iE,this.sessionDesc.mediaDescriptions[mE]=this.mungSendMediaDesc(_E,_f)),H_()&&this.firefoxSsrcMidMap.set(eE[0].ssrcId,_E.attributes.mid),{mid:_E.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:_c,needExchangeSDP:tE}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:_c.attributes.mid,needExchangeSDP:tE}}batchSend(_c){const tE=_c.map(eE=>{let{kind:iE,ssrcMsg:fE,mslabel:mE}=eE;return this.send(iE,fE,mE)}),_p=[];let _f=!1;return tE.forEach(eE=>{let{mid:iE,needExchangeSDP:fE}=eE;fE&&(_f=!0),_p.push(iE)}),{mids:_p,needExchangeSDP:_f}}stopSending(_c){const tE=this.sessionDesc.mediaDescriptions.filter(_p=>_p.attributes.mid&&_c.indexOf(_p.attributes.mid)!==-1);if(tE.length!==_c.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");tE.forEach(_p=>{_p.attributes.mid==="0"||H_()||F8()?_p.attributes.ssrcs=[]:(_p.attributes.ssrcs=[],_p.attributes.direction="inactive",_p.media.port="0")}),this.updateBundleMids()}mute(_c){const tE=this.sessionDesc.mediaDescriptions.find(_p=>_p.attributes.mid===_c);if(!tE)throw new Error("mediaDescription not found with ".concat(_c," in remote SDP when calling RemoteSDP.mute."));tE.attributes.direction="inactive"}unmute(_c){const tE=this.sessionDesc.mediaDescriptions.find(_p=>_p.attributes.mid===_c);if(!tE)throw new Error("mediaDescription not found with ".concat(_c," in remote SDP when calling RemoteSDP.unmute."));tE.attributes.direction="sendonly"}muteRemote(_c){const tE=this.sessionDesc.mediaDescriptions.filter(_p=>KE(_c).call(_c,_p.attributes.mid||""));if(tE.length!==_c.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");tE.forEach(_p=>{_p.attributes.direction="inactive"})}unmuteRemote(_c){const tE=this.sessionDesc.mediaDescriptions.filter(_p=>KE(_c).call(_c,_p.attributes.mid||""));if(tE.length!==_c.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");tE.forEach(_p=>{_p.attributes.direction="recvonly"})}receive(_c,tE,_p,_f){_c.forEach((eE,iE)=>{this.createOrRecycleRecvMedia(eE,[],"recvonly",tE,_p,_f[iE])}),this.updateBundleMids()}stopReceiving(_c){const tE=this.sessionDesc.mediaDescriptions.filter(_p=>_c.indexOf(_p.attributes.mid)!==-1);if(tE.length!==_c.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");tE.forEach(_p=>{_p.media.port="0",_p.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(_c){const tE=this._candidates.filter(_p=>_p.transport==="udp");if(_c===hT.TCP){if(tE.length===0)return;if(cE("TCP_CANDIDATE_ONLY")){const _p=this._candidates.filter(_f=>_f.transport==="tcp");tE.forEach(_f=>{_p.findIndex(eE=>eE.connectionAddress===_f.connectionAddress)===-1&&_p.push(vI(vI({},_f),{},{foundation:"tcpcandidate",priority:Number(_f.priority)-1+"",transport:"tcp",port:Number(_f.port)+90+""}))}),this._candidates=_p}else{const _p=[];tE.forEach(_f=>{_p.push(vI(vI({},_f),{},{foundation:"tcpcandidate",priority:Number(_f.priority)-1+"",transport:"tcp",port:Number(_f.port)+90+""}))}),this._candidates=[...tE,..._p]}}else if(_c===hT.RELAY){if(tE.length!==0)return;{const _p=this._candidates.filter(_f=>_f.transport==="tcp");_p.forEach(_f=>{tE.push(vI(vI({},_f),{},{foundation:"udpcandidate",priority:Number(_f.priority)+1+"",transport:"udp",port:Number(_f.port)-90+""}))}),this._candidates=[...tE,..._p]}}else tE.length===0?(this._candidates.filter(_p=>_p.transport==="tcp").forEach(_p=>{tE.push(vI(vI({},_p),{},{foundation:"udpcandidate",priority:Number(_p.priority)+1+"",transport:"udp",port:Number(_p.port)-90+""}))}),this._candidates=tE):this._candidates=this._candidates.filter(_p=>_p.transport!=="tcp");for(const _p of this.sessionDesc.mediaDescriptions)_p.attributes.candidates=this.candidates}restartICE(_c){_c=Q_(_c),this._iceParameters=_c,this.sessionDesc.mediaDescriptions.forEach(tE=>{tE.attributes.iceUfrag=_c.iceUfrag,tE.attributes.icePwd=_c.icePwd})}predictReceivingMids(_c){const tE=[];for(let _p=0;_p<_c;_p++)tE.push((this.currentMidIndex+_p+1).toString(10));return tE}findAvailableMediaIndex(_c,tE){return this.sessionDesc.mediaDescriptions.findIndex(_p=>{const _f=_p.media.mediaType===_c&&_p.media.port!=="0"&&(_p.attributes.direction==="sendonly"||_p.attributes.direction==="sendrecv")&&_p.attributes.ssrcs.length===0;if(H_()){if(_f){const eE=this.firefoxSsrcMidMap.get(tE[0].ssrcId);return!(eE||_p.attributes.mid!=="0"&&_p.attributes.mid!=="1")||!(!eE||eE!==_p.attributes.mid)}return!1}return _f})}createOrRecycleDataChannel(){for(const _p of this.sessionDesc.mediaDescriptions)if(_p.media.mediaType==="application")return{mediaDesc:_p,needExchangeSDP:!1};this.currentMidIndex+=1;const _c="".concat(this.currentMidIndex),tE={media:{mediaType:"application",port:qP,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(_c),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(tE),{mediaDesc:tE,needExchangeSDP:!0}}createOrRecycleRecvMedia(_c,tE,_p,_f,eE,iE){const fE=_c._mediaStreamTrack.kind,mE=this.rtpCapabilities.recv,_E=sO(fE,mE,this.localCapabilities.send,fE===_g.VIDEO?_f:eE),SE=fE===_g.VIDEO?mE.videoExtensions:mE.audioExtensions;this.currentMidIndex+=1;const wE="".concat(this.currentMidIndex);let NE={media:{mediaType:fE,port:qP,protos:["UDP","TLS","RTP","SAVPF"],fmts:_E.map(JE=>JE.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:SE,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:tE,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_E,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(wE)}};NE=this.mungRecvMediaDsec(NE,_c,iE);const DE=this.findFirstClosedMedia(fE);if(DE){const JE=this.sessionDesc.mediaDescriptions.indexOf(DE);this.sessionDesc.mediaDescriptions[JE]=NE}else this.sessionDesc.mediaDescriptions.push(NE);return NE}updateRemoteCodec(_c,tE,_p){const _f=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(NE=>NE.rtpMap&&NE.rtpMap.encodingName.toLowerCase()||"").filter(NE=>{var DE;return KE(DE=Object.keys(BO)).call(DE,NE)}))],eE=new Set(tE);if(_f.every(NE=>eE.has(NE)))return _l.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(tE)),!1;const iE=this._rtpCapabilities.recv.videoCodecs.filter(NE=>tE.some(DE=>{var JE;return KE(JE=NE.rtpMap&&NE.rtpMap.encodingName.toLowerCase()||"").call(JE,DE)}));if(iE.length===0)return _l.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(_f," codecs: ").concat(tE)),!1;const fE=[...new Set(iE.map(NE=>NE.rtpMap&&NE.rtpMap.encodingName.toLowerCase()||""))];let mE;if(_l.debug("updateRemoteCodec, from ".concat(_f," to ").concat(fE)),_c.length===0)mE=this.sessionDesc.mediaDescriptions.filter(NE=>NE.media.mediaType==="video"&&NE.attributes.direction==="recvonly");else if(mE=this.sessionDesc.mediaDescriptions.filter(NE=>NE.attributes.mid&&KE(_c).call(_c,NE.attributes.mid)&&NE.attributes.direction==="recvonly"),mE.length!==_c.length)return _l.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(_c,", codecs: ").concat(tE)),!1;if(cE("USE_PUB_RTX")||cE("USE_SUB_RTX")){const NE=pG(iE,this.rtpCapabilities.recv.videoCodecs);iE.push(...NE)}this._rtpCapabilities.recv.videoCodecs=iE;const _E=this.localCapabilities.send,SE=this.rtpCapabilities.recv,wE=sO(_g.VIDEO,SE,_E,_p);return mE.forEach(NE=>{const DE=wE.map(JE=>JE.payloadType.toString(10));_l.debug("updateRemoteCodec mid: ".concat(NE.attributes.mid,", from ").concat(NE.attributes.payloads," to ").concat(wE)),NE.attributes.payloads=wE,NE.media.fmts=DE}),!0}createOrRecycleSendMedia(_c,tE,_p,_f,eE){const iE=this.rtpCapabilities.send,fE=_c===_g.VIDEO?iE.videoCodecs:iE.audioCodecs,mE=_c===_g.VIDEO?iE.videoExtensions:iE.audioExtensions;this.currentMidIndex+=1;const _E="".concat(this.currentMidIndex);let SE={media:{mediaType:_c,port:qP,protos:["UDP","TLS","RTP","SAVPF"],fmts:fE.map(NE=>NE.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:mE,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:tE,ssrcGroups:_p,rtcpFeedbackWildcards:[],payloads:fE,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_f,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_E)}};SE=this.mungSendMediaDesc(SE,eE);const wE=this.findFirstClosedMedia(_c);if(wE){const NE=this.sessionDesc.mediaDescriptions.indexOf(wE);this.sessionDesc.mediaDescriptions[NE]=SE}else this.sessionDesc.mediaDescriptions.push(SE);return SE}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(_c=>_c.media.port!=="0").map(_c=>_c.attributes.mid)}mungRecvMediaDsec(_c,tE,_p){const _f=Q_(_c);return SL(_f),mI(_f,tE),TL(_f,tE),lG(_f),EN(_f,_p,this.localCapabilities.send),_f}mungSendMediaDesc(_c,tE){const _p=Q_(_c);return EN(_p,tE,this.localCapabilities.recv),Q0(_p),_p}updateRecvMedia(_c,tE){const _p=this.sessionDesc.mediaDescriptions.findIndex(_f=>_f.attributes.mid===_c);if(_p!==-1){const _f=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_p],tE);this.sessionDesc.mediaDescriptions[_p]=_f}}bumpMid(_c){this.currentMidIndex+=_c}findFirstClosedMedia(_c){return this.sessionDesc.mediaDescriptions.find(tE=>H_()?tE.media.port==="0"&&tE.media.mediaType===_c:tE.media.port==="0")}findPreloadMediaDesc(_c){return this.sessionDesc.mediaDescriptions.find(tE=>{var _p;return((_p=tE.attributes)===null||_p===void 0||(_p=_p.ssrcs[0])===null||_p===void 0?void 0:_p.ssrcId)===_c[0].ssrcId})}getSSRC(_c){var tE;return(tE=this.sessionDesc.mediaDescriptions.find(_p=>_p.attributes.mid===_c))===null||tE===void 0?void 0:tE.attributes.ssrcs}}({remoteIceParameters:s,remoteDtlsParameters:d,candidates:g,remoteRTPCapabilities:b,remoteSetup:$,localCapabilities:this.localCapabilities,cname:Vt}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const zt=this.remoteSDP.toString(),_e=iS.parse(this.initialOffer.sdp),_r=_e.mediaDescriptions.find(_c=>_c.media.mediaType==="audio");_r&&Q0(_r),this.useXR&&bL(_e);const _o=iS.print(_e),ga=this.logSDPExchange(_o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:_o}),ga==null||ga(zt),await this.peerConnection.setRemoteDescription({type:"answer",sdp:zt});const _a=this.peerConnection.getTransceivers()[0];if(_a!=null&&_a.receiver&&this.tryBindTransportEvents(_a.receiver),cE("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const _c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_c});const tE=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(tE)}}catch(zt){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(zt.toString()))}}send(s,d,g){var b=this;return BT(function*(){const $=yield f_(b.mutex.lock("From P2PConnection.send"));try{if(!b.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const Vt=[];s.forEach(_p=>{const _f=b.peerConnection.addTransceiver(_p._mediaStreamTrack,{direction:"sendonly"});Vt.push(_f),_p._updateRtpTransceiver(_f)}),H_()&&cE("SIMULCAST")===!0&&(yield f_(b.applySimulcastForFirefox(Vt,s)));const zt=yield f_(b.peerConnection.createOffer()),_e=b.remoteSDP.predictReceivingMids(s.length),_r=b.mungSendOfferSDP(zt.sdp,s,_e),_o=iS.parse(_r),ga=_e.map(_p=>{const _f=_o.mediaDescriptions.find(eE=>eE.attributes.mid===_p);if(!_f)throw new Error("Cannot extract ssrc from mediaDescription.");return uG(_f,cE("USE_PUB_RTX"))});let _a;try{_a=yield ga}catch(_p){_a=[],b.remoteSDP.receive(s,d,g,_a);const _f=b.remoteSDP.toString();throw yield f_(b.peerConnection.setLocalDescription({type:"offer",sdp:_r})),yield f_(b.peerConnection.setRemoteDescription({type:"answer",sdp:_f})),yield f_(b.stopSending(_e,!0)),_p}b.remoteSDP.receive(s,d,g,_a);const _c=b.remoteSDP.toString(),tE=b.logSDPExchange(_r,"offer","local","send");return yield f_(b.peerConnection.setLocalDescription({type:"offer",sdp:_r})),yield f_(b.applySimulcastEncodings(Vt,s)),yield f_(b.applySendEncodings(Vt,s)),tE==null||tE(_c),yield f_(b.peerConnection.setRemoteDescription({type:"answer",sdp:_c})),Vt.map((_p,_f)=>{const eE=_e[_f];return{localSSRC:ga[_f],id:eE,transceiver:_p}})}catch(Vt){throw Vt instanceof TE?Vt:new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(Vt.toString()))}finally{$()}})()}async createDataChannels(s,d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let g=this.dataStreamChannelMap.get(s);if(g&&g.readyState==="open")_l.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const $=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof $!="number")throw new Error("create DataChannel error, because cannot get dc id");g=this.peerConnection.createDataChannel("datastream-channel",{id:$,negotiated:!0,ordered:!1,maxRetransmits:cE("DATASTREAM_MAX_RETRANSMITS")}),g.binaryType="arraybuffer",this.dataStreamChannelMap.set(s,g)}d.forEach($=>{$._updateOriginDataChannel(g)});const{needExchangeSDP:b}=this.remoteSDP.sendDataChannel();if(b){const $=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:$});const Vt=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(Vt),_l.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else _l.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(g){throw g instanceof TE?g:new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(g.toString()))}}async stopDataChannels(s){try{const d=this.dataStreamChannelMap.get(s);return d&&(d.id&&this.recoveredDataChannelIds.push(d.id),d.close()),void this.dataStreamChannelMap.delete(s)}catch(d){throw d instanceof TE?d:new TE(rE.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(d.toString()))}}async stopSending(s,d){const g=d?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const b=this.peerConnection.getTransceivers().filter(_e=>s.indexOf(_e.mid)!==-1);if(b.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");b.map(_e=>{var _r;NL(this.id+_e.mid),_e.direction="inactive",(_r=_e.stop)===null||_r===void 0||_r.call(_e)});const $=await this.peerConnection.createOffer(),Vt=this.logSDPExchange($.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription($),this.remoteSDP.stopReceiving(s);const zt=this.remoteSDP.toString();Vt==null||Vt(zt),await this.peerConnection.setRemoteDescription({type:"answer",sdp:zt})}catch(b){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(b.toString()))}finally{g&&g()}}async receive(s,d,g,b){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(s," before remoteSDP created."));const{mid:$,needExchangeSDP:Vt}=this.remoteSDP.send(s,d,g,b);if(Vt){const _e=this.remoteSDP.toString(),_r=this.logSDPExchange(_e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_e});const _o=await this.peerConnection.createAnswer(),ga=this.mungReceiveAnswerSDP(_o.sdp,$,s);_r==null||_r(ga||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:ga}),_l.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(s," by exchanging SDP."))}else _l.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(s," no need to exchange SDP."));const zt=this.peerConnection.getTransceivers().find(_e=>_e.mid===$);if(!zt)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:zt.receiver.track,id:$,transceiver:zt}}catch($){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat($.toString()))}}async batchReceive(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:d,needExchangeSDP:g}=this.remoteSDP.batchSend(s);if(g){const b=this.remoteSDP.toString(),$=this.logSDPExchange(b,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:b});const Vt=await this.peerConnection.createAnswer();$==null||$(Vt.sdp||""),await this.peerConnection.setLocalDescription(Vt),_l.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else _l.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return d.map(b=>{const $=this.peerConnection.getTransceivers().find(Vt=>Vt.mid===b);if(!$)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:$.receiver.track,id:b,transceiver:$}})}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(s);const d=this.remoteSDP.toString(),g=this.logSDPExchange(d,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const b=await this.peerConnection.createAnswer();g==null||g(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(d.toString()))}}async muteRemote(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(s," before remote SDP created."));this.remoteSDP.mute(s);const d=this.remoteSDP.toString(),g=this.logSDPExchange(d,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const b=await this.peerConnection.createAnswer();g==null||g(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(d.toString()))}}async unmuteRemote(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(s," before remote SDP created."));this.remoteSDP.unmute(s);const d=this.remoteSDP.toString(),g=this.logSDPExchange(d,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const b=await this.peerConnection.createAnswer();g==null||g(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(d.toString()))}}async muteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const d=this.peerConnection.getTransceivers().filter(Vt=>Vt.mid&&s.indexOf(Vt.mid)!==-1);if(d.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length.");d.map(Vt=>{Vt.direction="inactive"});const g=await this.peerConnection.createOffer(),b=this.logSDPExchange(g.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(g),this.remoteSDP.muteRemote(s);const $=this.remoteSDP.toString();b==null||b($),await this.peerConnection.setRemoteDescription({type:"answer",sdp:$})}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(d.toString()))}}async unmuteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const d=this.peerConnection.getTransceivers().filter(Vt=>Vt.mid&&s.indexOf(Vt.mid)!==-1);if(d.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length.");d.map(async(Vt,zt)=>{Vt.direction="sendonly"});const g=await this.peerConnection.createOffer(),b=this.logSDPExchange(g.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(g),this.remoteSDP.unmuteRemote(s);const $=this.remoteSDP.toString();b==null||b($),await this.peerConnection.setRemoteDescription({type:"answer",sdp:$})}catch(d){throw new TE(rE.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(d.toString()))}}restartICE(s){var d=this;return BT(function*(){const g=yield f_(d.mutex.lock("From P2PConnection.restartICE"));try{if(!d.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(R_().supportPCSetConfiguration){const _r=d.peerConnection.getConfiguration(),_o=s===hT.RELAY?"relay":"all";_r.iceTransportPolicy!==_o&&(_l.debug("[".concat(d.store.clientId,"] restartICE change iceTransportPolicy from [").concat(_r.iceTransportPolicy,"] to [").concat(_o,"]")),_r.iceTransportPolicy=_o,d.peerConnection.setConfiguration(_r))}else if(s===hT.RELAY)return;d.remoteSDP.updateCandidates(s);const b=yield f_(d.peerConnection.createOffer({iceRestart:!0}));if(!b.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const $=X0(b.sdp),{remoteIceParameters:Vt}=yield $.iceParameters;d.remoteSDP.restartICE(Vt);const zt=d.remoteSDP.toString(),_e=d.logSDPExchange(b.sdp||"","offer","local","restartICE");d.store.descriptionStart(),yield f_(d.peerConnection.setLocalDescription(b)),_e==null||_e(zt),yield f_(d.peerConnection.setRemoteDescription({type:"answer",sdp:zt}))}catch(b){_l.warning("[".concat(d.store.clientId,"] restart ICE failed, abort operation"),b)}finally{g()}})()}close(){var s;this.peerConnection.getTransceivers().forEach(d=>{NL(this.id+d.mid)}),this.peerConnection.close(),(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return yI(yI({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(s){return this.statsFilter.getVideoIsReady(s)}async updateEncoderConfig(s,d){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const g=await this.peerConnection.createOffer(),b=this.mungSendOfferSDP(g.sdp,[d],[s]);this.remoteSDP.updateRecvMedia(s,d);const $=this.remoteSDP.toString(),Vt=this.logSDPExchange(b,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:b}),Vt==null||Vt($),await this.peerConnection.setRemoteDescription({type:"answer",sdp:$})}catch(g){throw new TE(rE.EXCHANGE_SDP_FAILED,g.toString())}}async updateSendParameters(s,d){const g=this.peerConnection.getTransceivers().filter(b=>b.mid===s);g.length===1&&(this.isVP8Simulcast(d)?H_()||await this.applySimulcastEncodings(g,[d]):await this.applySendEncodings(g,[d]))}setStatsRemoteVideoIsReady(s,d){this.statsFilter.setVideoIsReady2(s,d)}async replaceTrack(s,d){const g=this.peerConnection.getTransceivers().find(b=>b.mid===d);g&&await g.sender.replaceTrack(s._mediaStreamTrack)}async getSelectedCandidatePair(){const s=this.peerConnection.getReceivers();if(s.length>0&&s[0].transport&&s[0].transport.iceTransport&&s[0].transport.iceTransport.getSelectedCandidatePair&&s[0].transport.iceTransport.getSelectedCandidatePair()){const d=s[0].transport.iceTransport,{local:g,remote:b}=d.getSelectedCandidatePair();return{local:yI(yI({},TR),{},{candidateType:g.type,protocol:g.protocol,address:g.address,port:g.port}),remote:yI(yI({},TR),{},{candidateType:b.type,protocol:b.protocol,address:b.address,port:b.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var s;(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var s;(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=s=>{s.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_l.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_l.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},cE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(s){const d={iceServers:[]};return s.iceServers?d.iceServers=s.iceServers:s.turnServer&&s.turnServer.mode!=="off"&&(jO(s.turnServer.servers)?d.iceServers=s.turnServer.servers:(d.iceServers&&d.iceServers.push(...JP.turnServerConfigToIceServers(s.turnServer.servers)),cE("USE_TURN_SERVER_OF_GATEWAY")&&d.iceServers&&s.turnServer.serversFromGateway&&d.iceServers.push(...JP.turnServerConfigToIceServers(s.turnServer.serversFromGateway)),cE("FORCE_TURN_TCP")?d.iceTransportPolicy="relay":s.turnServer.servers.concat(s.turnServer.serversFromGateway||[]).forEach(g=>{g.forceturn&&(d.iceTransportPolicy="relay")}))),cE("ENABLE_ENCODED_TRANSFORM")&&R_().supportWebRTCEncodedTransform&&(d.encodedInsertableStreams=!0),d}static turnServerConfigToIceServers(s){const d=[];return s.forEach(g=>{g.security?g.tcpport&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(aI(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}):(g.udpport&&!cE("FORCE_TURN_TCP")&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.udpport,"?transport=udp")}),g.tcpport&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.tcpport,"?transport=tcp")}))}),d}tryBindTransportEvents(s){const d=s.transport;if(d){this.transportEventReceiver=s,d.onstatechange=()=>{var b;d!=null&&d.state&&((b=this.onDTLSTransportStateChange)===null||b===void 0||b.call(this,d.state))},d.onerror=b=>{var $;($=this.onDTLSTransportError)===null||$===void 0||$.call(this,"error"in b?b.error:b)};const g=d.iceTransport;g&&(g.onstatechange=()=>{const b=d==null?void 0:d.iceTransport.state;var $;b&&(($=this.onICETransportStateChange)===null||$===void 0||$.call(this,b))},g.getSelectedCandidatePair&&(g.onselectedcandidatepairchange=()=>{if(g.getSelectedCandidatePair()){const{local:b,remote:$}=g.getSelectedCandidatePair();_l.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:b.type,protocol:b.protocol}),", remote ").concat(JSON.stringify({candidateType:$.type,protocol:$.protocol,address:$.address,port:$.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(s,d){var g,b;if(d||(d=this.peerConnection.getSenders().find(_f=>_f.track===s._mediaStreamTrack)),!d)return _l.warn("[".concat(s.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(s))return _l.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!R_().supportSetRtpSenderParameters)return _l.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const $={},Vt={};switch(s._optimizationMode){case"motion":$.degradationPreference="maintain-framerate";break;case"detail":$.degradationPreference="maintain-resolution";break;case"balanced":$.degradationPreference="balanced"}const zt=function(_p,_f){return _p.getTransceivers().find(eE=>eE.sender.track===_f||eE.receiver.track===_f)}(this.peerConnection,s._mediaStreamTrack),_e=Vdt(s);if(Eht(s)&&zt&&d&&_e&&this.getLocalVideoStats&&KE(g=["vp8","vp9"]).call(g,this.store.codec)){var _r;const _p=$.degradationPreference||(KE(_r=s._hints).call(_r,Z_.CUSTOM_TRACK)?cE("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(_f,eE,iE,fE,mE,_E){if(NL(_f),fE!=="balanced"&&fE!=="maintain-framerate"&&fE!=="maintain-resolution")return;let SE=-1;bJ(_f,eE);const wE=window.setInterval(()=>{const DE=AL.get(_f);if(!cE("ENABLE_AG_ADAPTATION")||!DE)return void NL(_f);const JE=_E();if(JE.sendPackets>0&&JE.OutgoingAvailableBandwidth>0){if(SE===-1)return void(SE=Date.now());if(Date.now()-SE<1e3)return;const b_=JE.sendFrameRate,L_=JE.OutgoingAvailableBandwidth,[$_,OS]=mht(_f,b_,L_,DE.adaptationConfig,eE,fE);OS&&(iE.qualityLimitationReason=OS),$_&&DE.adaptationConfig.scale!==$_.scale&&(_l.debug("[".concat(_f,"] applyAdaptation: ").concat(iE.qualityLimitationReason,`
           sendFps `).concat(b_,", bwe ").concat(L_,", switch from ").concat(DE.adaptationConfig.scale," to ").concat($_.scale," ")),DE.adaptationConfig=gG(gG({},DE.adaptationConfig),$_),mE($_))}},cE("CHECK_LOCAL_STATS_INTERVAL")),NE=gG({},eE);AL.set(_f,{timer:wE,adaptationConfig:NE,originConfig:eE,adaptationFunc:mE}),_l.debug("[".concat(_f,"] start adaptation, originConfig: ").concat(JSON.stringify(eE),", degradationPreference: ").concat(fE))})(this.id+zt.mid,_e,this,_p,_f=>{d&&this.updateAdaptation(d,_f)},this.getLocalVideoStats.bind(this))}if(s._encoderConfig){var _o;const{bitrateMax:_p,frameRate:_f,scaleResolutionDownBy:eE}=s._encoderConfig;_p&&(Vt.maxBitrate=1e3*_p),(KE(_o=s._hints).call(_o,Z_.LOW_STREAM)||s.isUseScaleResolutionDownBy)&&(_f&&(Vt.maxFramerate=kT(_f)),eE&&eE>=1&&(Vt.scaleResolutionDownBy=eE))}const{maxFramerate:ga}=cE("ENCODER_CONFIG_LIMIT");if(ga&&typeof ga=="number"&&(Vt.maxFramerate=Vt.maxFramerate?Math.min(Vt.maxFramerate,ga):ga),cE("DSCP_TYPE")&&tI()){var _a;const _p=cE("DSCP_TYPE");KE(_a=["very-low","low","medium","high"]).call(_a,_p)&&(Vt.networkPriority=_p)}const _c=d.getParameters(),tE=(b=_c.encodings)===null||b===void 0?void 0:b[0];H_()&&!tE&&($.encodings=[Vt]),tE&&Object.assign(tE,Vt),Object.assign(_c,$),_l.debug("[".concat(s.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_c.encodings))),await d.setParameters(_c)}async updateAdaptation(s,d){var g,b;if(!s)return _l.debug("[updateAdaptation] no rtpSender found");if(!R_().supportSetRtpSenderParameters)return _l.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const $={},{bitrateMax:Vt,frameRate:zt,scaleResolutionDownBy:_e}=d;Vt&&($.maxBitrate=1e3*Vt),zt&&($.maxFramerate=kT(zt)),_e&&_e>=1&&KE(g=["vp8","vp9"]).call(g,this.store.codec)&&($.scaleResolutionDownBy=_e);const _r=s.getParameters(),_o=(b=_r.encodings)===null||b===void 0?void 0:b[0];_o&&Object.assign(_o,$),Object.assign(_r,{});try{await s.setParameters(_r),_l.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(_r.encodings)))}catch(ga){!("transport"in s)||s.transport&&s.transport.state==="connected"?this.peerConnectionState!=="connected"?_l.debug("[updateAdaptation] peerConnection not connected}"):_l.debug("[updateAdaptation] updateRtpSenderEncodings failed",ga):_l.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(s,d){try{if(!R_().supportSetRtpSenderParameters||s.length!==d.length)return;for(let g=0;g<s.length;g++){const b=s[g],$=d[g];$ instanceof Y_&&!this.isVP8Simulcast($)&&await this.updateRtpSenderEncodings($,b.sender)}}catch{_l.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(s,d,g){const b=iS.parse(s);return d.forEach(($,Vt)=>{const zt=g[Vt],_e=b.mediaDescriptions.find(_r=>_r.attributes.mid===zt);_e&&(mI(_e,$),dG(_e,$,this.store.codec))}),iS.print(b)}mungReceiveAnswerSDP(s,d,g){const b=iS.parse(s),$=b.mediaDescriptions.find(Vt=>Vt.attributes.mid===d);return $&&(g===_g.AUDIO&&$.media.mediaType==="audio"&&Q0($),this.useXR&&bL(b)),iS.print(b)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=s=>{var d;(d=this.onFirstAudioReceived)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstVideoReceived=s=>{var d;(d=this.onFirstVideoReceived)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstAudioDecoded=s=>{var d;(d=this.onFirstAudioDecoded)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstVideoDecoded=(s,d,g)=>{var b;(b=this.onFirstVideoDecoded)===null||b===void 0||b.call(this,s,d,g)},this.statsFilter.onSelectedLocalCandidateChanged=(s,d)=>{var g;(g=this.onSelectedLocalCandidateChanged)===null||g===void 0||g.call(this,s,d)},this.statsFilter.onSelectedRemoteCandidateChanged=(s,d)=>{var g;(g=this.onSelectedRemoteCandidateChanged)===null||g===void 0||g.call(this,s,d)},this.statsFilter.onFirstVideoDecodedTimeout=s=>{var d;(d=this.onFirstVideoDecodedTimeout)===null||d===void 0||d.call(this,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(s,d){if(s.length===d.length)for(let _e=0;_e<s.length;_e++){var g,b,$,Vt,zt;const _r=s[_e],_o=d[_e];if(_o instanceof Y_&&!KE(g=_o._hints).call(g,Z_.LOW_STREAM)&&(b=_o._encoderConfig)!==null&&b!==void 0&&b.bitrateMax&&(($=_o._encoderConfig)===null||$===void 0?void 0:$.bitrateMax)>200&&(Vt=_o._scalabilityMode)!==null&&Vt!==void 0&&Vt.numSpatialLayers&&((zt=_o._scalabilityMode)===null||zt===void 0?void 0:zt.numSpatialLayers)>1&&this.store.codec==="vp8"){const ga={},_a={high:1e3*(_o._encoderConfig.bitrateMax-50),medium:5e4};ga.encodings=[{rid:"m",active:!0,maxBitrate:_a.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_a.high}];const _c=_r.sender.getParameters();await _r.sender.setParameters(Object.assign(_c,ga))}}}async applySimulcastEncodings(s,d){if(!H_()&&s.length===d.length)for(let g=0;g<s.length;g++){const b=d[g];if(b instanceof Y_&&this.isVP8Simulcast(b)){const $=s[g],Vt={},zt={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};Vt.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:zt.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:zt.medium,scaleResolutionDownBy:4}];const _e=$.sender.getParameters();await $.sender.setParameters(Object.assign(_e,Vt))}}}isVP8Simulcast(s){var d,g,b,$,Vt;return!!(s instanceof Y_&&cE("SIMULCAST")&&this.store.codec==="vp8"&&!KE(d=s._hints).call(d,Z_.LOW_STREAM)&&(g=s._encoderConfig)!==null&&g!==void 0&&g.bitrateMax&&((b=s._encoderConfig)===null||b===void 0?void 0:b.bitrateMax)>200&&($=s._scalabilityMode)!==null&&$!==void 0&&$.numSpatialLayers&&((Vt=s._scalabilityMode)===null||Vt===void 0?void 0:Vt.numSpatialLayers)>1)}logSDPExchange(s,d,g,b){if(cE("SDP_LOGGING"))return _l.upload("[".concat(this.store.clientId,"] exchanging ").concat(g," ").concat(d," SDP during P2PConnection.").concat(b,`
`),s),d==="offer"?$=>{this.logSDPExchange($,"answer",g==="local"?"remote":"local",b)}:void 0}async getRemoteSSRC(s){if(!this.remoteSDP)return;const d=this.remoteSDP.getSSRC(s);return d==null?void 0:d[0].ssrcId}setConfiguration(s){if(R_().supportPCSetConfiguration){const d=JP.resolvePCConfiguration(s);this.peerConnection.setConfiguration(d)}}},BE(A_.prototype,"updateRemoteRTPCapabilities",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"updateRemoteRTPCapabilities"),A_.prototype),BE(A_.prototype,"connect",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"connect"),A_.prototype),BE(A_.prototype,"createDataChannels",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"createDataChannels"),A_.prototype),BE(A_.prototype,"receive",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"receive"),A_.prototype),BE(A_.prototype,"batchReceive",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"batchReceive"),A_.prototype),BE(A_.prototype,"stopReceiving",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"stopReceiving"),A_.prototype),BE(A_.prototype,"muteRemote",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"muteRemote"),A_.prototype),BE(A_.prototype,"unmuteRemote",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"unmuteRemote"),A_.prototype),BE(A_.prototype,"muteLocal",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"muteLocal"),A_.prototype),BE(A_.prototype,"unmuteLocal",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"unmuteLocal"),A_.prototype),BE(A_.prototype,"close",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"close"),A_.prototype),BE(A_.prototype,"updateEncoderConfig",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"updateEncoderConfig"),A_.prototype),BE(A_.prototype,"updateSendParameters",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"updateSendParameters"),A_.prototype),BE(A_.prototype,"replaceTrack",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"replaceTrack"),A_.prototype),BE(A_.prototype,"updateAdaptation",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"updateAdaptation"),A_.prototype),BE(A_.prototype,"getRemoteSSRC",[PT],Object.getOwnPropertyDescriptor(A_.prototype,"getRemoteSSRC"),A_.prototype),A_);function PT(o,s,d){const g=o[s];if(typeof g!="function")throw new Error("Cannot use mutex on object property.");return d.value=async function(){const b=this.mutex,$=await b.lock("From P2PConnection.".concat(s));try{for(var Vt=arguments.length,zt=new Array(Vt),_e=0;_e<Vt;_e++)zt[_e]=arguments[_e];return await g.apply(this,zt)}finally{$()}},d}function IJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function OJ(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?IJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):IJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}const AJ=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,kL="9",_G=2e4,vG=4e4;class ght{get localCapabilities(){return Q_(this._localCapabilities)}get rtpCapabilities(){return Q_(this._rtpCapabilities)}get candidates(){return Q_(this._candidates)}get iceParameters(){return Q_(this._iceParameters)}get dtlsParameters(){return Q_(this._dtlsParameters)}constructor(s){Qm(this,"sessionDesc",void 0),Qm(this,"_localCapabilities",void 0),Qm(this,"_rtpCapabilities",void 0),Qm(this,"_candidates",void 0),Qm(this,"_iceParameters",void 0),Qm(this,"_dtlsParameters",void 0),Qm(this,"setup",void 0),Qm(this,"currentMidIndex",void 0),Qm(this,"cname",void 0),Qm(this,"firefoxSsrcMidMap",new Map),s=Q_(s);const{remoteIceParameters:d,remoteDtlsParameters:g,candidates:b,remoteRTPCapabilities:$,remoteSetup:Vt,localCapabilities:zt,cname:_e}=s,_r=iS.parse(AJ);this._rtpCapabilities=$,this._candidates=b,this._iceParameters=d,this._dtlsParameters=g,this._localCapabilities=zt,this.setup=Vt,this.cname=_e;const _o=this.rtpCapabilities.send;for(const ga of _r.mediaDescriptions){if(ga.attributes.iceUfrag=d.iceUfrag,ga.attributes.icePwd=d.icePwd,ga.attributes.fingerprints=g.fingerprints,ga.attributes.candidates=b,ga.attributes.setup=Vt,ga.media.mediaType==="application"&&(ga.attributes.sctpPort="5000"),ga.media.mediaType==="video"&&(ga.media.fmts=_o.videoCodecs.map(_a=>_a.payloadType.toString(10)),ga.attributes.payloads=_o.videoCodecs,ga.attributes.extmaps=_o.videoExtensions,cE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:_a,ssrcGroups:_c}=t0([{ssrcId:vG,rtx:cE("USE_SUB_RTX")?40001:void 0}],this.cname);ga.attributes.ssrcs=_a,ga.attributes.ssrcGroups=_c}if(ga.media.mediaType==="audio"&&(ga.media.fmts=_o.audioCodecs.map(_a=>_a.payloadType.toString(10)),ga.attributes.payloads=_o.audioCodecs,ga.attributes.extmaps=_o.audioExtensions,Q0(ga),cE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:_a,ssrcGroups:_c}=t0([{ssrcId:_G}],this.cname);ga.attributes.ssrcs=_a,ga.attributes.ssrcGroups=_c}}this.sessionDesc=_r,this.currentMidIndex=_r.mediaDescriptions.length-1}updateRemoteRTPCapabilities(s){const d=iS.parse(AJ);this._rtpCapabilities=s;const g=this.rtpCapabilities.send;for(const b of d.mediaDescriptions){if(b.attributes.iceUfrag=this._iceParameters.iceUfrag,b.attributes.icePwd=this._iceParameters.icePwd,b.attributes.fingerprints=this._dtlsParameters.fingerprints,b.attributes.candidates=this._candidates,b.attributes.setup=this.setup,b.media.mediaType==="application"&&(b.attributes.sctpPort="5000"),b.media.mediaType==="video"&&(b.media.fmts=g.videoCodecs.map($=>$.payloadType.toString(10)),b.attributes.payloads=g.videoCodecs,b.attributes.extmaps=g.videoExtensions,cE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:$,ssrcGroups:Vt}=t0([{ssrcId:vG,rtx:cE("USE_SUB_RTX")?40001:void 0}],this.cname);b.attributes.ssrcs=$,b.attributes.ssrcGroups=Vt}if(b.media.mediaType==="audio"&&(b.media.fmts=g.audioCodecs.map($=>$.payloadType.toString(10)),b.attributes.payloads=g.audioCodecs,b.attributes.extmaps=g.audioExtensions,cE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:$,ssrcGroups:Vt}=t0([{ssrcId:_G}],this.cname);b.attributes.ssrcs=$,b.attributes.ssrcGroups=Vt}}this.sessionDesc=d,this.currentMidIndex=d.mediaDescriptions.length-1}preloadRemoteMedia(s){this.rtpCapabilities;const d=this.candidates,g=this.dtlsParameters,b=this.iceParameters,$=this.rtpCapabilities.send;for(let Vt=1;Vt<s;Vt++){const zt=2*Vt+_G,_e=2*Vt+vG,{ssrcs:_r,ssrcGroups:_o}=t0([{ssrcId:zt}],this.cname),{ssrcs:ga,ssrcGroups:_a}=t0([{ssrcId:_e,rtx:cE("USE_SUB_RTX")?_e+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:kL,protos:["UDP","TLS","RTP","SAVPF"],fmts:$.videoCodecs.map(_c=>_c.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:b.iceUfrag,icePwd:b.icePwd,unrecognized:[],candidates:d,extmaps:$.videoExtensions,fingerprints:g.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ga,ssrcGroups:_a,rtcpFeedbackWildcards:[],payloads:$.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*Vt-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:kL,protos:["UDP","TLS","RTP","SAVPF"],fmts:$.audioCodecs.map(_c=>_c.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:b.iceUfrag,icePwd:b.icePwd,unrecognized:[],candidates:d,extmaps:$.audioExtensions,fingerprints:g.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_r,ssrcGroups:_o,rtcpFeedbackWildcards:[],payloads:$.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*Vt)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return iS.print(this.sessionDesc)}send(s,d,g,b){const{ssrcs:$,ssrcGroups:Vt}=t0(d,this.cname,cE("SYNC_GROUP")?g:void 0),zt=this.findPreloadMediaDesc($);if(zt){if(H_()&&this.firefoxSsrcMidMap.set($[0].ssrcId,zt.attributes.mid),b&&(b.twcc||b.remb)){const _e=this.sessionDesc.mediaDescriptions.indexOf(zt);return this.sessionDesc.mediaDescriptions[_e]=this.mungSendMediaDesc(zt,b),{mid:zt.attributes.mid,needExchangeSDP:!0}}return{mid:zt.attributes.mid,needExchangeSDP:!1}}{const _e=this.findAvailableMediaIndex(s,$);let _r;return _e===-1||GS()||oT()||V8()||_e===0&&cE("USE_SUB_RTX")?(_r=this.createOrRecycleSendMedia(s,$,Vt,"sendonly",b),this.updateBundleMids()):(_r=Q_(this.sessionDesc.mediaDescriptions[_e]),_r.attributes.direction="sendonly",_r.attributes.ssrcs=$,_r.attributes.ssrcGroups=Vt,this.sessionDesc.mediaDescriptions[_e]=this.mungSendMediaDesc(_r,b)),H_()&&this.firefoxSsrcMidMap.set($[0].ssrcId,_r.attributes.mid),{mid:_r.attributes.mid,needExchangeSDP:!0}}}batchSend(s){const d=s.map($=>{let{kind:Vt,ssrcMsg:zt,mslabel:_e}=$;return this.send(Vt,zt,_e)}),g=[];let b=!1;return d.forEach($=>{let{mid:Vt,needExchangeSDP:zt}=$;zt&&(b=!0),g.push(Vt)}),{mids:g,needExchangeSDP:b}}stopSending(s){const d=this.sessionDesc.mediaDescriptions.filter(g=>g.attributes.mid&&s.indexOf(g.attributes.mid)!==-1);if(d.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");d.forEach(g=>{g.attributes.mid==="0"||H_()||GS()||oT()?g.attributes.ssrcs=[]:(g.attributes.ssrcs=[],g.attributes.direction="inactive",g.media.port="0")}),this.updateBundleMids()}mute(s){const d=this.sessionDesc.mediaDescriptions.find(g=>g.attributes.mid===s);if(!d)throw new Error("mediaDescription not found with ".concat(s," in remote SDP when calling RemoteSDP.mute."));d.attributes.direction="inactive"}unmute(s){const d=this.sessionDesc.mediaDescriptions.find(g=>g.attributes.mid===s);if(!d)throw new Error("mediaDescription not found with ".concat(s," in remote SDP when calling RemoteSDP.unmute."));d.attributes.direction="sendonly"}muteRemote(s){const d=this.sessionDesc.mediaDescriptions.filter(g=>KE(s).call(s,g.attributes.mid||""));if(d.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");d.forEach(g=>{g.attributes.direction="inactive"})}unmuteRemote(s){const d=this.sessionDesc.mediaDescriptions.filter(g=>KE(s).call(s,g.attributes.mid||""));if(d.length!==s.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");d.forEach(g=>{g.attributes.direction="recvonly"})}receive(s,d,g,b){s.forEach(($,Vt)=>{this.createOrRecycleRecvMedia($,[],"recvonly",d,g,b[Vt])}),this.updateBundleMids()}stopReceiving(s){const d=this.sessionDesc.mediaDescriptions.filter(g=>s.indexOf(g.attributes.mid)!==-1);if(d.length!==s.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");d.forEach(g=>{g.media.port="0",g.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(s){s===hT.TCP?this._candidates.forEach(d=>{this._candidates.findIndex(g=>g.transport==="tcp"&&g.connectionAddress===d.connectionAddress&&g.port===d.port)===-1&&this._candidates.push(OJ(OJ({},d),{},{foundation:"tcpcandidate",priority:Number(d.priority)-1+"",transport:"tcp",port:Number(d.port)+90+""}))}):this._candidates=this._candidates.filter(d=>d.transport!=="tcp");for(const d of this.sessionDesc.mediaDescriptions)d.attributes.candidates=this.candidates}restartICE(s){s=Q_(s),this._iceParameters=s,this.sessionDesc.mediaDescriptions.forEach(d=>{d.attributes.iceUfrag=s.iceUfrag,d.attributes.icePwd=s.icePwd})}predictReceivingMids(s){const d=[];for(let g=0;g<s;g++)d.push((this.currentMidIndex+g+1).toString(10));return d}findAvailableMediaIndex(s,d){return this.sessionDesc.mediaDescriptions.findIndex(g=>{const b=g.media.mediaType===s&&g.media.port!=="0"&&(g.attributes.direction==="sendonly"||g.attributes.direction==="sendrecv")&&g.attributes.ssrcs.length===0;if(H_()){if(b){const $=this.firefoxSsrcMidMap.get(d[0].ssrcId);return!($||g.attributes.mid!=="0"&&g.attributes.mid!=="1")||!(!$||$!==g.attributes.mid)}return!1}return b})}createOrRecycleRecvMedia(s,d,g,b,$,Vt){const zt=s._mediaStreamTrack.kind,_e=this.rtpCapabilities.recv,_r=sO(zt,_e,this.localCapabilities.send,zt===_g.VIDEO?b:$),_o=zt===_g.VIDEO?_e.videoExtensions:_e.audioExtensions;this.currentMidIndex+=1;const ga="".concat(this.currentMidIndex);let _a={media:{mediaType:zt,port:kL,protos:["UDP","TLS","RTP","SAVPF"],fmts:_r.map(tE=>tE.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_o,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_r,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:g,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ga)}};_a=this.mungRecvMediaDsec(_a,s,Vt);const _c=this.findFirstClosedMedia(zt);if(_c){const tE=this.sessionDesc.mediaDescriptions.indexOf(_c);this.sessionDesc.mediaDescriptions[tE]=_a}else this.sessionDesc.mediaDescriptions.push(_a);return _a}updateRemoteCodec(s,d,g){const b=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_a=>_a.rtpMap&&_a.rtpMap.encodingName.toLowerCase()||"").filter(_a=>{var _c;return KE(_c=Object.keys(BO)).call(_c,_a)}))],$=new Set(d);if(b.every(_a=>$.has(_a)))return _l.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(d)),!1;const Vt=this._rtpCapabilities.recv.videoCodecs.filter(_a=>d.some(_c=>{var tE;return KE(tE=_a.rtpMap&&_a.rtpMap.encodingName.toLowerCase()||"").call(tE,_c)}));if(Vt.length===0)return _l.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(b," codecs: ").concat(d)),!1;const zt=[...new Set(Vt.map(_a=>_a.rtpMap&&_a.rtpMap.encodingName.toLowerCase()||""))];let _e;if(_l.debug("updateRemoteCodec, from ".concat(b," to ").concat(zt)),s.length===0)_e=this.sessionDesc.mediaDescriptions.filter(_a=>_a.media.mediaType==="video"&&_a.attributes.direction==="recvonly");else if(_e=this.sessionDesc.mediaDescriptions.filter(_a=>_a.attributes.mid&&KE(s).call(s,_a.attributes.mid)&&_a.attributes.direction==="recvonly"),_e.length!==s.length)return _l.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(s,", codecs: ").concat(d)),!1;this._rtpCapabilities.recv.videoCodecs=Vt;const _r=this.localCapabilities.send,_o=this.rtpCapabilities.recv,ga=sO(_g.VIDEO,_o,_r,g);return _e.forEach(_a=>{const _c=ga.map(tE=>tE.payloadType.toString(10));_l.debug("updateRemoteCodec mid: ".concat(_a.attributes.mid,", from ").concat(_a.attributes.payloads," to ").concat(ga)),_a.attributes.payloads=ga,_a.media.fmts=_c}),!0}createOrRecycleSendMedia(s,d,g,b,$){const Vt=this.rtpCapabilities.send,zt=s===_g.VIDEO?Vt.videoCodecs:Vt.audioCodecs,_e=s===_g.VIDEO?Vt.videoExtensions:Vt.audioExtensions;this.currentMidIndex+=1;const _r="".concat(this.currentMidIndex);let _o={media:{mediaType:s,port:kL,protos:["UDP","TLS","RTP","SAVPF"],fmts:zt.map(_a=>_a.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_e,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:d,ssrcGroups:g,rtcpFeedbackWildcards:[],payloads:zt,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:b,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_r)}};_o=this.mungSendMediaDesc(_o,$);const ga=this.findFirstClosedMedia(s);if(ga){const _a=this.sessionDesc.mediaDescriptions.indexOf(ga);this.sessionDesc.mediaDescriptions[_a]=_o}else this.sessionDesc.mediaDescriptions.push(_o);return _o}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(s=>s.media.port!=="0").map(s=>s.attributes.mid)}mungRecvMediaDsec(s,d,g){const b=Q_(s);return SL(b),mI(b,d),TL(b,d),lG(b),EN(b,g,this.localCapabilities.send),b}mungSendMediaDesc(s,d){const g=Q_(s);return EN(g,d,this.localCapabilities.recv),Q0(g),g}updateRecvMedia(s,d){const g=this.sessionDesc.mediaDescriptions.findIndex(b=>b.attributes.mid===s);if(g!==-1){const b=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[g],d);this.sessionDesc.mediaDescriptions[g]=b}}bumpMid(s){this.currentMidIndex+=s}findFirstClosedMedia(s){return this.sessionDesc.mediaDescriptions.find(d=>H_()?d.media.port==="0"&&d.media.mediaType===s:d.media.port==="0")}findPreloadMediaDesc(s){return this.sessionDesc.mediaDescriptions.find(d=>{var g;return((g=d.attributes)===null||g===void 0||(g=g.ssrcs[0])===null||g===void 0?void 0:g.ssrcId)===s[0].ssrcId})}getSSRC(s){var d;return(d=this.sessionDesc.mediaDescriptions.find(g=>g.attributes.mid===s))===null||d===void 0?void 0:d.attributes.ssrcs}}var N_;function NJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function PL(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?NJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):NJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}let _ht=(N_=class HL extends MD{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){let s;return this.localCapabilities&&(s=gN(this.localCapabilities)),[...new Set(s&&s.send.videoCodecs.map(d=>d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").filter(d=>{var g;return KE(g=Object.keys(BO)).call(g,d)}))]}constructor(s,d,g){super(s,d),Qm(this,"store",void 0),Qm(this,"peerConnection",void 0),Qm(this,"remoteSDP",void 0),Qm(this,"initialOffer",void 0),Qm(this,"transportEventReceiver",void 0),Qm(this,"statsFilter",void 0),Qm(this,"useXR",cE("USE_XR")),Qm(this,"localCapabilities",void 0),Qm(this,"localCandidateCount",0),Qm(this,"allCandidatesReceived",!1),Qm(this,"remoteCodecs",void 0),Qm(this,"dataStreamChannelMap",new Map),Qm(this,"establishPromise",void 0),Qm(this,"mutex",new KS("NVExtentionsConnection-mutex")),Qm(this,"rtcMedia",void 0),this.store=d,this.peerConnection=g,this.statsFilter=yL(this.peerConnection,cE("STATS_UPDATE_INTERVAL"),void 0,H_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(s){try{const d=await this.peerConnection.createOffer();if(!d.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const g=X0(d.sdp),b=await hG({filterRTX:!cE("USE_PUB_RTX")&&!cE("USE_SUB_RTX"),filterVideoFec:cE("FILTER_VIDEO_FEC"),filterAudioFec:cE("FILTER_AUDIO_FEC"),filterVideoCodec:cE("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=b,this.initialOffer=d,PL(PL({},g),{},{rtpCapabilities:b,offerSDP:d.sdp})}catch(d){throw new EE(rE.GET_LOCAL_CONNECTION_PARAMS_FAILED,d.toString())}}async connect(s,d,g,b,$,Vt){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new ght({remoteIceParameters:s,remoteDtlsParameters:d,candidates:g,remoteRTPCapabilities:b,remoteSetup:$,localCapabilities:gN(this.localCapabilities),cname:Vt});const zt=this.remoteSDP.toString(),_e=iS.parse(this.initialOffer.sdp),_r=_e.mediaDescriptions.find(_a=>_a.media.mediaType==="audio");_r&&Q0(_r),this.useXR&&bL(_e);const _o=iS.print(_e),ga=this.logSDPExchange(_o||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:_o}),ga==null||ga(zt),await this.peerConnection.setRemoteDescription({type:"answer",sdp:zt})}catch(zt){throw new EE(rE.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(zt.toString()))}}async updateRemoteRTPCapabilities(s,d){if(this.remoteCodecs=d,!this.remoteSDP)return void _l.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(d));if(this.remoteSDP.updateRemoteCodec(s,d,this.store.codec)){const g=await this.peerConnection.createOffer(),b=this.logSDPExchange(g.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(g);const $=this.remoteSDP.toString();b==null||b($),await this.peerConnection.setRemoteDescription({type:"answer",sdp:$})}else _l.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(s){var d,g,b,$;(d=this.remoteSDP)===null||d===void 0||d.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&(($=this.remoteSDP)===null||$===void 0||$.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(g=this.remoteSDP)===null||g===void 0||g.preloadRemoteMedia(2);const Vt=(b=this.remoteSDP)===null||b===void 0?void 0:b.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:Vt});const zt=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(zt),_l.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(s,d,g){var b=this;return BT(function*(){const $=yield f_(b.mutex.lock("From NVExtentionsConnection.send"));try{if(!b.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const Vt=[];s.forEach(_p=>{const _f=b.peerConnection.addTransceiver(_p._mediaStreamTrack,{direction:"sendonly"});Vt.push(_f)}),H_()&&cE("SIMULCAST")===!0&&(yield f_(b.applySimulcastForFirefox(Vt,s)));const zt=yield f_(b.peerConnection.createOffer()),_e=b.remoteSDP.predictReceivingMids(s.length),_r=b.mungSendOfferSDP(zt.sdp,s,_e),_o=iS.parse(_r),ga=_e.map(_p=>{const _f=_o.mediaDescriptions.find(eE=>eE.attributes.mid===_p);if(!_f)throw new Error("Cannot extract ssrc from mediaDescription.");return uG(_f,cE("USE_PUB_RTX"))});let _a;try{_a=yield ga}catch(_p){_a=[],b.remoteSDP.receive(s,d,g,_a);const _f=b.remoteSDP.toString();throw yield f_(b.peerConnection.setLocalDescription({type:"offer",sdp:_r})),yield f_(b.peerConnection.setRemoteDescription({type:"answer",sdp:_f})),yield f_(b.stopSending(_e,!0)),_p}b.remoteSDP.receive(s,d,g,_a);const _c=b.remoteSDP.toString(),tE=b.logSDPExchange(_r,"offer","local","send");return yield f_(b.peerConnection.setLocalDescription({type:"offer",sdp:_r})),yield f_(b.applySimulcastEncodings(Vt,s)),yield f_(b.applySendEncodings(Vt,s)),tE==null||tE(_c),yield f_(b.peerConnection.setRemoteDescription({type:"answer",sdp:_c})),Vt.map((_p,_f)=>{const eE=_e[_f];return{localSSRC:ga[_f],id:eE,transceiver:_p}})}catch(Vt){throw Vt instanceof EE?Vt:new EE(rE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(Vt.toString()))}finally{$()}})()}async stopSending(s,d){const g=d?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const b=this.peerConnection.getTransceivers().filter(_e=>s.indexOf(_e.mid)!==-1);if(b.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");b.map(_e=>{var _r;_e.direction="inactive",(_r=_e.stop)===null||_r===void 0||_r.call(_e)});const $=await this.peerConnection.createOffer(),Vt=this.logSDPExchange($.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription($),this.remoteSDP.stopReceiving(s);const zt=this.remoteSDP.toString();Vt==null||Vt(zt),await this.peerConnection.setRemoteDescription({type:"answer",sdp:zt})}catch(b){throw new EE(rE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(b.toString()))}finally{g&&g()}}async createDataChannels(s,d){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let g=this.dataStreamChannelMap.get(s);return g&&g.readyState==="open"?_l.debug("[P2PConnection] Channels are already available and can be reused directly."):(g=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:cE("DATASTREAM_MAX_RETRANSMITS")}),g.binaryType="arraybuffer",this.dataStreamChannelMap.set(s,g)),void d.forEach(b=>{b._updateOriginDataChannel(g)})}catch(g){throw g instanceof EE?g:new EE(rE.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(g.toString()))}}async stopDataChannels(s){try{const d=this.dataStreamChannelMap.get(s);return d==null||d.close(),void this.dataStreamChannelMap.delete(s)}catch(d){throw d instanceof EE?d:new EE(rE.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(d.toString()))}}async receive(s,d,g,b){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(s," before remoteSDP created."));const{mid:$,needExchangeSDP:Vt}=this.remoteSDP.send(s,d,g,b);if(Vt){const _e=this.remoteSDP.toString(),_r=this.logSDPExchange(_e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_e});const _o=await this.peerConnection.createAnswer(),ga=this.mungReceiveAnswerSDP(_o.sdp,$,s);_r==null||_r(ga||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:ga}),_l.debug("[NVExtentionsConnection] receive ".concat(s," by exchanging SDP."))}else _l.debug("[NVExtentionsConnection] receive ".concat(s," no need to exchange SDP."));const zt=this.peerConnection.getTransceivers().find(_e=>_e.mid===$);if(!zt)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:zt.receiver.track,id:$}}catch($){throw new EE(rE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat($.toString()))}}async batchReceive(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:d,needExchangeSDP:g}=this.remoteSDP.batchSend(s);if(g){const b=this.remoteSDP.toString(),$=this.logSDPExchange(b,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:b});const Vt=await this.peerConnection.createAnswer();$==null||$(Vt.sdp||""),await this.peerConnection.setLocalDescription(Vt),_l.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else _l.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return d.map(b=>{const $=this.peerConnection.getTransceivers().find(Vt=>Vt.mid===b);if(!$)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:$.receiver.track,id:b}})}catch(d){throw new EE(rE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(s);const d=this.remoteSDP.toString(),g=this.logSDPExchange(d,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const b=await this.peerConnection.createAnswer();g==null||g(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(d){throw new EE(rE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(d.toString()))}}async muteRemote(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(s," before remote SDP created."));this.remoteSDP.mute(s);const d=this.remoteSDP.toString(),g=this.logSDPExchange(d,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const b=await this.peerConnection.createAnswer();g==null||g(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(d){throw new EE(rE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(d.toString()))}}async unmuteRemote(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(s," before remote SDP created."));this.remoteSDP.unmute(s);const d=this.remoteSDP.toString(),g=this.logSDPExchange(d,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const b=await this.peerConnection.createAnswer();g==null||g(b.sdp||""),await this.peerConnection.setLocalDescription(b)}catch(d){throw new EE(rE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(d.toString()))}}async muteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const d=this.peerConnection.getTransceivers().filter(Vt=>Vt.mid&&s.indexOf(Vt.mid)!==-1);if(d.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length.");d.map(Vt=>{Vt.direction="inactive"});const g=await this.peerConnection.createOffer(),b=this.logSDPExchange(g.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(g),this.remoteSDP.muteRemote(s);const $=this.remoteSDP.toString();b==null||b($),await this.peerConnection.setRemoteDescription({type:"answer",sdp:$})}catch(d){throw new EE(rE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(d.toString()))}}async unmuteLocal(s){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const d=this.peerConnection.getTransceivers().filter(Vt=>Vt.mid&&s.indexOf(Vt.mid)!==-1);if(d.length!==s.length)throw new Error("Transceivers' length doesn't match mids' length.");d.map(async(Vt,zt)=>{Vt.direction="sendonly"});const g=await this.peerConnection.createOffer(),b=this.logSDPExchange(g.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(g),this.remoteSDP.unmuteRemote(s);const $=this.remoteSDP.toString();b==null||b($),await this.peerConnection.setRemoteDescription({type:"answer",sdp:$})}catch(d){throw new EE(rE.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(d.toString()))}}restartICE(s){var d=this;return BT(function*(){const g=yield f_(d.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!d.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(R_().supportPCSetConfiguration){const _r=d.peerConnection.getConfiguration(),_o=s===hT.RELAY?"relay":"all";_r.iceTransportPolicy!==_o&&(_l.debug("restartICE change iceTransportPolicy from [".concat(_r.iceTransportPolicy,"] to [").concat(_o,"]")),_r.iceTransportPolicy=_o,d.peerConnection.setConfiguration(_r))}else if(s===hT.RELAY)return;s!==hT.RELAY&&d.remoteSDP.updateCandidates(s);const b=yield f_(d.peerConnection.createOffer({iceRestart:!0}));if(!b.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const $=X0(b.sdp),{remoteIceParameters:Vt}=yield $.iceParameters;d.remoteSDP.restartICE(Vt);const zt=d.remoteSDP.toString(),_e=d.logSDPExchange(b.sdp||"","offer","local","restartICE");yield f_(d.peerConnection.setLocalDescription(b)),_e==null||_e(zt),yield f_(d.peerConnection.setRemoteDescription({type:"answer",sdp:zt}))}catch(b){_l.warning("restart ICE failed, abort operation",b)}finally{g()}})()}close(){var s;(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(s){return this.statsFilter.getVideoIsReady(s)}async updateEncoderConfig(s,d){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const g=await this.peerConnection.createOffer(),b=this.mungSendOfferSDP(g.sdp,[d],[s]);this.remoteSDP.updateRecvMedia(s,d);const $=this.remoteSDP.toString(),Vt=this.logSDPExchange(b,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:b}),Vt==null||Vt($),await this.peerConnection.setRemoteDescription({type:"answer",sdp:$})}catch(g){throw new EE(rE.EXCHANGE_SDP_FAILED,g.toString())}}async updateSendParameters(s,d){const g=this.peerConnection.getTransceivers().filter(b=>b.mid===s);g.length===1&&(this.isVP8Simulcast(d)?H_()||await this.applySimulcastEncodings(g,[d]):await this.applySendEncodings(g,[d]))}setStatsRemoteVideoIsReady(s,d){this.statsFilter.setVideoIsReady2(s,d)}async replaceTrack(s,d){const g=this.peerConnection.getTransceivers().find(b=>b.mid===d);g&&await g.sender.replaceTrack(s._mediaStreamTrack)}getP2PConnectionParams(){var s;if((s=this.peerConnection.currentLocalDescription)===null||s===void 0||!s.sdp||!this.localCapabilities)throw new Error;return PL(PL({},X0(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var s;(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var s;(s=this.onConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=s=>{s.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,_l.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,_l.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},cE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(s){const d={iceServers:[]};return s.iceServers?d.iceServers=s.iceServers:s.turnServer&&s.turnServer.mode!=="off"&&(jO(s.turnServer.servers)?d.iceServers=s.turnServer.servers:(d.iceServers&&d.iceServers.push(...HL.turnServerConfigToIceServers(s.turnServer.servers)),cE("USE_TURN_SERVER_OF_GATEWAY")&&d.iceServers&&s.turnServer.serversFromGateway&&d.iceServers.push(...HL.turnServerConfigToIceServers(s.turnServer.serversFromGateway)),cE("FORCE_TURN_TCP")?d.iceTransportPolicy="relay":s.turnServer.servers.concat(s.turnServer.serversFromGateway||[]).forEach(g=>{g.forceturn&&(d.iceTransportPolicy="relay")}))),d}static turnServerConfigToIceServers(s){const d=[];return s.forEach(g=>{g.security?g.tcpport&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(aI(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}):(g.udpport&&!cE("FORCE_TURN_TCP")&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.udpport,"?transport=udp")}),g.tcpport&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.tcpport,"?transport=tcp")}))}),d}async applySendEncodings(s,d){try{if(!R_().supportSetRtpSenderParameters||s.length!==d.length)return;for(let ga=0;ga<s.length;ga++){const _a=s[ga],_c=d[ga];if(_c&&_c instanceof Y_){var g,b,$;if(this.isVP8Simulcast(_c))continue;const tE={},_p={};switch(_c._optimizationMode){case"motion":tE.degradationPreference="maintain-framerate";break;case"detail":tE.degradationPreference="maintain-resolution";break;default:tE.degradationPreference="balanced"}var Vt,zt,_e,_r;if((g=_c._encoderConfig)!==null&&g!==void 0&&g.bitrateMax&&(_p.maxBitrate=1e3*((Vt=_c._encoderConfig)===null||Vt===void 0?void 0:Vt.bitrateMax)),KE(b=_c._hints).call(b,Z_.LOW_STREAM)&&((zt=_c._encoderConfig)!==null&&zt!==void 0&&zt.frameRate&&(_p.maxFramerate=kT(_c._encoderConfig.frameRate)),(_e=_c._encoderConfig)!==null&&_e!==void 0&&_e.scaleResolutionDownBy&&((_r=_c._encoderConfig)===null||_r===void 0?void 0:_r.scaleResolutionDownBy)>1&&(_p.scaleResolutionDownBy=_c._encoderConfig.scaleResolutionDownBy)),cE("DSCP_TYPE")&&tI()){var _o;const iE=cE("DSCP_TYPE");KE(_o=["very-low","low","medium","high"]).call(_o,iE)&&(_p.networkPriority=iE)}const _f=_a.sender.getParameters(),eE=($=_f.encodings)===null||$===void 0?void 0:$[0];H_()&&!eE&&(tE.encodings=[_p]),eE&&Object.assign(eE,_p),Object.assign(_f,tE),await _a.sender.setParameters(_f)}}}catch{_l.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(s,d,g){const b=iS.parse(s);return d.forEach(($,Vt)=>{const zt=g[Vt],_e=b.mediaDescriptions.find(_r=>_r.attributes.mid===zt);_e&&(mI(_e,$),dG(_e,$,this.store.codec))}),iS.print(b)}mungReceiveAnswerSDP(s,d,g){const b=iS.parse(s),$=b.mediaDescriptions.find(Vt=>Vt.attributes.mid===d);return $&&g===_g.AUDIO&&$.media.mediaType==="audio"&&Q0($),this.useXR&&bL(b),iS.print(b)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=s=>{var d;(d=this.onFirstAudioReceived)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstVideoReceived=s=>{var d;(d=this.onFirstVideoReceived)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstAudioDecoded=s=>{var d;(d=this.onFirstAudioDecoded)===null||d===void 0||d.call(this,s)},this.statsFilter.onFirstVideoDecoded=(s,d,g)=>{var b;(b=this.onFirstVideoDecoded)===null||b===void 0||b.call(this,s,d,g)},this.statsFilter.onSelectedLocalCandidateChanged=(s,d)=>{var g;(g=this.onSelectedLocalCandidateChanged)===null||g===void 0||g.call(this,s,d)},this.statsFilter.onSelectedRemoteCandidateChanged=(s,d)=>{var g;(g=this.onSelectedRemoteCandidateChanged)===null||g===void 0||g.call(this,s,d)},this.statsFilter.onFirstVideoDecodedTimeout=s=>{var d;(d=this.onFirstVideoDecodedTimeout)===null||d===void 0||d.call(this,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(s,d){if(s.length===d.length)for(let _e=0;_e<s.length;_e++){var g,b,$,Vt,zt;const _r=s[_e],_o=d[_e];if(_o instanceof Y_&&!KE(g=_o._hints).call(g,Z_.LOW_STREAM)&&(b=_o._encoderConfig)!==null&&b!==void 0&&b.bitrateMax&&(($=_o._encoderConfig)===null||$===void 0?void 0:$.bitrateMax)>200&&(Vt=_o._scalabilityMode)!==null&&Vt!==void 0&&Vt.numSpatialLayers&&((zt=_o._scalabilityMode)===null||zt===void 0?void 0:zt.numSpatialLayers)>1&&this.store.codec==="vp8"){const ga={},_a={high:1e3*(_o._encoderConfig.bitrateMax-50),medium:5e4};ga.encodings=[{rid:"m",active:!0,maxBitrate:_a.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_a.high}];const _c=_r.sender.getParameters();await _r.sender.setParameters(Object.assign(_c,ga))}}}async applySimulcastEncodings(s,d){if(!H_()&&s.length===d.length)for(let g=0;g<s.length;g++){const b=d[g];if(b instanceof Y_&&this.isVP8Simulcast(b)){const $=s[g],Vt={},zt={high:1e3*(b._encoderConfig.bitrateMax-50),medium:5e4};Vt.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:zt.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:zt.medium,scaleResolutionDownBy:4}];const _e=$.sender.getParameters();await $.sender.setParameters(Object.assign(_e,Vt))}}}isVP8Simulcast(s){var d,g,b,$,Vt;return!!(s instanceof Y_&&cE("SIMULCAST")&&this.store.codec==="vp8"&&!KE(d=s._hints).call(d,Z_.LOW_STREAM)&&(g=s._encoderConfig)!==null&&g!==void 0&&g.bitrateMax&&((b=s._encoderConfig)===null||b===void 0?void 0:b.bitrateMax)>200&&($=s._scalabilityMode)!==null&&$!==void 0&&$.numSpatialLayers&&((Vt=s._scalabilityMode)===null||Vt===void 0?void 0:Vt.numSpatialLayers)>1)}logSDPExchange(s,d,g,b){if(cE("SDP_LOGGING"))return _l.upload("exchanging ".concat(g," ").concat(d," SDP during NVExtentionsConnection.").concat(b,`
`),s),d==="offer"?$=>{this.logSDPExchange($,"answer",g==="local"?"remote":"local",b)}:void 0}async getRemoteSSRC(s){if(!this.remoteSDP)return;const d=this.remoteSDP.getSSRC(s);return d==null?void 0:d[0].ssrcId}setConfiguration(s){if(R_().supportPCSetConfiguration){const d=HL.resolvePCConfiguration(s);this.peerConnection.setConfiguration(d)}}},BE(N_.prototype,"connect",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"connect"),N_.prototype),BE(N_.prototype,"updateRemoteRTPCapabilities",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"updateRemoteRTPCapabilities"),N_.prototype),BE(N_.prototype,"updateRemoteConnect",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"updateRemoteConnect"),N_.prototype),BE(N_.prototype,"createDataChannels",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"createDataChannels"),N_.prototype),BE(N_.prototype,"receive",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"receive"),N_.prototype),BE(N_.prototype,"batchReceive",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"batchReceive"),N_.prototype),BE(N_.prototype,"stopReceiving",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"stopReceiving"),N_.prototype),BE(N_.prototype,"muteRemote",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"muteRemote"),N_.prototype),BE(N_.prototype,"unmuteRemote",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"unmuteRemote"),N_.prototype),BE(N_.prototype,"muteLocal",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"muteLocal"),N_.prototype),BE(N_.prototype,"unmuteLocal",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"unmuteLocal"),N_.prototype),BE(N_.prototype,"close",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"close"),N_.prototype),BE(N_.prototype,"updateEncoderConfig",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"updateEncoderConfig"),N_.prototype),BE(N_.prototype,"updateSendParameters",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"updateSendParameters"),N_.prototype),BE(N_.prototype,"replaceTrack",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"replaceTrack"),N_.prototype),BE(N_.prototype,"getRemoteSSRC",[DT],Object.getOwnPropertyDescriptor(N_.prototype,"getRemoteSSRC"),N_.prototype),N_);function DT(o,s,d){const g=o[s];if(typeof g!="function")throw new Error("Cannot use mutex on object property.");return d.value=async function(){const b=this.mutex,$=await b.lock("From NVExtentionsConnection.".concat(s));try{for(var Vt=arguments.length,zt=new Array(Vt),_e=0;_e<Vt;_e++)zt[_e]=arguments[_e];return await g.apply(this,zt)}finally{$()}},d}var V_;function kJ(o){var s,d,g,b=2;for(typeof Symbol<"u"&&(d=fJ,g=Symbol.iterator);b--;){if(d&&(s=o[d])!=null)return s.call(o);if(g&&(s=o[g])!=null)return new DL(s.call(o));d="@@asyncIterator",g="@@iterator"}throw new TypeError("Object is not async iterable")}function DL(o){function s(d){if(Object(d)!==d)return GE.reject(new TypeError(d+" is not an object."));var g=d.done;return GE.resolve(d.value).then(function(b){return{value:b,done:g}})}return DL=function(d){this.s=d,this.n=d.next},DL.prototype={s:null,n:null,next:function(){return s(this.n.apply(this.s,arguments))},return:function(d){var g=this.s.return;return g===void 0?GE.resolve({value:d,done:!0}):s(g.apply(this.s,arguments))},throw:function(d){var g=this.s.return;return g===void 0?GE.reject(d):s(g.apply(this.s,arguments))}},new DL(o)}let SI=(V_=class KL extends MD{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get localCodecs(){return this._p2pConnection.localCodecs}constructor(s,d){super(s,d),Qm(this,"store",void 0),Qm(this,"peerConnection",void 0),Qm(this,"cname",void 0),Qm(this,"mutex",new KS("DataChannelConnection-mutex")),Qm(this,"dataChannel",void 0),Qm(this,"_p2pConnection",void 0),Qm(this,"establishPromise",void 0),Qm(this,"_nvMedia",void 0),this.store=d,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(KL.resolvePCConfiguration(s),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new _ht(s,d,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var s;const d=(s=this._nvMedia)===null||s===void 0?void 0:s.getLocalRtpCapabilities();return await this._p2pConnection.establish(d)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(s,d,g,b,$,Vt){return this.cname=Vt,await this._p2pConnection.connect(s,d,g,b,$,Vt),await new GE((zt,_e)=>{const _r=setTimeout(()=>{this.closeSignal(),_e(new EE(rE.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(g))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(_r),void zt()},this.dataChannel.onerror=_o=>{this.closeSignal(),_e(_o)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(s,d){return this._p2pConnection.updateRemoteRTPCapabilities(s,d)}send(s,d,g){var b=this;return BT(function*(){const $=yield f_(b.mutex.lock("From DataChannelConnection.send"));try{return yield*wL(kJ(b._p2pConnection.send(s,d,g)))}finally{$()}})()}async stopSending(s,d){return this._p2pConnection.stopSending(s,d)}async createDataChannels(s,d){return this._p2pConnection.createDataChannels(s,d)}async stopDataChannels(s){return this._p2pConnection.stopDataChannels(s)}async receive(s,d,g,b){return this._nvMedia?(_l.debug("[DataChannelConnection] receive ".concat(s," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(s,d,this.cname)):(_l.debug("[DataChannelConnection] receive ".concat(s," by WebRTC.")),await this._p2pConnection.receive(s,d,g,b))}async batchReceive(s){return[...await this._p2pConnection.batchReceive(s)]}async stopReceiving(s){return await this._p2pConnection.stopReceiving(s)}async muteRemote(s){return await this._p2pConnection.muteRemote(s)}async unmuteRemote(s){return await this._p2pConnection.unmuteRemote(s)}async muteLocal(s){return await this._p2pConnection.muteLocal(s)}async unmuteLocal(s){return await this._p2pConnection.unmuteLocal(s)}restartICE(s){var d=this;return BT(function*(){return yield*wL(kJ(d._p2pConnection.restartICE(s)))})()}close(){var s;(s=this._nvMedia)===null||s===void 0||s.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(s){return this._p2pConnection.getRemoteVideoIsReady(s)}updateRemoteConnect(s){var d;(d=this._nvMedia)===null||d===void 0||d.setRemoteRtpCapabilities(s),this._p2pConnection.updateRemoteConnect(s)}async updateEncoderConfig(s,d){return await this._p2pConnection.updateEncoderConfig(s,d)}async updateSendParameters(s,d){return await this._p2pConnection.updateSendParameters(s,d)}setStatsRemoteVideoIsReady(s,d){this._p2pConnection.setStatsRemoteVideoIsReady(s,d)}async replaceTrack(s,d){return await this._p2pConnection.replaceTrack(s,d)}async getRemoteSSRC(s){return this._p2pConnection.getRemoteSSRC(s)}logSDPExchange(s,d,g,b){if(cE("SDP_LOGGING"))return _l.upload("exchanging ".concat(g," ").concat(d," SDP during DataChannelConnection.").concat(b,`
`),s),d==="offer"?$=>{this.logSDPExchange($,"answer",g==="local"?"remote":"local",b)}:void 0}static resolvePCConfiguration(s){const d={iceServers:[]};return s.iceServers?d.iceServers=s.iceServers:s.turnServer&&s.turnServer.mode!=="off"&&(jO(s.turnServer.servers)?d.iceServers=s.turnServer.servers:(d.iceServers&&d.iceServers.push(...KL.turnServerConfigToIceServers(s.turnServer.servers)),cE("USE_TURN_SERVER_OF_GATEWAY")&&d.iceServers&&s.turnServer.serversFromGateway&&d.iceServers.push(...KL.turnServerConfigToIceServers(s.turnServer.serversFromGateway)),cE("FORCE_TURN_TCP")?d.iceTransportPolicy="relay":s.turnServer.servers.concat(s.turnServer.serversFromGateway||[]).forEach(g=>{g.forceturn&&(d.iceTransportPolicy="relay")}))),d}static turnServerConfigToIceServers(s){const d=[];return s.forEach(g=>{g.security?g.tcpport&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(aI(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}):(g.udpport&&!cE("FORCE_TURN_TCP")&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.udpport,"?transport=udp")}),g.tcpport&&d.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.tcpport,"?transport=tcp")}))}),d}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=s=>{var d;return(d=this.onICEConnectionStateChange)===null||d===void 0?void 0:d.call(this,s)},this._p2pConnection.onConnectionStateChange=s=>{var d;return(d=this.onConnectionStateChange)===null||d===void 0?void 0:d.call(this,s)},this._p2pConnection.onDTLSTransportStateChange=s=>{var d;return(d=this.onDTLSTransportStateChange)===null||d===void 0?void 0:d.call(this,s)},this._p2pConnection.onDTLSTransportError=s=>{var d;return(d=this.onDTLSTransportError)===null||d===void 0?void 0:d.call(this,s)},this._p2pConnection.onICETransportStateChange=s=>{var d;return(d=this.onICETransportStateChange)===null||d===void 0?void 0:d.call(this,s)},this._p2pConnection.onFirstAudioReceived=s=>{var d;return(d=this.onFirstAudioReceived)===null||d===void 0?void 0:d.call(this,s)},this._p2pConnection.onFirstVideoReceived=s=>{var d;return(d=this.onFirstVideoReceived)===null||d===void 0?void 0:d.call(this,s)},this._p2pConnection.onFirstAudioDecoded=s=>{var d;return(d=this.onFirstAudioDecoded)===null||d===void 0?void 0:d.call(this,s)},this._p2pConnection.onFirstVideoDecoded=(s,d,g)=>{var b;return(b=this.onFirstVideoDecoded)===null||b===void 0?void 0:b.call(this,s,d,g)},this._p2pConnection.onFirstVideoDecodedTimeout=s=>{var d;return(d=this.onFirstVideoDecodedTimeout)===null||d===void 0?void 0:d.call(this,s)},this._p2pConnection.onSelectedLocalCandidateChanged=(s,d)=>{var g;return(g=this.onSelectedLocalCandidateChanged)===null||g===void 0?void 0:g.call(this,s,d)},this._p2pConnection.onSelectedRemoteCandidateChanged=(s,d)=>{var g;return(g=this.onSelectedRemoteCandidateChanged)===null||g===void 0?void 0:g.call(this,s,d)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(s){s.onConnectionStateChange=void 0,s.onICEConnectionStateChange=void 0,s.onICETransportStateChange=void 0,s.onDTLSTransportStateChange=void 0,s.onDTLSTransportError=void 0,s.onFirstAudioDecoded=void 0,s.onFirstAudioReceived=void 0,s.onFirstVideoDecoded=void 0,s.onFirstVideoReceived=void 0,s.onSelectedLocalCandidateChanged=void 0,s.onSelectedRemoteCandidateChanged=void 0,s.onFirstVideoDecodedTimeout=void 0}setConfiguration(s){this._p2pConnection.setConfiguration(s)}},BE(V_.prototype,"connect",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"connect"),V_.prototype),BE(V_.prototype,"updateRemoteRTPCapabilities",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"updateRemoteRTPCapabilities"),V_.prototype),BE(V_.prototype,"createDataChannels",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"createDataChannels"),V_.prototype),BE(V_.prototype,"receive",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"receive"),V_.prototype),BE(V_.prototype,"stopReceiving",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"stopReceiving"),V_.prototype),BE(V_.prototype,"muteRemote",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"muteRemote"),V_.prototype),BE(V_.prototype,"unmuteRemote",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"unmuteRemote"),V_.prototype),BE(V_.prototype,"muteLocal",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"muteLocal"),V_.prototype),BE(V_.prototype,"unmuteLocal",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"unmuteLocal"),V_.prototype),BE(V_.prototype,"close",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"close"),V_.prototype),BE(V_.prototype,"updateEncoderConfig",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"updateEncoderConfig"),V_.prototype),BE(V_.prototype,"updateSendParameters",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"updateSendParameters"),V_.prototype),BE(V_.prototype,"replaceTrack",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"replaceTrack"),V_.prototype),BE(V_.prototype,"getRemoteSSRC",[e0],Object.getOwnPropertyDescriptor(V_.prototype,"getRemoteSSRC"),V_.prototype),V_);function e0(o,s,d){const g=o[s];if(typeof g!="function")throw new Error("Cannot use mutex on object property.");return d.value=async function(){const b=this.mutex,$=await b.lock("From DataChannelConnection.".concat(s));try{for(var Vt=arguments.length,zt=new Array(Vt),_e=0;_e<Vt;_e++)zt[_e]=arguments[_e];return await g.apply(this,zt)}finally{$()}},d}var E_;function PJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function bR(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?PJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):PJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}function DJ(o){var s,d,g,b=2;for(typeof Symbol<"u"&&(d=fJ,g=Symbol.iterator);b--;){if(d&&(s=o[d])!=null)return s.call(o);if(g&&(s=o[g])!=null)return new LL(s.call(o));d="@@asyncIterator",g="@@iterator"}throw new TypeError("Object is not async iterable")}function LL(o){function s(d){if(Object(d)!==d)return GE.reject(new TypeError(d+" is not an object."));var g=d.done;return GE.resolve(d.value).then(function(b){return{value:b,done:g}})}return LL=function(d){this.s=d,this.n=d.next},LL.prototype={s:null,n:null,next:function(){return s(this.n.apply(this.s,arguments))},return:function(d){var g=this.s.return;return g===void 0?GE.resolve({value:d,done:!0}):s(g.apply(this.s,arguments))},throw:function(d){var g=this.s.return;return g===void 0?GE.reject(d):s(g.apply(this.s,arguments))}},new LL(o)}let ML=(E_=class extends nS{get state(){return this._state}set state(o){const s=this._state;this._state=o,this.emit(a_.StateChange,s,this._state)}constructor(o,s){super(),Qm(this,"store",void 0),Qm(this,"statsUploader",void 0),Qm(this,"connection",void 0),Qm(this,"localTrackMap",new Map),Qm(this,"remoteUserMap",new Map),Qm(this,"localDataChannels",[]),Qm(this,"remoteDataChannelMap",new Map),Qm(this,"pendingLocalTracks",[]),Qm(this,"pendingRemoteTracks",[]),Qm(this,"pendingLocalDataChannels",[]),Qm(this,"pendingRemoteDataChannels",[]),Qm(this,"statsCollector",void 0),Qm(this,"isPlanB",!1),Qm(this,"shouldForwardP2PCreation",void 0),Qm(this,"iceFailedCount",0),Qm(this,"dtlsFailedCount",0),Qm(this,"mutex",new KS("P2PChannel-mutex")),Qm(this,"_state",j_.Disconnected),Qm(this,"_pcStatsUploadType",cE("NEW_ICE_RESTART")?DR.FIRST_CONNECTION:DR.OLD_FIRST_CONNECTION),Qm(this,"_isInRestartIce",!1),Qm(this,"_isStartRestartIce",!1),Qm(this,"_restartStates",["disconnected","failed"]),Qm(this,"_restartTimer",void 0),Qm(this,"_isFirstConnected",!0),Qm(this,"handleMuteLocalTrack",async(d,g,b)=>{const $=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==j_.Connected)return void b(new TE(rE.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const Vt=this.filterTobeMutedTracks(d);if(Vt.length===0)return void g();const zt=Vt.find(_r=>_r[0]==="videoLowTrack");zt&&zt[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(Vt.map(_r=>{let[,{id:_o}]=_r;return _o}));const _e=this.createMuteMessage(Vt);await K_(this,a_.RequestMuteLocal,_e),g()}catch(Vt){b(Vt)}finally{$()}}),Qm(this,"handleUnmuteLocalTrack",async(d,g,b)=>{const $=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==j_.Connected)return void b(new TE(rE.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const Vt=this.filterTobeUnmutedTracks(d);if(Vt.length===0)return void g();const zt=Vt.find(_r=>_r[0]==="videoLowTrack");if(zt){const _r=zt[1];if(_r.track._originMediaStreamTrack.stop(),!cE("DISABLE_DUAL_STREAM_USE_ENCODING")&&R_().supportDualStreamEncoding){const _o=d._mediaStreamTrack.clone();_r.track._mediaStreamTrack=_o,_r.track._originMediaStreamTrack=_o}else{const _o=fG(d,VI(this,a_.RequestLowStreamParameter));_r.track._mediaStreamTrack=_o,_r.track._originMediaStreamTrack=_o}await new GE((_o,ga)=>{this.handleReplaceTrack(_r.track,_o,ga,!0)})}await this.connection.unmuteLocal(Vt.map(_r=>{let[,{id:_o}]=_r;return _o}));const _e=this.createUnmuteMessage(Vt);await K_(this,a_.RequestUnmuteLocal,_e),g()}catch(Vt){b(Vt)}finally{$()}}),Qm(this,"handleUpdateVideoEncoder",async(d,g,b)=>{const $=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const Vt=this.localTrackMap.get(ME.LocalVideoTrack);if(!this.connection||!Vt||Vt.track!==d||this.state!==j_.Connected)return void g();const{id:zt,track:_e}=Vt;await this.connection.updateSendParameters(zt,_e),await this.connection.updateEncoderConfig(zt,_e),this.emit(a_.UpdateVideoEncoder,_e),g()}catch(Vt){b(Vt)}finally{$()}}),Qm(this,"handleUpdateVideoSendParameters",async(d,g,b)=>{const $=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const Vt=this.localTrackMap.get(ME.LocalVideoTrack);if(!this.connection||!Vt||Vt.track!==d||this.state!==j_.Connected)return void g();const{id:zt,track:_e}=Vt;await this.connection.updateSendParameters(zt,_e),g()}catch(Vt){b(Vt)}finally{$()}}),Qm(this,"handleReplaceMixingTrack",async(d,g,b,$)=>{if(!this.connection||this.state!==j_.Connected)return void g();const Vt=EG([d]);let zt;_l.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(Vt.getTrackId(),"]")),typeof $=="boolean"&&$||(zt=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(d,Vt),g()}catch(_r){b(_r)}finally{var _e;(_e=zt)===null||_e===void 0||_e()}}),Qm(this,"handleReplaceTrack",async(d,g,b,$)=>{let Vt;_l.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(d.getTrackId(),"]")),typeof $=="boolean"&&$||(Vt=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var zt;const _r=Array.from(this.localTrackMap.entries()).find(_o=>{let[,{track:ga}]=_o;return d===ga});if(!this.connection||!_r||this.state!==j_.Connected)return void g();if(await((zt=this.connection)===null||zt===void 0?void 0:zt.replaceTrack(d,_r[1].id)),this.isPlanB){const _o=_r[1];_o.id=d._mediaStreamTrack.id,this.localTrackMap.set(_r[0],_o)}if(_r[0]===ME.LocalVideoTrack&&!cE("DISABLE_DUAL_STREAM_USE_ENCODING")&&R_().supportDualStreamEncoding){const _o=this.localTrackMap.get(ME.LocalVideoLowTrack);if(_o){const ga=d._mediaStreamTrack.clone();_o.track._originMediaStreamTrack.stop(),_o.track._mediaStreamTrack=ga,_o.track._originMediaStreamTrack=ga,await new GE((_a,_c)=>{this.handleReplaceTrack(_o.track,_a,_c,!0)})}}g()}catch(_r){b(_r)}finally{var _e;(_e=Vt)===null||_e===void 0||_e()}}),Qm(this,"handleGetRTCStats",d=>{d(this.statsCollector.getRTCStats())}),Qm(this,"handleGetLocalVideoStats",d=>{d(this.statsCollector.getLocalVideoTrackStats())}),Qm(this,"handleGetLocalAudioStats",d=>{d(this.statsCollector.getLocalAudioTrackStats())}),Qm(this,"handleGetRemoteVideoStats",d=>this.statsCollector.getRemoteVideoTrackStats(d.uid)[d.uid]),Qm(this,"handleGetRemoteAudioStats",d=>this.statsCollector.getRemoteAudioTrackStats(d.uid)[d.uid]),this.store=o,this.statsCollector=s,this.statsCollector.addP2PChannel(this),this.statsUploader=new X9(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!R_().supportUnifiedPlan||cE("CHROME_FORCE_PLAN_B")&&tI(),this.shouldForwardP2PCreation=cE("FORWARD_P2P_CREATION")&&R_().supportPCSetConfiguration&&yV(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new SI({},this.store):this.isPlanB?new _N({},this.store):new tR({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(o,s){var d;this.state=j_.New;const g=this.shouldForwardP2PCreation&&((d=this.connection)===null||d===void 0?void 0:d.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!g||(g&&this.connection&&(_l.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new SI(o,this.store):this.isPlanB?new _N(o,this.store):new tR(o,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new TE(rE.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=cE("NEW_ICE_RESTART")?DR.FIRST_CONNECTION:DR.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(o),this.connection.establishPromise}async connect(o,s,d,g,b,$){if(!this.connection)throw new TE(rE.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof SI?this.connection.updateRemoteConnect(g):(this.store.peerConnectionStart(),await this.connection.connect(o,s,d,g,b,$),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=j_.Connected)}updateRemoteRTPCapabilities(o){const s=Array.from(this.localTrackMap.entries()).filter(b=>{var $;let[Vt]=b;return KE($=[ME.LocalVideoLowTrack,ME.LocalVideoTrack]).call($,Vt)}),d=s.map(b=>{let[,{id:$}]=b;return $}),g=s.map(b=>{let[$]=b;return $});if(this.connection instanceof tR){if(t_.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(g),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(o)}),!KE(o).call(o,this.store.codec)){const b=["vp9","vp8","h264"].find($=>KE(o).call(o,$));b&&(this.store.codec=b,_l.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(b,".")))}this.connection.updateRemoteRTPCapabilities(d,o)}}async preConnect(o,s,d,g,b,$){if(!this.connection)throw new TE(rE.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const Vt=await this.connection.connect(o,s,d,g,b,$);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=j_.Connected,Vt}getEstablishParams(){if(this.connection instanceof SI)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(o){if(!this.connection||this.state!==j_.Connected){if(this.state===j_.Disconnected)throw new TE(rE.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return void o.forEach(d=>{var g;KE(g=this.pendingLocalDataChannels).call(g,d)||this.pendingLocalDataChannels.push(d)})}const s=this.filterTobePublishedDataChannels(o);s.length!==0&&(s.forEach(d=>{const g=Date.now();this.store.publish(d.id.toString(),"datachannel",g)}),await this.connection.createDataChannels(this.store.uid,s),s.forEach(d=>{this.localDataChannels.push(d);const g=Date.now();this.store.publish(d.id+"","datachannel",void 0,g)}))}publish(o,s,d){var g=this;return BT(function*(){const b=yield f_(g.mutex.lock("From P2PChannel.publish"));try{if(!g.connection||g.state!==j_.Connected){if(g.state===j_.Disconnected)throw new TE(rE.UNEXPECTED_ERROR,"PeerConnection already disconnected.");g.throwIfTrackTypeNotMatch(o);const Vt=o.filter(zt=>g.pendingLocalTracks.indexOf(zt)===-1);return void(g.pendingLocalTracks=g.pendingLocalTracks.concat(Vt))}g.store.pubId=g.store.pubId+1,aT.markPublishStart(g.store.clientId,g.store.pubId);const $=g.filterTobePublishedTracks(o,s,d);if($.length===0)return void(yield f_(g.tryToUnmuteAudio(o)));yield*wL(DJ(g.doPublish(g.connection,$)))}finally{b()}})()}doPublish(o,s){var d=this;return BT(function*(){s.forEach(ga=>{let{track:_a,type:_c}=ga;const tE=Date.now();d.store.publish(_a.getTrackId(),_c===ME.LocalAudioTrack?"audio":"video",tE)}),d.bindLocalTrackEvents(s);const g=s.map(ga=>{let{track:_a}=ga;return _a}),b=yield f_(o.send(s.map(ga=>{let{track:_a}=ga;return _a}),d.store.codec,d.store.audioCodec)),$=(yield f_(b.next())).value,Vt=d.createGatewayPublishMessage(s,$);let zt;try{zt=yield Vt}catch(ga){throw b.throw(ga),(ga==null?void 0:ga.code)===rE.WS_ABORT&&s.forEach(_a=>{let{track:_c}=_a;d.pendingLocalTracks.indexOf(_c)===-1&&d.pendingLocalTracks.push(_c)}),d.unbindLocalTrackEvents(s),ga}const _e=d.mapPubResToRemoteConfig(Vt,zt),_r=(yield f_(b.next(_e))).value,_o=cE("ENABLE_VIDEO_SEI");g.forEach(async ga=>{const _a=ga.getRTCRtpTransceiver();_a&&_o&&(ga.trackMediaType===_g.VIDEO?await qdt(_a.sender,ga):ga.trackMediaType===_g.AUDIO&&await async function(_c){if(!R_().supportWebRTCEncodedTransform)return void _l.warning("browser not support audio encoded transform");if(gL.has(_c)||!_c.track)return;const tE={track:_c.track};if(_w()){if(!_c.createEncodedStreams)return void _l.warning("browser not support createEncodedStreams() API");let _f=null;try{_f=_c.createEncodedStreams()}catch(iE){return void _l.error("create audio-encoded-streams error",iE&&iE.message)}const eE=new TransformStream({transform(iE,fE){tE.controller||(tE.controller=fE),_c.track&&_c.track.id!==tE.track.id&&(_l.debug("audio track changed: ".concat(tE.track.id," => ").concat(_c.track.id)),tE.track.removeEventListener("ended",_p),tE.track=_c.track,tE.track.addEventListener("ended",_p)),fE.enqueue(iE)}});_f.readable.pipeThrough(eE).pipeTo(_f.writable)}else if(GS()){if(typeof RTCRtpScriptTransform>"u")return void _l.warning("browser not support RTCRtpScriptTransform");const _f=EL(),eE=new MessageChannel;await new GE(fE=>_f.onmessage=mE=>{mE.data==="registered"&&fE(void 0)});const iE=new RTCRtpScriptTransform(_f,{name:"tx",port:eE.port2},[eE.port2]);_c.transform=iE,await new GE(fE=>_f.onmessage=mE=>{mE.data==="started"&&fE(void 0)}),eE.port1.onmessage=fE=>{var mE;fE.data.transformed&&_c.track&&((mE=_c.track)===null||mE===void 0?void 0:mE.id)!==tE.track.id&&(_l.debug("audio track changed: ".concat(tE.track.id," => ").concat(_c.track.id)),tE.track.removeEventListener("ended",_p),tE.track=_c.track,tE.track.addEventListener("ended",_p))},tE.worker=_f}function _p(){if(_c.track){if(this.id!==_c.track.id)return;_c.track.removeEventListener("ended",_p)}const _f=gL.get(_c);if(_f){gL.delete(_c);try{var eE,iE;(eE=_f.controller)===null||eE===void 0||eE.terminate(),(iE=_f.worker)===null||iE===void 0||iE.terminate()}catch(fE){_l.warning(fE&&fE.message)}}}gL.set(_c,tE),_c.track.addEventListener("ended",_p)}(_a.sender))}),s.forEach(ga=>{let{type:_a}=ga;d.statsCollector.addLocalStats(_a)}),d.assignLocalTracks(s,_r),d.statsUploader.startUploadOutboundStats(),s.forEach(ga=>{let{track:_a,type:_c}=ga;const tE=Date.now();d.store.publish(_a.getTrackId(),_c===ME.LocalAudioTrack?"audio":"video",void 0,tE)})})()}async updateVideoStreamParameter(o,s){const d=this.localTrackMap.get(s);if(!d)return;if(!(d.track instanceof Y_))return _l.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof tR||this.connection instanceof _N))return _l.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:g}=d,b=function($,Vt){const zt={};return $.height&&$.width&&(zt.scaleResolutionDownBy=HV($,Vt)),zt.maxFramerate=$.framerate?kT($.framerate):void 0,zt.maxBitrate=$.bitrate?1e3*$.bitrate:void 0,zt}(o,g);if(g._encoderConfig||(g._encoderConfig={}),s!==ME.LocalVideoLowTrack||!cE("DISABLE_DUAL_STREAM_USE_ENCODING")&&R_().supportDualStreamEncoding)b.scaleResolutionDownBy!=null&&(g._encoderConfig.scaleResolutionDownBy=b.scaleResolutionDownBy);else{const $=g._originMediaStreamTrack;if(!$.canvas)return _l.warn("[".concat(g.getTrackId(),"] no canvas on track"));(function(Vt,zt){const _e=Vt.canvas;zt.width&&(_e.width=kT(zt.width)),zt.height&&(_e.height=kT(zt.height)),zt.framerate&&(_e.stopCapture&&_e.stopCapture(),_e.stopCapture=XF(()=>{!_e.startCapture&&_e.stopCapture&&_e.stopCapture(),_e.startCapture&&_e.startCapture()},kT(zt.framerate)))})($,o)}b.maxBitrate!=null&&(g._encoderConfig.bitrateMax=b.maxBitrate/1e3),b.maxFramerate!=null&&(g._encoderConfig.frameRate&&typeof g._encoderConfig.frameRate=="object"?g._encoderConfig.frameRate.max=b.maxFramerate:g._encoderConfig.frameRate={max:b.maxFramerate}),_l.debug("[".concat(g.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(g._encoderConfig))),await this.connection.updateRtpSenderEncodings(g)}publishLowStream(o){var s=this;return BT(function*(){if(!s.connection||s.state!==j_.Connected)return;const d=yield f_(s.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const b=s.localTrackMap.get(ME.LocalVideoTrack);if(!b)throw new TE(rE.UNEXPECTED_ERROR,"Could not find high stream");if(s.localTrackMap.has(ME.LocalVideoLowTrack))throw new TE(rE.UNEXPECTED_ERROR,"[".concat(s.store.clientId,"] Can't publish low stream when stream already publish"));const $=[{track:s.getLowVideoTrack(b.track,o),type:ME.LocalVideoLowTrack}];if(yield*wL(DJ(s.doPublish(s.connection,$))),b.track.muted||!b.track.enabled){var g;const Vt=(g=s.localTrackMap.get(ME.LocalVideoLowTrack))===null||g===void 0?void 0:g.id;Vt!==void 0&&(yield f_(s.connection.muteLocal([Vt])))}}finally{d()}})()}async republish(){this.pendingLocalTracks.length>0&&(_l.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await kS(this,a_.RequestRePublish,this.pendingLocalTracks),this.emit(a_.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(_l.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await kS(this,a_.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(o){for(let s=this.pendingRemoteTracks.length-1;s>=0;s--){const{user:d,kind:g}=this.pendingRemoteTracks[s];(g!==_g.AUDIO||d._audio_added_&&d._audioSSRC)&&(g!==_g.VIDEO||d._video_added_&&d._videoSSRC)||this.pendingRemoteTracks.splice(s,1)}if(o)await kS(this,a_.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:s,kind:d}of this.pendingRemoteTracks)await this.subscribe(s,d,d===_g.VIDEO?s._videoSSRC:s._audioSSRC);this.pendingRemoteTracks.forEach(s=>{let{user:d}=s;this.emit(a_.MediaReconnectEnd,d.uid)}),this.pendingRemoteTracks=[]}async unpublish(o){if(!this.connection||this.state!==j_.Connected)return void o.forEach(g=>{const b=this.pendingLocalTracks.indexOf(g);b!==-1&&this.pendingLocalTracks.splice(b,1)});const s=this.filterTobeUnpublishedTracks(o);if(s.length===0)return;const d=s.find(g=>g[0]==="videoLowTrack");return d&&d[1].track.close(),this.doUnpublish(this.connection,s)}async unpublishDataChannel(o){if(!this.connection||this.state!==j_.Connected)return void o.forEach(d=>{const g=this.pendingLocalDataChannels.indexOf(d);g!==-1&&this.pendingLocalDataChannels.splice(g,1)});const s=this.filterTobeUnpublishedDataChannels(o);return s.length!==0?(s.forEach(d=>{const g=this.localDataChannels.indexOf(d);g!==-1&&this.localDataChannels.splice(g,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),s.map(d=>d.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==j_.Connected)return;const o=this.localTrackMap.get(ME.LocalVideoLowTrack);if(!o)return;o.track.close();const s=[[ME.LocalVideoLowTrack,o]];return this.doUnpublish(this.connection,s)}async doUnpublish(o,s){const d=this.createGatewayUnpublishMessage(s);return await o.stopSending(s.map(g=>{let[,{id:b}]=g;return b})),this.withdrawLocalTracks(s),this.unbindLocalTrackEvents(s.map(g=>{let[b,{track:$}]=g;return{type:b,track:$}})),s.forEach(g=>{let[b]=g;this.statsCollector.removeLocalStats(b)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),d}async subscribeDataChannel(o,s){if(!this.connection||this.state!==j_.Connected)throw new TE(rE.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const d=s.filter(g=>{var b;return!((b=this.remoteDataChannelMap.get(o))!==null&&b!==void 0&&b.get(g.id))});if(d.length!==0)return await this.connection.createDataChannels(o.uid,d),d.forEach(g=>{var b;this.remoteDataChannelMap.has(o)?(b=this.remoteDataChannelMap.get(o))===null||b===void 0||b.set(g.id,g):this.remoteDataChannelMap.set(o,new Map([[g.id,g]]));const $=this.pendingRemoteDataChannels.findIndex(Vt=>{let{user:zt,id:_e}=Vt;return zt.uid===o.uid&&_e===g.id});$!==-1&&this.pendingRemoteDataChannels.splice($,1)}),d.map(g=>g.id)}async subscribe(o,s,d,g,b){var $;if(!this.connection||this.state!==j_.Connected)throw new TE(rE.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(($=this.remoteUserMap.get(o))!==null&&$!==void 0&&$.has(s))return;let Vt,zt,_e;if(b){const ga=b.find(_c=>{let{stream_type:tE}=_c;return tE===s});if(!ga)throw new TE(rE.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(s," for user: ").concat(o.uid," because subscribe answer from gateway does not contain stream_type: ").concat(s,"."));const _a=await this.connection.receive(s,ga.ssrcs,String(o._uintid),ga.attributes);this.connection instanceof tR&&(_e=_a.transceiver),Vt=_a.track,zt=_a.id}else{const ga=await this.connection.receive(s,[{ssrcId:d,rtx:g}],String(o._uintid),void 0);this.connection instanceof tR&&(_e=ga.transceiver),Vt=ga.track,zt=ga.id}s===_g.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(Vt):(o._audioTrack=new mN(Vt,o.uid,o._uintid,this.store),_l.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),_e&&o._audioTrack._updateRtpTransceiver(_e),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(Vt):(o._videoTrack=new fN(Vt,o.uid,o._uintid,this.store),_l.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),_e&&o._videoTrack._updateRtpTransceiver(_e),this.bindRemoteTrackEvents(o,o._videoTrack)),cE("ENABLE_VIDEO_SEI")&&_e&&(s==_g.VIDEO?await Hdt(_e.receiver,{onSei:ga=>{var _a;(_a=o._videoTrack)===null||_a===void 0||_a._onSei(ga)}}):s==_g.AUDIO&&await async function(ga){if(!R_().supportWebRTCEncodedTransform)return void _l.warning("browser not support audio encoded transform");if(_L.has(ga))return;const _a={track:ga.track};if(_w()){if(!ga.createEncodedStreams)return void _l.warning("browser not support createEncodedStreams() API");let tE=null;try{tE=ga.createEncodedStreams()}catch(_f){return void _l.error("create audio-encoded-streams error",_f&&_f.message)}const _p=new TransformStream({transform(_f,eE){_a.controller||(_a.controller=eE),ga.track&&ga.track.id!==_a.track.id&&(_l.debug("audio track changed: ".concat(_a.track.id," => ").concat(ga.track.id)),_a.track.removeEventListener("ended",_c),_a.track=ga.track,_a.track.addEventListener("ended",_c)),eE.enqueue(_f)}});tE.readable.pipeThrough(_p).pipeTo(tE.writable)}else if(GS()){if(typeof RTCRtpScriptTransform>"u")return void _l.warning("browser not support RTCRtpScriptTransform");const tE=EL(),_p=new MessageChannel;await new GE(eE=>tE.onmessage=iE=>{iE.data==="registered"&&eE(void 0)});const _f=new RTCRtpScriptTransform(tE,{name:"rx",port:_p.port2},[_p.port2]);ga.transform=_f,await new GE(eE=>tE.onmessage=iE=>{iE.data==="started"&&eE(void 0)}),_p.port1.onmessage=eE=>{var iE;eE.data.transformed&&ga.track&&((iE=ga.track)===null||iE===void 0?void 0:iE.id)!==_a.track.id&&(_l.debug("audio track changed: ".concat(_a.track.id," => ").concat(ga.track.id)),_a.track.removeEventListener("ended",_c),_a.track=ga.track,_a.track.addEventListener("ended",_c))},_a.worker=tE}function _c(){ga.track.removeEventListener("ended",_c),function(tE){const _p=_L.get(tE);if(_p){_L.delete(tE);try{var _f,eE;(_f=_p.controller)===null||_f===void 0||_f.terminate(),(eE=_p.worker)===null||eE===void 0||eE.terminate()}catch(iE){_l.warning(iE&&iE.message)}}}(ga)}_L.set(ga,_a),ga.track.addEventListener("ended",_c)}(_e.receiver));const _r=this.remoteUserMap.get(o);_r?_r.set(s,zt):this.remoteUserMap.set(o,new Map([[s,zt]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();const _o=this.pendingRemoteTracks.findIndex(ga=>{let{user:_a,kind:_c}=ga;return _a.uid===o.uid&&s===_c});_o!==-1&&(this.pendingRemoteTracks.splice(_o,1),this.emit(a_.MediaReconnectEnd,o.uid))}async massSubscribe(o){return this.massSubscribeNoLock(o)}async massSubscribeNoLock(o){if(!this.connection||this.state!==j_.Connected)throw new TE(rE.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");o=o.filter(d=>{var g;let{user:b,mediaType:$}=d;return!((g=this.remoteUserMap.get(b))!==null&&g!==void 0&&g.has($))});const s=await this.connection.batchReceive(o.map(d=>{let{user:g,mediaType:b,ssrcId:$,rtxSsrcId:Vt}=d;return{kind:b,ssrcMsg:[{ssrcId:$,rtx:Vt}],mslabel:String(g._uintid)}}));o.forEach((d,g)=>{let{user:b,mediaType:$}=d;const{track:Vt,id:zt,transceiver:_e}=s[g];$===_g.AUDIO?(b._audioTrack?b._audioTrack._updateOriginMediaStreamTrack(Vt):(b._audioTrack=new mN(Vt,b.uid,b._uintid,this.store),_l.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(b._audioTrack.getTrackId()))),_e&&b._audioTrack._updateRtpTransceiver(_e),this.bindRemoteTrackEvents(b,b._audioTrack)):(b._videoTrack?b._videoTrack._updateOriginMediaStreamTrack(Vt):(b._videoTrack=new fN(Vt,b.uid,b._uintid,this.store),_l.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(b._videoTrack.getTrackId()))),_e&&b._videoTrack._updateRtpTransceiver(_e),this.bindRemoteTrackEvents(b,b._videoTrack));const _r=this.remoteUserMap.get(b);_r?_r.set($,zt):this.remoteUserMap.set(b,new Map([[$,zt]])),this.statsCollector.addRemoteStats(b.uid),this.statsUploader.startUploadInboundStats();const _o=this.pendingRemoteTracks.findIndex(ga=>{let{user:_a,kind:_c}=ga;return _a.uid===b.uid&&$===_c});_o!==-1&&(this.pendingRemoteTracks.splice(_o,1),this.emit(a_.MediaReconnectEnd,b.uid))})}async unsubscribe(o,s,d){const g=this.pendingRemoteTracks.filter(Vt=>{let{user:zt,kind:_e}=Vt;return s!==void 0?zt.uid===o.uid&&s===_e:zt.uid===o.uid});if(g.forEach(Vt=>{const zt=this.pendingRemoteTracks.indexOf(Vt);this.pendingRemoteTracks.splice(zt,1)}),this.connection&&this.state===j_.Connected||d||g.forEach(Vt=>{let{kind:zt}=Vt;var _e;if(zt===_g.AUDIO)(_e=o._audioTrack)===null||_e===void 0||_e._destroy(),o._audioTrack=void 0;else if(zt===_g.VIDEO){var _r;(_r=o._videoTrack)===null||_r===void 0||_r._destroy(),o._videoTrack=void 0}}),!this.connection||this.state!==j_.Connected)return;const b=this.filterTobeUnSubscribedTracks(o,s);if(b.length===0)return;await this.connection.stopReceiving(b.map(Vt=>{let[,{id:zt}]=Vt;return zt}));const $=this.createUnsubscribeMessage(b);return this.withdrawRemoteTracks(b),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),b.forEach(Vt=>{let[zt,{kind:_e}]=Vt;var _r,_o;if(_e===_g.VIDEO&&zt._videoSSRC&&((_r=this.connection)===null||_r===void 0||_r.setStatsRemoteVideoIsReady(zt._videoSSRC,!1)),_e===_g.VIDEO)this.unbindRemoteTrackEvents(zt._videoTrack),d||((_o=zt._videoTrack)===null||_o===void 0||_o._destroy(),zt._videoTrack=void 0);else if(_e===_g.AUDIO){var ga;this.unbindRemoteTrackEvents(zt._audioTrack),!d&&((ga=zt._audioTrack)===null||ga===void 0||ga._destroy(),zt._audioTrack=void 0)}}),$}async unsubscribeDataChannel(o,s){if(s.forEach(b=>{const $=this.pendingRemoteDataChannels.findIndex(Vt=>Vt.id===b.id);$!==-1&&this.pendingRemoteDataChannels.splice($,1)}),!this.connection)return;const d=this.filterTobeUnSubscribedDataChannels(o,s);if(d.length===0)return;s.forEach(b=>{b._close()});const g=this.remoteDataChannelMap.get(o);return d.forEach(b=>{g&&g.delete(b.id)}),g&&g.size===0&&(this.remoteDataChannelMap.delete(o),await this.connection.stopDataChannels(o.uid)),d.map(b=>b.id)}async massUnsubscribe(o){return this.massUnsubscribeNoLock(o)}async massUnsubscribeNoLock(o){let s=[];for(const{user:b,mediaType:$}of o){const Vt=this.pendingRemoteTracks.filter(zt=>{let{user:_e,kind:_r}=zt;return $!==void 0?_e.uid===b.uid&&$===_r:_e.uid===b.uid});Vt.forEach(zt=>{const _e=this.pendingRemoteTracks.indexOf(zt);this.pendingRemoteTracks.splice(_e,1)}),s=s.concat(Vt)}if(!this.connection||this.state!==j_.Connected)return void s.forEach(b=>{let{user:$,kind:Vt}=b;var zt;if(Vt===_g.AUDIO)(zt=$._audioTrack)===null||zt===void 0||zt._destroy(),$._audioTrack=void 0;else if(Vt===_g.VIDEO){var _e;(_e=$._videoTrack)===null||_e===void 0||_e._destroy(),$._videoTrack=void 0}});const d=F0(o).call(o,(b,$)=>{let{user:Vt,mediaType:zt}=$;const _e=this.filterTobeUnSubscribedTracks(Vt,zt);return b.concat(_e)},[]);if(d.length===0)return;await this.connection.stopReceiving(d.map(b=>{let[,{id:$}]=b;return $}));const g=this.createUnsubscribeAllMessage(d);return this.withdrawRemoteTracks(d),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),d.forEach(b=>{let[$,{kind:Vt}]=b;var zt,_e;if(Vt===_g.VIDEO&&$._videoSSRC&&((zt=this.connection)===null||zt===void 0||zt.setStatsRemoteVideoIsReady($._videoSSRC,!1)),Vt===_g.VIDEO)this.unbindRemoteTrackEvents($._videoTrack),(_e=$._videoTrack)===null||_e===void 0||_e._destroy(),$._videoTrack=void 0;else if(Vt===_g.AUDIO){var _r;this.unbindRemoteTrackEvents($._audioTrack),(_r=$._audioTrack)===null||_r===void 0||_r._destroy(),$._audioTrack=void 0}}),g}async muteRemote(o,s){if(!this.connection)return;const d=this.remoteUserMap.get(o);if(!d)return void _l.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(o.uid,"."));if(!d.get(s))return void _l.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(o.uid," media type ").concat(s,"."));const g=s===_g.VIDEO?o._videoSSRC:o._audioSSRC;g!==void 0&&this.connection.setStatsRemoteVideoIsReady(g,!1)}async unmuteRemote(o,s){return this.unmuteRemoteNoLock(o,s)}async unmuteRemoteNoLock(o,s){if(!this.connection)return;const d=this.remoteUserMap.get(o);if(!d)return void _l.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(o.uid,"."));d.get(s)||_l.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(o.uid," media type ").concat(s,"."))}getAllTracks(o){const s=this.localTrackMap.get(ME.LocalAudioTrack);if((s==null?void 0:s.track)instanceof jS){const d=s.track;return Array.from(this.localTrackMap.entries()).filter(g=>{let[b]=g;return b!==ME.LocalAudioTrack}).filter(g=>{let[b]=g;return!(o&&b===ME.LocalVideoLowTrack)}).map(g=>{let[,{track:b}]=g;return b}).concat(d.trackList)}return Array.from(this.localTrackMap.entries()).filter(d=>{let[g]=d;return!(o&&g===ME.LocalVideoLowTrack)}).map(d=>{let[,{track:g}]=d;return g})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(o,s,d,g,b){if(o){const Vt=this.localTrackMap.get(ME.LocalAudioTrack),zt=g?this.localTrackMap.get(ME.LocalVideoLowTrack):this.localTrackMap.get(ME.LocalVideoTrack);t_.publish(this.store.sessionId,{eventElapse:aT.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:o,ec:s,audioName:Vt==null?void 0:Vt.track.getTrackLabel(),videoName:zt==null?void 0:zt.track.getTrackLabel(),screenshare:(zt==null?void 0:zt.track._hints.indexOf(Z_.SCREEN_TRACK))!==-1,audio:!!Vt,video:!!zt,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}else{var $;d||(d=[]);const Vt=d.find(_e=>_e instanceof mS),zt=g?($=this.localTrackMap.get(ME.LocalVideoTrack))===null||$===void 0?void 0:$.track:d.find(_e=>_e instanceof Y_);t_.publish(this.store.sessionId,{eventElapse:aT.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:o,ec:s,audioName:Vt==null?void 0:Vt.getTrackLabel(),videoName:zt==null?void 0:zt.getTrackLabel(),screenshare:(zt==null?void 0:zt._hints.indexOf(Z_.SCREEN_TRACK))!==-1,audio:!!Vt,video:!!zt,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}}reportSubscribeEvent(o,s,d,g){const b=g===_g.VIDEO?d._videoSSRC:d._audioSSRC;b&&t_.subscribe(this.store.sessionId,{succ:o,ec:s,video:g===_g.VIDEO,audio:g===_g.AUDIO,peerid:d.uid,subscribeRequestid:g===_g.VIDEO?d._videoSSRC:d._audioSSRC,p2pid:this.store.p2pId,eventElapse:aT.measureFromSubscribeStart(this.store.clientId,b)})}reset(){_l.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new KS("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new SI({},this.store):this.isPlanB?new _N({},this.store):new tR({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const o=this.localTrackMap.get(ME.LocalAudioTrack);if((o==null?void 0:o.track)instanceof jS){if(o.track.trackList.length>0){const s=o.track;o.track.trackList.forEach(d=>{s.removeAudioTrack(d)})}o.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=j_.Disconnected}getStats(){var o;return(o=this.connection)===null||o===void 0?void 0:o.getStats()}getRemoteVideoIsReady(o){var s;return((s=this.connection)===null||s===void 0?void 0:s.getRemoteVideoIsReady(o))||!1}getLocalAudioVolume(){const o=this.localTrackMap.get(ME.LocalAudioTrack);if(o)return o.track.getVolumeLevel()}getLocalVideoSize(){const o=this.localTrackMap.get(ME.LocalVideoTrack);if(o)return{width:o.track.videoWidth||0,height:o.track.videoHeight||0}}getEncoderConfig(o){const s=this.localTrackMap.get(o);return s&&s.track instanceof Y_||s&&s.track instanceof mS?s.track._encoderConfig:void 0}getLocalMedia(o){return this.localTrackMap.get(o)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(o,s){if(!o)return this.remoteUserMap.size>0;const d=this.remoteUserMap.get(o);return!!d&&(!s||d.has(s))}async hasRemoteMediaWithLock(o,s){if(!o)return this.remoteUserMap.size>0;const d=this.remoteUserMap.get(o);return!!d&&(!s||d.has(s))}getRemoteMedia(o){var s;const d=Array.from(qT(s=this.remoteUserMap).call(s)).find(g=>g.uid===o);return d?{audioTrack:d.audioTrack,audioSSRC:d._audioSSRC,videoTrack:d.videoTrack,videoSSRC:d._videoSSRC}:{}}getAudioLevels(){let o=Array.from(this.remoteUserMap.entries()).map(d=>{let[g]=d;return{uid:g.uid,level:g.audioTrack?100*g.audioTrack._source.getAccurateVolumeLevel():0}});const s=this.localTrackMap.get(ME.LocalAudioTrack);return s&&o.push({level:100*s.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),o=GN(o).call(o,(d,g)=>d.level-g.level),o}async disconnectForReconnect(){this.connection&&(_l.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=j_.Reconnecting,cE("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s]=o;var d;s._videoTrack&&s._videoTrack._player&&((d=s._videoTrack._player.getVideoElement())===null||d===void 0||d.pause(),s._videoTrack._player.isKeepLastFrame=!0,s._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new SI({},this.store):this.isPlanB?new _N({},this.store):new tR({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(o=>{var s;let[d,{track:g}]=o;switch(d){case ME.LocalVideoTrack:KE(s=g._hints).call(s,Z_.LOW_STREAM)?g.close():this.pendingLocalTracks.push(g);break;case ME.LocalAudioTrack:g instanceof jS?this.pendingLocalTracks=this.pendingLocalTracks.concat(g.trackList):this.pendingLocalTracks.push(g);case ME.LocalVideoLowTrack:}}),this.emit(a_.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s,d]=o;Array.from(qT(d).call(d)).forEach(g=>{this.setPendingRemoteMedia(s,g)}),this.emit(a_.MediaReconnectStart,s.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(o=>{this.pendingLocalDataChannels.push(o)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(o=>{let[s,d]=o;Array.from(qT(d).call(d)).forEach(g=>{this.setPendingRemoteDataChannel(s,g)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),_l.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(o,s){for(const d of this.pendingRemoteDataChannels){const{user:g,id:b}=d;if((o instanceof _I?o.uid:o)===g.uid&&b===s)return!0}return!1}setPendingRemoteDataChannel(o,s){this.hasPendingRemoteDataChannel(o,s)||this.pendingRemoteDataChannels.push({user:o,id:s})}hasPendingRemoteMedia(o,s){for(const d of this.pendingRemoteTracks){const{user:g,kind:b}=d;if((o instanceof _I?o.uid:o)===g.uid&&s===b)return!0}return!1}setPendingRemoteMedia(o,s){this.hasPendingRemoteMedia(o,s)||this.pendingRemoteTracks.push({user:o,kind:s})}restartICE(o){var s=this;return BT(function*(){if(!s.connection||s.state!==j_.Connected||s.connection instanceof SI)return;const d=yield f_(s.mutex.lock("From P2PChannel.restartICE"));let g;try{g=yield f_(s.connection.restartICE(o));const $=yield f_(g.next());if($.done)return;const Vt=$.value,zt=yield Vt;switch(s.reportPCDisconnectedOrFailed(o),o){case hT.TCP:s._pcStatsUploadType=DR.TCP_RESTART;break;case hT.RELAY:s._pcStatsUploadType=DR.RELAY_RESTART;break;default:s._pcStatsUploadType=DR.OLD_RESTART}s._isInRestartIce=!0,g.next(zt)}catch($){var b;(b=g)===null||b===void 0||b.throw($)}finally{d()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const o=this.connection.getStats(),s=this.localTrackMap.get(ME.LocalVideoTrack),d=this.localTrackMap.get(ME.LocalAudioTrack),g=o.videoSend.find(_c=>_c.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId)),b=o.audioSend.find(_c=>_c.ssrc===(d==null?void 0:d.ssrcs[0].ssrcId));if(!g||!b)return 1;const $=VT(this,a_.NeedSignalRTT),Vt=g?g.rttMs:void 0,zt=b?b.rttMs:void 0,_e=Vt&&zt?(Vt+zt)/2:Vt||zt,_r=(_e&&$?(_e+$)/2:_e||$)||0,_o=100*o.sendPacketLossRate*.7/50+.3*_r/1500,ga=_o<.17?1:_o<.36?2:_o<.59?3:_o<.1?4:5,_a=s==null?void 0:s.track;if(_a&&_a._encoderConfig&&_a._hints.indexOf(Z_.SCREEN_TRACK)===-1){const _c=_a._encoderConfig.bitrateMax,tE=o.bitrate.actualEncoded;if(_c&&tE){const _p=(1e3*_c-tE)/(1e3*_c);return E4[_p<.15?0:_p<.3?1:_p<.45?2:_p<.6?3:4][ga]}}return ga}getDownlinkNetworkQuality(){if(!this.connection)return 0;const o=this.connection.getStats();let s=0;return Array.from(this.remoteUserMap.entries()).forEach(d=>{let[g]=d;const b=g._audioSSRC,$=g._videoSSRC,Vt=o.audioRecv.find(tE=>tE.ssrc===b),zt=o.videoRecv.find(tE=>tE.ssrc===$);if(!Vt&&!zt)return void(s+=1);const _e=VT(this,a_.NeedSignalRTT),_r=o.rtt,_o=(_r&&_e?(_r+_e)/2:_r||_e)||0,ga=Vt?Vt.jitterMs:void 0,_a=o.recvPacketLossRate;let _c=.7*_a*100/50+.3*_o/1500;ga&&(_c=.6*_a*100/50+.2*_o/1500+.2*ga/400),s+=_c<.1?1:_c<.17?2:_c<.36?3:_c<.59?4:5}),this.remoteUserMap.size>0?Math.round(s/this.remoteUserMap.size):s}async muteLocalTrack(o){return new GE((s,d)=>{this.handleMuteLocalTrack(o,s,d)})}async replaceTrack(o,s){var d;if(_l.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(o.getTrackId(),"] to [").concat(s.getTrackId(),"]")),!this.connection||this.state!==j_.Connected)return;const g=Array.from(this.localTrackMap.entries()).find($=>{let[,{track:Vt}]=$;return o===Vt});if(!g)return;const b=g[0];if(o!==s&&(this.unbindLocalTrackEvents([{track:o,type:b}]),this.bindLocalTrackEvents([{track:s,type:b}]),g[1].track=s),await((d=this.connection)===null||d===void 0?void 0:d.replaceTrack(s,g[1].id)),this.isPlanB){const $=g[1];$.id=s._mediaStreamTrack.id,this.localTrackMap.set(b,$)}if(b===ME.LocalVideoTrack&&!cE("DISABLE_DUAL_STREAM_USE_ENCODING")&&R_().supportDualStreamEncoding){const $=this.localTrackMap.get(ME.LocalVideoLowTrack);if($){const Vt=o._mediaStreamTrack.clone();$.track._originMediaStreamTrack.stop(),$.track._mediaStreamTrack=Vt,$.track._originMediaStreamTrack=Vt,await new GE((zt,_e)=>{this.handleReplaceTrack($.track,zt,_e,!0)})}}}filterTobePublishedTracks(o,s,d){const g=[],b=this.getAllTracks();o=VO(o=o.filter(_e=>b.indexOf(_e)===-1));let $,Vt=!1;const zt=this.localTrackMap.get(ME.LocalAudioTrack);for(const _e of o){if(_e instanceof Y_&&(this.localTrackMap.has(ME.LocalVideoTrack)||Vt?new TE(rE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(g.push({track:_e,type:ME.LocalVideoTrack}),Vt=!0),s)){const _r=this.getLowVideoTrack(_e,d);g.push({track:_r,type:ME.LocalVideoLowTrack})}if(_e instanceof mS)if(zt){const _r=zt.track;if(_r instanceof jS)mG([_e]),_r.addAudioTrack(_e),this.bindLocalAudioTrackEvents(_e,!0);else{const _o=EG([_r,_e]);_l.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_o.getTrackId(),"]")),this.replaceTrack(_r,_o)}}else $ instanceof jS?(mG([_e]),$.addAudioTrack(_e)):$||!_e._useAudioElement&&R_().webAudioMediaStreamDest&&!_e._bypassWebAudio?$=EG($?[_e,$]:[_e]):$=_e}return $&&(_l.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat($.getTrackId(),"]")),g.push({track:$,type:ME.LocalAudioTrack})),g}filterTobeUnpublishedTracks(o){const s=[],d=this.getAllTracks();o=VO(o=o.filter(g=>d.indexOf(g)!==-1));for(const g of o){if(g instanceof mS){const b=this.localTrackMap.get(ME.LocalAudioTrack);if(!b)continue;b.track instanceof jS?(b.track.removeAudioTrack(g),this.unbindLocalAudioTrackEvents(g),b.track.trackList.length===0&&(s.push([ME.LocalAudioTrack,b]),b.track.close())):s.push([ME.LocalAudioTrack,b])}if(g instanceof Y_){const b=this.localTrackMap.get(ME.LocalVideoTrack);if(!b)continue;s.push([ME.LocalVideoTrack,b]);const $=this.localTrackMap.get(ME.LocalVideoLowTrack);$&&s.push([ME.LocalVideoLowTrack,$])}}return s}filterTobePublishedDataChannels(o){return o=(o=VO(o)).filter(s=>this.localDataChannels.findIndex(d=>d.id===s.id)===-1)}filterTobeUnpublishedDataChannels(o){return o=(o=(o=VO(o)).filter(s=>this.localDataChannels.indexOf(s)!==-1)).filter(s=>s._originDataChannel)}bindLocalTrackEvents(o){o.forEach(s=>{let{track:d,type:g}=s;switch(g){case ME.LocalVideoTrack:d.addListener(YE.GET_STATS,this.handleGetLocalVideoStats),d.addListener(YE.GET_RTC_STATS,this.handleGetRTCStats),d.addListener(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),d.addListener(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),d.addListener(YE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),d.addListener(YE.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),d.addListener(YE.NEED_REPLACE_TRACK,this.handleReplaceTrack),d.addListener(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),d.addListener(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ME.LocalAudioTrack:this.bindLocalAudioTrackEvents(d);case ME.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(o,s){o instanceof jS?o.trackList.forEach(d=>{d.addListener(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),d.addListener(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),d.addListener(YE.GET_STATS,this.handleGetLocalAudioStats),d.addListener(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),d.addListener(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(o.addListener(YE.GET_STATS,this.handleGetLocalAudioStats),o.addListener(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.addListener(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.addListener(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.addListener(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),s||(o.addListener(YE.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.addListener(YE.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(o){o||(o=Array.from(this.localTrackMap.entries()).map(s=>{let[d,{track:g}]=s;return{track:g,type:d}})),o.forEach(s=>{let{track:d,type:g}=s;switch(g){case ME.LocalVideoTrack:d.off(YE.GET_STATS,this.handleGetLocalVideoStats),d.off(YE.GET_RTC_STATS,this.handleGetRTCStats),d.off(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),d.off(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),d.off(YE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),d.off(YE.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),d.off(YE.NEED_REPLACE_TRACK,this.handleReplaceTrack),d.off(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),d.off(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ME.LocalAudioTrack:this.unbindLocalAudioTrackEvents(d);case ME.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(o){o instanceof jS?o.trackList.forEach(s=>{s.off(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(YE.GET_STATS,this.handleGetLocalAudioStats),s.off(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(o.off(YE.GET_STATS,this.handleGetLocalAudioStats),o.off(YE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(YE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(YE.NEED_REPLACE_TRACK,this.handleReplaceTrack),o.off(YE.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),o.off(YE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(YE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(o,s){s instanceof fN&&s.addListener(YE.GET_STATS,d=>{d(this.handleGetRemoteVideoStats(o))}),s instanceof mN&&s.addListener(YE.GET_STATS,d=>{d(this.handleGetRemoteAudioStats(o))})}unbindRemoteTrackEvents(o){o&&o.removeAllListeners(YE.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(o=>{let[s,d]=o;d.has(_g.AUDIO)&&this.unbindRemoteTrackEvents(s._audioTrack),d.has(_g.VIDEO)&&this.unbindRemoteTrackEvents(s._videoTrack)})}createGatewayPublishMessage(o,s){return o.map((d,g)=>{var b;let $,Vt,{track:zt,type:_e}=d;switch(_e){case ME.LocalAudioTrack:$=x_.Audio,Vt={dtx:zt instanceof mL&&zt._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ME.LocalVideoTrack:$=KE(b=zt._hints).call(b,Z_.SCREEN_TRACK)?x_.Screen:x_.High,Vt=bR(bR({},M4(zt)),{},{codec:this.store.codec});break;case ME.LocalVideoLowTrack:$=x_.Low,Vt=bR(bR({},M4(zt)),{},{codec:this.store.codec})}return{stream_type:$,attributes:Vt,ssrcs:s[g]}})}createGatewayUnpublishMessage(o){return o.map(s=>{var d;let g,[b,{track:$,ssrcs:Vt,id:zt}]=s;switch(b){case ME.LocalVideoTrack:g=KE(d=$._hints).call(d,Z_.SCREEN_TRACK)?x_.Screen:x_.High;break;case ME.LocalAudioTrack:g=x_.Audio;break;case ME.LocalVideoLowTrack:g=x_.Low}return{stream_type:g,ssrcs:Vt,mid:zt}})}assignLocalTracks(o,s){o.forEach((d,g)=>{let{track:b,type:$}=d;this.localTrackMap.set($,{track:b,id:s[g].id,ssrcs:s[g].localSSRC})})}withdrawLocalTracks(o){o.forEach(s=>{let[d]=s;this.localTrackMap.delete(d)})}bindConnectionEvents(o){o.onConnectionStateChange=async s=>{if(_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(s,")")),this.emit(a_.PeerConnectionStateChange,s),s!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),s==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),cE("NEW_ICE_RESTART")){var d;if(KE(d=this._restartStates).call(d,s)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const g=Vt=>{(o.iceConnectionState==="disconnected"||o.iceConnectionState==="checking"||o.iceConnectionState==="failed")&&(_l.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(Vt)),VT(this,a_.QueryClientConnectionState)==="CONNECTED"&&this.emit(a_.RequestRestartICE,Vt))},b=()=>{o.iceConnectionState!=="disconnected"&&o.iceConnectionState!=="checking"&&o.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),_l.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(a_.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},$=cE("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(cE("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&R_().supportPCSetConfiguration)g(hT.RELAY),this._restartTimer=window.setTimeout(b,$);else if(H_())g(hT.UDP),this._restartTimer=window.setTimeout(b,4e3);else{if(g(hT.TCP),R_().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{g(hT.RELAY),this._restartTimer=window.setTimeout(b,$)},$));this._restartTimer=window.setTimeout(b,$)}},800))}}else{if(s==="disconnected"&&o.iceConnectionState==="disconnected")return setTimeout(()=>{o.iceConnectionState==="disconnected"&&cE("ICE_RESTART")&&VT(this,a_.QueryClientConnectionState)==="CONNECTED"&&this.emit(a_.RequestRestartICE)},800),void setTimeout(()=>{o.peerConnectionState==="disconnected"&&(_l.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(a_.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);s==="failed"&&(_l.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(a_.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},o.onICEConnectionStateChange=s=>{s!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(s,")")),t_.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:s,tag:hS.TRACER}).onSuccess(),this.emit(a_.IceConnectionStateChange,s)},o.onICETransportStateChange=s=>{_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(s,")"))},o.onDTLSTransportStateChange=s=>{_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(s,")"))},o.onDTLSTransportError=s=>{_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(s,")"))},o.onFirstAudioDecoded=s=>{var d;const g=Array.from(qT(d=this.remoteUserMap).call(d)).find($=>$._audioSSRC===s);var b;g&&(this.store.subscribe(g.uid,"audio",void 0,void 0,void 0,Date.now()),(b=g.audioTrack)===null||b===void 0||b.emit(lN.FIRST_FRAME_DECODED),t_.firstRemoteFrame(this.store.sessionId,zS.FIRST_AUDIO_DECODE,cS.FIRST_AUDIO_DECODE,{peer:g._uintid,subscribeElapse:aT.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId}))},o.onFirstAudioReceived=s=>{var d;const g=Array.from(qT(d=this.remoteUserMap).call(d)).find(b=>b._audioSSRC===s);g&&t_.firstRemoteFrame(this.store.sessionId,zS.FIRST_AUDIO_RECEIVED,cS.FIRST_AUDIO_RECEIVED,{peer:g._uintid,subscribeElapse:aT.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},o.onFirstVideoDecoded=(s,d,g)=>{this.reportVideoFirstFrameDecoded(s,d,g)},o.onFirstVideoReceived=s=>{var d;const g=Array.from(qT(d=this.remoteUserMap).call(d)).find(b=>b._videoSSRC===s);g&&t_.firstRemoteFrame(this.store.sessionId,zS.FIRST_VIDEO_RECEIVED,cS.FIRST_VIDEO_RECEIVED,{peer:g._uintid,subscribeElapse:aT.measureFromSubscribeStart(this.store.clientId,s),subscribeRequestid:s,p2pid:this.store.p2pId})},o.onSelectedLocalCandidateChanged=(s,d)=>{const g=s.candidateType==="relay",b=d.candidateType==="relay";d.candidateType!=="unknown"&&g===b||this.emit(a_.ConnectionTypeChange,g),_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(cI(d))," -> ").concat(JSON.stringify(cI(s)),")"))},o.onSelectedRemoteCandidateChanged=(s,d)=>{_l.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(cI(d))," -> ").concat(JSON.stringify(cI(s)),")"))},o.onFirstVideoDecodedTimeout=s=>{this.reportVideoFirstFrameDecoded(s,void 0,void 0,!0)},o.getLocalVideoStats=()=>{const s=this.statsCollector.getLocalVideoTrackStats(),d=this.statsCollector.getRTCStats();return bR(bR({},s),d)}}unbindConnectionEvents(o){o.onConnectionStateChange=void 0,o.onICEConnectionStateChange=void 0,o.onICETransportStateChange=void 0,o.onDTLSTransportStateChange=void 0,o.onDTLSTransportError=void 0,o.onFirstAudioDecoded=void 0,o.onFirstAudioReceived=void 0,o.onFirstVideoDecoded=void 0,o.onFirstVideoReceived=void 0,o.onSelectedLocalCandidateChanged=void 0,o.onSelectedRemoteCandidateChanged=void 0,o.onFirstVideoDecodedTimeout=void 0,o.getLocalVideoStats=void 0}filterTobeMutedTracks(o){const s=[];if(this.getAllTracks().indexOf(o)===-1)return s;const d=this.localTrackMap.get(ME.LocalAudioTrack);if(o instanceof mS&&(d==null?void 0:d.track)instanceof jS)return d.track.isActive||s.push([ME.LocalAudioTrack,d]),s;const g=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:$}]=b;return o===$});if(g&&(s.push(g),g[0]===ME.LocalVideoTrack)){const b=this.localTrackMap.get(ME.LocalVideoLowTrack);b&&s.push([ME.LocalVideoLowTrack,b])}return s}filterTobeUnmutedTracks(o){const s=[],d=this.localTrackMap.get(ME.LocalAudioTrack);if(o instanceof mS&&(d==null?void 0:d.track)instanceof jS)return d.track.isActive&&s.push([ME.LocalAudioTrack,d]),s;const g=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:$}]=b;return o===$});if(g)if(g[0]===ME.LocalVideoTrack){s.push(g);const b=this.localTrackMap.get(ME.LocalVideoLowTrack);b&&s.push([ME.LocalVideoLowTrack,b])}else s.push(g);return s}createMuteMessage(o){return o.map(s=>{var d;let g,[b,{track:$,ssrcs:Vt,id:zt}]=s;switch(b){case ME.LocalAudioTrack:g=x_.Audio;break;case ME.LocalVideoTrack:g=KE(d=$._hints).call(d,Z_.SCREEN_TRACK)?x_.Screen:x_.High;break;case ME.LocalVideoLowTrack:g=x_.Low}return{stream_type:g,ssrcs:Vt,mid:zt}})}createUnmuteMessage(o){return o.map(s=>{var d;let g,[b,{track:$,ssrcs:Vt,id:zt}]=s;switch(b){case ME.LocalAudioTrack:g=x_.Audio;break;case ME.LocalVideoTrack:g=KE(d=$._hints).call(d,Z_.SCREEN_TRACK)?x_.Screen:x_.High;break;case ME.LocalVideoLowTrack:g=x_.Low}return{stream_type:g,ssrcs:Vt,mid:zt}})}filterTobeUnSubscribedTracks(o,s){const d=[],g=this.remoteUserMap.get(o);if(!g)return d;if(s){const b=g.get(s);if(!b)return d;d.push([o,{kind:s,id:b}])}else Array.from(g.entries()).forEach(b=>{let[$,Vt]=b;d.push([o,{kind:$,id:Vt}])});return d}filterTobeUnSubscribedDataChannels(o,s){const d=[];return s.forEach(g=>{var b;(b=this.remoteDataChannelMap.get(o))!==null&&b!==void 0&&b.has(g.id)&&d.push(g)}),d}createUnsubscribeMessage(o){const s=[];return o.forEach(d=>{let[g,{kind:b,id:$}]=d;switch(b){case _g.VIDEO:return void(g._videoSSRC&&s.push({stream_type:_g.VIDEO,ssrcId:g._videoSSRC}));case _g.AUDIO:return void(g._audioSSRC&&s.push({stream_type:_g.AUDIO,ssrcId:g._audioSSRC}))}}),s}createUnsubscribeAllMessage(o){const s=new Map;return o.forEach(d=>{let[g,{kind:b}]=d;if(s.has(g)){let $=s.get(g);b===_g.VIDEO?$|=qS.Video:$|=qS.Audio,s.set(g,$)}else b===_g.VIDEO?s.set(g,qS.Video):s.set(g,qS.Audio)}),{users:Array.from(s.entries()).map(d=>{let[g,b]=d;return{stream_id:g.uid,stream_type:b}})}}withdrawRemoteTracks(o){o.forEach(s=>{let[d,{kind:g}]=s;const b=this.remoteUserMap.get(d);b&&(b.delete(g),Array.from(b.entries()).length===0&&this.remoteUserMap.delete(d))})}async updateBitrateLimit(o){const s=this.localTrackMap.get(ME.LocalVideoTrack),d=this.localTrackMap.get(ME.LocalVideoLowTrack);s&&await s.track.setBitrateLimit(o.uplink),d&&o.low_stream_uplink&&await d.track.setBitrateLimit({max_bitrate:o.low_stream_uplink.bitrate,min_bitrate:o.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(o,s){return o.map((d,g)=>{var b;let{stream_type:$}=d;return(b=s.find(Vt=>{let{stream_type:zt}=Vt;return $===zt}))===null||b===void 0?void 0:b.attributes})}async tryToUnmuteAudio(o){for(let d=0;d<o.length;d++)if(o[d]instanceof mS){var s;const g=this.filterTobeUnmutedTracks(o[d]);if(g.length===0)continue;await((s=this.connection)===null||s===void 0?void 0:s.unmuteLocal(g.map($=>{let[,{id:Vt}]=$;return Vt})));const b=this.createUnmuteMessage(g);return void await K_(this,a_.RequestUnmuteLocal,b)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=o=>{var s;return!((s=this.connection)===null||s===void 0||!s.getRemoteVideoIsReady(o))},this.statsUploader.requestUpload=(o,s)=>this.emit(a_.RequestUpload,o,s),this.statsUploader.requestUploadStats=o=>this.emit(a_.RequestUploadStats,o),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await WS(CD(this.dtlsFailedCount,CS)),this.emit(a_.RequestReconnect)}async reconnectP2P(){const o=Array.from(this.localTrackMap.entries()),s=this.createGatewayUnpublishMessage(o);Array.from(this.remoteUserMap.entries()),s.length>0&&await kS(this,a_.RequestUnpublishForReconnectPC,s),this.disconnectForReconnect(),this.emit(a_.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ME.LocalVideoTrack)||this.pendingLocalTracks.some(o=>o instanceof Y_)}throwIfTrackTypeNotMatch(o){if(o.filter(s=>s instanceof Y_).length>1)throw new TE(rE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(o.filter(s=>s instanceof mS).length>1&&(o.some(s=>s instanceof mS&&s._bypassWebAudio)||!R_().webAudioMediaStreamDest))throw new TE(rE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const s of o){if(s instanceof Y_&&this.pendingLocalTracks.some(d=>d instanceof Y_))throw new TE(rE.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(s instanceof mS&&this.pendingLocalTracks.some(d=>d instanceof mS)&&(!R_().webAudioMediaStreamDest||s._bypassWebAudio||this.pendingLocalTracks.some(d=>d instanceof mS&&d._bypassWebAudio)))throw new TE(rE.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(o,s){const d=!cE("DISABLE_DUAL_STREAM_USE_ENCODING")&&R_().supportDualStreamEncoding,g=bR(bR({},{width:160,height:120,framerate:15,bitrate:50}),s);let b;b=d?o._mediaStreamTrack.clone():fG(o,g);const $=z_(8,"track-low-"),Vt=new Y_(b,bR(bR({},d&&{scaleResolutionDownBy:HV(g,o)}),{},{frameRate:g.framerate,bitrateMax:g.bitrate,bitrateMin:g.bitrate}),void 0,void 0,$);return Vt.on(nO.TRANSCEIVER_UPDATED,zt=>{o._updateRtpTransceiver(zt,cN.LOW_STREAM)}),Vt._hints.push(Z_.LOW_STREAM),o.on("sei-to-send",zt=>{Vt.emit("sei-to-send",zt)}),o.addListener(YE.NEED_CLOSE,()=>{Vt.close()}),Vt}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(o,s,d){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof tR){var b,$,Vt,zt;const _e=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:_r,dtlsTransportState:_o,peerConnectionState:ga}=this.connection,{local:_a,remote:_c}=await this.connection.getSelectedCandidatePair();t_.pcStats(this.store.sessionId,{startTime:_e,eventElapse:o-_e||0,iceconnectionsate:_r,dtlsstate:_o,connectionstate:ga,intSucc:s?1:2,error:g,selectedLocalCandidateProtocol:(b=_a==null?void 0:_a.protocol)!==null&&b!==void 0?b:"",selectedLocalCandidateType:($=_a.candidateType)!==null&&$!==void 0?$:"",selectedLocalCandidateAddress:"".concat(_a.address,":").concat(_a.port),selectedRemoteCandidateProtocol:(Vt=_c.protocol)!==null&&Vt!==void 0?Vt:"",selectedRemoteCandidateType:(zt=_c.candidateType)!==null&&zt!==void 0?zt:"",selectedRemoteCandidateAddress:"".concat(_c.address,":").concat(_c.port),restartCnt:d})}}reportVideoFirstFrameDecoded(o,s,d,g){var b;const $=Array.from(qT(b=this.remoteUserMap).call(b)).find(Vt=>Vt._videoSSRC===o);if($){g||this.store.subscribe($.uid,"video",void 0,void 0,void 0,void 0,Date.now());const Vt=this.store.keyMetrics,zt=Vt.subscribe.find(_e=>_e.userId===$.uid&&_e.type==="video");t_.firstRemoteVideoDecode(this.store.sessionId,zS.FIRST_VIDEO_DECODE,cS.FIRST_VIDEO_DECODE,{peer:$._uintid,videowidth:s,videoheight:d,subscribeElapse:aT.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId,apEnd:Vt.requestAPEnd||0,apStart:Vt.requestAPStart||0,joinGwEnd:Vt.joinGatewayEnd||0,joinGwStart:Vt.joinGatewayStart||0,pcEnd:Vt.peerConnectionEnd||0,pcStart:Vt.peerConnectionStart||0,subscriberEnd:(zt==null?void 0:zt.subscribeEnd)||0,subscriberStart:(zt==null?void 0:zt.subscribeStart)||0,videoAddNotify:(zt==null?void 0:zt.streamAdded)||0,state:g?1:0})}}async remoteMediaSsrcChanged(o,s,d){if(!this.connection)return!1;const g=this.remoteUserMap.get(o);if(!g)return!1;const b=g.get(s);if(!b)return!1;const $=await this.connection.getRemoteSSRC(b);return $!==void 0&&$!==d}resetConnection(o){_l.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(o)),this.state===j_.Connected?(_l.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=o===C4.datachannel?new SI({},this.store):this.isPlanB?new _N({},this.store):new tR({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(o=>{let[s,{track:d}]=o;s===ME.LocalVideoLowTrack?d._updateRtpTransceiver(void 0,cN.LOW_STREAM):d._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(o){this.connection&&this.connection instanceof tR&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===DR.TCP_RESTART&&o===hT.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,DR.DISCONNECTED_OR_FAILED)))}},BE(E_.prototype,"startP2PConnection",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"startP2PConnection"),E_.prototype),BE(E_.prototype,"connect",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"connect"),E_.prototype),BE(E_.prototype,"updateRemoteRTPCapabilities",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"updateRemoteRTPCapabilities"),E_.prototype),BE(E_.prototype,"preConnect",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"preConnect"),E_.prototype),BE(E_.prototype,"publishDataChannel",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"publishDataChannel"),E_.prototype),BE(E_.prototype,"unpublish",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"unpublish"),E_.prototype),BE(E_.prototype,"unpublishDataChannel",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"unpublishDataChannel"),E_.prototype),BE(E_.prototype,"unpublishLowStream",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"unpublishLowStream"),E_.prototype),BE(E_.prototype,"subscribeDataChannel",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"subscribeDataChannel"),E_.prototype),BE(E_.prototype,"subscribe",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"subscribe"),E_.prototype),BE(E_.prototype,"massSubscribe",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"massSubscribe"),E_.prototype),BE(E_.prototype,"unsubscribe",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"unsubscribe"),E_.prototype),BE(E_.prototype,"unsubscribeDataChannel",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"unsubscribeDataChannel"),E_.prototype),BE(E_.prototype,"massUnsubscribe",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"massUnsubscribe"),E_.prototype),BE(E_.prototype,"muteRemote",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"muteRemote"),E_.prototype),BE(E_.prototype,"unmuteRemote",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"unmuteRemote"),E_.prototype),BE(E_.prototype,"hasRemoteMediaWithLock",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"hasRemoteMediaWithLock"),E_.prototype),BE(E_.prototype,"disconnectForReconnect",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"disconnectForReconnect"),E_.prototype),BE(E_.prototype,"updateBitrateLimit",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"updateBitrateLimit"),E_.prototype),BE(E_.prototype,"remoteMediaSsrcChanged",[lT],Object.getOwnPropertyDescriptor(E_.prototype,"remoteMediaSsrcChanged"),E_.prototype),E_);function lT(o,s,d){const g=o[s];if(typeof g!="function")throw new Error("Cannot use mutex on object property.");return d.value=async function(){const b=this.mutex,$=await b.lock("From P2PChannel.".concat(s));try{for(var Vt=arguments.length,zt=new Array(Vt),_e=0;_e<Vt;_e++)zt[_e]=arguments[_e];return await g.apply(this,zt)}finally{$()}},d}function vht(o){let s=xJ();return function(d,g){let b=d.appId;b!==void 0&&(F_(g,10),RR(g,b));let $=d.cid;$!==void 0&&(F_(g,16),F_(g,$));let Vt=d.cname;Vt!==void 0&&(F_(g,26),RR(g,Vt));let zt=d.deviceId;zt!==void 0&&(F_(g,34),RR(g,zt));let _e=d.elapse;_e!==void 0&&(F_(g,40),TI(g,_e));let _r=d.fileSize;_r!==void 0&&(F_(g,48),TI(g,yN(_r)));let _o=d.height;_o!==void 0&&(F_(g,56),TI(g,yN(_o)));let ga=d.jpg;ga!==void 0&&(F_(g,66),F_(g,ga.length),function(U0,kE){let VE=SN(U0,kE.length);U0.bytes.set(kE,VE)}(g,ga));let _a=d.networkType;_a!==void 0&&(F_(g,72),TI(g,yN(_a)));let _c=d.osType;_c!==void 0&&(F_(g,80),TI(g,yN(_c)));let tE=d.requestId;tE!==void 0&&(F_(g,90),RR(g,tE));let _p=d.sdkVersion;_p!==void 0&&(F_(g,98),RR(g,_p));let _f=d.sequence;_f!==void 0&&(F_(g,104),TI(g,yN(_f)));let eE=d.sid;eE!==void 0&&(F_(g,114),RR(g,eE));let iE=d.timestamp;iE!==void 0&&(F_(g,120),TI(g,iE));let fE=d.uid;fE!==void 0&&(F_(g,128),F_(g,fE));let mE=d.vid;mE!==void 0&&(F_(g,136),F_(g,mE));let _E=d.width;_E!==void 0&&(F_(g,144),TI(g,yN(_E)));let SE=d.service;SE!==void 0&&(F_(g,152),F_(g,SE));let wE=d.callbackData;wE!==void 0&&(F_(g,162),RR(g,wE));let NE=d.jpgEncryption;NE!==void 0&&(F_(g,168),F_(g,NE));let DE=d.requestType;DE!==void 0&&(F_(g,176),F_(g,DE));let JE=d.scorePorn;JE!==void 0&&(F_(g,185),RG(g,JE));let b_=d.scoreSexy;b_!==void 0&&(F_(g,193),RG(g,b_));let L_=d.scoreNeutral;L_!==void 0&&(F_(g,201),RG(g,L_));let $_=d.scene;$_!==void 0&&(F_(g,208),F_(g,$_));let OS=d.ossFilePrefix;OS!==void 0&&(F_(g,218),RR(g,OS));let lS=d.serviceVendor;if(lS!==void 0)for(let U0 of lS){F_(g,226);let kE=xJ();Tht(U0,kE),F_(g,kE.limit),wht(g,kE),Cht(kE)}}(o,s),function(d){let g=d.bytes,b=d.limit;return g.length===b?g:g.subarray(0,b)}(s)}function yht(o){return function(d){let g={};t:for(;!UJ(d);){let b=CR(d);switch(b>>>3){case 0:break t;case 1:g.code=CR(d);break;case 2:g.msg=jJ(d,CR(d));break;case 3:{let $=bht(d);g.data=Sht(d),d.limit=$;break}default:LJ(d,7&b)}}return g}({bytes:s=o,offset:0,limit:s.length});var s}function Sht(o){let s={};t:for(;!UJ(o);){let d=CR(o);switch(d>>>3){case 0:break t;case 1:s.requestId=jJ(o,CR(o));break;case 2:s.requestType=CR(o)>>>0;break;case 3:s.scorePorn=bG(o);break;case 4:s.scoreSexy=bG(o);break;case 5:s.scoreNeutral=bG(o);break;case 6:s.requestScene=CR(o)>>>0;break;case 7:s.scene=CR(o)>>>0;break;default:LJ(o,7&d)}}return s}function Tht(o,s){let d=o.service;d!==void 0&&(F_(s,8),F_(s,d));let g=o.vendor;g!==void 0&&(F_(s,16),F_(s,g));let b=o.token;b!==void 0&&(F_(s,26),RR(s,b));let $=o.callbackUrl;$!==void 0&&(F_(s,34),RR(s,$))}function bht(o){let s=CR(o),d=o.limit;return o.limit=o.offset+s,d}function LJ(o,s){switch(s){case 0:for(;128&VJ(o););break;case 2:SG(o,CR(o));break;case 5:SG(o,4);break;case 1:SG(o,8);break;default:throw new Error("Unimplemented type: "+s)}}let Rht=new Float32Array(1);new Uint8Array(Rht.buffer);let yG=new Float64Array(1),LT=new Uint8Array(yG.buffer);function yN(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let MJ=[];function xJ(){const o=MJ.pop();return o?(o.offset=o.limit=0,o):{bytes:new Uint8Array(64),offset:0,limit:0}}function Cht(o){MJ.push(o)}function SG(o,s){if(o.offset+s>o.limit)throw new Error("Skip past limit");o.offset+=s}function UJ(o){return o.offset>=o.limit}function SN(o,s){let d=o.bytes,g=o.offset,b=o.limit,$=g+s;if($>d.length){let Vt=new Uint8Array(2*$);Vt.set(d),o.bytes=Vt}return o.offset=$,$>b&&(o.limit=$),g}function TG(o,s){let d=o.offset;if(d+s>o.limit)throw new Error("Read past limit");return o.offset+=s,d}function jJ(o,s){let d=TG(o,s),g=String.fromCharCode,b=o.bytes,$="",Vt="";for(let zt=0;zt<s;zt++){let _e,_r,_o,ga,_a=b[zt+d];128&_a?(224&_a)==192?zt+1>=s?Vt+=$:(_e=b[zt+d+1],(192&_e)!=128?Vt+=$:(ga=(31&_a)<<6|63&_e,ga<128?Vt+=$:(Vt+=g(ga),zt++))):(240&_a)==224?zt+2>=s?Vt+=$:(_e=b[zt+d+1],_r=b[zt+d+2],(49344&(_e|_r<<8))!=32896?Vt+=$:(ga=(15&_a)<<12|(63&_e)<<6|63&_r,ga<2048||ga>=55296&&ga<=57343?Vt+=$:(Vt+=g(ga),zt+=2))):(248&_a)==240?zt+3>=s?Vt+=$:(_e=b[zt+d+1],_r=b[zt+d+2],_o=b[zt+d+3],(12632256&(_e|_r<<8|_o<<16))!=8421504?Vt+=$:(ga=(7&_a)<<18|(63&_e)<<12|(63&_r)<<6|63&_o,ga<65536||ga>1114111?Vt+=$:(ga-=65536,Vt+=g(55296+(ga>>10),56320+(1023&ga)),zt+=3))):Vt+=$:Vt+=g(_a)}return Vt}function RR(o,s){let d=s.length,g=0;for(let Vt=0;Vt<d;Vt++){let zt=s.charCodeAt(Vt);zt>=55296&&zt<=56319&&Vt+1<d&&(zt=(zt<<10)+s.charCodeAt(++Vt)-56613888),g+=zt<128?1:zt<2048?2:zt<65536?3:4}F_(o,g);let b=SN(o,g),$=o.bytes;for(let Vt=0;Vt<d;Vt++){let zt=s.charCodeAt(Vt);zt>=55296&&zt<=56319&&Vt+1<d&&(zt=(zt<<10)+s.charCodeAt(++Vt)-56613888),zt<128?$[b++]=zt:(zt<2048?$[b++]=zt>>6&31|192:(zt<65536?$[b++]=zt>>12&15|224:($[b++]=zt>>18&7|240,$[b++]=zt>>12&63|128),$[b++]=zt>>6&63|128),$[b++]=63&zt|128)}}function wht(o,s){let d=SN(o,s.limit),g=o.bytes,b=s.bytes;for(let $=0,Vt=s.limit;$<Vt;$++)g[$+d]=b[$]}function VJ(o){return o.bytes[TG(o,1)]}function FJ(o,s){let d=SN(o,1);o.bytes[d]=s}function bG(o){let s=TG(o,8),d=o.bytes;return LT[0]=d[s++],LT[1]=d[s++],LT[2]=d[s++],LT[3]=d[s++],LT[4]=d[s++],LT[5]=d[s++],LT[6]=d[s++],LT[7]=d[s++],yG[0]}function RG(o,s){let d=SN(o,8),g=o.bytes;yG[0]=s,g[d++]=LT[0],g[d++]=LT[1],g[d++]=LT[2],g[d++]=LT[3],g[d++]=LT[4],g[d++]=LT[5],g[d++]=LT[6],g[d++]=LT[7]}function CR(o){let s,d=0,g=0;do s=VJ(o),d<32&&(g|=(127&s)<<d),d+=7;while(128&s);return g}function F_(o,s){for(s>>>=0;s>=128;)FJ(o,127&s|128),s>>>=7;FJ(o,s)}function TI(o,s){let d=s.low>>>0,g=(s.low>>>28|s.high<<4)>>>0,b=s.high>>>24,$=b===0?g===0?d<16384?d<128?1:2:d<1<<21?3:4:g<16384?g<128?5:6:g<1<<21?7:8:b<128?9:10,Vt=SN(o,$),zt=o.bytes;switch($){case 10:zt[Vt+9]=b>>>7&1;case 9:zt[Vt+8]=$!==9?128|b:127&b;case 8:zt[Vt+7]=$!==8?g>>>21|128:g>>>21&127;case 7:zt[Vt+6]=$!==7?g>>>14|128:g>>>14&127;case 6:zt[Vt+5]=$!==6?g>>>7|128:g>>>7&127;case 5:zt[Vt+4]=$!==5?128|g:127&g;case 4:zt[Vt+3]=$!==4?d>>>21|128:d>>>21&127;case 3:zt[Vt+2]=$!==3?d>>>14|128:d>>>14&127;case 2:zt[Vt+1]=$!==2?d>>>7|128:d>>>7&127;case 1:zt[Vt]=$!==1?128|d:127&d}}function BJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}const Iht=new Map([["moderation",1],["supervise",2]]);class xL extends nS{get connectionState(){return this._connectionState}set connectionState(s){if(this._connectionState===s)return;const d=this._connectionState;this._connectionState=s,this.emit(JS.CONNECTION_STATE_CHANGE,d,s)}get inspectType(){return this._inspectType}set inspectType(s){var d;this._inspectMode=F0(d=s.map(g=>Iht.get(g)||0)).call(d,(g,b)=>g+b),this._inspectType=s}get quality(){return this._quality}set quality(s){this._quality=s>1?1:s<.1?.1:s,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(s){super(),Qm(this,"name","AgoraRTCVideoContentInspect"),Qm(this,"_connectionState",S0.CONNECTING),Qm(this,"_innerConnectionState",void 0),Qm(this,"sequence",0),Qm(this,"inspectStartTime",void 0),Qm(this,"workerManagerConnection",void 0),Qm(this,"workerConnection",void 0),Qm(this,"workerMessageLengthLimit",void 0),Qm(this,"inspectIntervalMinimum",void 0),Qm(this,"qualityRatio",void 0),Qm(this,"_connectInfo",void 0),Qm(this,"_cancelTokenSource",RT.CancelToken.source()),Qm(this,"_retryConfig",void 0),Qm(this,"wmSequence",0),Qm(this,"inspectInterval",void 0),Qm(this,"inspectTimer",null),Qm(this,"ossFilePrefix",void 0),Qm(this,"extraInfo",void 0),Qm(this,"_inspectType",void 0),Qm(this,"_inspectMode",void 0),Qm(this,"_quality",1),Qm(this,"qualityTimer",null),Qm(this,"_inspectId",void 0),Qm(this,"_needWorkUrlOnly",!1),Qm(this,"inspectImage",()=>{if(this.connectionState!==S0.CONNECTED)throw new EE(rE.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===S0.CONNECTED?this.requestToInspectImage():_l.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=z_(5,"inspect-"),this.workerMessageLengthLimit=cE("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=cE("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=cE("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=s.interval,this.ossFilePrefix=s.ossFilePrefix,this.extraInfo=s.extraInfo,this.inspectType=s.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new lP("worker-manager-"+this._inspectId,CS),this.on(JS.STATE_CHANGE,(d,g)=>{this._innerConnectionState=d,_l.debug("[".concat(this._inspectId,"] Inspect operation :").concat(T0[d]," ").concat(g||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new lP("worker-"+this._inspectId,CS),this.handleWorkerEvents()}async init(s,d){this.emit(JS.STATE_CHANGE,T0.CONNECT_AP),this._connectInfo=s;const g=this._cancelTokenSource.token;return this._retryConfig=d,new GE((b,$)=>{this.on(JS.CONNECTION_STATE_CHANGE,(Vt,zt)=>{zt===S0.CONNECTED&&b()}),this.requestAP(s,g,d).then(Vt=>{this.connectWorkerManager(Vt)}).catch(Vt=>{$(Vt)})})}async requestAP(s,d,g){const b=cE("WEBCS_DOMAIN").map(zt=>"https://".concat(zt,"/api/v1")),$=await function(zt,_e,_r,_o){let{appId:ga,areaCode:_a,cname:_c,sid:tE,token:_p,uid:_f}=_e;YO++;const eE="image_moderation_api",iE={service_name:eE,json_body:JSON.stringify({appId:ga,areaCode:_a,cname:_c,command:"allocateEdge",requestId:YO,seq:YO,sid:tE,token:_p,ts:Date.now(),uid:_f+""})};let fE,mE,_E=zt[0];return W0(async()=>{fE=Date.now();const SE=await z0(_E,{data:iE,cancelToken:_r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(mE=Date.now()-fE,SE.code!==0){const JE=new EE(rE.UNEXPECTED_RESPONSE,"image inspect ap error, code"+SE.code,{retry:!0,responseTime:mE});throw _l.error(JE.toString()),JE}const wE=JSON.parse(SE.json_body);if(wE.code!==200){const JE=new EE(rE.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(wE.code,", reason: ").concat(wE.reason),{code:wE.code,responseTime:mE});throw _l.error(JE.toString()),JE}if(!wE.servers||!Array.isArray(wE.servers)||wE.servers.length===0){const JE=new EE(rE.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:wE.code,responseTime:mE});throw _l.error(JE.toString()),JE}const NE=cE("VIDEO_INSPECT_WORKER_MANAGER_HOST"),DE=cE("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:wE.servers.map(JE=>{let{address:b_,wss:L_}=JE;if(b_&&L_)return"wss://".concat(b_.replace(/\./g,"-"),".").concat(NE,":").concat(DE||L_)}).filter(JE=>!!JE),workerToken:wE.workerToken,vid:wE.vid,responseTime:mE}},(SE,wE)=>(t_.apworkerEvent(tE,{success:!0,sc:200,serviceName:eE,responseDetail:JSON.stringify(SE.addressList),firstSuccess:wE===0,responseTime:mE,serverIp:zt[wE%zt.length]}),!1),(SE,wE)=>(t_.apworkerEvent(tE,{success:!1,sc:SE.data&&SE.data.code||200,serviceName:eE,responseTime:mE,serverIp:zt[wE%zt.length]}),!!(SE.code!==rE.OPERATION_ABORTED&&SE.code!==rE.UNEXPECTED_RESPONSE||SE.data&&SE.data.retry)&&(_E=zt[(wE+1)%zt.length],!0)),_o)}(b,s,d,g);this.emit(JS.STATE_CHANGE,T0.AP_CONNECTED);const{addressList:Vt}=$;return this.wmSequence++,Vt}async connectWorkerManager(s){let d=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=d,this.emit(JS.STATE_CHANGE,T0.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(s,1e4)}async connectWorker(s){await this.workerConnection.init([s])}handleWorkerManagerEvents(){this.workerManagerConnection.on(c_.CONNECTED,async()=>{this.emit(JS.STATE_CHANGE,T0.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.21.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(c_.CLOSED,()=>{this._innerConnectionState<T0.GET_WORKER_MANAGER_RESPONSE&&_l.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(c_.FAILED,()=>{this._innerConnectionState<T0.GET_WORKER_MANAGER_RESPONSE&&_l.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(c_.RECONNECTING,()=>{this._innerConnectionState<T0.GET_WORKER_MANAGER_RESPONSE&&_l.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(c_.ON_MESSAGE,async s=>{this.emit(JS.STATE_CHANGE,T0.GET_WORKER_MANAGER_RESPONSE);const d=this.workerManagerConnection.url;this.workerManagerConnection.close();const g=JSON.parse(s.data);if(g.code!==200)throw _l.error("[".concat(this._inspectId,"] Unexpected code ").concat(g.code," from worker manager")),new EE(rE.UNEXPECTED_RESPONSE,"response code of worker is unexpected",g);if(!(g.serverResponse&&g.serverResponse.portWss&&d))throw _l.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(g))),new EE(rE.UNEXPECTED_RESPONSE,"response content of worker is unexpected",g);{const b=cE("VIDEO_INSPECT_WORKER_PORT")||g.serverResponse.portWss,$=d.replace(/:\d+\/?$/,":".concat(b));this.emit(JS.STATE_CHANGE,T0.CONNECT_WORKER,$),this._needWorkUrlOnly?this.emit(JS.REQUEST_NEW_WORKER_URL,$):await this.connectWorker($)}}),this.workerManagerConnection.on(c_.WILL_RECONNECT,(s,d,g)=>{g(s)}),this.workerManagerConnection.on(c_.REQUEST_NEW_URLS,(s,d)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s).catch(d)})}handleWorkerEvents(){this.workerConnection.on(c_.CONNECTED,async()=>{this.emit(JS.STATE_CHANGE,T0.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=S0.CONNECTED}),this.workerConnection.on(c_.ON_MESSAGE,async s=>{if(s.data instanceof ArrayBuffer){const g=yht(new Uint8Array(s.data));if(cE("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&_l.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(g)),g.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(JS.INSPECT_RESULT,void 0,void 0);if(g.data&&g.data.scorePorn&&g.data.scoreSexy&&g.data.scoreNeutral){var d;const b={porn:g.data.scorePorn,sexy:g.data.scoreSexy,neutral:g.data.scoreNeutral},$=F0(d=Object.keys(b)).call(d,(zt,_e)=>b[zt]>b[_e]?zt:_e,"porn"),Vt=Object.keys(b).find(zt=>zt===$);this.emit(JS.INSPECT_RESULT,Vt)}else this.emit(JS.INSPECT_RESULT,void 0,new EE(rE.UNEXPECTED_RESPONSE,g.code+"","There is an unexpected data on message"))}else this.emit(JS.INSPECT_RESULT,void 0,new EE(rE.UNEXPECTED_RESPONSE,g.code+"",g.msg))}else _l.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(JS.INSPECT_RESULT,void 0,new EE(rE.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(c_.CLOSED,()=>{this.connectionState=S0.CLOSED}),this.workerConnection.on(c_.FAILED,()=>{this.connectionState=S0.CLOSED}),this.workerConnection.on(c_.RECONNECTING,()=>{this.connectionState=this.connectionState===S0.CONNECTED?S0.RECONNECTING:S0.CONNECTING}),this.workerConnection.on(c_.WILL_RECONNECT,(s,d,g)=>{s==="recover"&&g(s),g("tryNext")}),this.workerConnection.on(c_.REQUEST_NEW_URLS,(s,d)=>{this.workerManagerConnection.close(),this.once(JS.REQUEST_NEW_WORKER_URL,g=>{s([g])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(g=>{this.connectWorkerManager(g,!0)}).catch(g=>{d(g)})})}static intToLong(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}async requestToInspectImage(){this.sequence++;const s=VT(this,JS.CLIENT_LOCAL_VIDEO_TRACK),d={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(s){if(!s.isPlaying)return void this.emit(JS.INSPECT_RESULT,void 0,new EE(rE.INVALID_OPERATION,"Only the track being played can be inspected"));const g=await this.generateRequestData(s,d);this.workerConnection.sendMessage(g,!0,!0)}else this.emit(JS.INSPECT_RESULT,void 0,new EE(rE.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(s,d){let{appId:g,cname:b,cid:$,vid:Vt,sid:zt,uid:_e}=d;const _r=Date.now(),_o=await s.getCurrentFrameImage("image/jpeg",this.quality),ga=await GY(_o,g,b),_a=this.sequence+"-"+$+"-"+_e+"-"+_r+"-"+z_(12,""),_c={appId:g,cid:$,cname:b,deviceId:"",elapse:xL.intToLong(Number(_r-this.inspectStartTime)),fileSize:ga.byteLength,jpgEncryption:2,height:_o.height,width:_o.width,jpg:ga,networkType:6,osType:7,requestId:_a,sdkVersion:"4.21.0",sequence:this.sequence,sid:zt,timestamp:xL.intToLong(_r),uid:_e,vid:Vt,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete _c.callbackData,this.ossFilePrefix===void 0&&delete _c.ossFilePrefix;const tE=vht(_c);if(tE.byteLength<this.workerMessageLengthLimit){if(cE("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const _p=function(_f){for(var eE=1;eE<arguments.length;eE++){var iE=arguments[eE]!=null?arguments[eE]:{};eE%2?BJ(Object(iE),!0).forEach(function(fE){Qm(_f,fE,iE[fE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_f,Object.getOwnPropertyDescriptors(iE)):BJ(Object(iE)).forEach(function(fE){Object.defineProperty(_f,fE,Object.getOwnPropertyDescriptor(iE,fE))})}return _f}({},_c);delete _p.jpg,_l.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(_p))}return tE}{const _p=this.quality*this.qualityRatio;return this.quality=_p,await this.generateRequestData(s,{appId:g,cname:b,cid:$,vid:Vt,sid:zt,uid:_e})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=RT.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=S0.CLOSED,this.emit(JS.STATE_CHANGE,T0.CLOSED)}}function Oht(o){let s=function(){const d=kht.pop();return d?(d.offset=d.limit=0,d):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(d,g){let b=d.appId;b!==void 0&&(IS(g,10),bI(g,b));let $=d.cid;$!==void 0&&(IS(g,16),IS(g,$));let Vt=d.cname;Vt!==void 0&&(IS(g,26),bI(g,Vt));let zt=d.deviceId;zt!==void 0&&(IS(g,34),bI(g,zt));let _e=d.elapse;_e!==void 0&&(IS(g,40),RI(g,_e));let _r=d.fileSize;_r!==void 0&&(IS(g,48),RI(g,TN(_r)));let _o=d.height;_o!==void 0&&(IS(g,56),RI(g,TN(_o)));let ga=d.jpg;ga!==void 0&&(IS(g,66),IS(g,ga.length),WJ(g,ga));let _a=d.networkType;_a!==void 0&&(IS(g,72),RI(g,TN(_a)));let _c=d.osType;_c!==void 0&&(IS(g,80),RI(g,TN(_c)));let tE=d.requestId;tE!==void 0&&(IS(g,90),bI(g,tE));let _p=d.sdkVersion;_p!==void 0&&(IS(g,98),bI(g,_p));let _f=d.sequence;_f!==void 0&&(IS(g,104),RI(g,TN(_f)));let eE=d.sid;eE!==void 0&&(IS(g,114),bI(g,eE));let iE=d.timestamp;iE!==void 0&&(IS(g,120),RI(g,iE));let fE=d.uid;fE!==void 0&&(IS(g,128),IS(g,fE));let mE=d.vid;mE!==void 0&&(IS(g,136),IS(g,mE));let _E=d.width;_E!==void 0&&(IS(g,144),RI(g,TN(_E)));let SE=d.service;SE!==void 0&&(IS(g,152),IS(g,SE));let wE=d.callbackData;wE!==void 0&&(IS(g,162),IS(g,wE.length),WJ(g,wE));let NE=d.ticket;NE!==void 0&&(IS(g,170),bI(g,NE));let DE=d.vendorConfigs;DE!==void 0&&(IS(g,178),bI(g,DE))}(o,s),function(d){let g=d.bytes,b=d.limit;return g.length===b?g:g.subarray(0,b)}(s)}function Aht(o){return function(d){let g={};t:for(;!Pht(d);){let b=HP(d);switch(b>>>3){case 0:break t;case 1:g.code=HP(d);break;case 2:g.msg=qJ(d,HP(d));break;case 3:g.requestId=qJ(d,HP(d));break;case 4:g.timestamp=Dht(d,!1);break;default:Nht(d,7&b)}}return g}({bytes:s=o,offset:0,limit:s.length});var s}function Nht(o,s){switch(s){case 0:for(;128&x0(o););break;case 2:CG(o,HP(o));break;case 5:CG(o,4);break;case 1:CG(o,8);break;default:throw new Error("Unimplemented type: "+s)}}function TN(o){return{low:o|=0,high:o>>31,unsigned:o>=0}}let kht=[];function CG(o,s){if(o.offset+s>o.limit)throw new Error("Skip past limit");o.offset+=s}function Pht(o){return o.offset>=o.limit}function UL(o,s){let d=o.bytes,g=o.offset,b=o.limit,$=g+s;if($>d.length){let Vt=new Uint8Array(2*$);Vt.set(d),o.bytes=Vt}return o.offset=$,$>b&&(o.limit=$),g}function GJ(o,s){let d=o.offset;if(d+s>o.limit)throw new Error("Read past limit");return o.offset+=s,d}function WJ(o,s){let d=UL(o,s.length);o.bytes.set(s,d)}function qJ(o,s){let d=GJ(o,s),g=String.fromCharCode,b=o.bytes,$="",Vt="";for(let zt=0;zt<s;zt++){let _e,_r,_o,ga,_a=b[zt+d];128&_a?(224&_a)==192?zt+1>=s?Vt+=$:(_e=b[zt+d+1],(192&_e)!=128?Vt+=$:(ga=(31&_a)<<6|63&_e,ga<128?Vt+=$:(Vt+=g(ga),zt++))):(240&_a)==224?zt+2>=s?Vt+=$:(_e=b[zt+d+1],_r=b[zt+d+2],(49344&(_e|_r<<8))!=32896?Vt+=$:(ga=(15&_a)<<12|(63&_e)<<6|63&_r,ga<2048||ga>=55296&&ga<=57343?Vt+=$:(Vt+=g(ga),zt+=2))):(248&_a)==240?zt+3>=s?Vt+=$:(_e=b[zt+d+1],_r=b[zt+d+2],_o=b[zt+d+3],(12632256&(_e|_r<<8|_o<<16))!=8421504?Vt+=$:(ga=(7&_a)<<18|(63&_e)<<12|(63&_r)<<6|63&_o,ga<65536||ga>1114111?Vt+=$:(ga-=65536,Vt+=g(55296+(ga>>10),56320+(1023&ga)),zt+=3))):Vt+=$:Vt+=g(_a)}return Vt}function bI(o,s){let d=s.length,g=0;for(let Vt=0;Vt<d;Vt++){let zt=s.charCodeAt(Vt);zt>=55296&&zt<=56319&&Vt+1<d&&(zt=(zt<<10)+s.charCodeAt(++Vt)-56613888),g+=zt<128?1:zt<2048?2:zt<65536?3:4}IS(o,g);let b=UL(o,g),$=o.bytes;for(let Vt=0;Vt<d;Vt++){let zt=s.charCodeAt(Vt);zt>=55296&&zt<=56319&&Vt+1<d&&(zt=(zt<<10)+s.charCodeAt(++Vt)-56613888),zt<128?$[b++]=zt:(zt<2048?$[b++]=zt>>6&31|192:(zt<65536?$[b++]=zt>>12&15|224:($[b++]=zt>>18&7|240,$[b++]=zt>>12&63|128),$[b++]=zt>>6&63|128),$[b++]=63&zt|128)}}function x0(o){return o.bytes[GJ(o,1)]}function HJ(o,s){let d=UL(o,1);o.bytes[d]=s}function HP(o){let s,d=0,g=0;do s=x0(o),d<32&&(g|=(127&s)<<d),d+=7;while(128&s);return g}function IS(o,s){for(s>>>=0;s>=128;)HJ(o,127&s|128),s>>>=7;HJ(o,s)}function Dht(o,s){let d,g=0,b=0,$=0;return d=x0(o),g=127&d,128&d&&(d=x0(o),g|=(127&d)<<7,128&d&&(d=x0(o),g|=(127&d)<<14,128&d&&(d=x0(o),g|=(127&d)<<21,128&d&&(d=x0(o),b=127&d,128&d&&(d=x0(o),b|=(127&d)<<7,128&d&&(d=x0(o),b|=(127&d)<<14,128&d&&(d=x0(o),b|=(127&d)<<21,128&d&&(d=x0(o),$=127&d,128&d&&(d=x0(o),$|=(127&d)<<7))))))))),{low:g|b<<28,high:b>>>4|$<<24,unsigned:s}}function RI(o,s){let d=s.low>>>0,g=(s.low>>>28|s.high<<4)>>>0,b=s.high>>>24,$=b===0?g===0?d<16384?d<128?1:2:d<1<<21?3:4:g<16384?g<128?5:6:g<1<<21?7:8:b<128?9:10,Vt=UL(o,$),zt=o.bytes;switch($){case 10:zt[Vt+9]=b>>>7&1;case 9:zt[Vt+8]=$!==9?128|b:127&b;case 8:zt[Vt+7]=$!==8?g>>>21|128:g>>>21&127;case 7:zt[Vt+6]=$!==7?g>>>14|128:g>>>14&127;case 6:zt[Vt+5]=$!==6?g>>>7|128:g>>>7&127;case 5:zt[Vt+4]=$!==5?128|g:127&g;case 4:zt[Vt+3]=$!==4?d>>>21|128:d>>>21&127;case 3:zt[Vt+2]=$!==3?d>>>14|128:d>>>14&127;case 2:zt[Vt+1]=$!==2?d>>>7|128:d>>>7&127;case 1:zt[Vt]=$!==1?128|d:127&d}}const KJ={},zJ={},jL=4294967296,Lht=jL*jL,YJ=Lht/2;XJ(0,!0);const JJ=XJ(0),Mht=KP(0,-2147483648,!1),xht=KP(-1,2147483647,!1);function XJ(o,s){let d,g,b;return s?(b=0<=(o>>>=0)&&o<256)&&(g=zJ[o],g)?g:(d=KP(o,0,!0),b&&(zJ[o]=d),d):(b=-128<=(o|=0)&&o<128)&&(g=KJ[o],g)?g:(d=KP(o,o<0?-1:0,!1),b&&(KJ[o]=d),d)}function KP(o,s,d){return{low:0|o,high:0|s,unsigned:!!d}}function Uht(o,s){if(isNaN(o))return JJ;{if(o<=-YJ)return Mht;if(o+1>=YJ)return xht}return o<0?JJ:KP(o%jL|0,o/jL|0,s)}function QJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}class wG extends nS{get connectionState(){return this._connectionState}set connectionState(s){if(this._connectionState===s)return;const d=this._connectionState;this._connectionState=s,this.emit(H0.CONNECTION_STATE_CHANGE,s,d)}get quality(){return this._quality}set quality(s){this._quality=s>1?1:s<.1?.1:s,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(s){var d;super(),Qm(this,"name","AgoraRTCImageModeration"),Qm(this,"_connectionState",s0.CONNECTING),Qm(this,"_sequence",0),Qm(this,"_moderationStartTime",void 0),Qm(this,"_workerConnection",void 0),Qm(this,"_workerMessageLengthLimit",void 0),Qm(this,"_qualityRatio",void 0),Qm(this,"_connectInfo",void 0),Qm(this,"_cancelTokenSource",RT.CancelToken.source()),Qm(this,"_retryConfig",void 0),Qm(this,"_moderationInterval",void 0),Qm(this,"_moderationTimer",null),Qm(this,"_moderationMode",1),Qm(this,"_quality",1),Qm(this,"_qualityTimer",null),Qm(this,"_ticket",void 0),Qm(this,"_moderationIntervalMinimum",void 0),Qm(this,"_uploadFailedNum",0),Qm(this,"_uploadNum",0),Qm(this,"_uploadTimer",null),Qm(this,"_extraInfo",void 0),Qm(this,"_vendor",""),Qm(this,"_encoder",new TextEncoder),Qm(this,"_moderationId",void 0),Qm(this,"inspectImage",()=>{if(this.connectionState!==s0.CONNECTED)throw new EE(rE.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===s0.CONNECTED?this.requestToInspectImage():_l.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=z_(5,"image-moderation-"),this._workerMessageLengthLimit=cE("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=cE("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(d=s.interval)!==null&&d!==void 0?d:1e3,s.extraInfo&&(this._extraInfo=this._encoder.encode(s.extraInfo)),s.vendor&&(this._vendor=s.vendor),this._qualityRatio=cE("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new lP("worker-"+this._moderationId,CS),this.on(H0.STATE_CHANGE,(g,b)=>{_l.debug("[".concat(this._moderationId,"] Moderation operation :").concat(HO[g]," ").concat(b||""))}),this.handleWorkerEvents()}async init(s,d){this.emit(H0.STATE_CHANGE,HO.CONNECT_AP),this._connectInfo=s;const g=this._cancelTokenSource.token;return this._retryConfig=d,new GE((b,$)=>{this.on(H0.CONNECTION_STATE_CHANGE,(Vt,zt)=>{Vt===s0.CONNECTED&&b()}),this.requestAP(s,g,d).then(Vt=>{this.connectWorker(Vt)}).catch(Vt=>{$(Vt)})})}updateConfig(s){var d;this._moderationInterval=(d=s.interval)!==null&&d!==void 0?d:1e3,s.extraInfo&&(this._extraInfo=this._encoder.encode(s.extraInfo)),s.vendor&&(this._vendor=s.vendor),_l.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(s))),this.connectionState===s0.CONNECTED&&this.inspectImage()}async requestAP(s,d,g){const b=cE("WEBCS_DOMAIN").map(_e=>"https://".concat(_e,"/api/v1")),$=await function(_e,_r,_o,ga){let{appId:_a,areaCode:_c,cname:tE,sid:_p,token:_f,uid:eE}=_r;YO++;const iE="moderation_plugin",fE={service_name:iE,json_body:JSON.stringify({appId:_a,areaCode:_c,cname:tE,command:"allocateEdge",requestId:YO,seq:YO,sid:_p,appToken:_f,ts:Date.now(),uid:eE+""})};let mE,_E,SE=_e[0];return W0(async()=>{mE=Date.now();const wE=await z0(SE,{data:fE,cancelToken:_o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_E=Date.now()-mE,wE.code!==0){const JE=new EE(rE.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+wE.code,{retry:!0,responseTime:_E});throw _l.error(JE.toString()),JE}const NE=JSON.parse(wE.json_body);if(NE.code!==200){const JE=new EE(rE.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(NE.code,", reason: ").concat(NE.reason),{code:NE.code,responseTime:_E});throw _l.error(JE.toString()),JE}if(!NE.servers||!Array.isArray(NE.servers)||NE.servers.length===0){const JE=new EE(rE.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:NE.code,responseTime:_E});throw _l.error(JE.toString()),JE}if(!NE.servers.some(JE=>!!JE.wss)){const JE=new EE(rE.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:NE.code,responseTime:_E});throw _l.error(JE.toString()),JE}const DE=cE("IMAGE_MODERATION_WORKER_HOST");return{addressList:NE.servers.map(JE=>{let{address:b_,wss:L_}=JE;if(b_&&L_)return"wss://".concat(b_.replace(/\./g,"-"),".").concat(DE,":").concat(L_,"/moderation")}).filter(JE=>!!JE),workerToken:NE.workerToken,vid:NE.vid,ticket:NE.appTicket,responseTime:_E}},(wE,NE)=>(t_.apworkerEvent(_p,{success:!0,sc:200,serviceName:iE,responseDetail:JSON.stringify(wE.addressList),firstSuccess:NE===0,responseTime:_E,serverIp:_e[NE%_e.length]}),!1),(wE,NE)=>(t_.apworkerEvent(_p,{success:!1,sc:wE.data&&wE.data.code||200,serviceName:iE,responseTime:_E,serverIp:_e[NE%_e.length]}),!!(wE.code!==rE.OPERATION_ABORTED&&wE.code!==rE.UNEXPECTED_RESPONSE||wE.data&&wE.data.retry)&&(SE=_e[(NE+1)%_e.length],!0)),ga)}(b,s,d,g);this.emit(H0.STATE_CHANGE,HO.AP_CONNECTED);const{addressList:Vt,ticket:zt}=$;return this._ticket=zt,Vt}async connectWorker(s){this.emit(H0.STATE_CHANGE,HO.CONNECT_WORKER),await this._workerConnection.init(s,1e4)}handleWorkerEvents(){this._workerConnection.on(c_.CONNECTED,async()=>{this.emit(H0.STATE_CHANGE,HO.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=s0.CONNECTED}),this._workerConnection.on(c_.CLOSED,()=>{this.connectionState=s0.CLOSED}),this._workerConnection.on(c_.FAILED,()=>{this.connectionState=s0.CLOSED}),this._workerConnection.on(c_.RECONNECTING,()=>{this.connectionState=this.connectionState===s0.CONNECTED?s0.RECONNECTING:s0.CONNECTING}),this._workerConnection.on(c_.ON_MESSAGE,async s=>{if(s.data instanceof ArrayBuffer){const d=Aht(new Uint8Array(s.data));cE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_l.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(d)),this._uploadNum++,d.code===void 0||d.code===0||(this._uploadFailedNum++,_l.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(d.code,", msg is ").concat(d.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{t_.reportApiInvoke(this._connectInfo.sid||null,{name:NS.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,d.code],tag:hS.TRACER}).onError(new EE(rE.IMAGE_MODERATION_UPLOAD_FAILED,d.msg)),this._uploadTimer=null},cE("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else _l.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(c_.WILL_RECONNECT,(s,d,g)=>{s==="recover"&&g(s),g("tryNext")}),this._workerConnection.on(c_.REQUEST_NEW_URLS,(s,d)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(s).catch(d)})}static intToLong(s){return{low:s|=0,high:s>>31,unsigned:s>=0}}async requestToInspectImage(){const s=VT(this,H0.CLIENT_LOCAL_VIDEO_TRACK),d={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(s){if(!s.isPlaying)return void(cE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_l.debug("Only the track being played can be inspected"));this._sequence++;const g=await this.generateRequestData(s,d);this._workerConnection.sendMessage(g,!0,!0)}else cE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&_l.debug("Only the track being published can be inspected")}async generateRequestData(s,d){let{appId:g,cname:b,cid:$,vid:Vt,sid:zt,uid:_e}=d;const _r=Date.now(),_o=await s.getCurrentFrameImage("image/jpeg",this.quality),ga=await GY(_o,g,b),_a=this._sequence+"-"+$+"-"+_e+"-"+_r+"-"+z_(12,""),_c={appId:g,cid:$,cname:b,deviceId:"",elapse:wG.intToLong(Number(_r-this._moderationStartTime)),fileSize:_o.buffer.byteLength,height:_o.height,width:_o.width,jpg:ga,networkType:6,osType:7,requestId:_a,sdkVersion:"4.21.0",sequence:this._sequence,sid:zt,timestamp:Uht(_r),uid:_e,vid:Vt,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete _c.callbackData;const tE=Oht(_c);if(tE.byteLength<this._workerMessageLengthLimit){if(cE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const _p=function(_f){for(var eE=1;eE<arguments.length;eE++){var iE=arguments[eE]!=null?arguments[eE]:{};eE%2?QJ(Object(iE),!0).forEach(function(fE){Qm(_f,fE,iE[fE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_f,Object.getOwnPropertyDescriptors(iE)):QJ(Object(iE)).forEach(function(fE){Object.defineProperty(_f,fE,Object.getOwnPropertyDescriptor(iE,fE))})}return _f}({},_c);delete _p.jpg,_l.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(_p))}return tE}{const _p=this.quality*this._qualityRatio;return this.quality=_p,await this.generateRequestData(s,{appId:g,cname:b,cid:$,vid:Vt,sid:zt,uid:_e})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=RT.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=s0.CLOSED,this.emit(H0.STATE_CHANGE,HO.CLOSED)}}function ZJ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function $J(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?ZJ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):ZJ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}const jht=Date.now(),Vht=20,IG=new Map,VL=new Map;async function tX(o){const s=IG.get(o),d=Array.isArray(s)&&s[s.length-1],g=VL.get(o);if(!d)return void(g.isSyncing=!1);const b={uid:d.uid,payload:d.payload};g.firstRecvTs===0&&(g.firstRecvTs=d.recvTs,g.firstSendTs=d.sendTs);const $=d.sendTs-g.firstSendTs,Vt=$-(Date.now()-g.firstRecvTs);Vt>0&&(g.firstRecvTs=Date.now()-$);let zt=d.mediaDelay+Vt;zt<=0?(s.pop(),eX(d.context,b),zt=0):zt=Math.min(zt,Vht),setTimeout(()=>s.length&&tX(o),zt)}function eX(o,s){o.safeEmit(S_.STREAM_MESSAGE,s.uid,s.payload),o.onStreamMessage&&o.onStreamMessage(s)}function Fht(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,d=arguments.length>2?arguments[2]:void 0;if(!o.syncWithAudio)return eX(d,{uid:o.uid,payload:o.payload});const g="".concat(d.id,"-").concat(o.uid),b=IG.get(g)||[],$=b.findIndex(_r=>o.sendTs>=_r.sendTs),Vt=$J($J({},o),{},{context:d,mediaDelay:s,recvTs:Date.now()});$===-1?b.push(Vt):b.splice($,0,Vt),IG.set(g,b);let zt=!1;var _e;VL.has(g)?zt=!((_e=VL.get(g))===null||_e===void 0||!_e.isSyncing):VL.set(g,{isSyncing:zt,firstRecvTs:0,firstSendTs:0}),zt||tX(g)}const Bht=O_().name;function nX(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function rX(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?nX(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):nX(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}const bN="websdk_ng_cache_parameter",Ght=cE("MAX_PRELOAD_ASYNC_LENGTH"),Wht=1e4,dO=new Map,hO=[];let OG=null,AG=0,NG=0;const FL=new Map,qht=function(o,s){const d=[];let g=0;const b=async()=>{const $=d.shift();$&&await $(),d.length>0&&g<s?b():g--};return async function(){for(var $=arguments.length,Vt=new Array($),zt=0;zt<$;zt++)Vt[zt]=arguments[zt];return new GE(async(_e,_r)=>{d.push(async()=>{try{const _o=await o(...Vt);_e(_o)}catch(_o){_r(_o)}}),g<s&&(g++,b())})}}(iX,Ght),kG=RT.CancelToken.source();async function iX(o,s,d,g,b){try{if(!cE("ENABLE_PRELOAD"))return;if(!R_().supportWebCrypto)return void eI(()=>{_l.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!d&&d!==null)throw new TE(rE.INVALID_PARAMS,"Invalid token: ".concat(d,". If you don not use token, set it to null"));d&&QS(d,"token",1,2047),QS(o,"appid",1,2047),ND(s),g&&PD(g);const $=oP();_l.debug("preload channel ".concat(s,", uid is ").concat(g));const Vt={appId:o,cname:s,token:d||o,uid:typeof g!="string"?g:null,sid:$,proxyServer:b};let zt,_e;typeof g=="string"?(Vt.stringUid=g,[_e,zt]=await GE.all([dut(g,{sid:$,appId:o},kG.token),Q4(rX(rX({},Vt),{},{token:d||o,uid:0}),kG.token)]),Vt.uid=_e.uid,zt.gatewayInfo.uid=Vt.uid,zt.gatewayInfo.res.uid=Vt.uid):zt=await Q4(Vt,kG.token);const _r={sid:$,appId:o,cname:s,token:d||o,uid:Vt.stringUid||g,intUid:Vt.uid||zt.gatewayInfo.uid,stringUid:Vt.stringUid,ts:Date.now(),sua:_e,ap:zt};await async function(_o){let ga;try{_o.uid&&sX({appId:_o.appId,cname:_o.cname,token:_o.token,uid:_o.uid,stringUid:_o.stringUid});const _a=lX(_o),_c=await async function(_p,_f){try{const eE=await window.crypto.subtle.importKey("raw",e4(_f),"AES-GCM",!1,["encrypt"]),iE=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},eE,BI(window.btoa(JSON.stringify(_p))));return nI(new Uint8Array(iE))}catch{return}}(_o,_o.token||_o.appId);if(!_c)return;ga=uX(bN);const tE=ga?JSON.parse(ga):[];tE.push({[_a]:_c}),tE.length>cE("AP_CACHE_NUM")&&tE.shift(),BL(bN,JSON.stringify(tE))}catch(_a){_l.warn("Error caching server parameters:",_a.message),BL(bN,"")}}(_r),AG++}catch($){throw NG++,function(Vt){OG||(OG=window.setTimeout(()=>{let _e="";FL.forEach((_r,_o)=>{_e+="".concat(_o,": ").concat(_r," ;")}),t_.reportApiInvoke(null,{name:NS.PRELOAD,options:{success:AG,failed:NG,err:_e}}).onError(Vt),AG=0,NG=0,FL.clear(),OG=null},Wht));const zt=FL.get(Vt.code)||0;FL.set(Vt.code,zt+1)}($),$}}async function oX(o){try{const s=sX(o);if(!s||o.cloudProxyServer!=="disabled")return;const d=await async function(g,b){try{const $=await window.crypto.subtle.importKey("raw",e4(b),"AES-GCM",!1,["decrypt"]),Vt=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},$,BI(g));return JSON.parse(window.atob(nI(new Uint8Array(Vt))))}catch{return}}(s,o.token||o.appId);if(!d||!function(g,b){return g.cname===b.cname&&g.appId===b.appId&&g.token===b.token?b.stringUid?g.stringUid===b.stringUid:typeof b.uid=="number"?g.uid===b.uid:g.uid==b.uid:!1}(d,o))return;if(d&&Date.now()-d.ts<cE("AP_CACHE_LIFETIME"))return d}catch(s){_l.warn("Error get preloadInfo",s.message)}}function sX(o){let s;try{if(s=uX(bN),!s)return;const d=JSON.parse(s),g=lX(o),b=function(Vt,zt){for(let _e=Vt.length-1;_e>=0;_e--)if(zt(Vt[_e]))return _e;return-1}(d,Vt=>g in Vt);if(b===-1)return;const $=d.splice(b,1)[0];return BL(bN,JSON.stringify(d)),$[g]}catch(d){_l.warn("Error delete preload info: ".concat(s),d.message),BL(bN,"")}}function PG(o){if(o){let s=dO.get(o);s&&(window.clearTimeout(s),s=null,dO.delete(o)),KE(hO).call(hO,o)||o.cloudProxyServer!=="disabled"||hO.push(o)}if(dO.size<cE("AP_CACHE_NUM")&&hO.length>0){const s=hO.shift();dO.set(s,window.setTimeout(async()=>{const{appId:d,cname:g,token:b,uid:$,proxyServer:Vt}=s;try{await qht(d,g,b,$,Vt),dO.has(s)&&PG(s)}catch(zt){_l.warn("update preload failed",zt.message),aX(s)}},cE("AP_UPDATE_INTERVAL")))}}function aX(o){const s=hO.indexOf(o);s!==-1&&hO.splice(s,1);let d=dO.get(o);d&&(window.clearTimeout(d),d=null,dO.delete(o),PG())}function cX(o,s){const d=o.sua,g=o.ap;s&&d&&t_.reqUserAccount(o.sid,{lts:d.requestTime,elapse:d.elapse,success:!0,serverAddr:d.url,stringUid:s,uid:o.intUid,errorCode:null,extend:d.req}),t_.reportResourceTiming(o.ap.url,o.sid),t_.joinWebProxyAP(o.sid,{lts:g.requestTime,elapse:g.elapse,sucess:1,apServerAddr:g.url,turnServerAddrList:g.proxyInfo.addresses.map(b=>b.ip).join(","),eventType:"disabled",unilbsServerIds:[wS.CHOOSE_SERVER,wS.CLOUD_PROXY_FALLBACK].toString()}),t_.joinChooseServer(o.sid,{lts:g.requestTime,elapse:g.elapse,succ:!0,csAddr:g.url,opid:g.opid,serverList:g.gatewayInfo.gatewayAddrs.map(b=>b.address),ec:null,cid:g.gatewayInfo.cid.toString(),uid:g.gatewayInfo.uid.toString(),csIp:g.gatewayInfo.csIp,unilbsServerIds:[wS.CHOOSE_SERVER].toString(),isHttp3:g.isHttp3})}function uX(o){return window.atob(window.localStorage.getItem(o)||"")}function BL(o,s){window.localStorage.setItem(o,window.btoa(s))}function lX(o){let s="".concat(o.appId,"_").concat(o.cname);return typeof o.uid=="string"&&(s+="_s_".concat(o.uid)),typeof o.uid=="number"&&(s+="_".concat(o.uid)),o.token&&(s+="_".concat(o.token)),c4(s)}var dX,hX,pX,fX,mX,EX,gX,_X,vX,yX,SX,TX,bX,RX,CX,wX,IX,OX,AX,NX,kX,PX,DX,LX,MX,xX,UX,jX,VX,FX,BX,GX,WX,qX,HX,KX,zX,YX,JX,XX,QX,ZX,zE;function $X(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function h0(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?$X(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):$X(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}KS.setLogger(_l);let Hht=(dX=s_(),hX=s_({argsMap:(o,s)=>{if(!Array.isArray(s)){if(!(s instanceof dN))return[s];s=[s]}return s.map(d=>d?Object(d).toString():"null")}}),pX=s_({argsMap:(o,s)=>(s||(s=[]),s instanceof T9?[s.getChannelId()]:(Array.isArray(s)||(s=[s]),s.map(d=>d.getTrackId())))}),fX=s_({argsMap:(o,s,d,g)=>[typeof s=="object"?s.uid:s,d,g]}),mX=s_({argsMap:(o,s,d)=>[s,d]}),EX=s_({argsMap:(o,s)=>s.map(d=>{let{user:g,mediaType:b}=d;return[g==null?void 0:g.uid,b]})}),gX=s_({argsMap:(o,s,d,g)=>[typeof s=="object"?s.uid:s,d,g]}),_X=s_({argsMap:(o,s)=>s.map(d=>{let{user:g,mediaType:b}=d;return{uid:g==null?void 0:g.uid,mediaType:b}})}),vX=s_(),yX=s_(),SX=s_(),TX=s_(),bX=s_(),RX=s_(),CX=s_(),wX=s_(),IX=s_(),OX=s_(),AX=s_(),NX=s_(),kX=s_(),PX=s_(),DX=s_({argsMap:(o,s)=>[s]}),LX=s_(),MX=s_(),xX=s_(),UX=s_(),jX=s_(),VX=s_(),FX=s_(),BX=s_(),GX=s_(),WX=s_(),qX=s_({argsMap:(o,s)=>(Array.isArray(s)||(s=[s]),[JSON.stringify(s)])}),HX=s_(),KX=s_(),zX=s_(),YX=s_(),JX=s_(),XX=s_(),QX=s_({reportResult:!0}),ZX=s_(),zE=class extends nS{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var o;return((o=this._config)===null||o===void 0?void 0:o.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(o){let s;if(super(),Qm(this,"store",void 0),Qm(this,"_uid",void 0),Qm(this,"_channelName",void 0),Qm(this,"_uintUid",void 0),Qm(this,"_users",[]),Qm(this,"_config",void 0),Qm(this,"_clientId",void 0),Qm(this,"_appId",void 0),Qm(this,"_sessionId",null),Qm(this,"_key",void 0),Qm(this,"_rtmConfig",{}),Qm(this,"_joinInfo",void 0),Qm(this,"_gateway",void 0),Qm(this,"_statsCollector",void 0),Qm(this,"_configDistribute",void 0),Qm(this,"_leaveMutex",new KS("client-leave")),Qm(this,"_publishMutex",new KS("client-publish")),Qm(this,"_renewTokenMutex",new KS("client-renewtoken")),Qm(this,"_subscribeMutex",new KS("client-subscribe")),Qm(this,"_encryptionMode","none"),Qm(this,"_encryptionSecret",null),Qm(this,"_encryptionSalt",null),Qm(this,"_encryptDataStream",!1),Qm(this,"_encryptDataStreamKey",null),Qm(this,"_encryptDataStreamIv",null),Qm(this,"_proxyServer",void 0),Qm(this,"_turnServer",{servers:[],mode:"auto"}),Qm(this,"_cloudProxyServerMode","disabled"),Qm(this,"_isDualStreamEnabled",!1),Qm(this,"_defaultStreamFallbackType",void 0),Qm(this,"_lowStreamParameter",void 0),Qm(this,"_streamFallbackTypeCacheMap",new Map),Qm(this,"_remoteStreamTypeCacheMap",new Map),Qm(this,"_axiosCancelSource",RT.CancelToken.source()),Qm(this,"_audioVolumeIndicationInterval",void 0),Qm(this,"_networkQualityInterval",void 0),Qm(this,"_userOfflineTimeout",void 0),Qm(this,"_streamRemovedTimeout",void 0),Qm(this,"_injectStreamingClient",void 0),Qm(this,"_liveTranscodeStreamingClient",void 0),Qm(this,"_liveRawStreamingClient",void 0),Qm(this,"_channelMediaRelayClient",void 0),Qm(this,"_networkQualitySensitivity","normal"),Qm(this,"_p2pChannel",void 0),Qm(this,"_useLocalAccessPoint",!1),Qm(this,"_setLocalAPVersion",void 0),Qm(this,"_joinAndNotLeaveYet",!1),Qm(this,"_numberOfJoinCount",0),Qm(this,"_remoteDefaultVideoStreamType",void 0),Qm(this,"_inspect",void 0),Qm(this,"_moderation",void 0),Qm(this,"_license",void 0),Qm(this,"_pendingPublishedUsers",[]),Qm(this,"ntpAlignErrorCount",0),Qm(this,"remoteInboundOffset",0),Qm(this,"_handleLocalTrackEnable",(d,g,b)=>{this.publish(d,!1).then(g).catch(b)}),Qm(this,"_handleLocalTrackDisable",(d,g,b)=>{this.unpublish(d).then(g).catch(b)}),Qm(this,"_handleUserOnline",d=>{if(cE("BLOCK_LOCAL_CLIENT")&&WI(d.uid,this.channelName))return void _l.debug("[".concat(d.uid,"] will be ignored in local"));this.isStringUID&&typeof d.uid!="string"&&_l.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const g=this._users.find(b=>b.uid===d.uid);if(g)g._trust_in_room_=!0,g._is_pre_created&&(g._is_pre_created=!1,this.safeEmit(S_.USER_JOINED,g));else{const b=new _I(d.uid,d.uint_id||d.uid);this._users.push(b),_l.debug("[".concat(this._clientId,"] user online"),d.uid),this.safeEmit(S_.USER_JOINED,b)}}),Qm(this,"_handleUserOffline",d=>{if(cE("BLOCK_LOCAL_CLIENT")&&WI(d.uid,this.channelName))return;const g=this._users.find(b=>b.uid===d.uid);g&&(this._handleRemoveStream(d),this._handleRemoveDataChannels(d),g._audio_pre_subscribed||g._video_pre_subscribed?g._is_pre_created=!0:yD(this._users,g),this._remoteStreamTypeCacheMap.delete(g.uid),this._streamFallbackTypeCacheMap.delete(g.uid),_l.debug("[".concat(this._clientId,"] user offline"),d.uid,"reason:",d.reason),this.safeEmit(S_.USER_LEAVED,g,d.reason))}),Qm(this,"_handleAddAudioOrVideoStream",(d,g,b,$,Vt,zt,_e)=>{if(cE("BLOCK_LOCAL_CLIENT")&&WI(g,this.channelName))return;const _r=this._users.find(ga=>ga.uid===g);if(!_r)return void _l.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));_l.debug("[".concat(this._clientId,"] stream added with uid ").concat(g,", type ").concat(d)),this.store.subscribe(_r.uid,d,void 0,void 0,void 0,Date.now());const _o=d==="audio"?_r.hasAudio:_r.hasVideo;_r._uintid||(_r._uintid=Vt||g),d==="audio"?_r._trust_audio_stream_added_state_=!0:_r._trust_video_stream_added_state_=!0,d==="audio"?(_r._audio_added_=!0,b!==void 0&&(_r._audioSSRC=b),$!==void 0&&(_r._cname=$),zt&&(_r._audioOrtc=zt)):(_r._video_added_=!0,b!==void 0&&(_r._videoSSRC=b),$!==void 0&&(_r._cname=$),_e!==void 0&&(_r._rtxSsrcId=_e),zt&&(_r._videoOrtc=zt)),(d==="audio"?_r.hasAudio:_r.hasVideo)&&!_o&&(_l.info("[".concat(this._clientId,"] remote user ").concat(_r.uid," published ").concat(d)),this.safeEmit(S_.USER_PUBLISHED,_r,d)),d==="video"?t_.onGatewayStream(this._sessionId,zS.ON_ADD_VIDEO_STREAM,cS.ON_ADD_VIDEO_STREAM,{peer:Vt||g,ssrc:_r._videoSSRC}):t_.onGatewayStream(this._sessionId,zS.ON_ADD_AUDIO_STREAM,cS.ON_ADD_AUDIO_STREAM,{peer:Vt||g,ssrc:_r._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(_r,d,b).then(ga=>{if(ga&&(_l.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(_r.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof ML))return this._p2pChannel.unsubscribe(_r,d,!0).then(()=>this._subscribe(_r,d,!0).catch(_a=>{_l.error("[".concat(this._clientId,"] resubscribe error"),_a.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(_r,d)&&(_l.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(_r.uid," after reconnect.")),this._subscribe(_r,d,!0).catch(ga=>{_l.error("[".concat(this._clientId,"] resubscribe error"),ga.toString())}))}),Qm(this,"_handleRemoveStream",d=>{if(cE("BLOCK_LOCAL_CLIENT")&&WI(d.uid,this.channelName))return;const g=this._users.find($=>$.uid===d.uid);if(!g)return void _l.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));_l.debug("[".concat(this._clientId,"] stream removed with uid ").concat(d.uid));let b=()=>{};g.hasAudio&&g.hasVideo?b=()=>{_l.info("[".concat(this._clientId,"] remote user ").concat(g.uid," unpublished audio track")),this.safeEmit(S_.USER_UNPUBLISHED,g,"audio"),_l.info("[".concat(this._clientId,"] remote user ").concat(g.uid," unpublished video track")),this.safeEmit(S_.USER_UNPUBLISHED,g,"video")}:g.hasVideo?b=()=>{_l.info("[".concat(this._clientId,"] remote user ").concat(g.uid," unpublished video track")),this.safeEmit(S_.USER_UNPUBLISHED,g,"video")}:g.hasAudio&&(b=()=>{_l.info("[".concat(this._clientId,"] remote user ").concat(g.uid," unpublished audio track")),this.safeEmit(S_.USER_UNPUBLISHED,g,"audio")}),g._video_pre_subscribed||g._audio_pre_subscribed||(g._trust_audio_stream_added_state_=!0,g._trust_video_stream_added_state_=!0,g._audio_added_=!1,g._video_added_=!1,this._p2pChannel instanceof ML&&this._p2pChannel.unsubscribe(g).then($=>{if($)return this._gateway.unsubscribe($,g.uid)}),g._audioSSRC=void 0,g._videoSSRC=void 0,g._audioOrtc=void 0,g._videoOrtc=void 0,g._rtxSsrcId=void 0),t_.onGatewayStream(this._sessionId,zS.ON_REMOVE_STREAM,cS.ON_REMOVE_STREAM,{peer:d.uint_id||d.uid}),b()}),Qm(this,"_handleSetStreamLocalEnable",(d,g,b)=>{if(cE("BLOCK_LOCAL_CLIENT")&&WI(g,this.channelName))return;const $=this._users.find(_e=>_e.uid===g);if(!$)return void _l.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));_l.debug("[".concat(this._clientId,"] local ").concat(d," ").concat(b?"enabled":"disabled"," with uid ").concat(g));const Vt=d==="audio"?$.hasAudio:$.hasVideo;if(d==="audio"){$._trust_audio_enabled_state_=!0;const _e=$._audio_enabled_;if($._audio_enabled_=b,$._audio_enabled_===_e)return;{const _r=$._audio_enabled_?"enable-local-audio":"disable-local-audio";_l.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(g,", msg: ").concat(_r)),this.safeEmit(S_.USER_INFO_UPDATED,g,_r)}}else{$._trust_video_enabled_state_=!0;const _e=$._video_enabled_;if($._video_enabled_=b,$._video_enabled_===_e)return;{const _r=$._video_enabled_?"enable-local-video":"disable-local-video";_l.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(g,", msg: ").concat(_r)),this.safeEmit(S_.USER_INFO_UPDATED,g,_r)}}const zt=d==="audio"?$.hasAudio:$.hasVideo;return Vt!==zt?!Vt&&zt?(_l.info("[".concat(this._clientId,"] remote user ").concat(g," published ").concat(d)),void this.safeEmit(S_.USER_PUBLISHED,$,d)):(d==="video"&&$._videoTrack&&$._videoTrack._destroy(),d==="audio"&&$._audioTrack,this._p2pChannel.muteRemote($,d),_l.info("[".concat(this._clientId,"] remote user ").concat(g," unpublished ").concat(d)),void this.safeEmit(S_.USER_UNPUBLISHED,$,d)):void 0}),Qm(this,"_handleMuteStream",(d,g,b)=>{if(cE("BLOCK_LOCAL_CLIENT")&&WI(d,this.channelName))return;_l.debug("[".concat(this._clientId,"] receive mute message"),d,g,b);const $=this._users.find(_e=>_e.uid===d);if(!$)return void _l.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(d));const Vt=g==="audio"?$.hasAudio:$.hasVideo;if(g==="audio"){$._trust_audio_mute_state_=!0;const _e=$._audio_muted_;if($._audio_muted_=b,$._audio_muted_===_e)return;{const _r=$._audio_muted_?"mute-audio":"unmute-audio";_l.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(_r)),this.safeEmit(S_.USER_INFO_UPDATED,d,_r)}}else{$._trust_video_mute_state_=!0;const _e=$._video_muted_;if($._video_muted_=b,$._video_muted_===_e)return;{const _r=$._video_muted_?"mute-video":"unmute-video";_l.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(_r)),this.safeEmit(S_.USER_INFO_UPDATED,d,_r)}}const zt=g==="audio"?$.hasAudio:$.hasVideo;if(Vt!==zt){if(!Vt&&zt)return(g==="audio"?$._audioSSRC:$._videoSSRC)?(_l.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(g)),void this.safeEmit(S_.USER_PUBLISHED,$,g)):void _l.warning("[".concat(this._clientId,"] remote user ").concat(d," receive ").concat(g," unmute message  before add stream message, ").concat(g," SSRC doesn't exist yet."));g==="video"&&$._videoTrack&&!$._video_pre_subscribed&&$._videoTrack._destroy(),g==="audio"&&$._audioTrack,this._p2pChannel.muteRemote($,g),_l.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(g)),this.safeEmit(S_.USER_UNPUBLISHED,$,g)}}),Qm(this,"_handleP2PLost",async d=>{_l.debug("[".concat(this._clientId,"] receive p2p lost"),d),parseInt(d.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():_l.warning("[".concat(this._clientId,"] P2PLost stream not found"),d)}),Qm(this,"_handleTokenWillExpire",()=>{_l.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(S_.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Qm(this,"_handleBeforeUnload",d=>{d.type==="beforeunload"&&d.returnValue!==void 0&&d.returnValue!==""||(this.leave(),_l.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Qm(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(S_.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const d={downlinkNetworkQuality:0,uplinkNetworkQuality:0};d.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),d.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(S_.NETWORK_QUALITY,d)}),Qm(this,"_handleP2PAddAudioOrVideoStream",(d,g,b,$)=>{const Vt=this._users.find(_e=>_e.uid===g);if(!Vt)return void _l.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));_l.debug("[".concat(this._clientId,"] stream added with uid ").concat(g,", type ").concat(d)),this.store.subscribe(Vt.uid,d,void 0,void 0,void 0,Date.now());const zt=d==="audio"?Vt.hasAudio:Vt.hasVideo;d==="audio"?Vt._trust_audio_stream_added_state_=!0:Vt._trust_video_stream_added_state_=!0,d==="audio"?(Vt._audio_added_=!0,b!==void 0&&(Vt._audioSSRC=b),$!==void 0&&(Vt._audioMid=$)):(Vt._video_added_=!0,b!==void 0&&(Vt._videoSSRC=b),$!==void 0&&(Vt._videoMid=$)),(d==="audio"?Vt.hasAudio:Vt.hasVideo)&&!zt&&(_l.info("[".concat(this._clientId,"] remote user ").concat(Vt.uid," published ").concat(d)),this.safeEmit(S_.USER_PUBLISHED,Vt,d)),this._p2pChannel.hasPendingRemoteMedia(Vt,d)&&(_l.debug("[".concat(this._clientId,"] resubscribe ").concat(d," for user ").concat(Vt.uid," after reconnect.")),this._subscribe(Vt,d,!0).catch(_e=>{_l.error("[".concat(this._clientId,"] resubscribe error"),_e.toString())}))}),this._config=o,this._clientId=z_(5,"client-"),this.store=new Jat(o.codec,o.audioCodec,o.mode,this._clientId),this.store.clientCreated(),o.proxyServer&&this.setProxyServer(o.proxyServer,!0),o.turnServer&&this.setTurnServer(o.turnServer,!0),_l.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(i0," build: ").concat(PV,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),o.clientRoleOptions)try{$8(o.clientRoleOptions),s=Object.assign({},o.clientRoleOptions)}catch(d){_l.warning("[".concat(this._clientId,"] ").concat(d.toString()))}this._statsCollector=new GP(this.store),this._statsCollector.onStatsException=(d,g,b)=>{_l.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(d,", msg: ").concat(g,", uid: ").concat(b)),this.safeEmit(S_.EXCEPTION,{code:d,msg:g,uid:b})},this._statsCollector.onUploadPublishDuration=(d,g,b,$)=>{const Vt=this._users.find(zt=>zt.uid===d);Vt&&t_.peerPublishStatus(this._sessionId,{subscribeElapse:$,audioPublishDuration:g,videoPublishDuration:b,peer:Vt._uintid})},this.store.useDataChannel=R_().supportDataChannel&&cE("SIGNAL_CHANNEL"),this.store.useP2P=o.mode==="p2p",this._gateway=new out(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:o.websocketRetryConfig||CS,httpRetryConfig:o.httpRetryConfig||CS,forceWaitGatewayResponse:o.forceWaitGatewayResponse===void 0||o.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:o.role,clientRoleOptions:s}),this._configDistribute=new mut,this.store.useP2P?(this._p2pChannel=new GT(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new ML(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(o,s,d,g,b){let $=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],Vt=arguments.length>6&&arguments[6]!==void 0&&arguments[6];q_("JOIN_GATEWAY_USE_443PORT_ONLY",$),q_("JOIN_GATEWAY_USE_DUAL_DOMAIN",Vt);const zt=this._gateway.signal.websocket;return zt instanceof uP&&(zt.use443PortOnly=$,zt.tryDoubleDomain=Vt),async function(_e,_r,_o){sD.get(_e)||sD.set(_e,[]),uD.get(_e)||uD.set(_e,_r),lR.get(_e)||lR.set(_e,0);const ga=sD.get(_e),_a=uD.get(_e);if(!ga||!_a)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(lR.get(_e)===_a){const eE=eP();ga.push(eE),await eE.promise}lR.set(_e,lR.get(_e)+1);for(var _c=arguments.length,tE=new Array(_c>3?_c-3:0),_p=3;_p<_c;_p++)tE[_p-3]=arguments[_p];const _f=await _o(...tE);return lR.set(_e,lR.get(_e)-1),lR.get(_e)===_a-1&&ga.length>0&&(ga[0].resolve(),ga.shift()),lR.get(_e)===0&&(sD.set(_e,[]),uD.set(_e,0),lR.set(_e,0)),_f}("client.join",cE("JOIN_MAX_CONCURRENCY"),this.join.bind(this),o,s,d,g,b)}async join(o,s,d,g,b){const $=++this._numberOfJoinCount;this.store.joinStart(),g&&(this.store.uid=g);const Vt=(wD||wD||(wD=(window.location.protocol.split(":")[0]||"").toUpperCase(),wD))==="HTTPS",zt=u4()?window.isSecureContext:"Browser Not Support";(!u4()&&!Vt||!window.isSecureContext)&&_l.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),_l.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),t_.setAppId(o);try{if(!d&&d!==null)throw new EE(rE.INVALID_PARAMS,"Invalid token: ".concat(d,". If you don not use token, set it to null"));d&&QS(d,"token",1,2047),QS(o,"appid",1,2047),ND(s),g&&PD(g),b&&QS(b,"optionalInfo",1,2047)}catch(_p){throw t_.reportApiInvoke(oP(),{name:NS.JOIN,options:[o,s,d,g],states:{isHttps:Vt,isSecureContext:zt},tag:hS.TRACER}).onError(_p),_p}const _e=await oX({appId:o,cname:s,uid:g,stringUid:typeof g=="string"?g:void 0,token:d||o,cloudProxyServer:this._cloudProxyServerMode}),_r=(_e==null?void 0:_e.sid)||oP(),_o=t_.reportApiInvoke(_r,{name:NS.JOIN,options:[o,s,d,g],states:{isHttps:Vt,isSecureContext:zt},tag:hS.TRACER});if(_l.info("[".concat(this._clientId,"] start join channel ").concat(s,", join number: ").concat($)),this._leaveMutex.isLocked&&(_l.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),_l.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const _p=new EE(rE.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw _o.onError(_p),_p}this._sessionId||(this._sessionId=_r,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const ga=h0(h0({},this._rtmConfig),{},{clientId:this._clientId,appId:o,sid:this._sessionId,cname:s,uid:typeof g!="string"?g:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:d||o,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:b,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_e},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(ga.setLocalAPVersion=this._setLocalAPVersion),typeof g=="string"&&(ga.stringUid=g,this._uintUid?(ga.uid=this._uintUid,this._uintUid=void 0):ga.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(ga.aesmode=this._encryptionMode,ga.aespassword=await(async _p=>{const _f=function(mE){const _E=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),SE=new Uint8Array(new ArrayBuffer(_E.length));for(let wE=0;wE<_E.length;wE+=1)SE[wE]=_E.charCodeAt(wE);return SE}(),eE=await window.crypto.subtle.importKey("spki",_f,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),iE=bV(_p),fE=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},eE,iE);return function(mE){let _E="";for(let SE=0;SE<mE.length;SE+=1)_E+=String.fromCharCode(mE[SE]);return window.btoa(_E)}(new Uint8Array(fE))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new EE(rE.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(ga.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const _p=new TextEncoder,_f=cE("USE_PURE_ENCRYPTION_MASTER_KEY")?_p.encode(ga.appId+this._encryptionSecret+this._encryptionSecret):_p.encode(ga.appId+ga.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(eE,iE,fE){const mE=await window.crypto.subtle.importKey("raw",iE,"PBKDF2",!1,["deriveBits","deriveKey"]),_E=eE==="aes-128-gcm2"?128:256,SE=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:d4,hash:"SHA-256",salt:fE},mE,_E+Xat);return new Uint8Array(SE).subarray(_E/8)}(this._encryptionMode,_f,BI(this._encryptionSalt)),this._encryptDataStreamKey=await async function(eE,iE,fE){const mE=await window.crypto.subtle.importKey("raw",iE,"PBKDF2",!1,["deriveBits","deriveKey"]),_E=eE==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:d4,hash:"SHA-256",salt:fE},mE,{name:"AES-GCM",length:_E},!0,["encrypt","decrypt"])}(this._encryptionMode,_f,BI(this._encryptionSalt))}else zt?_l.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):_l.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,_l.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:s,appId:o,stringUid:ga.stringUid,preload:ga.preload});const _a=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&_a===this._sessionId&&t_.joinChannelTimeout(this._sessionId,5)},5e3);try{var _c;let _p;const _f=ga.cloudProxyServer;if(KE(_c=["proxy3","proxy4","proxy5"]).call(_c,_f)){const _E=cE("PROXY_SERVER_TYPE3");Array.isArray(_E)?ga.proxyServer=_E[0]:ga.proxyServer=_E}if(t_.setProxyServer(ga.proxyServer),_l.setProxyServer(ga.proxyServer),this.store.requestAPStart(),_e){if(_l.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(ga.stringUid?", ".concat(ga.stringUid," => ").concat(_e.intUid):""," ")),ga.stringUid&&!ga.uid&&(ga.uid=_e.intUid),_p={gatewayInfo:_e.ap.gatewayInfo},cE("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&ga.turnServer.mode==="auto")if(_e.ap.proxyInfo.addresses.length===0)_l.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const _E=(await U4(_e.ap.proxyInfo,_e.ap.gatewayInfo.uid)).map(SE=>({turnServerURL:SE.address,tcpport:SE.tcpport||eT.tcpport,udpport:SE.udpport||eT.udpport,username:SE.username||eT.username,password:SE.password||eT.password,forceturn:!1,security:!0}));ga.turnServer={mode:"manual",servers:_E}}cX(_e,ga.stringUid)}else{if(ga.stringUid&&!ga.uid){let _E;[_E,_p]=await GE.all([X4(ga.stringUid,ga,this._axiosCancelSource.token,this._config.httpRetryConfig||CS,this.store),J4(ga,this._axiosCancelSource.token,this._config.httpRetryConfig||CS,!0,this.store)]),_l.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(ga.stringUid," => ").concat(_E)),ga.uid=_E,_p.gatewayInfo.uid=_E,_p.gatewayInfo.res.uid=_E}else _p=await J4(ga,this._axiosCancelSource.token,this._config.httpRetryConfig||CS,!0,this.store);if(!this._joinAndNotLeaveYet)throw new EE(rE.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(ga,this._axiosCancelSource.token),this._configDistribute.on(GV.UPDATE_BITRATE_LIMIT,_E=>{this._p2pChannel.updateBitrateLimit(_E)})},0),this._key=d||o;const eE=_p.gatewayInfo,iE=ga.uid?ga.uid:eE.uid;this._joinInfo=h0(h0({},ga),{},{cid:eE.cid,uid:iE,vid:eE.vid,apResponse:eE.res,uni_lbs_ip:eE.uni_lbs_ip,gatewayAddrs:eE.gatewayAddrs}),this.store.intUid=iE;const fE=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new EE(rE.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));_o.onSuccess(fE),this._appId=o,this._channelName=ga.cname,this._uid=fE,this.store.uid=fE,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(GS()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const mE=ga.stringUid?"string uid: ".concat(ga.stringUid,",uid: ").concat(ga.uid):"uid: ".concat(this._uid);return _l.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(s,",").concat(mE)),setTimeout(()=>{_l.startUpload()},5e3),this.store.joinEnd(),tE=this,KE(iI).call(iI,tE)||iI.push(tE),this._cloudProxyServerMode==="disabled"&&R_().supportWebCrypto&&cE("ENABLE_PRELOAD")&&PG(this._joinInfo),fE}catch(_p){const _f=Array.isArray(_p)?_p[0]:_p;throw _f&&_f.code===rE.OPERATION_ABORTED?_l.warning("[".concat(this._clientId,"] join number: ").concat($,", Joining channel failed, rollback"),_f):_l.error("[".concat(this._clientId,"] join number: ").concat($,", Joining channel failed, rollback"),_f),_f.code!==rE.OPERATION_ABORTED&&this._numberOfJoinCount===$&&(this._gateway.state="DISCONNECTED",this._reset()),_o.onError(_f),_f}var tE}_joinGateway(){if(!this._joinInfo||!this._key)throw new EE(rE.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!cE("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(o=>o).catch(o=>{if(o.code===rE.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,y_.FALLBACK),o;if(o.code===rE.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,y_.FALLBACK),o;throw o}).then(o=>{if(o instanceof EE){if(o.code===rE.INIT_WEBSOCKET_TIMEOUT){if(_l.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new EE(rE.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const s=cE("PROXY_SERVER_TYPE3");if(Array.isArray(s))if(this._joinInfo.apUrl){const g=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),b=g.slice(g.length-2).join(".");s.forEach($=>{this._joinInfo&&KE($).call($,b)&&(this._joinInfo.proxyServer=$)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=s[0])}else this._joinInfo.proxyServer=s[0];else this._joinInfo.proxyServer=s;const d=cE("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return d&&d[1]&&d[1]!=="443"&&_l.setProxyServer(this._joinInfo.proxyServer),cE("STATS_COLLECTOR_PORT").toString()!=="443"&&t_.setProxyServer(this._joinInfo.proxyServer),t_.reportApiInvoke(this._sessionId,{name:NS.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:hS.TRACER}).onSuccess(),this.safeEmit(S_.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),cE("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(g=>{"forceturn"in g&&(g.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(_l.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new EE(rE.INVALID_OPERATION);return t_.reportApiInvoke(this._sessionId,{name:NS.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:hS.TRACER}).onSuccess(),this._joinGateway()}return o}).then(o=>o)}async leave(){_l.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(GS()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(s){const d=iI.indexOf(s);d!==-1&&iI.splice(d,1)}(this),this._statsCollector.stopUpdateStats();const o=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return _l.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void o();await this._gateway.leave(this.connectionState!=="CONNECTED"),_l.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),o()}async publish(o){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(o)){if(!(o instanceof dN))return this._publishDataChannel(o);o=[o]}if(o.length===0)throw new EE(rE.INVALID_PARAMS,"param list is empty");const d=o;if(this._gateway.role==="audience")throw new EE(rE.INVALID_OPERATION,"audience can not publish stream");for(const b of d){if(!(b instanceof dN))throw new EE(rE.INVALID_PARAMS,"parameter is not local track");if(!b._enabled&&s)throw new EE(rE.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(b.getTrackId()))}_l.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(d.map(b=>"".concat(b.getTrackId()," "))));const g=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),s&&d.forEach(b=>{const $=this._configDistribute.getBitrateLimit();b instanceof Y_&&$&&b.setBitrateLimit($.uplink)});try{await this._publishHighStream(d),_l.info("[".concat(this._clientId,"] Publish success, id ").concat(d.map(b=>"".concat(b.getTrackId()," "))))}catch(b){throw _l.error("[".concat(this._clientId,"] publish error"),b.toString()),b}finally{g()}}async _publishDataChannel(o){W_(o.id,"id",0,65535,!0),NR(o.ordered,"ordered"),QS(o.metadata,"metadata",0,512),_l.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(o.id));const s=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(g=>g.id===o.id)!==-1)throw new EE(rE.INVALID_PARAMS,"Invalid id: ".concat(o.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new EE(rE.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&cE("FORCE_TURN")&&!cE("TURN_ENABLE_TCP")&&!cE("TURN_ENABLE_UDP"))throw new EE(rE.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const d=new T9(o);if(await this._p2pChannel.publishDataChannel([d]),!this._p2pChannel.isP2PDisconnected()){if(typeof d._originDataChannelId!="number")throw _l.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new EE(rE.CREATE_DATACHANNEL_ERROR);try{const g={streamId:o.id,ordered:o.ordered,maxRetransmits:cE("DATASTREAM_MAX_RETRANSMITS"),metadata:o.metadata,channelId:d._originDataChannelId};await this._gateway.publishDataChannel(this._uid,g,!0),await d._waitTillOpen()}catch(g){if(g.code!==rE.DISCONNECT_P2P)throw g}}return _l.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(d.id)),d}catch(d){throw _l.error("[".concat(this._clientId,"] publish datachannels error"),d.toString()),d}finally{s()}}async unpublish(o){if(!this._joinInfo||this._uid===void 0)throw new EE(rE.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let s=[];if(o)if(Array.isArray(o))s=o;else{if(!(o instanceof dN))return this._unpublishDataChannel([o]);s=[o]}else this.store.useP2P||await this._unpublishDataChannel(),s=this._p2pChannel.getAllTracks(!0);_l.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(s.map(g=>"".concat(g.getTrackId()," "))," "));const d=await this._publishMutex.lock();try{if(this._p2pChannel instanceof GT){const g=await this._p2pChannel.unpublish(s);g&&await this._gateway.sendExtensionMessage(vS.UNPUBLISH,{unpubMsg:g},!0)}else{const g=await this._p2pChannel.unpublish(s);g&&await this._gateway.unpublish(g,this._uid),_l.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(s.map(b=>"".concat(b.getTrackId()))))}}catch(g){throw _l.error("[".concat(this._clientId,"] unpublish error"),g.toString()),g}finally{d&&d()}}async _unpublishDataChannel(o){o!==void 0&&o.length!==0||(o=this._p2pChannel.getAllDataChannels()),_l.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(o.map(d=>"".concat(d.id," "))," "));const s=await this._publishMutex.lock();try{const d=await this._p2pChannel.unpublishDataChannel(o);d&&await this._gateway.unpublishDataChannel(d),_l.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(o.map(g=>"".concat(g.id))))}catch(d){throw _l.error("[".concat(this._clientId,"] unpublish dataChannel error"),d.toString()),d}finally{s&&s()}}async subscribe(o,s,d){if(!(o instanceof _I)){const g=this.remoteUsers.find(b=>b.uid===o);if(!g)throw new EE(rE.INVALID_REMOTE_USER,"user is not in the channel");o=g}return s==="datachannel"?this._subscribeDataChannel(o,d):this._subscribe(o,s)}async presubscribe(o,s){if(VS(s,"mediaType",["audio","video"]),this._p2pChannel instanceof GT)throw new EE(rE.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const d=s===_g.AUDIO,g=s===_g.VIDEO,b=await this._subscribeMutex.lock();try{const{ssrcId:$,ortc:Vt,rtxSsrcId:zt,cname:_e,uint_id:_r}=await this._gateway.presubscribe(o,s,!0);if($==null)throw new EE(rE.UNEXPECTED_RESPONSE,"no ssrc id");let _o=this._users.find(_a=>_a.uid===o);_o||(_o=new _I(o,_r||o),_o._is_pre_created=!0,this._users.push(_o)),_e&&(_o._cname=_e),_o._uintid||(_o._uintid=_r||o),d&&(_o._audioSSRC=$,_o._audio_pre_subscribed=!0,Vt&&(_o._audioOrtc=Vt)),g&&(_o._videoSSRC=$,_o._video_pre_subscribed=!0,Vt&&(_o._videoOrtc=Vt),zt!=null&&(_o._rtxSsrcId=zt)),_l.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat($)),await this._p2pChannel.subscribe(_o,s,$,zt,Vt);const ga=d?_o._audioTrack:_o._videoTrack;if(!ga)throw new EE(rE.UNEXPECTED_ERROR,"can not find remote track in user");return d&&(_o._trust_audio_stream_added_state_=!0,_o._audio_added_=!0),g&&(_o._trust_video_stream_added_state_=!0,_o._video_added_=!0),ga}catch($){throw _l.error("[".concat(this._clientId,"] presub user ").concat(o," error"),$),$}finally{b()}}async _subscribeDataChannel(o,s){var d;if(W_(s,"channelId",0,65535,!0),!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(zt=>zt===o))throw _l.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid,", this user is not in the channel")),new EE(rE.INVALID_REMOTE_USER,"user is not in the channel");if(!o.hasAudio&&!o.hasVideo&&o._dataChannels.length===0)throw _l.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid,", user is not published")),new EE(rE.INVALID_REMOTE_USER,"user is not published");const b=(d=o._dataChannels)===null||d===void 0?void 0:d.find(zt=>zt.id===s);if(!b)throw _l.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType datachannel, remote datachannel is not published")),new EE(rE.REMOTE_USER_IS_NOT_PUBLISHED);const $=await this._subscribeMutex.lock();_l.info("[".concat(this._clientId,"] subscribe user ").concat(o.uid,", mediaType: datachannel"));try{const zt=await this._p2pChannel.subscribeDataChannel(o,[b]);if(zt&&KE(zt).call(zt,b.id))try{var Vt;if(typeof b._originDataChannelId!="number")throw _l.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType datachannel, cannot get RTCDatachannel")),new EE(rE.CREATE_DATACHANNEL_ERROR);const _e={id:b.id,datachannelId:b._originDataChannelId,ordered:b.ordered,maxRetransmits:b.maxRetransmits,metadata:(Vt=b.metadata)!==null&&Vt!==void 0?Vt:""};await this._gateway.subscribeDataChannel(o.uid,_e,!0),await b._waitTillOpen()}catch(_e){if((_e==null?void 0:_e.code)!==rE.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(o,[b]),_e;await this._p2pChannel.unsubscribeDataChannel(o,[b]),this._p2pChannel.setPendingRemoteDataChannel(o,b.id)}return _l.info("[".concat(this._clientId,"] subscribe success user ").concat(o.uid,", mediaType: datachannel")),b}finally{$()}}async _p2pSubscribe(o,s,d){if(VS(s,"mediaType",["audio","video"]),!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find($=>$===o)){const $=new EE(rE.INVALID_REMOTE_USER,"user is not in the channel");throw _l.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid,", this user is not in the channel")),$}if(!o.hasAudio&&!o.hasVideo){const $=new EE(rE.INVALID_REMOTE_USER,"user is not published");throw _l.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid,", user is not published")),$}if(!d&&(s==="audio"&&!o.hasAudio||s==="video"&&!o.hasVideo)){const $=new EE(rE.REMOTE_USER_IS_NOT_PUBLISHED);throw _l.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(s,", remote track is not published")),$}const b=await this._subscribeMutex.lock();_l.info("[".concat(this._clientId,"] subscribe user ").concat(o.uid,", mediaType: ").concat(s));try{if(await this._p2pChannel.hasRemoteMediaWithLock(o,s))await this._p2pChannel.unmuteRemote(o,s);else try{const Vt=s==="audio"?o._audioSSRC:o._videoSSRC,zt=s==="audio"?o._audioMid:o._videoMid;this.store.subscribe(o.uid,s,Date.now()),this._p2pChannel instanceof GT&&await this._p2pChannel.subscribe(o,s,Vt,zt)}catch(Vt){throw Vt}_l.info("[".concat(this._clientId,"] subscribe success user ").concat(o.uid,", mediaType: ").concat(s)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(o.uid,this._defaultStreamFallbackType).catch(Vt=>{_l.warning("[".concat(this._clientId,"] auto set fallback failed"),Vt)});const $=s==="audio"?o._audioTrack:o._videoTrack;if(!$)throw new EE(rE.UNEXPECTED_ERROR,"can not find remote track in user object");return $}catch($){throw _l.error("[".concat(this._clientId,"] subscribe user ").concat(o.uid," error"),$),$}finally{b()}}async _subscribe(o,s,d){if(this._p2pChannel instanceof GT)return this._p2pSubscribe(o,s);if(VS(s,"mediaType",["audio","video"]),!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(_r=>_r===o)){const _r=new EE(rE.INVALID_REMOTE_USER,"user is not in the channel");throw _l.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid,", this user is not in the channel")),_r}if(!o.hasAudio&&!o.hasVideo){const _r=new EE(rE.INVALID_REMOTE_USER,"user is not published");throw _l.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid,", user is not published")),_r}if(!(d||(s!=="audio"||o.hasAudio&&o._audioSSRC!==void 0)&&(s!=="video"||o.hasVideo&&o._videoSSRC!==void 0))){const _r=new EE(rE.REMOTE_USER_IS_NOT_PUBLISHED);throw _l.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(s,", remote track is not published")),_r}let b=s==="audio"?o._audioSSRC:o._videoSSRC,$=s==="audio"?o._audioOrtc:o._videoOrtc,Vt=s==="video"?o._rtxSsrcId:void 0,zt={stream_type:s==="audio"?_g.AUDIO:_g.VIDEO,ssrcId:b};const _e=await this._subscribeMutex.lock();_l.info("[".concat(this._clientId,"] subscribe user ").concat(o.uid,", mediaType: ").concat(s));try{if(await this._p2pChannel.hasRemoteMediaWithLock(o,s))await this._p2pChannel.unmuteRemote(o,s);else try{const _o=s==="audio"?o._audioSSRC:o._videoSSRC;_o!==void 0&&_o!==b&&(b=_o,$=s==="audio"?o._audioOrtc:o._videoOrtc,Vt=s==="video"?o._rtxSsrcId:void 0,zt={stream_type:s==="audio"?_g.AUDIO:_g.VIDEO,ssrcId:b}),aT.markSubscribeStart(this.store.clientId,b),this.store.subscribe(o.uid,s,Date.now()),await this._p2pChannel.subscribe(o,s,b,Vt,$);try{await this._gateway.subscribe(o.uid,zt,!0)}catch(ga){if((ga==null?void 0:ga.code)!==rE.WS_ABORT)throw await this._p2pChannel.unsubscribe(o,s),ga;await this._p2pChannel.unsubscribe(o,s,!0),this._p2pChannel.setPendingRemoteMedia(o,s)}this.store.subscribe(o.uid,s,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,o,s)}catch(_o){throw this._p2pChannel.reportSubscribeEvent(!1,_o==null?void 0:_o.code,o,s),_o}_l.info("[".concat(this._clientId,"] subscribe success user ").concat(o.uid,", mediaType: ").concat(s)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(o.uid,this._defaultStreamFallbackType).catch(_o=>{_l.warning("[".concat(this._clientId,"] auto set fallback failed"),_o)});const _r=s==="audio"?o._audioTrack:o._videoTrack;if(!_r)throw new EE(rE.UNEXPECTED_ERROR,"can not find remote track in user object");return _r}catch(_r){throw _l.error("[".concat(this._clientId,"] subscribe user ").concat(o.uid," error"),_r),_r}finally{_e()}}async massSubscribe(o){if(kR(o,"subscribeList"),!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const s=Date.now(),d=new Map,g=await this._subscribeMutex.lock();_l.info("[".concat(this._clientId,"]start massSubscribe user ").concat(o.map(zt=>{let{user:_e,mediaType:_r}=zt;return"user: ".concat(_e==null?void 0:_e.uid,", mediaType: ").concat(_r)}).join("; ")));const b=(o=[...o]).map(zt=>{let{user:_e,mediaType:_r}=zt;return{user:_e,mediaType:_r}}),$=await this._p2pChannel.globalLock();try{var Vt;for(let _e=o.length-1;_e>=0;_e--){const _r=o[_e],{user:_o,mediaType:ga}=_r;if(VS(ga,"mediaType",["audio","video"]),!_o){const _p=new EE(rE.INVALID_PARAMS,"user property does not exist in subscribeList item");throw _l.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),_p}if(!this._users.find(_p=>_p===_o)){const _p=new EE(rE.INVALID_REMOTE_USER,"user is not in the channel");_l.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_o.uid,", this user is not in the channel")),b[_e].error=_p,o.splice(_e,1);continue}if(ga==="audio"&&(!_o.hasAudio||_o._audioSSRC===void 0)||ga==="video"&&(!_o.hasVideo||_o._videoSSRC===void 0)){const _p=new EE(rE.REMOTE_USER_IS_NOT_PUBLISHED);_l.error("[".concat(this._clientId,"] can not subscribe ").concat(_o.uid," with mediaType ").concat(ga,", remote user is not published")),b[_e].error=_p,o.splice(_e,1);continue}const _c=qS.Video|qS.LwoVideo,tE=d.get(_o);if(tE){if(ga==="video"?tE&_c:tE&qS.Audio){o.splice(_e,1),_l.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_o.uid,", mediaType:").concat(ga," twice"));continue}d.set(_o,tE|(ga==="video"?_c:qS.Audio))}else d.set(_o,ga==="video"?_c:qS.Audio)}for(let _e=o.length-1;_e>=0;_e--){const _r=o[_e],{user:_o,mediaType:ga}=_r,_a=qS.Video|qS.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_o,ga)){await this._p2pChannel.unmuteRemoteNoLock(_o,ga);const _c=d.get(_o);d.set(_o,ga==="video"?_c^_a:_c^qS.Audio),o.splice(_e,1)}}this.store.massSubscribe(o.map(_e=>({userId:_e.user.uid,type:_e.mediaType})),s);const zt=F0(Vt=Array.from(d.entries())).call(Vt,(_e,_r)=>{let[_o,ga]=_r;if(ga===0)return _e;const _a={stream_id:_o.uid,stream_type:ga};return ga&qS.Audio&&(_a.audio_ssrc=_o._audioSSRC),ga&qS.Video&&(_a.video_ssrc=_o._videoSSRC),_e.push(_a),_e},[]);try{o.length>0&&await this._p2pChannel.massSubscribeNoLock(o.map(_r=>{let{user:_o,mediaType:ga}=_r;return{user:_o,mediaType:ga,ssrcId:ga===_g.VIDEO?_o._videoSSRC:_o._audioSSRC,rtxSsrcId:ga===_g.VIDEO?_o._rtxSsrcId:void 0}}));const _e=new Map;if(zt.length>0){const _r=await this._gateway.subscribeAll(zt,!0);((_r==null?void 0:_r.users)||[]).forEach(_o=>{let{stream_id:ga,video_error_code:_a,audio_error_code:_c,error_code:tE}=_o;(_a||_c||tE)&&_e.set(ga,{video_error_code:_a,audio_error_code:_c,error_code:tE})})}if(Array.from(_e.entries()).length>0){const _r=[];Array.from(_e.entries()).forEach(_o=>{let[ga,_a]=_o;const _c=this.remoteUsers.find(tE=>tE.uid===ga);if(_c){let tE;_a.error_code||_a.video_error_code&&_a.audio_error_code?tE=void 0:_a.video_error_code?tE=_g.VIDEO:_a.audio_error_code&&(tE=_g.AUDIO),_r.push({user:_c,mediaType:tE})}}),_r.length>0&&await this._p2pChannel.massUnsubscribeNoLock(_r)}for(const _r of b){const _o=_e.get(_r.user.uid);if(_o){const ga=_o.error_code||_r.mediaType==="audio"&&_o.audio_error_code||_r.mediaType==="video"&&_o.video_error_code;if(ga){const _a=HI(ga);_l.error("user:".concat(_r.user.uid," mediaType:").concat(_r.mediaType," has massSubscribe error ").concat(_a.desc)),_r.error=new EE(rE.SUBSCRIBE_FAILED,"code ".concat(ga,": ").concat(_a.desc))}}_r.error||(_r.mediaType==="video"?_r.track=_r.user.videoTrack:_r.track=_r.user.audioTrack)}return this.store.massSubscribe(b.filter(_r=>!_r.error).map(_r=>({userId:_r.user.uid,type:_r.mediaType})),void 0,Date.now()),b.forEach(_r=>{var _o;t_.subscribe(this.store.sessionId,{succ:!!_r.error,ec:((_o=_r.error)===null||_o===void 0?void 0:_o.code)||null,video:_r.mediaType===_g.VIDEO,audio:_r.mediaType===_g.AUDIO,peerid:_r.user.uid,subscribeRequestid:_r.mediaType===_g.VIDEO?_r.user._videoSSRC:_r.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-s)},!0)}),_l.info("[".concat(this._clientId,"] massSubscribe success ").concat(o.map(_r=>{let{user:_o,mediaType:ga}=_r;return"user: ".concat(_o==null?void 0:_o.uid,", mediaType: ").concat(ga)}).join("; "))),b}catch(_e){throw await this._p2pChannel.massUnsubscribeNoLock(o),_e}}finally{$(),g()}}async unsubscribe(o,s,d){if(!(o instanceof _I)){const $=this.remoteUsers.find(Vt=>Vt.uid===o);if(!$)throw new EE(rE.INVALID_REMOTE_USER,"user is not in the channel");o=$}if(s||this.store.useP2P){if(s==="datachannel")return this._unsubscribeDataChannel(o,d)}else await this._unsubscribeDataChannel(o,d);if(s&&VS(s,"mediaType",["audio","video"]),!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find($=>$===o)){const $=new EE(rE.INVALID_REMOTE_USER,"user is not in the channel");throw _l.error("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),$}_l.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(o.uid,", mediaType: ").concat(s));const b=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof GT)await this._p2pChannel.unsubscribe(o,s);else{const $=await this._p2pChannel.unsubscribe(o,s);$&&await this._gateway.unsubscribe($,o.uid),s&&s!=="audio"||(o._audio_pre_subscribed=!1),s&&s!=="video"||(o._video_pre_subscribed=!1),o._is_pre_created&&yD(this._users,o),_l.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(o.uid,", mediaType: ").concat(s))}}catch($){if($.code===rE.DISCONNECT_P2P)return void _l.warning("disconnecting p2p, abort unsubscribe request.");throw _l.error("[".concat(this._clientId,"] unsubscribe user ").concat(o.uid," error"),$.toString()),$}finally{b()}}async _unsubscribeDataChannel(o,s){if(s&&W_(s,"id",0,65535,!0),!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(b=>b===o)){const b=new EE(rE.INVALID_REMOTE_USER,"user is not in the channel");throw _l.error("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),b}let g;if(typeof s=="number"){const b=o._dataChannels.find($=>$.id===s);b&&(g=[b])}else g=o._dataChannels;if(g===void 0){const b=new EE(rE.REMOTE_USER_IS_NOT_PUBLISHED);throw _l.error("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid," with channelId ").concat(s,", remote datachannel is not published")),b}_l.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(o.uid,", mediaType: datachannel, ids: ").concat(g.map(b=>b.id)));try{const b=await this._p2pChannel.unsubscribeDataChannel(o,g);b&&await this._gateway.unsubscribeDataChannel(b,o.uid),_l.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(o.uid,", mediaType: datachannel, ids: ").concat(b))}catch(b){if(b.code===rE.DISCONNECT_P2P)return void _l.warning("disconnecting p2p, abort unsubscribe request.");throw _l.error("[".concat(this._clientId,"] unsubscribe user ").concat(o.uid," error"),b.toString()),b}}async massUnsubscribe(o){if(kR(o,"unsubscribeList"),!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");_l.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(o.map(d=>{let{user:g,mediaType:b}=d;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(b,";")}).join())),o=[...o];const s=new Map;for(let d=o.length-1;d>=0;d--){const{user:g,mediaType:b}=o[d];if(!g){const zt=new EE(rE.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw _l.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),zt}if(VS(b,"mediaType",["video","audio",void 0]),!this._users.find(zt=>zt===g)){_l.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(g.uid,", user is not in the channel")),o.splice(d,1);continue}const Vt=qS.Video|qS.LwoVideo;if(s.has(g)){const zt=s.get(g);let _e;switch(b){case"video":_e=zt&Vt;break;case"audio":_e=zt&qS.Audio;break;default:_e=zt&(qS.Audio|Vt)}if(_e){_l.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(g.uid,",mediaType:").concat(b," twice.")),o.splice(d,1);continue}b?b==="audio"?s.set(g,zt|qS.Audio):b==="video"&&s.set(g,zt|Vt):s.set(g,zt|qS.Audio|Vt)}else b?b==="audio"?s.set(g,qS.Audio):b==="video"&&s.set(g,Vt):s.set(g,qS.Audio|Vt)}try{const d=await this._p2pChannel.massUnsubscribe(o);d&&await this._gateway.massUnsubscribe(d),_l.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(o.map(g=>{let{user:b,mediaType:$}=g;return"user: ".concat(b==null?void 0:b.uid,", mediaType: ").concat($,";")}).join()))}catch(d){if(d.code===rE.DISCONNECT_P2P)return void _l.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw _l.error("[".concat(this._clientId,"] massUnsubscribe error"),d.toString()),d}}async setLowStreamParameter(o){(function(d){if(!d)throw new TE(rE.INVALID_PARAMS);dS(d.width)||SV(d.width,"streamParameter.width"),dS(d.height)||SV(d.height,"streamParameter.height"),dS(d.framerate)||SV(d.framerate,"streamParameter.framerate"),dS(d.bitrate)||W_(d.bitrate,"streamParameter.bitrate")})(o),(!o.width&&o.height||o.width&&!o.height)&&_l.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),_l.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(o));const s=this._configDistribute.getLowStreamConfigDistribute();if(s&&s.bitrate&&o.bitrate&&s.bitrate<o.bitrate&&(o.bitrate=s.bitrate),this._lowStreamParameter=o,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(o,ME.LocalVideoLowTrack)}async enableDualStream(){if(!R_().supportDualStream)throw t_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new EE(rE.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new EE(rE.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(o){throw t_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),o}this._isDualStreamEnabled=!0,t_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),_l.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ME.LocalVideoLowTrack))try{const o=await this._p2pChannel.unpublishLowStream();o&&await this._gateway.unpublish(o,this._joinInfo.stringUid||this._joinInfo.uid)}catch(o){throw t_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),o}this._isDualStreamEnabled=!1,t_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),_l.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(o,s){if(function(d){VS(d,"role",["audience","host"])}(o),s&&$8(s),this.mode==="rtc"||this.mode==="p2p")throw _l.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new EE(rE.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(s&&s.level&&o==="host")throw new EE(rE.INVALID_OPERATION,"host mode can not set audience latency level");if(o==="audience"&&this._p2pChannel.hasLocalMedia())throw new EE(rE.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(o,s),this._config.role=o,_l.info("[".concat(this._clientId,"] set client role to ").concat(o,", level: ").concat(s&&s.level))}getRemoteInboundOffset(){var o;const s=(o=this._p2pChannel.getStats())===null||o===void 0?void 0:o.audioSend[0];if(!s||!s.timestamp)return 0;const d=s.timestamp-Date.now();return Math.abs(d)>1e3+s.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?d:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(o,s){if(QS(o,"proxyServer"),!s){if(this.connectionState!=="DISCONNECTED")throw new EE(rE.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new EE(rE.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=o,t_.setProxyServer(this._proxyServer),_l.setProxyServer(this._proxyServer),_l.info("[".concat(this._clientId,"] Set proxy server ").concat(s?"by initialize call":""," success."))}setTurnServer(o,s){if(Array.isArray(o)||(o=[o]),!s){if(this.connectionState!=="DISCONNECTED")throw new EE(rE.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new EE(rE.INVALID_OPERATION,"You have already set the proxy")}if(jO(o))return this._turnServer={servers:o,mode:"original-manual"},void _l.info("[".concat(this._clientId,"] Set original turnserver ").concat(s?"by initialize call":""," success: ").concat(o.map(d=>d.urls).join(","),"."));o.forEach(d=>Z8(d)),this._turnServer={servers:o,mode:"manual"},_l.info("[".concat(this._clientId,"] Set turnserver ").concat(s?"by initialize call":""," success."))}setLicense(o){if(this.connectionState!=="DISCONNECTED")throw new EE(rE.INVALID_OPERATION,"you should set license before join channel");if(QS(o,"license",32,32),!/^[A-Za-z\d]+$/.test(o))throw new EE(rE.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=o,_l.info("[".concat(this._clientId,"] set license success"),o)}startProxyServer(o){if(this.connectionState!=="DISCONNECTED")throw new EE(rE.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new EE(rE.INVALID_OPERATION,"You have already set the proxy");const s=[3,4,5];let d;switch(o===void 0&&(o=3),o){case 1:case 2:throw new EE(rE.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:d="proxy3";break;case 4:d="proxy4";break;case 5:d="proxy5";break;default:throw new EE(rE.INVALID_PARAMS,"proxy server mode must be ".concat(s.join("|")))}this._cloudProxyServerMode=d,this.store.cloudProxyServerMode=d,_l.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new EE(rE.INVALID_OPERATION,"Stop proxy server after leave channel");t_.setProxyServer(),_l.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",_l.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(o){if(!o.accessPoints)throw new EE(rE.INVALID_PARAMS,"accessPoints is required.");kR(o.accessPoints.serverList,"accessPoints.serverList"),QS(o.accessPoints.domain,"accessPoints.domain");const s=(_a,_c)=>{W_(_a,_c,0,65535,!0)};let d=443;if(o.accessPoints.port&&(s(o.accessPoints.port,"accessPoints.port"),d=o.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new EE(rE.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");cE("CLOSE_AFB_FOR_LOCAL_AP")&&(q_("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),q_("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const g=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,b=o.accessPoints.domain,$=o.accessPoints.serverList.map(_a=>g.test(_a)?"".concat(_a.replace(/\./g,"-"),".").concat(b):_a),Vt=$.map(_a=>"".concat(_a,":").concat(d));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,q_("WEBCS_DOMAIN",Vt),q_("WEBCS_DOMAIN_BACKUP_LIST",Vt),q_("GATEWAY_DOMAINS",[b]),o.report&&o.report.hostname&&Array.isArray(o.report.hostname)&&o.report.hostname.length?(kR(o.report.hostname,"report.hostname"),q_("EVENT_REPORT_DOMAIN",o.report.hostname[0]),q_("EVENT_REPORT_BACKUP_DOMAIN",o.report.hostname[1]||o.report.hostname[0])):(q_("EVENT_REPORT_DOMAIN",$[0]),q_("EVENT_REPORT_BACKUP_DOMAIN",$[1]||$[0]));let zt=6443;o.report&&o.report.port&&(s(o.report.port,"report.port"),zt=o.report.port),q_("STATS_COLLECTOR_PORT",zt),o.report?q_("ENABLE_EVENT_REPORT",!0):q_("ENABLE_EVENT_REPORT",!1);let _e="";o.log&&o.log.hostname&&Array.isArray(o.log.hostname)&&o.log.hostname.length?(kR(o.log.hostname,"log.hostname"),_e=o.log.hostname[0]):_e=$[0];let _r=6444;o.log&&o.log.port&&(s(o.log.port,"log.port"),_r=o.log.port),q_("LOG_UPLOAD_SERVER","".concat(_e,":").concat(_r));let _o=[];o.cds&&o.cds.hostname&&Array.isArray(o.cds.hostname)&&o.cds.hostname.length?(kR(o.cds.hostname,"cds.hostname"),_o=o.cds.hostname):_o=$;let ga=443;o.cds&&o.cds.port&&(s(o.cds.port,"cds.port"),ga=o.cds.port),q_("CDS_AP",_o.map(_a=>"".concat(_a,":").concat(ga))),o.cds?q_("ENABLE_CONFIG_DISTRIBUTE",!0):q_("ENABLE_CONFIG_DISTRIBUTE",!1),_l.info("set local access point v2 success")}setLocalAccessPoints(o,s){if(kR(o,"serverList"),QS(s,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new EE(rE.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const d=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;o=o.map(g=>d.test(g)?"".concat(g.replace(/\./g,"-"),".").concat(s):g),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,q_("WEBCS_DOMAIN",o),q_("WEBCS_DOMAIN_BACKUP_LIST",o),q_("GATEWAY_DOMAINS",[s]),q_("EVENT_REPORT_DOMAIN",o[0]),q_("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]),q_("LOG_UPLOAD_SERVER","".concat(o[0],":6444")),_l.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(o){if(VS(o,"streamType",[0,1]),this._remoteDefaultVideoStreamType=o,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(o),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(s){throw _l.error("[".concat(this._clientId,"] set default remote video stream type error"),s.toString()),s}else _l.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(o))}async setRemoteVideoStreamType(o,s){VS(s,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(o,s),setTimeout(()=>{const d=this._users.find(g=>g.uid===o);d&&d.videoTrack&&d.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(d){throw _l.error("[".concat(this._clientId,"] set remote video stream type error"),d.toString()),d}_l.info("[".concat(this._clientId,"] set remote ").concat(o," video stream type to ").concat(s)),this._remoteStreamTypeCacheMap.set(o,s)}async setStreamFallbackOption(o,s){VS(s,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(o,s)}catch(d){throw _l.error("[".concat(this._clientId,"] set stream fallback option"),d.toString()),d}_l.info("[".concat(this._clientId,"] set remote ").concat(o," stream fallback type to ").concat(s)),this._streamFallbackTypeCacheMap.set(o,s)}setEncryptionConfig(o,s,d,g){(function($){VS($,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(o),QS(s,"secret");const b=["aes-128-gcm2","aes-256-gcm2"];if(KE(b).call(b,o)){if(!d||!(d instanceof Uint8Array&&d.length===32))throw new EE(rE.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(d)throw new EE(rE.INVALID_PARAMS,"current encrypt mode does not need salt");if(g){if(NR(g,"encryptDataStream"),!KE(b).call(b,o))throw new EE(rE.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(s)||_l.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=o,this._encryptionSecret=s,d&&(this._encryptionSalt=nI(d))}async renewToken(o){if(QS(o,"token",1,2047),!this._key||!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"renewToken should not be called before user join");const s=this._key;this._key=o,this._joinInfo&&(this._joinInfo.token=o);const d=await this._renewTokenMutex.lock();try{if(cE("USE_NEW_TOKEN")){_l.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const g=await fut(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||CS);_l.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:o,ticket:g})}else _l.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:o});_l.debug("[".concat(this._clientId,"] renewToken success"))}catch(g){throw this._key=s,this._joinInfo.token=s,_l.error("[".concat(this._clientId,"] renewToken failed"),g.toString()),g}finally{d()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?_l.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const o=this._p2pChannel.getAudioLevels();this.safeEmit(S_.VOLUME_INDICATOR,o)},cE("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const o=this._statsCollector.getRTCStats(),s=this._gateway.getInChannelInfo();return o.Duration=Math.round(s.duration/1e3),o}async startLiveStreaming(o,s){if(!s){if(this.codec!=="h264")throw new EE(rE.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new EE(rE.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(o)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(o))throw new EE(rE.LIVE_STREAMING_TASK_CONFLICT);const d=s?YS.TRANSCODE:YS.RAW;return this._createLiveStreamingClient(d).startLiveStreamingTask(o,d)}setLiveTranscoding(o){return this._createLiveStreamingClient(YS.TRANSCODE).setTranscodingConfig(o)}async stopLiveStreaming(o){const s=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(d=>d&&d.hasUrl(o));if(!s.length)throw new EE(rE.INVALID_PARAMS,"can not find live streaming url to stop");await GE.all(s.map(d=>d&&d.stopLiveStreamingTask(o)))}async addInjectStreamUrl(o,s){if(!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const d=this._createLiveStreamingClient(YS.INJECT);d.setInjectStreamConfig(s,0),await d.startLiveStreamingTask(o,YS.INJECT)}async removeInjectStreamUrl(){var o;const s=this._createLiveStreamingClient(YS.INJECT),d=Array.from(q0(o=s.streamingTasks).call(o)).find(g=>g.mode===YS.INJECT);if(!this._joinInfo||!d)throw new EE(rE.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await s.stopLiveStreamingTask(d.url)}async startChannelMediaRelay(o){pJ(o),await this._createChannelMediaRelayClient().startChannelMediaRelay(o)}async updateChannelMediaRelay(o){pJ(o),await this._createChannelMediaRelayClient().updateChannelMediaRelay(o)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(o){var s;let d=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"can not send data stream, not joined");if((typeof o=="string"||o instanceof Uint8Array)&&(o={payload:o}),typeof o.payload=="string"){const b=new TextEncoder;o.payload=b.encode(o.payload)}let g=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&KE(s=["aes-128-gcm2","aes-256-gcm2"]).call(s,this._encryptionMode)&&(g=!0,o.payload=await async function(b,$,Vt){var zt;const _e=F0(zt=Array.from(Vt)).call(zt,(_p,_f)=>_p+_f,0),_r={serverTs:0,seq:Qat++,length:Vt.length,checkSum:_e},_o=new Uint8Array(a4(_e,2)),ga=new ArrayBuffer(GO),_a=new DataView(ga);_a.setUint32(0,_r.serverTs),_a.setUint16(4,_r.seq),_a.setUint16(6,_r.length),_a.setUint16(8,_r.checkSum);const _c=16-Vt.length%16;Vt=n4(Vt,new Uint8Array(_c));const tE=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:b,tagLength:l4,additionalData:_o},$,Vt);return n4(new Uint8Array(ga),new Uint8Array(tE))}(this._encryptDataStreamIv,this._encryptDataStreamKey,o.payload)),new Blob([o.payload]).size>1024)throw new EE(rE.INVALID_PARAMS,g?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(n_.DATA_STREAM,{payload:nI(o.payload),syncWithAudio:o.syncWithAudio,sendTs:Date.now()-jht},!d)}sendMetadata(o){if(!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([o]).size>1024)throw new EE(rE.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(n_.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:nI(o)})}async sendCustomReportMessage(o){if(Array.isArray(o)||(o=[o]),o.forEach($at),!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"can not send custom report, not joined");await t_.sendCustomReportMessage(this._joinInfo.sid,o)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(o,s){VS(s.spatialLayer,"spatialLayer",[0,1,2,3]),VS(s.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(o,s)}catch(d){throw _l.error("[".concat(this._clientId,"] pick SVC layer failed"),d.toString()),d}}async setRTMConfig(o){const{apRTM:s=!1,rtmFlag:d}=o;if(NR(s,"apRTM"),W_(d,"rtmFlag",0),this._rtmConfig.apRTM=s,this._rtmConfig.rtmFlag=d,_l.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(o)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=s,this._joinInfo.rtmFlag=d,this._gateway.setRTM2Flag(d)}_reset(){if(_l.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=RT.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&aX(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(o=>{o._audioTrack&&o._audioTrack._destroy(),o._videoTrack&&o._videoTrack._destroy(),o._dataChannels&&(o._dataChannels.forEach(s=>s._close()),o._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new KS("client-publish"),this._subscribeMutex=new KS("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(o,s){var d;const g=o||oP();o?_l.debug("[".concat(this._clientId,"] new Session ").concat(g)):_l.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(g));const b=o?"":this._sessionId||"";this._sessionId=g,this.store.sessionId=g;const $={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(s==null?void 0:s.stringUid)||((d=this._joinInfo)===null||d===void 0?void 0:d.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:b,clientRole:this.role==="audience"?2:1};s?t_.sessionInit(this._sessionId,h0({cname:s.channel,appid:s.appId,preload:s.preload},$)):this._joinInfo?t_.sessionInit(this._sessionId,h0({cname:this._joinInfo.cname,appid:this._joinInfo.appId,preload:!!this._joinInfo.recoverPreloadCache},$)):this._gateway.joinInfo&&t_.sessionInit(this._sessionId,h0({cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId},$)),this._joinInfo&&(this._joinInfo.sid=g),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=g)}async _publishHighStream(o){if(!this._joinInfo||this._uid===void 0)throw new EE(rE.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&cE("FORCE_TURN")&&!cE("TURN_ENABLE_TCP")&&!cE("TURN_ENABLE_UDP"))throw new EE(rE.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");_l.debug("[".concat(this._clientId,"] publish high stream"));try{const d=await this._p2pChannel.publish(o,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof GT){const g=(await d.next()).value;if(g){try{await this._gateway.sendExtensionMessage(vS.PUBLISH,g,!0)}catch(b){throw d.throw(b),b}await d.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const g=(await d.next()).value;if(g){var s;let b;try{b=await this._gateway.publish(this._uid,g,!0)}catch($){if($.code!==rE.DISCONNECT_P2P)throw d.throw($),$}await d.next(((s=b)===null||s===void 0?void 0:s.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const b of o)b instanceof Y_&&b._encoderConfig&&this._gateway.setVideoProfile(b._encoderConfig),!b.muted&&b.enabled||await this._p2pChannel.muteLocalTrack(b)}}catch(d){if(this._p2pChannel.reportPublishEvent(!1,d==null?void 0:d.code,o),(d==null?void 0:d.code)===rE.WS_ABORT)return;throw d}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new EE(rE.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new EE(rE.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));_l.debug("[".concat(this._clientId,"] publish low stream"));const o=this._configDistribute.getLowStreamConfigDistribute();o&&o.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&o.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=o.bitrate));try{const d=await this._p2pChannel.publishLowStream(this._lowStreamParameter),g=(await d.next()).value;if(g){var s;let b;try{b=await this._gateway.publish(this._uid,g,!0)}catch($){if($.code!==rE.DISCONNECT_P2P)throw d.throw($),$}d.next(((s=b)===null||s===void 0?void 0:s.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(d){if(this._p2pChannel.reportPublishEvent(!1,d==null?void 0:d.code,void 0,!0),(d==null?void 0:d.code)===rE.WS_ABORT)return;throw d}}_createLiveStreamingClient(o){if(!this._joinInfo||!this._appId)return new EE(rE.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=()=>new hht(this._joinInfo,this._config.websocketRetryConfig||CS,this._config.httpRetryConfig||CS),d=g=>{g.onLiveStreamError=(b,$)=>{t_.reportApiInvoke(this._sessionId,{name:NS.ON_LIVE_STREAM_ERROR,options:[b,$],tag:hS.TRACER}).onSuccess(),this.safeEmit(S_.LIVE_STREAMING_ERROR,b,$)},g.onLiveStreamWarning=(b,$)=>{t_.reportApiInvoke(this._sessionId,{name:NS.ON_LIVE_STREAM_WARNING,options:[b,$],tag:hS.TRACER}).onSuccess(),this.safeEmit(S_.LIVE_STREAMING_WARNING,b,$)},g.on(DD.REQUEST_WORKER_MANAGER_LIST,(b,$,Vt)=>{if(!this._joinInfo)return Vt(new EE(rE.INVALID_OPERATION,"can not find join info to get worker manager"));$4(b,this._joinInfo,this._axiosCancelSource.token,CS).then($).catch(Vt)})};switch(o){case YS.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=s(),d(this._liveRawStreamingClient)),this._liveRawStreamingClient;case YS.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=s(),d(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case YS.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=s(),this._injectStreamingClient.on(DD.REQUEST_WORKER_MANAGER_LIST,(g,b,$)=>{if(!this._joinInfo)return $(new EE(rE.INVALID_OPERATION,"can not find join info to get worker manager"));$4(g,this._joinInfo,this._axiosCancelSource.token,CS).then(b).catch($)}),this._injectStreamingClient.onInjectStatusChange=(g,b,$)=>{this.safeEmit(S_.INJECT_STREAM_STATUS,g,b,$)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new EE(rE.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:o,sendResolutionHeight:s}=this.getLocalVideoStats(),d={width:o,height:s};this._channelMediaRelayClient=new fht(this._joinInfo,this._clientId,this._config.websocketRetryConfig||CS,this._config.httpRetryConfig||CS,d),this._channelMediaRelayClient.on("state",g=>{g===NT.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(S_.CHANNEL_MEDIA_RELAY_STATE,g)}),this._channelMediaRelayClient.on("event",g=>{this.safeEmit(S_.CHANNEL_MEDIA_RELAY_EVENT,g)}),this._statsCollector.onStatsChanged=(g,b)=>{var $;g==="resolution"&&(($=this._channelMediaRelayClient)===null||$===void 0||$.setVideoProfile(b))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(o,s){const{added:d,deleted:g}=o,b=[];Array.isArray(d)&&d.length>0&&d.forEach($=>{const{uid:Vt,stream_id:zt,ordered:_e,max_retrans_times:_r,metadata:_o}=$,ga=this._users.find(_a=>_a._uintid===Vt);if(!ga)return void _l.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(_l.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(Vt)),KE(b).call(b,ga)||b.push(ga),ga._uintid||(ga._uintid=Vt),ga._dataChannels.findIndex(_a=>_a.id===$.stream_id)===-1){const _a={id:zt,ordered:!!_e,maxRetransmits:_r,metadata:_o},_c=new Wdt(_a);ga._dataChannels.push(_c),_l.info("[".concat(this._clientId,"] remote user ").concat(ga.uid," published datachannel")),s||this.safeEmit(S_.USER_PUBLISHED,ga,"datachannel",_a)}this._p2pChannel.hasPendingRemoteDataChannel(ga,$.stream_id)&&(_l.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(ga.uid," after reconnect.")),this._subscribeDataChannel(ga,$.stream_id).catch(_a=>{_l.error("[".concat(this._clientId,"] resubscribe datachannel error"),_a.toString())}))}),s&&(this.safeEmit(S_.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(g)&&g.length>0&&g.forEach($=>{const{uid:Vt,stream_id:zt}=$,_e=this._users.find(_o=>_o._uintid===Vt);if(!_e)return void _l.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const _r=_e._dataChannels.find(_o=>_o.id===$.stream_id);_r&&(_l.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(Vt)),this._p2pChannel.unsubscribeDataChannel(_e,[_r]).then(_o=>{if(_e._dataChannels=_e._dataChannels.filter(ga=>ga!==_r),_o)return this._gateway.unsubscribeDataChannel(_o,_e.uid)}),_l.info("[".concat(this._clientId,"] remote user ").concat(Vt," unpublished datachannel ,id:").concat(_r.id)),this.safeEmit(S_.USER_UNPUBLISHED,_e,"datachannel",_r._config))})}_handleRemoveDataChannels(o){const s=this._users.find(d=>d.uid===o.uid);if(s){if(s._dataChannels!==void 0&&s._dataChannels.length>0){_l.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(o.uid));const d=()=>{_l.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished datachannel")),s._dataChannels.forEach(g=>{this.safeEmit(S_.USER_UNPUBLISHED,s,"datachannel",g._config)})};this._p2pChannel.unsubscribeDataChannel(s,s._dataChannels).then(g=>{if(g)return this._gateway.unsubscribeDataChannel(g,s.uid)}),d()}}else _l.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(_S.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(_S.CONNECTION_STATE_CHANGE,(o,s,d)=>{var g;if(d===y_.FALLBACK)return;const b=()=>{this.safeEmit(S_.CONNECTION_STATE_CHANGE,o,s,d)};if(t_.reportApiInvoke(this._sessionId||((g=this._gateway.joinInfo)===null||g===void 0?void 0:g.sid)||null,{name:NS.CONNECTION_STATE_CHANGE,options:[o,s,d],tag:hS.TRACER}).onSuccess(JSON.stringify({cur:o,prev:s,reason:d})),_l.info("[".concat(this._clientId,"] connection state change: ").concat(s," -> ").concat(o)),o==="DISCONNECTED")return this._reset(),void b();if(o==="RECONNECTING")this._users.forEach(Vt=>{Vt._trust_in_room_=!1,Vt._trust_audio_enabled_state_=!1,Vt._trust_video_enabled_state_=!1,Vt._trust_audio_mute_state_=!1,Vt._trust_video_mute_state_=!1,Vt._trust_audio_stream_added_state_=!1,Vt._trust_video_stream_added_state_=!1,Vt._is_pre_created||(Vt._audio_pre_subscribed||(Vt._audioSSRC=void 0,Vt._audioOrtc=void 0),Vt._video_pre_subscribed||(Vt._videoSSRC=void 0,Vt._videoOrtc=void 0,Vt._rtxSsrcId=void 0),Vt._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(o==="CONNECTED"){var $;this._streamFallbackTypeCacheMap.forEach((Vt,zt)=>{this._gateway.setStreamFallbackOption(zt,Vt).catch(_e=>{_l.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_e)})}),this._remoteStreamTypeCacheMap.forEach((Vt,zt)=>{this._gateway.setRemoteVideoStreamType(zt,Vt).catch(_e=>{_l.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_e)})}),this._remoteDefaultVideoStreamType!==void 0&&(($=this._joinInfo)===null||$===void 0?void 0:$.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{_l.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(Vt=>{_l.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(Vt))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(Vt=>!Vt._trust_in_room_).forEach(Vt=>{_l.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(Vt.uid)),this._handleUserOffline({uid:Vt.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(Vt=>{Vt._trust_audio_mute_state_||(_l.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(Vt.uid)),this._handleMuteStream(Vt.uid,_g.AUDIO,!1)),Vt._trust_video_mute_state_||(_l.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(Vt.uid)),this._handleMuteStream(Vt.uid,_g.VIDEO,!1)),Vt._trust_audio_enabled_state_||(_l.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(Vt.uid)),this._handleSetStreamLocalEnable("audio",Vt.uid,!0)),Vt._trust_video_enabled_state_||(_l.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(Vt.uid)),this._handleSetStreamLocalEnable("video",Vt.uid,!0)),Vt._trust_video_stream_added_state_||(_l.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(Vt.uid)),this._handleResetAddStream(Vt,"video")),Vt._trust_audio_stream_added_state_||(_l.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(Vt.uid)),this._handleResetAddStream(Vt,"audio")),Vt._video_added_||Vt._audio_added_||(_l.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(Vt.uid)),this._handleRemoveStream({uid:Vt.uid,uint_id:Vt._uintid}))}))},1e3))}b()}),this._gateway.on(_S.REQUEST_NEW_GATEWAY_LIST,async(o,s)=>{if(!this._joinInfo)return s(new EE(rE.UNEXPECTED_ERROR,"can not recover, no join info"));try{let d;this._joinInfo.recoverPreloadCache?(d=this._joinInfo.recoverPreloadCache.ap,cX(this._joinInfo.recoverPreloadCache),this._joinInfo.recoverPreloadCache=void 0):d=await eF(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||CS,this.store),this._joinInfo&&(this._joinInfo.apResponse=d.gatewayInfo.res,this._joinInfo.gatewayAddrs=d.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=d.gatewayInfo.uni_lbs_ip);const g=[];d.gatewayInfo.gatewayAddrs.forEach(b=>{let{address:$}=b;const[Vt,zt]=$.split(":");this._joinInfo&&this._joinInfo.proxyServer?g.push({proxy:this._joinInfo.proxyServer,host:Vt,port:zt}):g.push({host:Vt,port:zt})}),o(g)}catch(d){s(d)}}),this._gateway.on(_S.NETWORK_QUALITY,o=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(S_.NETWORK_QUALITY,o)}),this._gateway.on(_S.STREAM_TYPE_CHANGE,(o,s)=>{this.safeEmit(S_.STREAM_TYPE_CHANGED,o,s),t_.reportApiInvoke(this._sessionId,{name:NS.STREAM_TYPE_CHANGE,options:[o,s],tag:hS.TRACER}).onSuccess(JSON.stringify({uid:o,streamType:s}))}),this._gateway.on(_S.IS_P2P_DISCONNECTED,o=>{this._p2pChannel.isP2PDisconnected()?o(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?o(!1):o(!0)}),this._gateway.on(_S.NEED_RENEW_SESSION,async o=>{if(o==="recover"&&this._joinInfo){const s=await oX(h0(h0({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));this._joinInfo.recoverPreloadCache=s,this._startSession(s==null?void 0:s.sid)}else this._startSession()}),this._gateway.on(_S.REQUEST_P2P_CONNECTION_PARAMS,async(o,s,d)=>{try{s(await this._p2pChannel.startP2PConnection(o))}catch(g){d(g)}}),this._gateway.on(_S.JOIN_RESPONSE,(o,s)=>{if(this.store.useP2P)return;const{dtlsParameters:d,iceParameters:g,candidates:b,rtpCapabilities:$,setup:Vt,cname:zt}=B9(o.ortc,s);this._p2pChannel.connect(g,d,b,$,Vt,zt)}),this._gateway.on(_S.REQUEST_DC_CONNECTION_PARAMS,o=>{o(this._p2pChannel.getEstablishParams())}),this._gateway.on(_S.RESET_SIGNAL,o=>{this._p2pChannel.resetConnection(o),this._handleGatewaySignalEvents()}),this._gateway.on(_S.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(_S.DATACHANNEL_PRECONNECT,async(o,s,d,g)=>{var b,$,Vt,zt,_e,_r;await this._p2pChannel.startP2PConnection({turnServer:(b=this._joinInfo)===null||b===void 0?void 0:b.turnServer},!0);const _o=function(ga,_a){let _c;return _a&&_a.ip&&typeof _a.port=="number"?(_c=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:_a.ip,port:_a.port.toString(),type:"host",extension:{}}],_l.debug("Using remote candidate from AP ".concat(_a.ip,":").concat(_a.port)),_a.ip6&&(_c.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:_a.ip6,port:_a.port.toString(),type:"host",extension:{}}),_l.debug("Using IPV6 remote candidate from AP ".concat(_a.ip6,":").concat(_a.port)))):_c=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:ga.ip,port:ga.port.toString(),type:"host",extension:{}}],_c}(o,s);return this._p2pChannel.preConnect({iceUfrag:"".concat(($=this._joinInfo)===null||$===void 0?void 0:$.apResponse.cid,"_").concat((Vt=this._joinInfo)===null||Vt===void 0?void 0:Vt.apResponse.cert),icePwd:"".concat((zt=this._joinInfo)===null||zt===void 0?void 0:zt.apResponse.cid,"_").concat((_e=this._joinInfo)===null||_e===void 0?void 0:_e.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(_r=cE("FINGERPRINT"))!==null&&_r!==void 0?_r:o.fingerprint}]},_o,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(d).catch(g)})}_handleGatewaySignalEvents(){this._gateway.signal.on(d_.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(d_.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(d_.ON_ADD_AUDIO_STREAM,o=>this._handleAddAudioOrVideoStream("audio",o.uid,o.ssrcId,o.cname,o.uint_id,o.ortc)),this._gateway.signal.on(d_.ON_ADD_VIDEO_STREAM,o=>this._handleAddAudioOrVideoStream("video",o.uid,o.ssrcId,o.cname,o.uint_id,o.ortc,o.rtxSsrcId)),this._gateway.signal.on(d_.ON_REMOTE_DATASTREAM_UPDATE,o=>{this._handleUpdateDataChannel(o)}),this._gateway.signal.on(d_.ON_REMOTE_FULL_DATASTREAM_INFO,o=>{this._handleUpdateDataChannel({added:o.datastreams,deleted:[]},!0)}),this._gateway.signal.on(d_.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(d_.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(d_.MUTE_AUDIO,o=>this._handleMuteStream(o.uid,_g.AUDIO,!0)),this._gateway.signal.on(d_.UNMUTE_AUDIO,o=>this._handleMuteStream(o.uid,_g.AUDIO,!1)),this._gateway.signal.on(d_.MUTE_VIDEO,o=>this._handleMuteStream(o.uid,_g.VIDEO,!0)),this._gateway.signal.on(d_.UNMUTE_VIDEO,o=>this._handleMuteStream(o.uid,_g.VIDEO,!1)),this._gateway.signal.on(d_.RECEIVE_METADATA,o=>{const s=BI(o.metadata);this.safeEmit(S_.RECEIVE_METADATA,o.uid,s)}),this._gateway.signal.on(d_.ON_DATA_STREAM,async o=>{var s;if(!o)return;let d=BI(o.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&KE(s=["aes-128-gcm2","aes-256-gcm2"]).call(s,this._encryptionMode)){if(o.payload.length<GO)throw new EE(rE.UNEXPECTED_RESPONSE,"payload length ".concat(o.payload.length," is less than header length ").concat(GO));d=await async function($,Vt,zt){const _e=zt.subarray(0,GO),_r=_e.slice(8,GO),_o=(_r[0]<<8)+_r[1],ga=(_e[6]<<8)+_e[7],_a=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:$,tagLength:l4,additionalData:new Uint8Array(a4(_o,2))},Vt,zt.subarray(GO));return new Uint8Array(_a).subarray(0,ga)}(this._encryptDataStreamIv,this._encryptDataStreamKey,d)}let g=0;if(o.ordered||o.syncWithAudio){const b=this._p2pChannel.getStats(),$=this.remoteUsers.find(zt=>zt.uid===o.uid),Vt=b==null?void 0:b.audioRecv.find(zt=>zt.ssrc===($==null?void 0:$._audioSSRC));g=Vt==null?void 0:Vt.jitterBufferMs}g==null&&(g=0),Fht(h0(h0({},o),{},{payload:d}),g,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(d_.ON_CRYPT_ERROR,()=>{eI(()=>{_l.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(S_.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(d_.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(d_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{_l.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,y_.TOKEN_EXPIRE),this.safeEmit(S_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(d_.ON_STREAM_FALLBACK_UPDATE,o=>{_l.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(o.stream_id,", attr: ").concat(o.stream_type)),this.safeEmit(S_.STREAM_FALLBACK,o.stream_id,o.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(d_.ON_PUBLISH_STREAM,o=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:o.proxy})),_l.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(o))))}),this._gateway.signal.on(d_.ENABLE_LOCAL_VIDEO,o=>{this._handleSetStreamLocalEnable("video",o.uid,!0)}),this._gateway.signal.on(d_.DISABLE_LOCAL_VIDEO,o=>{this._handleSetStreamLocalEnable("video",o.uid,!1)}),this._gateway.signal.on(XE.REQUEST_TIMEOUT,(o,s)=>{if(this._joinInfo)switch(o){case n_.PUBLISH:{if(!s)return;const b=s.ortc;if(b){var d,g;const $=b.some(_e=>{let{stream_type:_r}=_e;return _r===x_.Audio}),Vt=b.some(_e=>{let{stream_type:_r}=_e;return _r!==x_.Audio}),zt=b.some(_e=>{let{stream_type:_r}=_e;return _r===x_.Screen||_r===x_.ScreenLow});s.state==="offer"&&t_.publish(this._joinInfo.sid,{eventElapse:aT.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:rE.TIMEOUT,audio:$,video:Vt,p2pid:s.p2p_id,publishRequestid:this.store.pubId,screenshare:zt,audioName:$?(d=b.find(_e=>{let{stream_type:_r}=_e;return _r===x_.Audio}))===null||d===void 0||(d=d.ssrcs[0])===null||d===void 0?void 0:d.ssrcId.toString():void 0,videoName:Vt?(g=b.find(_e=>{let{stream_type:_r}=_e;return _r!==x_.Audio}))===null||g===void 0||(g=g.ssrcs[0])===null||g===void 0?void 0:g.ssrcId.toString():void 0})}break}case n_.SUBSCRIBE:s&&t_.subscribe(this._joinInfo.sid,{succ:!1,ec:rE.TIMEOUT,audio:s.stream_type===_g.AUDIO,video:s.stream_type===_g.VIDEO,peerid:s.stream_id,subscribeRequestid:s.ssrcId,p2pid:this.store.p2pId,eventElapse:aT.measureFromSubscribeStart(this.store.clientId,s.ssrcId)})}}),this._gateway.signal.on(d_.ON_P2P_OK,o=>{this.uid,this._uid}),this._gateway.signal.on(d_.ON_PUBLISHED_USER_LIST,o=>{if(o==null||!o.users)return;cE("BLOCK_LOCAL_CLIENT")&&(o.users=o.users.filter(g=>!WI(g.string_id||g.stream_id,this.channelName)));const s=[],d=[];for(const g of o.users){let b=this._users.find(_o=>_o._uintid===g.stream_id);b?b._trust_in_room_=!0:(b=new _I(g.string_id||g.stream_id,g.stream_id),this._users.push(b),this.getListeners(S_.PUBLISHED_USER_LIST).length===0&&(_l.debug("[".concat(this._clientId,"] user online"),g.stream_id),this.safeEmit(S_.USER_JOINED,b)));const $=qS.Audio&g.stream_type,Vt=(qS.Video|qS.LwoVideo)&g.stream_type,zt=(65280&g.stream_type)!=0,_e=$&&b.hasAudio,_r=Vt&&b.hasVideo;Vt&&(b._trust_video_stream_added_state_=!0,b._video_added_=!0,b._videoSSRC=g.video_ssrc,b._rtxSsrcId=g.video_rtx),$&&(b._trust_audio_stream_added_state_=!0,b._audio_added_=!0,b._audioSSRC=g.audio_ssrc),$&&!_e&&this.getListeners(S_.PUBLISHED_USER_LIST).length===0&&(_l.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published audio")),this.safeEmit(S_.USER_PUBLISHED,b,"audio")),Vt&&!_r&&this.getListeners(S_.PUBLISHED_USER_LIST).length===0&&(_l.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published video")),this.safeEmit(S_.USER_PUBLISHED,b,"video")),($&&!_e||Vt&&!_r||zt)&&s.push(b),Vt&&this._p2pChannel.hasPendingRemoteMedia(b,"video")&&d.push({user:b,mediaType:"video"}),$&&this._p2pChannel.hasPendingRemoteMedia(b,"audio")&&d.push({user:b,mediaType:"audio"})}d.length>0&&(_l.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(d.map(g=>"user: ".concat(g.user.uid,", mediaType: ").concat(g.mediaType)).join("; ")," ")),this.massSubscribe(d).catch(g=>{_l.error("[".concat(this._clientId,"] mass resubscribe error"),g.toString())})),this.getListeners(S_.PUBLISHED_USER_LIST).length>0?cE("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=s:(_l.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(s.map(g=>g.uid).join(", "))),this.safeEmit(S_.PUBLISHED_USER_LIST,s)):_l.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(s.map(g=>g.uid).join(", ")))}),this._gateway.signal.on(d_.ON_RTP_CAPABILITY_CHANGE,o=>{const{video_codec:s}=o;this._p2pChannel instanceof ML&&this._p2pChannel.updateRemoteRTPCapabilities(s.map(d=>d.toLowerCase()).filter(d=>{var g;return KE(g=Object.keys(BO)).call(g,d)}))})}_handleP2PEvents(){this._gateway.signal.on(d_.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(vS.PUBLISH,(o,s,d)=>{const{uid:g}=o;o.forEach(b=>{const{kind:$,ssrcs:Vt,mid:zt,isMuted:_e}=b;this._handleP2PAddAudioOrVideoStream($,g,Vt[0].ssrcId,zt);const _r=this._users.find(_o=>_o.uid===g);return _r&&this._p2pChannel instanceof GT?this._p2pChannel.mockSubscribe(_r,$,Vt[0].ssrcId,zt).then(()=>{s()}).catch(d):s(),this._handleMuteStream(g,$,!!_e)})}),this._gateway.signal.on(vS.CALL,async(o,s,d)=>{if(this._p2pChannel instanceof GT)try{var g;s(await this._p2pChannel.startP2P({turnServer:(g=this._joinInfo)===null||g===void 0?void 0:g.turnServer},o))}catch(b){d(b)}}),this._gateway.signal.on(XE.P2P_CONNECTION,async o=>{this._p2pChannel instanceof GT&&await this._p2pChannel.p2pConnect(o)}),this._gateway.signal.on(vS.UNPUBLISH,async(o,s,d)=>{if(this._p2pChannel instanceof GT){const{unpubMsg:g,uid:b}=o,$=this._users.find(Vt=>Vt.uid===b);if(!$)return _l.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(b)),void s();try{g.forEach(async Vt=>{let{stream_type:zt}=Vt;const _e=zt===x_.Audio?_g.AUDIO:_g.VIDEO;await this._p2pChannel.unsubscribe($,_e),this._handleMuteStream(b,_e,!0)}),s()}catch(Vt){d(Vt)}}}),this._gateway.signal.on(vS.CONTROL,async(o,s)=>{const{action:d}=o;switch(d){case sI.MUTE_LOCAL_VIDEO:this._handleMuteStream(s,_g.VIDEO,!0);break;case sI.MUTE_LOCAL_AUDIO:this._handleMuteStream(s,_g.AUDIO,!0);break;case sI.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",s),this._handleMuteStream(s,_g.VIDEO,!1);break;case sI.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",s),this._handleMuteStream(s,_g.AUDIO,!1)}}),this._gateway.signal.on(vS.RESTART_ICE,async(o,s,d)=>{if(this._p2pChannel instanceof GT)try{const{direction:g,iceParameter:b}=o;g!==vT.SEND_ONLY||b?s(await this._p2pChannel.restartICE(g,b)):(this._p2pChannel.handleDisconnect(g),s())}catch(g){d(g)}}),this._gateway.signal.on(vS.CANDIDATE,o=>{if(this._p2pChannel instanceof GT){const{candidate:s,direction:d}=o;this._p2pChannel.addRemoteCandidate(s,d)}}),this._p2pChannel.on(a_.RequestP2PRestartICE,async(o,s,d)=>{try{const{direction:g}=o;s(await this._gateway.sendExtensionMessage(vS.RESTART_ICE,o,g===vT.SEND_ONLY))}catch(g){d(g)}}),this._p2pChannel.on(a_.LocalCandidate,o=>{this._gateway.sendExtensionMessage(vS.CANDIDATE,JSON.stringify(o),!0)}),this._p2pChannel.on(a_.RequestP2PMuteLocal,async(o,s,d)=>{try{await this._gateway.sendExtensionMessage(vS.CONTROL,o,!0),s()}catch(g){d(g)}}),this._p2pChannel.on(a_.RequestP2PUnmuteRemote,async(o,s,d)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(o,this._joinInfo.stringUid||this._joinInfo.uid),s()}catch(g){g.code===rE.DISCONNECT_P2P?s():d(g)}else s()}),this._p2pChannel.on(a_.RequestP2PMuteRemote,async(o,s,d)=>{if(this._joinInfo)try{await this._gateway.muteRemote(o,this._joinInfo.stringUid||this._joinInfo.uid),s()}catch(g){g.code===rE.DISCONNECT_P2P?s():d(g)}else s()}),this._p2pChannel.on(a_.StateChange,(o,s)=>{s===j_.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(a_.RequestMuteLocal,async(o,s,d)=>{if(this._joinInfo)try{await this._gateway.muteLocal(o,this._joinInfo.stringUid||this._joinInfo.uid),s()}catch(g){g.code===rE.DISCONNECT_P2P?s():d(g)}else s()}),this._p2pChannel.on(a_.RequestUnmuteLocal,async(o,s,d)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(o,this._joinInfo.stringUid||this._joinInfo.uid),s()}catch(g){g.code===rE.DISCONNECT_P2P?s():d(g)}else s()}),this._p2pChannel.on(a_.RequestRePublish,(o,s,d)=>{this.publish(o,!1).then(s).catch(d)}),this._p2pChannel.on(a_.RequestRePublishDataChannel,(o,s,d)=>{GE.all(o.map(async g=>{await this._p2pChannel.publishDataChannel([g]);const b={streamId:g.id,ordered:g.ordered,maxRetransmits:g.maxRetransmits,metadata:g.metadata,channelId:g._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,b,!0)}catch($){if($.code!==rE.DISCONNECT_P2P)throw $}})).then(s).catch(d)}),this._p2pChannel.on(a_.RequestReSubscribe,async(o,s,d)=>{try{for(const{user:g,kind:b}of o)b===_g.VIDEO?await this.subscribe(g,"video"):await this.subscribe(g,"audio");s()}catch(g){d(g)}}),this._p2pChannel.on(a_.RequestUpload,(o,s)=>{this._gateway.upload(o,s)}),this._p2pChannel.on(a_.RequestUploadStats,o=>{this._gateway.uploadWRTCStats(o)}),this._p2pChannel.on(a_.MediaReconnectStart,o=>{this.safeEmit(S_.MEDIA_RECONNECT_START,o)}),this._p2pChannel.on(a_.MediaReconnectEnd,o=>{this.safeEmit(S_.MEDIA_RECONNECT_END,o)}),this._p2pChannel.on(a_.NeedSignalRTT,o=>{o(this._gateway.getSignalRTT())}),this._p2pChannel.on(a_.RequestRestartICE,async o=>{if(this._p2pChannel instanceof GT)return;const s=await this._p2pChannel.restartICE(o),d=await s.next();if(d.done)return;const g=d.value;let b;try{b=await this._gateway.restartICE({iceParameters:g})}catch(Vt){return void s.throw(Vt)}const{iceParameters:$}=function(Vt){const zt=Vt.iceParameters;return{iceParameters:{iceUfrag:zt.iceUfrag,icePwd:zt.icePwd}}}(b);await s.next({remoteIceParameters:$})}),this._p2pChannel.on(a_.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(a_.RequestReconnectPC,async()=>{var o;const{iceParameters:s,dtlsParameters:d,rtpCapabilities:g}=await this._p2pChannel.startP2PConnection({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer}),{gatewayEstablishParams:b,gatewayAddress:$}=await this._gateway.reconnectPC({iceParameters:s,dtlsParameters:d,rtpCapabilities:g}),{dtlsParameters:Vt,iceParameters:zt,candidates:_e,rtpCapabilities:_r,setup:_o,cname:ga}=B9(b,$);await this._p2pChannel.connect(zt,Vt,_e,_r,_o,ga),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(a_.RequestUnpublishForReconnectPC,async(o,s,d)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(o,this._uid),s()):d()}),this._p2pChannel.on(a_.P2PLost,()=>{this.safeEmit(S_.P2P_LOST,this.store.uid)}),this._p2pChannel.on(a_.UpdateVideoEncoder,o=>{o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig)}),this._p2pChannel.on(a_.ConnectionTypeChange,o=>{this.safeEmit(S_.IS_USING_CLOUD_PROXY,o)}),this._p2pChannel.on(a_.RequestLowStreamParameter,o=>{o(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(a_.QueryClientConnectionState,o=>{o(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(o){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new EE(rE.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!o)throw new EE(rE.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!o.inspectType||!Array.isArray(o.inspectType))throw new EE(rE.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const s=[...new Set(o.inspectType)];s.forEach(d=>{var g;if(!KE(g=["supervise","moderation"]).call(g,d))throw new EE(rE.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(d," is not a valid inspect type."))}),o.inspectType=s}if(o&&o.extraInfo&&o.extraInfo.length>1024)throw new EE(rE.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const s=new xL(o);this._inspect=s,this.handleVideoInspectEvents(this._inspect),await s.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},CS)}catch(s){throw Array.isArray(s)?s[0]:s}}async disableContentInspect(){if(!this._inspect)throw new EE(rE.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}async setImageModeration(o,s){if(NR(o,"enabled"),o){if(!s)throw new EE(rE.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(W_(s.interval,"interval",1e3,1/0),s&&s.extraInfo&&s.extraInfo.length>1024)throw new EE(rE.INVALID_PARAMS,"[".concat(this._clientId,"] config.extraInfo length cannot exceed 1024 bytes"));if(s&&s.vendor&&s.vendor.length>1024)throw new EE(rE.INVALID_PARAMS,"[".concat(this._clientId,"] config.vendor length cannot exceed 1024 bytes"));if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new EE(rE.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(s);const d=new wG(s);this._moderation=d,this.handleImageModerationEvents(this._moderation),await d.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},CS)}catch(d){throw Array.isArray(d)?d[0]:d}}else{if(!this._moderation)throw new EE(rE.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(d){throw Array.isArray(d)?d[0]:d}}}setP2PTransport(o){if(function(s){VS(s,"transport",["default","auto","relay","sd-rtn"])}(o),this.mode!=="p2p")throw new EE(rE.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=o,_l.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(o))}handleImageModerationEvents(o){o.on(H0.CONNECTION_STATE_CHANGE,(s,d)=>{if(this.safeEmit(S_.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,s,d),s===s0.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new EE(rE.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");o.inspectImage()}}),o.on(H0.CLIENT_LOCAL_VIDEO_TRACK,s=>{s(this.localTracks.filter(d=>d.trackMediaType==="video")[0])})}handleVideoInspectEvents(o){o.on(JS.CONNECTION_STATE_CHANGE,(s,d)=>{if(this.safeEmit(S_.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,s,d),d===S0.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(S_.CONTENT_INSPECT_ERROR,new EE(rE.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));o.inspectImage()}}),o.on(JS.INSPECT_RESULT,(s,d)=>{var g;if((d==null?void 0:d.code)===rE.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return _l.debug("Stop inspect content because that has left channel"),this==null||(g=this._inspect)===null||g===void 0||g.close(),void(this._inspect=void 0);this.safeEmit(S_.CONTENT_INSPECT_RESULT,s,d)}),o.on(JS.CLIENT_LOCAL_VIDEO_TRACK,s=>{s(this.localTracks.filter(d=>d.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return _l.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(o){NR(o,"enabled"),q_("ENABLE_PUBLISH_AUDIO_FILTER",o),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(o)}_handleResetAddStream(o,s){switch(s){case"audio":o._audio_added_=!1,o._trust_audio_stream_added_state_=!0;break;case"video":o._video_added_=!1,o._trust_video_stream_added_state_=!0}}},BE(zE.prototype,"leave",[dX],Object.getOwnPropertyDescriptor(zE.prototype,"leave"),zE.prototype),BE(zE.prototype,"publish",[hX],Object.getOwnPropertyDescriptor(zE.prototype,"publish"),zE.prototype),BE(zE.prototype,"unpublish",[pX],Object.getOwnPropertyDescriptor(zE.prototype,"unpublish"),zE.prototype),BE(zE.prototype,"subscribe",[fX],Object.getOwnPropertyDescriptor(zE.prototype,"subscribe"),zE.prototype),BE(zE.prototype,"presubscribe",[mX],Object.getOwnPropertyDescriptor(zE.prototype,"presubscribe"),zE.prototype),BE(zE.prototype,"massSubscribe",[EX],Object.getOwnPropertyDescriptor(zE.prototype,"massSubscribe"),zE.prototype),BE(zE.prototype,"unsubscribe",[gX],Object.getOwnPropertyDescriptor(zE.prototype,"unsubscribe"),zE.prototype),BE(zE.prototype,"massUnsubscribe",[_X],Object.getOwnPropertyDescriptor(zE.prototype,"massUnsubscribe"),zE.prototype),BE(zE.prototype,"setLowStreamParameter",[vX],Object.getOwnPropertyDescriptor(zE.prototype,"setLowStreamParameter"),zE.prototype),BE(zE.prototype,"enableDualStream",[yX],Object.getOwnPropertyDescriptor(zE.prototype,"enableDualStream"),zE.prototype),BE(zE.prototype,"disableDualStream",[SX],Object.getOwnPropertyDescriptor(zE.prototype,"disableDualStream"),zE.prototype),BE(zE.prototype,"setClientRole",[TX],Object.getOwnPropertyDescriptor(zE.prototype,"setClientRole"),zE.prototype),BE(zE.prototype,"setProxyServer",[bX],Object.getOwnPropertyDescriptor(zE.prototype,"setProxyServer"),zE.prototype),BE(zE.prototype,"setTurnServer",[RX],Object.getOwnPropertyDescriptor(zE.prototype,"setTurnServer"),zE.prototype),BE(zE.prototype,"setLicense",[CX],Object.getOwnPropertyDescriptor(zE.prototype,"setLicense"),zE.prototype),BE(zE.prototype,"startProxyServer",[wX],Object.getOwnPropertyDescriptor(zE.prototype,"startProxyServer"),zE.prototype),BE(zE.prototype,"stopProxyServer",[IX],Object.getOwnPropertyDescriptor(zE.prototype,"stopProxyServer"),zE.prototype),BE(zE.prototype,"setLocalAccessPointsV2",[OX],Object.getOwnPropertyDescriptor(zE.prototype,"setLocalAccessPointsV2"),zE.prototype),BE(zE.prototype,"setLocalAccessPoints",[AX],Object.getOwnPropertyDescriptor(zE.prototype,"setLocalAccessPoints"),zE.prototype),BE(zE.prototype,"setRemoteDefaultVideoStreamType",[NX],Object.getOwnPropertyDescriptor(zE.prototype,"setRemoteDefaultVideoStreamType"),zE.prototype),BE(zE.prototype,"setRemoteVideoStreamType",[kX],Object.getOwnPropertyDescriptor(zE.prototype,"setRemoteVideoStreamType"),zE.prototype),BE(zE.prototype,"setStreamFallbackOption",[PX],Object.getOwnPropertyDescriptor(zE.prototype,"setStreamFallbackOption"),zE.prototype),BE(zE.prototype,"setEncryptionConfig",[DX],Object.getOwnPropertyDescriptor(zE.prototype,"setEncryptionConfig"),zE.prototype),BE(zE.prototype,"renewToken",[LX],Object.getOwnPropertyDescriptor(zE.prototype,"renewToken"),zE.prototype),BE(zE.prototype,"enableAudioVolumeIndicator",[MX],Object.getOwnPropertyDescriptor(zE.prototype,"enableAudioVolumeIndicator"),zE.prototype),BE(zE.prototype,"startLiveStreaming",[xX],Object.getOwnPropertyDescriptor(zE.prototype,"startLiveStreaming"),zE.prototype),BE(zE.prototype,"setLiveTranscoding",[UX],Object.getOwnPropertyDescriptor(zE.prototype,"setLiveTranscoding"),zE.prototype),BE(zE.prototype,"stopLiveStreaming",[jX],Object.getOwnPropertyDescriptor(zE.prototype,"stopLiveStreaming"),zE.prototype),BE(zE.prototype,"addInjectStreamUrl",[VX],Object.getOwnPropertyDescriptor(zE.prototype,"addInjectStreamUrl"),zE.prototype),BE(zE.prototype,"removeInjectStreamUrl",[FX],Object.getOwnPropertyDescriptor(zE.prototype,"removeInjectStreamUrl"),zE.prototype),BE(zE.prototype,"startChannelMediaRelay",[BX],Object.getOwnPropertyDescriptor(zE.prototype,"startChannelMediaRelay"),zE.prototype),BE(zE.prototype,"updateChannelMediaRelay",[GX],Object.getOwnPropertyDescriptor(zE.prototype,"updateChannelMediaRelay"),zE.prototype),BE(zE.prototype,"stopChannelMediaRelay",[WX],Object.getOwnPropertyDescriptor(zE.prototype,"stopChannelMediaRelay"),zE.prototype),BE(zE.prototype,"sendCustomReportMessage",[qX],Object.getOwnPropertyDescriptor(zE.prototype,"sendCustomReportMessage"),zE.prototype),BE(zE.prototype,"pickSVCLayer",[HX],Object.getOwnPropertyDescriptor(zE.prototype,"pickSVCLayer"),zE.prototype),BE(zE.prototype,"setRTMConfig",[KX],Object.getOwnPropertyDescriptor(zE.prototype,"setRTMConfig"),zE.prototype),BE(zE.prototype,"enableContentInspect",[zX],Object.getOwnPropertyDescriptor(zE.prototype,"enableContentInspect"),zE.prototype),BE(zE.prototype,"disableContentInspect",[YX],Object.getOwnPropertyDescriptor(zE.prototype,"disableContentInspect"),zE.prototype),BE(zE.prototype,"setImageModeration",[JX],Object.getOwnPropertyDescriptor(zE.prototype,"setImageModeration"),zE.prototype),BE(zE.prototype,"setP2PTransport",[XX],Object.getOwnPropertyDescriptor(zE.prototype,"setP2PTransport"),zE.prototype),BE(zE.prototype,"getJoinChannelServiceRecords",[QX],Object.getOwnPropertyDescriptor(zE.prototype,"getJoinChannelServiceRecords"),zE.prototype),BE(zE.prototype,"setPublishAudioFilterEnabled",[ZX],Object.getOwnPropertyDescriptor(zE.prototype,"setPublishAudioFilterEnabled"),zE.prototype),zE);class zP{constructor(s,d){Qm(this,"id",0),Qm(this,"element",void 0),Qm(this,"peerPair",void 0),Qm(this,"context",void 0),Qm(this,"audioPlayerElement",void 0),Qm(this,"audioTrack",void 0),zP.count+=1,this.id=zP.count,this.element=s,this.context=d}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=s=>{const d=document.createElement("audio");d.srcObject=new MediaStream([s.track]),d.play(),this.audioPlayerElement=d}}async switchSdp(){if(!this.peerPair)return;const s=async(g,b)=>{const $=b==="offer"?await g.createOffer():await g.createAnswer();return await g.setLocalDescription($),g.iceGatheringState==="complete"?g.localDescription:new GE(Vt=>{g.onicegatheringstatechange=()=>{g.iceGatheringState==="complete"&&Vt(g.localDescription)}})},d=async(g,b)=>await g.setRemoteDescription(b);try{const g=await s(this.peerPair[0],"offer");await d(this.peerPair[1],g);const b=await s(this.peerPair[1],"answer");await d(this.peerPair[0],b)}catch(g){throw new EE(rE.LOCAL_AEC_ERROR,g.toString()).print()}}async getTracksFromMediaElement(s){if(this.audioTrack)return this.audioTrack;let d;try{s instanceof HTMLVideoElement&&(s.captureStream?s.captureStream():s.mozCaptureStream()),d=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(s).connect(d)}catch(b){throw new EE(rE.LOCAL_AEC_ERROR,b.toString()).print()}if(!d)throw new EE(rE.LOCAL_AEC_ERROR,"no dest node when local aec").print();const g=d.stream.getAudioTracks()[0];return this.audioTrack=g,g}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const s=this.element,d=await this.getTracksFromMediaElement(s);this.peerPair&&this.peerPair[0].addTrack(d),await this.switchSdp()}close(){_l.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(s=>{s.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var tQ,GL;Qm(zP,"count",0);const Kht=window.AudioContext||window.webkitAudioContext,zht=new(tQ=s_({report:t_}),BE((GL=class{constructor(){Qm(this,"units",[]),Qm(this,"context",void 0)}processExternalMediaAEC(o){if(!this._doesEnvironmentNeedAEC())return _l.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Kht);let s=this.units.find(d=>d&&d.getElement()===o);return s||(s=new zP(o,this.context),this.units.push(s)),s.startEchoCancellation(),_l.debug("start processing local audio echo cancellation, id is",s.id),s.id}_doesEnvironmentNeedAEC(){return O_().name!==M_.SAFARI}}).prototype,"processExternalMediaAEC",[tQ],Object.getOwnPropertyDescriptor(GL.prototype,"processExternalMediaAEC"),GL.prototype),GL);function eQ(o,s){var d=Object.keys(o);if(Object.getOwnPropertySymbols){var g=Object.getOwnPropertySymbols(o);s&&(g=g.filter(function(b){return Object.getOwnPropertyDescriptor(o,b).enumerable})),d.push.apply(d,g)}return d}function nQ(o){for(var s=1;s<arguments.length;s++){var d=arguments[s]!=null?arguments[s]:{};s%2?eQ(Object(d),!0).forEach(function(g){Qm(o,g,d[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(d)):eQ(Object(d)).forEach(function(g){Object.defineProperty(o,g,Object.getOwnPropertyDescriptor(d,g))})}return o}const DG=window||document;function rQ(o){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!DG)return;const d=DS._cspEventHandlerPointer;if(d&&s)return void console.error(d,s);const g=b=>{if(!(b&&b.blockedURI&&(DS.onSecurityPolicyViolation||DS.getListeners(pR.SECURITY_POLICY_VIOLATION).length>0)))return;const $=b.blockedURI;cE("CSP_DETECTED_HOSTNAME_LIST").some(Vt=>KE($).call($,Vt))&&(DS.onSecurityPolicyViolation&&typeof DS.onSecurityPolicyViolation=="function"&&DS.onSecurityPolicyViolation(b),DS.getListeners(pR.SECURITY_POLICY_VIOLATION).length>0&&DS.safeEmit(pR.SECURITY_POLICY_VIOLATION,b))};d&&DG.removeEventListener("securitypolicyviolation",d),(s||o&&typeof o=="function"||DS.getListeners(pR.SECURITY_POLICY_VIOLATION).length>0)&&DG.addEventListener("securitypolicyviolation",g),DS._cspEventHandlerPointer=g}q_("PROCESS_ID","process-".concat(z_(8,""),"-").concat(z_(4,""),"-").concat(z_(4,""),"-").concat(z_(4,""),"-").concat(z_(12,""))),function(){let o;try{o=window.localStorage.getItem("websdk_ng_global_parameter")}catch(s){return void _l.error("Error loading sdk config",s.message)}if(o)try{const s=JSON.parse(window.atob(o)),d=Date.now();_l.debug("Loading global parameters from cache",s),Object.keys(s).forEach(g=>{if(Object.prototype.hasOwnProperty.call(xS,g)){const{value:b,expires:$}=s[g];if($&&$<=d)return;rI[g]=b,xS[g]=b}})}catch(s){_l.error("Error loading mutableParamsCache: ".concat(o),s.message)}}(),Array.isArray(rI.AREAS)&&rI.AREAS.length>0&&JV(rI.AREAS,!0);const iQ=(o,s,d)=>{_l.debug("setParameter key:".concat(o,", value:").concat(JSON.stringify(s))),q_(o,s,d)},DS=function(o){const s=new nS,d=o,g={getListeners:s.getListeners.bind(s),on:(b,$)=>(function(Vt,zt){Vt===pR.SECURITY_POLICY_VIOLATION&&rQ(zt,!0)}(b,$),s.on.bind(s)(b,$)),addListener:s.addListener.bind(s),once:s.once.bind(s),off:s.off.bind(s),removeAllListeners:s.removeAllListeners.bind(s),emit:s.emit.bind(s),safeEmit:s.safeEmit.bind(s)};return nQ(nQ({},d),g)}({__TRACK_LIST__:aN,VERSION:i0,BUILD:PV,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:iQ,getParameter:cE,getSupportedCodec:async function(){let o={audio:[],video:[]};try{let s=new RTCPeerConnection;const d=await async function(g){let b;return R_().supportUnifiedPlan?(g.addTransceiver("video",{direction:"recvonly"}),g.addTransceiver("audio",{direction:"recvonly"}),b=(await g.createOffer()).sdp):b=(await g.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,b}(s);if(!d)return o;s.close(),s=null,o=function(g){const b={video:[],audio:[]};return g.match(/ VP8/i)&&b.video.push("VP8"),g.match(/ VP9/i)&&b.video.push("VP9"),g.match(/ AV1/i)&&b.video.push("AV1"),g.match(/ H264/i)&&b.video.push("H264"),g.match(/ H265/i)&&b.video.push("H265"),g.match(/ opus/i)&&b.audio.push("OPUS"),g.match(/ PCMU/i)&&b.audio.push("PCMU"),g.match(/ PCMA/i)&&b.audio.push("PCMA"),g.match(/ G722/i)&&b.audio.push("G722"),b}(d)}catch(s){throw new EE(rE.CREATE_OFFER_FAILED,s.toString&&s.toString()).print()}return o},checkSystemRequirements:function(){const o=t_.reportApiInvoke(null,{name:NS.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:hS.TRACER});let s=!1;try{const $=window.RTCPeerConnection,Vt=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,zt=window.WebSocket;s=!!($&&Vt&&zt),s&&yV()&&function(_e){const _r=O_();return!(_r.name!==M_.CHROME||!_r.osVersion)&&Number(_r.version)<_e}(75)&&new $().close()}catch($){return _l.error("check system requirement failed: ",$),!1}let d=!1;const g=O_();g.name===M_.CHROME&&Number(g.version)>=58&&(G0.engine.name!=="WebKit"||function(){const $=O_();if(_D()){if($.os===BS.MAC_OS)return!0;if($.os===BS.IOS){const Vt=G0.os.version&&G0.os.version.split(".");if(Vt&&Number(Vt[0])===14&&Vt[1]&&Number(Vt[1])>=3||Vt&&Number(Vt[0])>14)return!0}}return!1}())&&(d=!0),(g.name===M_.FIREFOX&&Number(g.version)>=56||g.name===M_.OPERA&&Number(g.version)>=45||g.name===M_.SAFARI&&Number(g.version)>=11||g.name==="WebKit"&&(oT()||v0())&&g.osVersion&&Number(g.osVersion.split(".")[0])>=11||G8()||O_().name===M_.QQ)&&(d=!0),_l.debug("checkSystemRequirements, api:",s,"browser",d);const b=s&&d;return o.onSuccess(b),b},getDevices:function(o){return ZT.enumerateDevices(!0,!0,o)},getMicrophones:function(o){return ZT.getRecordingDevices(o)},getCameras:function(o){return ZT.getCamerasDevices(o)},getElectronScreenSources:kY,getPlaybackDevices:function(o){return ZT.getSpeakers(o)},createClient:function(){var o;let s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const d=t_.reportApiInvoke(null,{name:NS.CREATE_CLIENT,options:[s],tag:hS.TRACER});try{(function(g){VS(g.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),VS(g.mode,"config.mode",["rtc","live","p2p"]),g.audioCodec!==void 0&&VS(g.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),g.proxyServer!==void 0&&QS(g.proxyServer,"config.proxyServer",1,1e4),g.turnServer!==void 0&&Z8(g.turnServer),g.httpRetryConfig!==void 0&&Q8(g.httpRetryConfig),g.websocketRetryConfig!==void 0&&Q8(g.websocketRetryConfig)})(s)}catch(g){throw d.onError(g),g}return(x8(16,0)||U8(16,0))&&(s.codec==="vp9"&&(s.codec="vp8",_l.debug("browser not support vp9, force use vp8")),q_("UNSUPPORTED_VIDEO_CODEC",["vp9"])),s.audioCodec===void 0&&(s.audioCodec="opus"),d.onSuccess(),new Hht(h0(h0({forceWaitGatewayResponse:!0},s),{},{role:KE(o=["rtc","p2p"]).call(o,s.mode)?"host":s.role||"audience"}))},createCameraVideoTrack:async function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=cE("CAMERA_CAPTURE_CONFIG"),d=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.CREATE_CAM_VIDEO_TRACK,options:[rS({},o),s]});s&&(o.encoderConfig=s);const g=fL(o),b=z_(8,"track-cam-");let $=null;const Vt=o.encoderConfig==="720p_auto";_l.info("start create camera video track with config",JSON.stringify(o),"trackId",b);try{$=(await QT({video:g},b)).getVideoTracks()[0]||null}catch(_e){throw d.onError(_e),_e}if(!$){const _e=new TE(rE.UNEXPECTED_ERROR,"can not find track in media stream");return d.onError(_e),_e.throw(_l)}o.optimizationMode&&nG(b,$,o,vR(o.encoderConfig));const zt=new eG($,o,g,o.scalabiltyMode?lL(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,b);return Vt&&zt.startMonitorStats(),d.onSuccess(zt.getTrackId()),_l.info("create camera video success, trackId:",b),zt},createCustomVideoTrack:function(o){const s=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.CREATE_CUSTOM_VIDEO_TRACK,options:[o]}),d=new Y_(o.mediaStreamTrack,{width:o.width,height:o.height,frameRate:o.frameRate,bitrateMax:o.bitrateMax,bitrateMin:o.bitrateMin},o.scalabiltyMode?lL(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,z_(8,"track-cus-"),[Z_.CUSTOM_TRACK]);return s.onSuccess(d.getTrackId()),_l.info("create custom video track success with config",o,"trackId",d.getTrackId()),d},createScreenVideoTrack:async function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const d=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.CREATE_SCREEN_VIDEO_TRACK,options:[rS({},o),s]}),g=o.encoderConfig==="720p_auto";o.encoderConfig?typeof o.encoderConfig=="string"||o.encoderConfig.width&&o.encoderConfig.height||(o.encoderConfig.width={max:1920},o.encoderConfig.height={max:1080}):o.encoderConfig="1080p_2";const b=function(ga){const _a={};ga.screenSourceType&&(_a.mediaSource=ga.screenSourceType),ga.extensionId&&_w()&&(_a.extensionId=ga.extensionId);const{displaySurface:_c,selfBrowserSurface:tE,surfaceSwitching:_p,systemAudio:_f}=ga;(_V(107)||L8(107)||j8(93))&&(_c&&(VS(_c,"displaySurface",["browser","window","monitor"]),_a.displaySurface=_c),tE?(VS(tE,"selfBrowserSurface",["exclude","include"]),_a.selfBrowserSurface=tE):_a.selfBrowserSurface="include",_p&&(VS(_p,"surfaceSwitching",["exclude","include"]),_a.surfaceSwitching=_p)),(_V(105)||L8(105)||j8(91))&&_f&&(VS(_f,"systemAudio",["exclude","include"]),_a.systemAudio=_f),ga.electronScreenSourceId&&(_a.sourceId=ga.electronScreenSourceId);const eE=ga.encoderConfig?HF(ga.encoderConfig):null;return _a.mandatory={chromeMediaSource:"desktop",maxWidth:eE?eE.width:void 0,maxHeight:eE?eE.height:void 0},eE&&(eE.frameRate&&(typeof eE.frameRate=="number"?(_a.mandatory.maxFrameRate=eE.frameRate,_a.mandatory.minFrameRate=eE.frameRate):(_a.mandatory.maxFrameRate=eE.frameRate.max||eE.frameRate.ideal||eE.frameRate.exact||void 0,_a.mandatory.minFrameRate=eE.frameRate.min||eE.frameRate.ideal||eE.frameRate.exact||void 0),_a.frameRate=eE.frameRate),eE.width&&(_a.width=eE.width),eE.height&&(_a.height=eE.height)),_a}(o),$=z_(8,"track-scr-v-");let Vt=null,zt=null;const _e=R_();if(!_e.supportShareAudio&&s==="enable"){const ga=new TE(rE.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return d.onError(ga),ga.throw(_l)}_l.info("start create screen video track with config",o,"withAudio",s,"trackId",$);try{const ga=await QT({screen:b,screenAudio:s==="auto"?_e.supportShareAudio:s==="enable"},$);Vt=ga.getVideoTracks()[0]||null,zt=ga.getAudioTracks()[0]||null}catch(ga){throw d.onError(ga),ga}if(!Vt){const ga=new TE(rE.UNEXPECTED_ERROR,"can not find track in media stream");return d.onError(ga),ga.throw(_l)}if(!zt&&s==="enable"){Vt&&Vt.stop();const ga=new TE(rE.SHARE_AUDIO_NOT_ALLOWED);return d.onError(ga),ga.throw(_l)}o.optimizationMode||(o.optimizationMode="detail"),o.optimizationMode&&(nG($,Vt,o,o.encoderConfig&&HF(o.encoderConfig)||void 0),o.encoderConfig&&typeof o.encoderConfig!="string"&&(o.encoderConfig.bitrateMin=o.encoderConfig.bitrateMax));const _r=new Y_(Vt,o.encoderConfig?HF(o.encoderConfig):{},o.scalabiltyMode?lL(o.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},o.optimizationMode,$,[Z_.SCREEN_TRACK]);if(g&&_r.startMonitorStats(),!zt)return d.onSuccess(_r.getTrackId()),_l.info("create screen video track success","video:",_r.getTrackId()),_r;const _o=new mS(zt,void 0,z_(8,"track-scr-a-"),!1);return d.onSuccess([_r.getTrackId(),_o.getTrackId()]),_l.info("create screen video track success","video:",_r.getTrackId(),"audio:",_o.getTrackId()),[_r,_o]},createMicrophoneAndCameraTracks:async function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const d=cE("CAMERA_CAPTURE_CONFIG"),g=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.CREATE_MIC_AND_CAM_TRACKS,options:[o,s,d]});d&&(s.encoderConfig=d);const b=s.encoderConfig==="720p_auto",$=fL(s),Vt=BY(o),zt=z_(8,"track-mic-"),_e=z_(8,"track-cam-");let _r=null,_o=null;_l.info("start create camera video track(".concat(_e,") and microphone audio track(").concat(zt,") with config, audio: ").concat(JSON.stringify(o),", video: ").concat(JSON.stringify(s)));try{const _c=await QT({audio:Vt,video:$},"".concat(zt,"-").concat(_e));_r=_c.getAudioTracks()[0],_o=_c.getVideoTracks()[0]}catch(_c){throw g.onError(_c),_c}if(!_r||!_o){const _c=new TE(rE.UNEXPECTED_ERROR,"can not find tracks in media stream");return g.onError(_c),_c.throw(_l)}s.optimizationMode&&nG(_e,_o,s,vR(s.encoderConfig));const ga=new mL(_r,o,Vt,zt),_a=new eG(_o,s,$,s.scalabiltyMode?lL(s.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},s.optimizationMode,_e);return b&&_a.startMonitorStats(),g.onSuccess([ga.getTrackId(),_a.getTrackId()]),_l.info("create camera video track(".concat(_e,") and microphone audio track(").concat(zt,") success")),[ga,_a]},createMicrophoneAudioTrack:async function(){let o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.CREATE_MIC_AUDIO_TRACK,options:[o]}),d=BY(o),g=z_(8,"track-mic-");let b=null;_l.info("start create microphone audio track with config",JSON.stringify(o),"trackId",g);try{b=(await QT({audio:d},g)).getAudioTracks()[0]||null}catch(Vt){throw s.onError(Vt),Vt}if(!b){const Vt=new TE(rE.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(Vt),Vt.throw(_l)}const $=new mL(b,o,d,g);return s.onSuccess($.getTrackId()),_l.info("create microphone audio track success, trackId:",g),$},createCustomAudioTrack:function(o){const s=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.CREATE_CUSTOM_AUDIO_TRACK,options:[o]}),d=new mS(o.mediaStreamTrack,o.encoderConfig?dL(o.encoderConfig):{},z_(8,"track-cus-"),!1);return _l.info("create custom audio track success with config",o,"trackId",d.getTrackId()),s.onSuccess(d.getTrackId()),d},createBufferSourceAudioTrack:async function(o){var s;const{cacheOnlineFile:d,encoderConfig:g}=o;let{source:b}=o;const $={source:b instanceof AudioBuffer?"AudioBuffer":b instanceof File?(s=File.name)!==null&&s!==void 0?s:"File":b,cacheOnlineFile:d,encoderConfig:g},Vt=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.CREATE_BUFFER_AUDIO_TRACK,options:[$]});if(cE("DISABLE_WEBAUDIO"))throw new TE(rE.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const zt=z_(8,"track-buf-");_l.info("start create buffer source audio track with config",JSON.stringify($),"trackId",zt);const _e=b;if(!(b instanceof AudioBuffer))try{b=await async function(ga,_a){let _c=null;if(typeof ga=="string"){const _p=I7.get(ga);if(_p)return _l.debug("use cached audio resource: ",ga),_p;try{_c=(await W0(()=>RT.get(ga,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(_f){throw new TE(rE.FETCH_AUDIO_FILE_FAILED,_f.toString())}}else _c=await new GE((_f,eE)=>{const iE=new FileReader;iE.onload=fE=>{fE.target?_f(fE.target.result):eE(new TE(rE.READ_LOCAL_AUDIO_FILE_ERROR))},iE.onerror=()=>{eE(new TE(rE.READ_LOCAL_AUDIO_FILE_ERROR))},iE.readAsArrayBuffer(ga)});const tE=await function(_p){const _f=hN();return new GE((eE,iE)=>{_f.decodeAudioData(_p,fE=>{eE(fE)},fE=>{iE(new TE(rE.DECODE_AUDIO_FILE_FAILED,fE.toString()))})})}(_c);return typeof ga=="string"&&_a&&I7.set(ga,tE),tE}(b,d)}catch(ga){return Vt.onError(ga),ga.throw(_l)}const _r=new Bdt(b),_o=new Fdt(_e,_r,g?dL(g):{},zt);return _l.info("create buffer source audio track success, trackId:",zt),Vt.onSuccess(_o.getTrackId()),_o},setAppType:function(o){if(_l.debug("setAppType: ".concat(o)),!(Number.isInteger(o)&&o>=0))throw _l.debug("Invalid appType"),new EE(rE.INVALID_PARAMS,"invalid app type",o);q_("APP_TYPE",Math.floor(o))},setLogLevel:function(o){_l.setLogLevel(o)},enableLogUpload:function(){cE("USE_NEW_LOG")?q_("UPLOAD_LOG",!0):_l.enableLogUpload()},disableLogUpload:function(){cE("USE_NEW_LOG")?q_("UPLOAD_LOG",!1):_l.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new hJ},checkAudioTrackIsActive:async function(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const d=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[s]});if(!(o instanceof mS||o instanceof mN)){const _e=new EE(rE.INVALID_TRACK,"the parameter is not a audio track");return d.onError(_e),_e.throw()}s&&s<1e3&&(s=1e3);const g=o instanceof mS?o.getTrackLabel():"remote_track",b=o.getVolumeLevel();let $=b,Vt=b;const zt=Date.now();return new GE(_e=>{const _r=setInterval(()=>{const _o=o.getVolumeLevel();$=_o>$?_o:$,Vt=_o<Vt?_o:Vt;const ga=$-Vt>1e-4,_a=Date.now()-zt;if(ga||_a>s){clearInterval(_r);const _c=ga,tE={duration:_a,deviceLabel:g,maxVolumeLevel:$,result:_c};_l.info("[track-".concat(o.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(tE))),d.onSuccess(tE),_e(_c)}},200)})},checkVideoTrackIsActive:async function(o){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const d=t_.reportApiInvoke(null,{tag:hS.TRACER,name:NS.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[s]});if(!(o instanceof Y_||o instanceof fN)){const ga=new EE(rE.INVALID_TRACK,"the parameter is not a video track");return d.onError(ga),ga.throw()}s&&s<1e3&&(s=1e3);const g=o instanceof Y_?o.getTrackLabel():"remote_track",b=o.getMediaStreamTrack(!0),$=document.createElement("video");$.style.width="1px",$.style.height="1px",$.setAttribute("muted",""),$.muted=!0,$.setAttribute("playsinline",""),$.controls=!1,(GS()||_D())&&($.style.opacity="0.01",$.style.position="fixed",$.style.left="0",$.style.top="0",document.body.appendChild($)),$.srcObject=new MediaStream([b]),$.play();const Vt=document.createElement("canvas");Vt.width=160,Vt.height=120;let zt=0,_e=0;try{const ga=Date.now();zt=await function(_a,_c,tE,_p){let _f,eE=0,iE=null;return new GE((fE,mE)=>{function _E(){eE>_p&&_f&&(_f(),fE(eE));const SE=tE.getContext("2d");if(!SE){const DE=new EE(rE.UNEXPECTED_ERROR,"can not get canvas 2d context.");return _l.error(DE.toString()),void mE(DE)}SE.drawImage(_a,0,0,160,120);const wE=SE.getImageData(0,0,tE.width,tE.height),NE=Math.floor(wE.data.length/3);if(iE){for(let DE=0;DE<NE;DE+=3)if(wE.data[DE]!==iE[DE])return eE+=1,void(iE=wE.data);iE=wE.data}else iE=wE.data}setTimeout(()=>{_f&&(_f(),fE(eE))},_c),_f=XF(()=>{_E()},30)})}($,s,Vt,4),_e=Date.now()-ga}catch(ga){throw d.onError(ga),ga}Bht===M_.SAFARI&&($.pause(),$.remove()),$.srcObject=null;const _r=zt>4,_o={duration:_e,changedPicNum:zt,deviceLabel:g,result:_r};return _l.info("[track-".concat(o.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_o))),d.onSuccess(_o),_r},setArea:JV,audioElementPlayCenter:wT,resumeAudioContext:function(){wT.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(o){zht.processExternalMediaAEC(o)},registerExtensions:function(o){const s=cE("PLUGIN_INFO")||[];o.forEach(d=>{"name"in d&&!KE(s).call(s,d.name)&&s.push(d.name);const g=d;g.__registered__=!0,g.logger.hookLog=_l.extLog,g.reporter.hookApiInvoke=t_.extApiInvoke,g.parameters&&Object.keys(g.parameters).forEach(b=>{g.parameters[b]=cE(b)})}),iQ("PLUGIN_INFO",s)},ChannelMediaRelayError:qO,ChannelMediaRelayEvent:PR,ChannelMediaRelayState:NT,RemoteStreamFallbackType:Ddt,RemoteStreamType:Pdt,ConnectionDisconnectedReason:y_,AudienceLatencyLevelType:Hat,AREAS:k_,preload:async function(o,s,d,g){return iX(o,s,d,g)}});return Object.defineProperties(DS,{onAudioAutoplayFailed:{get:()=>$T.onAudioAutoplayFailed,set:o=>{$T.onAudioAutoplayFailed=o}},onAutoplayFailed:{get:()=>$T.onAutoplayFailed,set:o=>{$T.onAutoplayFailed=o}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>DS._onSecurityPolicyViolation,set(o){DS._onSecurityPolicyViolation=o,rQ(o)}},__CLIENT_LIST__:{get:()=>cE("SHOW_GLOBAL_CLIENT_LIST")?iI:[]}}),ZT.on(rO.CAMERA_DEVICE_CHANGED,o=>{_l.info("camera device changed",JSON.stringify(o)),DS.onCameraChanged&&DS.onCameraChanged(o),DS.safeEmit(pR.CAMERA_CHANGED,o)}),ZT.on(rO.RECORDING_DEVICE_CHANGED,o=>{_l.info("microphone device changed",JSON.stringify(o)),DS.onMicrophoneChanged&&DS.onMicrophoneChanged(o),DS.safeEmit(pR.MICROPHONE_CHANGED,o)}),ZT.on(rO.PLAYOUT_DEVICE_CHANGED,o=>{_l.debug("playout device changed",JSON.stringify(o)),DS.onPlaybackDeviceChanged&&DS.onPlaybackDeviceChanged(o),DS.safeEmit(pR.PLAYBACK_DEVICE_CHANGED,o)}),wT.onAutoplayFailed=()=>{_l.info("detect audio element autoplay failed"),$T.onAudioAutoplayFailed&&$T.onAudioAutoplayFailed()},B_.on("autoplay-failed",()=>{_l.info("detect webaudio autoplay failed"),$T.onAudioAutoplayFailed&&$T.onAudioAutoplayFailed(),DS.safeEmit(pR.AUTOPLAY_FAILED)}),B_.on(ZS.STATE_CHANGE,(o,s)=>{_l.info("audio context state changed: ".concat(s," => ").concat(o)),DS.onAudioContextStateChanged&&DS.onAudioContextStateChanged(o,s),DS.safeEmit(pR.AUDIO_CONTEXT_STATE_CHANGED,o,s)}),pS.on(jI.NETWORK_STATE_CHANGE,(o,s)=>{_l.info("[network-indicator] network state changed, ".concat(s," => ").concat(o))}),window&&(window.__ARTC__=DS),DS})})(AgoraRTC_NProduction);var AgoraRTC_NProductionExports=AgoraRTC_NProduction.exports;const AgoraRTC__default=getDefaultExportFromCjs(AgoraRTC_NProductionExports);function _objectWithoutPropertiesLoose(e,i){if(e==null)return{};var h={},_=Object.keys(e),j,_t;for(_t=0;_t<_.length;_t++)j=_[_t],!(i.indexOf(j)>=0)&&(h[j]=e[j]);return h}var AgoraRTCErrorCode;(function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"})(AgoraRTCErrorCode||(AgoraRTCErrorCode={}));var createClient=function(i){var h;function _(){return h||(h=AgoraRTC__default.createClient(i)),h}return function(){return _()}};function createMicrophoneAndCameraTracks(e,i){var h=function(){try{return Promise.resolve(AgoraRTC__default.createMicrophoneAndCameraTracks(e,i)).then(function(_t){return _=_t,_})}catch(_t){return Promise.reject(_t)}},_=null;return function(){var _t=reactExports.useState(!1),Wt=_t[0],_n=_t[1],_i=reactExports.useState(null),_s=_i[0],_u=_i[1],_h=reactExports.useRef(_);return reactExports.useEffect(function(){return _h.current===null?h().then(function(_d){_h.current=_d,_n(!0)},function(_d){_u(_d)}):_n(!0),function(){_=null}},[]),{ready:Wt,tracks:_h.current,error:_s}}}var AgoraVideoPlayer=function(i){var h=reactExports.useRef(null),_=i.videoTrack,j=i.config,_t=_objectWithoutPropertiesLoose(i,["videoTrack","config"]);return reactExports.useLayoutEffect(function(){return h.current!==null&&_.play(h.current,j),function(){_.stop()}},[_]),React.createElement("div",Object.assign({},_t,{ref:h}))},agoraRtmSdk={exports:{}};agoraRtmSdk.exports;(function(module,exports){var define_process_env_default={};/*
 @preserve
 AgoraRTM Web SDK 1.4.3-203 - commit: v1.4.3-17-g1e27aa38
 Copyright (C) 2018-2021 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/(function(e,i){module.exports=i()})(commonjsGlobal,function(){function be(e,i){var h=Object.keys(e);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(e,j).enumerable})),h.push.apply(h,_)}return h}function ua(e){for(var i=1;i<arguments.length;i++){var h=arguments[i]!=null?arguments[i]:{};i%2?be(Object(h),!0).forEach(function(_){m(e,_,h[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(h)):be(Object(h)).forEach(function(_){Object.defineProperty(e,_,Object.getOwnPropertyDescriptor(h,_))})}return e}function X(e){return(X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(e)}function sl(e,i,h,_,j,_t,Wt){try{var _n=e[_t](Wt),_i=_n.value}catch(_s){return void h(_s)}_n.done?i(_i):Promise.resolve(_i).then(_,j)}function J(e){return function(){var i=this,h=arguments;return new Promise(function(_,j){function _t(_i){sl(_n,_,j,_t,Wt,"next",_i)}function Wt(_i){sl(_n,_,j,_t,Wt,"throw",_i)}var _n=e.apply(i,h);_t(void 0)})}}function W(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function tl(e,i){for(var h=0;h<i.length;h++){var _=i[h];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(e,_.key,_)}}function Ha(e,i,h){return i&&tl(e.prototype,i),h&&tl(e,h),e}function m(e,i,h){return i in e?Object.defineProperty(e,i,{value:h,enumerable:!0,configurable:!0,writable:!0}):e[i]=h,e}function la(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&df(e,i)}function wd(e){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)})(e)}function df(e,i){return(df=Object.setPrototypeOf||function(h,_){return h.__proto__=_,h})(e,i)}function ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sh(e,i,h){return(Sh=ul()?Reflect.construct:function(_,j,_t){var Wt=[null];return Wt.push.apply(Wt,j),_=new(Function.bind.apply(_,Wt)),_t&&df(_,_t.prototype),_}).apply(null,arguments)}function ef(e){var i=typeof Map=="function"?new Map:void 0;return(ef=function(h){function _(){return Sh(h,arguments,wd(this).constructor)}if(h===null||Function.toString.call(h).indexOf("[native code]")===-1)return h;if(typeof h!="function")throw new TypeError("Super expression must either be null or a function");if(i!==void 0){if(i.has(h))return i.get(h);i.set(h,_)}return _.prototype=Object.create(h.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),df(_,h)})(e)}function ff(e,i){if(e==null)return{};if(e==null)var h={};else{h={};var _,j=Object.keys(e);for(_=0;_<j.length;_++){var _t=j[_];0<=i.indexOf(_t)||(h[_t]=e[_t])}}if(Object.getOwnPropertySymbols)for(_=Object.getOwnPropertySymbols(e),_t=0;_t<_.length;_t++)j=_[_t],0<=i.indexOf(j)||Object.prototype.propertyIsEnumerable.call(e,j)&&(h[j]=e[j]);return h}function n(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ma(e){var i=ul();return function(){var h=wd(e);if(i){var _=wd(this).constructor;h=Reflect.construct(h,arguments,_)}else h=h.apply(this,arguments);return h=!h||typeof h!="object"&&typeof h!="function"?n(this):h}}function Th(e,i,h){return(Th=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(_,j,_t){for(;!Object.prototype.hasOwnProperty.call(_,j)&&(_=wd(_))!==null;);if(_)return(j=Object.getOwnPropertyDescriptor(_,j)).get?j.get.call(_t):j.value})(e,i,h||e)}function ra(e,i){var h=Array.isArray(e)?e:void 0;if(!h)if((h=e&&(typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"]))==null)h=void 0;else{var _,j=[],_t=!0,Wt=!1;try{for(h=h.call(e);!(_t=(_=h.next()).done)&&(j.push(_.value),!i||j.length!==i);_t=!0);}catch(_i){Wt=!0;var _n=_i}finally{try{_t||h.return==null||h.return()}finally{if(Wt)throw _n}}h=j}if(!(e=h||vl(e,i)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return e}function G(e){var i=Array.isArray(e)?Uh(e):void 0;if(i||(i=typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null?Array.from(e):void 0),!(e=i||vl(e)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return e}function vl(e,i){if(e){if(typeof e=="string")return Uh(e,i);var h=Object.prototype.toString.call(e).slice(8,-1);if(h==="Object"&&e.constructor&&(h=e.constructor.name),h==="Map"||h==="Set")return Array.from(e);if(h==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return Uh(e,i)}}function Uh(e,i){(i==null||i>e.length)&&(i=e.length);for(var h=0,_=Array(i);h<i;h++)_[h]=e[h];return _}function fa(e,i,h,_,j){var _t={};return Object.keys(_).forEach(function(Wt){_t[Wt]=_[Wt]}),_t.enumerable=!!_t.enumerable,_t.configurable=!!_t.configurable,("value"in _t||_t.initializer)&&(_t.writable=!0),_t=h.slice().reverse().reduce(function(Wt,_n){return _n(e,i,Wt)||Wt},_t),j&&_t.initializer!==void 0&&(_t.value=_t.initializer?_t.initializer.call(j):void 0,_t.initializer=void 0),_t.initializer===void 0&&(Object.defineProperty(e,i,_t),_t=null),_t}function $a(e){var i={exports:{}};return e(i,i.exports),i.exports}function wl(e,i){var h,_=3>arguments.length?e:arguments[2];return va(e)===_?e[i]:(h=Fb.f(e,i))?Q(h,"value")?h.value:h.get===void 0?void 0:h.get.call(_):ha(h=Vb(e))?wl(h,i,_):void 0}function rs(e){var i=e.charCodeAt(0)<<24,h=0|ss(~i),_=0,j=0|e.length,_t="";if(5>h&&j>=h){for(i=i<<h>>>24+h,_=1;_<h;_=_+1|0)i=i<<6|63&e.charCodeAt(_);65535>=i?_t+=xd(i):1114111>=i?_t+=xd(55296+((i=i-65536|0)>>10)|0,56320+(1023&i)|0):_=0}for(;_<j;_=_+1|0)_t+="";return _t}function xl(){}function ts(e){var i=0|e.charCodeAt(0);if(55296<=i&&56319>=i){var h=0|e.charCodeAt(1);if(!(h==h&&56320<=h&&57343>=h))return xd(239,191,189);if(65535<(i=(i-55296<<10)+h-56320+65536|0))return xd(240|i>>>18,128|i>>>12&63,128|i>>>6&63,128|63&i)}return 127>=i?e:2047>=i?xd(192|i>>>6,128|63&i):xd(224|i>>>12,128|i>>>6&63,128|63&i)}function yl(){}function ea(){ea.init.call(this)}function ng(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+X(e))}function zl(e,i,h,_){ng(h);var j=e._events;if(j===void 0)j=e._events=Object.create(null),e._eventsCount=0;else{j.newListener!==void 0&&(e.emit("newListener",i,h.listener?h.listener:h),j=e._events);var _t=j[i]}return _t===void 0?(j[i]=h,++e._eventsCount):(typeof _t=="function"?_t=j[i]=_?[h,_t]:[_t,h]:_?_t.unshift(h):_t.push(h),0<(h=e._maxListeners===void 0?ea.defaultMaxListeners:e._maxListeners)&&_t.length>h&&!_t.warned&&(_t.warned=!0,(h=Error("Possible EventEmitter memory leak detected. "+_t.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",h.emitter=e,h.type=i,h.count=_t.length,console&&console.warn&&console.warn(h))),e}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(e,i,h){return e={fired:!1,wrapFn:void 0,target:e,type:i,listener:h},(i=us.bind(e)).listener=h,e.wrapFn=i}function Bl(e,i,h){if((e=e._events)===void 0)return[];if((i=e[i])===void 0)return[];if(typeof i=="function")return h?[i.listener||i]:[i];if(h)for(h=Array(i.length),e=0;e<h.length;++e)h[e]=i[e].listener||i[e];else h=Cl(i,i.length);return h}function Dl(e){var i=this._events;if(i!==void 0){if(typeof(e=i[e])=="function")return 1;if(e!==void 0)return e.length}return 0}function Cl(e,i){for(var h=Array(i),_=0;_<i;++_)h[_]=e[_];return h}function vs(e,i,h){typeof e.on=="function"&&El(e,"error",i,h)}function El(e,i,h,_){if(typeof e.on=="function")_.once?e.once(i,h):e.on(i,h);else{if(typeof e.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(e));e.addEventListener(i,function j(_t){_.once&&e.removeEventListener(i,j),h(_t)})}}function ws(e){return e?G(e):xs(function(){return[]},function(i,h){return i.push(h),i})}function Fl(e,i){var h,_,j,_t;return w.wrap(function(Wt){for(;;)switch(Wt.prev=Wt.next){case 0:h=Gl(e)([Hl,Hl,function(_n,_i){return _i}])[2],_=0;case 2:if(!(_<i.length)){Wt.next=17;break}if(j=i[_],!((_t=h(Vh,j))instanceof og)){Wt.next=11;break}if((_t=Wh(_t.deref()))===Vh){Wt.next=10;break}return Wt.next=10,_t;case 10:return Wt.abrupt("return");case 11:if(_t===Vh){Wt.next=14;break}return Wt.next=14,_t;case 14:_++,Wt.next=2;break;case 17:case"end":return Wt.stop()}},ys)}function pg(e,i){return i!=null&&typeof i[Symbol.iterator]=="function"?Fl(pg(e),i):function(h){var _=h[2];return zs(h,function(j,_t){return _(j,e(_t))})}}function Ac(e){return Object.prototype.toString.call(e).slice(8,-1)}function yd(e){return Ac(e)==="Object"&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Il(e){var i;return(i=Ac(e)==="Boolean"||Ac(e)==="Null"||Ac(e)==="Undefined")||(i=Ac(e)==="Number"&&!isNaN(e)),i||Ac(e)==="String"||Ac(e)==="Symbol"}function zd(e){var i=-1,h=e==null?0:e.length;for(this.clear();++i<h;){var _=e[i];this.set(_[0],_[1])}}function ce(e){var i=-1,h=e==null?0:e.length;for(this.clear();++i<h;){var _=e[i];this.set(_[0],_[1])}}function de(e){var i=-1,h=e==null?0:e.length;for(this.clear();++i<h;){var _=e[i];this.set(_[0],_[1])}}function gf(e){var i=-1,h=e==null?0:e.length;for(this.__data__=new qg;++i<h;)this.add(e[i])}function ee(e){this.size=(this.__data__=new rg(e)).size}function fe(e,i,h,_,j,_t){var Wt,_n=1&i,_i=2&i,_s=4&i;if(h&&(Wt=j?h(e,_,j,_t):h(e)),Wt!==void 0)return Wt;if(!lb(e))return e;if(_=Va(e)){if(Wt=As(e),!_n)return Xh(e,Wt)}else{var _u=hf(e),_h=_u=="[object Function]"||_u=="[object GeneratorFunction]";if(jf(e))return Jl(e,_n);if(_u=="[object Object]"||_u=="[object Arguments]"||_h&&!j){if(Wt=_i||_h?{}:Kl(e),!_n)return _i?Bs(e,Cs(Wt,e)):Ds(e,Es(Wt,e))}else{if(!wa[_u])return j?e:{};Wt=Fs(e,_u,_n)}}if(_t||(_t=new ge),j=_t.get(e))return j;_t.set(e,Wt),Gs(e)?e.forEach(function(nE){Wt.add(fe(nE,i,h,nE,e,_t))}):Hs(e)&&e.forEach(function(nE,aE){Wt.set(aE,fe(nE,i,h,aE,e,_t))}),_i=_s?_i?Ll:Yh:_i?kf:Ad;var _d=_?void 0:_i(e);return Is(_d||e,function(nE,aE){_d&&(nE=e[aE=nE]),Ml(Wt,aE,fe(nE,i,h,aE,e,_t))}),Wt}function Zh(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new TypeError("Expected a function");var h=function _(){var j=arguments,_t=i?i.apply(this,j):j[0],Wt=_.cache;return Wt.has(_t)?Wt.get(_t):(j=e.apply(this,j),_.cache=Wt.set(_t,j)||Wt,j)};return h.cache=new(Zh.Cache||qg),h}function Nl(e){if(typeof e=="string")return e;if(Va(e))return he(e,Nl)+"";if(ie(e))return Ol?Ol.call(e):"";var i=e+"";return i=="0"&&1/e==-Js?"-0":i}function $h(e,i,h,_,j){var _t=-1,Wt=e.length;for(h||(h=Ks),j||(j=[]);++_t<Wt;){var _n=e[_t];h(_n)?ai(j,_n):j[j.length]=_n}return j}function je(e,i,h,_,j){if(e===i)i=!0;else if(e==null||i==null||!gc(e)&&!gc(i))i=e!=e&&i!=i;else t:{var _t=Va(e),Wt=Va(i),_n=_t?"[object Array]":hf(e),_i=Wt?"[object Array]":hf(i),_s=(_n=_n=="[object Arguments]"?"[object Object]":_n)=="[object Object]";if(Wt=(_i=_i=="[object Arguments]"?"[object Object]":_i)=="[object Object]",(_i=_n==_i)&&jf(e)){if(!jf(i)){i=!1;break t}_t=!0,_s=!1}if(_i&&!_s)j||(j=new ge),i=_t||bi(e)?Pl(e,i,h,_,je,j):Ls(e,i,_n,h,_,je,j);else{if(!(1&h)&&(_t=_s&&Ql.call(e,"__wrapped__"),_n=Wt&&Ql.call(i,"__wrapped__"),_t||_n)){e=_t?e.value():e,i=_n?i.value():i,j||(j=new ge),i=je(e,i,h,_,j);break t}if(_i)e:if(j||(j=new ge),_t=1&h,_n=Yh(e),Wt=_n.length,_i=Yh(i).length,Wt==_i||_t){for(_i=Wt;_i--;){var _u=_n[_i];if(!(_t?_u in i:Ms.call(i,_u))){i=!1;break e}}if(_s=j.get(e),_u=j.get(i),_s&&_u)i=_s==i&&_u==e;else{_s=!0,j.set(e,i),j.set(i,e);for(var _h=_t;++_i<Wt;){var _d=e[_u=_n[_i]],nE=i[_u];if(_)var aE=_t?_(nE,_d,_u,i,e,j):_(_d,nE,_u,e,i,j);if(aE===void 0?_d!==nE&&!je(_d,nE,h,_,j):!aE){_s=!1;break}_h||(_h=_u=="constructor")}_s&&!_h&&(h=e.constructor)!=(_=i.constructor)&&"constructor"in e&&"constructor"in i&&!(typeof h=="function"&&h instanceof h&&typeof _=="function"&&_ instanceof _)&&(_s=!1),j.delete(e),j.delete(i),i=_s}}else i=!1;else i=!1}}return i}function xa(e,i,h){this.low=0|e,this.high=0|i,this.unsigned=!!h}function mb(e){return(e&&e.__isLong__)===!0}function Bd(e,i){var h;if(i){if((i=0<=(e>>>=0)&&256>e)&&(h=Rl[e]))return h;h=ya(e,0>(0|e)?-1:0,!0),i&&(Rl[e]=h)}else{if((i=-128<=(e|=0)&&128>e)&&(h=Sl[e]))return h;h=ya(e,0>e?-1:0,!1),i&&(Sl[e]=h)}return h}function Gb(e,i){if(isNaN(e))return i?Cd:Hb;if(i){if(0>e)return Cd;if(e>=Tl)return Ul}else{if(e<=-Vl)return nb;if(e+1>=Vl)return Wl}return 0>e?Gb(-e,i).neg():ya(e%ke|0,e/ke|0,i)}function ya(e,i,h){return new xa(e,i,h)}function ci(e,i,h){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return Hb;if(typeof i=="number"?(h=i,i=!1):i=!!i,2>(h=h||10)||36<h)throw RangeError("radix");var _;if(0<(_=e.indexOf("-")))throw Error("interior hyphen");if(_===0)return ci(e.substring(1),i,h).neg();_=Gb(sg(h,8));for(var j=Hb,_t=0;_t<e.length;_t+=8){var Wt=Math.min(8,e.length-_t),_n=parseInt(e.substring(_t,_t+Wt),h);8>Wt?(Wt=Gb(sg(h,Wt)),j=j.mul(Wt).add(Gb(_n))):j=(j=j.mul(_)).add(Gb(_n))}return j.unsigned=i,j}function Wb(e,i){return typeof e=="number"?Gb(e,i):typeof e=="string"?ci(e,i):ya(e.low,e.high,typeof i=="boolean"?i:e.unsigned)}function O(e,i){function h(){this.constructor=e}di(e,i),e.prototype=i===null?Object.create(i):(h.prototype=i.prototype,new h)}function le(e){return typeof e=="function"}function me(e){setTimeout(function(){throw e},0)}function ei(e){return e!==null&&X(e)==="object"}function Xl(e){return e.reduce(function(i,h){return i.concat(h instanceof lf?h.errors:h)},[])}function fi(e){for(;e;){var i=e.destination,h=e.isStopped;if(e.closed||h)return!1;e=i&&i instanceof ia?i:null}return!0}function Yc(e){return e}function gi(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return Yl(e)}function Yl(e){return e.length===0?Yc:e.length===1?e[0]:function(i){return e.reduce(function(h,_){return _(h)},i)}}function Zl(e){if(e||(e=Ib.Promise||Promise),!e)throw Error("no Promise impl found");return e}function $l(){return function(e){return e.lift(new Ns(e))}}function mf(e){return e?Os(e):vb}function Os(e){return new Y(function(i){return e.schedule(function(){return i.complete()})})}function Zc(e){return e&&typeof e.schedule=="function"}function hi(e,i){return new Y(function(h){var _=new Oa,j=0;return _.add(i.schedule(function(){j===e.length?h.complete():(h.next(e[j++]),h.closed||_.add(this.schedule()))})),_})}function nf(e,i){return i?hi(e,i):new Y(am(e))}function bb(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return Zc(i=e[e.length-1])?(e.pop(),hi(e,i)):nf(e)}function Z(e,i){return new Y(i?function(h){return i.schedule(Ps,0,{error:e,subscriber:h})}:function(h){return h.error(e)})}function Ps(e){e.subscriber.error(e.error)}function Qs(e,i){return i===void 0&&(i=0),function(h){return h.lift(new Rs(e,i))}}function bm(e){return e in ii&&(delete ii[e],!0)}function hc(){}function ba(e,i){return function(h){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return h.lift(new Ss(e,i))}}function cm(e,i,h){if(i){if(!Zc(i))return function(){for(var _=[],j=0;j<arguments.length;j++)_[j]=arguments[j];return cm(e,h).apply(void 0,_).pipe(ba(function(_t){return Jb(_t)?i.apply(void 0,_t):i(_t)}))};h=i}return function(){for(var _=[],j=0;j<arguments.length;j++)_[j]=arguments[j];var _t,Wt=this,_n={context:Wt,subject:_t,callbackFunc:e,scheduler:h};return new Y(function(_i){if(h)return h.schedule(Ts,0,{args:_,subscriber:_i,params:_n});if(!_t){_t=new of;try{e.apply(Wt,_.concat([function(){for(var _s=[],_u=0;_u<arguments.length;_u++)_s[_u]=arguments[_u];_t.next(1>=_s.length?_s[0]:_s),_t.complete()}]))}catch(_s){fi(_t)?_t.error(_s):console.warn(_s)}}return _t.subscribe(_i)})}}function Ts(e){var i=this,h=e.args,_=e.subscriber,j=e.params;e=j.callbackFunc;var _t=j.context,Wt=j.scheduler,_n=j.subject;if(!_n){_n=j.subject=new of,j=function(){for(var _i=[],_s=0;_s<arguments.length;_s++)_i[_s]=arguments[_s];i.add(Wt.schedule(Us,0,{value:1>=_i.length?_i[0]:_i,subject:_n}))};try{e.apply(_t,h.concat([j]))}catch(_i){_n.error(_i)}}this.add(_n.subscribe(_))}function Us(e){var i=e.subject;i.next(e.value),i.complete()}function dm(e,i,h){if(i){if(!Zc(i))return function(){for(var _=[],j=0;j<arguments.length;j++)_[j]=arguments[j];return dm(e,h).apply(void 0,_).pipe(ba(function(_t){return Jb(_t)?i.apply(void 0,_t):i(_t)}))};h=i}return function(){for(var _=[],j=0;j<arguments.length;j++)_[j]=arguments[j];var _t={subject:void 0,args:_,callbackFunc:e,scheduler:h,context:this};return new Y(function(Wt){var _n=_t.context,_i=_t.subject;if(h)return h.schedule(Vs,0,{params:_t,subscriber:Wt,context:_n});if(!_i){_i=_t.subject=new of;try{e.apply(_n,_.concat([function(){for(var _s=[],_u=0;_u<arguments.length;_u++)_s[_u]=arguments[_u];(_u=_s.shift())?_i.error(_u):(_i.next(1>=_s.length?_s[0]:_s),_i.complete())}]))}catch(_s){fi(_i)?_i.error(_s):console.warn(_s)}}return _i.subscribe(Wt)})}}function Vs(e){var i=this,h=e.params,_=e.subscriber;e=e.context;var j=h.callbackFunc,_t=h.args,Wt=h.scheduler,_n=h.subject;if(!_n){_n=h.subject=new of,h=function(){for(var _i=[],_s=0;_s<arguments.length;_s++)_i[_s]=arguments[_s];(_s=_i.shift())?i.add(Wt.schedule(em,0,{err:_s,subject:_n})):i.add(Wt.schedule(Ws,0,{value:1>=_i.length?_i[0]:_i,subject:_n}))};try{j.apply(e,_t.concat([h]))}catch(_i){this.add(Wt.schedule(em,0,{err:_i,subject:_n}))}}this.add(_n.subscribe(_))}function Ws(e){var i=e.subject;i.next(e.value),i.complete()}function em(e){e.subject.error(e.err)}function fm(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}function ji(e,i,h,_,j){if(j===void 0&&(j=new Xs(e,h,_)),!j.closed)return i instanceof Y?i.subscribe(j):pf(i)(j)}function Ys(e,i){return new Y(function(h){var _=new Oa;return _.add(i.schedule(function(){var j=e[ne]();_.add(j.subscribe({next:function(_t){_.add(i.schedule(function(){return h.next(_t)}))},error:function(_t){_.add(i.schedule(function(){return h.error(_t)}))},complete:function(){_.add(i.schedule(function(){return h.complete()}))}}))})),_})}function Zs(e,i){return new Y(function(h){var _=new Oa;return _.add(i.schedule(function(){return e.then(function(j){_.add(i.schedule(function(){h.next(j),_.add(i.schedule(function(){return h.complete()}))}))},function(j){_.add(i.schedule(function(){return h.error(j)}))})})),_})}function $s(e,i){if(!e)throw Error("Iterable cannot be null");return new Y(function(h){var _,j=new Oa;return j.add(function(){_&&typeof _.return=="function"&&_.return()}),j.add(i.schedule(function(){_=e[$c](),j.add(i.schedule(function(){if(!h.closed){try{var _t=_.next(),Wt=_t.value,_n=_t.done}catch(_i){return void h.error(_i)}_n?h.complete():(h.next(Wt),this.schedule())}}))})),j})}function gm(e,i){if(e!=null){if(e&&typeof e[ne]=="function")return Ys(e,i);if(fm(e))return Zs(e,i);if(hm(e))return hi(e,i);if(e&&typeof e[$c]=="function"||typeof e=="string")return $s(e,i)}throw new TypeError((e!==null&&X(e)||e)+" is not observable")}function Kb(e,i){return i?gm(e,i):e instanceof Y?e:new Y(pf(e))}function ic(e,i){if(!i.closed){if(e instanceof Y)return e.subscribe(i);try{var h=pf(e)(i)}catch(_){i.error(_)}return h}}function cb(e,i,h){return h===void 0&&(h=Number.POSITIVE_INFINITY),typeof i=="function"?function(_){return _.pipe(cb(function(j,_t){return Kb(e(j,_t)).pipe(ba(function(Wt,_n){return i(j,Wt,_t,_n)}))},h))}:(typeof i=="number"&&(h=i),function(_){return _.lift(new at(e,h))})}function tg(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),cb(Yc,e)}function im(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return tg(1)(bb.apply(void 0,e))}function ad(e){return new Y(function(i){try{var h=e()}catch(_){return void i.error(_)}return(h?Kb(h):mf()).subscribe(i)})}function jm(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(e.length===1){var h=e[0];if(Jb(h))return ug(h,null);if(ei(h)&&Object.getPrototypeOf(h)===Object.prototype)return ug((e=Object.keys(h)).map(function(j){return h[j]}),e)}if(typeof e[e.length-1]=="function"){var _=e.pop();return ug(e=e.length===1&&Jb(e[0])?e[0]:e,null).pipe(ba(function(j){return _.apply(void 0,j)}))}return ug(e,null)}function ug(e,i){return new Y(function(h){var _=e.length;if(_===0)h.complete();else for(var j=Array(_),_t=0,Wt=0,_n=function(_s){var _u=Kb(e[_s]),_h=!1;h.add(_u.subscribe({next:function(_d){_h||(_h=!0,Wt++),j[_s]=_d},error:function(_d){return h.error(_d)},complete:function(){++_t!==_&&_h||(Wt===_&&h.next(i?i.reduce(function(_d,nE,aE){return _d[nE]=j[aE],_d},{}):j),h.complete())}}))},_i=0;_i<_;_i++)_n(_i)})}function gb(e,i,h,_){return le(h)&&(_=h,h=void 0),_?gb(e,i,h).pipe(ba(function(j){return Jb(j)?_.apply(void 0,j):_(j)})):new Y(function(j){km(e,i,function(_t){1<arguments.length?j.next(Array.prototype.slice.call(arguments)):j.next(_t)},j,h)})}function km(e,i,h,_,j){if(e&&typeof e.addEventListener=="function"&&typeof e.removeEventListener=="function"){e.addEventListener(i,h,j);var _t=function(){return e.removeEventListener(i,h,j)}}else if(e&&typeof e.on=="function"&&typeof e.off=="function")e.on(i,h),_t=function(){return e.off(i,h)};else if(e&&typeof e.addListener=="function"&&typeof e.removeListener=="function")e.addListener(i,h),_t=function(){return e.removeListener(i,h)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var Wt=0,_n=e.length;Wt<_n;Wt++)km(e[Wt],i,h,_,j)}_.add(_t)}function lm(e,i,h){return h?lm(e,i).pipe(ba(function(_){return Jb(_)?h.apply(void 0,_):h(_)})):new Y(function(_){var j=function(){for(var Wt=[],_n=0;_n<arguments.length;_n++)Wt[_n]=arguments[_n];return _.next(Wt.length===1?Wt[0]:Wt)};try{var _t=e(j)}catch(Wt){return void _.error(Wt)}if(le(i))return function(){return i(j,_t)}})}function bt(e){var i=e.subscriber,h=e.condition;if(!i.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(_t){return void i.error(_t)}else e.needIterate=!0;if(h){var _=void 0;try{_=h(e.state)}catch(_t){return void i.error(_t)}if(!_)return void i.complete();if(i.closed)return}try{var j=e.resultSelector(e.state)}catch(_t){return void i.error(_t)}if(!i.closed&&(i.next(j),!i.closed))return this.schedule(e)}}function ki(e){return!Jb(e)&&0<=e-parseFloat(e)+1}function mm(e,i){return e===void 0&&(e=0),i===void 0&&(i=bd),(!ki(e)||0>e)&&(e=0),i&&typeof i.schedule=="function"||(i=bd),new Y(function(h){return h.add(i.schedule(ct,e,{subscriber:h,counter:0,period:e})),h})}function ct(e){var i=e.subscriber,h=e.counter;e=e.period,i.next(h),this.schedule({subscriber:i,counter:h+1,period:e},e)}function Xb(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];i=Number.POSITIVE_INFINITY;var h=null,_=e[e.length-1];return Zc(_)?(h=e.pop(),1<e.length&&typeof e[e.length-1]=="number"&&(i=e.pop())):typeof _=="number"&&(i=e.pop()),h===null&&e.length===1&&e[0]instanceof Y?e[0]:tg(i)(nf(e,h))}function li(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(e.length===0)return vb;var h=e[0],_=e.slice(1);return e.length===1&&Jb(h)?li.apply(void 0,h):new Y(function(j){var _t=function(){return j.add(li.apply(void 0,_).subscribe(j))};return Kb(h).subscribe({next:function(Wt){j.next(Wt)},error:_t,complete:_t})})}function dt(e){var i=e.keys,h=e.index,_=e.subscriber,j=e.subscription;if(e=e.obj,!_.closed)if(h<i.length){var _t=i[h];_.next([_t,e[_t]]),j.add(this.schedule({keys:i,index:h+1,subscriber:_,subscription:j,obj:e}))}else _.complete()}function et(e,i){function h(){return!h.pred.apply(h.thisArg,arguments)}return h.pred=e,h.thisArg=i,h}function wb(e,i){return function(h){return h.lift(new ft(e,i))}}function Ca(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(e.length===1){if(!Jb(e[0]))return e[0];e=e[0]}return nf(e,void 0).lift(new gt)}function ht(e){var i=e.start,h=e.index,_=e.subscriber;h>=e.count?_.complete():(_.next(i),_.closed||(e.index=h+1,e.start=i+1,this.schedule(e)))}function Bc(e,i,h){e===void 0&&(e=0);var _=-1;return ki(i)?_=1>Number(i)?1:Number(i):Zc(i)&&(h=i),Zc(h)||(h=bd),new Y(function(j){var _t=ki(e)?e:+e-h.now();return h.schedule(it,_t,{index:0,period:_,subscriber:j})})}function it(e){var i=e.index,h=e.period,_=e.subscriber;if(_.next(i),!_.closed){if(h===-1)return _.complete();e.index=i+1,this.schedule(e,h)}}function mi(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return typeof(i=e[e.length-1])=="function"&&e.pop(),nf(e,void 0).lift(new jt(i))}function Ga(e){return function(i){var h=new kt(e);return i=i.lift(h),h.caught=i}}function ni(e,i){return cb(e,i,1)}function nm(e){return e===void 0&&(e=null),function(i){return i.lift(new lt(e))}}function cd(e,i){i===void 0&&(i=bd);var h=e instanceof Date&&!isNaN(+e)?+e-i.now():Math.abs(e);return function(_){return _.lift(new mt(h,i))}}function om(e,i){return function(h){return h.lift(new nt(e,i))}}function Dd(e){return e===void 0&&(e=ot),function(i){return i.lift(new pt(e))}}function ot(){return new vg}function Ka(e){return function(i){return e===0?mf():i.lift(new qt(e))}}function pm(e,i){return i?function(h){return h.pipe(pm(function(_,j){return Kb(e(_,j)).pipe(ba(function(_t,Wt){return i(_,_t,j,Wt)}))}))}:function(h){return h.lift(new rt(e))}}function wg(e){return function(i){return i.lift(new st(e))}}function aa(e,i){var h=2<=arguments.length;return function(_){return _.pipe(e?wb(function(j,_t){return e(j,_t,_)}):Yc,Ka(1),h?nm(i):Dd(function(){return new vg}))}}function tt(){return function(e){return e.lift(new ut)}}function qm(e){return function(i){return e===0?mf():i.lift(new vt(e))}}function qf(e){return function(i){return i.lift(new wt(e))}}function xg(e,i){var h=!1;return 2<=arguments.length&&(h=!0),function(_){return _.lift(new xt(e,i,h))}}function rm(e,i){return 2<=arguments.length?function(h){return gi(xg(e,i),qm(1),nm(i))(h)}:function(h){return gi(xg(function(_,j,_t){return e(_,j,_t+1)}),qm(1))(h)}}function yt(e,i){return function(h){var _=typeof e=="function"?e:function(){return e},j=Object.create(h,At);return j.source=h,j.subjectFactory=_,j}}function oe(e){return function(i){return i.lift(new Bt(e,i))}}function Ct(){return new Pa}function pe(){return function(e){return $l()(yt(Ct)(e))}}function sm(e,i,h){var _=e&&X(e)==="object"?e:{bufferSize:e,windowTime:i,refCount:!1,scheduler:h};return function(j){return j.lift(Dt(_))}}function Dt(e){var i,h,_=e.bufferSize,j=_===void 0?Number.POSITIVE_INFINITY:_,_t=(_=e.windowTime)===void 0?Number.POSITIVE_INFINITY:_,Wt=e.refCount,_n=e.scheduler,_i=0,_s=!1,_u=!1;return function(_h){if(_i++,!i||_s){_s=!1;var _d=(i=new qe(j,_t,_n)).subscribe(this);h=_h.subscribe({next:function(nE){i.next(nE)},error:function(nE){_s=!0,i.error(nE)},complete:function(){_u=!0,h=void 0,i.complete()}}),_u&&(h=void 0)}else _d=i.subscribe(this);this.add(function(){_i--,_d.unsubscribe(),_d=void 0,h&&!_u&&Wt&&_i===0&&(h.unsubscribe(),i=h=void 0)})}}function Cc(e,i){return typeof i=="function"?function(h){return h.pipe(Cc(function(_,j){return Kb(e(_,j)).pipe(ba(function(_t,Wt){return i(_,_t,j,Wt)}))}))}:function(h){return h.lift(new Et(e))}}function ob(e){return function(i){return i.lift(new Ft(e))}}function Gt(e,i){return i===void 0&&(i=!1),function(h){return h.lift(new Ht(e,i))}}function ca(e,i,h){return function(_){return _.lift(new It(e,i,h))}}function Jt(e,i,h){return i===void 0&&(i=bd),h===void 0&&(h=Kt),function(_){return _.lift(new Lt(e,i,h.leading,h.trailing))}}function Mt(e){e.subscriber.clearThrottle()}function Nt(e,i,h){return h===void 0&&(h=bd),function(_){var j=e instanceof Date&&!isNaN(+e),_t=j?+e-h.now():Math.abs(e);return _.lift(new Ot(_t,j,i,h))}}function hb(e,i){return i===void 0&&(i=bd),Nt(e,Z(new pb),i)}function Pt(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return function(h){var _;return typeof e[e.length-1]=="function"&&(_=e.pop()),h.lift(new Qt(e,_))}}function tm(e,i,h,_,j){e!==i&&um(i,function(_t,Wt){if(j||(j=new ge),lb(_t)){_t=j;var _n=oi(e,Wt),_i=oi(i,Wt),_s=_t.get(_i);if(_s)pi(e,Wt,_s);else{var _u=(_s=_?_(_n,_i,Wt+"",e,i,_t):void 0)===void 0;if(_u){var _h=Va(_i),_d=!_h&&jf(_i),nE=!_h&&!_d&&bi(_i);_s=_i,_h||_d||nE?Va(_n)?_s=_n:gc(_n)&&Ed(_n)?_s=Xh(_n):_d?(_u=!1,_s=Jl(_i,!0)):nE?(_u=!1,_s=vm(_i,!0)):_s=[]:wm(_i)||rf(_i)?(_s=_n,rf(_n)?_s=re(_n,kf(_n)):lb(_n)&&!qi(_n)||(_s=Kl(_i))):_u=!1}_u&&(_t.set(_i,_s),tm(_s,_i,h,_,_t),_t.delete(_i)),pi(e,Wt,_s)}}else(_n=_?_(oi(e,Wt),_t,Wt+"",e,i,j):void 0)===void 0&&(_n=_t),pi(e,Wt,_n)},kf)}function Rt(e){var i=1,h=ri;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?i=1>=arguments.length?void 0:arguments[1]:h=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(i=1>=arguments.length?void 0:arguments[1],h=2>=arguments.length?void 0:arguments[2]);var _=i||1;return function(j){return j.pipe(xg(function(_t,Wt){var _n=h.now(),_i=_n-e;if((_t=_t.filter(function(_h){return _h.until>_i})).length>=_){var _s=_t[_t.length-1],_u=_t[0].until+e*Math.floor(_t.length/_);_t.push({delay:_s.until<_n?_u-_n:_u-_s.until,until:_u,value:Wt})}else _t.push({delay:0,until:_n,value:Wt});return _t},[]),ba(function(_t){return _t[_t.length-1]}),ni(function(_t){var Wt=bb(_t.value);return _t.delay?Wt.pipe(cd(_t.delay,h)):Wt}))}}function St(e,i){var h=(i=i===void 0?{protocols:xm,makeWebSocket:ym}:i).protocols,_=h===void 0?xm:h,j=(i=i.makeWebSocket)===void 0?ym:i;return new Y(function(_t){var Wt,_n=new Pa,_i=j(e,_),_s=!1,_u=!1,_h=function(_d){if(Wt)throw _s=!0,_d=Error("Web socket message factory function called more than once"),_t.error(_d),_d;return Wt=_d.subscribe(function(nE){_i.send(nE)}),_n};return _i.onopen=function(){_u?(_s=!0,_i.close()):_t.next(_h)},_i.onmessage=function(_d){_n.next(_d.data)},_i.onerror=function(_d){_s=!0,_t.error(Error(_d.message))},_i.onclose=function(_d){_s||(_s=!0,_u?(_t.complete(),_n.complete()):_t.error(Error(_d.code===1e3?"Normal closure":_d.reason)))},function(){_u=!0,Wt&&Wt.unsubscribe(),_s||(_s=!0,_i.close())}})}function yg(){this._listeners={}}function zm(e){return typeof Float32Array<"u"?function(){function i(_i,_s,_u){_t[0]=_i,_s[_u]=Wt[0],_s[_u+1]=Wt[1],_s[_u+2]=Wt[2],_s[_u+3]=Wt[3]}function h(_i,_s,_u){_t[0]=_i,_s[_u]=Wt[3],_s[_u+1]=Wt[2],_s[_u+2]=Wt[1],_s[_u+3]=Wt[0]}function _(_i,_s){return Wt[0]=_i[_s],Wt[1]=_i[_s+1],Wt[2]=_i[_s+2],Wt[3]=_i[_s+3],_t[0]}function j(_i,_s){return Wt[3]=_i[_s],Wt[2]=_i[_s+1],Wt[1]=_i[_s+2],Wt[0]=_i[_s+3],_t[0]}var _t=new Float32Array([-0]),Wt=new Uint8Array(_t.buffer),_n=Wt[3]===128;e.writeFloatLE=_n?i:h,e.writeFloatBE=_n?h:i,e.readFloatLE=_n?_:j,e.readFloatBE=_n?j:_}():function(){function i(_,j,_t,Wt){var _n=0>j?1:0;if(_n&&(j=-j),j===0)_(0<1/j?0:2147483648,_t,Wt);else if(isNaN(j))_(2143289344,_t,Wt);else if(34028234663852886e22<j)_((_n<<31|2139095040)>>>0,_t,Wt);else if(11754943508222875e-54>j)_((_n<<31|Math.round(j/1401298464324817e-60))>>>0,_t,Wt);else{var _i=Math.floor(Math.log(j)/Math.LN2);_((_n<<31|_i+127<<23|8388607&Math.round(j*Math.pow(2,-_i)*8388608))>>>0,_t,Wt)}}function h(_,j,_t){return _t=_(j,_t),_=2*(_t>>31)+1,j=_t>>>23&255,_t&=8388607,j===255?_t?NaN:1/0*_:j===0?1401298464324817e-60*_*_t:_*Math.pow(2,j-150)*(_t+8388608)}e.writeFloatLE=i.bind(null,Am),e.writeFloatBE=i.bind(null,Bm),e.readFloatLE=h.bind(null,Cm),e.readFloatBE=h.bind(null,Dm)}(),typeof Float64Array<"u"?function(){function i(_i,_s,_u){_t[0]=_i,_s[_u]=Wt[0],_s[_u+1]=Wt[1],_s[_u+2]=Wt[2],_s[_u+3]=Wt[3],_s[_u+4]=Wt[4],_s[_u+5]=Wt[5],_s[_u+6]=Wt[6],_s[_u+7]=Wt[7]}function h(_i,_s,_u){_t[0]=_i,_s[_u]=Wt[7],_s[_u+1]=Wt[6],_s[_u+2]=Wt[5],_s[_u+3]=Wt[4],_s[_u+4]=Wt[3],_s[_u+5]=Wt[2],_s[_u+6]=Wt[1],_s[_u+7]=Wt[0]}function _(_i,_s){return Wt[0]=_i[_s],Wt[1]=_i[_s+1],Wt[2]=_i[_s+2],Wt[3]=_i[_s+3],Wt[4]=_i[_s+4],Wt[5]=_i[_s+5],Wt[6]=_i[_s+6],Wt[7]=_i[_s+7],_t[0]}function j(_i,_s){return Wt[7]=_i[_s],Wt[6]=_i[_s+1],Wt[5]=_i[_s+2],Wt[4]=_i[_s+3],Wt[3]=_i[_s+4],Wt[2]=_i[_s+5],Wt[1]=_i[_s+6],Wt[0]=_i[_s+7],_t[0]}var _t=new Float64Array([-0]),Wt=new Uint8Array(_t.buffer),_n=Wt[7]===128;e.writeDoubleLE=_n?i:h,e.writeDoubleBE=_n?h:i,e.readDoubleLE=_n?_:j,e.readDoubleBE=_n?j:_}():function(){function i(_,j,_t,Wt,_n,_i){var _s=0>Wt?1:0;if(_s&&(Wt=-Wt),Wt===0)_(0,_n,_i+j),_(0<1/Wt?0:2147483648,_n,_i+_t);else if(isNaN(Wt))_(0,_n,_i+j),_(2146959360,_n,_i+_t);else if(17976931348623157e292<Wt)_(0,_n,_i+j),_((_s<<31|2146435072)>>>0,_n,_i+_t);else if(22250738585072014e-324>Wt)_((Wt/=5e-324)>>>0,_n,_i+j),_((_s<<31|Wt/4294967296)>>>0,_n,_i+_t);else{var _u=Math.floor(Math.log(Wt)/Math.LN2);_u===1024&&(_u=1023),_(4503599627370496*(Wt*=Math.pow(2,-_u))>>>0,_n,_i+j),_((_s<<31|_u+1023<<20|1048576*Wt&1048575)>>>0,_n,_i+_t)}}function h(_,j,_t,Wt,_n){return j=_(Wt,_n+j),Wt=_(Wt,_n+_t),_=2*(Wt>>31)+1,j=4294967296*(1048575&Wt)+j,(_t=Wt>>>20&2047)===2047?j?NaN:1/0*_:_t===0?5e-324*_*j:_*Math.pow(2,_t-1075)*(j+4503599627370496)}e.writeDoubleLE=i.bind(null,Am,0,4),e.writeDoubleBE=i.bind(null,Bm,4,0),e.readDoubleLE=h.bind(null,Cm,0,4),e.readDoubleBE=h.bind(null,Dm,4,0)}(),e}function Am(e,i,h){i[h]=255&e,i[h+1]=e>>>8&255,i[h+2]=e>>>16&255,i[h+3]=e>>>24}function Bm(e,i,h){i[h]=e>>>24,i[h+1]=e>>>16&255,i[h+2]=e>>>8&255,i[h+3]=255&e}function Cm(e,i){return(e[i]|e[i+1]<<8|e[i+2]<<16|e[i+3]<<24)>>>0}function Dm(e,i){return(e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3])>>>0}function Wa(e,i){this.lo=e>>>0,this.hi=i>>>0}function sf(e,i,h){this.fn=e,this.len=i,this.next=void 0,this.val=h}function si(){}function Tt(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(e,i,h){i[h]=255&e}function ui(e,i){this.len=e,this.next=void 0,this.val=i}function vi(e,i,h){for(;e.hi;)i[h++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)i[h++]=127&e.lo|128,e.lo>>>=7;i[h++]=e.lo}function wi(e,i,h){i[h]=255&e,i[h+1]=e>>>8&255,i[h+2]=e>>>16&255,i[h+3]=e>>>24}function jc(){xi.call(this)}function Ut(e,i,h){40>e.length?V.utf8.write(e,i,h):i.utf8Write?i.utf8Write(e,h):i.write(e,h)}function Yb(e,i){return RangeError("index out of range: "+e.pos+" + "+(i||1)+" > "+e.len)}function La(e){this.buf=e,this.pos=0,this.len=e.length}function yi(){var e=new Em(0,0),i=0;if(!(4<this.len-this.pos)){for(;3>i;++i){if(this.pos>=this.len)throw Yb(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*i)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*i)>>>0,e}for(;4>i;++i)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*i)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(i=0,4<this.len-this.pos){for(;5>i;++i)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>i;++i){if(this.pos>=this.len)throw Yb(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function zg(e,i){return(e[i-4]|e[i-3]<<8|e[i-2]<<16|e[i-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(e){zi.call(this,e)}function tf(e,i,h){if(typeof e!="function")throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!i,this.responseDelimited=!!h}function za(e){return typeof e=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&e!=="null"}function Gm(e){try{var i=e.split(".").map(function(_){return Number(_)})}catch{return!1}if(i.length!==4||i[0]===0)return!1;for(e=0;e<i.length;e++){var h=i[e];if(!Number.isInteger(h)||0>h||255<h)return!1}return!0}function Hm(e,i){if(!Array.isArray(i)||i.length===0||32<i.length||i.some(function(h){return h.length===0||32<h.length}))throw new I("arguments is not valid",Ja);if(!za(e))throw new I("ID is invalid",Ja)}function uf(e){var i=e.attributes,h=e.attrSizeMap,_=e.maxAttrsCount,j=e.maxAttrValueSize;if(e=e.maxTotalSize,!yd(i))throw new I("attributes must be an object",Ja);if(Object.keys(i).length>_)throw new ib("Exceed the limit of ".concat(_," attributes"),se);if(Object.keys(i).length===0)throw new I("The attributes is an empty object",Ja);var _t=0,Wt=0;for(i=Object.entries(i);Wt<i.length;Wt++){var _n=ra(i[Wt],2),_i=_n[1];_n=new Blob([_n[0]]).size;var _s=new Blob([_i]).size;if(_n===0||32<_n)throw new I("Invalid attribute key",Ja);if(_s>j)throw new ib("Invalid attribute value, over the limit of ".concat(j," bytes"),se);if(typeof _i!="string"||_i.length===0)throw new I("Invalid attribute value",Ja);_t+=_n,_t+=_s}if(_t>e)throw new ib("The attributes size overflow",se);if(h!==void 0){if(Object.keys(h).length>_)throw new ib("Exceed the limit of ".concat(_," attributes"),se);for(_t=_=0,h=Object.entries(h);_t<h.length;_t++){if(Wt=(i=ra(h[_t],2))[1],(i=new Blob([i[0]]).size)===0)throw new I("Invalid attribute key",Ja);if(Wt>j)throw new ib("Invalid attribute value, over the limit of ".concat(j," bytes"),se);_+=i,_+=Wt}if(_>e)throw new ib("The attributes size overflow",se)}}function Ag(e,i){return Math.floor(Math.random()*(Math.floor(i)-Math.ceil(e)+1))+e}function Bg(){var e=Ag(0,4294967295),i=Ag(1,4294967295);return new U(e,i,!0)}function Xa(e){return e.toString().padEnd(32,"0")}function Im(e,i){return new TypeError("Unexpected ".concat(e,": ").concat(i))}function Jm(e,i){return e=e.split(".").map(function(h){return Number(h)}),i=i.split(".").map(function(h){return Number(h)}),Math.sqrt(1e3*Math.pow(e[0]-i[0],2)+100*Math.pow(e[1]-i[1],2)+10*Math.pow(e[2]-i[2],2)+1*Math.pow(e[3]-i[3],2))}function Km(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function Ai(e,i){i="".concat(e).concat(i||"");var h=Lm.get(i)||1;return Lm.set(i,h+1),"".concat(e).concat(h)}function Mm(e,i){var h=typeof i=="number"?i:i!==void 0&&typeof i!="string"?i.code:void 0;return i=typeof i!="number"&&typeof i!="string"&&i!==void 0&&i.serverCode!==void 0?i.serverCode:void 0,h="".concat(h!==void 0?" Error Code ".concat(h):"").concat(i!==void 0?", server Code ".concat(i):""),e=typeof e=="string"&&e?Cg(e):Array.isArray(e)&&typeof e[0]=="string"&&e[0]?Cg(Nm.apply(void 0,[e[0]].concat(G(e.slice(1))))):"","".concat(h===""?"":"".concat(h," - ")).concat(e)}function Om(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark(function e(i){return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",new Promise(function(_){setTimeout(function(){_()},i)}));case 1:case"end":return h.stop()}},e)}))).apply(this,arguments)}function Pm(e){return e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"}function Dg(e){var i=255&e,h=e>>8&255,_=e>>16&255;return"".concat(e>>24&255,".").concat(_,".").concat(h,".").concat(i)}function te(e,i,h){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark(function e(i,h,_){var j,_t,Wt,_n,_i,_s,_u,_h,_d,nE,aE,uE,hE,oE,sE,dE,vE,AE,PE,IE,QE,m_,yE,FE,UE,qE;return w.wrap(function(gE){for(;;)switch(gE.prev=gE.next){case 0:if(j=h.body,_t=h.headers,Wt=_t===void 0?{}:_t,_n=h.timeout,_i=_n===void 0?1e4:_n,_s=h.signal,_u=h.withCredentials,_h=_u!==void 0&&_u,_d=(_||{}).useBinaryResponse,nE=_d!==void 0&&_d,(aE=new XMLHttpRequest).open("POST",i,!0),aE.responseType=nE?"arraybuffer":"text",aE.withCredentials=_h,aE.timeout=_i,uE=j instanceof FormData,hE=j instanceof Uint8Array,!(1<(oE=Object.keys(Wt).filter(function(RE){return RE.toLowerCase()==="content-type"})).length)){gE.next=14;break}throw new RangeError("multiple content-type");case 14:oE.length===0&&(hE?Wt["Content-Type"]="application/octet-stream":uE||(Wt["Content-Type"]="application/json"));case 15:if("setRequestHeader"in aE){gE.next=46;break}return aE.abort(),gE.next=19,fetch(i,{body:uE||hE?j:JSON.stringify(j),cache:"no-cache",credentials:_h?"include":"same-origin",headers:Wt,method:"POST",mode:"cors",referrer:"no-referrer",signal:_s});case 19:if(sE=gE.sent,!(200<=(dE=sE.status)&&300>dE||dE===304)){gE.next=31;break}if(!nE){gE.next=27;break}return gE.next=25,sE.arrayBuffer();case 25:return vE=gE.sent,gE.abrupt("return",{status:dE,responseData:vE});case 27:return gE.next=29,sE.text();case 29:return AE=gE.sent,gE.abrupt("return",{status:dE,responseText:AE});case 31:return PE=new da(["Post XHR failure, status %d",dE]),gE.prev=32,gE.next=35,sE.text();case 35:throw IE=gE.sent,PE.statusCode=dE,PE.message=IE||"Request failed, status ".concat(dE),PE;case 41:throw gE.prev=41,gE.t0=gE.catch(32),PE.statusCode=dE,PE.message="Request failed, status ".concat(dE),PE;case 46:if(Object.keys(Wt).length!==0)for(QE=0,m_=Object.entries(Wt);QE<m_.length;QE++)yE=ra(m_[QE],2),FE=yE[0],UE=yE[1],aE.setRequestHeader(FE,UE);return _s!==void 0&&(qE=function RE(){aE.abort(),_s.removeEventListener("abort",RE)},_s.addEventListener("abort",qE)),uE||hE?aE.send(j):aE.send(JSON.stringify(j)),gE.abrupt("return",new Promise(function(RE,OE){aE.onload=function(){var HE=aE.status;if(200<=HE&&300>HE||HE===304)RE(nE?{status:HE,responseData:aE.response}:{status:HE,responseText:aE.responseText});else{var CE=new da(["Post XHR failure, status %d",HE]);CE.statusCode=HE,CE.message=aE.response||"Request failed, status ".concat(aE.status),OE(CE)}},aE.ontimeout=function(HE){OE(new db(["XHR request timed out after %d ms",_i],{originalError:HE}))},aE.onerror=function(){var HE=new da(["Post XHR failure, status %d",aE.status]);HE.statusCode=aE.status,HE.message=aE.response||"Request failed, status ".concat(aE.status),OE(HE)},aE.onabort=function(){try{OE(new DOMException("The request aborted.","AbortError"))}catch{var HE=Error("The request aborted.");HE.name="AbortError",OE(HE)}}}));case 50:case"end":return gE.stop()}},e,null,[[32,41]])}))).apply(this,arguments)}function Rm(e){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark(function e(i){var h;return w.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return(h=new Image).src=i,_.abrupt("return",new Promise(function(j,_t){h.onload=function(){j({width:h.width,height:h.height})},h.onerror=_t}));case 3:case"end":return _.stop()}},e)}))).apply(this,arguments)}function Xt(e,i){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark(function e(i,h){var _,j,_t,Wt,_n,_i,_s,_u,_h,_d;return w.wrap(function(nE){for(;;)switch(nE.prev=nE.next){case 0:if(_=i.thumbnailHeight,j=_===void 0?0:_,_t=i.thumbnailWidth,Wt=_t===void 0?0:_t,_n=i.width,_i=_n===void 0?0:_n,_s=i.height,_u=_s===void 0?0:_s,_h=i.thumbnail,_d=[],typeof j=="number"&&typeof Wt=="number"&&typeof _i=="number"&&typeof _u=="number"){nE.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=_i&&0>=_u&&_d.push(Rm(Sm(h)).then(function(aE){_i=aE.width,_u=aE.height})),0>=Wt&&0>=j&&_h!==void 0&&_d.push(Ji(_h).then(function(){var aE=J(w.mark(function uE(hE){var oE;return w.wrap(function(sE){for(;;)switch(sE.prev=sE.next){case 0:return sE.next=2,Rm(Sm(hE));case 2:oE=sE.sent,Wt=oE.width,j=oE.height;case 5:case"end":return sE.stop()}},uE)}));return function(uE){return aE.apply(this,arguments)}}())),nE.next=9,Promise.all(_d).catch(function(){});case 9:return nE.abrupt("return",{width:_i,height:_u,thumbnailWidth:Wt,thumbnailHeight:j});case 10:case"end":return nE.stop()}},e)}))).apply(this,arguments)}function Tm(e,i){if(!yd(e))throw new I("message object is not a plain object",i);if(e.messageType===void 0)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",e.text!==void 0)throw new I("Raw messages cannot have text property. Use description instead",i)}else{if(typeof e.text!="string")throw new I("messageType is undefined",i);if(e.messageType="TEXT",e.rawMessage!==void 0)throw new I("Text messages cannot have rawMessage property",i)}}function Gg(e){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark(function e(i){var h,_,j,_t,Wt,_n,_i,_s,_u,_h,_d,nE,aE,uE,hE,oE,sE,dE,vE,AE,PE;return w.wrap(function(IE){for(;;)switch(IE.prev=IE.next){case 0:if(h=i.message,_=i.peerId,j=i.toPeer,_t=i.session,Wt=i.errorCodes,_n=i.diff,_i=i.logger,_s=i.options,_t!==void 0){IE.next=3;break}throw new K("The client is not logged in. Cannot do the operation",Wt.NOT_LOGGED_IN);case 3:if(_u=!1,h.messageType!=="TEXT"||!h.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!j){IE.next=11;break}if(_h=h.text.split("_"),_d=ra(_h,3),nE=_d[0],aE=_d[1],_d[2]!==void 0&&za(aE)&&nE==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){IE.next=10;break}throw new I("Message is not valid",ve);case 10:_u=!0;case 11:if(uE=Date.now(),hE=_t.messageSentTimes.length-1,!((oE=_t.messageSentTimes[hE])&&oE+3e3<uE)){IE.next=18;break}_t.messageSentTimes=[uE],IE.next=29;break;case 18:sE=hE;case 19:if(!(0<=sE)){IE.next=28;break}if(!(_t.messageSentTimes[sE]+3e3<uE)){IE.next=23;break}return _t.messageSentTimes=_t.messageSentTimes.slice(sE+1,hE+1),IE.abrupt("break",28);case 23:if(!(180<=hE-sE+1)){IE.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",Wt.TOO_OFTEN);case 25:sE--,IE.next=19;break;case 28:_t.messageSentTimes.push(uE);case 29:IE.t0=h.messageType,IE.next=IE.t0==="TEXT"?32:IE.t0==="RAW"?37:IE.t0==="FILE"||IE.t0==="IMAGE"?39:40;break;case 32:if(!_u){IE.next=36;break}return dE=h.text.split("_"),vE=ra(dE,3),AE=vE[1],PE=vE[2],_i.info("[rtm-API] EndCall message send api is called"),IE.abrupt("return",_t.sendInvitationMessage({peerId:_,type:"CallCancel",extra:PE,channelId:AE,callId:"0"}));case 36:return IE.abrupt("return",_t.sendTextMessage(h.text,_,j,_s,1e4-_n));case 37:return h.description===void 0&&(h.description=""),IE.abrupt("return",_t.sendRawMessage(h.rawMessage,h.description,_,j,_s,1e4-_n));case 39:return IE.abrupt("return",_t.sendMediaMessage(h.messageType,h,_,j,_s,1e4-_n));case 40:throw new I("Invalid message type",ve);case 41:case"end":return IE.stop()}},e)}))).apply(this,arguments)}function Yt(e){var i=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],h=e.replace(/(https?:\/\/)?(www.)?/i,"");return i||(h=h.split(".").slice(e.length-2).join(".")),h.indexOf("/")!==-1?h.split("/")[0]:h}function oa(e){if(typeof e!="string")return"[Sensitive Info]";var i=Math.floor(.7*e.length),h=e.length;return Um(e,i,h,"*".repeat(h-i))}function Vm(e,i,h){function _(j){if(e===void 0)return e;if(Il(j))return j;if(Array.isArray(j))return j.map(_);var _t={},Wt=0;for(j=Hg(j);Wt<j.length;Wt++){var _n=ra(j[Wt],2),_i=_n[0];if(typeof(_n=_n[1])=="string"&&h.includes(_i)){_t[_i]=typeof _n=="string"?oa(_n):"[Sensitive Info]";break}i.includes(_i)?_t[_i]="[Hidden Info]":_t[_i]=_n==null?_n:h.includes(_i)?"[Sensitive Info]":_(_n)}return _t}return Array.isArray(e)?e.map(_):_(e)}function Wm(e){return Object.getOwnPropertyNames(e).forEach(function(i){X(i=e[i])=="object"&&i!==null&&Wm(i)}),Object.freeze(e)}function pa(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function Ig(e){return new TextEncoder().encode(e).length}function Xm(){for(var e=0,i=arguments.length,h=Array(i),_=0;_<i;_++)h[_]=arguments[_];for(i=0;i<h.length;i++)e+=h[i].length;for(e=new Uint8Array(e),_=i=0;_<h.length;_++){var j=h[_];e.set(j,i),i+=j.length}return e}function we(e,i,h){var _=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=_==null?void 0:_[1],_=_==null?void 0:_[2]){var j;for(_=_.substr(1).split("&"),j=0;j<_.length;j++)if(_[j].split("=")[0]==i){_[j]=i+"="+encodeURIComponent(h);break}return j==_.length&&_.push(i+"="+encodeURIComponent(h)),e+"?"+_.join("&")}return e+"?"+i+"="+encodeURIComponent(h)}function Ji(e){return new Promise(function(i,h){var _=new FileReader;_.onloadend=function(){var j=_.result||new ArrayBuffer(0);i(j)},_.onerror=h,_.readAsArrayBuffer(e)})}function Zt(e,i){e=e=[e],typeof(i=i||{})=="string"&&(i={type:i});try{var h=new Blob(e,i)}catch(j){if(j.name!=="TypeError")throw j;h=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder);for(var _=0;_<e.length;_+=1)h.append(e[_]);h=h.getBlob(i.type)}return h}function Um(e,i,h,_){return typeof e!="string"?"[Sensitive Info]":e.substring(0,i)+_+e.substring(h)}function Ym(e){var i=[];return function h(_){if(_===null||X(_)!=="object")return _;if(i.indexOf(_)!==-1)return"[Circular]";if(i.push(_),typeof _.toJSON=="function")try{var j=h(_.toJSON());return i.pop(),j}catch(_t){return"[Throws: "+(_t?_t.message:"?")+"]"}return Array.isArray(_)?(j=_.map(h),i.pop(),j):(j=Object.keys(_).reduce(function(_t,Wt){t:{if($t.call(_,Wt))try{var _n=_[Wt];break t}catch(_i){_n="[Throws: "+(_i?_i.message:"?")+"]";break t}_n=_[Wt]}return _t[Wt]=h(_n),_t},{}),i.pop(),j)}(e)}function au(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var i=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return 864e5*i;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*i;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i}}}function Jg(e,i,h,_){return Math.round(e/h)+" "+_+(i>=1.5*h?"s":"")}function bu(e){var i=e.areas,h=e.excludedArea;if(i.length===1&&i[0]===F.GLOBAL&&h===F.CHINA)return xe([F.OVERSEA]);if(i.includes(F.GLOBAL)){if(e=xf(Kg).filter(function(_t){return _t!==F.GLOBAL&&_t!==F.OVERSEA}),h in yf){i=yf[h];var _=[].concat(G(i??[]),[h]);return xe(e.filter(function(_t){return!_.includes(_t)}))}if(Zm(h)){var j=cu(h);return xe(e.filter(function(_t){return _t!==h&&_t!==j}))}}if(Zm(h)||h in yf)return xe(i);throw new I("Invalid excludedArea area config")}function Ma(e,i,h){h===void 0&&(h=Object.getOwnPropertyDescriptor(e,i));var _=h.value;return h.value=function(){for(var j=this,_t=arguments.length,Wt=Array(_t),_n=0;_n<_t;_n++)Wt[_n]=arguments[_n];this.invokeTracker.apply(this,["%s: ".concat(0<Wt.length?"%s with args: ".concat(Wt.map(function(){return"%o"})):"%s"),this.name,i].concat(G(Wt.map(ye))));try{var _i=_.apply(this,Wt)}catch(_u){throw this.logError.apply(this,["".concat(_u.code!==void 0?"Error Code ".concat(_u.code,": "):"","%s failed").concat(0<Wt.length?" with args: ".concat(Wt.map(function(){return"%o"})):""),i].concat(G(Wt.map(ye)))),_u.originalError&&this.logError(_u.originalError),this.errorTracker(_u),_u}var _s=Date.now();return J(w.mark(function _u(){var _h,_d;return w.wrap(function(nE){for(;;)switch(nE.prev=nE.next){case 0:return nE.prev=0,nE.next=3,_i;case 3:_h=nE.sent,nE.next=12;break;case 6:return nE.prev=6,nE.t0=nE.catch(0),j.logError.apply(j,["".concat(nE.t0.code!==void 0?"Error Code ".concat(nE.t0.code,": "):"","%s failed").concat(0<Wt.length?" with args: ".concat(Wt.map(function(){return"%o"})):""),i].concat(G(Wt.map(ye)))),nE.t0.originalError&&j.logError(nE.t0.originalError),j.errorTracker(nE.t0),nE.abrupt("return");case 12:_h!==_i?_h===void 0?j.resultTracker("%s promise resolves after %dms",i,Date.now()-_s):j.resultTracker("%s promise resolves after %dms, result is %o",i,Date.now()-_s,ye(_h)):Ac(_h)!=="Object"||yd(_h)?j.resultTracker("%s result is %o",i,ye(_h)):j.resultTracker("%s result is %s",i,_h.name||((_d=_h.constructor)===null||_d===void 0?void 0:_d.name));case 13:case"end":return nE.stop()}},_u,null,[[0,6]])}))(),_i},h}function Nb(e,i,h){h===void 0&&(h=Object.getOwnPropertyDescriptor(e,i));var _=h.value;return h.value=function(){for(var j=this,_t=arguments.length,Wt=Array(_t),_n=0;_n<_t;_n++)Wt[_n]=arguments[_n];this.invokeTracker.apply(this,["%s: ".concat(0<Wt.length?"%s with args: ".concat(Wt.map(function(){return"%o"})):"%s"),this.name,i].concat(Wt));try{var _i=_.apply(this,Wt)}catch(_u){throw this.logError.apply(this,["".concat(_u.code!==void 0?"Error Code ".concat(_u.code,": "):"","%s failed").concat(0<Wt.length?" with args: ".concat(Wt.map(function(){return"%o"})):""),i].concat(Wt)),_u.originalError&&this.logError(_u.originalError),this.errorTracker(_u),_u}var _s=Date.now();return J(w.mark(function _u(){var _h,_d;return w.wrap(function(nE){for(;;)switch(nE.prev=nE.next){case 0:return nE.prev=0,nE.next=3,_i;case 3:_h=nE.sent,nE.next=12;break;case 6:return nE.prev=6,nE.t0=nE.catch(0),j.logError.apply(j,["".concat(nE.t0.code!==void 0?"Error Code ".concat(nE.t0.code,": "):"","%s failed").concat(0<Wt.length?" with args: ".concat(Wt.map(function(){return"%o"})):""),i].concat(Wt)),nE.t0.originalError&&j.logError(nE.t0.originalError),j.errorTracker(nE.t0),nE.abrupt("return");case 12:_h!==_i?_h===void 0?j.resultTracker("%s promise resolves after %dms",i,Date.now()-_s):j.resultTracker("%s promise resolves after %dms, result is %o",i,Date.now()-_s,_h):Ac(_h)!=="Object"||yd(_h)?j.resultTracker("%s result is %o",i,_h):j.resultTracker("%s result is %s",i,_h.name||((_d=_h.constructor)===null||_d===void 0?void 0:_d.name));case 13:case"end":return nE.stop()}},_u,null,[[0,6]])}))(),_i},h}function du(e,i){var h="".concat(e,"Uri");if(typeof(h=Li[h])!="number"||h===0)throw new TypeError("Got Unknown URI Name");return i=new(e=$m[e])(i),i=e.encode(i).finish(),new eu({uri:h,data:i})}function an(e,i){return"".concat(e.split(".").join("-"),".edge.").concat(i?"sd-rtn.com":"agora.io")}function eb(e,i,h){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark(function e(i,h,_){var j,_t;return w.wrap(function(Wt){for(;;)switch(Wt.prev=Wt.next){case 0:Wt.next=2;break;case 2:return j=fu[i].encode(h).finish(),_t=function(){var _n=J(w.mark(function _i(_s){var _u,_h,_d,nE=arguments;return w.wrap(function(aE){for(;;)switch(aE.prev=aE.next){case 0:if(!(3<(_h=1<nE.length&&nE[1]!==void 0?nE[1]:0))){aE.next=3;break}return aE.abrupt("return");case 3:return _d=we(_d=_?"https://".concat((_u=M==null?void 0:M.PROXY_NGINX[0])!==null&&_u!==void 0?_u:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(_s,"&p=6443&d=events/proto-raw"):"https://".concat(_s,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),_d=we(_d,"id",gu[i].toString()),aE.next=8,te(_d,{body:j,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(uE){return _t(_s,_h+1)});case 8:case"end":return aE.stop()}},_i)}));return function(_i){return _n.apply(this,arguments)}}(),Wt.prev=4,Wt.next=7,_t((M==null?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:Wt.next=13;break;case 9:return Wt.prev=9,Wt.t0=Wt.catch(4),Wt.next=13,_t(M&&bn(1<(M==null?void 0:M.EVENT_REPORT_DOMAIN.length)?M==null?void 0:M.EVENT_REPORT_DOMAIN.slice(1):M==null?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return Wt.stop()}},e,null,[[4,9]])}))).apply(this,arguments)}function fb(e){return e===void 0?U.fromNumber(0):U.fromNumber(Date.now()-e)}function hu(e){return btoa(String.fromCharCode.apply({},e.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map(function(i){return parseInt(i,16)}))).replace(/={1,2}$/,"")}function Lg(e,i){return U.fromValue(e).eq(i)}function Mg(e,i){var h=i===void 0?e.val:i,_=e.isBoolean;i=e.isNumber;var j=e.oneof,_t=e.len;if([_,i,j].filter(function(Wt){return!Wt}).length!==2)throw new TypeError("invalid field type");if(h!==void 0&&(e=!1,j!==void 0&&(j=Ni(j),iu(j,Lg).length===j.length&&ju(j,function(Wt){return Lg(h,Wt)})!==void 0&&(e=!0)),_=_!==void 0&&(h===0||h===1)&&_t===1,i=i!==void 0&&h.toString(2).length<=_t,!(e||_||i)))throw Error("invalid field value")}function cn(e){return function(){var i=e();if(!i)throw new K("Client is not logged in. Cannot do the operation");return i}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},Ng=function(e){return e&&e.Math==Math&&e},y=Ng(typeof globalThis=="object"&&globalThis)||Ng(typeof window=="object"&&window)||Ng(typeof self=="object"&&self)||Ng(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),R=function(e){try{return!!e()}catch{return!0}},ka=!R(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(e){return!!(e=en(this,e))&&e.enumerable}:dn,dd=function(e,i){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:i}},ku={}.toString,Zb=function(e){return ku.call(e).slice(8,-1)},lu="".split,Af=R(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return Zb(e)=="String"?lu.call(e,""):Object(e)}:Object,jb=function(e){if(e==null)throw TypeError("Can't call method on "+e);return e},qb=function(e){return Af(jb(e))},ha=function(e){return typeof e=="object"?e!==null:typeof e=="function"},lc=function(e,i){if(!ha(e))return e;var h,_;if(i&&typeof(h=e.toString)=="function"&&!ha(_=h.call(e))||typeof(h=e.valueOf)=="function"&&!ha(_=h.call(e))||!i&&typeof(h=e.toString)=="function"&&!ha(_=h.call(e)))return _;throw TypeError("Can't convert object to primitive value")},Qa=function(e){return Object(jb(e))},mu={}.hasOwnProperty,Q=function(e,i){return mu.call(Qa(e),i)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R(function(){return Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(e,i){if(e=qb(e),i=lc(i,!0),fn)try{return gn(e,i)}catch{}if(Q(e,i))return dd(!zf.call(e,i),e[i])}},va=function(e){if(!ha(e))throw TypeError(String(e)+" is not an object");return e},hn=Object.defineProperty,Ra={f:ka?hn:function(e,i,h){if(va(e),i=lc(i,!0),va(h),fn)try{return hn(e,i,h)}catch{}if("get"in h||"set"in h)throw TypeError("Accessors not supported");return"value"in h&&(e[i]=h.value),e}},Na=ka?function(e,i,h){return Ra.f(e,i,dd(1,h))}:function(e,i,h){return e[i]=h,e},Oi=function(e,i){try{Na(y,e,i)}catch{y[e]=i}return i},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;typeof ed.inspectSource!="function"&&(ed.inspectSource=function(e){return nu.call(e)});var Pi=ed.inspectSource,jn=y.WeakMap,ou=typeof jn=="function"&&/native code/.test(Pi(jn)),fd=$a(function(e){(e.exports=function(i,h){return ed[i]||(ed[i]=h!==void 0?h:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:" 2021 Denis Pushkarev (zloirock.ru)"})}),pu=0,qu=Math.random(),Ae=function(e){return"Symbol("+String(e===void 0?"":e)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(e){return kn[e]||(kn[e]=Ae(e))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(e,i){if(ln.call(Gd,e))throw new TypeError("Object already initialized");return i.facade=e,tu.call(Gd,e,i),i},Qg=function(e){return su.call(Gd,e)||{}},Ri=function(e){return ln.call(Gd,e)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(e,i){if(Q(e,Ce))throw new TypeError("Object already initialized");return i.facade=e,Na(e,Ce,i),i},Qg=function(e){return Q(e,Ce)?e[Ce]:{}},Ri=function(e){return Q(e,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(e){return Ri(e)?Qg(e):Qi(e,{})},getterFor:function(e){return function(i){var h;if(!ha(i)||(h=Qg(i)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return h}}},Ta=$a(function(e){var i=Za.get,h=Za.enforce,_=String(String).split("String");(e.exports=function(j,_t,Wt,_n){var _i=!!_n&&!!_n.unsafe,_s=!!_n&&!!_n.enumerable;if(_n=!!_n&&!!_n.noTargetGet,typeof Wt=="function"){typeof _t!="string"||Q(Wt,"name")||Na(Wt,"name",_t);var _u=h(Wt);_u.source||(_u.source=_.join(typeof _t=="string"?_t:""))}j===y?_s?j[_t]=Wt:Oi(_t,Wt):(_i?!_n&&j[_t]&&(_s=!0):delete j[_t],_s?j[_t]=Wt:Na(j,_t,Wt))})(Function.prototype,"toString",function(){return typeof this=="function"&&i(this).source||Pi(this)})}),mn=function(e){return typeof e=="function"?e:void 0},mc=function(e,i){return 2>arguments.length?mn(y[e])||mn(y[e]):y[e]&&y[e][i]||y[e]&&y[e][i]},uu=Math.ceil,vu=Math.floor,$b=function(e){return isNaN(e=+e)?0:(0<e?vu:uu)(e)},wu=Math.min,ta=function(e){return 0<e?wu($b(e),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(e,i){return 0>(e=$b(e))?xu(e+i,0):yu(e,i)},nn=function(e){return function(i,h,_){i=qb(i);var j=ta(i.length);if(_=xb(_,j),e&&h!=h){for(;j>_;)if((h=i[_++])!=h)return!0}else for(;j>_;_++)if((e||_ in i)&&i[_]===h)return e||_||0;return!e&&-1}},on=nn(!0),Si=nn(!1),pn=function(e,i){e=qb(e);var h,_=0,j=[];for(h in e)!Q(Be,h)&&Q(e,h)&&j.push(h);for(;i.length>_;)Q(e,h=i[_++])&&(~Si(j,h)||j.push(h));return j},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(e){return pn(e,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(e){var i=Hd.f(va(e)),h=Bf.f;return h?i.concat(h(e)):i},rn=function(e,i){for(var h=qn(i),_=Ra.f,j=Fb.f,_t=0;_t<h.length;_t++){var Wt=h[_t];Q(e,Wt)||_(e,Wt,j(i,Wt))}},Au=/#|\.prototype\./,nc=function(e,i){return(e=Bu[Cu(e)])==Du||e!=Eu&&(typeof i=="function"?R(i):!!i)},Cu=nc.normalize=function(e){return String(e).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(e,i){var h,_,j,_t=e.target,Wt=e.global,_n=e.stat;if(_=Wt?y:_n?y[_t]||Oi(_t,{}):(y[_t]||{}).prototype)for(j in i){var _i=i[j],_s=e.noTargetGet?(h=Fu(_,j))&&h.value:_[j];if(!(h=nc(Wt?j:_t+(_n?".":"#")+j,e.forced))&&_s!==void 0){if(typeof _i==typeof _s)continue;rn(_i,_s)}(e.sham||_s&&_s.sham)&&Na(_i,"sham",!0);try{Ta(_,j,_i,e)}catch{}}},yb=function(e){if(typeof e!="function")throw TypeError(String(e)+" is not a function");return e},Id=function(e,i,h){if(yb(e),i===void 0)return e;switch(h){case 0:return function(){return e.call(i)};case 1:return function(_){return e.call(i,_)};case 2:return function(_,j){return e.call(i,_,j)};case 3:return function(_,j,_t){return e.call(i,_,j,_t)}}return function(){return e.apply(i,arguments)}},gd=Array.isArray||function(e){return Zb(e)=="Array"},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R(function(){return!String(Symbol())||!Symbol.sham&&id&&41>id}),vn=oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(e){return Q(Cf,e)&&(oc||typeof Cf[e]=="string")||(oc&&Q(Df,e)?Cf[e]=Df[e]:Cf[e]=Gu("Symbol."+e)),Cf[e]},Hu=qa("species"),Sg=function(e,i){if(gd(e)){var h=e.constructor;typeof h!="function"||h!==Array&&!gd(h.prototype)?ha(h)&&(h=h[Hu])===null&&(h=void 0):h=void 0}return new(h===void 0?Array:h)(i===0?0:i)},wn=[].push,jd=function(e){var i=e==1,h=e==2,_=e==3,j=e==4,_t=e==6,Wt=e==7,_n=e==5||_t;return function(_i,_s,_u,_h){var _d=Qa(_i),nE=Af(_d);_s=Id(_s,_u,3),_u=ta(nE.length);var aE,uE=0;for(_h=_h||Sg,_i=i?_h(_i,_u):h||Wt?_h(_i,0):void 0;_u>uE;uE++)if((_n||uE in nE)&&(aE=_s(_h=nE[uE],uE,_d),e))if(i)_i[uE]=aE;else if(aE)switch(e){case 3:return!0;case 5:return _h;case 6:return uE;case 2:wn.call(_i,_h)}else switch(e){case 4:return!1;case 7:wn.call(_i,_h)}return _t?-1:_||j?j:_i}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6),Ku=qa("species"),Ef=function(e){return 51<=id||!R(function(){var i=[];return(i.constructor={})[Ku]=function(){return{foo:1}},i[e](Boolean).foo!==1})},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(e){return yn(this,e,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(e){return pn(e,Rg)},Mu=R(function(){Dc(1)});N({target:"Object",stat:!0,forced:Mu},{keys:function(e){return Dc(Qa(e))}});var Ee=function(e,i){var h=[][e];return!!h&&R(function(){h.call(null,i||function(){throw 1},1)})},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(e){return Nu.call(qb(this),e===void 0?",":e)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(e){return xn(this,e,1<arguments.length?arguments[1]:void 0)}});var Ui=function(e){var i=e.return;if(i!==void 0)return va(i.call(e)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(e){return e!==void 0&&(Fe.Array===e||Su[Ru]===e)},Ge=function(e,i,h){(i=lc(i))in e?Ra.f(e,i,dd(0,h)):e[i]=h},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi=String(Bn)==="[object z]",Uu=qa("toStringTag"),Vu=Zb(function(){return arguments}())=="Arguments",Ff=Wi?Zb:function(e){var i;if(e===void 0)var h="Undefined";else{if(e===null)var _="Null";else{t:{var j=e=Object(e);try{_=j[Uu];break t}catch{}_=void 0}_=typeof(h=_)=="string"?h:Vu?Zb(e):(i=Zb(e))=="Object"&&typeof e.callee=="function"?"Arguments":i}h=_}return h},Wu=qa("iterator"),Xi=function(e){if(e!=null)return e[Wu]||e["@@iterator"]||Fe[Ff(e)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,function(){throw 2})}catch(e){}var Tg=function(e,i){if(!i&&!Dn)return!1;var h=!1;try{(i={})[Cn]=function(){return{next:function(){return{done:h=!0}}}},e(i)}catch{}return h},Yu=!Tg(function(e){Array.from(e)});N({target:"Array",stat:!0,forced:Yu},{from:function(e){var i,h=Qa(e),_=typeof this=="function"?this:Array,j=arguments.length,_t=1<j?arguments[1]:void 0,Wt=_t!==void 0,_n=Xi(h),_i=0;if(Wt&&(_t=Id(_t,2<j?arguments[2]:void 0,2)),_n==null||_==Array&&Vi(_n)){var _s=ta(h.length);for(_=new _(_s);_s>_i;_i++)_n=Wt?_t(h[_i],_i):h[_i],Ge(_,_i,_n)}else for(j=(h=_n.call(h)).next,_=new _;!(i=j.call(h)).done;_i++){if(Wt){_n=h;var _u=_t;i=[i.value,_i];try{_s=_u(va(i)[0],i[1])}catch(_h){throw Ui(_n),_h}}else _s=i.value;Ge(_,_i,_n=_s)}return _.length=_i,_}});var Fn=function(e){return function(i,h){i=String(jb(i)),h=$b(h);var _,j=i.length;if(0>h||h>=j)return e?"":void 0;var _t=i.charCodeAt(h);return 55296>_t||56319<_t||h+1===j||56320>(_=i.charCodeAt(h+1))||57343<_?e?i.charAt(h):_t:e?i.slice(h,h+2):_-56320+(_t-55296<<10)+65536}},Gn=Fn(!0),Hn=!R(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(e){return e=Qa(e),Q(e,In)?e[In]:typeof e.constructor=="function"&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(Kd==null||R(function(){var e={};return Kd[Yi].call(e)!==e}))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(e,i){va(e);for(var h,_=Dc(i),j=_.length,_t=0;j>_t;)Ra.f(e,h=_[_t++],i[h]);return e},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(aj){var e=aj;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(Wg=e,e=Rg.length;e--;)delete Wg.prototype[Rg[e]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(e,i){if(e!==null){$i.prototype=va(e);var h=new $i;$i.prototype=null,h[Mn]=e}else h=Wg();return i===void 0?h:av(h,i)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(e,i,h){e&&!Q(e=h?e:e.prototype,Nn)&&bv(e,Nn,{configurable:!0,value:i})},cv=function(){return this},dv=function(e,i,h){return i+=" Iterator",e.prototype=ac(Ug,{next:dd(1,h)}),Ec(e,i,!1),Fe[i]=cv,e},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,i={};try{var h=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;h.call(i,[]),e=i instanceof Array}catch{}return function(_,j){if(va(_),!ha(j)&&j!==null)throw TypeError("Can't set "+String(j)+" as a prototype");return e?h.call(_,j):_.__proto__=j,_}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(e,i,h,_,j,_t,Wt){dv(h,i,_),_=function(uE){if(uE===j&&_d)return _d;if(!Vg&&uE in _u)return _u[uE];switch(uE){case"keys":case"values":case"entries":return function(){return new h(this,uE)}}return function(){return new h(this)}};var _n,_i=i+" Iterator",_s=!1,_u=e.prototype,_h=_u[Gf]||_u["@@iterator"]||j&&_u[j],_d=!Vg&&_h||_(j),nE=i=="Array"&&_u.entries||_h;if(nE&&(e=Vb(nE.call(new e)),Ug!==Object.prototype&&e.next&&(Vb(e)!==Ug&&(Ua?Ua(e,Ug):typeof e[Gf]!="function"&&Na(e,Gf,ev)),Ec(e,_i,!0))),j=="values"&&_h&&_h.name!=="values"&&(_s=!0,_d=function(){return _h.call(this)}),_u[Gf]!==_d&&Na(_u,Gf,_d),Fe[i]=_d,j){var aE={values:_("values"),keys:_t?_d:_("keys"),entries:_("entries")};if(Wt)for(_n in aE)!Vg&&!_s&&_n in _u||Ta(_u,_n,aE[_n]);else N({target:i,proto:!0,forced:Vg||_s},aE)}return aE},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",function(e){fv(this,{type:"String Iterator",string:String(e),index:0})},function(){var e=gv(this),i=e.string,h=e.index;return h>=i.length?{value:void 0,done:!0}:(i=Gn(i,h),e.index+=i.length,{value:i,done:!1})});var cj=qa("unscopables"),dj=Array.prototype;dj[cj]==null&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(e){dj[cj][e]=!0},On=!0;"find"in[]&&Array(1).find(function(){On=!1}),N({target:"Array",proto:!0,forced:On},{find:function(e){return zn(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(e){var i=String(jb(this)),h="";if(0>(e=$b(e))||e==1/0)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(i+=i))1&e&&(h+=i);return h};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(e,i,h){for(var _ in i)Ta(e,_,i[_],h);return e},Qn=qa("species"),If=function(e){e=mc(e);var i=Ra.f;ka&&e&&!e[Qn]&&i(e,Qn,{configurable:!0,get:function(){return this}})},Gc=function(e,i,h){if(!(e instanceof i))throw TypeError("Incorrect "+(h?h+" ":"")+"invocation");return e},Jf=function(e,i){this.stopped=e,this.result=i},Xg=function(e,i,h){var _,j=!(!h||!h.AS_ENTRIES),_t=!(!h||!h.IS_ITERATOR),Wt=!(!h||!h.INTERRUPTED),_n=Id(i,h&&h.that,1+j+Wt),_i=function(_u){return _s&&Ui(_s),new Jf(!0,_u)};if(i=function(_u){return j?(va(_u),Wt?_n(_u[0],_u[1],_i):_n(_u[0],_u[1])):Wt?_n(_u,_i):_n(_u)},_t)var _s=e;else{if(typeof(_t=Xi(e))!="function")throw TypeError("Target is not iterable");if(Vi(_t)){for(_t=0,h=ta(e.length);h>_t;_t++)if((_=i(e[_t]))&&_ instanceof Jf)return _;return new Jf(!1)}_s=_t.call(e)}for(e=_s.next;!(_t=e.call(_s)).done;){try{_=i(_t.value)}catch(_u){throw Ui(_s),_u}if(typeof _=="object"&&_&&_ instanceof Jf)return _}return new Jf(!1)},iv=qa("species"),kd=function(e,i){var h;return(e=va(e).constructor)===void 0||(h=va(e)[iv])==null?i:yb(h)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc=Zb(y.process)=="process",Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(e){if(Kf.hasOwnProperty(e)){var i=Kf[e];delete Kf[e],i()}},ij=function(e){return function(){hj(e)}},Un=function(e){hj(e.data)},Vn=function(e){y.postMessage(e+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(e){for(var i=[],h=1;arguments.length>h;)i.push(arguments[h++]);return Kf[++gj]=function(){(typeof e=="function"?e:Function(e)).apply(void 0,i)},Lf(gj),gj},Sn=function(e){delete Kf[e]},Hc)var Lf=function(e){jv.nextTick(ij(e))};else if(fj&&fj.now)Lf=function(e){fj.now(ij(e))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&typeof postMessage=="function"&&!y.importScripts&&Yg&&Yg.protocol!=="file:"&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(e){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(e)}}:function(e){setTimeout(ij(e),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var e;for(Hc&&(e=$n.domain)&&e.exit();Md;){var i=Md.fn;Md=Md.next;try{i()}catch(h){throw Md?$g():Mf=void 0,h}}Mf=void 0,e&&e.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(e){e={fn:e,next:void 0},Mf&&(Mf.next=e),Md||(Md=e,$g()),Mf=e},nv=function(e){var i,h;this.promise=new e(function(_,j){if(i!==void 0||h!==void 0)throw TypeError("Bad Promise constructor");i=_,h=j}),this.resolve=yb(i),this.reject=yb(h)},lj={f:function(e){return new nv(e)}},mj=function(e,i){return va(e),ha(i)&&i.constructor===e?i:((0,(e=lj.f(e)).resolve)(i),e.promise)},ov=function(e,i){var h=y.console;h&&h.error&&(arguments.length===1?h.error(e):h.error(e,i))},nj=function(e){try{return{error:!1,value:e()}}catch(i){return{error:!0,value:i}}},pv=typeof window=="object",qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io=typeof PromiseRejectionEvent=="function",jo=!1,Nf=nc("Promise",function(){var e=Pi(zb)!==String(zb);if(!e&&id===66)return!0;if(51<=id&&/native code/.test(zb))return!1;var i=new zb(function(_){_(1)}),h=function(_){_(function(){},function(){})};return(i.constructor={})[qv]=h,!(jo=i.then(function(){})instanceof h)||!e&&pv&&!io}),vv=Nf||!Tg(function(e){zb.all(e).catch(function(){})}),ko=function(e){var i;return!(!ha(e)||typeof(i=e.then)!="function")&&i},qj=function(e,i){if(!e.notified){e.notified=!0;var h=e.reactions;fo(function(){for(var _=e.value,j=e.state==1,_t=0;h.length>_t;){var Wt,_n=h[_t++],_i=j?_n.ok:_n.fail,_s=_n.resolve,_u=_n.reject,_h=_n.domain;try{if(_i){if(j||(e.rejection===2&&wv(e),e.rejection=1),_i===!0)var _d=_;else if(_h&&_h.enter(),_d=_i(_),_h){_h.exit();var nE=!0}_d===_n.promise?_u(ho("Promise-chain cycle")):(Wt=ko(_d))?Wt.call(_d,_s,_u):_s(_d)}else _u(_)}catch(aE){_h&&!nE&&_h.exit(),_u(aE)}}e.reactions=[],e.notified=!1,i&&!e.rejection&&xv(e)})}},lo=function(e,i,h){var _;if(uv){var j=oj.createEvent("Event");j.promise=i,j.reason=h,j.initEvent(e,!1,!0),y.dispatchEvent(j)}else j={promise:i,reason:h};!io&&(_=y["on"+e])?_(j):e==="unhandledrejection"&&ov("Unhandled promise rejection",h)},xv=function(e){jj.call(y,function(){var i=e.facade,h=e.value;if(e.rejection!==1&&!e.parent){var _=nj(function(){Hc?pj.emit("unhandledRejection",h,i):lo("unhandledrejection",i,h)});if(e.rejection=Hc||e.rejection!==1&&!e.parent?2:1,_.error)throw _.value}})},wv=function(e){jj.call(y,function(){var i=e.facade;Hc?pj.emit("rejectionHandled",i):lo("rejectionhandled",i,e.value)})},Ie=function(e,i,h){return function(_){e(i,_,h)}},Je=function(e,i,h){e.done||(e.done=!0,h&&(e=h),e.value=i,e.state=2,qj(e,!0))},rj=function(e,i,h){if(!e.done){e.done=!0,h&&(e=h);try{if(e.facade===i)throw ho("Promise can't be resolved itself");var _=ko(i);_?fo(function(){var j={done:!1};try{_.call(i,Ie(rj,j,e),Ie(Je,j,e))}catch(_t){Je(j,_t,e)}}):(e.value=i,e.state=1,qj(e,!1))}catch(j){Je({done:!1},j,e)}}};if(Nf){zb=function(e){Gc(this,zb,"Promise"),yb(e),sj.call(this);var i=go(this);try{e(Ie(rj,i),Ie(Je,i))}catch(h){Je(i,h)}},bh=zb.prototype;var sj=function(e){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(e,i){var h=sv(this),_=He(kd(this,zb));return _.ok=typeof e!="function"||e,_.fail=typeof i=="function"&&i,_.domain=Hc?pj.domain:void 0,h.parent=!0,h.reactions.push(_),h.state!=0&&qj(h,!1),_.promise},catch:function(e){return this.then(void 0,e)}});var yv=function(){var e=new sj,i=go(e);this.promise=e,this.resolve=Ie(rj,i),this.reject=Ie(Je,i)};if(lj.f=He=function(e){return e===zb||e===zv?new yv(e):tv(e)},typeof Fc=="function"&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",function(e,i){var h=this;return new zb(function(_,j){Av.call(h,_,j)}).then(e,i)},{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch{}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(e){var i=He(this);return i.reject.call(void 0,e),i.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(e){return mj(this,e)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(e){var i=this,h=He(i),_=h.resolve,j=h.reject,_t=nj(function(){var Wt=yb(i.resolve),_n=[],_i=0,_s=1;Xg(e,function(_u){var _h=_i++,_d=!1;_n.push(void 0),_s++,Wt.call(i,_u).then(function(nE){_d||(_d=!0,_n[_h]=nE,--_s||_(_n))},j)}),--_s||_(_n)});return _t.error&&j(_t.value),h.promise},race:function(e){var i=this,h=He(i),_=h.reject,j=nj(function(){var _t=yb(i.resolve);Xg(e,function(Wt){_t.call(i,Wt).then(h.resolve,_)})});return j.error&&_(j.value),h.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(e){return no?mo.apply(this,arguments)||0:Si(this,e,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var e=va(this),i="";return e.global&&(i+="g"),e.ignoreCase&&(i+="i"),e.multiline&&(i+="m"),e.dotAll&&(i+="s"),e.unicode&&(i+="u"),e.sticky&&(i+="y"),i},pc=R(function(){var e=RegExp("a","y");return e.lastIndex=2,e.exec("abcd")!=null}),Cv=R(function(){var e=RegExp("^r","gy");return e.lastIndex=2,e.exec("str")!=null}),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),c.lastIndex!==0||a.lastIndex!==0),po=pc||Cv,vj=/()??/.exec("")[1]!==void 0,c,a;(uj||vj||po)&&(oo=function(e){var i,h=po&&this.sticky,_=tj.call(this),j=this.source,_t=0,Wt=e;if(h){(_=_.replace("y","")).indexOf("g")===-1&&(_+="g"),Wt=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&e[this.lastIndex-1]!==`
`)&&(j="(?: "+j+")",Wt=" "+Wt,_t++);var _n=new RegExp("^(?:"+j+")",_)}if(vj&&(_n=new RegExp("^"+j+"$(?!\\s)",_)),uj)var _i=this.lastIndex;var _s=ch.call(h?_n:this,Wt);return h?_s?(_s.input=_s.input.slice(_t),_s[0]=_s[0].slice(_t),_s.index=this.lastIndex,this.lastIndex+=_s[0].length):this.lastIndex=0:uj&&_s&&(this.lastIndex=this.global?_s.index+_s[0].length:_i),vj&&_s&&1<_s.length&&Dv.call(_s[0],_n,function(){for(i=1;i<arguments.length-2;i++)arguments[i]===void 0&&(_s[i]=void 0)}),_s});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R(function(){var e=/./;return e.exec=function(){var i=[];return i.groups={a:"7"},i},"".replace(e,"$<a>")!=="7"}),qo="a".replace(/./,"$0")==="$0",ro=qa("replace"),so=!!/./[ro]&&/./[ro]("a","$0")==="",Gv=!R(function(){var e=/(?:)/,i=e.exec;return e.exec=function(){return i.apply(this,arguments)},(e="ab".split(e)).length!==2||e[0]!=="a"||e[1]!=="b"}),dh=function(e,i,h,_){var j=qa(e),_t=!R(function(){var _s={};return _s[j]=function(){return 7},""[e](_s)!=7}),Wt=_t&&!R(function(){var _s=!1,_u=/a/;return e==="split"&&((_u={constructor:{}}).constructor[Ev]=function(){return _u},_u.flags="",_u[j]=/./[j]),_u.exec=function(){return _s=!0,null},_u[j](""),!_s});if(!_t||!Wt||e==="replace"&&(!Fv||!qo||so)||e==="split"&&!Gv){var _n=/./[j],_i=(h=h(j,""[e],function(_s,_u,_h,_d,nE){var aE=_u.exec;return aE===Of||aE===wj.exec?_t&&!nE?{done:!0,value:_n.call(_u,_h,_d)}:{done:!0,value:_s.call(_h,_u,_d)}:{done:!1}},{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,e,h[0]),Ta(wj,j,i==2?function(_s,_u){return _i.call(_s,this,_u)}:function(_s){return _i.call(_s,this)})}_&&Na(wj[j],"sham",!0)},xj=function(e,i,h){return i+(h?Gn(e,i).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(e,i,h,_,j,_t){var Wt=h+e.length,_n=_.length,_i=Kv;return j!==void 0&&(j=Qa(j),_i=Jv),Iv.call(_t,_i,function(_s,_u){switch(_u.charAt(0)){case"$":return"$";case"&":return e;case"`":return i.slice(0,h);case"'":return i.slice(Wt);case"<":_s=j[_u.slice(1,-1)];break;default:var _h=+_u;if(_h===0)return _s;if(_h>_n)return(_h=Hv(_h/10))===0?_s:_h<=_n?_[_h-1]===void 0?_u.charAt(1):_[_h-1]+_u.charAt(1):_s;_s=_[_h-1]}return _s===void 0?"":_s})},Ke=function(e,i){var h=e.exec;if(typeof h=="function"){if(typeof(e=h.call(e,i))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return e}if(Zb(e)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(e,i)},Mv=Math.max,Nv=Math.min,Ov=function(e){return e===void 0?e:String(e)};dh("replace",2,function(e,i,h,_){var j=_.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,_t=_.REPLACE_KEEPS_$0,Wt=j?"$":"$0";return[function(_n,_i){var _s=jb(this),_u=_n==null?void 0:_n[e];return _u!==void 0?_u.call(_n,_s,_i):i.call(String(_s),_n,_i)},function(_n,_i){if(!j&&_t||typeof _i=="string"&&_i.indexOf(Wt)===-1){var _s=h(i,_n,this,_i);if(_s.done)return _s.value}var _u=va(_n);_n=String(this),(_s=typeof _i=="function")||(_i=String(_i));var _h=_u.global;if(_h){var _d=_u.unicode;_u.lastIndex=0}for(var nE=[];;){var aE=Ke(_u,_n);if(aE===null||(nE.push(aE),!_h))break;String(aE[0])===""&&(_u.lastIndex=xj(_n,ta(_u.lastIndex),_d))}for(_d="",_h=_u=0;_h<nE.length;_h++){aE=nE[_h];for(var uE=String(aE[0]),hE=Mv(Nv($b(aE.index),_n.length),0),oE=[],sE=1;sE<aE.length;sE++)oE.push(Ov(aE[sE]));aE=aE.groups,_s?(oE=[uE].concat(oE,hE,_n),aE!==void 0&&oE.push(aE),aE=String(_i.apply(void 0,oE))):aE=Lv(uE,_n,hE,oE,aE,_i),hE>=_u&&(_d+=_n.slice(_u,hE)+aE,_u=hE+uE.length)}return _d+_n.slice(_u)}]});var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(e,i){var h=qb(this),_=ta(h.length);if(e=xb(e,_),i=xb(i===void 0?_:i,_),gd(h)){var j=h.constructor;if(typeof j!="function"||j!==Array&&!gd(j.prototype)?ha(j)&&(j=j[Qv])===null&&(j=void 0):j=void 0,j===Array||j===void 0)return Rv.call(h,e,i)}for(j=new(j===void 0?Array:j)(Sv(i-e,0)),_=0;e<i;e++,_++)e in h&&Ge(j,_,h[e]);return j.length=_,j}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",function(e,i){Tv(this,{type:"Array Iterator",target:qb(e),index:0,kind:i})},function(){var e=Uv(this),i=e.target,h=e.kind,_=e.index++;return!i||_>=i.length?(e.target=void 0,{value:void 0,done:!0}):h=="keys"?{value:_,done:!1}:h=="values"?{value:i[_],done:!1}:{value:[_,i[_]],done:!1}},"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to=typeof ArrayBuffer<"u"&&typeof DataView<"u",Le=function(e){if(e===void 0)return 0;e=$b(e);var i=ta(e);if(e!==i)throw RangeError("Wrong length or index");return i},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(e){var i=Qa(this),h=ta(i.length),_=arguments.length,j=xb(1<_?arguments[1]:void 0,h);for(h=(_=2<_?arguments[2]:void 0)===void 0?h:xb(_,h);h>j;)i[j++]=e;return i},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(e,i,h){var _,j=Array(h),_t=(1<<(h=8*h-i-1))-1,Wt=_t>>1,_n=i===23?Ic(2,-24)-Ic(2,-77):0,_i=0>e||e===0&&0>1/e?1:0,_s=0;if((e=Vv(e))!=e||e===1/0){e=e!=e?1:0;var _u=_t}else _u=Wv(Xv(e)/Yv),1>e*(_=Ic(2,-_u))&&(_u--,_*=2),2<=(e=1<=_u+Wt?e+_n/_:e+_n*Ic(2,1-Wt))*_&&(_u++,_/=2),_u+Wt>=_t?(e=0,_u=_t):1<=_u+Wt?(e=(e*_-1)*Ic(2,i),_u+=Wt):(e=e*Ic(2,Wt-1)*Ic(2,i),_u=0);for(;8<=i;j[_s++]=255&e,e/=256,i-=8);for(_u=_u<<i|e,h+=i;0<h;j[_s++]=255&_u,_u/=256,h-=8);return j[--_s]|=128*_i,j},xo=function(e,i){var h=e.length,_=8*h-i-1,j=(1<<_)-1,_t=j>>1;_-=7,--h;var Wt=e[h--],_n=127&Wt;for(Wt>>=7;0<_;_n=256*_n+e[h],h--,_-=8);var _i=_n&(1<<-_)-1;for(_n>>=-_,_+=i;0<_;_i=256*_i+e[h],h--,_-=8);if(_n===0)_n=1-_t;else{if(_n===j)return _i?NaN:Wt?-1/0:1/0;_i+=Ic(2,i),_n-=_t}return(Wt?-1:1)*_i*Ic(2,_n-i)},yo=function(e){return[255&e]},zo=function(e){return[255&e,e>>8&255]},Ao=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Bo=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},aw=function(e){return wo(e,23,4)},bw=function(e){return wo(e,52,8)},gh=function(e,i){$v(e.prototype,i,{get:function(){return Me(this)[i]}})},md=function(e,i,h,_){h=Le(h);var j=Me(e);if(h+i>j.byteLength)throw fh("Wrong index");return e=Me(j.buffer).bytes,h+=j.byteOffset,i=e.slice(h,h+i),_?i:i.reverse()},nd=function(e,i,h,_,j,_t){h=Le(h);var Wt=Me(e);if(h+i>Wt.byteLength)throw fh("Wrong index");for(e=Me(Wt.buffer).bytes,h+=Wt.byteOffset,_=_(+j),j=0;j<i;j++)e[h+j]=_[_t?j:i-j-1]};if(to){if(!R(function(){bc(1)})||!R(function(){new bc(-1)})||R(function(){return new bc,new bc(1.5),new bc(NaN),bc.name!="ArrayBuffer"})){Ab=function(e){return Gc(this,Ab),new bc(Le(e))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(e,i){Eo.call(this,e,i<<24>>24)},setUint8:function(e,i){Eo.call(this,e,i<<24>>24)}},{unsafe:!0})}else Ab=function(e){Gc(this,Ab,"ArrayBuffer"),e=Le(e),uo(this,{bytes:yj.call(Array(e),0),byteLength:e}),ka||(this.byteLength=e)},cc=function(e,i,h){Gc(this,cc,"DataView"),Gc(e,Ab,"DataView");var _=Me(e).byteLength;if(0>(i=$b(i))||i>_)throw fh("Wrong offset");if(i+(h=h===void 0?_-i:ta(h))>_)throw fh("Wrong length");uo(this,{buffer:e,byteLength:h,byteOffset:i}),ka||(this.buffer=e,this.byteLength=h,this.byteOffset=i)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(e){return md(this,1,e)[0]<<24>>24},getUint8:function(e){return md(this,1,e)[0]},getInt16:function(e){var i=md(this,2,e,1<arguments.length?arguments[1]:void 0);return(i[1]<<8|i[0])<<16>>16},getUint16:function(e){var i=md(this,2,e,1<arguments.length?arguments[1]:void 0);return i[1]<<8|i[0]},getInt32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return xo(md(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return xo(md(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,i){nd(this,1,e,yo,i)},setUint8:function(e,i){nd(this,1,e,yo,i)},setInt16:function(e,i){nd(this,2,e,zo,i,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,i){nd(this,2,e,zo,i,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,i){nd(this,4,e,Ao,i,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,i){nd(this,4,e,Ao,i,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,i){nd(this,4,e,aw,i,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,i){nd(this,8,e,bw,i,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R(function(){return!new Aj(2).slice(1,void 0).byteLength});N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(e,i){if(Go!==void 0&&i===void 0)return Go.call(va(this),e);var h=va(this).byteLength;e=xb(e,h),i=xb(i===void 0?h:i,h),h=new(kd(this,Aj))(ta(i-e));for(var _=new Fo(this),j=new Fo(h),_t=0;e<i;)j.setUint8(_t++,_.getUint8(e++));return h}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&Ff(y.opera)!=="Opera",Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(e){return!!ha(e)&&(e=Ff(e),Q(rc,e)||Q(fw,e))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||typeof qc!="function"||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(e){if(jh(e))return e;throw TypeError("Target is not a typed array")},Ne=function(e){if(Ua){if(Ko.call(qc,e))return e}else for(var i in rc)if(Q(rc,Bb)){var h=y[i];if(h&&(e===h||Ko.call(h,e)))return e}throw TypeError("Target is not a typed array constructor")},Aa=function(e,i,h){if(ka){if(h)for(var _ in rc){var j=y[_];if(j&&Q(j.prototype,e))try{delete j.prototype[e]}catch{}}dc[e]&&!h||Ta(dc,e,h?i:Jc&&Bj[e]||i)}},Oo=function(e,i,h){var _,j;if(ka){if(Ua){if(h){for(_ in rc)if((j=y[_])&&Q(j,e))try{delete j[e]}catch{}}if(qc[e]&&!h)return;try{return Ta(qc,e,h?i:Jc&&qc[e]||i)}catch{}}for(_ in rc)!(j=y[_])||j[e]&&!h||Ta(j,e,i)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R(function(){Od(1)})||!R(function(){new Od(-1)})||!Tg(function(e){new Od,new Od(null),new Od(1.5),new Od(e)},!0)||R(function(){return new Od(new gw(2),1,void 0).length!==1}),kh=function(e,i){if(0>(e=$b(e)))throw RangeError("The argument can't be less than 0");if(e%i)throw RangeError("Wrong offset");return e},Ej=function(e){var i=Qa(e),h=arguments.length,_=1<h?arguments[1]:void 0,j=_!==void 0,_t=Xi(i);if(_t!=null&&!Vi(_t)){var Wt=_t.call(i),_n=Wt.next;for(i=[];!(_t=_n.call(Wt)).done;)i.push(_t.value)}for(j&&2<h&&(_=Id(_,arguments[2],2)),_t=ta(i.length),Wt=new(Ne(this))(_t),h=0;_t>h;h++)Wt[h]=j?_(i[h],h):i[h];return Wt},lh=function(e,i,h){var _,j;return Ua&&typeof(_=i.constructor)=="function"&&_!==h&&ha(j=_.prototype)&&j!==h.prototype&&Ua(e,j),e},Sf=$a(function(e){var i=Hd.f,h=Za.get,_=Za.set,j=Ra.f,_t=Fb.f,Wt=Math.round,_n=y.RangeError,_i=Pf.ArrayBuffer,_s=Pf.DataView,_u=function(hE,oE){var sE=0,dE=oE.length;for(hE=new(Ne(hE))(dE);dE>sE;)hE[sE]=oE[sE++];return hE},_h=function(hE,oE){j(hE,oE,{get:function(){return h(this)[oE]}})},_d=function(hE){var oE;return hE instanceof _i||(oE=Ff(hE))=="ArrayBuffer"||oE=="SharedArrayBuffer"},nE=function(hE,oE){return jh(hE)&&typeof oE!="symbol"&&oE in hE&&String(+oE)==String(oE)},aE=function(hE,oE){return nE(hE,oE=lc(oE,!0))?dd(2,hE[oE]):_t(hE,oE)},uE=function(hE,oE,sE){return!(nE(hE,oE=lc(oE,!0))&&ha(sE)&&Q(sE,"value"))||Q(sE,"get")||Q(sE,"set")||sE.configurable||Q(sE,"writable")&&!sE.writable||Q(sE,"enumerable")&&!sE.enumerable?j(hE,oE,sE):(hE[oE]=sE.value,hE)};ka?(Qf||(Fb.f=aE,Ra.f=uE,_h(Rf,"buffer"),_h(Rf,"byteOffset"),_h(Rf,"byteLength"),_h(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:aE,defineProperty:uE}),e.exports=function(hE,oE,sE){var dE=hE.match(/\d+$/)[0]/8,vE=hE+(sE?"Clamped":"")+"Array",AE="get"+hE,PE="set"+hE,IE=y[vE],QE=IE;hE=QE&&QE.prototype;var m_={},yE=function(FE,UE){j(FE,UE,{get:function(){var qE=h(this);return qE.view[AE](UE*dE+qE.byteOffset,!0)},set:function(qE){var gE=h(this);sE&&(qE=0>(qE=Wt(qE))?0:255<qE?255:255&qE),gE.view[PE](UE*dE+gE.byteOffset,qE,!0)},enumerable:!0})};Qf?Dj&&(QE=oE(function(FE,UE,qE,gE){return Gc(FE,QE,vE),lh(ha(UE)?_d(UE)?gE!==void 0?new IE(UE,kh(qE,dE),gE):qE!==void 0?new IE(UE,kh(qE,dE)):new IE(UE):jh(UE)?_u(QE,UE):Ej.call(QE,UE):new IE(Le(UE)),FE,QE)}),Ua&&Ua(QE,Po),Jd(i(IE),function(FE){FE in QE||Na(QE,FE,IE[FE])}),QE.prototype=hE):(QE=oE(function(FE,UE,qE,gE){Gc(FE,QE,vE);var RE=0,OE=0;if(ha(UE)){if(!_d(UE))return jh(UE)?_u(QE,UE):Ej.call(QE,UE);var HE=UE;if(OE=kh(qE,dE),UE=UE.byteLength,gE===void 0){if(UE%dE||0>(gE=UE-OE))throw _n("Wrong length")}else if((gE=ta(gE)*dE)+OE>UE)throw _n("Wrong length");UE=gE/dE}else UE=Le(UE),HE=new _i(gE=UE*dE);for(_(FE,{buffer:HE,byteOffset:OE,byteLength:gE,length:UE,view:new _s(HE)});RE<UE;)yE(FE,RE++)}),Ua&&Ua(QE,Po),hE=QE.prototype=ac(Rf)),hE.constructor!==QE&&Na(hE,"constructor",QE),No&&Na(hE,No,vE),m_[vE]=QE,N({global:!0,forced:QE!=IE,sham:!Qf},m_),"BYTES_PER_ELEMENT"in QE||Na(QE,"BYTES_PER_ELEMENT",dE),"BYTES_PER_ELEMENT"in hE||Na(hE,"BYTES_PER_ELEMENT",dE),If(vE)}):e.exports=function(){}});Sf("Uint8",function(e){return function(i,h,_){return e(this,i,h,_)}});var hw=Math.min,iw=[].copyWithin||function(e,i){var h=Qa(this),_=ta(h.length),j=xb(e,_),_t=xb(i,_),Wt=2<arguments.length?arguments[2]:void 0;for(_=hw((Wt===void 0?_:xb(Wt,_))-_t,_-j),Wt=1,_t<j&&j<_t+_&&(Wt=-1,_t+=_-1,j+=_-1);0<_--;)_t in h?h[j]=h[_t]:delete h[j],j+=Wt,_t+=Wt;return h};Aa("copyWithin",function(e,i){return iw.call(Da(this),e,i,2<arguments.length?arguments[2]:void 0)}),Aa("every",function(e){return Ju(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("fill",function(e){return yj.apply(Da(this),arguments)}),Aa("filter",function(e){var i=yn(Da(this),e,1<arguments.length?arguments[1]:void 0),h=kd(this,this.constructor),_=0,j=i.length;for(h=new(Ne(h))(j);j>_;)h[_]=i[_++];return h}),Aa("find",function(e){return zn(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("findIndex",function(e){return An(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("forEach",function(e){Jd(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("includes",function(e){return on(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("indexOf",function(e){return Si(Da(this),e,1<arguments.length?arguments[1]:void 0)});var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&(Fj.name=="values"||Fj.name==null),To=function(){return jw.call(Da(this))};Aa("entries",function(){return lw.call(Da(this))}),Aa("keys",function(){return kw.call(Da(this))}),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",function(e){return mw.apply(Da(this),arguments)});var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(e){if(Uo)return Gj.apply(this,arguments)||0;var i=qb(this),h=ta(i.length),_=h-1;for(1<arguments.length&&(_=nw(_,$b(arguments[1]))),0>_&&(_=h+_);0<=_;_--)if(_ in i&&i[_]===e)return _||0;return-1}:Gj;Aa("lastIndexOf",function(e){return pw.apply(Da(this),arguments)}),Aa("map",function(e){return xn(Da(this),e,1<arguments.length?arguments[1]:void 0,function(i,h){return new(Ne(kd(i,i.constructor)))(h)})});var Vo=function(e){return function(i,h,_,j){yb(h),i=Qa(i);var _t=Af(i),Wt=ta(i.length),_n=e?Wt-1:0,_i=e?-1:1;if(2>_)for(;;){if(_n in _t){j=_t[_n],_n+=_i;break}if(_n+=_i,e?0>_n:Wt<=_n)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=_n:Wt>_n;_n+=_i)_n in _t&&(j=h(j,_t[_n],_n,i));return j}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",function(e){return Wo(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}),Aa("reduceRight",function(e){return qw(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)});var rw=Math.floor;Aa("reverse",function(){for(var e,i=Da(this).length,h=rw(i/2),_=0;_<h;)e=this[_],this[_++]=this[--i],this[i]=e;return this});var sw=R(function(){new Int8Array(1).set({})});Aa("set",function(e){Da(this);var i=kh(1<arguments.length?arguments[1]:void 0,1),h=this.length,_=Qa(e),j=ta(_.length),_t=0;if(j+i>h)throw RangeError("Wrong length");for(;_t<j;)this[i+_t]=_[_t++]},sw);var tw=[].slice,uw=R(function(){new Int8Array(1).slice()});Aa("slice",function(e,i){e=tw.call(Da(this),e,i);var h=kd(this,this.constructor);i=0;var _=e.length;for(h=new(Ne(h))(_);_>i;)h[i]=e[i++];return h},uw),Aa("some",function(e){return Iu(Da(this),e,1<arguments.length?arguments[1]:void 0)});var vw=[].sort;Aa("sort",function(e){return vw.call(Da(this),e)}),Aa("subarray",function(e,i){var h=Da(this),_=h.length;return e=xb(e,_),new(kd(h,h.constructor))(h.buffer,h.byteOffset+e*h.BYTES_PER_ELEMENT,ta((i===void 0?_:xb(i,_))-e))});var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R(function(){Xo.call(new mh(1))}),yw=R(function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()})||!R(function(){mh.prototype.toLocaleString.call([1,2])});Aa("toLocaleString",function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)},yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R(function(){nh.call({})})&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch{return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R(function(){return ap.call({source:"a",flags:"b"})!="/a/b"}),Fw=ap.name!="toString";(Ew||Fw)&&Ta(RegExp.prototype,"toString",function(){var e=va(this),i=String(e.source),h=e.flags;return"/"+i+"/"+(e=String(h===void 0&&e instanceof RegExp&&!("flags"in $o)?tj.call(e):h))},{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(e,i){var h,_,j=Qa(this),_t=ta(j.length),Wt=xb(e,_t),_n=arguments.length;if(_n===0?_n=h=0:_n===1?(_n=0,h=_t-Wt):(_n-=2,h=Iw(Hw($b(i),0),_t-Wt)),9007199254740991<_t+_n-h)throw TypeError("Maximum allowed length exceeded");var _i=Sg(j,h);for(_=0;_<h;_++){var _s=Wt+_;_s in j&&Ge(_i,_,j[_s])}if(_i.length=h,_n<h){for(_=Wt;_<_t-h;_++){var _u=_+_n;(_s=_+h)in j?j[_u]=j[_s]:delete j[_u]}for(_=_t;_>_t-h+_n;_--)delete j[_-1]}else if(_n>h)for(_=_t-h;_>Wt;_--)_u=_+_n-1,(_s=_+h-1)in j?j[_u]=j[_s]:delete j[_u];for(_=0;_<_n;_++)j[_+Wt]=arguments[_+2];return j.length=_t-h+_n,_i}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch{Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh]){for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch{Kc[Oe]=ld[Oe]}}}}var dp=Object.is||function(e,i){return e===i?e!==0||1/e==1/i:e!=e&&i!=i};dh("search",1,function(e,i,h){return[function(_){var j=jb(this),_t=_==null?void 0:_[e];return _t!==void 0?_t.call(_,j):new RegExp(_)[e](String(j))},function(_){var j=h(i,_,this);if(j.done)return j.value;_=va(_);var _t=String(this);return j=_.lastIndex,dp(j,0)||(_.lastIndex=0),_t=Ke(_,_t),dp(_.lastIndex,j)||(_.lastIndex=j),_t===null?-1:_t.index}]}),$a(function(e){(function(i,h){e.exports?e.exports=h(i):h(i)})(typeof self<"u"?self:Ya,function(i){function h(yE){return btoa(yE).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function _(yE){return yE=(yE+="===").slice(0,-yE.length%4),atob(yE.replace(/-/g,"+").replace(/_/g,"/"))}function j(yE){for(var FE=new Uint8Array(yE.length),UE=0;UE<yE.length;UE++)FE[UE]=yE.charCodeAt(UE);return FE}function _t(yE){return yE instanceof ArrayBuffer&&(yE=new Uint8Array(yE)),String.fromCharCode.apply(String,yE)}function Wt(yE){var FE={name:(yE.name||yE||"").toUpperCase().replace("V","v")};switch(FE.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":yE.length&&(FE.length=yE.length);break;case"HMAC":yE.hash&&(FE.hash=Wt(yE.hash)),yE.length&&(FE.length=yE.length);break;case"RSAES-PKCS1-v1_5":yE.publicExponent&&(FE.publicExponent=new Uint8Array(yE.publicExponent)),yE.modulusLength&&(FE.modulusLength=yE.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":yE.hash&&(FE.hash=Wt(yE.hash)),yE.publicExponent&&(FE.publicExponent=new Uint8Array(yE.publicExponent)),yE.modulusLength&&(FE.modulusLength=yE.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return FE}function _n(yE){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[yE.name][(yE.hash||{}).name||yE.length||""]}function _i(yE){(yE instanceof ArrayBuffer||yE instanceof Uint8Array)&&(yE=JSON.parse(decodeURIComponent(escape(_t(yE)))));var FE={kty:yE.kty,alg:yE.alg,ext:yE.ext||yE.extractable};switch(FE.kty){case"oct":FE.k=yE.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(UE){UE in yE&&(FE[UE]=yE[UE])});break;default:throw new TypeError("Unsupported key type")}return FE}function _s(yE){return yE=_i(yE),AE&&(yE.extractable=yE.ext,delete yE.ext),j(unescape(encodeURIComponent(JSON.stringify(yE)))).buffer}function _u(yE){var FE=_h(yE),UE=!1;switch(2<FE.length&&(UE=!0,FE.shift()),yE={ext:!0},FE[0][0]){case"1.2.840.113549.1.1.1":var qE="n e d p q dp dq qi".split(" ");for(FE=_h(FE[1]),UE&&FE.shift(),UE=0;UE<FE.length;UE++)FE[UE][0]||(FE[UE]=FE[UE].subarray(1)),yE[qE[UE]]=h(_t(FE[UE]));yE.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return yE}function _h(yE,FE){if(yE instanceof ArrayBuffer&&(yE=new Uint8Array(yE)),FE||(FE={pos:0,end:yE.length}),2>FE.end-FE.pos||FE.end>yE.length)throw new RangeError("Malformed DER");var UE=yE[FE.pos++],qE=yE[FE.pos++];if(128<=qE){if(qE&=127,FE.end-FE.pos<qE)throw new RangeError("Malformed DER");for(var gE=0;qE--;)gE<<=8,gE|=yE[FE.pos++];qE=gE}if(FE.end-FE.pos<qE)throw new RangeError("Malformed DER");switch(UE){case 2:UE=yE.subarray(FE.pos,FE.pos+=qE);break;case 3:if(yE[FE.pos++])throw Error("Unsupported bit string");qE--;case 4:UE=new Uint8Array(yE.subarray(FE.pos,FE.pos+=qE)).buffer;break;case 5:UE=null;break;case 6:if(!((yE=btoa(_t(yE.subarray(FE.pos,FE.pos+=qE))))in IE))throw Error("Unsupported OBJECT ID "+yE);UE=IE[yE];break;case 48:for(UE=[],qE=FE.pos+qE;FE.pos<qE;)UE.push(_h(yE,FE));break;default:throw Error("Unsupported DER tag 0x"+UE.toString(16))}return UE}function _d(yE,FE){FE||(FE=[]);var UE=FE.length+2;if(FE.push(0,0),yE instanceof Uint8Array)for(var qE=2,gE=yE.length,RE=0;RE<gE;RE++)FE.push(yE[RE]);else if(yE instanceof ArrayBuffer)for(qE=4,gE=yE.byteLength,yE=new Uint8Array(yE),RE=0;RE<gE;RE++)FE.push(yE[RE]);else if(yE===null)qE=5,gE=0;else if(typeof yE=="string"&&yE in QE)for(qE=6,gE=(yE=j(atob(QE[yE]))).length,RE=0;RE<gE;RE++)FE.push(yE[RE]);else if(yE instanceof Array){for(RE=0;RE<yE.length;RE++)_d(yE[RE],FE);qE=48,gE=FE.length-UE}else{if(!(X(yE)==="object"&&yE.tag===3&&yE.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+yE);for(qE=3,gE=(yE=new Uint8Array(yE.value)).byteLength,FE.push(0),RE=0;RE<gE;RE++)FE.push(yE[RE]);gE++}if(128<=gE){for(RE=gE,gE=4,FE.splice(UE,0,RE>>24&255,RE>>16&255,RE>>8&255,255&RE);1<gE&&!(RE>>24);)RE<<=8,gE--;4>gE&&FE.splice(UE,4-gE),gE|=128}return FE.splice(UE-2,2,qE,gE),FE}function nE(yE,FE,UE,qE){Object.defineProperties(this,{_key:{value:yE},type:{value:yE.type,enumerable:!0},extractable:{value:UE===void 0?yE.extractable:UE,enumerable:!0},algorithm:{value:FE===void 0?yE.algorithm:FE,enumerable:!0},usages:{value:qE===void 0?yE.usages:qE,enumerable:!0}})}function aE(yE){return yE==="verify"||yE==="encrypt"||yE==="wrapKey"}function uE(yE){return yE==="sign"||yE==="decrypt"||yE==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var hE=i.crypto||i.msCrypto;if(hE){var oE=hE.subtle||hE.webkitSubtle;if(oE){var sE=i.Crypto||hE.constructor||Object,dE=i.SubtleCrypto||oE.constructor||Object;i.CryptoKey||i.Key;var vE=-1<i.navigator.userAgent.indexOf("Edge/"),AE=!!i.msCrypto&&!vE,PE=!hE.subtle&&!!hE.webkitSubtle;if(AE||PE){var IE={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},QE={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(yE){var FE=oE[yE];oE[yE]=function(UE,qE,gE){var RE=[].slice.call(arguments);switch(yE){case"generateKey":var OE=Wt(UE),HE=qE,CE=gE;break;case"importKey":OE=Wt(gE),HE=RE[3],CE=RE[4],UE==="jwk"&&((qE=_i(qE)).alg||(qE.alg=_n(OE)),qE.key_ops||(qE.key_ops=qE.kty!=="oct"?"d"in qE?CE.filter(uE):CE.filter(aE):CE.slice()),RE[1]=_s(qE));break;case"unwrapKey":OE=RE[4],HE=RE[5],CE=RE[6],RE[2]=gE._key}if(yE==="generateKey"&&OE.name==="HMAC"&&OE.hash)return OE.length=OE.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[OE.hash.name],oE.importKey("raw",hE.getRandomValues(new Uint8Array(OE.length+7>>3)),OE,HE,CE);if(PE&&yE==="generateKey"&&OE.name==="RSASSA-PKCS1-v1_5"&&(!OE.modulusLength||2048<=OE.modulusLength))return(UE=Wt(UE)).name="RSAES-PKCS1-v1_5",delete UE.hash,oE.generateKey(UE,!0,["encrypt","decrypt"]).then(function(LE){return Promise.all([oE.exportKey("jwk",LE.publicKey),oE.exportKey("jwk",LE.privateKey)])}).then(function(LE){return LE[0].alg=LE[1].alg=_n(OE),LE[0].key_ops=CE.filter(aE),LE[1].key_ops=CE.filter(uE),Promise.all([oE.importKey("jwk",LE[0],OE,!0,LE[0].key_ops),oE.importKey("jwk",LE[1],OE,HE,LE[1].key_ops)])}).then(function(LE){return{publicKey:LE[0],privateKey:LE[1]}});if((PE||AE&&(OE.hash||{}).name==="SHA-1")&&yE==="importKey"&&UE==="jwk"&&OE.name==="HMAC"&&qE.kty==="oct")return oE.importKey("raw",j(_(qE.k)),gE,RE[3],RE[4]);if(PE&&yE==="importKey"&&(UE==="spki"||UE==="pkcs8"))return oE.importKey("jwk",_u(qE),gE,RE[3],RE[4]);if(AE&&yE==="unwrapKey")return oE.decrypt(RE[3],gE,qE).then(function(LE){return oE.importKey(UE,LE,RE[4],RE[5],RE[6])});try{var jE=FE.apply(oE,RE)}catch(LE){return Promise.reject(LE)}return AE&&(jE=new Promise(function(LE,i_){jE.onabort=jE.onerror=function(o_){i_(o_)},jE.oncomplete=function(o_){LE(o_.target.result)}})),jE=jE.then(function(LE){return OE.name!=="HMAC"||OE.length||(OE.length=8*LE.algorithm.length),OE.name.search("RSA")==0&&(OE.modulusLength||(OE.modulusLength=(LE.publicKey||LE).algorithm.modulusLength),OE.publicExponent||(OE.publicExponent=(LE.publicKey||LE).algorithm.publicExponent)),LE.publicKey&&LE.privateKey?{publicKey:new nE(LE.publicKey,OE,HE,CE.filter(aE)),privateKey:new nE(LE.privateKey,OE,HE,CE.filter(uE))}:new nE(LE,OE,HE,CE)})}}),["exportKey","wrapKey"].forEach(function(yE){var FE=oE[yE];oE[yE]=function(UE,qE,gE){var RE=[].slice.call(arguments);switch(yE){case"exportKey":RE[1]=qE._key;break;case"wrapKey":RE[1]=qE._key,RE[2]=gE._key}if((PE||AE&&(qE.algorithm.hash||{}).name==="SHA-1")&&yE==="exportKey"&&UE==="jwk"&&qE.algorithm.name==="HMAC"&&(RE[0]="raw"),!PE||yE!=="exportKey"||UE!=="spki"&&UE!=="pkcs8"||(RE[0]="jwk"),AE&&yE==="wrapKey")return oE.exportKey(UE,qE).then(function(HE){return UE==="jwk"&&(HE=j(unescape(encodeURIComponent(JSON.stringify(_i(HE)))))),oE.encrypt(RE[3],gE,HE)});try{var OE=FE.apply(oE,RE)}catch(HE){return Promise.reject(HE)}return AE&&(OE=new Promise(function(HE,CE){OE.onabort=OE.onerror=function(jE){CE(jE)},OE.oncomplete=function(jE){HE(jE.target.result)}})),yE==="exportKey"&&UE==="jwk"&&(OE=OE.then(function(HE){return(PE||AE&&(qE.algorithm.hash||{}).name==="SHA-1")&&qE.algorithm.name==="HMAC"?{kty:"oct",alg:_n(qE.algorithm),key_ops:qE.usages.slice(),ext:!0,k:h(_t(HE))}:((HE=_i(HE)).alg||(HE.alg=_n(qE.algorithm)),HE.key_ops||(HE.key_ops=qE.type==="public"?qE.usages.filter(aE):qE.type==="private"?qE.usages.filter(uE):qE.usages.slice()),HE)})),!PE||yE!=="exportKey"||UE!=="spki"&&UE!=="pkcs8"||(OE=OE.then(function(HE){var CE=[["",null]],jE=!1;switch((HE=_i(HE)).kty){case"RSA":for(var LE="n e d p q dp dq qi".split(" "),i_=[],o_=0;o_<LE.length&&LE[o_]in HE;o_++){var w_=i_[o_]=j(_(HE[LE[o_]]));128&w_[0]&&(i_[o_]=new Uint8Array(w_.length+1),i_[o_].set(w_,1))}2<i_.length&&(jE=!0,i_.unshift(new Uint8Array([0]))),CE[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return CE.push(new Uint8Array(_d(i_)).buffer),jE?CE.unshift(new Uint8Array([0])):CE[1]={tag:3,value:CE[1]},new Uint8Array(_d(CE)).buffer})),OE}}),["encrypt","decrypt","sign","verify"].forEach(function(yE){var FE=oE[yE];oE[yE]=function(UE,qE,gE,RE){if(AE&&(!gE.byteLength||RE&&!RE.byteLength))throw Error("Empty input is not allowed");var OE=[].slice.call(arguments),HE=Wt(UE);if(!AE||yE!=="sign"&&yE!=="verify"||UE!=="RSASSA-PKCS1-v1_5"&&UE!=="HMAC"||(OE[0]={name:UE}),AE&&qE.algorithm.hash&&(OE[0].hash=OE[0].hash||qE.algorithm.hash),AE&&yE==="decrypt"&&HE.name==="AES-GCM"){var CE=UE.tagLength>>3;OE[2]=(gE.buffer||gE).slice(0,gE.byteLength-CE),UE.tag=(gE.buffer||gE).slice(gE.byteLength-CE)}AE&&HE.name==="AES-GCM"&&OE[0].tagLength===void 0&&(OE[0].tagLength=128),OE[1]=qE._key;try{var jE=FE.apply(oE,OE)}catch(LE){return Promise.reject(LE)}return AE&&(jE=new Promise(function(LE,i_){jE.onabort=jE.onerror=function(o_){i_(o_)},jE.oncomplete=function(o_){if(o_=o_.target.result,yE==="encrypt"&&o_ instanceof AesGcmEncryptResult){var w_=o_.ciphertext,_y=o_.tag;(o_=new Uint8Array(w_.byteLength+_y.byteLength)).set(new Uint8Array(w_),0),o_.set(new Uint8Array(_y),w_.byteLength),o_=o_.buffer}LE(o_)}})),jE}}),AE){var m_=oE.digest;oE.digest=function(yE,FE){if(!FE.byteLength)throw Error("Empty input is not allowed");try{var UE=m_.call(oE,yE,FE)}catch(qE){return Promise.reject(qE)}return UE=new Promise(function(qE,gE){UE.onabort=UE.onerror=function(RE){gE(RE)},UE.oncomplete=function(RE){qE(RE.target.result)}})},i.crypto=Object.create(hE,{getRandomValues:{value:function(yE){return hE.getRandomValues(yE)}},subtle:{value:oE}}),i.CryptoKey=nE}PE&&(hE.subtle=oE,i.Crypto=sE,i.SubtleCrypto=dE,i.CryptoKey=nE)}}}})});var Jw=qa("match"),Lj=function(e){var i;return ha(e)&&((i=e[Jw])!==void 0?!!i:Zb(e)=="RegExp")},Kw=[].push,Lw=Math.min;dh("split",2,function(e,i,h){var _="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(j,_t){var Wt=String(jb(this));if((_t=_t===void 0?4294967295:_t>>>0)===0)return[];if(j===void 0)return[Wt];if(!Lj(j))return i.call(Wt,j,_t);var _n,_i,_s,_u=[],_h=0;for(j=new RegExp(j.source,(j.ignoreCase?"i":"")+(j.multiline?"m":"")+(j.unicode?"u":"")+(j.sticky?"y":"")+"g");(_n=Of.call(j,Wt))&&!((_i=j.lastIndex)>_h&&(_u.push(Wt.slice(_h,_n.index)),1<_n.length&&_n.index<Wt.length&&Kw.apply(_u,_n.slice(1)),_s=_n[0].length,_h=_i,_u.length>=_t));)j.lastIndex===_n.index&&j.lastIndex++;return _h===Wt.length?(_s||!j.test(""))&&_u.push(""):_u.push(Wt.slice(_h)),_u.length>_t?_u.slice(0,_t):_u}:"0".split(void 0,0).length?function(j,_t){return j===void 0&&_t===0?[]:i.call(this,j,_t)}:i;return[function(j,_t){var Wt=jb(this),_n=j==null?void 0:j[e];return _n!==void 0?_n.call(j,Wt,_t):_.call(String(Wt),j,_t)},function(j,_t){var Wt=h(_,j,this,_t,_!==i);if(Wt.done)return Wt.value;var _n=va(j);j=String(this);var _i=kd(_n,RegExp);if(Wt=_n.unicode,_n=new _i(pc?"^(?:"+_n.source+")":_n,(_n.ignoreCase?"i":"")+(_n.multiline?"m":"")+(_n.unicode?"u":"")+(pc?"g":"y")),(_t=_t===void 0?4294967295:_t>>>0)===0)return[];if(j.length===0)return Ke(_n,j)===null?[j]:[];var _s=0,_u=0;for(_i=[];_u<j.length;){_n.lastIndex=pc?0:_u;var _h,_d=Ke(_n,pc?j.slice(_u):j);if(_d===null||(_h=Lw(ta(_n.lastIndex+(pc?_u:0)),j.length))===_s)_u=xj(j,_u,Wt);else{if(_i.push(j.slice(_s,_u)),_i.length===_t)return _i;for(_s=1;_s<=_d.length-1;_s++)if(_i.push(_d[_s]),_i.length===_t)return _i;_u=_s=_h}}return _i.push(j.slice(_s)),_i}]},pc),function(e){e.console||(e.console={}),e=e.console;for(var i,h=function(){},_=["memory"],j="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");i=_.pop();)e[i]||(e[i]={});for(;i=j.pop();)e[i]||(e[i]=h)}(typeof window>"u"?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R(function(){Vb(1)});N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(e){return Vb(Qa(e))}});var ep=[].slice,Mj={},Nw=Function.bind||function(e){var i=yb(this),h=ep.call(arguments,1),_=function(){var j=h.concat(ep.call(arguments));if(this instanceof _){var _t=j.length;if(!(_t in Mj)){for(var Wt=[],_n=0;_n<_t;_n++)Wt[_n]="a["+_n+"]";Mj[_t]=Function("C,a","return new C("+Wt.join(",")+")")}j=Mj[_t](i,j)}else j=i.apply(e,j);return j};return ha(i.prototype)&&(_.prototype=i.prototype),_},Nj=mc("Reflect","construct"),fp=R(function(){function e(){}return!(Nj(function(){},[],e)instanceof e)}),gp=!R(function(){Nj(function(){})}),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(e,i){yb(e),va(i);var h=3>arguments.length?e:yb(arguments[2]);if(gp&&!fp)return Nj(e,i,h);if(e==h){switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3])}return(h=[null]).push.apply(h,i),new(Nw.apply(e,h))}h=h.prototype,h=ac(ha(h)?h:Object.prototype);var _=Function.apply.call(e,h,i);return ha(_)?_:h}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R(function(){ip(1)});N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(e,i){return ip(qb(e),i)}});var jp=Hd.f,Pw={}.toString,kp=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(e){if(kp&&Pw.call(e)=="[object Window]")try{var i=jp(e)}catch{i=kp.slice()}else i=jp(qb(e));return i},lp={f:qa},Qw=Ra.f,ph=function(e){var i=y.Symbol||(y.Symbol={});Q(i,e)||Qw(i,e,{value:lp.f(e)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R(function(){return ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a!=7})?function(e,i,h){var _=op(Ob,i);_&&delete Ob[i],od(e,i,h),_&&e!==Ob&&od(Ob,i,_)}:od,Uj=function(e,i){var h=Lc[e]=ac(sb.prototype);return Rw(h,{type:"Symbol",tag:e,description:i}),ka||(h.description=i),h},Vj=vn?function(e){return typeof e=="symbol"}:function(e){return Object(e)instanceof sb},qh=function(e,i,h){return e===Ob&&qh(Uf,i,h),va(e),i=lc(i,!0),va(h),Q(Lc,i)?(h.enumerable?(Q(e,rb)&&e[rb][i]&&(e[rb][i]=!1),h=ac(h,{enumerable:dd(0,!1)})):(Q(e,rb)||od(e,rb,dd(1,{})),e[rb][i]=!0),Tj(e,i,h)):od(e,i,h)},qp=function(e,i){va(e);var h=qb(i);return i=Dc(h).concat(Wj(h)),Jd(i,function(_){ka&&!Xj.call(h,_)||qh(e,_,h[_])}),e},Xj=function(e){e=lc(e,!0);var i=Sw.call(this,e);return!(this===Ob&&Q(Lc,e)&&!Q(Uf,e))&&(!(i||!Q(this,e)||!Q(Lc,e)||Q(this,rb)&&this[rb][e])||i)},rp=function(e,i){if(e=qb(e),i=lc(i,!0),e!==Ob||!Q(Lc,i)||Q(Uf,i)){var h=op(e,i);return!h||!Q(Lc,i)||Q(e,rb)&&e[rb][i]||(h.enumerable=!0),h}},sp=function(e){e=pp(qb(e));var i=[];return Jd(e,function(h){Q(Lc,h)||Q(Be,h)||i.push(h)}),i},Wj=function(e){var i=e===Ob;e=pp(i?Uf:qb(e));var h=[];return Jd(e,function(_){!Q(Lc,_)||i&&!Q(Ob,_)||h.push(Lc[_])}),h};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,i=Ae(e),h=function(_){this===Ob&&h.call(Uf,_),Q(this,rb)&&Q(this[rb],i)&&(this[rb][i]=!1),Tj(this,i,dd(1,_))};return ka&&Sj&&Tj(Ob,i,{configurable:!0,set:h}),Uj(i,e)},Ta(sb.prototype,"toString",function(){return np(this).tag}),Ta(sb,"withoutSetter",function(e){return Uj(Ae(e),e)}),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(e){return Uj(qa(e),e)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),function(e){ph(e)}),N({target:"Symbol",stat:!0,forced:!oc},{for:function(e){if(e=String(e),Q(Pj,e))return Pj[e];var i=sb(e);return Pj[e]=i,Qj[i]=e,i},keyFor:function(e){if(!Vj(e))throw TypeError(e+" is not a symbol");if(Q(Qj,e))return Qj[e]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(e,i){return i===void 0?ac(e):qp(ac(e),i)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R(function(){Bf.f(1)})},{getOwnPropertySymbols:function(e){return Bf.f(Qa(e))}}),Tf){var Uw=!oc||R(function(){var e=sb();return Tf([e])!="[null]"||Tf({a:e})!="{}"||Tf(Object(e))!="{}"});N({target:"JSON",stat:!0,forced:Uw},{stringify:function(e,i,h){for(var _,j=[e],_t=1;arguments.length>_t;)j.push(arguments[_t++]);if(_=i,(ha(i)||e!==void 0)&&!Vj(e))return gd(i)||(i=function(Wt,_n){if(typeof _=="function"&&(_n=_.call(this,Wt,_n)),!Vj(_n))return _n}),j[1]=i,Tf.apply(null,j)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&typeof Mc=="function"&&(!("description"in Mc.prototype)||Mc().description!==void 0)){var tp={},Vf=function(){var e=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),i=this instanceof Vf?new Mc(e):e===void 0?Mc():Mc(e);return e===""&&(tp[i]=!0),i};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw=String(Mc("test"))=="Symbol(test)",Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var e=ha(this)?this.valueOf():this,i=Ww.call(e);return Q(tp,e)?"":(e=Xw?i.slice(7,-1):i.replace(Yw,"$1"))===""?void 0:e}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function e(_d,nE){if(!(_d instanceof nE))throw new TypeError("Cannot call a class as a function")}function i(_d,nE){for(var aE=0;aE<nE.length;aE++){var uE=nE[aE];uE.enumerable=uE.enumerable||!1,uE.configurable=!0,"value"in uE&&(uE.writable=!0),Object.defineProperty(_d,uE.key,uE)}}function h(_d,nE,aE){return nE&&i(_d.prototype,nE),_d}function _(_d,nE){if(typeof nE!="function"&&nE!==null)throw new TypeError("Super expression must either be null or a function");_d.prototype=Object.create(nE&&nE.prototype,{constructor:{value:_d,writable:!0,configurable:!0}}),nE&&_t(_d,nE)}function j(_d){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(nE){return nE.__proto__||Object.getPrototypeOf(nE)})(_d)}function _t(_d,nE){return(_t=Object.setPrototypeOf||function(aE,uE){return aE.__proto__=uE,aE})(_d,nE)}function Wt(_d){if(_d===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _d}function _n(_d){var nE=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var aE=j(_d);if(nE){var uE=j(this).constructor;aE=Reflect.construct(aE,arguments,uE)}else aE=aE.apply(this,arguments);return aE=!aE||X(aE)!=="object"&&typeof aE!="function"?Wt(this):aE}}function _i(_d,nE,aE){return(_i=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(uE,hE,oE){for(;!Object.prototype.hasOwnProperty.call(uE,hE)&&(uE=j(uE))!==null;);if(uE)return(hE=Object.getOwnPropertyDescriptor(uE,hE)).get?hE.get.call(oE):hE.value})(_d,nE,aE||_d)}var _s=function(){function _d(){e(this,_d),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return h(_d,[{key:"addEventListener",value:function(nE,aE,uE){nE in this.listeners||(this.listeners[nE]=[]),this.listeners[nE].push({callback:aE,options:uE})}},{key:"removeEventListener",value:function(nE,aE){if(nE in this.listeners){for(var uE=0,hE=(nE=this.listeners[nE]).length;uE<hE;uE++)if(nE[uE].callback===aE){nE.splice(uE,1);break}}}},{key:"dispatchEvent",value:function(nE){if(nE.type in this.listeners){for(var aE=this.listeners[nE.type].slice(),uE=0,hE=aE.length;uE<hE;uE++){var oE=aE[uE];try{oE.callback.call(this,nE)}catch(sE){Promise.resolve().then(function(){throw sE})}oE.options&&oE.options.once&&this.removeEventListener(nE.type,oE.callback)}return!nE.defaultPrevented}}}]),_d}(),_u=function(_d){function nE(){e(this,nE);var uE=aE.call(this);return uE.listeners||_s.call(Wt(uE)),Object.defineProperty(Wt(uE),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(Wt(uE),"onabort",{value:null,writable:!0,configurable:!0}),uE}_(nE,_d);var aE=_n(nE);return h(nE,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(uE){uE.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,uE)),_i(j(nE.prototype),"dispatchEvent",this).call(this,uE)}}]),nE}(_s),_h=function(){function _d(){e(this,_d),Object.defineProperty(this,"signal",{value:new _u,writable:!0,configurable:!0})}return h(_d,[{key:"abort",value:function(){try{var nE=new Event("abort")}catch{typeof document<"u"?document.createEvent?(nE=document.createEvent("Event")).initEvent("abort",!1,!1):(nE=document.createEventObject()).type="abort":nE={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(nE)}},{key:"toString",value:function(){return"[object AbortController]"}}]),_d}();typeof Symbol<"u"&&Symbol.toStringTag&&(_h.prototype[Symbol.toStringTag]="AbortController",_u.prototype[Symbol.toStringTag]="AbortSignal"),function(_d){if(_d.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var nE=!0}else nE=typeof _d.Request=="function"&&!_d.Request.prototype.hasOwnProperty("signal")||!_d.AbortController;nE&&(_d.AbortController=_h,_d.AbortSignal=_u)}(typeof self<"u"?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Zw($w(e+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(e){return 31-bx(e>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(e){if(e=e&&e.buffer||e,up.call(e)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var i="",h=0,_=0|(e=Zj?new ak(e):e).length;h<_;h=h+32768|0)i+=xd.apply(0,e[Zj?"slice":"subarray"](h,h+32768|0));return i.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(e){for(var i=0|(e=e===void 0?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,h=new ak(i),_=0;_<i;_=_+1|0)h[_]=e.charCodeAt(_);return h},window.TextEncoder||(window.TextEncoder=yl),function(e){var i,h,_,j,_t,Wt,_n,_i,_s,_u,_h;(function(_d){_d.LOGIN="LOGIN",_d.LOGIN_SUCCESS="LOGIN_SUCCESS",_d.LOGIN_FAILURE="LOGIN_FAILURE",_d.LOGIN_TIMEOUT="LOGIN_TIMEOUT",_d.INTERRUPTED="INTERRUPTED",_d.LOGOUT="LOGOUT",_d.BANNED_BY_SERVER="BANNED_BY_SERVER",_d.REMOTE_LOGIN="REMOTE_LOGIN"})(i||(i={})),e.ConnectionChangeReason=i,function(_d){_d.DISCONNECTED="DISCONNECTED",_d.CONNECTING="CONNECTING",_d.CONNECTED="CONNECTED",_d.RECONNECTING="RECONNECTING",_d.ABORTED="ABORTED"}(h||(h={})),e.ConnectionState=h,function(_d){_d.IDLE="IDLE",_d.SENT_TO_REMOTE="SENT_TO_REMOTE",_d.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",_d.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",_d.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",_d.CANCELED="CANCELED",_d.FAILURE="FAILURE"}(_||(_={})),e.LocalInvitationState=_,function(_d){_d.INVITATION_RECEIVED="INVITATION_RECEIVED",_d.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",_d.REFUSED="REFUSED",_d.ACCEPTED="ACCEPTED",_d.CANCELED="CANCELED",_d.FAILURE="FAILURE"}(j||(j={})),e.RemoteInvitationState=j,function(_d){_d.UNKNOWN="UNKNOWN",_d.PEER_NO_RESPONSE="PEER_NO_RESPONSE",_d.INVITATION_EXPIRE="INVITATION_EXPIRE",_d.PEER_OFFLINE="PEER_OFFLINE",_d.NOT_LOGGEDIN="NOT_LOGGEDIN"}(_t||(_t={})),e.LocalInvitationFailureReason=_t,function(_d){_d.UNKNOWN="UNKNOWN",_d.PEER_OFFLINE="PEER_OFFLINE",_d.ACCEPT_FAILURE="ACCEPT_FAILURE",_d.INVITATION_EXPIRE="INVITATION_EXPIRE"}(Wt||(Wt={})),e.RemoteInvitationFailureReason=Wt,function(_d){_d.ONLINE="ONLINE",_d.UNREACHABLE="UNREACHABLE",_d.OFFLINE="OFFLINE"}(_n||(_n={})),e.PeerOnlineState=_n,(_i||(_i={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=_i,function(_d){_d.TEXT="TEXT",_d.RAW="RAW",_d.IMAGE="IMAGE",_d.FILE="FILE"}(_s||(_s={})),e.MessageType=_s,function(_d){_d.CN="CN",_d.NA="NA",_d.EU="EU",_d.AS="AS",_d.JP="JP",_d.IN="IN",_d.GLOB="GLOB",_d.OC="OC",_d.SA="SA",_d.AF="AF",_d.OVS="OVS"}(_u||(_u={})),e.LegacyAreaCode=_u,function(_d){_d.GLOBAL="GLOBAL",_d.INDIA="INDIA",_d.JAPAN="JAPAN",_d.ASIA="ASIA",_d.EUROPE="EUROPE",_d.CHINA="CHINA",_d.NORTH_AMERICA="NORTH_AMERICA"}(_h||(_h={})),e.AreaCode=_h}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(e){return on(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(e){if(Lj(e))throw TypeError("The method doesn't accept regular expressions");return e},ex=qa("match"),dk=function(e){var i=/./;try{"/./"[e](i)}catch{try{return i[ex]=!1,"/./"[e](i)}catch{}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(e){return!!~String(jb(this)).indexOf(ck(e),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(e){return Jd(this,e,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch{rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a(function(e){e=function(i){function h(gE,RE,OE){return Object.defineProperty(gE,RE,{value:OE,enumerable:!0,configurable:!0,writable:!0}),gE[RE]}function _(gE,RE,OE,HE){return RE=Object.create((RE&&RE.prototype instanceof _t?RE:_t).prototype),HE=new nE(HE||[]),RE._invoke=function(CE,jE,LE){var i_=IE;return function(o_,w_){if(i_===m_)throw Error("Generator is already running");if(i_===yE){if(o_==="throw")throw w_;return uE()}for(LE.method=o_,LE.arg=w_;;){if((o_=LE.delegate)&&(o_=_u(o_,LE))){if(o_===FE)continue;return o_}if(LE.method==="next")LE.sent=LE._sent=LE.arg;else if(LE.method==="throw"){if(i_===IE)throw i_=yE,LE.arg;LE.dispatchException(LE.arg)}else LE.method==="return"&&LE.abrupt("return",LE.arg);if(i_=m_,(o_=j(CE,jE,LE)).type==="normal"){if(i_=LE.done?yE:QE,o_.arg===FE)continue;return{value:o_.arg,done:LE.done}}o_.type==="throw"&&(i_=yE,LE.method="throw",LE.arg=o_.arg)}}}(gE,OE,HE),RE}function j(gE,RE,OE){try{return{type:"normal",arg:gE.call(RE,OE)}}catch(HE){return{type:"throw",arg:HE}}}function _t(){}function Wt(){}function _n(){}function _i(gE){["next","throw","return"].forEach(function(RE){h(gE,RE,function(OE){return this._invoke(RE,OE)})})}function _s(gE,RE){function OE(CE,jE,LE,i_){if((CE=j(gE[CE],gE,jE)).type!=="throw"){var o_=CE.arg;return(CE=o_.value)&&X(CE)==="object"&&sE.call(CE,"__await")?RE.resolve(CE.__await).then(function(w_){OE("next",w_,LE,i_)},function(w_){OE("throw",w_,LE,i_)}):RE.resolve(CE).then(function(w_){o_.value=w_,LE(o_)},function(w_){return OE("throw",w_,LE,i_)})}i_(CE.arg)}var HE;this._invoke=function(CE,jE){function LE(){return new RE(function(i_,o_){OE(CE,jE,i_,o_)})}return HE=HE?HE.then(LE,LE):LE()}}function _u(gE,RE){var OE=gE.iterator[RE.method];if(OE===hE){if(RE.delegate=null,RE.method==="throw"){if(gE.iterator.return&&(RE.method="return",RE.arg=hE,_u(gE,RE),RE.method==="throw"))return FE;RE.method="throw",RE.arg=new TypeError("The iterator does not provide a 'throw' method")}return FE}return(OE=j(OE,gE.iterator,RE.arg)).type==="throw"?(RE.method="throw",RE.arg=OE.arg,RE.delegate=null,FE):(OE=OE.arg)?OE.done?(RE[gE.resultName]=OE.value,RE.next=gE.nextLoc,RE.method!=="return"&&(RE.method="next",RE.arg=hE),RE.delegate=null,FE):OE:(RE.method="throw",RE.arg=new TypeError("iterator result is not an object"),RE.delegate=null,FE)}function _h(gE){var RE={tryLoc:gE[0]};1 in gE&&(RE.catchLoc=gE[1]),2 in gE&&(RE.finallyLoc=gE[2],RE.afterLoc=gE[3]),this.tryEntries.push(RE)}function _d(gE){var RE=gE.completion||{};RE.type="normal",delete RE.arg,gE.completion=RE}function nE(gE){this.tryEntries=[{tryLoc:"root"}],gE.forEach(_h,this),this.reset(!0)}function aE(gE){if(gE){var RE=gE[vE];if(RE)return RE.call(gE);if(typeof gE.next=="function")return gE;if(!isNaN(gE.length)){var OE=-1;return(RE=function HE(){for(;++OE<gE.length;)if(sE.call(gE,OE))return HE.value=gE[OE],HE.done=!1,HE;return HE.value=hE,HE.done=!0,HE}).next=RE}}return{next:uE}}function uE(){return{value:hE,done:!0}}var hE,oE=Object.prototype,sE=oE.hasOwnProperty,dE=typeof Symbol=="function"?Symbol:{},vE=dE.iterator||"@@iterator",AE=dE.asyncIterator||"@@asyncIterator",PE=dE.toStringTag||"@@toStringTag";try{h({},"")}catch{h=function(RE,OE,HE){return RE[OE]=HE}}i.wrap=_;var IE="suspendedStart",QE="suspendedYield",m_="executing",yE="completed",FE={};h(dE={},vE,function(){return this});var UE=Object.getPrototypeOf;(UE=UE&&UE(UE(aE([]))))&&UE!==oE&&sE.call(UE,vE)&&(dE=UE);var qE=_n.prototype=_t.prototype=Object.create(dE);return Wt.prototype=_n,h(qE,"constructor",_n),h(_n,"constructor",Wt),Wt.displayName=h(_n,PE,"GeneratorFunction"),i.isGeneratorFunction=function(gE){return!!(gE=typeof gE=="function"&&gE.constructor)&&(gE===Wt||(gE.displayName||gE.name)==="GeneratorFunction")},i.mark=function(gE){return Object.setPrototypeOf?Object.setPrototypeOf(gE,_n):(gE.__proto__=_n,h(gE,PE,"GeneratorFunction")),gE.prototype=Object.create(qE),gE},i.awrap=function(gE){return{__await:gE}},_i(_s.prototype),h(_s.prototype,AE,function(){return this}),i.AsyncIterator=_s,i.async=function(gE,RE,OE,HE,CE){CE===void 0&&(CE=Promise);var jE=new _s(_(gE,RE,OE,HE),CE);return i.isGeneratorFunction(RE)?jE:jE.next().then(function(LE){return LE.done?LE.value:jE.next()})},_i(qE),h(qE,PE,"Generator"),h(qE,vE,function(){return this}),h(qE,"toString",function(){return"[object Generator]"}),i.keys=function(gE){var RE,OE=[];for(RE in gE)OE.push(RE);return OE.reverse(),function HE(){for(;OE.length;){var CE=OE.pop();if(CE in gE)return HE.value=CE,HE.done=!1,HE}return HE.done=!0,HE}},i.values=aE,nE.prototype={constructor:nE,reset:function(gE){if(this.next=this.prev=0,this.sent=this._sent=hE,this.done=!1,this.delegate=null,this.method="next",this.arg=hE,this.tryEntries.forEach(_d),!gE)for(var RE in this)RE.charAt(0)==="t"&&sE.call(this,RE)&&!isNaN(+RE.slice(1))&&(this[RE]=hE)},stop:function(){this.done=!0;var gE=this.tryEntries[0].completion;if(gE.type==="throw")throw gE.arg;return this.rval},dispatchException:function(gE){function RE(o_,w_){return jE.type="throw",jE.arg=gE,OE.next=o_,w_&&(OE.method="next",OE.arg=hE),!!w_}if(this.done)throw gE;for(var OE=this,HE=this.tryEntries.length-1;0<=HE;--HE){var CE=this.tryEntries[HE],jE=CE.completion;if(CE.tryLoc==="root")return RE("end");if(CE.tryLoc<=this.prev){var LE=sE.call(CE,"catchLoc"),i_=sE.call(CE,"finallyLoc");if(LE&&i_){if(this.prev<CE.catchLoc)return RE(CE.catchLoc,!0);if(this.prev<CE.finallyLoc)return RE(CE.finallyLoc)}else if(LE){if(this.prev<CE.catchLoc)return RE(CE.catchLoc,!0)}else{if(!i_)throw Error("try statement without catch or finally");if(this.prev<CE.finallyLoc)return RE(CE.finallyLoc)}}}},abrupt:function(gE,RE){for(var OE=this.tryEntries.length-1;0<=OE;--OE){var HE=this.tryEntries[OE];if(HE.tryLoc<=this.prev&&sE.call(HE,"finallyLoc")&&this.prev<HE.finallyLoc){var CE=HE;break}}return CE&&(gE==="break"||gE==="continue")&&CE.tryLoc<=RE&&RE<=CE.finallyLoc&&(CE=null),(OE=CE?CE.completion:{}).type=gE,OE.arg=RE,CE?(this.method="next",this.next=CE.finallyLoc,FE):this.complete(OE)},complete:function(gE,RE){if(gE.type==="throw")throw gE.arg;return gE.type==="break"||gE.type==="continue"?this.next=gE.arg:gE.type==="return"?(this.rval=this.arg=gE.arg,this.method="return",this.next="end"):gE.type==="normal"&&RE&&(this.next=RE),FE},finish:function(gE){for(var RE=this.tryEntries.length-1;0<=RE;--RE){var OE=this.tryEntries[RE];if(OE.finallyLoc===gE)return this.complete(OE.completion,OE.afterLoc),_d(OE),FE}},catch:function(gE){for(var RE=this.tryEntries.length-1;0<=RE;--RE){var OE=this.tryEntries[RE];if(OE.tryLoc===gE){if((gE=OE.completion).type==="throw"){var HE=gE.arg;_d(OE)}return HE}}throw Error("illegal catch attempt")},delegateYield:function(gE,RE,OE){return this.delegate={iterator:aE(gE),resultName:RE,nextLoc:OE},this.method==="next"&&(this.arg=hE),FE}},i}(e.exports);try{regeneratorRuntime=e}catch{(typeof globalThis>"u"?"undefined":X(globalThis))==="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}),yp=!R(function(){return Object.isExtensible(Object.preventExtensions({}))}),fk=$a(function(e){var i=Ra.f,h=Ae("meta"),_=0,j=Object.isExtensible||function(){return!0},_t=function(_n){i(_n,h,{value:{objectID:"O"+ ++_,weakData:{}}})},Wt=e.exports={REQUIRED:!1,fastKey:function(_n,_i){if(!ha(_n))return typeof _n=="symbol"?_n:(typeof _n=="string"?"S":"P")+_n;if(!Q(_n,h)){if(!j(_n))return"F";if(!_i)return"E";_t(_n)}return _n[h].objectID},getWeakData:function(_n,_i){if(!Q(_n,h)){if(!j(_n))return!0;if(!_i)return!1;_t(_n)}return _n[h].weakData},onFreeze:function(_n){return yp&&Wt.REQUIRED&&j(_n)&&!Q(_n,h)&&_t(_n),_n}};Be[h]=!0}),zp=function(e,i,h){var _=e.indexOf("Map")!==-1,j=e.indexOf("Weak")!==-1,_t=_?"set":"add",Wt=y[e],_n=Wt&&Wt.prototype,_i=Wt,_s={},_u=function(hE){var oE=_n[hE];Ta(_n,hE,hE=="add"?function(sE){return oE.call(this,sE===0?0:sE),this}:hE=="delete"?function(sE){return!(j&&!ha(sE))&&oE.call(this,sE===0?0:sE)}:hE=="get"?function(sE){return j&&!ha(sE)?void 0:oE.call(this,sE===0?0:sE)}:hE=="has"?function(sE){return!(j&&!ha(sE))&&oE.call(this,sE===0?0:sE)}:function(sE,dE){return oE.call(this,sE===0?0:sE,dE),this})};if(nc(e,typeof Wt!="function"||!(j||_n.forEach&&!R(function(){new Wt().entries().next()}))))_i=h.getConstructor(i,e,_,_t),fk.REQUIRED=!0;else if(nc(e,!0)){var _h=new _i,_d=_h[_t](j?{}:-0,1)!=_h,nE=R(function(){_h.has(1)}),aE=Tg(function(hE){new Wt(hE)}),uE=!j&&R(function(){for(var hE=new Wt,oE=5;oE--;)hE[_t](oE,oE);return!hE.has(-0)});aE||((_i=i(function(hE,oE){return Gc(hE,_i,e),hE=lh(new Wt,hE,_i),oE!=null&&Xg(oE,hE[_t],{that:hE,AS_ENTRIES:_}),hE})).prototype=_n,_n.constructor=_i),(nE||uE)&&(_u("delete"),_u("has"),_&&_u("get")),(uE||_d)&&_u(_t),j&&_n.clear&&delete _n.clear}return _s[e]=_i,N({global:!0,forced:_i!=Wt},_s),Ec(_i,e),j||h.setStrong(_i,e,_),_i},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(e,i,h,_){var j=e(function(_i,_s){Gc(_i,j,i),Bp(_i,{type:i,index:ac(null),first:void 0,last:void 0,size:0}),ka||(_i.size=0),_s!=null&&Xg(_s,_i[_],{that:_i,AS_ENTRIES:h})}),_t=gk(i),Wt=function(_i,_s,_u){var _h,_d=_t(_i),nE=_n(_i,_s);return nE?nE.value=_u:(_d.last=nE={index:_h=Ap(_s,!0),key:_s,value:_u,previous:_s=_d.last,next:void 0,removed:!1},_d.first||(_d.first=nE),_s&&(_s.next=nE),ka?_d.size++:_i.size++,_h!=="F"&&(_d.index[_h]=nE)),_i},_n=function(_i,_s){_i=_t(_i);var _u=Ap(_s);if(_u!=="F")return _i.index[_u];for(_i=_i.first;_i;_i=_i.next)if(_i.key==_s)return _i};return Hf(j.prototype,{clear:function(){for(var _i=_t(this),_s=_i.index,_u=_i.first;_u;)_u.removed=!0,_u.previous&&(_u.previous=_u.previous.next=void 0),delete _s[_u.index],_u=_u.next;_i.first=_i.last=void 0,ka?_i.size=0:this.size=0},delete:function(_i){var _s=_t(this);if(_i=_n(this,_i)){var _u=_i.next,_h=_i.previous;delete _s.index[_i.index],_i.removed=!0,_h&&(_h.next=_u),_u&&(_u.previous=_h),_s.first==_i&&(_s.first=_u),_s.last==_i&&(_s.last=_h),ka?_s.size--:this.size--}return!!_i},forEach:function(_i){for(var _s,_u=_t(this),_h=Id(_i,1<arguments.length?arguments[1]:void 0,3);_s=_s?_s.next:_u.first;)for(_h(_s.value,_s.key,this);_s&&_s.removed;)_s=_s.previous},has:function(_i){return!!_n(this,_i)}}),Hf(j.prototype,h?{get:function(_i){return(_i=_n(this,_i))&&_i.value},set:function(_i,_s){return Wt(this,_i===0?0:_i,_s)}}:{add:function(_i){return Wt(this,_i=_i===0?0:_i,_i)}}),ka&&gx(j.prototype,"size",{get:function(){return _t(this).size}}),j},setStrong:function(e,i,h){var _=i+" Iterator",j=gk(i),_t=gk(_);bj(e,i,function(Wt,_n){Bp(this,{type:_,target:Wt,state:j(Wt),kind:_n,last:void 0})},function(){for(var Wt=_t(this),_n=Wt.kind,_i=Wt.last;_i&&_i.removed;)_i=_i.previous;return Wt.target&&(Wt.last=_i=_i?_i.next:Wt.state.first)?_n=="keys"?{value:_i.key,done:!1}:_n=="values"?{value:_i.value,done:!1}:{value:[_i.key,_i.value],done:!1}:(Wt.target=void 0,{value:void 0,done:!0})},h?"entries":"values",!h,!0),If(i)}};zp("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(e){return function(i){return i=String(jb(i)),1&e&&(i=i.replace(hx,"")),2&e&&(i=i.replace(ix,"")),i}},ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=sh(`	
\v\f\r \u2028\u2029\uFEFF08`)!==8||sh(`	
\v\f\r \u2028\u2029\uFEFF0x16`)!==22?function(e,i){return e=ik(String(e)),sh(e,i>>>0||(jx.test(e)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx=Zb(ac(th))=="Number",Ep=function(e){var i,h=lc(e,!1);if(typeof h=="string"&&2<h.length){if((e=(h=ik(h)).charCodeAt(0))===43||e===45){if((e=h.charCodeAt(2))===88||e===120)return NaN}else if(e===48){switch(h.charCodeAt(1)){case 66:case 98:e=2;var _=49;break;case 79:case 111:e=8,_=55;break;default:return+h}var j=(h=h.slice(2)).length;for(i=0;i<j;i++){var _t=h.charCodeAt(i);if(48>_t||_t>_)return NaN}return parseInt(h,e)}}return+h};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(e){var i=1>arguments.length?0:e,h=this;return h instanceof Pd&&(nx?R(function(){th.valueOf.call(h)}):Zb(h)!="Number")?lh(new pd(Ep(i)),h,Pd):Ep(i)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R(function(){var e=[];return e[Gp]=!1,e.concat()[0]!==e}),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(e){var i,h=Qa(this),_=Sg(h,0),j=0,_t=-1;for(i=arguments.length;_t<i;_t++){var Wt=_t===-1?h:arguments[_t],_n=Wt;if(ha(_n)){var _i=_n[Gp];_n=_i!==void 0?!!_i:gd(_n)}else _n=!1;if(_n){if(9007199254740991<j+(_i=ta(Wt.length)))throw TypeError("Maximum allowed index exceeded");for(_n=0;_n<_i;_n++,j++)_n in Wt&&Ge(_,j,Wt[_n])}else{if(9007199254740991<=j)throw TypeError("Maximum allowed index exceeded");Ge(_,j++,Wt)}}return _.length=j,_}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R(function(){kk(function(){})});N({target:"Reflect",stat:!0,forced:rx},{apply:function(e,i,h){return yb(e),va(h),kk?kk(e,i,h):qx.call(e,i,h)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R(function(){return!Object.getOwnPropertyNames(1)});N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe=(typeof Reflect>"u"?"undefined":X(Reflect))==="object"?Reflect:null,Hp=Pe&&typeof Pe.apply=="function"?Pe.apply:function(e,i,h){return Function.prototype.apply.call(e,i,h)},ux=Pe&&typeof Pe.ownKeys=="function"?Pe.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},Ip=Number.isNaN||function(e){return e!=e};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(e){if(typeof e!="number"||0>e||Ip(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Jp=e}}),ea.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(e){if(typeof e!="number"||0>e||Ip(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ea.prototype.getMaxListeners=function(){return this._maxListeners===void 0?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(e){for(var i=[],h=1;h<arguments.length;h++)i.push(arguments[h]);h=e==="error";var _=this._events;if(_!==void 0)h=h&&_.error===void 0;else if(!h)return!1;if(h){var j;throw 0<i.length&&(j=i[0]),j instanceof Error?j:((i=Error("Unhandled error."+(j?" ("+j.message+")":""))).context=j,i)}if((h=_[e])===void 0)return!1;if(typeof h=="function")Hp(h,this,i);else for(_=Cl(h,j=h.length),h=0;h<j;++h)Hp(_[h],this,i);return!0},ea.prototype.addListener=function(e,i){return zl(this,e,i,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(e,i){return zl(this,e,i,!0)},ea.prototype.once=function(e,i){return ng(i),this.on(e,Al(this,e,i)),this},ea.prototype.prependOnceListener=function(e,i){return ng(i),this.prependListener(e,Al(this,e,i)),this},ea.prototype.removeListener=function(e,i){var h;ng(i);var _=this._events;if(_===void 0)return this;var j=_[e];if(j===void 0)return this;if(j===i||j.listener===i)--this._eventsCount==0?this._events=Object.create(null):(delete _[e],_.removeListener&&this.emit("removeListener",e,j.listener||i));else if(typeof j!="function"){var _t=-1;for(h=j.length-1;0<=h;h--)if(j[h]===i||j[h].listener===i){var Wt=j[h].listener;_t=h;break}if(0>_t)return this;if(_t===0)j.shift();else{for(;_t+1<j.length;_t++)j[_t]=j[_t+1];j.pop()}j.length===1&&(_[e]=j[0]),_.removeListener!==void 0&&this.emit("removeListener",e,Wt||i)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(e){var i=this._events;if(i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var h=Object.keys(i);for(i=0;i<h.length;++i){var _=h[i];_!=="removeListener"&&this.removeAllListeners(_)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(h=i[e])=="function")this.removeListener(e,h);else if(h!==void 0)for(i=h.length-1;0<=i;i--)this.removeListener(e,h[i]);return this},ea.prototype.listeners=function(e){return Bl(this,e,!0)},ea.prototype.rawListeners=function(e){return Bl(this,e,!1)},ea.listenerCount=function(e,i){return typeof e.listenerCount=="function"?e.listenerCount(i):Dl.call(e,i)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(e,i){return new Promise(function(h,_){function j(Wt){e.removeListener(i,_t),_(Wt)}function _t(){typeof e.removeListener=="function"&&e.removeListener("error",j),h([].slice.call(arguments))}El(e,i,_t,{once:!0}),i!=="error"&&vs(e,j,{once:!0})})};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R(function(){if(ka&&Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},i={},h=Symbol();return e[h]=7,"abcdefghijklmnopqrst".split("").forEach(function(_){i[_]=_}),Qe({},e)[h]!=7||Dc(Qe({},i)).join("")!="abcdefghijklmnopqrst"})?function(e,i){for(var h=Qa(e),_=arguments.length,j=1,_t=Bf.f,Wt=zf;_>j;)for(var _n,_i=Af(arguments[j++]),_s=_t?Dc(_i).concat(_t(_i)):Dc(_i),_u=_s.length,_h=0;_u>_h;)_n=_s[_h++],(!ka||Wt.call(_i,_n))&&(h[_n]=_i[_n]);return h}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(e){return vx(e)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R(function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||sc(Wf,"i")!="/a/i"}))){for(var Oc=function(e,i){var h,_=this instanceof Oc,j=Lj(e),_t=i===void 0;return!_&&j&&e.constructor===Oc&&_t||(nk?j&&!_t&&(e=e.source):e instanceof Oc&&(_t&&(i=tj.call(e)),e=e.source),pc&&(h=!!i&&-1<i.indexOf("y"))&&(i=i.replace(/y/g,"")),e=lh(nk?new sc(e,i):sc(e,i),_?this:lk,Oc),pc&&h&&(zx(e).sticky=!0)),e},Bx=function(e){e in Oc||xx(Oc,e,{configurable:!0,get:function(){return sc[e]},set:function(i){sc[e]=i}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",function(e){return function(i,h,_){return e(this,i,h,_)}}),Sf("Float64",function(e){return function(i,h,_){return e(this,i,h,_)}}),Sf("Uint32",function(e){return function(i,h,_){return e(this,i,h,_)}}),Sf("Uint16",function(e){return function(i,h,_){return e(this,i,h,_)}});var ok=function(e,i){return e===i?0:e==null?i==null?0:-1:i==null?e==null?0:1:typeof e.compare=="function"?e.compare(i):typeof i.compare=="function"?-i.compare(e):e<i?-1:e>i?1:0},pk=[],Op=pk.sort,Cx=R(function(){pk.sort(void 0)}),Dx=R(function(){pk.sort(null)}),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(e){return e===void 0?Op.call(Qa(this)):Op.call(Qa(this),yb(e))}});var Pp=Object.getPrototypeOf({}),Xf=function(e,i){var h;return e===i||(e==null?e==i:X(e.equiv)==="function"?e.equiv(i):i==null?e==i:X(i.equiv)==="function"?i.equiv(e):X(e)!=="string"&&X(i)!=="string"&&((h=Object.getPrototypeOf(e))!=null&&h!==Pp||(h=Object.getPrototypeOf(i))!=null&&h!==Pp?X(e)!=="function"&&e.length!==void 0&&X(i)!=="function"&&i.length!==void 0?Gx(e,i):e instanceof Set&&i instanceof Set?Hx(e,i):e instanceof Map&&i instanceof Map?Ix(e,i):e instanceof Date&&i instanceof Date?e.getTime()===i.getTime():e instanceof RegExp&&i instanceof RegExp?e.toString()===i.toString():e!=e&&i!=i:Fx(e,i)))},Gx=function(e,i){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf,_=e.length;if(_===i.length)for(;0<=--_&&h(e[_],i[_]););return 0>_},Hx=function(e,i){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return e.size===i.size&&h(G(e.keys()).sort(),G(i.keys()).sort())},Ix=function(e,i){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return e.size===i.size&&h(G(e).sort(),G(i).sort())},Fx=function(e,i){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(var _ in e)if(!i.hasOwnProperty(_)||!h(e[_],i[_]))return!1;return!0},Qp=function(e){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(h){return h!==void 0?": "+h:""};return function(h){function _(_t){return W(this,_),j.call(this,e(_t)+i(_t))}la(_,h);var j=ma(_);return _}(ef(Error))},Jx=Qp(function(){return"illegal argument(s)"}),vh=function(e){throw new Jx(e)},qk=Qp(function(){return"index out of bounds"}),Rp=1/4294967295,Kx=function(){function e(){W(this,e)}return Ha(e,[{key:"float",value:function(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Rp*i}},{key:"norm",value:function(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Rp-.5)*i}},{key:"minmax",value:function(i,h){return this.float()*(h-i)+i}}]),e}(),rk=Math.random,Lx=new(function(e){function i(){return W(this,i),h.apply(this,arguments)}la(i,e);var h=ma(i);return Ha(i,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return rk()*_}},{key:"norm",value:function(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(rk()-.5)*_}}]),i}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R(function(){sk(1)});N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(e){return sk&&ha(e)?sk(Mx(e)):e}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(e){return Wo(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(e){return e!=null&&typeof e.xform=="function"?e.xform():e},og=function(){function e(i){W(this,e),this.value=i}return Ha(e,[{key:"deref",value:function(){return this.value}}]),e}(),Wh=function(e){return e instanceof og?e.deref():e},xs=function(e,i){return[e,function(h){return h},i]},Qx=w.mark(function(e,i){var h,_,j,_t,Wt,_n;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:h=Gl(e)(ws()),_=h[1],j=h[2],_t=0;case 4:if(!(_t<i.length)){_i.next=15;break}if(Wt=i[_t],!((_n=j([],Wt))instanceof og)){_i.next=10;break}return _i.delegateYield(Wh(_(_n.deref())),"t0",9);case 9:return _i.abrupt("return");case 10:if(!_n.length){_i.next=12;break}return _i.delegateYield(_n,"t1",12);case 12:_t++,_i.next=4;break;case 15:return _i.delegateYield(Wh(_([])),"t2",16);case 16:case"end":return _i.stop()}},Qx)}),ys=w.mark(Fl),zs=function(e,i){return[e[0],e[1],i]},Sp=!0;"findIndex"in[]&&Array(1).findIndex(function(){Sp=!1}),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(e){return An(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function e(i){W(this,e),this._length=0,i&&this.into(i)}return Ha(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var i,h=this.head;h;)i=h.next,delete h.value,delete h.prev,delete h.next,h=i;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(i){var h=this._length;if(h<i._length)return-1;if(h>i._length)return 1;if(h===0)return 0;h=this.head,i=i.head;for(var _=0;h&&_==0;)_=ok(h.value,i.value),h=h.next,i=i.next;return _}},{key:"equiv",value:function(i){if(!(i instanceof e||i!=null&&typeof i!="function"&&i.length!==void 0)||this._length!==i.length)return!1;if(!this._length||this===i)return!0;for(var h=this.head,_=0;_<i.length;_++){if(!Xf(h.value,i[_]))return!1;h=h.next}return!0}},{key:Symbol.iterator,value:w.mark(function i(){var h;return w.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:h=this.head;case 1:if(!h){_.next=7;break}return _.next=4,h.value;case 4:h=h.next,_.next=1;break;case 7:case"end":return _.stop()}},i,this)})},{key:"seq",value:function(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,h=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(i>=h||0>i)){i=this.nthCell(i);var _=this.nthCell(h-1);return h=function j(_t){return{first:function(){return _t.value},next:function(){return _t!==_&&_t.next?j(_t.next):void 0}}},i?h(i):void 0}}},{key:"cycle",value:w.mark(function i(){return w.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.delegateYield(this,"t0",2);case 2:h.next=0;break;case 4:case"end":return h.stop()}},i,this)})},{key:"$reduce",value:function(i,h){for(var _=this.head;_&&!(h instanceof og);)h=i(h,_.value),_=_.next;return h}},{key:"drop",value:function(){var i=this.head;if(i)return(this.head=i.next)?delete this.head.prev:delete this.tail,this._length--,i.value}},{key:"cons",value:function(i){return i={value:i,next:this.head},this.head?this.head.prev=i:this.tail=i,this.head=i,this._length++,this}},{key:"insertBefore",value:function(i,h){return i||vh("cell is undefined"),h={value:h,next:i,prev:i.prev},i.prev?i.prev.next=h:this.head=h,i.prev=h,this._length++,this}},{key:"insertAfter",value:function(i,h){return i||vh("cell is undefined"),h={value:h,next:i.next,prev:i},i.next?i.next.prev=h:this.tail=h,i.next=h,this._length++,this}},{key:"insertBeforeNth",value:function(i,h){if(0>i&&(i+=this._length),0>=i)return this.cons(h);if(0>i||i>=this._length)throw new qk(i);return this.insertBefore(this.nthCellUnsafe(i),h)}},{key:"insertAfterNth",value:function(i,h){if(0>i&&(i+=this._length),i>=this._length-1)return this.push(h);if(0>i||i>=this._length)throw new qk(i);return this.insertAfter(this.nthCellUnsafe(i),h)}},{key:"insertSorted",value:function(i,h){h=h||ok;for(var _=this.head;_;){if(0>=h(i,_.value))return this.insertBefore(_,i);_=_.next}return this.push(i)}},{key:"find",value:function(i){for(var h=this.head;h;){if(h.value===i)return h;h=h.next}}},{key:"findWith",value:function(i){for(var h=this.head;h;){if(i(h.value))return h;h=h.next}}},{key:"concat",value:function(){for(var i=this.copy(),h=arguments.length,_=Array(h),j=0;j<h;j++)_[j]=arguments[j];for(h=0;h<_.length;h++)i.into(_[h]);return i}},{key:"into",value:function(i){for(var h=0;h<i.length;h++)this.push(i[h])}},{key:"slice",value:function(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,h=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;i=0>i?i+this._length:i,h=0>h?h+this._length:h,(0>i||0>h)&&vh("invalid indices: ${from} / ${to}");for(var _=new e,j=this.nthCell(i);j&&++i<=h;)_.push(j.value),j=j.next;return _}},{key:"splice",value:function(i){var h=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,_=2<arguments.length?arguments[2]:void 0;if(typeof i=="number"){if(0>i&&(i+=this._length),0>i||i>=this._length)throw new qk(i);var j=this.nthCellUnsafe(i)}else j=i;var _t=new e;if(0<h)for(;j&&0<h--;)this.remove(j),_t.push(j.value),j=j.next;else j&&(j=j.next);if(_)if(j)for(h=0;h<_.length;h++)this.insertBefore(j,_[h]);else for(j=0;j<_.length;j++)this.push(_[j]);return _t}},{key:"remove",value:function(i){return i.prev?i.prev.next=i.next:this.head=i.next,i.next?i.next.prev=i.prev:this.tail=i.prev,this._length--,this}},{key:"swap",value:function(i,h){if(i!==h){var _=i.value;i.value=h.value,h.value=_}return this}},{key:"push",value:function(i){return this.tail?(i={value:i,prev:this.tail},this.tail=this.tail.next=i,this._length++,this):this.cons(i)}},{key:"pop",value:function(){var i=this.tail;if(i)return(this.tail=i.prev)?delete this.tail.next:delete this.head,this._length--,i.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(i){return this.head?(this.head.value=i,this):this.cons(i)}},{key:"setTail",value:function(i){return this.tail?(this.tail.value=i,this):this.push(i)}},{key:"setNth",value:function(i,h){var _=this.nthCell(i);return!_&&vh("index out of bounds: ".concat(i)),_.value=h,this}},{key:"nth",value:function(i,h){return(i=this.nthCell(i))?i.value:h}},{key:"nthCell",value:function(i){if(0>i&&(i+=this._length),!(0>i||i>=this._length))return this.nthCellUnsafe(i)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var i=this.peek();return this.pop(),this.cons(i)}}},{key:"map",value:function(i){for(var h=new e,_=this.head;_;)h.push(i(_.value)),_=_.next;return h}},{key:"filter",value:function(i){for(var h=new e,_=this.head;_;)i(_.value)&&h.push(_.value),_=_.next;return h}},{key:"reduce",value:function(i,h){for(var _=this.head;_;)h=i(h,_.value),_=_.next;return h}},{key:"shuffle",value:function(i){var h=1<arguments.length&&arguments[1]!==void 0?arguments[1]:Lx;if(2>this._length)return this;for(i=i??Math.ceil(1.5*Math.log2(this._length));0<i;i--)for(var _=this.head;_;){var j=_.next;.5>h.float()?this.asHead(_):this.asTail(_),_=j}return this}},{key:"sort",value:function(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:ok;if(!this._length)return this;for(var h=1;;){var _=this.head;this.tail=this.head=void 0;for(var j=0;_;){j++;for(var _t=_,Wt=0,_n=0;_n<h&&(Wt++,_t=_t.next);_n++);for(_n=h;0<Wt||0<_n&&_t;){if(Wt===0){var _i=_t;_t=_t.next,_n--}else _t&&_n!==0?0>=i(_.value,_t.value)?(_i=_,_=_.next,Wt--):(_i=_t,_t=_t.next,_n--):(_i=_,_=_.next,Wt--);this.tail?this.tail.next=_i:this.head=_i,_i.prev=this.tail,this.tail=_i}_=_t}if(this.tail.next=void 0,1>=j)return this;h*=2}}},{key:"reverse",value:function(){for(var i=this.head,h=this.tail,_=(this._length>>>1)+(1&this._length);i&&h&&0<_;){var j=i.value;i.value=h.value,h.value=j,i=i.next,h=h.prev,_--}return this}},{key:"asHead",value:function(i){return i===this.head||(this.remove(i),this.head.prev=i,i.next=this.head,i.prev=void 0,this.head=i,this._length++),this}},{key:"asTail",value:function(i){return i===this.tail||(this.remove(i),this.tail.next=i,i.prev=this.tail,i.next=void 0,this.tail=i,this._length++),this}},{key:"toString",value:function(){for(var i=[],h=this.head;h;)i.push(String(h.value)),h=h.next;return i.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(i){if(i<=this._length>>1)var h=this.head,_="next";else h=this.tail,_="prev",i=this._length-i-1;for(;0<i--&&h;)h=h[_];return h}}]),e}(),tc=function(){function e(i,h){W(this,e),h=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},h),this.map=h.map(),this.items=new Rx,this._size=0,this.opts=h,i&&this.into(i)}return Ha(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg(function(i){return[i.k,i]},this.items)}},{key:"keys",value:function(){return pg(function(i){return i.k},this.items)}},{key:"values",value:function(){return pg(function(i){return i.v},this.items)}},{key:"copy",value:function(){var i=this.empty();i.items=this.items.copy();for(var h=i.items.head;h;)i.map.set(h.value.k,h),h=h.next;return i}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var i=this.opts.release;if(i){for(var h;h=this.items.drop();)i(h.k,h.v);return!0}return this.items.release()}},{key:"has",value:function(i){return this.map.has(i)}},{key:"get",value:function(i,h){return(i=this.map.get(i))?this.resetEntry(i):h}},{key:"set",value:function(i,h){var _=this.opts.ksize(i)+this.opts.vsize(h),j=this.map.get(i);return this._size+=Math.max(0,_-(j?j.value.s:0)),this.ensureSize()&&this.doSetEntry(j,i,h,_),h}},{key:"into",value:function(i){for(var h=0;h<i.length;h++){var _=i[h];this.set(_[0],_[1])}return this}},{key:"getSet",value:function(i,h){var _=this,j=this.map.get(i);return j?Promise.resolve(this.resetEntry(j)):h().then(function(_t){return _.set(i,_t)})}},{key:"delete",value:function(i){return!!(i=this.map.get(i))&&(this.removeEntry(i),!0)}},{key:"resetEntry",value:function(i){return this.items.asTail(i),i.value.v}},{key:"ensureSize",value:function(){for(var i=this.opts.release,h=this.opts.maxsize,_=this.opts.maxlen;this._size>h||this.length>=_;){var j=this.items.drop();if(!j)return!1;this.map.delete(j.k),i&&i(j.k,j.v),this._size-=j.s}return!0}},{key:"removeEntry",value:function(i){var h=i.value;this.map.delete(h.k),this.items.remove(i),this.opts.release&&this.opts.release(h.k,h.v),this._size-=h.s}},{key:"doSetEntry",value:function(i,h,_,j){i?(i.value.v=_,i.value.s=j,this.items.asTail(i)):(this.items.push({k:h,v:_,s:j}),this.map.set(h,this.items.tail))}}]),e}(),Sx=function(e){function i(_,j){return W(this,i),j=Object.assign({ttl:36e5},j),h.call(this,_,j)}la(i,e);var h=ma(i);return Ha(i,[{key:"empty",value:function(){return new i(null,this.opts)}},{key:"has",value:function(_){return this.get(_)!==void 0}},{key:"get",value:function(_,j){if(_=this.map.get(_)){if(_.value.t>=Date.now())return this.resetEntry(_);this.removeEntry(_)}return j}},{key:"set",value:function(_,j){var _t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,Wt=this.opts.ksize(_)+this.opts.vsize(j),_n=this.map.get(_);return this._size+=Math.max(0,Wt-(_n?_n.value.s:0)),this.ensureSize()&&(_t=Date.now()+_t,_n?(_n.value.v=j,_n.value.s=Wt,_n.value.t=_t,this.items.asTail(_n)):(this.items.push({k:_,v:j,s:Wt,t:_t}),this.map.set(_,this.items.tail))),j}},{key:"getSet",value:function(_,j){var _t=this,Wt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,_n=this.get(_);return _n?Promise.resolve(_n):j().then(function(_i){return _t.set(_,_i,Wt)})}},{key:"prune",value:function(){for(var _=Date.now(),j=this.items.head;j;)j.value.t<_&&this.removeEntry(j),j=j.next}},{key:"ensureSize",value:function(){for(var _=this.opts.maxsize,j=this.opts.maxlen,_t=Date.now(),Wt=this.items.head;Wt&&(this._size>_||this.length>=j);)Wt.value.t<_t&&this.removeEntry(Wt),Wt=Wt.next;return Th(wd(i.prototype),"ensureSize",this).call(this)}}]),i}(tc),Tp=X(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,Tx=(typeof self>"u"?"undefined":X(self))=="object"&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(e){if(e==null)e=e===void 0?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(e)){var i=Ux.call(e,Yf),h=e[Yf];try{e[Yf]=void 0;var _=!0}catch{}var j=Vx.call(e);_&&(i?e[Yf]=h:delete e[Yf]),e=j}else e=Wx.call(e);return e},lb=function(e){var i=X(e);return e!=null&&(i=="object"||i=="function")},qi=function(e){return!!lb(e)&&((e=Qd(e))=="[object Function]"||e=="[object GeneratorFunction]"||e=="[object AsyncFunction]"||e=="[object Proxy]")},tk=Cb["__core-js_shared__"],Wp=function(){var e=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Xx=Function.prototype.toString,Rd=function(e){if(e!=null){try{return Xx.call(e)}catch{}return e+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(e,i){return e=e==null?void 0:e[i],!lb(e)||Wp&&Wp in e||!(qi(e)?Zx:Yx).test(Rd(e))?void 0:e},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},zd.prototype.get=function(e){var i=this.__data__;return Zf?(e=i[e])==="__lodash_hash_undefined__"?void 0:e:$x.call(i,e)?i[e]:void 0},zd.prototype.has=function(e){var i=this.__data__;return Zf?i[e]!==void 0:ay.call(i,e)},zd.prototype.set=function(e,i){var h=this.__data__;return this.size+=this.has(e)?0:1,h[e]=Zf&&i===void 0?"__lodash_hash_undefined__":i,this};var $f=function(e,i){return e===i||e!=e&&i!=i},wh=function(e,i){for(var h=e.length;h--;)if($f(e[h][0],i))return h;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(e){var i=this.__data__;return!(0>(e=wh(i,e)))&&(e==i.length-1?i.pop():by.call(i,e,1),--this.size,!0)},ce.prototype.get=function(e){var i=this.__data__;return 0>(e=wh(i,e))?void 0:i[e][1]},ce.prototype.has=function(e){return-1<wh(this.__data__,e)},ce.prototype.set=function(e,i){var h=this.__data__,_=wh(h,e);return 0>_?(++this.size,h.push([e,i])):h[_][1]=i,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(e,i){e=e.__data__;var h=X(i);return(h=="string"||h=="number"||h=="symbol"||h=="boolean"?i!=="__proto__":i===null)?e[typeof i=="string"?"string":"hash"]:e.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(e){return e=xh(this,e).delete(e),this.size-=e?1:0,e},de.prototype.get=function(e){return xh(this,e).get(e)},de.prototype.has=function(e){return xh(this,e).has(e)},de.prototype.set=function(e,i){var h=xh(this,e),_=h.size;return h.set(e,i),this.size+=h.size==_?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},gf.prototype.has=function(e){return this.__data__.has(e)};var Xp=function(e,i,h,_){var j=e.length;for(h+=-1;++h<j;)if(i(e[h],h,e))return h;return-1},cy=function(e){return e!=e},dy=function(e,i){var h;if(h=!(e==null||!e.length)){if(i==i)t:{h=-1;for(var _=e.length;++h<_;)if(e[h]===i){e=h;break t}e=-1}else e=Xp(e,cy,0);h=-1<e}return h},ey=function(e,i,h){for(var _=-1,j=e==null?0:e.length;++_<j;)if(h(i,e[_]))return!0;return!1},fy=function(e,i){return e.has(i)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(e){var i=-1,h=Array(e.size);return e.forEach(function(_){h[++i]=_}),h},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(e){return new Re(e)}:gy,vk=function(e,i,h){var _=-1,j=dy,_t=e.length,Wt=!0,_n=[],_i=_n;if(h)Wt=!1,j=ey;else if(200<=_t){if(j=iy(e))return uk(j);Wt=!1,j=fy,_i=new gf}else _i=_n;t:for(;++_<_t;){var _s=e[_],_u=_s;if(_s=h||_s!==0?_s:0,Wt&&_u==_u){for(var _h=_i.length;_h--;)if(_i[_h]===_u)continue t;_n.push(_s)}else j(_i,_u,h)||(_i!==_n&&_i.push(_u),_n.push(_s))}return _n},Yp=function(e){for(var i=-1,h=e==null?0:e.length,_={};++i<h;){var j=e[i];_[j[0]]=j[1]}return _},he=function(e,i){for(var h=-1,_=e==null?0:e.length,j=Array(_);++h<_;)j[h]=i(e[h],h,e);return j};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(e){var i=this.__data__;return e=i.delete(e),this.size=i.size,e},ee.prototype.get=function(e){return this.__data__.get(e)},ee.prototype.has=function(e){return this.__data__.has(e)},ee.prototype.set=function(e,i){var h=this.__data__;if(h instanceof rg){var _=h.__data__;if(!ag||199>_.length)return _.push([e,i]),this.size=++h.size,this;h=this.__data__=new qg(_)}return h.set(e,i),this.size=h.size,this};var ge=ee,Is=function(e,i){for(var h=-1,_=e==null?0:e.length;++h<_&&i(e[h],h,e)!==!1;);return e},yh=function(){try{var e=Sd(Object,"defineProperty");return e({},"",{}),e}catch{}}(),bg=function(e,i,h){i=="__proto__"&&yh?yh(e,i,{configurable:!0,enumerable:!0,value:h,writable:!0}):e[i]=h},jy=Object.prototype.hasOwnProperty,Ml=function(e,i,h){var _=e[i];jy.call(e,i)&&$f(_,h)&&(h!==void 0||i in e)||bg(e,i,h)},re=function(e,i,h,_){var j=!h;h||(h={});for(var _t=-1,Wt=i.length;++_t<Wt;){var _n=i[_t],_i=void 0;_i===void 0&&(_i=e[_n]),j?bg(h,_n,_i):Ml(h,_n,_i)}return h},gc=function(e){return e!=null&&X(e)=="object"},Zp=function(e){return gc(e)&&Qd(e)=="[object Arguments]"},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(e){return gc(e)&&ky.call(e,"callee")&&!ly.call(e,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a(function(e,i){var h=(i=i&&!i.nodeType&&i)&&e&&!e.nodeType&&e;i=h&&h.exports===i?Cb.Buffer:void 0,e.exports=(i?i.isBuffer:void 0)||my}),ny=/^(?:0|[1-9]\d*)$/,wk=function(e,i){var h=X(e);return!!(i=i??9007199254740991)&&(h=="number"||h!="symbol"&&ny.test(e))&&-1<e&&e%1==0&&e<i},xk=function(e){return typeof e=="number"&&-1<e&&e%1==0&&9007199254740991>=e},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(e){return gc(e)&&xk(e.length)&&!!Ea[Qd(e)]},zh=function(e){return function(i){return e(i)}},Se=$a(function(e,i){var h=i&&!i.nodeType&&i;h=(i=h&&e&&!e.nodeType&&e)&&i.exports===h&&Tp.process;t:{try{var _=i&&i.require&&i.require("util").types;if(_){var j=_;break t}j=h&&h.binding&&h.binding("util");break t}catch{}j=void 0}e.exports=j}),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(e,i){var h=Va(e),_=!h&&rf(e),j=!h&&!_&&jf(e),_t=!h&&!_&&!j&&bi(e);if(h=h||_||j||_t){_=e.length;for(var Wt=String,_n=-1,_i=Array(_);++_n<_;)_i[_n]=Wt(_n);_=_i}else _=[];for(var _s in Wt=_.length,e)!i&&!py.call(e,_s)||h&&(_s=="length"||j&&(_s=="offset"||_s=="parent")||_t&&(_s=="buffer"||_s=="byteLength"||_s=="byteOffset")||wk(_s,Wt))||_.push(_s);return _},qy=Object.prototype,yk=function(e){var i=e&&e.constructor;return e===(typeof i=="function"&&i.prototype||qy)},cq=function(e,i){return function(h){return e(i(h))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(e){return e!=null&&xk(e.length)&&!qi(e)},Ad=function(e){if(Ed(e))e=bq(e);else if(yk(e)){var i,h=[];for(i in Object(e))sy.call(e,i)&&i!="constructor"&&h.push(i);e=h}else e=ry(e);return e},Es=function(e,i){return e&&re(i,Ad(i),e)},ty=Object.prototype.hasOwnProperty,kf=function(e){if(Ed(e))e=bq(e,!0);else if(lb(e)){var i=yk(e),h=[];for(_ in e)(_!="constructor"||!i&&ty.call(e,_))&&h.push(_);e=h}else{var _=[];if(e!=null)for(i in Object(e))_.push(i);e=_}return e},Cs=function(e,i){return e&&re(i,kf(i),e)},Jl=$a(function(e,i){var h=(i=i&&!i.nodeType&&i)&&e&&!e.nodeType&&e,_=(i=h&&h.exports===i?Cb.Buffer:void 0)?i.allocUnsafe:void 0;e.exports=function(j,_t){return _t?j.slice():(_t=j.length,_t=_?_(_t):new j.constructor(_t),j.copy(_t),_t)}}),Xh=function(e,i){var h=-1,_=e.length;for(i||(i=Array(_));++h<_;)i[h]=e[h];return i},uy=function(e,i){for(var h=-1,_=e==null?0:e.length,j=0,_t=[];++h<_;){var Wt=e[h];i(Wt,h,e)&&(_t[j++]=Wt)}return _t},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(e){return e==null?[]:(e=Object(e),uy(eq(e),function(i){return vy.call(e,i)}))}:dq,Ds=function(e,i){return re(e,zk(e),i)},ai=function(e,i){for(var h=-1,_=i.length,j=e.length;++h<_;)e[j+h]=i[h];return e},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(e){for(var i=[];e;)ai(i,zk(e)),e=Ak(e);return i}:dq,Bs=function(e,i){return re(e,fq(e),i)},gq=function(e,i,h){return i=i(e),Va(e)?i:ai(i,h(e))},Yh=function(e){return gq(e,Ad,zk)},Ll=function(e){return gq(e,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&Td(new Bk(new ArrayBuffer(1)))!="[object DataView]"||ag&&Td(new ag)!="[object Map]"||Ck&&Td(Ck.resolve())!="[object Promise]"||Re&&Td(new Re)!="[object Set]"||Dk&&Td(new Dk)!="[object WeakMap]")&&(Td=function(e){var i=Qd(e);if(e=(e=i=="[object Object]"?e.constructor:void 0)?Rd(e):"")switch(e){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return i});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(e){var i=e.length,h=new e.constructor(i);return i&&typeof e[0]=="string"&&By.call(e,"index")&&(h.index=e.index,h.input=e.input),h},Ah=Cb.Uint8Array,Ek=function(e){var i=new e.constructor(e.byteLength);return new Ah(i).set(new Ah(e)),i},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(e,i){return i=i?Ek(e.buffer):e.buffer,new e.constructor(i,e.byteOffset,e.length)},Fs=function(e,i,h){var _=e.constructor;switch(i){case"[object ArrayBuffer]":return Ek(e);case"[object Boolean]":case"[object Date]":return new _(+e);case"[object DataView]":return i=h?Ek(e.buffer):e.buffer,new e.constructor(i,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(e,h);case"[object Map]":return new _;case"[object Number]":case"[object String]":return new _(e);case"[object RegExp]":return(i=new e.constructor(e.source,Cy.exec(e))).lastIndex=e.lastIndex,i;case"[object Set]":return new _;case"[object Symbol]":return iq?Object(iq.call(e)):{}}},jq=Object.create,Dy=function(){function e(){}return function(i){return lb(i)?jq?jq(i):(e.prototype=i,i=new e,e.prototype=void 0,i):{}}}(),Kl=function(e){return typeof e.constructor!="function"||yk(e)?{}:Dy(Ak(e))},Ey=function(e){return gc(e)&&hf(e)=="[object Map]"},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(e){return gc(e)&&hf(e)=="[object Set]"},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(e){return X(e)=="symbol"||gc(e)&&Qd(e)=="[object Symbol]"},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(e,i){if(Va(e))return!1;var h=X(e);return!(h!="number"&&h!="symbol"&&h!="boolean"&&e!=null&&!ie(e))||Hy.test(e)||!Gy.test(e)||i!=null&&e in Object(i)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(e){var i=(e=Zh(e,function(h){return i.size===500&&i.clear(),h})).cache;return e}(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace(Iy,function(h,_,j,_t){i.push(j?_t.replace(Jy,"$1"):_||h)}),i}),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(e,i){return Va(e)?e:Fk(e,i)?[e]:Ky(e==null?"":Nl(e))},Ly=1/0,cg=function(e){if(typeof e=="string"||ie(e))return e;var i=e+"";return i=="0"&&1/e==-Ly?"-0":i},Ch=function(e,i){for(var h=0,_=(i=Bh(i,e)).length;e!=null&&h<_;)e=e[cg(i[h++])];return h&&h==_?e:void 0},My=function(e,i){if(!(2>(i=Bh(i,e)).length)){var h=i,_=0,j=-1,_t=-1,Wt=h.length;for(0>_&&(_=-_>Wt?0:Wt+_),0>(j=j>Wt?Wt:j)&&(j+=Wt),Wt=_>j?0:j-_>>>0,_>>>=0,j=Array(Wt);++_t<Wt;)j[_t]=h[_t+_];e=Ch(e,j)}return(h=e==null)||(h=i==null?0:i.length,h=delete e[cg(h?i[h-1]:void 0)]),h},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(e){return!(!gc(e)||Qd(e)!="[object Object]")&&((e=Ak(e))===null||typeof(e=Ny.call(e,"constructor")&&e.constructor)=="function"&&e instanceof e&&nq.call(e)==Oy)},Py=function(e){return wm(e)?void 0:e},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(e){return Va(e)||rf(e)||!!(oq&&e&&e[oq])},Qy=function(e){return e!=null&&e.length?$h(e):[]},Ry=function(e,i,h){switch(h.length){case 0:return e.call(i);case 1:return e.call(i,h[0]);case 2:return e.call(i,h[0],h[1]);case 3:return e.call(i,h[0],h[1],h[2])}return e.apply(i,h)},pq=Math.max,qq=function(e,i,h){return i=pq(i===void 0?e.length-1:i,0),function(){for(var _=arguments,j=-1,_t=pq(_.length-i,0),Wt=Array(_t);++j<_t;)Wt[j]=_[i+j];for(j=-1,_t=Array(i+1);++j<i;)_t[j]=_[j];return _t[i]=h(Wt),Ry(e,this,_t)}},Sy=function(e){return function(){return e}},Dh=function(e){return e},Ty=Date.now,rq=function(e){var i=0,h=0;return function(){var _=Ty(),j=16-(_-h);if(h=_,0<j){if(800<=++i)return arguments[0]}else i=0;return e.apply(void 0,arguments)}}(yh?function(e,i){return yh(e,"toString",{configurable:!0,enumerable:!1,value:Sy(i),writable:!0})}:Dh),Gk=function(e){return rq(qq(e,void 0,Qy),e+"")}(function(e,i){var h={};if(e==null)return h;var _=!1;i=he(i,function(_t){return _t=Bh(_t,e),_||(_=1<_t.length),_t}),re(e,Ll(e),h),_&&(h=fe(h,7,Py));for(var j=i.length;j--;)My(h,i[j]);return h}),Uy=function(e,i,h,_){for(var j=-1,_t=e==null?0:e.length;++j<_t;){var Wt=e[j];i(_,Wt,h(Wt),e)}return _},um=function(e,i,h){for(var _=-1,j=Object(e),_t=(h=h(e)).length;_t--;){var Wt=h[++_];if(i(j[Wt],Wt,j)===!1)break}return e},sq=function(e,i){return e&&um(e,i,Ad)},Hk=function(e,i){return function(h,_){if(h==null)return h;if(!Ed(h))return e(h,_);for(var j=h.length,_t=-1,Wt=Object(h);++_t<j&&_(Wt[_t],_t,Wt)!==!1;);return h}}(sq),Vy=function(e,i,h,_){return Hk(e,function(j,_t,Wt){i(_,j,h(j),Wt)}),_},tq=function(e,i){for(var h=-1,_=e==null?0:e.length;++h<_;)if(i(e[h],h,e))return!0;return!1},Pl=function(e,i,h,_,j,_t){var Wt=1&h,_n=e.length,_i=i.length;if(_n!=_i&&!(Wt&&_i>_n))return!1;_i=_t.get(e);var _s=_t.get(i);if(_i&&_s)return _i==i&&_s==e;_i=-1,_s=!0;var _u=2&h?new gf:void 0;for(_t.set(e,i),_t.set(i,e);++_i<_n;){var _h=e[_i],_d=i[_i];if(_)var nE=Wt?_(_d,_h,_i,i,e,_t):_(_h,_d,_i,e,i,_t);if(nE!==void 0){if(nE)continue;_s=!1;break}if(_u){if(!tq(i,function(aE,uE){if(!_u.has(uE)&&(_h===aE||j(_h,aE,h,_,_t)))return _u.push(uE)})){_s=!1;break}}else if(_h!==_d&&!j(_h,_d,h,_,_t)){_s=!1;break}}return _t.delete(e),_t.delete(i),_s},Wy=function(e){var i=-1,h=Array(e.size);return e.forEach(function(_,j){h[++i]=[j,_]}),h},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(e,i,h,_,j,_t,Wt){switch(h){case"[object DataView]":if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)break;e=e.buffer,i=i.buffer;case"[object ArrayBuffer]":if(e.byteLength!=i.byteLength||!_t(new Ah(e),new Ah(i)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+e,+i);case"[object Error]":return e.name==i.name&&e.message==i.message;case"[object RegExp]":case"[object String]":return e==i+"";case"[object Map]":var _n=Wy;case"[object Set]":if(_n||(_n=uk),e.size!=i.size&&!(1&_))break;return(h=Wt.get(e))?h==i:(_|=2,Wt.set(e,i),i=Pl(_n(e),_n(i),_,j,_t,Wt),Wt.delete(e),i);case"[object Symbol]":if(Ik)return Ik.call(e)==Ik.call(i)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(e,i,h,_){var j=h.length,_t=j;if(e==null)return!_t;for(e=Object(e);j--;){var Wt=h[j];if(Wt[2]?Wt[1]!==e[Wt[0]]:!(Wt[0]in e))return!1}for(;++j<_t;){var _n=(Wt=h[j])[0],_i=e[_n],_s=Wt[1];if(Wt[2]){if(_i===void 0&&!(_n in e))return!1}else{var _u;if(Wt=new ge,_u===void 0?!je(_s,_i,3,_,Wt):!_u)return!1}}return!0},Yy=function(e){for(var i=Ad(e),h=i.length;h--;){var _=i[h],j=e[_];i[h]=[_,j,j==j&&!lb(j)]}return i},vq=function(e,i){return function(h){return h!=null&&h[e]===i&&(i!==void 0||e in Object(h))}},Zy=function(e){var i=Yy(e);return i.length==1&&i[0][2]?vq(i[0][0],i[0][1]):function(h){return h===e||Xy(h,e,i)}},$y=function(e,i){return Fk(e)&&i==i&&!lb(i)?vq(cg(e),i):function(h){var _=h==null?void 0:Ch(h,e);if((_=_===void 0?void 0:_)===void 0&&_===i){if(_=h!=null){for(var j=-1,_t=(_=Bh(_=e,h)).length,Wt=!1;++j<_t;){var _n=cg(_[j]);if(!(Wt=h!=null&&h!=null&&_n in Object(h)))break;h=h[_n]}Wt||++j!=_t?_=Wt:_=!!(_t=h==null?0:h.length)&&xk(_t)&&wk(_n,_t)&&(Va(h)||rf(h))}_n=_}else _n=je(i,_,3);return _n}},az=function(e){return function(i){return i==null?void 0:i[e]}},bz=function(e){return function(i){return Ch(i,e)}},Te=function(e){return typeof e=="function"?e:e==null?Dh:X(e)=="object"?Va(e)?$y(e[0],e[1]):Zy(e):Fk(e)?az(cg(e)):bz(e)},Jk=function(e,i){return function(h,_){var j={};return(Va(h)?Uy:Vy)(h,e,Te(_),j)}}(function(e,i,h){bg(e,h,i)}),uc=function(e,i){var h={};return i=Te(i),sq(e,function(_,j,_t){bg(h,j,i(_,j,_t))}),h};N({target:"String",proto:!0,forced:R(function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length})},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var i=Gb(e),h=this.div(i);return i=h.mul(i).sub(this),h.toString(e)+i.toInt().toString(e)}return"-"+this.neg().toString(e)}h=Gb(sg(e,6),this.unsigned),i=this;for(var _="";;){var j=i.div(h),_t=(i.sub(j.mul(h)).toInt()>>>0).toString(e);if((i=j).isZero())return _t+_;for(;6>_t.length;)_t="0"+_t;_=""+_t+_}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,i=31;0<i&&!(e&1<<i);i--);return this.high!=0?i+33:i+1},D.isZero=function(){return this.high===0&&this.low===0},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return(1&this.low)==1},D.isEven=function(){return(1&this.low)==0},D.equals=function(e){return mb(e)||(e=Wb(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},D.eq=D.equals,D.notEquals=function(e){return!this.eq(e)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(e){return 0>this.comp(e)},D.lt=D.lessThan,D.lessThanOrEqual=function(e){return 0>=this.comp(e)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(e){return 0<this.comp(e)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(e){return 0<=this.comp(e)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(e){if(mb(e)||(e=Wb(e)),this.eq(e))return 0;var i=this.isNegative(),h=e.isNegative();return i&&!h?-1:!i&&h?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(e){mb(e)||(e=Wb(e));var i=this.high>>>16,h=65535&this.high,_=this.low>>>16,j=e.high>>>16,_t=65535&e.high,Wt=e.low>>>16;return _=(Wt=((e=(65535&this.low)+(65535&e.low))>>>16)+(_+Wt))>>>16,ya((65535&Wt)<<16|65535&e,(i=((_+=h+_t)>>>16)+(i+j)&65535)<<16|65535&_,this.unsigned)},D.subtract=function(e){return mb(e)||(e=Wb(e)),this.add(e.neg())},D.sub=D.subtract,D.multiply=function(e){if(this.isZero())return Hb;if(mb(e)||(e=Wb(e)),Qb){var i=Qb.mul(this.low,this.high,e.low,e.high);return ya(i,Qb.get_high(),this.unsigned)}if(e.isZero())return Hb;if(this.eq(nb))return e.isOdd()?nb:Hb;if(e.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(wq)&&e.lt(wq))return Gb(this.toNumber()*e.toNumber(),this.unsigned);i=this.high>>>16;var h=65535&this.high,_=this.low>>>16,j=65535&this.low,_t=e.high>>>16,Wt=65535&e.high,_n=e.low>>>16,_i=j*(e=65535&e.low),_s=(_i>>>16)+_*e,_u=_s>>>16;_u+=(_s=(65535&_s)+j*_n)>>>16;var _h=(_u+=h*e)>>>16;return ya((65535&_s)<<16|65535&_i,(_h=(_h+=(_u=(65535&_u)+_*_n)>>>16)+((_u=(65535&_u)+j*Wt)>>>16)+(i*e+h*_n+_*Wt+j*_t)&65535)<<16|65535&_u,this.unsigned)},D.mul=D.multiply,D.divide=function(e){if(mb(e)||(e=Wb(e)),e.isZero())throw Error("division by zero");if(Qb)return this.unsigned||this.high!==-2147483648||e.low!==-1||e.high!==-1?ya(e=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Cd;if(e.gt(this.shru(1)))return xq;var i=Cd}else{if(this.eq(nb)){if(e.eq(Ue)||e.eq(Kk))return nb;if(e.eq(nb))return Ue;var h=this.shr(1).div(e).shl(1);if(h.eq(Hb))return e.isNegative()?Ue:Kk;var _=this.sub(e.mul(h));return h.add(_.div(e))}if(e.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Hb}for(_=this;_.gte(e);){h=Math.max(1,Math.floor(_.toNumber()/e.toNumber()));var j=Math.ceil(Math.log(h)/Math.LN2);j=48>=j?1:sg(2,j-48);for(var _t=Gb(h),Wt=_t.mul(e);Wt.isNegative()||Wt.gt(_);)Wt=(_t=Gb(h-=j,this.unsigned)).mul(e);_t.isZero()&&(_t=Ue),i=i.add(_t),_=_.sub(Wt)}return i},D.div=D.divide,D.modulo=function(e){return mb(e)||(e=Wb(e)),Qb?ya(e=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(e){return mb(e)||(e=Wb(e)),ya(this.low&e.low,this.high&e.high,this.unsigned)},D.or=function(e){return mb(e)||(e=Wb(e)),ya(this.low|e.low,this.high|e.high,this.unsigned)},D.xor=function(e){return mb(e)||(e=Wb(e)),ya(this.low^e.low,this.high^e.high,this.unsigned)},D.shiftLeft=function(e){return mb(e)&&(e=e.toInt()),(e&=63)==0?this:32>e?ya(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ya(0,this.low<<e-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(e){return mb(e)&&(e=e.toInt()),(e&=63)==0?this:32>e?ya(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ya(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(e){if(mb(e)&&(e=e.toInt()),(e&=63)===0)return this;var i=this.high;return 32>e?ya(this.low>>>e|i<<32-e,i>>>e,this.unsigned):ya(e===32?i:i>>>e-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var e=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},D.toBytesBE=function(){var e=this.high,i=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,i>>>24,i>>>16&255,i>>>8&255,255&i]},xa.fromBytes=function(e,i,h){return h?xa.fromBytesLE(e,i):xa.fromBytesBE(e,i)},xa.fromBytesLE=function(e,i){return new xa(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,i)},xa.fromBytesBE=function(e,i){return new xa(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],i)};var di=function(e,i){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,_){h.__proto__=_}||function(h,_){for(var j in _)_.hasOwnProperty(j)&&(h[j]=_[j])})(e,i)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=e},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(e){},error:function(e){if(Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)},complete:function(){}},Jb=Array.isArray||function(e){return e&&typeof e.length=="number"},lf=function(){function e(i){return Error.call(this),this.message=i?i.length+` errors occurred during unsubscription:
`+i.map(function(h,_){return _+1+") "+h.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=i,this}return e.prototype=Object.create(Error.prototype),e}(),Oa=function(){function e(i){this.closed=!1,this._subscriptions=this._parentOrParents=null,i&&(this._ctorUnsubscribe=!0,this._unsubscribe=i)}return e.prototype.unsubscribe=function(){if(!this.closed){var i=this._parentOrParents,h=this._ctorUnsubscribe,_=this._unsubscribe,j=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,i instanceof e)i.remove(this);else if(i!==null)for(var _t=0;_t<i.length;++_t)i[_t].remove(this);if(le(_)){h&&(this._unsubscribe=void 0);try{_.call(this)}catch(_n){var Wt=_n instanceof lf?Xl(_n.errors):[_n]}}if(Jb(j)){for(_t=-1,i=j.length;++_t<i;)if(ei(h=j[_t]))try{h.unsubscribe()}catch(_n){Wt=Wt||[],_n instanceof lf?Wt=Wt.concat(Xl(_n.errors)):Wt.push(_n)}}if(Wt)throw new lf(Wt)}},e.prototype.add=function(i){var h=i;if(!i)return e.EMPTY;switch(X(i)){case"function":h=new e(i);case"object":if(h===this||h.closed||typeof h.unsubscribe!="function")return h;if(this.closed)return h.unsubscribe(),h;h instanceof e||(i=h,(h=new e)._subscriptions=[i]);break;default:throw Error("unrecognized teardown "+i+" added to Subscription.")}if((i=h._parentOrParents)===null)h._parentOrParents=this;else if(i instanceof e){if(i===this)return h;h._parentOrParents=[i,this]}else{if(i.indexOf(this)!==-1)return h;i.push(this)}return(i=this._subscriptions)===null?this._subscriptions=[h]:i.push(h),h},e.prototype.remove=function(i){var h=this._subscriptions;h&&(i=h.indexOf(i))!==-1&&h.splice(i,1)},e.EMPTY=function(i){return i.closed=!0,i}(new e),e}(),Fh=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(e){function i(h,_,j){var _t=e.call(this)||this;switch(_t.syncErrorValue=null,_t.syncErrorThrown=!1,_t.syncErrorThrowable=!1,_t.isStopped=!1,arguments.length){case 0:_t.destination=Eh;break;case 1:if(!h){_t.destination=Eh;break}if(X(h)==="object"){h instanceof i?(_t.syncErrorThrowable=h.syncErrorThrowable,_t.destination=h,h.add(_t)):(_t.syncErrorThrowable=!0,_t.destination=new yq(_t,h));break}default:_t.syncErrorThrowable=!0,_t.destination=new yq(_t,h,_,j)}return _t}return O(i,e),i.prototype[Fh]=function(){return this},i.create=function(h,_,j){return(h=new i(h,_,j)).syncErrorThrowable=!1,h},i.prototype.next=function(h){this.isStopped||this._next(h)},i.prototype.error=function(h){this.isStopped||(this.isStopped=!0,this._error(h))},i.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},i.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},i.prototype._next=function(h){this.destination.next(h)},i.prototype._error=function(h){this.destination.error(h),this.unsubscribe()},i.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},i.prototype._unsubscribeAndRecycle=function(){var h=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=h,this},i}(Oa),yq=function(e){function i(h,_,j,_t){var Wt=e.call(this)||this;if(Wt._parentSubscriber=h,h=Wt,le(_))var _n=_;else _&&(_n=_.next,j=_.error,_t=_.complete,_!==Eh&&(le((h=Object.create(_)).unsubscribe)&&Wt.add(h.unsubscribe.bind(h)),h.unsubscribe=Wt.unsubscribe.bind(Wt)));return Wt._context=h,Wt._next=_n,Wt._error=j,Wt._complete=_t,Wt}return O(i,e),i.prototype.next=function(h){if(!this.isStopped&&this._next){var _=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&_.syncErrorThrowable?this.__tryOrSetError(_,this._next,h)&&this.unsubscribe():this.__tryOrUnsub(this._next,h)}},i.prototype.error=function(h){if(!this.isStopped){var _=this._parentSubscriber,j=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)j&&_.syncErrorThrowable?this.__tryOrSetError(_,this._error,h):this.__tryOrUnsub(this._error,h),this.unsubscribe();else if(_.syncErrorThrowable)j?(_.syncErrorValue=h,_.syncErrorThrown=!0):me(h),this.unsubscribe();else{if(this.unsubscribe(),j)throw h;me(h)}}},i.prototype.complete=function(){var h=this;if(!this.isStopped){var _=this._parentSubscriber;if(this._complete){var j=function(){return h._complete.call(h._context)};Ib.useDeprecatedSynchronousErrorHandling&&_.syncErrorThrowable?this.__tryOrSetError(_,j):this.__tryOrUnsub(j)}this.unsubscribe()}},i.prototype.__tryOrUnsub=function(h,_){try{h.call(this._context,_)}catch(j){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw j;me(j)}},i.prototype.__tryOrSetError=function(h,_,j){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{_.call(this._context,j)}catch(_t){return Ib.useDeprecatedSynchronousErrorHandling?(h.syncErrorValue=_t,h.syncErrorThrown=!0):me(_t),!0}return!1},i.prototype._unsubscribe=function(){var h=this._parentSubscriber;this._parentSubscriber=this._context=null,h.unsubscribe()},i}(ia),ne=typeof Symbol=="function"&&Symbol.observable||"@@observable",Y=function(){function e(i){this._isScalar=!1,i&&(this._subscribe=i)}return e.prototype.lift=function(i){var h=new e;return h.source=this,h.operator=i,h},e.prototype.subscribe=function(i,h,_){var j=this.operator;t:{if(i){if(i instanceof ia)break t;if(i[Fh]){i=i[Fh]();break t}}i=i||h||_?new ia(i,h,_):new ia(Eh)}if(j?i.add(j.call(i,this.source)):i.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),Ib.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(i){try{return this._subscribe(i)}catch(h){Ib.useDeprecatedSynchronousErrorHandling&&(i.syncErrorThrown=!0,i.syncErrorValue=h),fi(i)?i.error(h):console.warn(h)}},e.prototype.forEach=function(i,h){var _=this;return new(h=Zl(h))(function(j,_t){var Wt=_.subscribe(function(_n){try{i(_n)}catch(_i){_t(_i),Wt&&Wt.unsubscribe()}},_t,j)})},e.prototype._subscribe=function(i){var h=this.source;return h&&h.subscribe(i)},e.prototype[ne]=function(){return this},e.prototype.pipe=function(){for(var i=[],h=0;h<arguments.length;h++)i[h]=arguments[h];return i.length===0?this:Yl(i)(this)},e.prototype.toPromise=function(i){var h=this;return new(i=Zl(i))(function(_,j){var _t;h.subscribe(function(Wt){return _t=Wt},function(Wt){return j(Wt)},function(){return _(_t)})})},e.create=function(i){return new e(i)},e}(),qd=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),zq=function(e){function i(h,_){var j=e.call(this)||this;return j.subject=h,j.subscriber=_,j.closed=!1,j}return O(i,e),i.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var h=this.subject,_=h.observers;this.subject=null,!_||_.length===0||h.isStopped||h.closed||(h=_.indexOf(this.subscriber))!==-1&&_.splice(h,1)}},i}(Oa),Aq=function(e){function i(h){var _=e.call(this,h)||this;return _.destination=h,_}return O(i,e),i}(ia),Pa=function(e){function i(){var h=e.call(this)||this;return h.observers=[],h.closed=!1,h.isStopped=!1,h.hasError=!1,h.thrownError=null,h}return O(i,e),i.prototype[Fh]=function(){return new Aq(this)},i.prototype.lift=function(h){var _=new Bq(this,this);return _.operator=h,_},i.prototype.next=function(h){if(this.closed)throw new qd;if(!this.isStopped){var _=this.observers,j=_.length;_=_.slice();for(var _t=0;_t<j;_t++)_[_t].next(h)}},i.prototype.error=function(h){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=h,this.isStopped=!0;var _=this.observers,j=_.length;_=_.slice();for(var _t=0;_t<j;_t++)_[_t].error(h);this.observers.length=0},i.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var h=this.observers,_=h.length;h=h.slice();for(var j=0;j<_;j++)h[j].complete();this.observers.length=0},i.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},i.prototype._trySubscribe=function(h){if(this.closed)throw new qd;return e.prototype._trySubscribe.call(this,h)},i.prototype._subscribe=function(h){if(this.closed)throw new qd;return this.hasError?(h.error(this.thrownError),Oa.EMPTY):this.isStopped?(h.complete(),Oa.EMPTY):(this.observers.push(h),new zq(this,h))},i.prototype.asObservable=function(){var h=new Y;return h.source=this,h},i.create=function(h,_){return new Bq(h,_)},i}(Y),Bq=function(e){function i(h,_){var j=e.call(this)||this;return j.destination=h,j.source=_,j}return O(i,e),i.prototype.next=function(h){var _=this.destination;_&&_.next&&_.next(h)},i.prototype.error=function(h){var _=this.destination;_&&_.error&&this.destination.error(h)},i.prototype.complete=function(){var h=this.destination;h&&h.complete&&this.destination.complete()},i.prototype._subscribe=function(h){return this.source?this.source.subscribe(h):Oa.EMPTY},i}(Pa),Ns=function(){function e(i){this.connectable=i}return e.prototype.call=function(i,h){var _=this.connectable;return _._refCount++,i=new cz(i,_),h=h.subscribe(i),i.closed||(i.connection=_.connect()),h},e}(),cz=function(e){function i(h,_){return(h=e.call(this,h)||this).connectable=_,h}return O(i,e),i.prototype._unsubscribe=function(){var h=this.connectable;if(h){this.connectable=null;var _=h._refCount;0>=_?this.connection=null:(h._refCount=_-1,1<_?this.connection=null:(_=this.connection,h=h._connection,this.connection=null,!h||_&&h!==_||h.unsubscribe()))}else this.connection=null},i}(ia),Cq=function(e){function i(h,_){var j=e.call(this)||this;return j.source=h,j.subjectFactory=_,j._refCount=0,j._isComplete=!1,j}return O(i,e),i.prototype._subscribe=function(h){return this.getSubject().subscribe(h)},i.prototype.getSubject=function(){var h=this._subject;return h&&!h.isStopped||(this._subject=this.subjectFactory()),this._subject},i.prototype.connect=function(){var h=this._connection;return h||(this._isComplete=!1,(h=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),h.closed&&(this._connection=null,h=Oa.EMPTY)),h},i.prototype.refCount=function(){return $l()(this)},i}(Y),At=function(){var e=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),dz=function(e){function i(h,_){return(h=e.call(this,h)||this).connectable=_,h}return O(i,e),i.prototype._error=function(h){this._unsubscribe(),e.prototype._error.call(this,h)},i.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},i.prototype._unsubscribe=function(){var h=this.connectable;if(h){this.connectable=null;var _=h._connection;h._refCount=0,h._subject=null,h._connection=null,_&&_.unsubscribe()}},i}(Aq);(function(e){function i(h,_){return(h=e.call(this,h)||this).connectable=_,h}O(i,e),i.prototype._unsubscribe=function(){var h=this.connectable;if(h){this.connectable=null;var _=h._refCount;0>=_?this.connection=null:(h._refCount=_-1,1<_?this.connection=null:(_=this.connection,h=h._connection,this.connection=null,!h||_&&h!==_||h.unsubscribe()))}else this.connection=null}})(ia),function(e){function i(h,_,j,_t,Wt){return(h=e.call(this,h)||this).keySelector=_,h.elementSelector=j,h.durationSelector=_t,h.subjectSelector=Wt,h.groups=null,h.attemptedToUnsubscribe=!1,h.count=0,h}O(i,e),i.prototype._next=function(h){try{var _=this.keySelector(h)}catch(j){return void this.error(j)}this._group(h,_)},i.prototype._group=function(h,_){var j=this.groups;j||(j=this.groups=new Map);var _t=j.get(_);if(this.elementSelector)try{var Wt=this.elementSelector(h)}catch(_n){this.error(_n)}else Wt=h;if(!_t&&(_t=this.subjectSelector?this.subjectSelector():new Pa,j.set(_,_t),h=new Mk(_,_t,this),this.destination.next(h),this.durationSelector)){h=void 0;try{h=this.durationSelector(new Mk(_,_t))}catch(_n){return void this.error(_n)}this.add(h.subscribe(new ez(_,_t,this)))}_t.closed||_t.next(Wt)},i.prototype._error=function(h){var _=this.groups;_&&(_.forEach(function(j,_t){j.error(h)}),_.clear()),this.destination.error(h)},i.prototype._complete=function(){var h=this.groups;h&&(h.forEach(function(_,j){_.complete()}),h.clear()),this.destination.complete()},i.prototype.removeGroup=function(h){this.groups.delete(h)},i.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&e.prototype.unsubscribe.call(this))}}(ia);var ez=function(e){function i(h,_,j){var _t=e.call(this,_)||this;return _t.key=h,_t.group=_,_t.parent=j,_t}return O(i,e),i.prototype._next=function(h){this.complete()},i.prototype._unsubscribe=function(){var h=this.parent,_=this.key;this.key=this.parent=null,h&&h.removeGroup(_)},i}(ia),Mk=function(e){function i(h,_,j){var _t=e.call(this)||this;return _t.key=h,_t.groupSubject=_,_t.refCountSubscription=j,_t}return O(i,e),i.prototype._subscribe=function(h){var _=new Oa,j=this.refCountSubscription,_t=this.groupSubject;return j&&!j.closed&&_.add(new fz(j)),_.add(_t.subscribe(h)),_},i}(Y),fz=function(e){function i(h){var _=e.call(this)||this;return _.parent=h,h.count++,_}return O(i,e),i.prototype.unsubscribe=function(){var h=this.parent;h.closed||this.closed||(e.prototype.unsubscribe.call(this),--h.count,h.count===0&&h.attemptedToUnsubscribe&&h.unsubscribe())},i}(Oa),gz=function(e){function i(h){var _=e.call(this)||this;return _._value=h,_}return O(i,e),Object.defineProperty(i.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),i.prototype._subscribe=function(h){var _=e.prototype._subscribe.call(this,h);return _&&!_.closed&&h.next(this._value),_},i.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},i.prototype.next=function(h){e.prototype.next.call(this,this._value=h)},i}(Pa),dg=function(e){function i(h,_){var j=e.call(this,h,_)||this;return j.scheduler=h,j.work=_,j.pending=!1,j}return O(i,e),i.prototype.schedule=function(h,_){if(_===void 0&&(_=0),this.closed)return this;this.state=h,h=this.id;var j=this.scheduler;return h!=null&&(this.id=this.recycleAsyncId(j,h,_)),this.pending=!0,this.delay=_,this.id=this.id||this.requestAsyncId(j,this.id,_),this},i.prototype.requestAsyncId=function(h,_,j){return j===void 0&&(j=0),setInterval(h.flush.bind(h,this),j)},i.prototype.recycleAsyncId=function(h,_,j){if(j===void 0&&(j=0),j!==null&&this.delay===j&&this.pending===!1)return _;clearInterval(_)},i.prototype.execute=function(h,_){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(h=this._execute(h,_))?h:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},i.prototype._execute=function(h,_){_=!1;var j=void 0;try{this.work(h)}catch(_t){_=!0,j=!!_t&&_t||Error(_t)}if(_)return this.unsubscribe(),j},i.prototype._unsubscribe=function(){var h=this.id,_=this.scheduler,j=_.actions,_t=j.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,_t!==-1&&j.splice(_t,1),h!=null&&(this.id=this.recycleAsyncId(_,h,null)),this.delay=null},i}(function(e){function i(h,_){return e.call(this)||this}return O(i,e),i.prototype.schedule=function(h,_){return this},i}(Oa)),hz=function(e){function i(h,_){var j=e.call(this,h,_)||this;return j.scheduler=h,j.work=_,j}return O(i,e),i.prototype.schedule=function(h,_){return _===void 0&&(_=0),0<_?e.prototype.schedule.call(this,h,_):(this.delay=_,this.state=h,this.scheduler.flush(this),this)},i.prototype.execute=function(h,_){return 0<_||this.closed?e.prototype.execute.call(this,h,_):this._execute(h,_)},i.prototype.requestAsyncId=function(h,_,j){return j===void 0&&(j=0),j!==null&&0<j||j===null&&0<this.delay?e.prototype.requestAsyncId.call(this,h,_,j):h.flush(this)},i}(dg),Nk=function(){function e(i,h){h===void 0&&(h=e.now),this.SchedulerAction=i,this.now=h}return e.prototype.schedule=function(i,h,_){return h===void 0&&(h=0),new this.SchedulerAction(this,i).schedule(_,h)},e.now=function(){return Date.now()},e}(),eg=function(e){function i(h,_){_===void 0&&(_=Nk.now);var j=e.call(this,h,function(){return i.delegate&&i.delegate!==j?i.delegate.now():_()})||this;return j.actions=[],j.active=!1,j.scheduled=void 0,j}return O(i,e),i.prototype.schedule=function(h,_,j){return _===void 0&&(_=0),i.delegate&&i.delegate!==this?i.delegate.schedule(h,_,j):e.prototype.schedule.call(this,h,_,j)},i.prototype.flush=function(h){var _=this.actions;if(this.active)_.push(h);else{var j;this.active=!0;do if(j=h.execute(h.state,h.delay))break;while(h=_.shift());if(this.active=!1,j){for(;h=_.shift();)h.unsubscribe();throw j}}},i}(Nk),fg=new(function(e){function i(){return e!==null&&e.apply(this,arguments)||this}return O(i,e),i}(eg))(hz),vb=new Y(function(e){return e.complete()}),am=function(e){return function(i){for(var h=0,_=e.length;h<_&&!i.closed;h++)i.next(e[h]);i.complete()}},Ok;(function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"})(Ok||(Ok={}));var Ve=function(){function e(i,h,_){this.kind=i,this.value=h,this.error=_,this.hasValue=i==="N"}return e.prototype.observe=function(i){switch(this.kind){case"N":return i.next&&i.next(this.value);case"E":return i.error&&i.error(this.error);case"C":return i.complete&&i.complete()}},e.prototype.do=function(i,h,_){switch(this.kind){case"N":return i&&i(this.value);case"E":return h&&h(this.error);case"C":return _&&_()}},e.prototype.accept=function(i,h,_){return i&&typeof i.next=="function"?this.observe(i):this.do(i,h,_)},e.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},e.createNext=function(i){return i!==void 0?new e("N",i):e.undefinedValueNotification},e.createError=function(i){return new e("E",void 0,i)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Rs=function(){function e(i,h){h===void 0&&(h=0),this.scheduler=i,this.delay=h}return e.prototype.call=function(i,h){return h.subscribe(new Dq(i,this.scheduler,this.delay))},e}(),Dq=function(e){function i(h,_,j){return j===void 0&&(j=0),(h=e.call(this,h)||this).scheduler=_,h.delay=j,h}return O(i,e),i.dispatch=function(h){h.notification.observe(h.destination),this.unsubscribe()},i.prototype.scheduleMessage=function(h){this.destination.add(this.scheduler.schedule(i.dispatch,this.delay,new iz(h,this.destination)))},i.prototype._next=function(h){this.scheduleMessage(Ve.createNext(h))},i.prototype._error=function(h){this.scheduleMessage(Ve.createError(h)),this.unsubscribe()},i.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},i}(ia),iz=function(e,i){this.notification=e,this.destination=i},qe=function(e){function i(h,_,j){h===void 0&&(h=Number.POSITIVE_INFINITY),_===void 0&&(_=Number.POSITIVE_INFINITY);var _t=e.call(this)||this;return _t.scheduler=j,_t._events=[],_t._infiniteTimeWindow=!1,_t._bufferSize=1>h?1:h,_t._windowTime=1>_?1:_,_===Number.POSITIVE_INFINITY?(_t._infiniteTimeWindow=!0,_t.next=_t.nextInfiniteTimeWindow):_t.next=_t.nextTimeWindow,_t}return O(i,e),i.prototype.nextInfiniteTimeWindow=function(h){if(!this.isStopped){var _=this._events;_.push(h),_.length>this._bufferSize&&_.shift()}e.prototype.next.call(this,h)},i.prototype.nextTimeWindow=function(h){this.isStopped||(this._events.push(new jz(this._getNow(),h)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,h)},i.prototype._subscribe=function(h){var _=this._infiniteTimeWindow,j=_?this._events:this._trimBufferThenGetEvents(),_t=this.scheduler,Wt=j.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var _n=Oa.EMPTY;else this.observers.push(h),_n=new zq(this,h);if(_t&&h.add(h=new Dq(h,_t)),_)for(_=0;_<Wt&&!h.closed;_++)h.next(j[_]);else for(_=0;_<Wt&&!h.closed;_++)h.next(j[_].value);return this.hasError?h.error(this.thrownError):this.isStopped&&h.complete(),_n},i.prototype._getNow=function(){return(this.scheduler||fg).now()},i.prototype._trimBufferThenGetEvents=function(){for(var h=this._getNow(),_=this._bufferSize,j=this._windowTime,_t=this._events,Wt=_t.length,_n=0;_n<Wt&&!(h-_t[_n].time<j);)_n++;return Wt>_&&(_n=Math.max(_n,Wt-_)),0<_n&&_t.splice(0,_n),_t},i}(Pa),jz=function(e,i){this.time=e,this.value=i},of=function(e){function i(){var h=e!==null&&e.apply(this,arguments)||this;return h.value=null,h.hasNext=!1,h.hasCompleted=!1,h}return O(i,e),i.prototype._subscribe=function(h){return this.hasError?(h.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(h.next(this.value),h.complete(),Oa.EMPTY):e.prototype._subscribe.call(this,h)},i.prototype.next=function(h){this.hasCompleted||(this.value=h,this.hasNext=!0)},i.prototype.error=function(h){this.hasCompleted||e.prototype.error.call(this,h)},i.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},i}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(e){var i=kz++;return ii[i]=!0,lz.then(function(){return bm(i)&&e()}),i},clearImmediate:function(e){bm(e)}},mz=function(e){function i(h,_){var j=e.call(this,h,_)||this;return j.scheduler=h,j.work=_,j}return O(i,e),i.prototype.requestAsyncId=function(h,_,j){return j===void 0&&(j=0),j!==null&&0<j?e.prototype.requestAsyncId.call(this,h,_,j):(h.actions.push(this),h.scheduled||(h.scheduled=Eq.setImmediate(h.flush.bind(h,null))))},i.prototype.recycleAsyncId=function(h,_,j){if(j===void 0&&(j=0),j!==null&&0<j||j===null&&0<this.delay)return e.prototype.recycleAsyncId.call(this,h,_,j);h.actions.length===0&&(Eq.clearImmediate(_),h.scheduled=void 0)},i}(dg),ri=new(function(e){function i(){return e!==null&&e.apply(this,arguments)||this}return O(i,e),i.prototype.flush=function(h){this.active=!0,this.scheduled=void 0;var _,j=this.actions,_t=-1,Wt=j.length;h=h||j.shift();do if(_=h.execute(h.state,h.delay))break;while(++_t<Wt&&(h=j.shift()));if(this.active=!1,_){for(;++_t<Wt&&(h=j.shift());)h.unsubscribe();throw _}},i}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(e){function i(h,_){var j=e.call(this,h,_)||this;return j.scheduler=h,j.work=_,j}return O(i,e),i.prototype.requestAsyncId=function(h,_,j){return j===void 0&&(j=0),j!==null&&0<j?e.prototype.requestAsyncId.call(this,h,_,j):(h.actions.push(this),h.scheduled||(h.scheduled=requestAnimationFrame(function(){return h.flush(null)})))},i.prototype.recycleAsyncId=function(h,_,j){if(j===void 0&&(j=0),j!==null&&0<j||j===null&&0<this.delay)return e.prototype.recycleAsyncId.call(this,h,_,j);h.actions.length===0&&(cancelAnimationFrame(_),h.scheduled=void 0)},i}(dg),Fq=new(function(e){function i(){return e!==null&&e.apply(this,arguments)||this}return O(i,e),i.prototype.flush=function(h){this.active=!0,this.scheduled=void 0;var _,j=this.actions,_t=-1,Wt=j.length;h=h||j.shift();do if(_=h.execute(h.state,h.delay))break;while(++_t<Wt&&(h=j.shift()));if(this.active=!1,_){for(;++_t<Wt&&(h=j.shift());)h.unsubscribe();throw _}},i}(eg))(oz),pz=function(e){function i(h,_){h===void 0&&(h=Gq),_===void 0&&(_=Number.POSITIVE_INFINITY);var j=e.call(this,h,function(){return j.frame})||this;return j.maxFrames=_,j.frame=0,j.index=-1,j}return O(i,e),i.prototype.flush=function(){for(var h,_,j=this.actions,_t=this.maxFrames;(_=j[0])&&_.delay<=_t&&(j.shift(),this.frame=_.delay,!(h=_.execute(_.state,_.delay))););if(h){for(;_=j.shift();)_.unsubscribe();throw h}},i.frameTimeFactor=10,i}(eg),Gq=function(e){function i(h,_,j){j===void 0&&(j=h.index+=1);var _t=e.call(this,h,_)||this;return _t.scheduler=h,_t.work=_,_t.index=j,_t.active=!0,_t.index=h.index=j,_t}return O(i,e),i.prototype.schedule=function(h,_){if(_===void 0&&(_=0),!this.id)return e.prototype.schedule.call(this,h,_);this.active=!1;var j=new i(this.scheduler,this.work);return this.add(j),j.schedule(h,_)},i.prototype.requestAsyncId=function(h,_,j){return j===void 0&&(j=0),this.delay=h.frame+j,(h=h.actions).push(this),h.sort(i.sortActions),!0},i.prototype.recycleAsyncId=function(h,_,j){},i.prototype._execute=function(h,_){if(this.active===!0)return e.prototype._execute.call(this,h,_)},i.sortActions=function(h,_){return h.delay===_.delay?h.index===_.index?0:h.index>_.index?1:-1:h.delay>_.delay?1:-1},i}(dg),Qk=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),vg=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),pb=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Ss=function(){function e(i,h){this.project=i,this.thisArg=h}return e.prototype.call=function(i,h){return h.subscribe(new qz(i,this.project,this.thisArg))},e}(),qz=function(e){function i(h,_,j){return(h=e.call(this,h)||this).project=_,h.count=0,h.thisArg=j||h,h}return O(i,e),i.prototype._next=function(h){try{var _=this.project.call(this.thisArg,h,this.count++)}catch(j){return void this.destination.error(j)}this.destination.next(_)},i}(ia),Rk=function(e){function i(){return e!==null&&e.apply(this,arguments)||this}return O(i,e),i.prototype.notifyNext=function(h,_,j,_t,Wt){this.destination.next(_)},i.prototype.notifyError=function(h,_){this.destination.error(h)},i.prototype.notifyComplete=function(h){this.destination.complete()},i}(ia),Xs=function(e){function i(h,_,j){var _t=e.call(this)||this;return _t.parent=h,_t.outerValue=_,_t.outerIndex=j,_t.index=0,_t}return O(i,e),i.prototype._next=function(h){this.parent.notifyNext(this.outerValue,h,this.outerIndex,this.index++,this)},i.prototype._error=function(h){this.parent.notifyError(h,this),this.unsubscribe()},i.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},i}(ia),rz=function(e){return function(i){return e.then(function(h){i.closed||(i.next(h),i.complete())},function(h){return i.error(h)}).then(null,me),i}},$c=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(e){return function(i){for(var h=e[$c]();;){var _=void 0;try{_=h.next()}catch(j){return i.error(j),i}if(_.done){i.complete();break}if(i.next(_.value),i.closed)break}return typeof h.return=="function"&&i.add(function(){h.return&&h.return()}),i}},tz=function(e){return function(i){var h=e[ne]();if(typeof h.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return h.subscribe(i)}},hm=function(e){return e&&typeof e.length=="number"&&typeof e!="function"},pf=function(e){if(e&&typeof e[ne]=="function")return tz(e);if(hm(e))return am(e);if(fm(e))return rz(e);if(e&&typeof e[$c]=="function")return sz(e);throw e=ei(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function e(i){this.resultSelector=i}return e.prototype.call=function(i,h){return h.subscribe(new uz(i,this.resultSelector))},e}(),uz=function(e){function i(h,_){return(h=e.call(this,h)||this).resultSelector=_,h.active=0,h.values=[],h.observables=[],h}return O(i,e),i.prototype._next=function(h){this.values.push(Hq),this.observables.push(h)},i.prototype._complete=function(){var h=this.observables,_=h.length;if(_===0)this.destination.complete();else{this.toRespond=this.active=_;for(var j=0;j<_;j++)this.add(ji(this,h[j],void 0,j))}},i.prototype.notifyComplete=function(h){--this.active==0&&this.destination.complete()},i.prototype.notifyNext=function(h,_,j){var _t=(h=this.values)[j];_t=this.toRespond?_t===Hq?--this.toRespond:this.toRespond:0,h[j]=_,_t===0&&(this.resultSelector?this._tryResultSelector(h):this.destination.next(h.slice()))},i.prototype._tryResultSelector=function(h){try{var _=this.resultSelector.apply(this,h)}catch(j){return void this.destination.error(j)}this.destination.next(_)},i}(Rk),vc=function(e){function i(h){var _=e.call(this)||this;return _.parent=h,_}return O(i,e),i.prototype._next=function(h){this.parent.notifyNext(h)},i.prototype._error=function(h){this.parent.notifyError(h),this.unsubscribe()},i.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},i}(ia);(function(e){function i(h,_,j){var _t=e.call(this)||this;return _t.parent=h,_t.outerValue=_,_t.outerIndex=j,_t}O(i,e),i.prototype._next=function(h){this.parent.notifyNext(this.outerValue,h,this.outerIndex,this)},i.prototype._error=function(h){this.parent.notifyError(h),this.unsubscribe()},i.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(ia);var wc=function(e){function i(){return e!==null&&e.apply(this,arguments)||this}return O(i,e),i.prototype.notifyNext=function(h){this.destination.next(h)},i.prototype.notifyError=function(h){this.destination.error(h)},i.prototype.notifyComplete=function(){this.destination.complete()},i}(ia);(function(e){function i(){return e!==null&&e.apply(this,arguments)||this}O(i,e),i.prototype.notifyNext=function(h,_,j,_t){this.destination.next(_)},i.prototype.notifyError=function(h){this.destination.error(h)},i.prototype.notifyComplete=function(h){this.destination.complete()}})(ia);var at=function(){function e(i,h){h===void 0&&(h=Number.POSITIVE_INFINITY),this.project=i,this.concurrent=h}return e.prototype.call=function(i,h){return h.subscribe(new wz(i,this.project,this.concurrent))},e}(),wz=function(e){function i(h,_,j){return j===void 0&&(j=Number.POSITIVE_INFINITY),(h=e.call(this,h)||this).project=_,h.concurrent=j,h.hasCompleted=!1,h.buffer=[],h.active=0,h.index=0,h}return O(i,e),i.prototype._next=function(h){this.active<this.concurrent?this._tryNext(h):this.buffer.push(h)},i.prototype._tryNext=function(h){var _=this.index++;try{var j=this.project(h,_)}catch(_t){return void this.destination.error(_t)}this.active++,this._innerSub(j)},i.prototype._innerSub=function(h){var _=new vc(this),j=this.destination;j.add(_),(h=ic(h,_))!==_&&j.add(h)},i.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},i.prototype.notifyNext=function(h){this.destination.next(h)},i.prototype.notifyComplete=function(){var h=this.buffer;this.active--,0<h.length?this._next(h.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},i}(wc),Sk=y.parseFloat,Iq=1/Sk(`	
\v\f\r \u2028\u2029\uFEFF-0`)!=-1/0?function(e){e=ik(String(e));var i=Sk(e);return i===0&&e.charAt(0)=="-"?-0:i}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function e(i,h){this.predicate=i,this.thisArg=h}return e.prototype.call=function(i,h){return h.subscribe(new xz(i,this.predicate,this.thisArg))},e}(),xz=function(e){function i(h,_,j){return(h=e.call(this,h)||this).predicate=_,h.thisArg=j,h.count=0,h}return O(i,e),i.prototype._next=function(h){try{var _=this.predicate.call(this.thisArg,h,this.count++)}catch(j){return void this.destination.error(j)}_&&this.destination.next(h)},i}(ia),gt=function(){function e(){}return e.prototype.call=function(i,h){return h.subscribe(new yz(i))},e}(),yz=function(e){function i(h){return(h=e.call(this,h)||this).hasFirst=!1,h.observables=[],h.subscriptions=[],h}return O(i,e),i.prototype._next=function(h){this.observables.push(h)},i.prototype._complete=function(){var h=this.observables,_=h.length;if(_===0)this.destination.complete();else{for(var j=0;j<_&&!this.hasFirst;j++){var _t=ji(this,h[j],void 0,j);this.subscriptions&&this.subscriptions.push(_t),this.add(_t)}this.observables=null}},i.prototype.notifyNext=function(h,_,j){if(!this.hasFirst){for(this.hasFirst=!0,h=0;h<this.subscriptions.length;h++)if(h!==j){var _t=this.subscriptions[h];_t.unsubscribe(),this.remove(_t)}this.subscriptions=null}this.destination.next(_)},i}(Rk),jt=function(){function e(i){this.resultSelector=i}return e.prototype.call=function(i,h){return h.subscribe(new zz(i,this.resultSelector))},e}(),zz=function(e){function i(h,_,j){return(h=e.call(this,h)||this).resultSelector=_,h.iterators=[],h.active=0,h.resultSelector=typeof _=="function"?_:void 0,h}return O(i,e),i.prototype._next=function(h){var _=this.iterators;Jb(h)?_.push(new Az(h)):typeof h[$c]=="function"?_.push(new Bz(h[$c]())):_.push(new Cz(this.destination,this,h))},i.prototype._complete=function(){var h=this.iterators,_=h.length;if(this.unsubscribe(),_===0)this.destination.complete();else{this.active=_;for(var j=0;j<_;j++){var _t=h[j];_t.stillUnsubscribed?this.destination.add(_t.subscribe()):this.active--}}},i.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},i.prototype.checkIterators=function(){for(var h=this.iterators,_=h.length,j=this.destination,_t=0;_t<_;_t++){var Wt=h[_t];if(typeof Wt.hasValue=="function"&&!Wt.hasValue())return}var _n=!1,_i=[];for(_t=0;_t<_;_t++){var _s=(Wt=h[_t]).next();if(Wt.hasCompleted()&&(_n=!0),_s.done)return void j.complete();_i.push(_s.value)}this.resultSelector?this._tryresultSelector(_i):j.next(_i),_n&&j.complete()},i.prototype._tryresultSelector=function(h){try{var _=this.resultSelector.apply(this,h)}catch(j){return void this.destination.error(j)}this.destination.next(_)},i}(ia),Bz=function(){function e(i){this.iterator=i,this.nextResult=i.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var i=this.nextResult;return this.nextResult=this.iterator.next(),i},e.prototype.hasCompleted=function(){var i=this.nextResult;return!(!i||!i.done)},e}(),Az=function(){function e(i){this.array=i,this.length=this.index=0,this.length=i.length}return e.prototype[$c]=function(){return this},e.prototype.next=function(i){i=this.index++;var h=this.array;return i<this.length?{value:h[i],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Cz=function(e){function i(h,_,j){return(h=e.call(this,h)||this).parent=_,h.observable=j,h.stillUnsubscribed=!0,h.buffer=[],h.isComplete=!1,h}return O(i,e),i.prototype[$c]=function(){return this},i.prototype.next=function(){var h=this.buffer;return h.length===0&&this.isComplete?{value:null,done:!0}:{value:h.shift(),done:!1}},i.prototype.hasValue=function(){return 0<this.buffer.length},i.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},i.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},i.prototype.notifyNext=function(h){this.buffer.push(h),this.parent.checkIterators()},i.prototype.subscribe=function(){return ic(this.observable,new vc(this))},i}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(e){return!!e&&(e instanceof Y||typeof e.lift=="function"&&typeof e.subscribe=="function")},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var h=i=void 0;return Zc(e[e.length-1])&&(h=e.pop()),typeof e[e.length-1]=="function"&&(i=e.pop()),e.length===1&&Jb(e[0])&&(e=e[0]),nf(e,h).lift(new vz(i))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(e,i,h,_,j){if(arguments.length==1){var _t=e.initialState;i=e.condition,h=e.iterate;var Wt=e.resultSelector||Yc;j=e.scheduler}else _===void 0||Zc(_)?(_t=e,Wt=Yc,j=_):(_t=e,Wt=_);return new Y(function(_n){var _i=_t;if(j)return j.schedule(bt,0,{subscriber:_n,iterate:h,condition:i,resultSelector:Wt,state:_i});for(;;){if(i){var _s=void 0;try{_s=i(_i)}catch(_u){_n.error(_u);break}if(!_s){_n.complete();break}}_s=void 0;try{_s=Wt(_i)}catch(_u){_n.error(_u);break}if(_n.next(_s),_n.closed)break;try{_i=h(_i)}catch(_u){_n.error(_u);break}}})},iif:function(e,i,h){return i===void 0&&(i=vb),h===void 0&&(h=vb),ad(function(){return e()?i:h})},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(e,i){return new Y(i?function(h){var _=Object.keys(e),j=new Oa;return j.add(i.schedule(dt,0,{keys:_,index:0,subscriber:h,subscription:j,obj:e})),j}:function(h){for(var _=Object.keys(e),j=0;j<_.length&&!h.closed;j++){var _t=_[j];e.hasOwnProperty(_t)&&h.next([_t,e[_t]])}h.complete()})},partition:function(e,i,h){return[wb(i,h)(new Y(pf(e))),wb(et(i,h))(new Y(pf(e)))]},race:Ca,range:function(e,i,h){return e===void 0&&(e=0),new Y(function(_){i===void 0&&(i=e,e=0);var j=0,_t=e;if(h)return h.schedule(ht,0,{index:j,count:i,start:e,subscriber:_});for(;;){if(j++>=i){_.complete();break}if(_.next(_t++),_.closed)break}})},throwError:Z,timer:Bc,using:function(e,i){return new Y(function(h){try{var _=e()}catch(Wt){return void h.error(Wt)}try{var j=i(_)}catch(Wt){return void h.error(Wt)}var _t=(j?Kb(j):vb).subscribe(h);return function(){_t.unsubscribe(),_&&_.unsubscribe()}})},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function e(i){this.selector=i}return e.prototype.call=function(i,h){return h.subscribe(new Ez(i,this.selector,this.caught))},e}(),Ez=function(e){function i(h,_,j){return(h=e.call(this,h)||this).selector=_,h.caught=j,h}return O(i,e),i.prototype.error=function(h){if(!this.isStopped){var _=void 0;try{_=this.selector(h,this.caught)}catch(j){return void e.prototype.error.call(this,j)}this._unsubscribeAndRecycle(),h=new vc(this),this.add(h),(_=ic(_,h))!==h&&this.add(_)}},i}(wc),lt=function(){function e(i){this.defaultValue=i}return e.prototype.call=function(i,h){return h.subscribe(new Fz(i,this.defaultValue))},e}(),Fz=function(e){function i(h,_){return(h=e.call(this,h)||this).defaultValue=_,h.isEmpty=!0,h}return O(i,e),i.prototype._next=function(h){this.isEmpty=!1,this.destination.next(h)},i.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},i}(ia),mt=function(){function e(i,h){this.delay=i,this.scheduler=h}return e.prototype.call=function(i,h){return h.subscribe(new Gz(i,this.delay,this.scheduler))},e}(),Gz=function(e){function i(h,_,j){return(h=e.call(this,h)||this).delay=_,h.scheduler=j,h.queue=[],h.active=!1,h.errored=!1,h}return O(i,e),i.dispatch=function(h){for(var _=h.source,j=_.queue,_t=h.scheduler,Wt=h.destination;0<j.length&&0>=j[0].time-_t.now();)j.shift().notification.observe(Wt);0<j.length?(_=Math.max(0,j[0].time-_t.now()),this.schedule(h,_)):(this.unsubscribe(),_.active=!1)},i.prototype._schedule=function(h){this.active=!0,this.destination.add(h.schedule(i.dispatch,this.delay,{source:this,destination:this.destination,scheduler:h}))},i.prototype.scheduleNotification=function(h){if(this.errored!==!0){var _=this.scheduler;h=new Hz(_.now()+this.delay,h),this.queue.push(h),this.active===!1&&this._schedule(_)}},i.prototype._next=function(h){this.scheduleNotification(Ve.createNext(h))},i.prototype._error=function(h){this.errored=!0,this.queue=[],this.destination.error(h),this.unsubscribe()},i.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},i}(ia),Hz=function(e,i){this.time=e,this.notification=i},nt=function(){function e(i,h){this.keySelector=i,this.flushes=h}return e.prototype.call=function(i,h){return h.subscribe(new Iz(i,this.keySelector,this.flushes))},e}(),Iz=function(e){function i(h,_,j){return(h=e.call(this,h)||this).keySelector=_,h.values=new Set,j&&h.add(ic(j,new vc(h))),h}return O(i,e),i.prototype.notifyNext=function(){this.values.clear()},i.prototype.notifyError=function(h){this._error(h)},i.prototype._next=function(h){this.keySelector?this._useKeySelector(h):this._finalizeNext(h,h)},i.prototype._useKeySelector=function(h){var _=this.destination;try{var j=this.keySelector(h)}catch(_t){return void _.error(_t)}this._finalizeNext(j,h)},i.prototype._finalizeNext=function(h,_){var j=this.values;j.has(h)||(j.add(h),this.destination.next(_))},i}(wc),pt=function(){function e(i){this.errorFactory=i}return e.prototype.call=function(i,h){return h.subscribe(new Jz(i,this.errorFactory))},e}(),Jz=function(e){function i(h,_){return(h=e.call(this,h)||this).errorFactory=_,h.hasValue=!1,h}return O(i,e),i.prototype._next=function(h){this.hasValue=!0,this.destination.next(h)},i.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var h=void 0;try{h=this.errorFactory()}catch(_){h=_}this.destination.error(h)},i}(ia),qt=function(){function e(i){if(this.total=i,0>this.total)throw new Qk}return e.prototype.call=function(i,h){return h.subscribe(new Kz(i,this.total))},e}(),Kz=function(e){function i(h,_){return(h=e.call(this,h)||this).total=_,h.count=0,h}return O(i,e),i.prototype._next=function(h){var _=this.total,j=++this.count;j<=_&&(this.destination.next(h),j===_&&(this.destination.complete(),this.unsubscribe()))},i}(ia),rt=function(){function e(i){this.project=i}return e.prototype.call=function(i,h){return h.subscribe(new Lz(i,this.project))},e}(),Lz=function(e){function i(h,_){return(h=e.call(this,h)||this).project=_,h.hasSubscription=!1,h.hasCompleted=!1,h.index=0,h}return O(i,e),i.prototype._next=function(h){this.hasSubscription||this.tryNext(h)},i.prototype.tryNext=function(h){var _=this.index++;try{var j=this.project(h,_)}catch(_t){return void this.destination.error(_t)}this.hasSubscription=!0,this._innerSub(j)},i.prototype._innerSub=function(h){var _=new vc(this),j=this.destination;j.add(_),(h=ic(h,_))!==_&&j.add(h)},i.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},i.prototype.notifyNext=function(h){this.destination.next(h)},i.prototype.notifyError=function(h){this.destination.error(h)},i.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},i}(wc),st=function(){function e(i){this.callback=i}return e.prototype.call=function(i,h){return h.subscribe(new Mz(i,this.callback))},e}(),Mz=function(e){function i(h,_){return(h=e.call(this,h)||this).add(new Oa(_)),h}return O(i,e),i}(ia),ut=function(){function e(){}return e.prototype.call=function(i,h){return h.subscribe(new Nz(i))},e}(),Nz=function(e){function i(){return e!==null&&e.apply(this,arguments)||this}return O(i,e),i.prototype._next=function(h){},i}(ia),vt=function(){function e(i){if(this.total=i,0>this.total)throw new Qk}return e.prototype.call=function(i,h){return h.subscribe(new Oz(i,this.total))},e}(),Oz=function(e){function i(h,_){return(h=e.call(this,h)||this).total=_,h.ring=[],h.count=0,h}return O(i,e),i.prototype._next=function(h){var _=this.ring,j=this.total,_t=this.count++;_.length<j?_.push(h):_[_t%j]=h},i.prototype._complete=function(){var h=this.destination,_=this.count;if(0<_)for(var j=this.count>=this.total?this.total:this.count,_t=this.ring,Wt=0;Wt<j;Wt++){var _n=_++%j;h.next(_t[_n])}h.complete()},i}(ia),wt=function(){function e(i){this.value=i}return e.prototype.call=function(i,h){return h.subscribe(new Pz(i,this.value))},e}(),Pz=function(e){function i(h,_){return(h=e.call(this,h)||this).value=_,h}return O(i,e),i.prototype._next=function(h){this.destination.next(this.value)},i}(ia),xt=function(){function e(i,h,_){_===void 0&&(_=!1),this.accumulator=i,this.seed=h,this.hasSeed=_}return e.prototype.call=function(i,h){return h.subscribe(new Qz(i,this.accumulator,this.seed,this.hasSeed))},e}(),Qz=function(e){function i(h,_,j,_t){return(h=e.call(this,h)||this).accumulator=_,h._seed=j,h.hasSeed=_t,h.index=0,h}return O(i,e),Object.defineProperty(i.prototype,"seed",{get:function(){return this._seed},set:function(h){this.hasSeed=!0,this._seed=h},enumerable:!0,configurable:!0}),i.prototype._next=function(h){if(this.hasSeed)return this._tryNext(h);this.seed=h,this.destination.next(h)},i.prototype._tryNext=function(h){var _=this.index++;try{var j=this.accumulator(this.seed,h,_)}catch(_t){this.destination.error(_t)}this.seed=j,this.destination.next(j)},i}(ia),Bt=function(){function e(i,h){this.notifier=i,this.source=h}return e.prototype.call=function(i,h){return h.subscribe(new Rz(i,this.notifier,this.source))},e}(),Rz=function(e){function i(h,_,j){return(h=e.call(this,h)||this).notifier=_,h.source=j,h}return O(i,e),i.prototype.error=function(h){if(!this.isStopped){var _=this.errors,j=this.retries,_t=this.retriesSubscription;if(j)this.retriesSubscription=this.errors=void 0;else{_=new Pa;try{j=(0,this.notifier)(_)}catch(Wt){return e.prototype.error.call(this,Wt)}_t=ic(j,new vc(this))}this._unsubscribeAndRecycle(),this.errors=_,this.retries=j,this.retriesSubscription=_t,_.next(h)}},i.prototype._unsubscribe=function(){var h=this.errors,_=this.retriesSubscription;h&&(h.unsubscribe(),this.errors=void 0),_&&(_.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},i.prototype.notifyNext=function(){var h=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=h,this.source.subscribe(this)},i}(wc),Et=function(){function e(i){this.project=i}return e.prototype.call=function(i,h){return h.subscribe(new Sz(i,this.project))},e}(),Sz=function(e){function i(h,_){return(h=e.call(this,h)||this).project=_,h.index=0,h}return O(i,e),i.prototype._next=function(h){var _=this.index++;try{var j=this.project(h,_)}catch(_t){return void this.destination.error(_t)}this._innerSub(j)},i.prototype._innerSub=function(h){var _=this.innerSubscription;_&&_.unsubscribe(),_=new vc(this);var j=this.destination;j.add(_),this.innerSubscription=ic(h,_),this.innerSubscription!==_&&j.add(this.innerSubscription)},i.prototype._complete=function(){var h=this.innerSubscription;h&&!h.closed||e.prototype._complete.call(this),this.unsubscribe()},i.prototype._unsubscribe=function(){this.innerSubscription=void 0},i.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},i.prototype.notifyNext=function(h){this.destination.next(h)},i}(wc),Ft=function(){function e(i){this.notifier=i}return e.prototype.call=function(i,h){i=new Tz(i);var _=ic(this.notifier,new vc(i));return _&&!i.seenValue?(i.add(_),h.subscribe(i)):i},e}(),Tz=function(e){function i(h){return(h=e.call(this,h)||this).seenValue=!1,h}return O(i,e),i.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},i.prototype.notifyComplete=function(){},i}(wc),Ht=function(){function e(i,h){this.predicate=i,this.inclusive=h}return e.prototype.call=function(i,h){return h.subscribe(new Uz(i,this.predicate,this.inclusive))},e}(),Uz=function(e){function i(h,_,j){return(h=e.call(this,h)||this).predicate=_,h.inclusive=j,h.index=0,h}return O(i,e),i.prototype._next=function(h){var _=this.destination;try{var j=this.predicate(h,this.index++)}catch(_t){return void _.error(_t)}this.nextOrComplete(h,j)},i.prototype.nextOrComplete=function(h,_){var j=this.destination;_?j.next(h):(this.inclusive&&j.next(h),j.complete())},i}(ia),It=function(){function e(i,h,_){this.nextOrObserver=i,this.error=h,this.complete=_}return e.prototype.call=function(i,h){return h.subscribe(new Vz(i,this.nextOrObserver,this.error,this.complete))},e}(),Vz=function(e){function i(h,_,j,_t){return(h=e.call(this,h)||this)._tapNext=hc,h._tapError=hc,h._tapComplete=hc,h._tapError=j||hc,h._tapComplete=_t||hc,le(_)?(h._context=h,h._tapNext=_):_&&(h._context=_,h._tapNext=_.next||hc,h._tapError=_.error||hc,h._tapComplete=_.complete||hc),h}return O(i,e),i.prototype._next=function(h){try{this._tapNext.call(this._context,h)}catch(_){return void this.destination.error(_)}this.destination.next(h)},i.prototype._error=function(h){try{this._tapError.call(this._context,h)}catch(_){return void this.destination.error(_)}this.destination.error(h)},i.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(h){return void this.destination.error(h)}return this.destination.complete()},i}(ia),Kt={leading:!0,trailing:!1};(function(e){function i(h,_,j,_t){var Wt=e.call(this,h)||this;return Wt.destination=h,Wt.durationSelector=_,Wt._leading=j,Wt._trailing=_t,Wt._hasValue=!1,Wt}O(i,e),i.prototype._next=function(h){this._hasValue=!0,this._sendValue=h,this._throttled||(this._leading?this.send():this.throttle(h))},i.prototype.send=function(){var h=this._sendValue;this._hasValue&&(this.destination.next(h),this.throttle(h)),this._hasValue=!1,this._sendValue=void 0},i.prototype.throttle=function(h){(h=this.tryDurationSelector(h))&&this.add(this._throttled=ic(h,new vc(this)))},i.prototype.tryDurationSelector=function(h){try{return this.durationSelector(h)}catch(_){return this.destination.error(_),null}},i.prototype.throttlingDone=function(){var h=this._throttled,_=this._trailing;h&&h.unsubscribe(),this._throttled=void 0,_&&this.send()},i.prototype.notifyNext=function(){this.throttlingDone()},i.prototype.notifyComplete=function(){this.throttlingDone()}})(wc);for(var Lt=function(){function e(i,h,_,j){this.duration=i,this.scheduler=h,this.leading=_,this.trailing=j}return e.prototype.call=function(i,h){return h.subscribe(new Wz(i,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Wz=function(e){function i(h,_,j,_t,Wt){return(h=e.call(this,h)||this).duration=_,h.scheduler=j,h.leading=_t,h.trailing=Wt,h._hasTrailingValue=!1,h._trailingValue=null,h}return O(i,e),i.prototype._next=function(h){this.throttled?this.trailing&&(this._trailingValue=h,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(h):this.trailing&&(this._trailingValue=h,this._hasTrailingValue=!0))},i.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},i.prototype.clearThrottle=function(){var h=this.throttled;h&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),h.unsubscribe(),this.remove(h),this.throttled=null)},i}(ia),Ot=function(){function e(i,h,_,j){this.waitFor=i,this.absoluteTimeout=h,this.withObservable=_,this.scheduler=j}return e.prototype.call=function(i,h){return h.subscribe(new Xz(i,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Xz=function(e){function i(h,_,j,_t,Wt){return(h=e.call(this,h)||this).absoluteTimeout=_,h.waitFor=j,h.withObservable=_t,h.scheduler=Wt,h.scheduleTimeout(),h}return O(i,e),i.dispatchTimeout=function(h){var _=h.withObservable;h._unsubscribeAndRecycle(),h.add(ic(_,new vc(h)))},i.prototype.scheduleTimeout=function(){var h=this.action;h?this.action=h.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(i.dispatchTimeout,this.waitFor,this))},i.prototype._next=function(h){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,h)},i.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},i}(wc),Qt=function(){function e(i,h){this.observables=i,this.project=h}return e.prototype.call=function(i,h){return h.subscribe(new Yz(i,this.observables,this.project))},e}(),Yz=function(e){function i(h,_,j){(h=e.call(this,h)||this).observables=_,h.project=j,h.toRespond=[],j=_.length,h.values=Array(j);for(var _t=0;_t<j;_t++)h.toRespond.push(_t);for(_t=0;_t<j;_t++)h.add(ji(h,_[_t],void 0,_t));return h}return O(i,e),i.prototype.notifyNext=function(h,_,j){this.values[j]=_,0<(h=this.toRespond).length&&(j=h.indexOf(j))!==-1&&h.splice(j,1)},i.prototype.notifyComplete=function(){},i.prototype._next=function(h){this.toRespond.length===0&&(h=[h].concat(this.values),this.project?this._tryProject(h):this.destination.next(h))},i.prototype._tryProject=function(h){try{var _=this.project.apply(this,h)}catch(j){return void this.destination.error(j)}this.destination.next(_)},i}(Rk),Jq=$a(function(e){var i=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(i){var h=new Uint8Array(16);e.exports=function(){return i(h),h}}else{var _=Array(16);e.exports=function(){for(var j,_t=0;16>_t;_t++)!(3&_t)&&(j=4294967296*Math.random()),_[_t]=j>>>((3&_t)<<3)&255;return _}}}),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(e,i){return i=i||0,[ab[e[i++]],ab[e[i++]],ab[e[i++]],ab[e[i++]],"-",ab[e[i++]],ab[e[i++]],"-",ab[e[i++]],ab[e[i++]],"-",ab[e[i++]],ab[e[i++]],"-",ab[e[i++]],ab[e[i++]],ab[e[i++]],ab[e[i++]],ab[e[i++]],ab[e[i++]]].join("")},Ud=function(e,i,h){if(h=i&&h||0,typeof e=="string"&&(i=e==="binary"?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||Jq)())[6]=15&e[6]|64,e[8]=63&e[8]|128,i)for(var _=0;16>_;++_)i[h+_]=e[_];return i||Kq(e)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;(function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(Pc||(Pc={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(e){e[e.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",e[e.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",e[e.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",e[e.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",e[e.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(e){e[e.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",e[e.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",e[e.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",e[e.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",e[e.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(e,i){var h;return Hk(e,function(_,j,_t){return!(h=i(_,j,_t))}),!!h},Mh=function(e,i,h){if(!lb(h))return!1;var _=X(i);return!!(_=="number"?Ed(h)&&wk(i,h.length):_=="string"&&i in h)&&$f(h[i],e)},dl=function(e,i,h){var _=Va(e)?tq:DA;return _(e,Te(i))},EA=function(e,i){var h=-1,_=Ed(e)?Array(e.length):[];return Hk(e,function(j,_t,Wt){_[++h]=i(j,_t,Wt)}),_},FA=function(e,i){var h=e.length;for(e.sort(i);h--;)e[h]=e[h].value;return e},GA=function(e,i,h){i=i.length?he(i,function(j){return Va(j)?function(_t){return Ch(_t,j.length===1?j[0]:j)}:j}):[Dh];var _=-1;return i=he(i,zh(Te)),e=EA(e,function(j,_t,Wt){return{criteria:he(i,function(_n){return _n(j)}),index:++_,value:j}}),FA(e,function(j,_t){t:{for(var Wt=-1,_n=j.criteria,_i=_t.criteria,_s=_n.length,_u=h.length;++Wt<_s;){e:{var _h=_n[Wt],_d=_i[Wt];if(_h!==_d){var nE=_h!==void 0,aE=_h===null,uE=_h==_h,hE=ie(_h),oE=_d!==void 0,sE=_d===null,dE=_d==_d,vE=ie(_d);if(!sE&&!vE&&!hE&&_h>_d||hE&&oE&&dE&&!sE&&!vE||aE&&oE&&dE||!nE&&dE||!uE){_h=1;break e}if(!aE&&!hE&&!vE&&_h<_d||vE&&nE&&uE&&!aE&&!hE||sE&&nE&&uE||!oE&&uE||!dE){_h=-1;break e}}_h=0}if(_h){j=Wt>=_u?_h:_h*(h[Wt]=="desc"?-1:1);break t}}j=j.index-_t.index}return j})},jr=function(e,i){return rq(qq(e,i,Dh),e+"")},kr=jr(function(e,i){if(e==null)return[];var h=i.length;return 1<h&&Mh(e,i[0],i[1])?i=[]:2<h&&Mh(i[0],i[1],i[2])&&(i=[i[0]]),GA(e,$h(i),[])}),lr=function(e){if(e.__esModule)return e;var i=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(h){var _=Object.getOwnPropertyDescriptor(e,h);Object.defineProperty(i,h,_.get?_:{enumerable:!0,get:function(){return e[h]}})}),i}(Dz),mr=$a(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var h=[],_=function(j,_t){return new WebSocket(j,_t)};i.normalClosureMessage="Normal closure",i.default=function(j,_t){var Wt=(_t=_t===void 0?{protocols:h,makeWebSocket:_}:_t).protocols,_n=Wt===void 0?h:Wt,_i=(_t=_t.makeWebSocket)===void 0?_:_t;return new lr.Observable(function(_s){var _u,_h=new lr.Subject,_d=_i(j,_n),nE=!1,aE=!1,uE=function(hE){if(_u)throw nE=!0,hE=Error("Web socket message factory function called more than once"),_s.error(hE),hE;return _u=hE.subscribe(function(oE){_d.send(oE)}),_h};return _d.onopen=function(){aE?(nE=!0,_d.close()):_s.next(uE)},_d.onmessage=function(hE){_h.next(hE.data)},_d.onerror=function(hE){nE=!0,_s.error(Error(hE.message))},_d.onclose=function(hE){nE||(nE=!0,aE?(_s.complete(),_h.complete()):_s.error(Error(hE.code===1e3?i.normalClosureMessage:hE.reason)))},function(){aE=!0,_u&&_u.unsubscribe(),nE||(nE=!0,_d.close())}})}});(function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default})(mr);var pi=function(e,i,h){(h===void 0||$f(e[i],h))&&(h!==void 0||i in e)||bg(e,i,h)},oi=function(e,i){if((i!=="constructor"||typeof e[i]!="function")&&i!="__proto__")return e[i]},HA=function(e){return jr(function(i,h){var _=-1,j=h.length,_t=1<j?h[j-1]:void 0,Wt=2<j?h[2]:void 0;for(_t=3<e.length&&typeof _t=="function"?(j--,_t):void 0,Wt&&Mh(h[0],h[1],Wt)&&(_t=3>j?void 0:_t,j=1),i=Object(i);++_<j;)(Wt=h[_])&&e(i,Wt,_,_t);return i})}(function(e,i,h,_){tm(e,i,h,_)}),IA=Math.floor,JA=Math.random,nr=function(e,i){return e+IA(JA()*(i-e+1))},or=function(e){var i=e.length;return i?e[nr(0,i-1)]:void 0},KA=function(e,i){return he(i,function(h){return e[h]})},Ni=function(e){return e==null?[]:KA(e,Ad(e))},LA=function(e){return or(Ni(e))},bn=function(e){return(Va(e)?or:LA)(e)},xm=[],ym=function(e,i){return new WebSocket(e,i)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(e){return!ha(e)&&isFinite(e)&&MA(e)===e}}),Oo("from",Ej,Dj);var NA=function(e,i){for(var h=Array(arguments.length-1),_=0,j=2,_t=!0;j<arguments.length;)h[_++]=arguments[j++];return new Promise(function(Wt,_n){h[_]=function(_i){if(_t)if(_t=!1,_i)_n(_i);else{for(var _s=Array(arguments.length-1),_u=0;_u<_s.length;)_s[_u++]=arguments[_u];Wt.apply(null,_s)}};try{e.apply(i||null,h)}catch(_i){_t&&(_t=!1,_n(_i))}})},OA=$a(function(e,i){i.length=function(j){var _t=j.length;if(!_t)return 0;for(var Wt=0;1<--_t%4&&j.charAt(_t)==="=";)++Wt;return Math.ceil(3*j.length)/4-Wt};var h=Array(64),_=Array(123);for(e=0;64>e;)_[h[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;i.encode=function(j,_t,Wt){for(var _n,_i=null,_s=[],_u=0,_h=0;_t<Wt;){var _d=j[_t++];switch(_h){case 0:_s[_u++]=h[_d>>2],_n=(3&_d)<<4,_h=1;break;case 1:_s[_u++]=h[_n|_d>>4],_n=(15&_d)<<2,_h=2;break;case 2:_s[_u++]=h[_n|_d>>6],_s[_u++]=h[63&_d],_h=0}8191<_u&&((_i||(_i=[])).push(String.fromCharCode.apply(String,_s)),_u=0)}return _h&&(_s[_u++]=h[_n],_s[_u++]=61,_h===1&&(_s[_u++]=61)),_i?(_u&&_i.push(String.fromCharCode.apply(String,_s.slice(0,_u))),_i.join("")):String.fromCharCode.apply(String,_s.slice(0,_u))},i.decode=function(j,_t,Wt){for(var _n,_i=Wt,_s=0,_u=0;_u<j.length;){var _h=j.charCodeAt(_u++);if(_h===61&&1<_s)break;if((_h=_[_h])===void 0)throw Error("invalid encoding");switch(_s){case 0:_n=_h,_s=1;break;case 1:_t[Wt++]=_n<<2|(48&_h)>>4,_n=_h,_s=2;break;case 2:_t[Wt++]=(15&_n)<<4|(60&_h)>>2,_n=_h,_s=3;break;case 3:_t[Wt++]=(3&_n)<<6|_h,_s=0}}if(_s===1)throw Error("invalid encoding");return Wt-_i},i.test=function(j){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(j)}});yg.prototype.on=function(e,i,h){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:i,ctx:h||this}),this},yg.prototype.off=function(e,i){if(e===void 0)this._listeners={};else if(i===void 0)this._listeners[e]=[];else{e=this._listeners[e];for(var h=0;h<e.length;)e[h].fn===i?e.splice(h,1):++h}return this},yg.prototype.emit=function(e){var i=this._listeners[e];if(i){for(var h=[],_=1;_<arguments.length;)h.push(arguments[_++]);for(_=0;_<i.length;)i[_].fn.apply(i[_++].ctx,h)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e){}return null},RA=$a(function(e,i){i.length=function(h){for(var _,j=0,_t=0;_t<h.length;++_t)128>(_=h.charCodeAt(_t))?j+=1:2048>_?j+=2:(64512&_)==55296&&(64512&h.charCodeAt(_t+1))==56320?(++_t,j+=4):j+=3;return j},i.read=function(h,_,j){if(1>j-_)return"";for(var _t,Wt=null,_n=[],_i=0;_<j;)128>(_t=h[_++])?_n[_i++]=_t:191<_t&&224>_t?_n[_i++]=(31&_t)<<6|63&h[_++]:239<_t&&365>_t?(_t=((7&_t)<<18|(63&h[_++])<<12|(63&h[_++])<<6|63&h[_++])-65536,_n[_i++]=55296+(_t>>10),_n[_i++]=56320+(1023&_t)):_n[_i++]=(15&_t)<<12|(63&h[_++])<<6|63&h[_++],8191<_i&&((Wt||(Wt=[])).push(String.fromCharCode.apply(String,_n)),_i=0);return Wt?(_i&&Wt.push(String.fromCharCode.apply(String,_n.slice(0,_i))),Wt.join("")):String.fromCharCode.apply(String,_n.slice(0,_i))},i.write=function(h,_,j){for(var _t,Wt,_n=j,_i=0;_i<h.length;++_i)128>(_t=h.charCodeAt(_i))?_[j++]=_t:(2048>_t?_[j++]=_t>>6|192:((64512&_t)==55296&&(64512&(Wt=h.charCodeAt(_i+1)))==56320?(_t=65536+((1023&_t)<<10)+(1023&Wt),++_i,_[j++]=_t>>18|240,_[j++]=_t>>12&63|128):_[j++]=_t>>12|224,_[j++]=_t>>6&63|128),_[j++]=63&_t|128);return j-_n}}),SA=function(e,i,h){var _=h||8192,j=_>>>1,_t=null,Wt=_;return function(_n){return 1>_n||_n>j?e(_n):(Wt+_n>_&&(_t=e(_),Wt=0),_n=i.call(_t,Wt,Wt+=_n),7&Wt&&(Wt=1+(7|Wt)),_n)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(e){if(e===0)return Xd;var i=0>e;i&&(e=-e);var h=e>>>0;return e=(e-h)/4294967296>>>0,i&&(e=~e>>>0,h=~h>>>0,4294967295<++h&&(h=0,4294967295<++e&&(e=0))),new Wa(h,e)},Wa.from=function(e){if(typeof e=="number")return Wa.fromNumber(e);if(V.isString(e)){if(!V.Long)return Wa.fromNumber(parseInt(e,10));e=V.Long.fromString(e)}return e.low||e.high?new Wa(e.low>>>0,e.high>>>0):Xd},Wa.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var i=~this.hi>>>0;return e||(i=i+1>>>0),-(e+4294967296*i)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(e){return V.Long?new V.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var td=String.prototype.charCodeAt;Wa.fromHash=function(e){return e===TA?Xd:new Wa((td.call(e,0)|td.call(e,1)<<8|td.call(e,2)<<16|td.call(e,3)<<24)>>>0,(td.call(e,4)|td.call(e,5)<<8|td.call(e,6)<<16|td.call(e,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Wa.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Wa.prototype.length=function(){var e=this.lo,i=(this.lo>>>28|this.hi<<4)>>>0,h=this.hi>>>24;return h===0?i===0?16384>e?128>e?1:2:2097152>e?3:4:16384>i?128>i?5:6:2097152>i?7:8:128>h?9:10};var V=$a(function(e,i){function h(j,_t,Wt){for(var _n=Object.keys(_t),_i=0;_i<_n.length;++_i)j[_n[_i]]!==void 0&&Wt||(j[_n[_i]]=_t[_n[_i]]);return j}function _(j){function _t(Wt,_n){if(!(this instanceof _t))return new _t(Wt,_n);Object.defineProperty(this,"message",{get:function(){return Wt}}),Error.captureStackTrace?Error.captureStackTrace(this,_t):Object.defineProperty(this,"stack",{value:Error().stack||""}),_n&&h(this,_n)}return(_t.prototype=Object.create(Error.prototype)).constructor=_t,Object.defineProperty(_t.prototype,"name",{get:function(){return j}}),_t.prototype.toString=function(){return this.name+": "+this.message},_t}i.asPromise=NA,i.base64=OA,i.EventEmitter=yg,i.float=PA,i.inquire=QA,i.utf8=RA,i.pool=SA,i.LongBits=Wa,i.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),i.global=i.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(j){return typeof j=="number"&&isFinite(j)&&Math.floor(j)===j},i.isString=function(j){return typeof j=="string"||j instanceof String},i.isObject=function(j){return j&&X(j)==="object"},i.isset=i.isSet=function(j,_t){var Wt=j[_t];return!(Wt==null||!j.hasOwnProperty(_t))&&(X(Wt)!=="object"||0<(Array.isArray(Wt)?Wt.length:Object.keys(Wt).length))},i.Buffer=function(){try{var j=i.inquire("buffer").Buffer;return j.prototype.utf8Write?j:null}catch{return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(j){return typeof j=="number"?i.Buffer?i._Buffer_allocUnsafe(j):new i.Array(j):i.Buffer?i._Buffer_from(j):typeof Uint8Array>"u"?j:new Uint8Array(j)},i.Array=typeof Uint8Array<"u"?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(j){return j?i.LongBits.from(j).toHash():i.LongBits.zeroHash},i.longFromHash=function(j,_t){return j=i.LongBits.fromHash(j),i.Long?i.Long.fromBits(j.lo,j.hi,_t):j.toNumber(!!_t)},i.merge=h,i.lcFirst=function(j){return j.charAt(0).toLowerCase()+j.substring(1)},i.newError=_,i.ProtocolError=_("ProtocolError"),i.oneOfGetter=function(j){for(var _t={},Wt=0;Wt<j.length;++Wt)_t[j[Wt]]=1;return function(){for(var _n=Object.keys(this),_i=_n.length-1;-1<_i;--_i)if(_t[_n[_i]]===1&&this[_n[_i]]!==void 0&&this[_n[_i]]!==null)return _n[_i]}},i.oneOfSetter=function(j){return function(_t){for(var Wt=0;Wt<j.length;++Wt)j[Wt]!==_t&&delete this[j[Wt]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var j=i.Buffer;j?(i._Buffer_from=j.from!==Uint8Array.from&&j.from||function(_t,Wt){return new j(_t,Wt)},i._Buffer_allocUnsafe=j.allocUnsafe||function(_t){return new j(_t)}):i._Buffer_from=i._Buffer_allocUnsafe=null}}),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(e){return new V.Array(e)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(e,i,h){return this.tail=this.tail.next=new sf(e,i,h),this.len+=i,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(e,i,h){for(;127<e;)i[h++]=127&e|128,e>>>=7;i[h]=e},ja.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new ui(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},ja.prototype.int32=function(e){return 0>e?this._push(vi,10,Nh.fromNumber(e)):this.uint32(e)},ja.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ja.prototype.uint64=function(e){return e=Nh.from(e),this._push(vi,e.length(),e)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(e){return e=Nh.from(e).zzEncode(),this._push(vi,e.length(),e)},ja.prototype.bool=function(e){return this._push(ti,1,e?1:0)},ja.prototype.fixed32=function(e){return this._push(wi,4,e>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(e){return e=Nh.from(e),this._push(wi,4,e.lo)._push(wi,4,e.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(e){return this._push(V.float.writeFloatLE,4,e)},ja.prototype.double=function(e){return this._push(V.float.writeDoubleLE,8,e)};var UA=V.Array.prototype.set?function(e,i,h){i.set(e,h)}:function(e,i,h){for(var _=0;_<e.length;++_)i[h+_]=e[_]};ja.prototype.bytes=function(e){var i=e.length>>>0;if(!i)return this._push(ti,1,0);if(V.isString(e)){var h=ja.alloc(i=pr.length(e));pr.decode(e,h,0),e=h}return this.uint32(i)._push(UA,i,e)},ja.prototype.string=function(e){var i=qr.length(e);return i?this.uint32(i)._push(qr.write,i,e):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var e=this.head,i=this.tail,h=this.len;return this.reset().uint32(h),h&&(this.tail.next=e.next,this.tail=i,this.len+=h),this},ja.prototype.finish=function(){for(var e=this.head.next,i=this.constructor.alloc(this.len),h=0;e;)e.fn(e.val,i,h),h+=e.len,e=e.next;return i},ja._configure=function(e){el=e,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&V.Buffer.prototype.set.name==="set"?function(e,i,h){i.set(e,h)}:function(e,i,h){if(e.copy)e.copy(i,h,0,e.length);else for(var _=0;_<e.length;)i[h++]=e[_++]}},jc.prototype.bytes=function(e){V.isString(e)&&(e=V._Buffer_from(e,"base64"));var i=e.length>>>0;return this.uint32(i),i&&this._push(jc.writeBytesBuffer,i,e),this},jc.prototype.string=function(e){var i=V.Buffer.byteLength(e);return this.uint32(i),i&&this._push(Ut,i,e),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new La(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new La(e);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(e){return(La.create=function(i){return V.Buffer.isBuffer(i)?new fl(i):sr(i)})(e)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return e}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},La.prototype.bool=function(){return this.uint32()!==0},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var e=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var e=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},La.prototype.bytes=function(){var e=this.uint32(),i=this.pos,h=this.pos+e;if(h>this.len)throw Yb(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(i,h):i===h?new this.buf.constructor(0):this._slice.call(this.buf,i,h)},La.prototype.string=function(){var e=this.bytes();return VA.read(e,0,e.length)},La.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Yb(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Yb(this);while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=7&this.uint32())!=4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},La._configure=function(e){fl=e,La.create=tr(),fl._configure();var i=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[i](!1)},uint64:function(){return yi.call(this)[i](!0)},sint64:function(){return yi.call(this).zzDecode()[i](!1)},fixed64:function(){return Fm.call(this)[i](!0)},sfixed64:function(){return Fm.call(this)[i](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function e(i,h,_,j,_t){if(!j)throw TypeError("request must be specified");var Wt=this;if(!_t)return V.asPromise(e,Wt,i,h,_,j);if(Wt.rpcImpl)try{return Wt.rpcImpl(i,h[Wt.requestDelimited?"encodeDelimited":"encode"](j).finish(),function(_n,_i){if(_n)return Wt.emit("error",_n,i),_t(_n);if(_i!==null){if(!(_i instanceof _))try{_i=_[Wt.responseDelimited?"decodeDelimited":"decode"](_i)}catch(_s){return Wt.emit("error",_s,i),_t(_s)}return Wt.emit("data",_i,i),_t(null,_i)}Wt.end(!0)})}catch(_n){Wt.emit("error",_n,i),setTimeout(function(){_t(_n)},0)}else setTimeout(function(){_t(Error("already ended"))},0)},tf.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a(function(e,i){i.Service=tf}),XA={},fc=$a(function(e,i){function h(){_.util._configure(),_.Writer._configure(_.BufferWriter),_.Reader._configure(_.BufferReader)}var _=i;_.build="minimal",_.Writer=xi,_.BufferWriter=jc,_.Reader=zi,_.BufferReader=Fd,_.util=V,_.rpc=WA,_.roots=XA,_.configure=h,h()});fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var e={},i=Object.create(e);return i[e[0]="Unknown"]=0,i[e[1]="PingUri"]=1,i[e[2]="PongUri"]=2,i[e[11]="UserJoinUri"]=11,i[e[12]="UserRespUri"]=12,i[e[21]="UserQuitUri"]=21,i[e[22]="UserDropUri"]=22,i[e[31]="GroupEnterUri"]=31,i[e[32]="GroupLeaveUri"]=32,i[e[33]="GroupReplyUri"]=33,i[e[36]="GroupEnterNoticeUri"]=36,i[e[37]="GroupLeaveNoticeUri"]=37,i[e[38]="GroupEventNoticeUri"]=38,i[e[39]="GroupCountNoticeUri"]=39,i[e[41]="UserStatusListUri"]=41,i[e[42]="UserStatusResultUri"]=42,i[e[51]="GroupStatusListUri"]=51,i[e[52]="GroupStatusResultUri"]=52,i[e[55]="GroupAllUsersListUri"]=55,i[e[56]="GroupAllUsersResultUri"]=56,i[e[100]="MessageUri"]=100,i[e[101]="AckUri"]=101,i[e[115]="FileUploadIndexGetUri"]=115,i[e[116]="FileUploadIndexRetUri"]=116,i[e[117]="FileUploadIndexSetUri"]=117,i[e[118]="FileUploadIndexFinUri"]=118,i[e[119]="FileUploadIndexErrUri"]=119,i[e[125]="FileDownloadIndexGetUri"]=125,i[e[126]="FileDownloadIndexRetUri"]=126,i[e[127]="FileDownloadIndexErrUri"]=127,i[e[201]="UserJoinNoticeUri"]=201,i[e[202]="UserQuitNoticeUri"]=202,i[e[203]="UserWaitNoticeUri"]=203,i[e[301]="UserAttributeGetUri"]=301,i[e[302]="UserAttributeRetUri"]=302,i[e[303]="UserAttributeSetUri"]=303,i[e[304]="UserAttributeModUri"]=304,i[e[305]="UserAttributeDelUri"]=305,i[e[307]="UserAttributeRspUri"]=307,i[e[308]="UserAttributeErrUri"]=308,i[e[311]="UserAttributeKeysGetUri"]=311,i[e[312]="UserAttributeKeysRetUri"]=312,i[e[351]="GroupAttributeGetUri"]=351,i[e[352]="GroupAttributeRetUri"]=352,i[e[353]="GroupAttributeSetUri"]=353,i[e[354]="GroupAttributeModUri"]=354,i[e[355]="GroupAttributeDelUri"]=355,i[e[356]="GroupAttributeAltUri"]=356,i[e[357]="GroupAttributeRspUri"]=357,i[e[358]="GroupAttributeErrUri"]=358,i[e[361]="GroupAttributeKeysGetUri"]=361,i[e[362]="GroupAttributeKeysRetUri"]=362,i[e[401]="SubscribeUserStatusUri"]=401,i[e[402]="UnsubscribeUserStatusUri"]=402,i[e[499]="SubscribeResponseUri"]=499,i}(),Oh=t.Wrapper=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.uri=0,e.prototype.data=q.newBuffer([]),e.encode=function(i,h){return h||(h=L.create()),i.uri!=null&&Object.hasOwnProperty.call(i,"uri")&&h.uint32(8).int32(i.uri),i.data!=null&&Object.hasOwnProperty.call(i,"data")&&h.uint32(18).bytes(i.data),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.Wrapper;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.uri=i.int32();break;case 2:_.data=i.bytes();break;default:i.skipType(7&j)}}return _},e}(),ZA=t.Ping=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.ms!=null&&Object.hasOwnProperty.call(i,"ms")&&h.uint32(16).uint64(i.ms),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.Ping;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.ms=i.uint64();break;default:i.skipType(7&j)}}return _},e}(),$A=t.Pong=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.ms!=null&&Object.hasOwnProperty.call(i,"ms")&&h.uint32(16).uint64(i.ms),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.Pong;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.ms=i.uint64();break;default:i.skipType(7&j)}}return _},e}(),aB=t.UserJoin=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.opt!=null&&Object.hasOwnProperty.call(i,"opt")&&h.uint32(16).uint64(i.opt),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&h.uint32(24).uint64(i.instance),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&h.uint32(34).string(i.account),i.ticket!=null&&Object.hasOwnProperty.call(i,"ticket")&&h.uint32(42).string(i.ticket),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserJoin;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.opt=i.uint64();break;case 3:_.instance=i.uint64();break;case 4:_.account=i.string();break;case 5:_.ticket=i.string();break;default:i.skipType(7&j)}}return _},e}(),bB=t.UserResp=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&h.uint32(18).string(i.account),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&h.uint32(24).uint32(i.code),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserResp;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),cB=t.UserQuit=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.encode=function(i,h){return h||(h=L.create()),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserQuit;i.pos<h;){var j=i.uint32();i.skipType(7&j)}return _},e}(),dB=t.UserDrop=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.code=0,e.encode=function(i,h){return h||(h=L.create()),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&h.uint32(8).uint32(i.code),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserDrop;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),eB=t.GroupEnter=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&h.uint32(18).string(i.account),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupEnter;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;default:i.skipType(7&j)}}return _},e}(),fB=t.GroupLeave=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.account="",e.encode=function(i,h){return h||(h=L.create()),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&h.uint32(10).string(i.account),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupLeave;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.account=i.string();break;default:i.skipType(7&j)}}return _},e}(),gB=t.GroupReply=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&h.uint32(18).string(i.account),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&h.uint32(24).uint32(i.code),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupReply;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),ur=t.GroupLeaveNotice=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.user!=null&&Object.hasOwnProperty.call(i,"user")&&h.uint32(18).string(i.user),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(26).string(i.group),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&h.uint32(32).uint64(i.instance),i.size!=null&&Object.hasOwnProperty.call(i,"size")&&h.uint32(40).uint32(i.size),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupLeaveNotice;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.user=i.string();break;case 3:_.group=i.string();break;case 4:_.instance=i.uint64();break;case 5:_.size=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),vr=t.GroupEnterNotice=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.user!=null&&Object.hasOwnProperty.call(i,"user")&&h.uint32(18).string(i.user),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(26).string(i.group),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&h.uint32(32).uint64(i.instance),i.size!=null&&Object.hasOwnProperty.call(i,"size")&&h.uint32(40).uint32(i.size),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupEnterNotice;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.user=i.string();break;case 3:_.group=i.string();break;case 4:_.instance=i.uint64();break;case 5:_.size=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),wr=t.Message=function(){function e(i){if(this.MiscMap={},i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=q.newBuffer([]),e.prototype.MiscMap=q.emptyObject,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(i,h){if(h||(h=L.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&h.uint32(8).uint64(i.instance),i.dialogue!=null&&Object.hasOwnProperty.call(i,"dialogue")&&h.uint32(16).uint64(i.dialogue),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&h.uint32(24).uint64(i.sequence),i.options!=null&&Object.hasOwnProperty.call(i,"options")&&h.uint32(32).uint64(i.options),i.src!=null&&Object.hasOwnProperty.call(i,"src")&&h.uint32(42).string(i.src),i.dst!=null&&Object.hasOwnProperty.call(i,"dst")&&h.uint32(50).string(i.dst),i.payload!=null&&Object.hasOwnProperty.call(i,"payload")&&h.uint32(58).bytes(i.payload),i.MiscMap!=null&&Object.hasOwnProperty.call(i,"MiscMap"))for(var _=Object.keys(i.MiscMap),j=0;j<_.length;++j)h.uint32(66).fork().uint32(10).string(_[j]).uint32(18).bytes(i.MiscMap[_[j]]).ldelim();return i.ms!=null&&Object.hasOwnProperty.call(i,"ms")&&h.uint32(72).uint64(i.ms),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _,j,_t=new t.Message;i.pos<h;)switch(_=i.uint32(),_>>>3){case 1:_t.instance=i.uint64();break;case 2:_t.dialogue=i.uint64();break;case 3:_t.sequence=i.uint64();break;case 4:_t.options=i.uint64();break;case 5:_t.src=i.string();break;case 6:_t.dst=i.string();break;case 7:_t.payload=i.bytes();break;case 8:_t.MiscMap===q.emptyObject&&(_t.MiscMap={});var Wt=i.uint32()+i.pos;for(_="",j=[];i.pos<Wt;){var _n=i.uint32();switch(_n>>>3){case 1:_=i.string();break;case 2:j=i.bytes();break;default:i.skipType(7&_n)}}_t.MiscMap[_]=j;break;case 9:_t.ms=i.uint64();break;default:i.skipType(7&_)}return _t},e}(),xr=t.Ack=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(i,h){return h||(h=L.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&h.uint32(8).uint64(i.instance),i.dialogue!=null&&Object.hasOwnProperty.call(i,"dialogue")&&h.uint32(16).uint64(i.dialogue),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&h.uint32(24).uint64(i.sequence),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&h.uint32(32).uint32(i.code),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.Ack;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.dialogue=i.uint64();break;case 3:_.sequence=i.uint64();break;case 4:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),hB=t.FileUploadIndexGet=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.hash!=null&&Object.hasOwnProperty.call(i,"hash")&&h.uint32(18).bytes(i.hash),i.size!=null&&Object.hasOwnProperty.call(i,"size")&&h.uint32(24).uint32(i.size),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.FileUploadIndexGet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.hash=i.bytes();break;case 3:_.size=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),iB=t.FileUploadIndexRet=function(){function e(i){if(this.servers=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.unit!=null&&Object.hasOwnProperty.call(i,"unit")&&h.uint32(16).uint32(i.unit),i.servers!=null&&i.servers.length){h.uint32(26).fork();for(var _=0;_<i.servers.length;++_)h.uint32(i.servers[_]);h.ldelim()}return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.FileUploadIndexRet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.unit=i.uint32();break;case 3:if(_.servers&&_.servers.length||(_.servers=[]),(7&j)==2)for(j=i.uint32()+i.pos;i.pos<j;)_.servers.push(i.uint32());else _.servers.push(i.uint32());break;default:i.skipType(7&j)}}return _},e}(),jB=t.FileUploadIndexSet=function(){function e(i){if(this.servers=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.hash!=null&&Object.hasOwnProperty.call(i,"hash")&&h.uint32(18).bytes(i.hash),i.unit!=null&&Object.hasOwnProperty.call(i,"unit")&&h.uint32(24).uint32(i.unit),i.servers!=null&&i.servers.length){h.uint32(34).fork();for(var _=0;_<i.servers.length;++_)h.uint32(i.servers[_]);h.ldelim()}return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.FileUploadIndexSet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.hash=i.bytes();break;case 3:_.unit=i.uint32();break;case 4:if(_.servers&&_.servers.length||(_.servers=[]),(7&j)==2)for(j=i.uint32()+i.pos;i.pos<j;)_.servers.push(i.uint32());else _.servers.push(i.uint32());break;default:i.skipType(7&j)}}return _},e}(),kB=t.FileUploadIndexFin=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.unit=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.zone!=null&&Object.hasOwnProperty.call(i,"zone")&&h.uint32(16).uint32(i.zone),i.unit!=null&&Object.hasOwnProperty.call(i,"unit")&&h.uint32(24).uint32(i.unit),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.FileUploadIndexFin;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.zone=i.uint32();break;case 3:_.unit=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),lB=t.FileUploadIndexErr=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&h.uint32(16).uint32(i.code),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.FileUploadIndexErr;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),mB=t.FileDownloadIndexGet=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.prototype.unit=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.zone!=null&&Object.hasOwnProperty.call(i,"zone")&&h.uint32(16).uint32(i.zone),i.hash!=null&&Object.hasOwnProperty.call(i,"hash")&&h.uint32(26).bytes(i.hash),i.size!=null&&Object.hasOwnProperty.call(i,"size")&&h.uint32(32).uint32(i.size),i.unit!=null&&Object.hasOwnProperty.call(i,"unit")&&h.uint32(40).uint32(i.unit),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.FileDownloadIndexGet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.zone=i.uint32();break;case 3:_.hash=i.bytes();break;case 4:_.size=i.uint32();break;case 5:_.unit=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),nB=t.FileDownloadIndexRet=function(){function e(i){if(this.servers=[],this.backups=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.zone=0,e.prototype.servers=q.emptyArray,e.prototype.backups=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.unit!=null&&Object.hasOwnProperty.call(i,"unit")&&h.uint32(16).uint32(i.unit),i.zone!=null&&Object.hasOwnProperty.call(i,"zone")&&h.uint32(24).uint32(i.zone),i.servers!=null&&i.servers.length){h.uint32(34).fork();for(var _=0;_<i.servers.length;++_)h.uint32(i.servers[_]);h.ldelim()}if(i.backups!=null&&i.backups.length){for(h.uint32(42).fork(),_=0;_<i.backups.length;++_)h.uint32(i.backups[_]);h.ldelim()}return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.FileDownloadIndexRet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.unit=i.uint32();break;case 3:_.zone=i.uint32();break;case 4:if(_.servers&&_.servers.length||(_.servers=[]),(7&j)==2)for(j=i.uint32()+i.pos;i.pos<j;)_.servers.push(i.uint32());else _.servers.push(i.uint32());break;case 5:if(_.backups&&_.backups.length||(_.backups=[]),(7&j)==2)for(j=i.uint32()+i.pos;i.pos<j;)_.backups.push(i.uint32());else _.backups.push(i.uint32());break;default:i.skipType(7&j)}}return _},e}(),oB=t.FileDownloadIndexErr=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&h.uint32(16).uint32(i.code),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.FileDownloadIndexErr;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),pB=t.GroupAllUsersList=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(18).string(i.group),i.pageSize!=null&&Object.hasOwnProperty.call(i,"pageSize")&&h.uint32(24).uint32(i.pageSize),i.pageNumber!=null&&Object.hasOwnProperty.call(i,"pageNumber")&&h.uint32(32).uint32(i.pageNumber),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAllUsersList;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.pageSize=i.uint32();break;case 4:_.pageNumber=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),qB=t.GroupAllUsersResult=function(){function e(i){if(this.memberInfos=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(18).string(i.group),i.totalSize!=null&&Object.hasOwnProperty.call(i,"totalSize")&&h.uint32(24).uint32(i.totalSize),i.pageSize!=null&&Object.hasOwnProperty.call(i,"pageSize")&&h.uint32(32).uint32(i.pageSize),i.pageNumber!=null&&Object.hasOwnProperty.call(i,"pageNumber")&&h.uint32(40).uint32(i.pageNumber),i.memberInfos!=null&&i.memberInfos.length)for(var _=0;_<i.memberInfos.length;++_)t.GroupAllUsersResult.MemberInfo.encode(i.memberInfos[_],h.uint32(50).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAllUsersResult;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.totalSize=i.uint32();break;case 4:_.pageSize=i.uint32();break;case 5:_.pageNumber=i.uint32();break;case 6:_.memberInfos&&_.memberInfos.length||(_.memberInfos=[]),_.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.MemberInfo=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.account="",i.prototype.ts=0,i.encode=function(h,_){return _||(_=L.create()),h.account!=null&&Object.hasOwnProperty.call(h,"account")&&_.uint32(10).string(h.account),h.ts!=null&&Object.hasOwnProperty.call(h,"ts")&&_.uint32(16).uint32(h.ts),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.GroupAllUsersResult.MemberInfo;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.account=h.string();break;case 2:j.ts=h.uint32();break;default:h.skipType(7&_t)}}return j},i}(),e}(),rB=t.UserStatusList=function(){function e(i){if(this.users=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.users!=null&&i.users.length)for(var _=0;_<i.users.length;++_)h.uint32(18).string(i.users[_]);return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserStatusList;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.users&&_.users.length||(_.users=[]),_.users.push(i.string());break;default:i.skipType(7&j)}}return _},e}(),sB=t.UserStatusResult=function(){function e(i){if(this.userInfos=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.userInfos=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.userInfos!=null&&i.userInfos.length)for(var _=0;_<i.userInfos.length;++_)t.UserStatusResult.UserStatusInfo.encode(i.userInfos[_],h.uint32(18).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserStatusResult;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.userInfos&&_.userInfos.length||(_.userInfos=[]),_.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.UserStatusInfo=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.account="",i.prototype.ts=0,i.encode=function(h,_){return _||(_=L.create()),h.account!=null&&Object.hasOwnProperty.call(h,"account")&&_.uint32(10).string(h.account),h.ts!=null&&Object.hasOwnProperty.call(h,"ts")&&_.uint32(16).uint32(h.ts),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.UserStatusResult.UserStatusInfo;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.account=h.string();break;case 2:j.ts=h.uint32();break;default:h.skipType(7&_t)}}return j},i}(),e}(),tB=t.UserAttributeGet=function(){function e(i){if(this.attributes=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&h.uint32(18).string(i.account),i.attributes!=null&&i.attributes.length)for(var _=0;_<i.attributes.length;++_)h.uint32(26).string(i.attributes[_]);return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserAttributeGet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.attributes&&_.attributes.length||(_.attributes=[]),_.attributes.push(i.string());break;default:i.skipType(7&j)}}return _},e}(),uB=t.UserAttributeRet=function(){function e(i){if(this.attributeInfos=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.attributeInfos!=null&&i.attributeInfos.length)for(var _=0;_<i.attributeInfos.length;++_)t.UserAttributeRet.AttributeInfo.encode(i.attributeInfos[_],h.uint32(18).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserAttributeRet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.attributeInfos&&_.attributeInfos.length||(_.attributeInfos=[]),_.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.AttributeInfo=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.key="",i.prototype.value="",i.encode=function(h,_){return _||(_=L.create()),h.key!=null&&Object.hasOwnProperty.call(h,"key")&&_.uint32(10).string(h.key),h.value!=null&&Object.hasOwnProperty.call(h,"value")&&_.uint32(18).string(h.value),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.UserAttributeRet.AttributeInfo;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.key=h.string();break;case 2:j.value=h.string();break;default:h.skipType(7&_t)}}return j},i}(),e}(),vB=t.UserAttributeSet=function(){function e(i){if(this.attributeInfos=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&h.uint32(18).string(i.account),i.attributeInfos!=null&&i.attributeInfos.length)for(var _=0;_<i.attributeInfos.length;++_)t.UserAttributeSet.AttributeInfo.encode(i.attributeInfos[_],h.uint32(26).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserAttributeSet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.attributeInfos&&_.attributeInfos.length||(_.attributeInfos=[]),_.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.AttributeInfo=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.key="",i.prototype.value="",i.encode=function(h,_){return _||(_=L.create()),h.key!=null&&Object.hasOwnProperty.call(h,"key")&&_.uint32(10).string(h.key),h.value!=null&&Object.hasOwnProperty.call(h,"value")&&_.uint32(18).string(h.value),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.UserAttributeSet.AttributeInfo;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.key=h.string();break;case 2:j.value=h.string();break;default:h.skipType(7&_t)}}return j},i}(),e}(),wB=t.UserAttributeMod=function(){function e(i){if(this.attributeInfos=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&h.uint32(18).string(i.account),i.attributeInfos!=null&&i.attributeInfos.length)for(var _=0;_<i.attributeInfos.length;++_)t.UserAttributeMod.AttributeInfo.encode(i.attributeInfos[_],h.uint32(26).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserAttributeMod;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.attributeInfos&&_.attributeInfos.length||(_.attributeInfos=[]),_.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.AttributeInfo=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.key="",i.prototype.value="",i.encode=function(h,_){return _||(_=L.create()),h.key!=null&&Object.hasOwnProperty.call(h,"key")&&_.uint32(10).string(h.key),h.value!=null&&Object.hasOwnProperty.call(h,"value")&&_.uint32(18).string(h.value),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.UserAttributeMod.AttributeInfo;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.key=h.string();break;case 2:j.value=h.string();break;default:h.skipType(7&_t)}}return j},i}(),e}(),xB=t.UserAttributeDel=function(){function e(i){if(this.attributes=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&h.uint32(18).string(i.account),i.attributes!=null&&i.attributes.length)for(var _=0;_<i.attributes.length;++_)h.uint32(26).string(i.attributes[_]);return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserAttributeDel;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.attributes&&_.attributes.length||(_.attributes=[]),_.attributes.push(i.string());break;default:i.skipType(7&j)}}return _},e}(),yB=t.UserAttributeErr=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&h.uint32(16).uint32(i.code),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserAttributeErr;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),zB=t.UserAttributeKeysGet=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&h.uint32(18).string(i.account),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserAttributeKeysGet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;default:i.skipType(7&j)}}return _},e}(),AB=t.UserAttributeKeysRet=function(){function e(i){if(this.keys=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.keys!=null&&i.keys.length)for(var _=0;_<i.keys.length;++_)h.uint32(18).string(i.keys[_]);return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserAttributeKeysRet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.keys&&_.keys.length||(_.keys=[]),_.keys.push(i.string());break;default:i.skipType(7&j)}}return _},e}(),BB=t.UserAttributeRsp=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserAttributeRsp;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;default:i.skipType(7&j)}}return _},e}(),CB=t.GroupStatusList=function(){function e(i){if(this.groups=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groups=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.groups!=null&&i.groups.length)for(var _=0;_<i.groups.length;++_)h.uint32(18).string(i.groups[_]);return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupStatusList;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.groups&&_.groups.length||(_.groups=[]),_.groups.push(i.string());break;default:i.skipType(7&j)}}return _},e}(),DB=t.GroupStatusResult=function(){function e(i){if(this.groupInfos=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.groupInfos!=null&&i.groupInfos.length)for(var _=0;_<i.groupInfos.length;++_)t.GroupStatusResult.GroupInfo.encode(i.groupInfos[_],h.uint32(18).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupStatusResult;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.groupInfos&&_.groupInfos.length||(_.groupInfos=[]),_.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.GroupInfo=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.group="",i.prototype.memberCount=0,i.encode=function(h,_){return _||(_=L.create()),h.group!=null&&Object.hasOwnProperty.call(h,"group")&&_.uint32(10).string(h.group),h.memberCount!=null&&Object.hasOwnProperty.call(h,"memberCount")&&_.uint32(16).uint32(h.memberCount),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.GroupStatusResult.GroupInfo;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.group=h.string();break;case 2:j.memberCount=h.uint32();break;default:h.skipType(7&_t)}}return j},i}(),e}(),EB=t.GroupCountNotice=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(i,h){return h||(h=L.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&h.uint32(8).uint64(i.instance),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(16).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(26).string(i.group),i.size!=null&&Object.hasOwnProperty.call(i,"size")&&h.uint32(32).uint32(i.size),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupCountNotice;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.seq=i.uint64();break;case 3:_.group=i.string();break;case 4:_.size=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),FB=t.GroupAttributeGet=function(){function e(i){if(this.attributes=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(18).string(i.group),i.attributes!=null&&i.attributes.length)for(var _=0;_<i.attributes.length;++_)h.uint32(26).string(i.attributes[_]);return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAttributeGet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.attributes&&_.attributes.length||(_.attributes=[]),_.attributes.push(i.string());break;default:i.skipType(7&j)}}return _},e}(),GB=t.GroupAttributeRet=function(){function e(i){if(this.attributeMaps=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.attributeMaps!=null&&i.attributeMaps.length)for(var _=0;_<i.attributeMaps.length;++_)t.GroupAttributeRet.AttributeMap.encode(i.attributeMaps[_],h.uint32(18).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAttributeRet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.attributeMaps&&_.attributeMaps.length||(_.attributeMaps=[]),_.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.AttributeMap=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.key="",i.prototype.value="",i.prototype.origin="",i.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,i.encode=function(h,_){return _||(_=L.create()),h.key!=null&&Object.hasOwnProperty.call(h,"key")&&_.uint32(10).string(h.key),h.value!=null&&Object.hasOwnProperty.call(h,"value")&&_.uint32(18).string(h.value),h.origin!=null&&Object.hasOwnProperty.call(h,"origin")&&_.uint32(26).string(h.origin),h.ms!=null&&Object.hasOwnProperty.call(h,"ms")&&_.uint32(32).uint64(h.ms),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.GroupAttributeRet.AttributeMap;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.key=h.string();break;case 2:j.value=h.string();break;case 3:j.origin=h.string();break;case 4:j.ms=h.uint64();break;default:h.skipType(7&_t)}}return j},i}(),e}(),HB=t.GroupAttributeSet=function(){function e(i){if(this.attributeInfos=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(18).string(i.group),i.broadcast!=null&&Object.hasOwnProperty.call(i,"broadcast")&&h.uint32(24).bool(i.broadcast),i.attributeInfos!=null&&i.attributeInfos.length)for(var _=0;_<i.attributeInfos.length;++_)t.GroupAttributeSet.AttributeInfo.encode(i.attributeInfos[_],h.uint32(34).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAttributeSet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.broadcast=i.bool();break;case 4:_.attributeInfos&&_.attributeInfos.length||(_.attributeInfos=[]),_.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.AttributeInfo=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.key="",i.prototype.value="",i.encode=function(h,_){return _||(_=L.create()),h.key!=null&&Object.hasOwnProperty.call(h,"key")&&_.uint32(10).string(h.key),h.value!=null&&Object.hasOwnProperty.call(h,"value")&&_.uint32(18).string(h.value),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.GroupAttributeSet.AttributeInfo;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.key=h.string();break;case 2:j.value=h.string();break;default:h.skipType(7&_t)}}return j},i}(),e}(),IB=t.GroupAttributeMod=function(){function e(i){if(this.attributeInfos=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(18).string(i.group),i.broadcast!=null&&Object.hasOwnProperty.call(i,"broadcast")&&h.uint32(24).bool(i.broadcast),i.attributeInfos!=null&&i.attributeInfos.length)for(var _=0;_<i.attributeInfos.length;++_)t.GroupAttributeMod.AttributeInfo.encode(i.attributeInfos[_],h.uint32(34).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAttributeMod;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.broadcast=i.bool();break;case 4:_.attributeInfos&&_.attributeInfos.length||(_.attributeInfos=[]),_.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.AttributeInfo=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.key="",i.prototype.value="",i.encode=function(h,_){return _||(_=L.create()),h.key!=null&&Object.hasOwnProperty.call(h,"key")&&_.uint32(10).string(h.key),h.value!=null&&Object.hasOwnProperty.call(h,"value")&&_.uint32(18).string(h.value),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.GroupAttributeMod.AttributeInfo;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.key=h.string();break;case 2:j.value=h.string();break;default:h.skipType(7&_t)}}return j},i}(),e}(),JB=t.GroupAttributeDel=function(){function e(i){if(this.attributes=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(18).string(i.group),i.broadcast!=null&&Object.hasOwnProperty.call(i,"broadcast")&&h.uint32(24).bool(i.broadcast),i.attributes!=null&&i.attributes.length)for(var _=0;_<i.attributes.length;++_)h.uint32(34).string(i.attributes[_]);return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAttributeDel;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.broadcast=i.bool();break;case 4:_.attributes&&_.attributes.length||(_.attributes=[]),_.attributes.push(i.string());break;default:i.skipType(7&j)}}return _},e}(),KB=t.GroupAttributeAlt=function(){function e(i){if(this.attributeMaps=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(18).string(i.group),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&h.uint32(24).uint64(i.instance),i.attributeMaps!=null&&i.attributeMaps.length)for(var _=0;_<i.attributeMaps.length;++_)t.GroupAttributeAlt.AttributeMap.encode(i.attributeMaps[_],h.uint32(34).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAttributeAlt;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.instance=i.uint64();break;case 4:_.attributeMaps&&_.attributeMaps.length||(_.attributeMaps=[]),_.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.AttributeMap=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.key="",i.prototype.value="",i.prototype.origin="",i.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,i.encode=function(h,_){return _||(_=L.create()),h.key!=null&&Object.hasOwnProperty.call(h,"key")&&_.uint32(10).string(h.key),h.value!=null&&Object.hasOwnProperty.call(h,"value")&&_.uint32(18).string(h.value),h.origin!=null&&Object.hasOwnProperty.call(h,"origin")&&_.uint32(26).string(h.origin),h.ms!=null&&Object.hasOwnProperty.call(h,"ms")&&_.uint32(32).uint64(h.ms),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.GroupAttributeAlt.AttributeMap;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.key=h.string();break;case 2:j.value=h.string();break;case 3:j.origin=h.string();break;case 4:j.ms=h.uint64();break;default:h.skipType(7&_t)}}return j},i}(),e}(),LB=t.GroupAttributeRsp=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAttributeRsp;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;default:i.skipType(7&j)}}return _},e}(),MB=t.GroupAttributeErr=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&h.uint32(16).uint32(i.code),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAttributeErr;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},e}(),NB=t.GroupAttributeKeysGet=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(i,h){return h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&h.uint32(18).string(i.group),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAttributeKeysGet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;default:i.skipType(7&j)}}return _},e}(),OB=t.GroupAttributeKeysRet=function(){function e(i){if(this.keys=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.keys!=null&&i.keys.length)for(var _=0;_<i.keys.length;++_)h.uint32(18).string(i.keys[_]);return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.GroupAttributeKeysRet;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.keys&&_.keys.length||(_.keys=[]),_.keys.push(i.string());break;default:i.skipType(7&j)}}return _},e}(),PB=t.SubscribeUserStatus=function(){function e(i){if(this.users=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.users!=null&&i.users.length)for(var _=0;_<i.users.length;++_)h.uint32(18).string(i.users[_]);return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.SubscribeUserStatus;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.users&&_.users.length||(_.users=[]),_.users.push(i.string());break;default:i.skipType(7&j)}}return _},e}(),QB=t.UnsubscribeUserStatus=function(){function e(i){if(this.users=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.users!=null&&i.users.length)for(var _=0;_<i.users.length;++_)h.uint32(18).string(i.users[_]);return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UnsubscribeUserStatus;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.users&&_.users.length||(_.users=[]),_.users.push(i.string());break;default:i.skipType(7&j)}}return _},e}(),RB=t.UserJoinNotice=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(i,h){return h||(h=L.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&h.uint32(8).uint64(i.instance),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(16).uint64(i.seq),i.user!=null&&Object.hasOwnProperty.call(i,"user")&&h.uint32(26).string(i.user),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserJoinNotice;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.seq=i.uint64();break;case 3:_.user=i.string();break;default:i.skipType(7&j)}}return _},e}(),SB=t.UserQuitNotice=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(i,h){return h||(h=L.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&h.uint32(8).uint64(i.instance),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(16).uint64(i.seq),i.user!=null&&Object.hasOwnProperty.call(i,"user")&&h.uint32(26).string(i.user),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserQuitNotice;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.seq=i.uint64();break;case 3:_.user=i.string();break;default:i.skipType(7&j)}}return _},e}(),TB=t.UserWaitNotice=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(i,h){return h||(h=L.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&h.uint32(8).uint64(i.instance),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(16).uint64(i.seq),i.user!=null&&Object.hasOwnProperty.call(i,"user")&&h.uint32(26).string(i.user),h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.UserWaitNotice;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.seq=i.uint64();break;case 3:_.user=i.string();break;default:i.skipType(7&j)}}return _},e}(),UB=t.SubscribeResponse=function(){function e(i){if(this.errors=[],i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.errors=q.emptyArray,e.encode=function(i,h){if(h||(h=L.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&h.uint32(8).uint64(i.seq),i.errors!=null&&i.errors.length)for(var _=0;_<i.errors.length;++_)t.SubscribeResponse.SubscribeErrorsType.encode(i.errors[_],h.uint32(18).fork()).ldelim();return h},e.decode=function(i,h){i instanceof u||(i=u.create(i)),h=h===void 0?i.len:i.pos+h;for(var _=new t.SubscribeResponse;i.pos<h;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.errors&&_.errors.length||(_.errors=[]),_.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},e.SubscribeErrorsType=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.account="",i.prototype.code=0,i.encode=function(h,_){return _||(_=L.create()),h.account!=null&&Object.hasOwnProperty.call(h,"account")&&_.uint32(10).string(h.account),h.code!=null&&Object.hasOwnProperty.call(h,"code")&&_.uint32(16).uint32(h.code),_},i.decode=function(h,_){h instanceof u||(h=u.create(h)),_=_===void 0?h.len:h.pos+_;for(var j=new t.SubscribeResponse.SubscribeErrorsType;h.pos<_;){var _t=h.uint32();switch(_t>>>3){case 1:j.account=h.string();break;case 2:j.code=h.uint32();break;default:h.skipType(7&_t)}}return j},i}(),e}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(e){return function(i,h,_){var j=(i=String(jb(i))).length;return _=_===void 0?" ":String(_),(h=ta(h))<=j||_==""?i:(h-=j,(j=Pn.call(_,WB(h/_.length))).length>h&&(j=j.slice(0,h)),e?i+j:j+i)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(e){return YB(this,e,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(e){return function(i){i=qb(i);for(var h,_=Dc(i),j=_.length,_t=0,Wt=[];j>_t;)h=_[_t++],ka&&!ZB.call(i,h)||Wt.push(e?[h,i[h]]:i[h]);return Wt}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(e){return $B(e)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var e=bC(String.prototype,"endsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(e){var i=String(jb(this));ck(e);var h=1<arguments.length?arguments[1]:void 0,_=ta(i.length);return h=h===void 0?_:cC(ta(h),_),_=String(e),Br?Br.call(i,_,h):i.slice(h-_.length,h)===_}}),dh("match",1,function(e,i,h){return[function(_){var j=jb(this),_t=_==null?void 0:_[e];return _t!==void 0?_t.call(_,j):new RegExp(_)[e](String(j))},function(_){var j=h(i,_,this);if(j.done)return j.value;if(_=va(_),j=String(this),!_.global)return Ke(_,j);var _t=_.unicode;_.lastIndex=0;for(var Wt,_n=[],_i=0;(Wt=Ke(_,j))!==null;)Wt=String(Wt[0]),_n[_i]=Wt,Wt===""&&(_.lastIndex=xj(j,ta(_.lastIndex),_t)),_i++;return _i===0?null:_n}]});var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var e=eC(String.prototype,"startsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(e){var i=String(jb(this));ck(e);var h=ta(fC(1<arguments.length?arguments[1]:void 0,i.length)),_=String(e);return Dr?Dr.call(i,_,h):i.slice(h,h+_.length)===_}});var Nm=function(e){var i=/(%?)(%([jds]))/g,h=Array.prototype.slice.call(arguments,1);return h.length&&(e=e.replace(i,function(_,j,_t,Wt){switch(_t=h.shift(),Wt){case"s":_t=""+_t;break;case"d":_t=Number(_t);break;case"j":_t=JSON.stringify(_t)}return j?(h.unshift(_t),_):_t})),h.length&&(e+=" "+h.join(" ")),""+(e=e.replace(/%{2,2}/g,"%"))},hC=/\s/,iC=function(e){for(var i=e.length;i--&&hC.test(e.charAt(i)););return i},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(e){if(typeof e=="number")return e;if(ie(e))return Fr;if(lb(e)&&(e=typeof e.valueOf=="function"?e.valueOf():e,e=lb(e)?e+"":e),typeof e!="string")return e===0?e:+e;e=e&&e.slice(0,iC(e)+1).replace(jC,"");var i=lC.test(e);return i||mC.test(e)?nC(e.slice(2),i?2:8):kC.test(e)?Fr:+e},oC=Math.max,pC=Math.min,qC=function(e,i,h){function _(sE){var dE=_i,vE=_s;return _i=_s=void 0,nE=sE,_u=e.apply(vE,dE)}function j(sE){var dE=sE-_d;return sE-=nE,_d===void 0||dE>=i||0>dE||uE&&sE>=oE}function _t(){var sE=Cb.Date.now();if(j(sE))return Wt(sE);var dE=setTimeout,vE=sE-nE;sE=i-(sE-_d),vE=uE?pC(sE,oE-vE):sE,_h=dE(_t,vE)}function Wt(sE){return _h=void 0,hE&&_i?_(sE):(_i=_s=void 0,_u)}function _n(){var sE=Cb.Date.now(),dE=j(sE);if(_i=arguments,_s=this,_d=sE,dE){if(_h===void 0)return nE=sE=_d,_h=setTimeout(_t,i),aE?_(sE):_u;if(uE)return clearTimeout(_h),_h=setTimeout(_t,i),_(_d)}return _h===void 0&&(_h=setTimeout(_t,i)),_u}var _i,_s,_u,_h,_d,nE=0,aE=!1,uE=!1,hE=!0;if(typeof e!="function")throw new TypeError("Expected a function");if(i=gl(i)||0,lb(h)){aE=!!h.leading;var oE=(uE="maxWait"in h)?oC(gl(h.maxWait)||0,i):oE;hE="trailing"in h?!!h.trailing:hE}return _n.cancel=function(){_h!==void 0&&clearTimeout(_h),nE=0,_i=_d=_s=_h=void 0},_n.flush=function(){return _h===void 0?_u:Wt(Cb.Date.now())},_n},yc=function(e){function i(_,j){return W(this,i),m(n(_=h.call(this,Mm(_,j))),"originalError",void 0),m(n(_),"code",void 0),m(n(_),"serverCode",void 0),typeof j=="number"?_.code=j:typeof j=="string"?_.name=j:j!==void 0&&(j.originalError&&(_.originalError=j.originalError),j.code!==void 0&&(_.code=j.code),j.serverCode!==void 0&&(_.serverCode=j.serverCode)),_}la(i,e);var h=ma(i);return i}(ef(Error)),Ia=function(e){function i(_,j){return W(this,i),m(n(_=h.call(this,Mm(_,j))),"name","RtmInternalError"),m(n(_),"code",void 0),_.code=j,_}la(i,e);var h=ma(i);return i}(ef(Error)),Ph=function(){return function(e){function i(_){W(this,i);var j=Object.keys(_);return h.call(this,_[j[0]],j[0])}la(i,e);var h=ma(i);return i}(Ia)},Fa=Ph(),db=function(e){function i(){W(this,i);for(var _=arguments.length,j=Array(_),_t=0;_t<_;_t++)j[_t]=arguments[_t];return m(n(_=h.call.apply(h,[this].concat(j))),"name","RtmTimeoutError"),_}la(i,e);var h=ma(i);return i}(yc),I=function(e){function i(){W(this,i);for(var _=arguments.length,j=Array(_),_t=0;_t<_;_t++)j[_t]=arguments[_t];return m(n(_=h.call.apply(h,[this].concat(j))),"name","RtmInvalidArgumentError"),_}la(i,e);var h=ma(i);return i}(yc),K=function(e){function i(){W(this,i);for(var _=arguments.length,j=Array(_),_t=0;_t<_;_t++)j[_t]=arguments[_t];return m(n(_=h.call.apply(h,[this].concat(j))),"name","RtmInvalidStatusError"),_}la(i,e);var h=ma(i);return i}(yc),hl=function(e){function i(){W(this,i);for(var _=arguments.length,j=Array(_),_t=0;_t<_;_t++)j[_t]=arguments[_t];return m(n(_=h.call.apply(h,[this].concat(j))),"name","RtmInterruptedError"),_}la(i,e);var h=ma(i);return i}(yc),ib=function(e){function i(){W(this,i);for(var _=arguments.length,j=Array(_),_t=0;_t<_;_t++)j[_t]=arguments[_t];return m(n(_=h.call.apply(h,[this].concat(j))),"name","RtmLimitExceededError"),_}la(i,e);var h=ma(i);return i}(yc),rC=function(e){function i(){W(this,i);for(var _=arguments.length,j=Array(_),_t=0;_t<_;_t++)j[_t]=arguments[_t];return m(n(_=h.call.apply(h,[this].concat(j))),"name","RtmInvokeTooOftenError"),_}la(i,e);var h=ma(i);return i}(yc),da=function(e){function i(){W(this,i);for(var _=arguments.length,j=Array(_),_t=0;_t<_;_t++)j[_t]=arguments[_t];return m(n(_=h.call.apply(h,[this].concat(j))),"name","RtmUnavailableError"),m(n(_),"serverCode",void 0),m(n(_),"statusCode",void 0),_}la(i,e);var h=ma(i);return i}(yc),Ye=function(e){function i(){W(this,i);for(var _=arguments.length,j=Array(_),_t=0;_t<_;_t++)j[_t]=arguments[_t];return m(n(_=h.call.apply(h,[this].concat(j))),"name","RtmUnauthenticatedError"),m(n(_),"serverCode",void 0),_}la(i,e);var h=ma(i);return i}(yc),Wc=function(e){function i(){W(this,i);for(var _=arguments.length,j=Array(_),_t=0;_t<_;_t++)j[_t]=arguments[_t];return m(n(_=h.call.apply(h,[this].concat(j))),"name","RtmUnknownError"),_}la(i,e);var h=ma(i);return i}(yc),Sa=function(e){return e instanceof db||e instanceof pb},sa=function(e){return e instanceof yc},Yd=function(e,i,h){return['Executing "%s.%s" timed out after %ds',e,i,h/1e3]},Lm=new Map,sC=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(e){return typeof e=="string"?e.endsWith(".")?e:"".concat(e,"."):e},Sm=function(e){for(var i="",h=(e=new Uint8Array(e)).byteLength,_=-1;++_<h;)i+=String.fromCharCode(e[_]);return i=btoa(i),"data:;base64,".concat(i)},tC=R(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});N({target:"Date",proto:!0,forced:tC},{toJSON:function(e){e=Qa(this);var i=lc(e);return typeof i!="number"||isFinite(i)?e.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(e,i,h){return JSON.stringify(Ym(e),i,h)};Gr.ensureProperties=Ym;var uC=function(e,i){i=i||{};var h=X(e);if(h==="string"&&0<e.length)return au(e);if(h==="number"&&isFinite(e))return i.long?e=864e5<=(i=Math.abs(e))?Jg(e,i,864e5,"day"):36e5<=i?Jg(e,i,36e5,"hour"):6e4<=i?Jg(e,i,6e4,"minute"):1e3<=i?Jg(e,i,1e3,"second"):e+" ms":e=864e5<=(i=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=i?Math.round(e/36e5)+"h":6e4<=i?Math.round(e/6e4)+"m":1e3<=i?Math.round(e/1e3)+"s":e+"ms",e;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},vC=function(e){function i(j){function _t(){for(var _i=arguments.length,_s=Array(_i),_u=0;_u<_i;_u++)_s[_u]=arguments[_u];if(_t.enabled){_i=Number(new Date),_t.diff=_i-(Wt||_i),_t.prev=Wt,Wt=_t.curr=_i,_s[0]=i.coerce(_s[0]),typeof _s[0]!="string"&&_s.unshift("%O");var _h=0;_s[0]=_s[0].replace(/%([a-zA-Z%])/g,function(_d,nE){return _d==="%%"?"%":(_h++,typeof(nE=i.formatters[nE])=="function"&&(_d=nE.call(_t,_s[_h]),_s.splice(_h,1),_h--),_d)}),i.formatArgs.call(_t,_s),(_t.log||i.log).apply(_t,_s)}}var Wt,_n=null;return _t.namespace=j,_t.useColors=i.useColors(),_t.color=i.selectColor(j),_t.extend=h,_t.destroy=i.destroy,Object.defineProperty(_t,"enabled",{enumerable:!0,configurable:!1,get:function(){return _n===null?i.enabled(j):_n},set:function(_i){_n=_i}}),typeof i.init=="function"&&i.init(_t),_t}function h(j,_t){return(j=i(this.namespace+(_t===void 0?":":_t)+j)).log=this.log,j}function _(j){return j.toString().substring(2,j.toString().length-2).replace(/\.\*\?$/,"*")}return i.debug=i,i.default=i,i.coerce=function(j){return j instanceof Error?j.stack||j.message:j},i.disable=function(){var j=[].concat(G(i.names.map(_)),G(i.skips.map(_).map(function(_t){return"-"+_t}))).join(",");return i.enable(""),j},i.enable=function(j){i.save(j),i.names=[],i.skips=[];var _t,Wt=(typeof j=="string"?j:"").split(/[\s,]+/),_n=Wt.length;for(_t=0;_t<_n;_t++)Wt[_t]&&((j=Wt[_t].replace(/\*/g,".*?"))[0]==="-"?i.skips.push(new RegExp("^"+j.substr(1)+"$")):i.names.push(new RegExp("^"+j+"$")))},i.enabled=function(j){if(j[j.length-1]==="*")return!0;var _t,Wt=0;for(_t=i.skips.length;Wt<_t;Wt++)if(i.skips[Wt].test(j))return!1;for(Wt=0,_t=i.names.length;Wt<_t;Wt++)if(i.names[Wt].test(j))return!0;return!1},i.humanize=uC,i.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(function(j){i[j]=e[j]}),i.names=[],i.skips=[],i.formatters={},i.selectColor=function(j){for(var _t=0,Wt=0;Wt<j.length;Wt++)_t=(_t<<5)-_t+j.charCodeAt(Wt),_t|=0;return i.colors[Math.abs(_t)%i.colors.length]},i.enable(i.load()),i},Hr=$a(function(e,i){i.formatArgs=function(_){if(_[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+_[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var j="color: "+this.color;_.splice(1,0,j,"color: inherit");var _t=0,Wt=0;_[0].replace(/%[a-zA-Z%]/g,function(_n){_n!=="%%"&&(_t++,_n==="%c"&&(Wt=_t))}),_.splice(Wt,0,j)}},i.save=function(_){try{_?i.storage.setItem("debug",_):i.storage.removeItem("debug")}catch{}},i.load=function(){try{var _=i.storage.getItem("debug")}catch{}return!_&&typeof process<"u"&&"env"in process&&(_=define_process_env_default.DEBUG),_},i.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var h=localStorage;break t}catch{}h=void 0}i.storage=h,i.destroy=function(){var _=!1;return function(){_||(_=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),i.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),i.log=console.debug||console.log||function(){},e.exports=vC(i),e.exports.formatters.j=function(_){try{return JSON.stringify(_)}catch(j){return"[UnexpectedJSONParseError]: "+j.message}}}),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function e(i){W(this,e),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=i.processId,this.sdkVersion=i.sdkVersion,this.rtmConfig=i.rtmConfig,this.uploadRequest=i.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(e,[{key:"upload",value:function(i){this.LogCache.push(i),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(i){var h=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark(function _(){var j,_t,Wt;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:return j={sdk_version:h.sdkVersion,process_id:h.processId,payload:JSON.stringify(i)},_n.prev=1,_n.next=4,h.uploadRequest(j,(_t=h.rtmConfig.enableCloudProxy)!==null&&_t!==void 0&&_t);case 4:if(!Uk){_n.next=6;break}throw Error("RTM is busy");case 6:_n.next=13;break;case 8:return _n.prev=8,_n.t0=_n.catch(1),Wt=2>h.uploadResendCount++?2e3:1e4,setTimeout(function(){return h.postLog(h.LogsToPost)},Wt),_n.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),h.LogCache.length!==0){_n.next=17;break}return h.uploadState=Ze.Free,_n.abrupt("return");case 17:h.uploadResendCount=0,h.LogsToPost=40>h.LogCache.length?h.LogCache.splice(0,h.LogCache.length):h.LogCache.splice(0,40),h.postLog(h.LogsToPost);case 20:case"end":return _n.stop()}},_,null,[[1,8]])})),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),Jr=function(e,i,h,_,j,_t,Wt,_n){var _i=0;for(Wt=!!Wt&&Id(Wt,_n,3);_i<_;){if(_i in h){if(_n=Wt?Wt(h[_i],_i,i):h[_i],0<_t&&gd(_n))j=Jr(e,i,_n,ta(_n.length),j,_t-1)-1;else{if(9007199254740991<=j)throw TypeError("Exceed the acceptable array length");e[j]=_n}j++}_i++}return j},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,i=Qa(this),h=ta(i.length),_=Sg(i,0);return _.length=xC(_,i,i,h,0,e===void 0?1:$b(e)),_}}),N({target:"Object",stat:!0},{values:function(e){return aC(e)}});var yC=["CODE"],Db,ud,F;(function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"})(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(e){return Object.values(yf).flat().includes(e)},cu=function(e){var i;return(i=Hg(yf).find(function(h){return(h=ra(h,2))[0],h[1].includes(e)}))===null||i===void 0?void 0:i[0]},AC=function(e){return e.sort(function(i,h){return Kr.indexOf(i)-Kr.indexOf(h)})},xe=function(e){var i=new Set;if((e=AC(e).slice(0,3).map(function(h){var _=Kg[h];if(_===void 0)throw new Ia("invalid area key");return h=_.CODE,_=ff(_,yC),i.add(h),_})).length===0)throw new Ia("areas cannot be empty");return ua({CODES:i},e.reduce(function(h,_){for(var j=0,_t=Hg(h);j<_t.length;j++){var Wt=ra(_t[j],2),_n=Wt[0];Wt=Wt[1],h[_n]=Array.from(new Set([].concat(G(_[_n]),G(Wt))))}return h}))},M,Lr=function(){var e=J(w.mark(function i(h,_){var j,_t,Wt,_n,_i,_s=arguments;return w.wrap(function(_u){for(;;)switch(_u.prev=_u.next){case 0:if(!(2<(_t=2<_s.length&&_s[2]!==void 0?_s[2]:0))){_u.next=3;break}return _u.abrupt("return");case 3:return Wt={withCredentials:!0,body:h,timeout:2e4},_n=0<_t?(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",_i=_?"https://".concat((j=M==null?void 0:M.PROXY_NGINX[0])!==null&&j!==void 0?j:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(_n,"&p=443&d=upload/v1"):"https://".concat(_n,"/upload/v1"),_u.next=8,te(_i,Wt).catch(function(_h){return Lr(h,_,_t+1)});case 8:case"end":return _u.stop()}},i)}));return function(i,h){return e.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(e){if(typeof e=="string")return oa(e);if(Array.isArray(e)&&e.every(function(_t){return typeof _t=="string"}))return e.map(function(_t){return oa(_t)});if(!Il(e)){for(var i={},h=0;h<Or.length;h++){var _=Or[h];_ in e&&(i[_]=e[_])}if(0<Object.keys(i).length)return i;if(5>Object.keys(e).length){for(h=0,e=Object.entries(e);h<e.length;h++){var j=ra(e[h],2);_=j[0],j=j[1],il.includes(_)?i[_]="[Hidden Info]":i[oa(_)]=typeof j=="string"?oa(j):"[Sensitive Info]"}return i}return"[Sensitive Info]"}return e},Pr=function(e){return X(e)==="object"?yd(e)?Vm(fe(e,5),il,Nr):e.constructor&&e.constructor.name:e},Qr=function(e,i){return e instanceof Error?e.message:typeof e!="string"?JSON.stringify(Vm(fe(e,5),il,Nr)):(i=i.map(function(h){return h instanceof Error?h.message:X(h)==="object"?Gr(Array.isArray(h)?h.map(Pr):Pr(h)):h}),Nm.apply(void 0,[e.replace(/%[%Oo]/g,function(h){return h==="%%"?"%":h==="%o"||h==="%O"?"%s":h})].concat(G(i))))},CC=1,Rr=function(e,i,h){var _=Hr(e);return _.enabled=!0,_.log=h,_.useColors=!1,function(j){for(var _t=arguments.length,Wt=Array(1<_t?_t-1:0),_n=1;_n<_t;_n++)Wt[_n-1]=arguments[_n];if(i.enableLogUpload){_t=Cg(j);var _i=Qr(_t,Wt);Mr.upload({log_item_id:"".concat(CC++),log_level:e,payload_str:"[".concat(sC(),"] ").concat(e," - ").concat(256<_i.length?_i.slice(0,256):_i)})}switch(_t=function(_s){var _u=_i||Qr(Cg(j),Wt),_h=Nc.LOG_HANDLER;typeof _h=="function"&&_h({level:_s,message:_u}),_(_u)},e){case"RTM:INFO":i.logFilter.info&&_t("log");break;case"RTM:WARN":i.logFilter.warn&&_t("warning");break;case"RTM:ERROR":i.logFilter.error&&_t("error");break;case"RTM:TRACK":i.logFilter.track&&_t("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":i.logFilter.debug&&_t("debug");break;case"RTM:DEBUG":i.logFilter.debug&&_t("debug")}}},jl,Sr=function(e){return function(i){var h=jl===1||e===void 0?"":"Ins#".concat(e," ");return"".concat(h).concat(i)}},kl=function(e,i,h){var _=Sr(jl);return Rr("RTM:".concat(i),h,function(j){return e(_(j))})},tb=function(){return function(e){function i(_,j){var _t=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,i);var Wt=h.call(this);if(m(n(Wt),"logError",void 0),m(n(Wt),"invokeTracker",void 0),m(n(Wt),"resultTracker",void 0),m(n(Wt),"errorTracker",void 0),m(n(Wt),"eventTracker",void 0),m(n(Wt),"info",void 0),m(n(Wt),"warn",void 0),m(n(Wt),"log",void 0),m(n(Wt),"genLogger",void 0),m(n(Wt),"loggerId",void 0),m(n(Wt),"logger",void 0),m(n(Wt),"name",void 0),Wt.logger=_,Wt.name=j,Wt.loggerId=_.loggerId,Wt.info=_.info,Wt.warn=_.warn,Wt.logError=_.logError,Wt.genLogger=_.genLogger,Wt.log=_.genLogger("RTM:DEBUG","<".concat(j,"> ")),Wt.invokeTracker=_.genTracker("Invoke"),Wt.eventTracker=_.genTracker("Event"),Wt.resultTracker=_.genTracker("Result"),Wt.errorTracker=_.genTracker("Error"),_t){var _n=Wt.emit.bind(n(Wt));Wt.emit=function(){for(var _i=arguments.length,_s=Array(_i),_u=0;_u<_i;_u++)_s[_u]=arguments[_u];_i=_s[0],_u=_s.slice(1);var _h=BC.includes(_i);Wt.eventTracker.apply(Wt,["%s: ".concat(0<_u.length?"%s emitted with args: ".concat(_u.map(function(){return"%o"})):"%s emitted"),j,_i].concat(G(_h?_u.map(ye):_u)));try{_n.apply(void 0,_s)}catch(_d){Wt.logError("Caught in the callback function of the event %s",_i,_d)}}}return Wt}la(i,e);var h=ma(i);return i}(ea)},DC=function(e){return kl(console.log.bind(console),"INFO",e)},EC=function(e){return kl(console.warn.bind(console),"WARN",e)},FC=function(e){return kl(console.error.bind(console),"ERROR",e)},Tr=function(e,i){return function(h){var _=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",j=Sr(e),_t=console.debug.bind(console),Wt=Rr(h,i,function(_n){return _t(j(_n))});return function(_n){for(var _i=arguments.length,_s=Array(1<_i?_i-1:0),_u=1;_u<_i;_u++)_s[_u-1]=arguments[_u];return Wt.apply(void 0,[_+_n].concat(_s))}}},GC=function(e,i){return function(h){return Tr(e,i)("RTM:TRACK","[".concat(h,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(e,i){var h=-1,_=e.length,j=_-1;for(i=i===void 0?_:i;++h<i;){var _t=e[_=nr(h,j)];e[_]=e[h],e[h]=_t}return e.length=i,e},IC=function(e){return Ur(Xh(e))},JC=function(e){return Ur(Ni(e))},$e=function(e){return(Va(e)?IC:JC)(e)},af={0:9591,1:9593},$d=function(e){return"https://".concat(e,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(e){function i(_,j,_t,Wt,_n,_i){W(this,i);var _s=h.call(this,_n,Ai("Socket-",_n.loggerId));if(m(n(_s),"isActiveClose",!1),m(n(_s),"loggedIn",!1),m(n(_s),"useNewDomain",void 0),m(n(_s),"receivedPacket",new Pa),m(n(_s),"open$",void 0),m(n(_s),"input$",new Pa),m(n(_s),"userJoin$",new Pa),m(n(_s),"attemptsSinceLastError",0),m(n(_s),"message$",new Pa),m(n(_s),"socket$",void 0),m(n(_s),"toClose",new Pa),m(n(_s),"toReconnect",new Pa),m(n(_s),"sendLogger",void 0),m(n(_s),"receiveLogger",void 0),m(n(_s),"ip",void 0),m(n(_s),"env",void 0),m(n(_s),"ticket",void 0),m(n(_s),"context",void 0),m(n(_s),"getDomain",function(){return an(_s.ip,_s.useNewDomain)}),m(n(_s),"socketReconnector",function(_d){var nE=function(aE){return _s.attemptsSinceLastError+=1,_s.warn("The %s of Env %d reconnecting %s",_s.name,_s.env,aE.message),Bc(3e3)};return _d.pipe(Ga(function(aE){return _s.log("socket connection closed"),_s.loggedIn=!1,2<=_s.attemptsSinceLastError?(_s.warn("socket connection failure"),_s.emit("connectionFailure"),_s.close(),Z(aE)):_s.isActiveClose?vb:(_s.emit("reconnect"),_s.useNewDomain=!_s.useNewDomain,Z(aE))}),oe(function(aE){return aE.pipe(Cc(nE))}))}),_s.ip=_,_s.env=j,_s.ticket=_t,_s.context=Wt,_s.useNewDomain=_i??.5<=Math.random(),_s.sendLogger=_s.genLogger("RTM:MSG:SEND"),_s.receiveLogger=_s.genLogger("RTM:MSG:RECV"),j!==0&&j!==1)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(_))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var _u=af[j];_s.log("Opening websocket address %s for the Env %d",_s.ip,_s.env);var _h=Xb(_s.input$,_s.userJoin$.pipe(Rt(2)),_s.message$).pipe(ba(function(_d){return Oh.encode(_d).finish()}));return _=Xb(St("",{protocols:[],makeWebSocket:function(){if(_s.context.config.enableCloudProxy){if(_s.context.cloudProxyServers.length===0)throw _s.logError("No cloud proxy server to connect"),new da;var _d="wss://".concat(an(bn(_s.context.cloudProxyServers),!1),"/");_d=we(_d,"sid",_s.context.sid),_d=we(_d,"remote_port",_u.toString()),_d=we(_d,"remote_ip",_s.ip),_d=we(_d,"token",_s.context.key),_d=new WebSocket(_d)}else _d=new WebSocket("wss://".concat(_s.getDomain(),":").concat(_u));return _d.binaryType="arraybuffer",_d}}),_s.toReconnect),_s.socket$=Ca(_,Tk.pipe(hb(15e3),Ga(function(_d){return Sa(_d)&&_s.warn("socket open timed out"),Z(_d)}))).pipe(ba(function(_d){if(_d instanceof Error)throw _s.warn("Env_%d: Force reconnect the socket",_s.env),_d;return _d(_h).pipe(ba(function(nE){return Oh.decode(new Uint8Array(nE))}))}),_s.socketReconnector),_s.open$=_s.socket$.pipe(ca(function(_d){_s.log("Websocket opened",_s.name),_d.subscribe(function(nE){var aE=nE.data;nE=Li[nE.uri].slice(0,-3),aE=$m[nE].decode(aE);var uE=HA({},Gk(aE,"toJSON"),function(dE,vE){return vE instanceof U?Km(vE):vE}),hE=!1;if((aE instanceof vr||aE instanceof ur)&&aE.instance.lessThanOrEqual(4294967295)&&(hE=!0),aE instanceof wr||aE instanceof xr){var oE=aE.instance,sE=aE.sequence;(aE.dialogue.lessThanOrEqual(4294967295)||oE.lessThanOrEqual(4294967295)||sE.lessThan(1))&&(hE=!0)}hE?_s.warn("Env_%d: Illegal %s, abandoned %o",_s.env,nE,uE):(nE!=="Pong"&&_s.receiveLogger("Env_%d: %s %o",_s.env,nE,uE),_s.receivedPacket.next([nE,aE]))},function(){})}),qf(void 0),ob(_s.toClose),pe()),_s}la(i,e);var h=ma(i);return Ha(i,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(_,j){if(_!=="Ping"){var _t=uc(j,function(Wt){return Wt instanceof U?Km(Wt):Wt});this.sendLogger("Env_%d: %s %o",this.env,_,_t)}j=du(_,j),_==="UserJoin"?this.userJoin$.next(j):_==="Message"?this.message$.next(j):this.input$.next(j)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(_){var j=this;return this.receivedPacket.pipe(ca(function(_t){var Wt=ra(_t,2);_t=Wt[0],Wt=Wt[1],_t==="UserResp"&&(j.attemptsSinceLastError=0,j.loggedIn=!0),_t==="UserDrop"&&j.emit("socketUserDrop",Wt)}),wb(function(_t){return ra(_t,1)[0]===_}),ba(function(_t){return ra(_t,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),i}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(e){return XB(this,e,1<arguments.length?arguments[1]:void 0)}});var OC=function(e){var i=xf(Kg);e=Yt(e);for(var h=0;h<i.length;h++){var _=Kg[i[h]];if(_!=null&&_.AP_DOMAINS.includes(e)||_!=null&&_.AP_BACKUP_DOMAINS.includes(e)||_!=null&&_.PROXY_AP.includes(e))return[_.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(e){function i(_,j){var _t=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,i);var Wt=h.call(this,j,"AccessPoint");return m(n(Wt),"handleUniLbsError",function(_n,_i){var _s=_n;if(4<_n.toString().length){var _u=_n.toString().padStart(8,"0"),_h=parseInt(_u.slice(0,4),10);if(_u=parseInt(_u.slice(4,8),10),_h===201)_s=_u;else if(_h===101&&!QC.includes(_u))return Z(Error("service is currently unavailable"))}if(_h=_s.toString(),!Object.keys(Vr).includes(_h))return(_n=new da(["Login is rejected by the server. The response code is %d",_n],jg)).serverCode=_s,Z(_n);switch(_h=Vr[_h],_s=PC[_h],_h){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(_i=new Ye(_s,$q)).serverCode=_n,Z(_i);case"INVALID_USER_ID":return(_i=new Ye(_s,Jh)).serverCode=_n,Z(_i);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(_i=new Ye(_s,Kh)).serverCode=_n,Z(_i);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(_i=new Ye(_s,ar)).serverCode=_n,Z(_i);case"CANNOT_MEET_AREA_DEMAND":return(_i=OC(_i)).forEach(function(_d){return Wt.failedAreas.add(_d)}),Wt.failedAreas.size===(M===void 0?2:M.CODES.size)?((_i=new I(_s,jg)).serverCode=_n,Z(_i)):Z(Error("ap ".concat(_i.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(_i=new da(_s,jg)).serverCode=_n,Z(_i);default:return Z(Im("ApResErrType",_h))}}),m(n(Wt),"getApEdgeInfo$",void 0),m(n(Wt),"getApEdgeInfoEndFirst$",void 0),m(n(Wt),"apFinish$",new Pa),m(n(Wt),"retryCount",0),m(n(Wt),"failedAreas",new Set),m(n(Wt),"usedUrl",[]),m(n(Wt),"newDomainUsed",!1),m(n(Wt),"backupNewDomainUsed",!1),m(n(Wt),"genUrl",function(){return M===void 0?mi.apply(void 0,G($e([KC,LC]))).pipe(ni(function(_n){return bb.apply(void 0,G(_n))})):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))}),m(n(Wt),"genBackupUrl",function(){return M===void 0?mi.apply(void 0,G($e([MC,NC]))).pipe(ni(function(_n){return bb.apply(void 0,G(_n))})):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))}),m(n(Wt),"getApUrl$",function(_n){var _i,_s;return Wt.genUrl().pipe(wb(function(_u){return(!Wt.newDomainUsed||!_u.includes("sd-rtn.com"))&&(_u.includes("sd-rtn.com")&&(Wt.newDomainUsed=!0),!dl(Wt.usedUrl,function(_h){var _d;return _h===((_d=_u.match(Qh))===null||_d===void 0?void 0:_d[1])}))}),ca(function(_u){var _h;M===void 0&&typeof(_u=(_h=_u.match(Qh))===null||_h===void 0?void 0:_h[1])=="string"&&Wt.usedUrl.push(_u)}),Ka(_n?Math.max(Nc.RECONNECTING_AP_NUM,(_i=M==null?void 0:M.CODES.size)!==null&&_i!==void 0?_i:0):(_s=M==null?void 0:M.CODES.size)!==null&&_s!==void 0?_s:2),Dd(function(){return i.runOutOfUrlSymbol}),Ga(function(_u,_h){return Wt.newDomainUsed=!1,_u===i.runOutOfUrlSymbol?(Wt.usedUrl=[],_h):Z(_u)}))}),m(n(Wt),"getBackupApUrl$",function(_n){var _i,_s;return Wt.genBackupUrl().pipe(wb(function(_u){return(!Wt.backupNewDomainUsed||!_u.includes("sd-rtn.com"))&&(_u.includes("sd-rtn.com")&&(Wt.backupNewDomainUsed=!0),!dl(Wt.usedUrl,function(_h){var _d;return _h===((_d=_u.match(Qh))===null||_d===void 0?void 0:_d[1])}))}),ca(function(_u){var _h;M===void 0&&typeof(_u=(_h=_u.match(Qh))===null||_h===void 0?void 0:_h[1])=="string"&&Wt.usedUrl.push(_u)}),Ka(_n?Math.max(Nc.RECONNECTING_AP_NUM,(_i=M==null?void 0:M.CODES.size)!==null&&_i!==void 0?_i:0):(_s=M==null?void 0:M.CODES.size)!==null&&_s!==void 0?_s:2),Dd(function(){return i.runOutOfUrlSymbol}),Ga(function(_u,_h){return Wt.backupNewDomainUsed=!1,_u===i.runOutOfUrlSymbol?(Wt.usedUrl=[],_h):Z(_u)}))}),m(n(Wt),"getProxyApUrl$",function(_n){var _i,_s;return bb.apply(void 0,G(((M==null?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(_n?Math.max(Nc.RECONNECTING_AP_NUM,(_i=M==null?void 0:M.CODES.size)!==null&&_i!==void 0?_i:0):(_s=M==null?void 0:M.CODES.size)!==null&&_s!==void 0?_s:2))}),m(n(Wt),"context",void 0),m(n(Wt),"fetchCloudProxy",function(_n,_i){var _s=Ai("AP-",Wt.loggerId);Wt.log("The AccessPoint requests %s(%s)",_n,_s);var _u=new AbortController;return Wt.apFinish$.pipe(Ka(1)).subscribe(function(){return _u.abort()}),ad(J(w.mark(function _h(){var _d;return w.wrap(function(nE){for(;;)switch(nE.prev=nE.next){case 0:return _d=Ag(0,Number.MAX_SAFE_INTEGER),Wt.log("%s request opid: %d",_s,_d),nE.abrupt("return",te(_n,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:Wt.context.sid,opid:_d,appid:Wt.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:_i??Wt.context.key,cname:Wt.context.uid,uid:0,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(aE){return aE===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):aE}).join(",")})}}]},signal:_u.signal}));case 3:case"end":return nE.stop()}},_h)}))).pipe(Ga(function(_h){return _h.name!=="AbortError"&&(Wt.logError(_h),Wt.warn("The AP server %s request failure",_n,_h)),vb}),cb(function(){var _h=J(w.mark(function _d(nE){var aE,uE,hE,oE,sE,dE,vE,AE,PE,IE,QE,m_,yE,FE,UE,qE,gE,RE,OE;return w.wrap(function(HE){for(;;)switch(HE.prev=HE.next){case 0:if(aE=nE.responseText,uE=JSON.parse(aE),Wt.log("The %s response is %o",_s,uE),((hE=uE.response_body)===void 0||hE.length===0||hE.some(function(CE){var jE;return((jE=CE.buffer)===null||jE===void 0?void 0:jE.code)===void 0||CE.uri!==23}))&&Z(new da("cloud proxy response_body not valid",jg)),(oE=hE.filter(function(CE){return CE.buffer.code!==0})).length===0){HE.next=14;break}if((sE=oE.find(function(CE){return CE.buffer.flag===128}))===void 0){HE.next=12;break}return HE.abrupt("return",Wt.handleUniLbsError(sE.buffer.code,_n));case 12:return Wt.logError("cloud proxy error response"),HE.abrupt("return",Wt.handleUniLbsError(oE[0].buffer.code,_n));case 14:for(dE=[],vE=0;vE<hE.length;vE++)if(((IE=hE[vE])==null||(AE=IE.buffer)===null||AE===void 0?void 0:AE.flag)===262144)(QE=IE.buffer)===null||QE===void 0||(m_=QE.edges_services)===null||m_===void 0||(yE=m_.forEach)===null||yE===void 0||yE.call(m_,function(CE){Gm(CE=CE.ip)&&Wt.context.cloudProxyServers.indexOf(CE)===-1&&(Wt.log("got cloud proxy server: %s",CE),Wt.context.cloudProxyServers.push(CE))});else if((IE==null||(PE=IE.buffer)===null||PE===void 0?void 0:PE.flag)===128){for(gE=function(CE,jE){var LE=jE[CE];dE.some(function(i_){return i_.ip===LE.ip})||dE.push({ip:LE.ip,ticket:IE.buffer.cert})},RE=0,OE=IE.buffer.edges_services;RE<OE.length;RE++)gE(RE,OE);Wt.context.rtmArea=(FE=(UE=IE.buffer)===null||UE===void 0||(qE=UE.detail)===null||qE===void 0?void 0:qE[9])!==null&&FE!==void 0?FE:""}return HE.abrupt("return",bb.apply(void 0,G(dE).concat([fg])));case 19:case"end":return HE.stop()}},_d)}));return function(_d){return _h.apply(this,arguments)}}()),Ga(function(_h){return sa(_h)?Z(_h):vb}),tg(),wb(function(_h){return _h!==void 0&&typeof _h.ip=="string"&&typeof _h.ticket=="string"}))}),m(n(Wt),"fetchAp",function(_n,_i){var _s=Ai("AP-",Wt.loggerId);Wt.log("The AccessPoint requests %s(%s)",_n,_s);var _u=new AbortController;return Wt.apFinish$.pipe(Ka(1)).subscribe(function(){return _u.abort()}),ad(J(w.mark(function _h(){var _d;return w.wrap(function(nE){for(;;)switch(nE.prev=nE.next){case 0:return _d=Ag(0,Number.MAX_SAFE_INTEGER),Wt.log("%s request opid: %d",_s,_d),nE.abrupt("return",te(_n,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:_d,key:_i||Wt.context.key,cname:Wt.context.uid,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(aE){return aE===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):aE}).join(",")}),uid:0,sid:Wt.context.sid},signal:_u.signal}));case 3:case"end":return nE.stop()}},_h)}))).pipe(Ga(function(_h){return _h.name!=="AbortError"&&(Wt.logError(_h),Wt.warn("The AP server %s request failure",_n,_h)),vb}),cb(function(){var _h=J(w.mark(function _d(nE){var aE,uE,hE,oE,sE,dE,vE;return w.wrap(function(AE){for(;;)switch(AE.prev=AE.next){case 0:if(aE=nE.responseText,uE=JSON.parse(aE),Wt.log("The %s response is %o",_s,uE),oE=(hE=uE).code,sE=hE.addresses,dE=hE.detail,oE===0){AE.next=6;break}return AE.abrupt("return",Wt.handleUniLbsError(oE,_n));case 6:if((vE=sE).length!==0){AE.next=11;break}return AE.abrupt("return",Z(Error("No available edge address to connect")));case 11:return Wt.context.rtmArea=dE==null?void 0:dE[9],AE.abrupt("return",bb.apply(void 0,G(vE).concat([fg])));case 13:case"end":return AE.stop()}},_d)}));return function(_d){return _h.apply(this,arguments)}}()),tg(),Ga(function(_h){return sa(_h)?Z(_h):vb}),wb(function(_h){return _h!==void 0&&typeof _h.ip=="string"&&typeof _h.ticket=="string"}))}),Wt.context=_,Wt.getApEdgeInfoEndFirst$=function(){var _n=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return Bc(0,_n||_t?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca(function(){Wt.retryCount+=1}),cb(function(){return Wt.context.config.enableCloudProxy?Wt.getProxyApUrl$(_n||_t):(4<=Wt.retryCount&&(Wt.retryCount=0),3>=Wt.retryCount?Wt.getApUrl$(_n||_t):Wt.getBackupApUrl$(_n||_t))}),cb(function(_i){return Wt.context.config.enableCloudProxy?Wt.fetchCloudProxy(_i):Wt.fetchAp(_i)}),Ga(function(_i){return _i instanceof pb&&Wt.warn("AP request timeout"),Z(_i)}),om(function(_i){return _i.ip}),ob(Wt.apFinish$))},Wt.getApEdgeInfo$=function(_n){return Bc(0,_n||_t?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca(function(){Wt.retryCount+=1}),cb(function(){return Wt.context.config.enableCloudProxy?Wt.getProxyApUrl$(_n||_t):3>=Wt.retryCount?Wt.getApUrl$(_n||_t):Wt.getBackupApUrl$(_n||_t)}),cb(function(_i){return(Wt.context.config.enableCloudProxy?Wt.fetchCloudProxy(_i):Wt.fetchAp(_i)).pipe()}),Ga(function(_i){return _i instanceof pb&&Wt.warn("AP request timeout"),Z(_i)}),om(function(_i){return _i.ip}),ob(Wt.apFinish$))},Wt}la(i,e);var h=ma(i);return Ha(i,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),i}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(e){function i(_,j,_t){W(this,i);var Wt=h.call(this,j,"Connection");m(n(Wt),"apClient",void 0),m(n(Wt),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(Wt),"curOpenSockets",[void 0,void 0]),m(n(Wt),"ipIterator",0),m(n(Wt),"firstEnv",.5<=Math.random()?1:0),m(n(Wt),"firstSocketOpener",void 0),m(n(Wt),"secondSocketOpener",void 0),m(n(Wt),"firstOpenKeeperSubject",new Pa),m(n(Wt),"secondOpenKeeperSubject",new Pa),m(n(Wt),"edgeInfoReplayed",void 0),m(n(Wt),"firstEnvOpenSocket",void 0),m(n(Wt),"firstOpenKeeperSub",void 0),m(n(Wt),"secondOpenKeeperSub",void 0),m(n(Wt),"context",void 0),m(n(Wt),"logger",void 0),Wt.context=_,Wt.logger=j,Wt.apClient=new Wr(Wt.context,j),Wt.apClient.apFinish$.subscribe(function(){Wt.log("Ap client fetch finished")});var _n,_i=[];return Wt.edgeInfoReplayed=Wt.apClient.getApEdgeInfo$(_t).pipe(oe(function(_s){return _s.pipe(ca(function(_u){if(sa(_u))throw _u}),cd(_t?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))}),wb(function(_s){return!dl(_i,_s)}),Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),ca(function(_s){_i.push(_s),Wt.log("An edge info got %o",_s)}),ca({error:function(_s){Wt.emit("connectionInitFailure",_s)}}),wg(function(){Wt.apClient.clearUp()}),sm()),Wt.firstEnvOpenSocket=Wt.edgeInfoReplayed.pipe(cb(function(_s){if(_s===void 0)return Z(Error("Invalid edge info"));var _u=new ml(_s.ip,Wt.firstEnv,_s.ticket,Wt.context,j,_n);return Wt.firstEnv=Wt.firstEnv===1?0:1,_u.on("connectionFailure",function(){return Wt.onSocketConnectionFailure(_u)}),_n=!_u.useNewDomain,_u.open$.pipe(qf(_u))}),ca(function(_s){Wt.log("The websocket of ENV_%d opened to %s:%d",_s.env,_s.ip,af[_s.env]),Wt.curOpenSockets[_s.env]=_s,Wt.lastOpenSockets[_s.env].next(_s),Wt.firstEnv=_s.env,Wt.openSecondSocket(_s.env,_s.ip,_s.useNewDomain)}),Ka(1),pe()),Wt.firstSocketOpener=Wt.firstEnvOpenSocket.pipe(cb(function(_s){return _s.open$.pipe(ca(function(){Wt.log("The websocket of first ENV_%d re-opened to %s:%d",_s.env,_s.ip,af[_s.env]),Wt.curOpenSockets[_s.env]=_s,Wt.lastOpenSockets[_s.env].next(_s)}))})),_=Wt.firstOpenKeeperSubject.pipe(Cc(Yc)),Wt.firstOpenKeeperSub=_.subscribe({error:Wt.logError}),Wt}la(i,e);var h=ma(i);return Ha(i,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(_,j){if(![0,1].includes(_))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var _t=_===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var Wt=this.curOpenSockets[_];this.curOpenSockets[_]=void 0,Wt&&(Wt.isActiveClose=!0,setTimeout(function(){Wt.close()},j)),_t!==void 0&&setTimeout(function(){_t==null||_t.unsubscribe()},j)}},{key:"waitClosing",value:function(_){var j=this;return _.isActiveClose=!0,_.open$.pipe(tt(),Ga(function(_t){return _t.message===mr.normalClosureMessage?vb:Z(_t)}),hb(5e3),Ga(function(_t){return _t instanceof pb?(j.warn("Force closing the ENV_%d connection",_.env),vb):Z(_t)}))}},{key:"onSocketConnectionFailure",value:function(_){var j=[0,1].filter(function(_t){return _t!==_.env})[0];(j=this.curOpenSockets[j])&&j.loggedIn?this.reopenSocketWithApRequest(_.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(_,j,_t){var Wt=this,_n=_===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm(function(_i,_s){return[].concat(G(_i),[_s])},[]),ba(function(_i){return kr(_i,function(_s){return Jm(j,_s.ip)}).slice(-1)[0]}),Ka(1),cb(function(_i){if(_i===void 0)return Z(Error("Invalid edge info"));var _s=new ml(_i.ip,_n,_i.ticket,Wt.context,Wt.logger,_t);return _s.on("connectionFailure",function(){return Wt.onSocketConnectionFailure(_s)}),_s.open$.pipe(ca(function(){Wt.lastOpenSockets[_n].next(_s),Wt.curOpenSockets[_n]=_s}))}),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(_){var j=this,_t=[0,1].filter(function(_i){return _i!==_})[0];if((_t=this.curOpenSockets[_t])!==void 0){var Wt,_n=_t.ip;_t=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),oe(function(_i){return _i.pipe(ca(function(_s){if(_s.code===Kh)j.emit("tokenExpired"),j.apClient.apFinish$.next(void 0);else if(sa(_s))throw _s}),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))}),ca(function(_i){j.log("An edge info got %o",_i)}),wg(function(){j.apClient.clearUp()})).pipe(rm(function(_i,_s){return[].concat(G(_i),[_s])},[]),ba(function(_i){return(_i=kr(_i,function(_s){return Jm(_n,_s.ip)})).length-1>=j.ipIterator?_i.slice(-j.ipIterator++-1)[0]:(j.ipIterator=0,_i.slice(-1)[0])}),Dd(),cb(function(_i){if(_i===void 0)return Z(Error("Invalid edge info"));var _s=new ml(_i.ip,_,_i.ticket,j.context,j.logger,Wt);return _s.on("connectionFailure",function(){return j.onSocketConnectionFailure(_s)}),Wt=!_s.useNewDomain,_s.open$.pipe(qf(_s))}),ca(function(_i){j.log("The websocket of ENV_%d re-opened to %s:%d using ap",_i.env,_i.ip,af[_i.env]),j.curOpenSockets[_]=_i,j.lastOpenSockets[_].next(_i)}),cb(function(_i){return _i.open$.pipe(ca(function(){j.log("The websocket of ENV_%d re-opened to %s:%d",_i.env,_i.ip,af[_i.env]),j.curOpenSockets[_]=_i,j.lastOpenSockets[_].next(_i)}))}),pe()),_===this.firstEnv?this.firstOpenKeeperSubject.next(_t):this.secondOpenKeeperSubject.next(_t)}}}]),i}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(i,h){return h||(h=Xc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&h.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&h.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&h.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&h.uint32(32).int64(i.elapse),i.appId!=null&&Object.hasOwnProperty.call(i,"appId")&&h.uint32(42).string(i.appId),i.ver!=null&&Object.hasOwnProperty.call(i,"ver")&&h.uint32(50).string(i.ver),i.buildno!=null&&Object.hasOwnProperty.call(i,"buildno")&&h.uint32(56).int32(i.buildno),i.installId!=null&&Object.hasOwnProperty.call(i,"installId")&&h.uint32(66).string(i.installId),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&h.uint32(128).int32(i.os),i.did!=null&&Object.hasOwnProperty.call(i,"did")&&h.uint32(138).string(i.did),i.index!=null&&Object.hasOwnProperty.call(i,"index")&&zc.Session.CommonIndex.encode(i.index,h.uint32(162).fork()).ldelim(),i.token!=null&&Object.hasOwnProperty.call(i,"token")&&h.uint32(170).string(i.token),i.version!=null&&Object.hasOwnProperty.call(i,"version")&&h.uint32(176).int32(i.version),i.subVersion!=null&&Object.hasOwnProperty.call(i,"subVersion")&&h.uint32(184).int32(i.subVersion),h},e.CommonIndex=function(){function i(h){if(h)for(var _=Object.keys(h),j=0;j<_.length;++j)h[_[j]]!=null&&(this[_[j]]=h[_[j]])}return i.prototype.index1="",i.prototype.index2="",i.prototype.index3="",i.encode=function(h,_){return _||(_=Xc.create()),h.index1!=null&&Object.hasOwnProperty.call(h,"index1")&&_.uint32(10).string(h.index1),h.index2!=null&&Object.hasOwnProperty.call(h,"index2")&&_.uint32(18).string(h.index2),h.index3!=null&&Object.hasOwnProperty.call(h,"index3")&&_.uint32(26).string(h.index3),_},i}(),e}(),SC=zc.Link=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(i,h){return h||(h=Xc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&h.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&h.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&h.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&h.uint32(32).int64(i.elapse),i.ec!=null&&Object.hasOwnProperty.call(i,"ec")&&h.uint32(40).int32(i.ec),i.sc!=null&&Object.hasOwnProperty.call(i,"sc")&&h.uint32(48).int32(i.sc),i.destServerIp!=null&&Object.hasOwnProperty.call(i,"destServerIp")&&h.uint32(58).string(i.destServerIp),i.ackedServerIp!=null&&Object.hasOwnProperty.call(i,"ackedServerIp")&&h.uint32(66).string(i.ackedServerIp),i.responseTime!=null&&Object.hasOwnProperty.call(i,"responseTime")&&h.uint32(72).int32(i.responseTime),h},e}(),TC=zc.Logout=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.encode=function(i,h){return h||(h=Xc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&h.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&h.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&h.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&h.uint32(32).int64(i.elapse),h},e}(),UC=zc.KickedOff=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(i,h){return h||(h=Xc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&h.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&h.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&h.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&h.uint32(32).int64(i.elapse),i.linkId!=null&&Object.hasOwnProperty.call(i,"linkId")&&h.uint32(48).int32(i.linkId),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&h.uint32(56).int32(i.code),i.server!=null&&Object.hasOwnProperty.call(i,"server")&&h.uint32(66).string(i.server),i.serverCode!=null&&Object.hasOwnProperty.call(i,"serverCode")&&h.uint32(72).int32(i.serverCode),h},e}(),VC=zc.ChnJoin=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(i,h){return h||(h=Xc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&h.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&h.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&h.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&h.uint32(32).int64(i.elapse),i.cname!=null&&Object.hasOwnProperty.call(i,"cname")&&h.uint32(50).string(i.cname),i.errCode!=null&&Object.hasOwnProperty.call(i,"errCode")&&h.uint32(56).int32(i.errCode),h},e}(),WC=zc.ChnJoinRes=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(i,h){return h||(h=Xc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&h.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&h.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&h.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&h.uint32(32).int64(i.elapse),i.cname!=null&&Object.hasOwnProperty.call(i,"cname")&&h.uint32(50).string(i.cname),i.errCode!=null&&Object.hasOwnProperty.call(i,"errCode")&&h.uint32(56).int32(i.errCode),i.serverErrCode!=null&&Object.hasOwnProperty.call(i,"serverErrCode")&&h.uint32(64).int32(i.serverErrCode),h},e}(),XC=zc.ChnLeave=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(i,h){return h||(h=Xc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&h.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&h.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&h.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&h.uint32(32).int64(i.elapse),i.cname!=null&&Object.hasOwnProperty.call(i,"cname")&&h.uint32(50).string(i.cname),i.errCode!=null&&Object.hasOwnProperty.call(i,"errCode")&&h.uint32(56).int32(i.errCode),h},e}(),YC=zc.ConnectionStateChange=function(){function e(i){if(i)for(var h=Object.keys(i),_=0;_<h.length;++_)i[h[_]]!=null&&(this[h[_]]=i[h[_]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(i,h){return h||(h=Xc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&h.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&h.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&h.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&h.uint32(32).int64(i.elapse),i.oldState!=null&&Object.hasOwnProperty.call(i,"oldState")&&h.uint32(40).int32(i.oldState),i.newState!=null&&Object.hasOwnProperty.call(i,"newState")&&h.uint32(48).int32(i.newState),i.reason!=null&&Object.hasOwnProperty.call(i,"reason")&&h.uint32(56).int32(i.reason),i.reconnId!=null&&Object.hasOwnProperty.call(i,"reconnId")&&h.uint32(64).int32(i.reconnId),h},e}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(e){function i(_,j,_t){return W(this,i),m(n(_t=h.call(this,_t,"Context")),"_token",void 0),m(n(_t),"config",void 0),m(n(_t),"_uid",void 0),m(n(_t),"_sid",void 0),m(n(_t),"_area","CN"),m(n(_t),"appId",void 0),m(n(_t),"enableCloudProxy",!1),m(n(_t),"cloudProxyServers",[]),_t.appId=_,_t.config=j,_t}la(i,e);var h=ma(i);return Ha(i,[{key:"token",set:function(_){this._token=typeof _=="string"&&_?_:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(_){if(this.log("The user ID is set to %s",oa(_)),!za(_))throw new Ia;this._uid=_}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(_){if(this.log("sid is set to %s",_),typeof _!="string"||!_)throw new Ia;this._sid=_}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(_){this.log("area is set to %s",_),typeof _=="string"&&_?this._area=_:this.warn("set area failed")}}]),i}(tb()),$C=!!Fc&&R(function(){Fc.prototype.finally.call({then:function(){}},function(){})});if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(e){var i=kd(this,mc("Promise")),h=typeof e=="function";return this.then(h?function(_){return mj(i,e()).then(function(){return _})}:e,h?function(_){return mj(i,e()).then(function(){throw _})}:e)}}),typeof Fc=="function"){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var e=J(w.mark(function i(h){return w.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.t0=Uint8Array,_.next=3,crypto.subtle.digest("SHA-256",h);case 3:return _.t1=_.sent,_.abrupt("return",new _.t0(_.t1));case 5:case"end":return _.stop()}},i)}));return function(i){return e.apply(this,arguments)}}(),$r=function(e){return Array.from(e).map(function(i){return i.toString(16).padStart(2,"0")}).join("")},bD=function(e){if(typeof e!="string")throw new TypeError("Expected input to be a string");if(e.length%2!=0)throw new RangeError("Expected string to be an even number of characters");for(var i=new Uint8Array(e.length/2),h=0;h<e.length;h+=2)i[h/2]=parseInt(e.substring(h,h+2),16);return i},as=function(e){return btoa(String.fromCharCode.apply(String,G(e))).replace(/={1,2}$/,"")},bs=function(){var e=J(w.mark(function i(h){var _;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.prev=0,j.next=3,crypto.subtle.digest("SHA-1",h);case 3:_=j.sent,j.next=9;break;case 6:j.prev=6,j.t0=j.catch(0),_=sha1.arrayBuffer(h);case 9:return j.abrupt("return",as(new Uint8Array(_)));case 10:case"end":return j.stop()}},i,null,[[0,6]])}));return function(i){return e.apply(this,arguments)}}(),cs=function(e,i,h,_){_[i]=!0,h.has(e)?h.get(e).add(i):h.set(e,new Set([i]))},cD=function(e){switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(e){function i(_,j,_t,Wt){W(this,i);var _n=h.call(this,_t,"ChunkDownloadManager");if(m(n(_n),"abortController",new AbortController),m(n(_n),"downloadedSize",0),m(n(_n),"successCount",0),m(n(_n),"timer",void 0),m(n(_n),"chunks",[]),m(n(_n),"retUnit",void 0),m(n(_n),"singleThread",!1),m(n(_n),"initialized",!1),m(n(_n),"ee",void 0),m(n(_n),"chunkCount",void 0),m(n(_n),"aborted",!1),m(n(_n),"serverToIndices",new Map),m(n(_n),"backupToIndices",new Map),m(n(_n),"indexToBackupServers",[]),m(n(_n),"busyBackupServers",new Map),m(n(_n),"downloadingChunks",new Set),m(n(_n),"metaInfo",void 0),m(n(_n),"transHandler",void 0),_n.metaInfo=_,_n.transHandler=j,_n.ee=Wt===void 0?new ea:Wt,_t=_.size,_=_.unit,_t===0)throw new Ia("size cannot be 0");return j.cancelSignal!==void 0&&j.cancelSignal.addEventListener("abort",function(){_n.abortController.abort()},{once:!0}),_n.abortController.signal.addEventListener("abort",function(){_n.aborted=!0},{once:!0}),_n.chunkCount=Math.ceil(_t/(32768*_)),_n}la(i,e);var h=ma(i);return Ha(i,[{key:"setInfoByResponse",value:function(_){var j=this,_t=_.serverList,Wt=_.backupList;if(_=_.unit,_t.length<this.chunkCount&&Wt.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var _n=Array(this.chunkCount).fill(!1);if(_t.forEach(function(_i,_s){return _i.forEach(function(_u){return cs(_u,_s,j.serverToIndices,_n)})}),Wt.forEach(function(_i,_s){return _i.forEach(function(_u){return cs(_u,_s,j.backupToIndices,_n)})}),_n.some(function(){return!1}))throw new da("Not enough servers to download",mg);this.indexToBackupServers=Wt.map(function(_i){return new Set(_i)}),this.retUnit=_}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):this.serverToIndices.size===1&&Array.from(this.serverToIndices.keys())[0]===0?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(_){var j=this,_t=this.downloadedSize+_;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=_t,this.timer!==void 0&&_!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&this.successCount!==this.chunkCount&&(this.timer=setTimeout(function(){j.ee.emit("timedOut"),j.abortController.abort()},12e4)),this.initialized&&_===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var _=0,j=0,_t=this.chunks;j<_t.length;j++)_+=_t[j].byteLength;if(_!==this.metaInfo.size)throw new Ia("invalid chunks total size");_=new Uint8Array(_),_t=j=0;for(var Wt=this.chunks;_t<Wt.length;_t++){var _n=Wt[_t];_.set(new Uint8Array(_n),j),j+=_n.byteLength}return j=Array.from(_.subarray(0,4)).map(function(_i){return _i.toString(16)}).join("").toUpperCase(),Zt(_.buffer,cD(j))}},{key:"getDownloadUrl",value:function(_){var j=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(_).split(".").join("-"),".edge.").concat(j,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var _=J(w.mark(function j(_t){var Wt,_n=this,_i=arguments;return w.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:return Wt=1<_i.length&&_i[1]!==void 0&&_i[1],_s.next=3,Promise.all(Array.from(_t.entries()).map(function(_u){return _u=ra(_u,2),_n.postDownloadRequest(_u[0],Array.from(_u[1]),Wt).catch(function(_h){_h.statusCode===404?(_n.ee.emit("notExist"),_n.abortController.abort()):_h.name!=="AbortError"&&(Sa(_h)?_n.singleThread?(_n.abortController.abort(),_n.ee.emit("timedOut")):(_n.warn("%d download timed out after %d, retrying use single thread",_h.index,_n.singleThread?6e4:3e4),_n.abortController.abort(),_n.singleThread=!0,_n.ee.emit("multiTimeOut")):(_n.ee.emit("error",_h),_n.abortController.abort()))})}));case 3:case"end":return _s.stop()}},j)}));return function(j){return _.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var _=J(w.mark(function j(_t,Wt,_n){var _i,_s,_u,_h,_d,nE,aE,uE,hE,oE=this;return w.wrap(function(sE){for(;;)switch(sE.prev=sE.next){case 0:if(hE=function(){return(hE=J(w.mark(function dE(vE){var AE,PE,IE,QE,m_,yE,FE,UE,qE;return w.wrap(function(gE){for(;;)switch(gE.prev=gE.next){case 0:if(gE.prev=0,vE!==void 0||_t!==0){gE.next=5;break}throw new Ia("Invalid serverIp");case 5:AE=vE===void 0?aE.getDownloadUrl(_t):vE;case 6:return aE.downloadingChunks.add(_i),gE.next=9,nE(AE);case 9:return PE=gE.sent,IE=PE.responseData,aE.downloadingChunks.delete(_i),gE.abrupt("return",IE);case 15:if(gE.prev=15,gE.t0=gE.catch(0),aE.downloadingChunks.delete(_i),Wt.unshift(_i),aE.metaInfo.useNewDomain=!1,gE.t0.name!=="AbortError"){gE.next=22;break}throw gE.t0;case 22:if(!Sa(gE.t0)){gE.next=25;break}throw gE.t0.index=_i,gE.t0;case 25:if(QE=_h,_h+=1,!(2>QE)){gE.next=30;break}return gE.t0 instanceof Ia||aE.warn("%o, %d download failed, retrying",gE.t0,_i),gE.abrupt("return",uE());case 30:if(gE.t0.statusCode!==504){gE.next=34;break}throw(m_=new db("download server timed out",{originalError:gE.t0,serverCode:504})).index=_i,m_;case 34:if(!_n||QE!==2||_d[0]===0){gE.next=45;break}return gE.t0 instanceof Ia||aE.warn("%d download failed, using backup: %d, %o",_i,_d[0],gE.t0),gE.next=38,aE.busyBackupServers.get(_d[0]);case 38:return yE=uE(aE.getDownloadUrl(_d[0])),aE.busyBackupServers.set(_d[0],yE),gE.next=42,yE;case 42:return FE=gE.sent,aE.busyBackupServers.delete(_d[0]),gE.abrupt("return",FE);case 45:if(!(_n&&2<QE&&_d[1]!==void 0&&_d[1]!==0)){gE.next=56;break}return aE.warn("%d download failed, using backup 1: %d",_i,_d[1]),gE.next=49,aE.busyBackupServers.get(_d[1]);case 49:return UE=uE(aE.getDownloadUrl(_d[1])),aE.busyBackupServers.set(_d[1],UE),gE.next=53,UE;case 53:return qE=gE.sent,aE.busyBackupServers.delete(_d[1]),gE.abrupt("return",qE);case 56:throw gE.t0.index=_i,gE.t0;case 58:case"end":return gE.stop()}},dE,null,[[0,15]])}))).apply(this,arguments)},uE=function(dE){return hE.apply(this,arguments)},!this.aborted){sE.next=4;break}throw new Ia("download already aborted");case 4:if((_i=Wt.shift())!==void 0){sE.next=8;break}return this.log("%s download finished",_t),sE.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){sE.next=10;break}return sE.abrupt("return");case 10:if(!this.downloadingChunks.has(_i)){sE.next=13;break}return this.log("%s already downloading, return",_i),sE.abrupt("return");case 13:if(this.chunks[_i]===void 0){sE.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",_i),sE.next=18,this.postDownloadRequest(_t,Wt,_n);case 18:return sE.abrupt("return");case 19:return _s=new FormData,_u={hash:hu(this.metaInfo.hashHexStr),unit:this.retUnit===void 0?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:_i},_s.append("parameter",JSON.stringify(_u)),_h=0,_d=Array.from(this.indexToBackupServers[_i]),nE=function(dE){return te(dE,{body:_s,signal:oE.abortController.signal,timeout:oE.singleThread?12e4:3e4},{useBinaryResponse:!0})},aE=this,sE.next=28,uE().then(function(dE){return oE.chunks[_i]!==void 0?oE.log("chunk %d download duplicated",_i):(oE.chunks[_i]=dE,oE.log("chunk %d downloaded",_i),oE.successCount+=1,oE.updateProgress(oE.chunks[_i].byteLength)),oE.successCount===oE.chunkCount&&(oE.log("chunks all download"),oE.ee.emit("finished")),oE.singleThread?(oE.downloadChunks(),Promise.resolve()):oE.postDownloadRequest(_t,Wt,_n)});case 28:case"end":return sE.stop()}},j,this)}));return function(j,_t,Wt){return _.apply(this,arguments)}}()}]),i}(tb()),es=function(e){function i(_,j,_t,Wt){W(this,i);var _n=h.call(this,_t,"ChunkUploadManager");if(m(n(_n),"chunkCount",0),m(n(_n),"chunks",[]),m(n(_n),"uploadedChunks",[]),m(n(_n),"totalFailures",0),m(n(_n),"timer",void 0),m(n(_n),"initState","uninitialized"),m(n(_n),"ee",void 0),m(n(_n),"unit",0),m(n(_n),"uploadedSize",0),m(n(_n),"singleThread",!1),m(n(_n),"abortController",new AbortController),m(n(_n),"servers",[]),m(n(_n),"aborted",!1),m(n(_n),"metaInfo",void 0),m(n(_n),"transHandler",void 0),_n.metaInfo=_,_n.transHandler=j,_n.ee=Wt===void 0?new ea:Wt,_.file.length===0)throw new I("file not found or is empty",wf);return j.cancelSignal!==void 0&&j.cancelSignal.addEventListener("abort",function(){_n.abortController.abort()},{once:!0}),_n.abortController.signal.addEventListener("abort",function(){_n.aborted=!0},{once:!0}),_n}la(i,e);var h=ma(i);return Ha(i,[{key:"initChunks",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u,_h=this;return w.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:if(this.initState!=="initialized"&&this.initState!=="initializing"){_d.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=_t,Wt=this.sliceFile(_t,this.metaInfo.file),this.chunkCount=Wt.length,_n=[],_i=function(nE,aE){var uE=(nE=ra(aE[nE],2))[0],hE=nE[1];nE=bs(hE).then(function(oE){_h.chunks[uE]={payload:hE,sha1:oE,uploadedTo:void 0,index:uE,processed:!1}}),_n.push(nE)},_s=0,_u=Array.from(Wt.entries());_s<_u.length;_s++)_i(_s,_u);return _d.next=11,Promise.all(_n);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return _d.stop()}},j,this)}));return function(j){return _.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var _=this;if(!this.aborted){for(var j=this.chunks.filter(function(_n){return!_n.processed}),_t=function(_n){var _i=j[_n],_s=_.servers.filter(function(_h){return!_h.isUploading}).sort(function(_h,_d){return _h.successCount-_d.successCount}).sort(function(_h,_d){return _h.failureCount-_d.failureCount})[0];if(_s===void 0||1<_s.failureCount)return _.log("Upload server not available, waiting"),_.ee.emit("serverUsedUp"),Om(1e3).then(function(){_.totalFailures>2*_.chunkCount&&_.ee.emit("error"),_.totalFailures+=1,_s!==void 0&&(_s.failureCount=0),_.uploadToServers()}).catch(function(){}),"break";_i.processed=!0,_s.isUploading=!0,_.log("uploading chunk %d to server %s",_i.index,Dg(_s.ip));var _u=_.getUploadUrl(_s.ip);return J(w.mark(function _h(){var _d;return w.wrap(function(nE){for(;;)switch(nE.prev=nE.next){case 0:return nE.prev=0,nE.next=3,_.postChunk(_i.payload,_u,_i.index);case 3:_d=_.chunks.findIndex(function(aE){return aE===_i}),_i.uploadedTo=_s.ip,_.chunks.splice(_d,1),_.uploadedChunks.push(_i),_s.successCount+=1,_s.isUploading=!1,_.updateProgress(_i.payload.byteLength),_.log("upload chunk %d successfully",_i.index),nE.next=31;break;case 13:if(nE.prev=13,nE.t0=nE.catch(0),_s.isUploading=!1,_i.processed=!1,nE.t0.statusCode!==504&&!Sa(nE.t0)){nE.next=27;break}if(_.singleThread){nE.next=24;break}return _.warn("%d upload timed out after %d, retrying use single thread",_i.index,_.singleThread?12e4:3e4),_.abortController.abort(),_.singleThread=!0,_.ee.emit("multiTimeOut"),nE.abrupt("return");case 24:return _.ee.emit("timedOut"),_.abortController.abort(),nE.abrupt("return");case 27:return _.metaInfo.useNewDomain=!1,_s.failureCount+=1,nE.next=31,Om(1e3);case 31:_.uploadedChunks.length===_.chunkCount?(_.log("chunks uploaded"),_.ee.emit("finished")):(_.singleThread||_.chunks.filter(function(aE){return!aE.processed}).length===1)&&_.uploadToServers();case 32:case"end":return nE.stop()}},_h,null,[[0,13]])}))(),_.singleThread?"break":void 0},Wt=0;Wt<j.length&&_t(Wt)!=="break";Wt++);j.length===0&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var _=!0,j=[],_t=G(this.uploadedChunks).sort(function(_i,_s){return _i.index-_s.index}),Wt=0;for(_t=Array.from(_t.values());Wt<_t.length;Wt++){var _n=_t[Wt].uploadedTo;if(_n===void 0){_=!1;break}j.push(_n)}if(!_)throw new Ia("some chunks not uploaded, cannot get upload server ips");return j}},{key:"addServers",value:function(_){var j=this;_.forEach(function(_t){var Wt=j.servers.findIndex(function(_n){return _n.ip===_t});Wt!==-1?j.servers[Wt].failureCount=0:(j.log("server %s added",Dg(_t)),j.servers.push({successCount:0,isUploading:!1,ip:_t,failureCount:0}))})}},{key:"updateProgress",value:function(_){var j=this,_t=_!==void 0?this.uploadedSize+_:this.metaInfo.file.length;_t>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=_t,this.timer!==void 0&&_!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&_!==void 0&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout(function(){j.ee.emit("timedOut"),j.abortController.abort()},12e4)),this.initState==="initialized"&&_===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(_,j){var _t=0,Wt=[],_n=j.length;for(_*=32768;_t<_n;)Wt.push(j.slice(_t,_t+_)),_t+=_;return this.log("chunks split into %d",Wt.length),Wt}},{key:"postChunk",value:function(){var _=J(w.mark(function j(_t,Wt,_n){var _i,_s,_u,_h,_d,nE,aE,uE;return w.wrap(function(hE){for(;;)switch(hE.prev=hE.next){case 0:if(!this.aborted){hE.next=2;break}throw new Ia("upload already aborted");case 2:if(this.unit!==void 0){hE.next=4;break}throw new Ia("unit is undefined");case 4:return _i=this.metaInfo,_s=_i.ticket,_u=_i.instance,_h=_i.loginOpt,_d=_i.hashStr,hE.t0=_n,hE.t1=_d,hE.next=9,bs(_t);case 9:return hE.t2=hE.sent,hE.t3=this.unit,hE.t4=_s,hE.t5=_u,hE.t6=_h,nE={index:hE.t0,hash:hE.t1,sha1:hE.t2,unit:hE.t3,ticket:hE.t4,instance:hE.t5,loginOpt:hE.t6},(aE=new FormData).append("parameter",JSON.stringify(nE)),aE.append("payload",new Blob([_t])),hE.next=20,te(Wt,{headers:{Accept:"application/json"},body:aE,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(uE=hE.sent,uE.status===201){hE.next=24;break}throw new da("uploading chunk ".concat(_n," failed"));case 24:case"end":return hE.stop()}},j,this)}));return function(j,_t,Wt){return _.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(_){var j=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(_).split(".").join("-"),".edge.").concat(j,":9601/api/v1/chuck/upload")}}]),i}(tb()),fs=function(e){function i(_){W(this,i);var j=h.call(this,_,"MediaTaskManager");return m(n(j),"isProcessing",!1),m(n(j),"authInfo",void 0),m(n(j),"taskFinishers",{}),m(n(j),"mediaTasks",new Map),m(n(j),"ongoingTask",void 0),j.on("connectionStateChanged",function(_t){if(_t===S.ConnectionState.ABORTED||_t===S.ConnectionState.DISCONNECTED){j.ongoingTask!==void 0&&j.cancelTask(j.ongoingTask),_t=0;for(var Wt=Array.from(j.mediaTasks.entries());_t<Wt.length;_t++){var _n=ra(Wt[_t],2)[1];j.cancelTask(_n)}j.mediaTasks.clear(),j.taskFinishers={}}else _t===S.ConnectionState.RECONNECTING?j.ongoingTask!==void 0&&j.ongoingTask.manager.abortController.abort():_t===S.ConnectionState.CONNECTED&&j.ongoingTask!==void 0&&j.ongoingTask.manager.ee.emit("reconnected")}),j}la(i,e);var h=ma(i);return Ha(i,[{key:"setAuthInfo",value:function(_){this.authInfo=_}},{key:"waitMediaTask",value:function(_){var j=this;return new Promise(function(_t,Wt){j.taskFinishers[_]={resolve:_t,reject:Wt},j.isProcessing||j.processMediaTask()}).finally(function(){j.ongoingTask!==void 0&&j.ongoingTask.manager.timer!==void 0&&clearTimeout(j.ongoingTask.manager.timer),delete j.taskFinishers[_],j.mediaTasks.size!==0?j.processMediaTask():j.isProcessing=!1})}},{key:"addUploadTask",value:function(_,j,_t,Wt){var _n=_.file;if(_=_.hash,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=i.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return Wt=new es({hashStr:as(_),file:_n,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},Wt,this.logger),_n=Ud(),this.mediaTasks.set(_n,{type:"UPLOAD",manager:Wt,hash:_,setter:_t,fetcher:j,taskId:_n}),_n}},{key:"addDownloadTask",value:function(_,j,_t){var Wt=_.hashHexStr,_n=_.size,_i=_.unit;if(_=_.zone,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=i.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return _t=new ds({hashHexStr:Wt,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:_n,zone:_,unit:_i},_t,this.logger),Wt=Ud(),this.mediaTasks.set(Wt,{type:"DOWNLOAD",manager:_t,fetcher:j,taskId:Wt}),Wt}},{key:"doDownloadTaskImpl",value:function(){var _=J(w.mark(function j(_t,Wt){var _n,_i,_s,_u,_h,_d,nE,aE,uE=this,hE=arguments;return w.wrap(function(oE){for(;;)switch(oE.prev=oE.next){case 0:return _n=2<hE.length&&hE[2]!==void 0&&hE[2],_s=_i=_t.manager,_n&&(_i=new ds(_s.metaInfo,_s.transHandler,this.logger,_s.ee)),_u=_t.fetcher,oE.next=7,_u();case 7:if(_h=oE.sent,_d=_h.serverList,nE=_h.backupList,aE=_h.unit,!_n||aE===_s.retUnit){oE.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:_n&&(_t.manager=_i,_i.downloadedSize=_s.downloadedSize,_i.successCount=_s.successCount,_i.timer=_s.timer,_i.chunks=_s.chunks,_i.initialized=_s.initialized,_i.singleThread=_s.singleThread,_i.updateProgress(0)),_i.ee.once("reconnected",function(){_i.ee.removeAllListeners(),uE.doDownloadTaskImpl(_t,Wt,!0).catch(function(sE){Wt.reject(sE)})}),_i.ee.once("multiTimeOut",function(){_i.ee.removeAllListeners(),uE.doDownloadTaskImpl(_t,Wt,!0).catch(function(sE){Wt.reject(sE)})}),_i.ee.once("error",function(sE){_i.ee.removeAllListeners(),Wt.reject(new da(["download file file, index %d",sE.index],{code:mg,originalError:sE}))}),_i.ee.once("notExist",function(){_i.abortController.abort(),_i.ee.removeAllListeners(),Wt.reject(new da("download file not found",AA))}),_i.ee.once("timedOut",function(){_i.ee.removeAllListeners(),_i.abortController.abort(),Wt.reject(new db("download timed out",zA))}),_i.transHandler.cancelSignal!==void 0&&_i.transHandler.cancelSignal.addEventListener("abort",function(){Wt.reject(new hl("Downloading canceled",ir))},{once:!0}),_i.ee.once("finished",function(){Wt.resolve({type:"DOWNLOAD",payload:_i.getPayload()})}),_i.setInfoByResponse({serverList:_d,backupList:nE,unit:aE}),_i.downloadChunks();case 23:case"end":return oE.stop()}},j,this)}));return function(j,_t){return _.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(_,j){var _t=this,Wt=2<arguments.length&&arguments[2]!==void 0&&arguments[2],_n=_.taskId;return Wt||(this.mediaTasks.delete(_n),this.ongoingTask=_),new Promise(function(_i,_s){_t.doDownloadTaskImpl(_,j,Wt).then(_i).catch(_s)})}},{key:"doUploadTaskImpl",value:function(){var _=J(w.mark(function j(_t,Wt){var _n,_i,_s,_u,_h,_d,nE,aE,uE,hE=this,oE=arguments;return w.wrap(function(sE){for(;;)switch(sE.prev=sE.next){case 0:return _n=2<oE.length&&oE[2]!==void 0&&oE[2],_s=_i=_t.manager,_n&&(_i=new es(_s.metaInfo,_s.transHandler,this.logger,_s.ee)),_u=_t.fetcher,_h=new Pa,nE=new Promise(function(dE,vE){var AE=_u(),PE=AE.ret,IE=AE.err,QE=AE.timeout;AE.fin.pipe(ob(_h)).subscribe({next:function(m_){Wt.resolve({type:"UPLOAD",retUnit:m_.unit,zone:m_.zone})},complete:function(){dE({hasExist:!0}),_h.next(),_h.complete()}}),PE.pipe(ob(_h),cb(function(){var m_=J(w.mark(function yE(FE){var UE,qE;return w.wrap(function(gE){for(;;)switch(gE.prev=gE.next){case 0:if(UE=FE.servers,qE=FE.unit,_n&&_s.unit!==qE?Wt.reject(new da("upload unit is different, reject to continue",lg)):_n&&(_t.manager=_i,_i.chunkCount=_s.chunkCount,_i.chunks=_s.chunks,_i.totalFailures=_s.totalFailures,_i.uploadedChunks=_s.uploadedChunks,_i.timer=_s.timer,_i.initState=_s.initState,_i.unit=_s.unit,_i.uploadedSize=_s.uploadedSize,_i.singleThread=_s.singleThread,_i.updateProgress(0)),_i.addServers(UE),_i.initState!=="uninitialized"){gE.next=7;break}return _d=_i.initChunks(qE),gE.next=7,_d;case 7:case"end":return gE.stop()}},yE)}));return function(yE){return m_.apply(this,arguments)}}())).subscribe({complete:function(){return dE({hasExist:!1})},error:vE}),AE=function(m_){_i.initState!=="uninitialized"&&_d?dE(_d.then(function(){return{hasExist:!1}})):vE(m_)},IE.pipe(ob(_h)).subscribe({error:AE}),QE.pipe(ob(_h)).subscribe({error:AE})}),sE.next=9,nE;case 9:if(aE=sE.sent,!aE.hasExist){sE.next=15;break}return _i.updateProgress(),this.log("file already exists, skipping upload"),sE.abrupt("return");case 15:_h.next(),_h.complete(),this.log("chunks initialization promise resolved"),uE=gb(_i.ee,"serverUsedUp").pipe(Gt(function(){return _i.chunkCount!==_i.uploadedChunks.length}),Jt(5e3,void 0,{leading:!1}),pm(function(){return _u().ret})).subscribe(function(dE){_i.addServers(dE.servers)}),_i.ee.once("reconnected",function(){_i.ee.removeAllListeners(),hE.doUploadTask(_t,Wt,!0).catch(function(dE){Wt.reject(dE)})}),_i.ee.once("multiTimeOut",function(){_i.ee.removeAllListeners(),hE.doUploadTask(_t,Wt,!0).catch(function(dE){Wt.reject(dE)})}),_i.ee.once("timedOut",function(){uE.unsubscribe(),_i.ee.removeAllListeners(),_i.abortController.abort(),Wt.reject(new db("upload timed out",Lh))}),_i.ee.once("error",function(dE){uE.unsubscribe(),_i.ee.removeAllListeners(),_i.abortController.abort(),Wt.reject(dE||new da("upload error",lg))}),_i.transHandler.cancelSignal!==void 0&&_i.transHandler.cancelSignal.addEventListener("abort",function(){Wt.reject(new hl("Uploading canceled",hr))},{once:!0}),_i.ee.once("finished",J(w.mark(function dE(){var vE,AE,PE;return w.wrap(function(IE){for(;;)switch(IE.prev=IE.next){case 0:return uE.unsubscribe(),IE.next=3,_t.setter(_i.unit,_i.getUploadServerIPs());case 3:vE=IE.sent,AE=vE.zone,PE=vE.unit,_i.ee.removeAllListeners(),Wt.resolve({type:"UPLOAD",retUnit:PE,zone:AE});case 8:case"end":return IE.stop()}},dE)}))),_i.uploadToServers();case 26:case"end":return sE.stop()}},j,this)}));return function(j,_t){return _.apply(this,arguments)}}()},{key:"doUploadTask",value:function(_,j){var _t=this,Wt=2<arguments.length&&arguments[2]!==void 0&&arguments[2],_n=_.taskId;return Wt||(this.mediaTasks.delete(_n),this.ongoingTask=_),new Promise(function(_i,_s){_t.doUploadTaskImpl(_,j,Wt).then(_i).catch(_s)})}},{key:"processMediaTask",value:function(){var _=J(w.mark(function j(){var _t,Wt,_n;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(this.mediaTasks.size!==0){_i.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,_t=this.mediaTasks.keys().next().value,(Wt=this.taskFinishers[_t])!==void 0){_i.next=7;break}throw Error("top task not found");case 7:if((_n=this.mediaTasks.get(_t))!==void 0){_i.next=10;break}throw new Ia("task invalid");case 10:if(_n.type!=="UPLOAD"){_i.next=15;break}return _i.next=13,this.doUploadTask(_n,Wt).catch(function(_s){_n.manager.ee.removeAllListeners(),Wt.reject(_s)});case 13:_i.next=18;break;case 15:if(_n.type!=="DOWNLOAD"){_i.next=18;break}return _i.next=18,this.doDownloadTask(_n,Wt).catch(function(_s){_n.manager.ee.removeAllListeners(),Wt.reject(_s)});case 18:case"end":return _i.stop()}},j,this)}));return function(){return _.apply(this,arguments)}}()},{key:"cancelTask",value:function(_){var j=_.type==="DOWNLOAD"?ir:hr;_.manager.ee.removeAllListeners(),_.manager.abortController.abort(),this.taskFinishers[_.taskId]!==void 0&&this.taskFinishers[_.taskId].reject(new hl("User logged out or kicked off, media task canceled",j))}}]),i}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",function(){for(var e=0,i=arguments.length,h=new(Ne(this))(i);i>e;)h[e]=arguments[e++];return h},Dj);var gs=1/0,dD=Math.max,ju=function(e,i,h){var _=Object(e);if(!Ed(e)){var j=Te(i);e=Ad(e),i=function(_t){return j(_[_t],_t,_)}}return-1<(i=function(_t,Wt,_n){var _i=_t==null?0:_t.length;if(!_i)return-1;if(_n==null)_n=0;else{var _s=(_n=_n?(_n=gl(_n))===gs||_n===-gs?17976931348623157e292*(0>_n?-1:1):_n==_n?_n:0:_n===0?_n:0)%1;_n=_n==_n?_s?_n-_s:_n:0}return 0>_n&&(_n=dD(_i+_n,0)),Xp(_t,Te(Wt),_n)}(e,i,h))?_[j?e[i]:i]:void 0},iu=function(e,i){return e&&e.length?vk(e,void 0,typeof i=="function"?i:void 0):[]},hs=function(){function e(){W(this,e),m(this,"size",0),m(this,"fields",new Map)}return Ha(e,[{key:"define",value:function(i,h,_){if(this.size+=_,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(h={val:0,isNumber:h==="number",isBoolean:h==="boolean",oneof:h==="number"||h==="boolean"?void 0:h,len:_}),this.fields.set(i,h)}},{key:"set",value:function(i,h){if(!(i=this.fields.get(i)))throw Error("field not found");var _=i.oneof;if(!U.isLong(h)&&typeof h!="number")if(typeof h=="boolean")h=h?1:0;else{if(_===void 0)throw Error("invalid field type");if((h=_[h])===void 0)throw Error("field type not found")}Mg(i,h),i.val=h}},{key:"toNumber",value:function(){for(var i=0,h=0,_=0,j=Array.from(this.fields);_<j.length;_++){var _t=ra(j[_],2)[1],Wt=_t.len;(_t=_t.val)!==void 0&&(i+=U.fromValue(_t).shiftLeft(h).toNumber(),h+=Wt)}return i}},{key:"toLong",value:function(){for(var i=U.fromNumber(0,!0),h=0,_=0,j=Array.from(this.fields);_<j.length;_++){var _t=ra(j[_],2)[1],Wt=_t.len;(_t=_t.val)!==void 0&&(i=U.fromValue(_t).shiftLeft(h).add(i),h+=Wt)}return i}},{key:"assert",value:function(i,h){function _(Wt){if(!U.isLong(Wt)&&typeof Wt!="number")if(typeof Wt=="boolean")Wt=Wt?1:0;else{if(_t===void 0)throw Error("invalid field type");if((Wt=_t[Wt])===void 0)throw Error("field type not found")}return Mg(j,Wt),Lg(Wt,j.val)}var j=this.fields.get(i);if(!j)throw Error("field not found");var _t=j.oneof;if(!Array.isArray(h))return _(h);if(h.length===1)return _(h[0]);if(h.every(function(Wt){return typeof Wt=="string"})&&_t!==void 0)return h.some(function(Wt){return _(Wt)});throw Error("invalid valueTypes")}},{key:"from",value:function(i){i=U.fromValue(i);for(var h=0,_=0,j=Array.from(this.fields);_<j.length;_++){var _t=ra(j[_],2)[1],Wt=_t.len,_n=U.fromNumber(Math.pow(2,Wt)-1,!0).shiftLeft(h);Mg(_t,_n=i.and(_n).shiftRightUnsigned(h)),_t.val=_n,h+=Wt}}},{key:"typeOf",value:function(i){if((i=this.fields.get(i))!==void 0){var h=i.oneof;if(i=i.val,h!==void 0){var _=0;for(h=Object.entries(h);_<h.length;_++){var j=ra(h[_],2),_t=j[0];if(Lg(i,j[1]))return _t}}}throw new TypeError("can only get type of oneof type")}}]),e}(),is=function(e){function i(_){W(this,i);var j=h.call(this);return j.define("Rejoin","boolean",1),j.define("Unused","number",31),j.define("Platform","number",8),j.define("Version","number",12),j.define("Subversion","number",12),j.set("Platform",7),j.set("Version",4),j.set("Subversion",203),j.set("Rejoin",_),j}la(i,e);var h=ma(i);return i}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(e){function i(_){W(this,i);var j=h.call(this);if(j.define("MessageType",fD,8),j.define("BroadcastJumps","number",2),j.define("ToCache","boolean",1),j.define("FromCache","boolean",1),j.define("CompressionMethod",gD,2),j.define("IterationNumber","number",4),j.define("BufferedMessage","boolean",1),j.define("ToArchive","boolean",1),j.define("FromArchive","boolean",1),typeof _=="number"||U.isLong(_))j.from(_);else if(_!==void 0){var _t=0;for(_=Hg(_);_t<_.length;_t++){var Wt=ra(_[_t],2);j.set(Wt[0],Wt[1])}}return j}la(i,e);var h=ma(i);return Ha(i,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(_){var j=this;return _!==void 0?this.assert("MessageType",_):xf(js).some(function(_t){return j.assert("MessageType",_t)})}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),i}(hs),hD=function(e){function i(_){return W(this,i),m(n(_=h.call(this,_,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),_}la(i,e);var h=ma(i);return Ha(i,[{key:"getChatInfo",value:function(_){var j=this.dialogueLru.get(_);if(this.dialogueLru.prune(),j){var _t=j.dialogue,Wt={dialogue:_t,sequence:j=j.sequence.add(1)};return this.dialogueLru.set(_,{dialogue:_t,sequence:j}),Wt}return _t={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(_,_t),_t}}]),i}(tb()),v={};X(module)=="object"&&(module.exports=v),v.parse=function(e,i){var h,_=v.bin.readUshort,j=v.bin.readUint,_t={};for(h=(e=new Uint8Array(e)).length-4;j(e,h)!=101010256;)h--;var Wt=_(e,h=h+4+4);_(e,h+=2),j(e,h+=2),h=j(e,h+=4);for(var _n=0;_n<Wt;_n++){j(e,h),h+=4,h+=4,h+=4,j(e,h+=4);var _i=j(e,h+=4),_s=j(e,h+=4),_u=_(e,h+=4),_h=_(e,h+2),_d=_(e,h+4);h+=6;var nE=j(e,h+=8);h+=4,h+=_u+_h+_d,v._readLocal(e,nE,_t,_i,_s,i)}return _t},v._readLocal=function(e,i,h,_,j,_t){var Wt=v.bin.readUshort,_n=v.bin.readUint;_n(e,i),Wt(e,i+=4),Wt(e,i+=2);var _i=Wt(e,i+=2);_n(e,i+=2),_n(e,i+=4),_n=Wt(e,i=i+4+8);var _s=Wt(e,i+=2);if(i+=2,Wt=v.bin.readUTF8(e,i,_n),i=i+_n+_s,_t)h[Wt]={size:j,csize:_};else if(e=new Uint8Array(e.buffer,i),_i==0)h[Wt]=new Uint8Array(e.buffer.slice(i,i+_));else{if(_i!=8)throw"unknown compression method: "+_i;i=new Uint8Array(j),v.inflateRaw(e,i),h[Wt]=i}},v.inflateRaw=function(e,i){return v.F.inflate(e,i)},v.inflate=function(e,i){return e[0],e[1],v.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),i)},v.deflate=function(e,i){i==null&&(i={level:6});var h=0,_=new Uint8Array(50+Math.floor(1.1*e.length));return _[h]=120,_[h+1]=156,h=v.F.deflateRaw(e,_,h+2,i.level),e=v.adler(e,0,e.length),_[h+0]=e>>>24&255,_[h+1]=e>>>16&255,_[h+2]=e>>>8&255,_[h+3]=e>>>0&255,new Uint8Array(_.buffer,0,h+4)},v.deflateRaw=function(e,i){i==null&&(i={level:6});var h=new Uint8Array(50+Math.floor(1.1*e.length)),_=v.F.deflateRaw(e,h,_,i.level);return new Uint8Array(h.buffer,0,_)},v.encode=function(e,i){i==null&&(i=!1);var h,_=0,j=v.bin.writeUint,_t=v.bin.writeUshort,Wt={};for(h in e){var _n=!v._noNeed(h)&&!i,_i=e[h],_s=v.crc.crc(_i,0,_i.length);Wt[h]={cpr:_n,usize:_i.length,crc:_s,file:_n?v.deflateRaw(_i):_i}}for(h in Wt)_+=Wt[h].file.length+30+46+2*v.bin.sizeUTF8(h);for(h in e=new Uint8Array(_+22),i=0,_i=[],Wt)_s=Wt[h],_i.push(i),i=v._writeHeader(e,i,h,_s,0);for(h in _=0,_n=i,Wt)_s=Wt[h],_i.push(i),i=v._writeHeader(e,i,h,_s,1,_i[_++]);return Wt=i-_n,j(e,i,101010256),_t(e,i=i+4+4,_),_t(e,i+=2,_),j(e,i+=2,Wt),j(e,i+4,_n),e.buffer},v._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(e)!=-1},v._writeHeader=function(e,i,h,_,j,_t){var Wt=v.bin.writeUint,_n=v.bin.writeUshort,_i=_.file;return Wt(e,i,j==0?67324752:33639248),i+=4,j==1&&(i+=2),_n(e,i,20),_n(e,i+=2,0),_n(e,i+=2,_.cpr?8:0),Wt(e,i+=2,0),Wt(e,i+=4,_.crc),Wt(e,i+=4,_i.length),Wt(e,i+=4,_.usize),_n(e,i+=4,v.bin.sizeUTF8(h)),_n(e,i+=2,0),i+=2,j==1&&(Wt(e,i=i+2+2+6,_t),i+=4),i+=h=v.bin.writeUTF8(e,i,h),j==0&&(e.set(_i,i),i+=_i.length),i},v.crc={table:function(){for(var e=new Uint32Array(256),i=0;256>i;i++){for(var h=i,_=0;8>_;_++)h=1&h?3988292384^h>>>1:h>>>1;e[i]=h}return e}(),update:function(e,i,h,_){for(var j=0;j<_;j++)e=v.crc.table[255&(e^i[h+j])]^e>>>8;return e},crc:function(e,i,h){return 4294967295^v.crc.update(4294967295,e,i,h)}},v.adler=function(e,i,h){var _=1,j=0,_t=i;for(i+=h;_t<i;){for(h=Math.min(_t+5552,i);_t<h;)j+=_+=e[_t++];_%=65521,j%=65521}return j<<16|_},v.bin={readUshort:function(e,i){return e[i]|e[i+1]<<8},writeUshort:function(e,i,h){e[i]=255&h,e[i+1]=h>>8&255},readUint:function(e,i){return 16777216*e[i+3]+(e[i+2]<<16|e[i+1]<<8|e[i])},writeUint:function(e,i,h){e[i]=255&h,e[i+1]=h>>8&255,e[i+2]=h>>16&255,e[i+3]=h>>24&255},readASCII:function(e,i,h){for(var _="",j=0;j<h;j++)_+=String.fromCharCode(e[i+j]);return _},writeASCII:function(e,i,h){for(var _=0;_<h.length;_++)e[i+_]=h.charCodeAt(_)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,i,h){for(var _,j="",_t=0;_t<h;_t++)j+="%"+v.bin.pad(e[i+_t].toString(16));try{_=decodeURIComponent(j)}catch{return v.bin.readASCII(e,i,h)}return _},writeUTF8:function(e,i,h){for(var _=h.length,j=0,_t=0;_t<_;_t++){var Wt=h.charCodeAt(_t);if(!(4294967168&Wt))e[i+j]=Wt,j++;else if(!(4294965248&Wt))e[i+j]=192|Wt>>6,e[i+j+1]=128|Wt>>0&63,j+=2;else if(!(4294901760&Wt))e[i+j]=224|Wt>>12,e[i+j+1]=128|Wt>>6&63,e[i+j+2]=128|Wt>>0&63,j+=3;else{if(4292870144&Wt)throw"e";e[i+j]=240|Wt>>18,e[i+j+1]=128|Wt>>12&63,e[i+j+2]=128|Wt>>6&63,e[i+j+3]=128|Wt>>0&63,j+=4}}return j},sizeUTF8:function(e){for(var i=e.length,h=0,_=0;_<i;_++){var j=e.charCodeAt(_);if(!(4294967168&j))h++;else if(!(4294965248&j))h+=2;else if(!(4294901760&j))h+=3;else{if(4292870144&j)throw"e";h+=4}}return h}},v.F={},v.F.deflateRaw=function(e,i,h,_){var j=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][_],_t=v.F.U,Wt=v.F._goodIndex;v.F._hash;var _n=v.F._putsE,_i=0;h<<=3;var _s=0,_u=e.length;if(_==0){for(;_i<_u;){var _h=Math.min(65535,_u-_i);_n(i,h,_i+_h==_u?1:0),h=v.F._copyExact(e,_i,_h,i,h+8),_i+=_h}return h>>>3}_n=_t.lits,_=_t.strt;var _d=_t.prev,nE=0,aE=0,uE=0,hE=0,oE=0;for(2<_u&&(_[oE=v.F._hash(e,0)]=0),_i=0;_i<_u;_i++){if(_h=oE,_i+1<_u-2){oE=v.F._hash(e,_i+1);var sE=_i+1&32767;_d[sE]=_[oE],_[oE]=sE}if(_s<=_i){if((14e3<nE||26697<aE)&&100<_u-_i&&(_s<_i&&(_n[nE]=_i-_s,nE+=2,_s=_i),h=v.F._writeBlock(_i==_u-1||_s==_u?1:0,_n,nE,hE,e,uE,_i-uE,i,h),nE=aE=hE=0,uE=_i),sE=0,_i<_u-2&&(sE=v.F._bestMatch(e,_i,_d,_h,Math.min(j[2],_u-_i),j[3])),sE!=0){_h=sE>>>16,sE&=65535;var dE=Wt(_h,_t.of0);_t.lhst[257+dE]++;var vE=Wt(sE,_t.df0);_t.dhst[vE]++,hE+=_t.exb[dE]+_t.dxb[vE],_n[nE]=_h<<23|_i-_s,_n[nE+1]=sE<<16|dE<<8|vE,nE+=2,_s=_i+_h}else _t.lhst[e[_i]]++;aE++}}for(uE==_i&&e.length!=0||(_s<_i&&(_n[nE]=_i-_s,nE+=2),h=v.F._writeBlock(1,_n,nE,hE,e,uE,_i-uE,i,h));7&h;)h++;return h>>>3},v.F._bestMatch=function(e,i,h,_,j,_t){var Wt=32767&i,_n=h[Wt],_i=Wt-_n+32768&32767;if(_n==Wt||_!=v.F._hash(e,i-_i))return 0;for(var _s=_=0,_u=Math.min(32767,i);_i<=_u&&--_t!=0&&_n!=Wt;){if((_==0||e[i+_]==e[i+_-_i])&&(Wt=v.F._howLong(e,i,_i))>_){if(_s=_i,(_=Wt)>=j)break;_i+2<Wt&&(Wt=_i+2);for(var _h=0,_d=0;_d<Wt-2;_d++){var nE=i-_i+_d+32768&32767,aE=nE-h[nE]+32768&32767;aE>_h&&(_h=aE,_n=nE)}}_i+=(Wt=_n)-(_n=h[Wt])+32768&32767}return _<<16|_s},v.F._howLong=function(e,i,h){if(e[i]!=e[i-h]||e[i+1]!=e[i+1-h]||e[i+2]!=e[i+2-h])return 0;var _=i,j=Math.min(e.length,i+258);for(i+=3;i<j&&e[i]==e[i-h];)i++;return i-_},v.F._hash=function(e,i){return(e[i]<<8|e[i+1])+(e[i+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(e,i,h,_,j,_t,Wt,_n,_i){var _s=v.F.U,_u=v.F._putsF,_h=v.F._putsE;_s.lhst[256]++;var _d=v.F.getTrees(),nE=_d[0],aE=_d[1],uE=_d[2],hE=_d[3],oE=_d[4],sE=_d[5],dE=_d[6];_d=_d[7];var vE=32+(_i+3&7?8-(_i+3&7):0)+(Wt<<3),AE=_+v.F.contSize(_s.fltree,_s.lhst)+v.F.contSize(_s.fdtree,_s.dhst);_=_+v.F.contSize(_s.ltree,_s.lhst)+v.F.contSize(_s.dtree,_s.dhst),_+=14+3*sE+v.F.contSize(_s.itree,_s.ihst)+(2*_s.ihst[16]+3*_s.ihst[17]+7*_s.ihst[18]);for(var PE=0;286>PE;PE++)_s.lhst[PE]=0;for(PE=0;30>PE;PE++)_s.dhst[PE]=0;for(PE=0;19>PE;PE++)_s.ihst[PE]=0;if(vE=vE<AE&&vE<_?0:AE<_?1:2,_u(_n,_i,e),_u(_n,_i+1,vE),_i+=3,vE==0){for(;7&_i;)_i++;_i=v.F._copyExact(j,_t,Wt,_n,_i)}else{if(vE==1)var IE=_s.fltree,QE=_s.fdtree;if(vE==2){for(v.F.makeCodes(_s.ltree,nE),v.F.revCodes(_s.ltree,nE),v.F.makeCodes(_s.dtree,aE),v.F.revCodes(_s.dtree,aE),v.F.makeCodes(_s.itree,uE),v.F.revCodes(_s.itree,uE),IE=_s.ltree,QE=_s.dtree,_h(_n,_i,hE-257),_h(_n,_i+=5,oE-1),_h(_n,_i+=5,sE-4),_i+=4,e=0;e<sE;e++)_h(_n,_i+3*e,_s.itree[1+(_s.ordr[e]<<1)]);_i=v.F._codeTiny(dE,_s.itree,_n,_i+3*sE),_i=v.F._codeTiny(_d,_s.itree,_n,_i)}for(sE=0;sE<h;sE+=2){for(dE=(e=i[sE])>>>23,e=_t+(8388607&e);_t<e;)_i=v.F._writeLit(j[_t++],IE,_n,_i);dE!=0&&(e=(nE=i[sE+1])>>16,Wt=nE>>8&255,nE&=255,_h(_n,_i=v.F._writeLit(257+Wt,IE,_n,_i),dE-_s.of0[Wt]),_i+=_s.exb[Wt],_u(_n,_i=v.F._writeLit(nE,QE,_n,_i),e-_s.df0[nE]),_i+=_s.dxb[nE],_t+=dE)}_i=v.F._writeLit(256,IE,_n,_i)}return _i},v.F._copyExact=function(e,i,h,_,j){var _t=j>>>3;return _[_t]=h,_[_t+1]=h>>>8,_[_t+2]=255-_[_t],_[_t+3]=255-_[_t+1],_t+=4,_.set(new Uint8Array(e.buffer,i,h),_t),j+(h+4<<3)},v.F.getTrees=function(){for(var e=v.F.U,i=v.F._hufTree(e.lhst,e.ltree,15),h=v.F._hufTree(e.dhst,e.dtree,15),_=[],j=v.F._lenCodes(e.ltree,_),_t=[],Wt=v.F._lenCodes(e.dtree,_t),_n=0;_n<_.length;_n+=2)e.ihst[_[_n]]++;for(_n=0;_n<_t.length;_n+=2)e.ihst[_t[_n]]++;_n=v.F._hufTree(e.ihst,e.itree,7);for(var _i=19;4<_i&&e.itree[1+(e.ordr[_i-1]<<1)]==0;)_i--;return[i,h,_n,j,Wt,_i,_,_t]},v.F.getSecond=function(e){for(var i=[],h=0;h<e.length;h+=2)i.push(e[h+1]);return i},v.F.nonZero=function(e){for(var i="",h=0;h<e.length;h+=2)e[h+1]!=0&&(i+=(h>>1)+",");return i},v.F.contSize=function(e,i){for(var h=0,_=0;_<i.length;_++)h+=i[_]*e[1+(_<<1)];return h},v.F._codeTiny=function(e,i,h,_){for(var j=0;j<e.length;j+=2){var _t=e[j],Wt=e[j+1];_=v.F._writeLit(_t,i,h,_);var _n=_t==16?2:_t==17?3:7;15<_t&&(v.F._putsE(h,_,Wt,_n),_+=_n)}return _},v.F._lenCodes=function(e,i){for(var h=e.length;h!=2&&e[h-1]==0;)h-=2;for(var _=0;_<h;_+=2){var j=e[_+1],_t=_+3<h?e[_+3]:-1,Wt=_+5<h?e[_+5]:-1,_n=_==0?-1:e[_-1];if(j==0&&_t==j&&Wt==j){for(_t=_+5;_t+2<h&&e[_t+2]==j;)_t+=2;11>(j=Math.min(_t+1-_>>>1,138))?i.push(17,j-3):i.push(18,j-11),_+=2*j-2}else if(j==_n&&_t==j&&Wt==j){for(_t=_+5;_t+2<h&&e[_t+2]==j;)_t+=2;j=Math.min(_t+1-_>>>1,6),i.push(16,j-3),_+=2*j-2}else i.push(j,0)}return h>>>1},v.F._hufTree=function(e,i,h){var _=[],j=e.length,_t=i.length,Wt=0;for(Wt=0;Wt<_t;Wt+=2)i[Wt]=0,i[Wt+1]=0;for(Wt=0;Wt<j;Wt++)e[Wt]!=0&&_.push({lit:Wt,f:e[Wt]});if(e=_.length,j=_.slice(0),e==0)return 0;if(e==1)return i[1+((h=_[0].lit)<<1)]=1,i[1+((h==0?1:0)<<1)]=1;_.sort(function(_u,_h){return _u.f-_h.f}),Wt=_[0],_t=_[1];var _n=0,_i=1,_s=2;for(_[0]={lit:-1,f:Wt.f+_t.f,l:Wt,r:_t,d:0};_i!=e-1;)Wt=_n!=_i&&(_s==e||_[_n].f<_[_s].f)?_[_n++]:_[_s++],_t=_n!=_i&&(_s==e||_[_n].f<_[_s].f)?_[_n++]:_[_s++],_[_i++]={lit:-1,f:Wt.f+_t.f,l:Wt,r:_t};for((_=v.F.setDepth(_[_i-1],0))>h&&(v.F.restrictDepth(j,h,_),_=h),Wt=0;Wt<e;Wt++)i[1+(j[Wt].lit<<1)]=j[Wt].d;return _},v.F.setDepth=function(e,i){return e.lit!=-1?e.d=i:Math.max(v.F.setDepth(e.l,i+1),v.F.setDepth(e.r,i+1))},v.F.restrictDepth=function(e,i,h){var _=0,j=1<<h-i,_t=0;for(e.sort(function(_n,_i){return _i.d==_n.d?_n.f-_i.f:_i.d-_n.d}),_=0;_<e.length&&e[_].d>i;_++){var Wt=e[_].d;e[_].d=i,_t+=j-(1<<h-Wt)}for(_t>>>=h-i;0<_t;)(Wt=e[_].d)<i?(e[_].d++,_t-=1<<i-Wt-1):_++;for(;0<=_;_--)e[_].d==i&&0>_t&&(e[_].d--,_t++);_t!=0&&console.log("debt left")},v.F._goodIndex=function(e,i){var h=0;return i[16|h]<=e&&(h|=16),i[8|h]<=e&&(h|=8),i[4|h]<=e&&(h|=4),i[2|h]<=e&&(h|=2),i[1|h]<=e&&(h|=1),h},v.F._writeLit=function(e,i,h,_){return v.F._putsF(h,_,i[e<<1]),_+i[1+(e<<1)]},v.F.inflate=function(e,i){var h=Uint8Array;if(e[0]==3&&e[1]==0)return i||new h(0);var _=v.F,j=_._bitsF,_t=_._bitsE,Wt=_._decodeTiny,_n=_.makeCodes,_i=_.codes2map,_s=_._get17,_u=_.U,_h=i==null;_h&&(i=new h(e.length>>>2<<3));for(var _d,nE,aE,uE,hE=0,oE=0,sE=nE=0,dE=0;hE==0;)if(hE=j(e,dE,1),_d=j(e,dE+1,2),dE+=3,_d==0)7&dE&&(dE+=8-(7&dE)),_d=e[(dE=4+(dE>>>3))-4]|e[dE-3]<<8,_h&&(i=v.F._check(i,sE+_d)),i.set(new h(e.buffer,e.byteOffset+dE,_d),sE),dE=dE+_d<<3,sE+=_d;else{if(_h&&(i=v.F._check(i,sE+131072)),_d==1&&(aE=_u.flmap,uE=_u.fdmap,oE=511,nE=31),_d==2){for(nE=_t(e,dE,5)+257,_d=_t(e,dE+5,5)+1,aE=_t(e,dE+10,4)+4,dE+=14,uE=0;38>uE;uE+=2)_u.itree[uE]=0,_u.itree[uE+1]=0;for(oE=1,uE=0;uE<aE;uE++){var vE=_t(e,dE+3*uE,3);_u.itree[1+(_u.ordr[uE]<<1)]=vE,vE>oE&&(oE=vE)}dE+=3*aE,_n(_u.itree,oE),_i(_u.itree,oE,_u.imap),aE=_u.lmap,uE=_u.dmap,dE=Wt(_u.imap,(1<<oE)-1,nE+_d,e,dE,_u.ttree),oE=(1<<(vE=_._copyOut(_u.ttree,0,nE,_u.ltree)))-1,nE=(1<<(_d=_._copyOut(_u.ttree,nE,_d,_u.dtree)))-1,_n(_u.ltree,vE),_i(_u.ltree,vE,aE),_n(_u.dtree,_d),_i(_u.dtree,_d,uE)}for(;;)if(dE+=15&(_d=aE[_s(e,dE)&oE]),(vE=_d>>>4)>>>8==0)i[sE++]=vE;else{if(vE==256)break;_d=sE+vE-254,264<vE&&(_d=sE+((vE=_u.ldef[vE-257])>>>3)+_t(e,dE,7&vE),dE+=7&vE),dE+=15&(vE=uE[_s(e,dE)&nE]);var AE=((vE=_u.ddef[vE>>>4])>>>4)+j(e,dE,15&vE);for(dE+=15&vE,_h&&(i=v.F._check(i,sE+131072));sE<_d;)i[sE]=i[sE++-AE],i[sE]=i[sE++-AE],i[sE]=i[sE++-AE],i[sE]=i[sE++-AE];sE=_d}}return i.length==sE?i:i.slice(0,sE)},v.F._check=function(e,i){var h=e.length;return i<=h?e:((i=new Uint8Array(Math.max(h<<1,i))).set(e,0),i)},v.F._decodeTiny=function(e,i,h,_,j,_t){for(var Wt=v.F._bitsE,_n=v.F._get17,_i=0;_i<h;){var _s=e[_n(_,j)&i];j+=15&_s;var _u=_s>>>4;if(15>=_u)_t[_i]=_u,_i++;else{var _h=_s=0;for(_u==16?(_h=3+Wt(_,j,2),j+=2,_s=_t[_i-1]):_u==17?(_h=3+Wt(_,j,3),j+=3):_u==18&&(_h=11+Wt(_,j,7),j+=7),_u=_i+_h;_i<_u;)_t[_i]=_s,_i++}}return j},v.F._copyOut=function(e,i,h,_){for(var j=0,_t=0,Wt=_.length>>>1;_t<h;){var _n=e[_t+i];_[_t<<1]=0,_[1+(_t<<1)]=_n,_n>j&&(j=_n),_t++}for(;_t<Wt;)_[_t<<1]=0,_[1+(_t<<1)]=0,_t++;return j},v.F.makeCodes=function(e,i){var h,_,j=v.F.U,_t=e.length,Wt=j.bl_count;for(h=0;h<=i;h++)Wt[h]=0;for(h=1;h<_t;h+=2)Wt[e[h]]++;for(j=j.next_code,h=0,Wt[0]=0,_=1;_<=i;_++)h=h+Wt[_-1]<<1,j[_]=h;for(i=0;i<_t;i+=2)(Wt=e[i+1])!=0&&(e[i]=j[Wt],j[Wt]++)},v.F.codes2map=function(e,i,h){for(var _=e.length,j=v.F.U.rev15,_t=0;_t<_;_t+=2)if(e[_t+1]!=0){var Wt=e[_t+1],_n=_t>>1<<4|Wt,_i=i-Wt;for(_i=(Wt=e[_t]<<_i)+(1<<_i);Wt!=_i;)h[j[Wt]>>>15-i]=_n,Wt++}},v.F.revCodes=function(e,i){for(var h=v.F.U.rev15,_=15-i,j=0;j<e.length;j+=2)e[j]=h[e[j]<<i-e[j+1]]>>>_},v.F._putsE=function(e,i,h){h<<=7&i,e[i>>>=3]|=h,e[i+1]|=h>>>8},v.F._putsF=function(e,i,h){h<<=7&i,e[i>>>=3]|=h,e[i+1]|=h>>>8,e[i+2]|=h>>>16},v.F._bitsE=function(e,i,h){return(e[i>>>3]|e[1+(i>>>3)]<<8)>>>(7&i)&(1<<h)-1},v.F._bitsF=function(e,i,h){return(e[i>>>3]|e[1+(i>>>3)]<<8|e[2+(i>>>3)]<<16)>>>(7&i)&(1<<h)-1},v.F._get17=function(e,i){return(e[i>>>3]|e[1+(i>>>3)]<<8|e[2+(i>>>3)]<<16)>>>(7&i)},v.F._get25=function(e,i){return(e[i>>>3]|e[1+(i>>>3)]<<8|e[2+(i>>>3)]<<16|e[3+(i>>>3)]<<24)>>>(7&i)},v.F.U=function(){var e=Uint16Array,i=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new i(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new i(286),dhst:new i(30),ihst:new i(19),lits:new i(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(j,_t,Wt){for(;_t--!=0;)j.push(0,Wt)}for(var i=v.F.U,h=0;32768>h;h++){var _=h;_=(4278255360&(_=(4042322160&(_=(3435973836&(_=(2863311530&_)>>>1|(1431655765&_)<<1))>>>2|(858993459&_)<<2))>>>4|(252645135&_)<<4))>>>8|(16711935&_)<<8,i.rev15[h]=(_>>>16|_<<16)>>>17}for(h=0;32>h;h++)i.ldef[h]=i.of0[h]<<3|i.exb[h],i.ddef[h]=i.df0[h]<<4|i.dxb[h];e(i.fltree,144,8),e(i.fltree,112,9),e(i.fltree,24,7),e(i.fltree,8,8),v.F.makeCodes(i.fltree,9),v.F.codes2map(i.fltree,9,i.flmap),v.F.revCodes(i.fltree,9),e(i.fdtree,32,5),v.F.makeCodes(i.fdtree,5),v.F.codes2map(i.fdtree,5,i.fdmap),v.F.revCodes(i.fdtree,5),e(i.itree,19,0),e(i.ltree,286,0),e(i.dtree,30,0),e(i.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(e){function i(_,j,_t,Wt){W(this,i);var _n=h.call(this,Wt,"Session");return m(n(_n),"chatManager",void 0),m(n(_n),"joinedChannels",new Set),m(n(_n),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(_n),"startTime",Date.now()),m(n(_n),"seq",U.fromNumber(1,!0)),m(n(_n),"userJoinOptions",new is(!1)),m(n(_n),"seqSentStatuses",[!1,!1]),m(n(_n),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(_n),"loggedOut",!1),m(n(_n),"messageSentTimes",[]),m(n(_n),"curLoginSockets",[void 0,void 0]),m(n(_n),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(_n),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(_n),"dialPendingMsgSubjectMap",new Map),m(n(_n),"context",void 0),m(n(_n),"connection",void 0),m(n(_n),"instanceId",void 0),m(n(_n),"registerSocketsFailureListener",function(){_n.connection.once("socketsFailure",function(){_n.log("socketsFailure, creating a new connection"),ad(function(){return _n.connection.removeAllListeners(),_n.connection=new Yr(_n.context,_n.logger,!0),_n.loginHandler(15e3,!0)}).pipe(oe(function(_i){return _i.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))}),ob(_n.connection.apClient.apFinish$)).subscribe(function(){_n.log("new connection connected")})}),_n.connection.listenerCount("tokenExpired")===0&&_n.connection.on("tokenExpired",function(){_n.emit("tokenExpired")})}),_n.context=_,_n.connection=j,_n.instanceId=_t,_n.chatManager=new hD(Wt),_n.log("The instanceId is %s",_n.instanceId.toString()),_n}la(i,e);var h=ma(i);return Ha(i,[{key:"fetchFileUploadIndexGet",value:function(_){var j=_.hash,_t=_.size;if((_=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var Wt=this.incGetSeq();return _.forEach(function(_n){_n.sendPacket("FileUploadIndexGet",{seq:Wt,hash:j,size:_t})}),{ret:Ca.apply(void 0,G(_.map(function(_n){return _n.fromReceived("FileUploadIndexRet").pipe(aa(function(_i){return Wt.eq(_i.seq)}))}))),fin:Ca.apply(void 0,G(_.map(function(_n){return _n.fromReceived("FileUploadIndexFin").pipe(aa(function(_i){return Wt.eq(_i.seq)}))}))),err:Xb.apply(void 0,G(_.map(function(_n){return _n.fromReceived("FileUploadIndexErr").pipe(aa(function(_i){return Wt.eq(_i.seq)}),ba(function(_i){throw new da(["The media message upload failure, code %d",_i.code],lg)}))}))),timeout:i.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(_){var j=_.hash,_t=_.unit,Wt=_.servers;if((_=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var _n=this.incGetSeq();return _.forEach(function(_i){_i.sendPacket("FileUploadIndexSet",{seq:_n,servers:Wt,hash:j,unit:_t})}),Ca.apply(void 0,[i.genTimeoutError(Lh)].concat(G(_.map(function(_i){return _i.fromReceived("FileUploadIndexErr").pipe(aa(function(_s){return _n.eq(_s.seq)}),ba(function(_s){throw new da(["FileUploadIndexSet failure, code %d",_s.code],lg)}))})),G(_.map(function(_i){return _i.fromReceived("FileUploadIndexFin").pipe(aa(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestFileDownloadIndexGet",value:function(_){var j=_.size,_t=_.zone,Wt=_.unit,_n=_.hash,_i=this.getLoginSockets();if(_i.length===0)throw new K("Client is not logged in");var _s=this.incGetSeq();return _i.forEach(function(_u){_u.sendPacket("FileDownloadIndexGet",{seq:_s,size:j,zone:_t,unit:Wt,hash:_n})}),_=Ca.apply(void 0,G(_i.map(function(_u){return _u.fromReceived("FileDownloadIndexRet").pipe(aa(function(_h){return _s.eq(_h.seq)}))}))).pipe(ba(function(_u){var _h=_u.backups,_d=_u.servers;return _u=ff(_u,iD),ua({backupList:_h.map(function(nE){return[nE]}),serverList:_d.map(function(nE){return[nE]})},_u)}),cd(500)),_i=jm(_i.map(function(_u){return _u.fromReceived("FileDownloadIndexRet").pipe(aa(function(_h){return _s.eq(_h.seq)}))})),Ca(_,_i.pipe(ba(function(_u){return _u.reduce(function(_h,_d){var nE=_h.backupList,aE=_h.serverList;_h=_d.backups;var uE=_d.servers;return _d=ff(_d,jD),ua({backupList:_h.map(function(hE,oE){return[hE].concat(G(nE!==void 0&&Array.isArray(nE[oE])?nE[oE]:[]))}),serverList:uE.map(function(hE,oE){return[hE].concat(G(nE!==void 0&&Array.isArray(aE[oE])?aE[oE]:[]))})},_d)},{})})),i.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var _=this,j=0<arguments.length&&arguments[0]!==void 0?arguments[0]:2e4,_t=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&_t)throw new K("Already logged out, request ignored");_t&&this.registerSocketsFailureListener(),this.connection.initConnection();var Wt=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),_n=Date.now();return Wt.forEach(function(_i,_s){var _u=_.loginSocketSubs[_s].login;_u!==void 0&&_u.unsubscribe(),_.loginSocketSubs[_s].login=_i.pipe(ca(function(_h){var _d;_.curLoginSockets[_s]=_h;var nE=Date.now();eb("Link",{ackedServerIp:_h.address,destServerIp:_h.ip,ec:0,sc:0,elapse:fb(_.startTime),lts:U.fromNumber(nE),responseTime:_n-nE,sid:Xa(_.instanceId),userId:_.context.uid},(_d=_.context.config.enableCloudProxy)!==null&&_d!==void 0&&_d),_.emit("userJoined",_h.env),_t&&_.connection.apClient.apFinish$.next(void 0)})).subscribe(_.lastLoginSockets[_s])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(Wt).concat([gb(this.connection,"connectionInitFailure").pipe(ca(function(_i){throw sa(_i)||Sa(_i)?_i:new da("Login failure",{code:Zq,originalError:_i})}))])).pipe(Ka(1),hb(j),Ga(function(_i){return _i instanceof pb&&_.warn("Client login timeout"),_i&&_i.code===Kh&&(_.connection.emit("tokenExpired"),_.connection.apClient.apFinish$.next(void 0)),_.clearSockets(0,_t),Z(_i)}),ca(function(){_t||_.registerSocketsFailureListener()}),wg(function(){_t||_.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:function(){var _=J(w.mark(function j(){var _t,Wt,_n,_i=this;return w.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),_t=this.getLoginSockets(),Wt=_t.map(function(_u){return _u.sendPacket("UserQuit",{}),_i.connection.waitClosing(_u)}),this.clearSockets(5e3),_n=_t.map(function(_u){return _u.env}),[0,1].filter(function(_u){return!_n.includes(_u)}).forEach(function(_u){_i.connection.closeSocket(_u,0)}),_s.abrupt("return",Xb.apply(void 0,G(Wt)).toPromise());case 9:case"end":return _s.stop()}},j,this)}));return function(){return _.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var _=J(w.mark(function j(_t,Wt){var _n,_i,_s,_u=this;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(this.getLoginSockets().length!==0){_h.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return _n=gb(this,"channelLeft").pipe(wb(function(_d){return _d===_t}),Ka(1)),_i=this.incGetSeq(),(_s=this.lastLoginSockets.map(function(_d){return _d.pipe(Cc(function(nE,aE){aE!==0&&_u.incSeqIfNeeded(nE.env);var uE=aE===0?_i:_u.seq;return nE.sendPacket("GroupEnter",{account:Wt,seq:uE}),nE.fromReceived("GroupReply").pipe(aa(function(hE){return uE.eq(hE.seq)}),ca(function(hE){if((hE=hE.code)!==0)throw new da(["Channel join failure. The response code is %d",hE],Rq)}))}),ob(_n),pe())})).forEach(function(_d,nE){var aE=function(){return _u.loginSocketSubs[nE].channels.delete(_t.channelId)};_u.loginSocketSubs[nE].channels.set(_t.channelId,_d.subscribe({error:aE,complete:aE}))}),_h.next=8,Xb.apply(void 0,G(_s)).pipe(Ka(1),hb(1e4),Ga(function(_d){return _d instanceof pb&&_u.warn("Channel join timeout"),Z(_d)})).toPromise();case 8:this.joinedChannels.add(_t);case 9:case"end":return _h.stop()}},j,this)}));return function(j,_t){return _.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(_,j){this.emit("channelLeft",_),this.joinedChannels.delete(_),this.getLoginSockets().forEach(function(_t){_t.sendPacket("GroupLeave",{account:j})})}},{key:"requestChannelMemberList",value:function(_){var j=this.getLoginSockets();if(j.length===0)throw new K("Client is not logged in. Cannot get the channel members",cA);var _t=this.incGetSeq();return j.forEach(function(Wt){Wt.sendPacket("GroupAllUsersList",{group:_,pageNumber:0,pageSize:200,seq:_t})}),Ca.apply(void 0,[i.genTimeoutError(Pq)].concat(G(j.map(function(Wt){return Wt.fromReceived("GroupAllUsersResult").pipe(aa(function(_n){var _i=_n.seq;return _n.group===_&&_t.eq(_i)}))}))))}},{key:"requestPeersOnlineStatus",value:function(_){var j=this.getLoginSockets();if(j.length===0)throw new K("Client is not logged in");var _t=this.incGetSeq();return j.forEach(function(Wt){Wt.sendPacket("UserStatusList",{users:_,seq:_t})}),Ca.apply(void 0,[i.genTimeoutError(oA)].concat(G(j.map(function(Wt){return Wt.fromReceived("UserStatusResult").pipe(aa(function(_n){return _t.eq(_n.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(_,j){var _t=this,Wt=this.getLoginSockets();if(Wt.length===0)throw new K("Client is not logged in");var _n=this.incGetSeq();return Wt.forEach(function(_i,_s){j!==void 0&&_s!==j||_i.sendPacket("UserAttributeSet",{account:_t.context.uid,attributeInfos:Object.entries(_).map(function(_u){return{key:(_u=ra(_u,2))[0],value:_u[1]}}),seq:_n})}),Ca.apply(void 0,G(Wt.map(function(_i){return _i.fromReceived("UserAttributeErr").pipe(aa(function(_s){return _n.eq(_s.seq)}),ba(function(_s){throw new da(["The user attributes set failure, code %d",_s.code],Sb)}))})).concat([i.genTimeoutError(Tb)],G(Wt.map(function(_i){return _i.fromReceived("UserAttributeRsp").pipe(aa(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(_,j,_t){var Wt=this.getLoginSockets();if(Wt.length===0)throw new K("Client is not logged in");var _n=this.incGetSeq();return Wt.forEach(function(_i){_i.sendPacket("GroupAttributeSet",{broadcast:_t,group:_,attributeInfos:Object.entries(j).map(function(_s){return{key:(_s=ra(_s,2))[0],value:_s[1]}}),seq:_n})}),Ca.apply(void 0,G(Wt.map(function(_i){return _i.fromReceived("GroupAttributeErr").pipe(aa(function(_s){return _n.eq(_s.seq)}),ba(function(_s){throw new da(["The group attributes set failure, code %d",_s.code],Sb)}))})).concat([i.genTimeoutError(Tb)],G(Wt.map(function(_i){return _i.fromReceived("GroupAttributeRsp").pipe(aa(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(_){var j=this,_t=this.getLoginSockets();if(_t.length===0)throw new K("Client is not logged in");var Wt=this.incGetSeq();return _t.forEach(function(_n){_n.sendPacket("UserAttributeMod",{account:j.context.uid,attributeInfos:Object.entries(_).map(function(_i){return{key:(_i=ra(_i,2))[0],value:_i[1]}}),seq:Wt})}),Ca.apply(void 0,G(_t.map(function(_n){return _n.fromReceived("UserAttributeErr").pipe(aa(function(_i){return Wt.eq(_i.seq)}),ba(function(_i){throw new da(["The user attributes add or update failure, code %d",_i.code],Sb)}))})).concat([i.genTimeoutError(Tb)],G(_t.map(function(_n){return _n.fromReceived("UserAttributeRsp").pipe(aa(function(_i){return Wt.eq(_i.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(_,j,_t){var Wt=this.getLoginSockets();if(Wt.length===0)throw new K("Client is not logged in");var _n=this.incGetSeq();return Wt.forEach(function(_i){_i.sendPacket("GroupAttributeMod",{broadcast:_t,group:_,attributeInfos:Object.entries(j).map(function(_s){return{key:(_s=ra(_s,2))[0],value:_s[1]}}),seq:_n})}),Ca.apply(void 0,G(Wt.map(function(_i){return _i.fromReceived("GroupAttributeErr").pipe(aa(function(_s){return _n.eq(_s.seq)}),ba(function(_s){throw new da(["The group attributes add or update failure, code %d",_s.code],Sb)}))})).concat([i.genTimeoutError(Tb)],G(Wt.map(function(_i){return _i.fromReceived("GroupAttributeRsp").pipe(aa(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(_){var j=this,_t=this.getLoginSockets();if(_t.length===0)throw new K("Client is not logged in");var Wt=this.incGetSeq();return _t.forEach(function(_n){_n.sendPacket("UserAttributeDel",{account:j.context.uid,attributes:_,seq:Wt})}),Ca.apply(void 0,G(_t.map(function(_n){return _n.fromReceived("UserAttributeErr").pipe(aa(function(_i){return Wt.eq(_i.seq)}),ba(function(_i){throw new da(["The user attributes delete failure, code %d",_i.code],Sb)}))})).concat([i.genTimeoutError(Tb)],G(_t.map(function(_n){return _n.fromReceived("UserAttributeRsp").pipe(aa(function(_i){return Wt.eq(_i.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(_,j,_t){var Wt=this.getLoginSockets();if(Wt.length===0)throw new K("Client is not logged in");var _n=this.incGetSeq();return Wt.forEach(function(_i){_i.sendPacket("GroupAttributeDel",{group:_,broadcast:_t,attributes:j,seq:_n})}),Ca.apply(void 0,G(Wt.map(function(_i){return _i.fromReceived("GroupAttributeErr").pipe(aa(function(_s){return _n.eq(_s.seq)}),ba(function(_s){throw new da(["The channel attributes delete failure, code %d",_s.code],Sb)}))})).concat([i.genTimeoutError(Tb)],G(Wt.map(function(_i){return _i.fromReceived("GroupAttributeRsp").pipe(aa(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var _=this,j=this.getLoginSockets();if(j.length===0)throw new K("Client is not logged in");var _t=this.incGetSeq();return j.forEach(function(Wt){Wt.sendPacket("UserAttributeSet",{account:_.context.uid,seq:_t,attributeInfos:[]})}),Ca.apply(void 0,G(j.map(function(Wt){return Wt.fromReceived("UserAttributeErr").pipe(aa(function(_n){return _t.eq(_n.seq)}),ba(function(_n){throw new da(["The user attributes clear failure, code %d",_n.code],Sb)}))})).concat([i.genTimeoutError(Tb)],G(j.map(function(Wt){return Wt.fromReceived("UserAttributeRsp").pipe(aa(function(_n){return _t.eq(_n.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(_,j){var _t=this.getLoginSockets();if(_t.length===0)throw new K("Client is not logged in");var Wt=this.incGetSeq();return _t.forEach(function(_n){_n.sendPacket("GroupAttributeSet",{group:_,seq:Wt,attributeInfos:[],broadcast:j})}),Ca.apply(void 0,G(_t.map(function(_n){return _n.fromReceived("GroupAttributeErr").pipe(aa(function(_i){return Wt.eq(_i.seq)}),ba(function(_i){throw new da(["The channel attributes clear failure, code %d",_i.code],Sb)}))})).concat([i.genTimeoutError(Tb)],G(_t.map(function(_n){return _n.fromReceived("GroupAttributeRsp").pipe(aa(function(_i){return Wt.eq(_i.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(_,j){var _t=this.getLoginSockets();if(_t.length===0)throw new K("Client is not logged in");var Wt=this.incGetSeq();return _t.forEach(function(_n){_n.sendPacket("UserAttributeGet",{account:_,seq:Wt,attributes:j})}),Ca.apply(void 0,[i.genTimeoutError(Tb)].concat(G(_t.map(function(_n){return _n.fromReceived("UserAttributeErr").pipe(aa(function(_i){return Wt.eq(_i.seq)}),ba(function(_i){throw(_i=_i.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",_i],Sb)}))})),G(_t.map(function(_n){return _n.fromReceived("UserAttributeRet").pipe(aa(function(_i){return Wt.eq(_i.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(_,j){var _t=this.getLoginSockets();if(_t.length===0)throw new K("Client is not logged in");var Wt=this.incGetSeq();return _t.forEach(function(_n){_n.sendPacket("GroupAttributeGet",{group:_,seq:Wt,attributes:j})}),Ca.apply(void 0,[i.genTimeoutError(Tb)].concat(G(_t.map(function(_n){return _n.fromReceived("GroupAttributeErr").pipe(aa(function(_i){return Wt.eq(_i.seq)}),ba(function(_i){throw new da(["The channel attributes get failure, code %d",_i.code],Sb)}))})),G(_t.map(function(_n){return _n.fromReceived("GroupAttributeRet").pipe(aa(function(_i){return Wt.eq(_i.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(_){var j=this.getLoginSockets();if(j.length===0)throw new K("Client is not logged in");var _t=this.incGetSeq();return j.forEach(function(Wt){Wt.sendPacket("UserAttributeKeysGet",{account:_,seq:_t})}),Ca.apply(void 0,[i.genTimeoutError(Tb)].concat(G(j.map(function(Wt){return Wt.fromReceived("UserAttributeErr").pipe(aa(function(_n){return _t.eq(_n.seq)}),ba(function(_n){throw(_n=_n.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",_n],Sb)}))})),G(j.map(function(Wt){return Wt.fromReceived("UserAttributeKeysRet").pipe(aa(function(_n){return _t.eq(_n.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(_){var j=this.getLoginSockets();if(j.length===0)throw new K("Client is not logged in");var _t=this.incGetSeq();return j.forEach(function(Wt){Wt.sendPacket("GroupAttributeKeysGet",{group:_,seq:_t})}),Ca.apply(void 0,[i.genTimeoutError(Tb)].concat(G(j.map(function(Wt){return Wt.fromReceived("GroupAttributeErr").pipe(aa(function(_n){return _t.eq(_n.seq)}),ba(function(_n){throw new Wc(["Channel attribute operation unknown error code: %d",_n.code],Sb)}))})),G(j.map(function(Wt){return Wt.fromReceived("GroupAttributeKeysRet").pipe(aa(function(_n){return _t.eq(_n.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(_){var j=this.getLoginSockets();if(j.length===0)throw new K("Client is not logged in");var _t=this.incGetSeq();return j.forEach(function(Wt){Wt.sendPacket("GroupStatusList",{groups:_,seq:_t})}),Ca.apply(void 0,[i.genTimeoutError(Pq)].concat(G(j.map(function(Wt){return Wt.fromReceived("GroupStatusResult").pipe(aa(function(_n){return _t.eq(_n.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(_){var j=this.getLoginSockets();if(j.length===0)throw new K("Client is not logged in");var _t=this.incGetSeq();return j.forEach(function(Wt){Wt.sendPacket("SubscribeUserStatus",{seq:_t,users:_})}),Ca.apply(void 0,[i.genTimeoutError(vA)].concat(G(j.map(function(Wt){return Wt.fromReceived("SubscribeResponse").pipe(aa(function(_n){return _t.eq(_n.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(_){var j=this.getLoginSockets();if(j.length===0)throw new K("Client is not logged in");var _t=this.incGetSeq();j.forEach(function(Wt){Wt.sendPacket("UnsubscribeUserStatus",{seq:_t,users:_})})}},{key:"sendInvitationMessage",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u,_h,_d,nE,aE,uE,hE,oE,sE=this;return w.wrap(function(dE){for(;;)switch(dE.prev=dE.next){case 0:if(Wt=_t.peerId,_n=_t.callId,_i=_t.extra,_s=_t.isAcceptAck,_u=_t.channelId,_h=_t.type,_d={callId:_n},_s===void 0){dE.next=6;break}if(_h==="CallAccept"){dE.next=5;break}throw Error("invalid invitation type");case 5:_d.type=_s?"ack":"request";case 6:return _d.channel=_u,(_h==="CallInvite"||_h==="CallCancel"||_h==="CallReject"||_h==="CallAccept"&&_s===!1)&&_i!==void 0&&(_d.extra=_i),nE=Bg(),this.log("The sent invitation body is %o",_d),aE=function(vE){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:nE,instance:sE.instanceId,dst:Wt,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:vE,MessageType:_h}).toLong(),payload:new TextEncoder().encode(JSON.stringify(_d)),src:sE.context.uid}},dE.next=14,Kb(this.sendMessageToRetry(aE,!0)).pipe(hb(1e4),Ga(function(vE){return vE instanceof pb&&sE.warn("Send invitation timeout"),Z(vE)})).toPromise();case 14:return uE=dE.sent,hE=uE.code,oE=uE.retryTimes,dE.abrupt("return",{hasPeerReceived:hE===0,hasReSent:oE!==0});case 18:case"end":return dE.stop()}},j,this)}));return function(j){return _.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var _=J(w.mark(function j(_t,Wt,_n,_i,_s,_u){var _h,_d,nE,aE,uE,hE,oE,sE,dE,vE,AE,PE,IE,QE,m_,yE,FE,UE,qE,gE,RE,OE,HE,CE,jE,LE,i_,o_,w_,_y=this;return w.wrap(function(bS){for(;;)switch(bS.prev=bS.next){case 0:if(_d=Wt.width,nE=_d===void 0?0:_d,aE=Wt.height,uE=aE===void 0?0:aE,hE=Wt.fileName,oE=hE===void 0?"":hE,sE=Wt.description,dE=sE===void 0?"":sE,vE=Wt.thumbnail,AE=vE===void 0?new Blob:vE,PE=Wt.thumbnailHeight,IE=PE===void 0?0:PE,QE=Wt.thumbnailWidth,m_=QE===void 0?0:QE,yE=Wt.size,FE=yE===void 0?0:yE,UE=Wt.mediaId,qE=_s.enableOfflineMessaging,gE=_s.enableHistoricalMessaging,za(_n)){bS.next=4;break}throw new I("The send message arguments are not valid",_i?$k:hg);case 4:if(!(32768<new Blob([oE,AE,dE]).size)){bS.next=6;break}throw new I("The size of message overflowed ",_i?ve:Hh);case 6:return RE=this.chatManager.getChatInfo(_n),OE=RE.dialogue,HE=RE.sequence,CE=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(CE,"-").concat(OE,"#").concat(HE,'"'),_i?" peer":" channel",oa(_n)),m(_h={},"media_description",dE),m(_h,"media_width",nE),m(_h,"media_height",uE),m(_h,"media_thumbnailwidth",m_),m(_h,"media_thumbnailheight",IE),m(_h,"media_size",FE),m(_h,"media_id",UE),m(_h,"media_filename",oE),jE=uc(_h,function(MS){return new TextEncoder().encode(MS.toString())}),bS.t0=Uint8Array,bS.next=14,Ji(AE);case 14:return bS.t1=bS.sent,jE.media_thumbnail=new bS.t0(bS.t1),LE=_i&&_t==="IMAGE"?"PeerImageMessage":_i&&_t==="FILE"?"PeerFileMessage":_i||_t!=="IMAGE"?"ChannelFileMessage":"ChannelImageMessage",i_=function(MS){return{MiscMap:jE,sequence:HE,dialogue:OE,instance:CE,dst:_n,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:MS,CompressionMethod:"Uncompressed",MessageType:LE,ToCache:qE,ToArchive:gE}).toLong(),payload:new Uint8Array,src:_y.context.uid}},bS.next=20,Kb(this.sendMessageToRetry(i_,!0)).pipe(hb(_u===void 0?1e4:_u),Ga(function(MS){return MS instanceof pb&&_y.warn("Send message timeout"),Z(MS)})).toPromise();case 20:if(o_=bS.sent,(w_=o_.code)!==2){bS.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return bS.abrupt("return",{hasPeerReceived:w_===0});case 25:case"end":return bS.stop()}},j,this)}));return function(j,_t,Wt,_n,_i,_s){return _.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var _=J(w.mark(function j(_t,Wt,_n,_i,_s,_u){var _h,_d,nE,aE,uE,hE,oE,sE,dE,vE,AE=this;return w.wrap(function(PE){for(;;)switch(PE.prev=PE.next){case 0:if(_h=_s.enableOfflineMessaging,_d=_s.enableHistoricalMessaging,za(_n)&&_t instanceof Uint8Array&&typeof Wt=="string"){PE.next=3;break}throw new I("The send message arguments are not valid",_i?$k:hg);case 3:if(!(32768<_t.byteLength+new Blob([Wt]).size)){PE.next=5;break}throw new ib("The message size is over the 32KB limit",_i?ve:Hh);case 5:return nE=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=_t.byteLength,aE=this.chatManager.getChatInfo(_n),uE=aE.dialogue,hE=aE.sequence,oE=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(oE,"-").concat(uE,"#").concat(hE,'"'),nE?" compressed":"",_i?"peer":"channel",oa(_n)),sE=function(IE){return{MiscMap:{description:new TextEncoder().encode(Wt)},sequence:hE,dialogue:uE,instance:oE,dst:_n,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:IE,CompressionMethod:nE?"Zlib":"Uncompressed",MessageType:_i?"PeerRawMessage":"ChannelRawMessage",ToCache:_h,ToArchive:_d}).toLong(),payload:nE?ks(_t):_t,src:AE.context.uid}},PE.next=12,Kb(this.sendMessageToRetry(sE,!0)).pipe(hb(_u===void 0?1e4:_u),Ga(function(IE){return IE instanceof pb&&AE.warn("Send message timeout"),Z(IE)})).toPromise();case 12:return dE=PE.sent,vE=dE.code,PE.abrupt("return",{hasPeerReceived:vE===0});case 15:case"end":return PE.stop()}},j,this)}));return function(j,_t,Wt,_n,_i,_s){return _.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var _=J(w.mark(function j(_t,Wt,_n,_i,_s){var _u,_h,_d,nE,aE,uE,hE,oE,sE,dE,vE,AE=this;return w.wrap(function(PE){for(;;)switch(PE.prev=PE.next){case 0:if(_u=_i.enableOfflineMessaging,_h=_i.enableHistoricalMessaging,za(Wt)){PE.next=3;break}throw new I("The send message arguments are not valid",_n?$k:hg);case 3:if(!(32768<new Blob([_t]).size)){PE.next=5;break}throw new ib("The message size is over the 32KB limit",_n?ve:Hh);case 5:return _d=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([_t]).size,nE=this.chatManager.getChatInfo(Wt),aE=nE.dialogue,uE=nE.sequence,hE=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(hE,"-").concat(aE,"#").concat(uE,'"'),_d?" compressed":"",_n?"peer":"channel",oa(Wt)),oE=new TextEncoder().encode(_t),sE=function(IE){return{MiscMap:{},sequence:uE,dialogue:aE,instance:hE,dst:Wt,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:IE,CompressionMethod:_d?"Zlib":"Uncompressed",MessageType:_n?"PeerTextMessage":"ChannelTextMessage",ToCache:_u,ToArchive:_h}).toLong(),payload:_d?ks(oE):oE,src:AE.context.uid}},PE.next=13,Kb(this.sendMessageToRetry(sE,!0)).pipe(hb(_s===void 0?1e4:_s),Ga(function(IE){return IE instanceof pb&&AE.warn("Send message timeout"),Z(IE)})).toPromise();case 13:return dE=PE.sent,vE=dE.code,PE.abrupt("return",{hasPeerReceived:vE===0});case 16:case"end":return PE.stop()}},j,this)}));return function(j,_t,Wt,_n,_i){return _.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(_,j){Object.entries(this.loginSocketSubs[_]).forEach(function(_t){var Wt=(_t=ra(_t,2))[1];_t[0]==="channels"&&j||(Array.isArray(Wt)||Wt instanceof Map?Wt.forEach(function(_n){return _n.unsubscribe()}):Wt&&Wt.unsubscribe())}),this.loginSocketSubs[_]={channels:j?this.loginSocketSubs[_].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var _=J(w.mark(function j(_t,Wt){var _n,_i,_s,_u,_h,_d,nE,aE,uE,hE=this,oE=arguments;return w.wrap(function(sE){for(;;)switch(sE.prev=sE.next){case 0:if(_n=2<oE.length&&oE[2]!==void 0?oE[2]:0,this.log("Attempt to send the message ".concat(Wt?" with retrying, %o":"without retrying"),{retryTimes:_n}),(_i=this.getLoginSockets()).length!==0){sE.next=5;break}throw Error("no logged-in sockets");case 5:return _s=_t(_n),_i.forEach(function(dE){dE.sendPacket("Message",_s)}),_u=_s.dialogue,_h=_s.sequence,_d=_s.instance,nE=_i.map(function(dE){return dE.fromReceived("Ack").pipe(wb(function(vE){return _u.eq(vE.dialogue)&&_h.eq(vE.sequence)&&_d.eq(vE.instance)}))}),sE.prev=9,sE.next=12,Xb.apply(void 0,G(nE)).pipe(hb(6e3),Ga(function(dE){return Sa(dE)&&hE.warn("Message send timeout, retry times %d",_n),Z(dE)}),Ka(1)).toPromise();case 12:return aE=sE.sent,uE=aE.code,this.log("The message has been acked, %o",{code:uE}),sE.abrupt("return",{code:uE,retryTimes:_n});case 18:if(sE.prev=18,sE.t0=sE.catch(9),!(sE.t0 instanceof pb&&Wt)){sE.next=22;break}return sE.abrupt("return",this.sendMessageToRetry(_t,!1,_n+1));case 22:throw sE.t0;case 23:case"end":return sE.stop()}},j,this,[[9,18]])}));return function(j,_t){return _.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var _=this;this.lastLoginSockets.map(function(j){return j.pipe(Cc(function(_t){return Bc(0,2750).pipe(ca(function(){_.incSeqIfNeeded(_t.env),_t.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:_.seq})}))}))}).forEach(function(j,_t){var Wt=_.loginSocketSubs[_t].keepAlive;Wt!==void 0&&Wt.unsubscribe(),_.loginSocketSubs[_t].keepAlive=j.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var _=this;this.lastLoginSockets.map(function(j){return j.pipe(Cc(function(_t){var Wt,_n=!1,_i=_t.userJoin$.pipe(ca(function(){_n=!0})),_s=_t.input$.pipe(ca(function(_u){Li[_u.uri].slice(0,-3)!=="Ping"&&(_n=!1)}));return Xb(Bc(15e3,1e4).pipe(Pt(_t.receivedPacket),ca(function(_u){_u=ra(_u,2),_u=ra(_u[1],2)[1],Wt!==_u||_n||_t.forceReconnect(),Wt=_u})),_i,_s)}))}).forEach(function(j,_t){var Wt=_.loginSocketSubs[_t].keepAliveReconnector;Wt!==void 0&&Wt.unsubscribe(),_.loginSocketSubs[_t].keepAliveReconnector=j.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var _=this;this.lastLoginSockets.map(function(j){return j.pipe(Cc(function(_t){return Xb(gb(_t,"reconnect").pipe(ca(_.onSocketReconnect(_t))),_t.fromReceived("Message").pipe(ca(_.onMessage(_t))),_t.fromReceived("GroupEnterNotice").pipe(ca(_.onGroupEnterNotice())),_t.fromReceived("GroupLeaveNotice").pipe(ca(_.onGroupLeaveNotice())),_t.fromReceived("GroupCountNotice").pipe(ca(_.onGroupCountNotice())),_t.fromReceived("GroupAttributeAlt").pipe(ca(_.onGroupAttributeAlt())),_t.fromReceived("UserJoinNotice").pipe(ca(_.onUserNotice(S.PeerOnlineState.ONLINE))),_t.fromReceived("UserQuitNotice").pipe(ca(_.onUserNotice(S.PeerOnlineState.OFFLINE))),_t.fromReceived("UserWaitNotice").pipe(ca(_.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))}))}).forEach(function(j,_t){_.loginSocketSubs[_t].receivers.push(j.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(_,j,_t){var Wt=this;return im(ad(function(){Wt.userJoinOptions=new is(j),_.sendPacket("UserJoin",{account:Wt.context.uid,instance:Wt.instanceId,opt:Wt.userJoinOptions.toLong(),seq:_t,ticket:_.ticket})}),_.fromReceived("UserResp").pipe(aa(function(_n){return _t.eq(_n.seq)}),ca(function(_n){if((_n=_n.code)!==0)throw Wt.clearSockets(),Wt.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",_n],jg);Wt.log("ENV_%d logged in",_.env)}),qf(_),hb(15e3))).pipe(wb(function(_n){return _n!==void 0}),Ga(function(_n){return _n instanceof pb&&Wt.warn("Login response timeout, rejoin: %s",j),Z(_n)}))}},{key:"getSocketLoginObservables",value:function(_,j){var _t=this;return _.map(function(Wt){return Wt.pipe(ca(function(_n){_n.listenerCount("socketUserDrop")===0&&_n.on("socketUserDrop",function(_i){return _t.onUserDrop(_i,_n)})}),Cc(function(_n,_i){return _t.incSeqIfNeeded(_n.env),_t.requestSocketLogin(_n,_i!==0,_i===0?j:_t.seq)}),pe())})}},{key:"incSeqIfNeeded",value:function(_){if(![0,1].includes(_))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[_]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[_]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var _=this.curLoginSockets,j=-1,_t=_==null?0:_.length,Wt=0,_n=[];++j<_t;){var _i=_[j];_i&&(_n[Wt++]=_i)}return _n}},{key:"emitMessage",value:function(_,j){var _t=_.options,Wt=_.payload,_n=_.src,_i=_.dst,_s=_.instance,_u=_.dialogue,_h=_.sequence,_d=_.ms,nE=_.MiscMap;this.dialogueSequenceLru.set(_u.toString(),_h),_s="".concat(_s,"-").concat(_u,"#").concat(_h),this.msgDedupLru.has(_s)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",j,_s):(this.msgDedupLru.set(_s,void 0),j=new ae(_t),this.lastLoginSockets.forEach(function(){var aE=J(w.mark(function uE(hE){var oE;return w.wrap(function(sE){for(;;)switch(sE.prev=sE.next){case 0:return sE.next=2,hE.pipe(Ka(1)).toPromise();case 2:oE=sE.sent,i.sendMessageAck(_,oE);case 4:case"end":return sE.stop()}},uE)}));return function(uE){return aE.apply(this,arguments)}}()),_t=j.isZlibCompressed(),j.isInvitation()?(_i=pa(_t?nl(Xm(Wt,Uint8Array.of(0,0,0,0))):Wt),_i=JSON.parse(_i),this.log("The received invitation body is %o",_i),this.emit("invitationMessage",{body:_i,type:j.getInvitationType(),peerId:_n,serverReceivedTs:_d.toNumber()})):j.isTextMessage()?(nE=j.isPeerTextMessage(),Wt=pa(_t?nl(Xm(Wt,Uint8Array.of(0,0,0,0))):Wt),this.info("Received a %s %s text message from %s to %s, %s",_t?" compressed":"",nE?"peer":"channel",oa(_n),oa(_i),_s),nE?(_n={text:Wt,peerId:_n,properties:{serverReceivedTs:_d.toNumber(),isOfflineMessage:j.isFromCache()}},this.emit("peerTextMessage",_n)):this.emit("channelTextMessage",{channelId:_i,memberId:_n,text:Wt,properties:{serverReceivedTs:_d.toNumber(),isOfflineMessage:!1}})):j.isRawMessage()?(_u=j.isRawPeerMessage(),nE=(nE=nE.description)===void 0?"":pa(nE),Wt=_t?nl(Wt):Wt,this.info("Received a %s %s raw message from %s to %s, %s",_t?" compressed":"",_u?"peer":"channel",oa(_n),oa(_i),_s),_u?(_n={desc:nE,raw:Wt,peerId:_n,properties:{serverReceivedTs:_d.toNumber(),isOfflineMessage:j.isFromCache()}},this.emit("peerRawMessage",_n)):this.emit("channelRawMessage",{desc:nE,raw:Wt,channelId:_i,memberId:_n,properties:{serverReceivedTs:_d.toNumber(),isOfflineMessage:!1}})):(j.isImageMessage()||j.isFileMessage())&&(Wt=j.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",Wt?"peer":"channel",oa(_n),oa(_i),_s),Wt?this.emit("peerMediaMessage",{messageType:j.isImageMessage()?"IMAGE":"FILE",details:nE,peerId:_n,properties:{serverReceivedTs:_d.toNumber(),isOfflineMessage:j.isFromCache()}}):this.emit("channelMediaMessage",{messageType:j.isImageMessage()?"IMAGE":"FILE",details:nE,memberId:_n,channelId:_i,properties:{serverReceivedTs:_d.toNumber(),isOfflineMessage:j.isFromCache()}})))}},{key:"onSocketReconnect",value:function(_){var j=this;return function(){var _t=[0,1].filter(function(Wt){return Wt!==_.env})[0];(_t=j.connection.curOpenSockets[_t])&&!_t.loggedIn&&j.emit("connectionLost")}}},{key:"onUserDrop",value:function(_,j){var _t;_=_.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(j.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:j.address,serverCode:_,sid:Xa(this.instanceId),userId:this.context.uid},(_t=this.context.config.enableCloudProxy)!==null&&_t!==void 0&&_t),_===10006||_===10001?this.warn("Login too often and kicked off, reconnect and login"):_===10009?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(_)&&(this.emit("userDrop",_),this.clearSockets())}},{key:"clearSockets",value:function(){var _=this,j=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,_t=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(Wt){_.cleanLoginSubs(Wt,_t),_.connection.closeSocket(Wt,j)})}},{key:"onMessage",value:function(_){var j=this;return function(_t){var Wt=_t.dialogue,_n=_t.instance,_i=_t.sequence,_s=_t.options;if(_t.src===j.context.uid)j.log("The message is from the local account, ignored");else{var _u=Wt.toString(),_h=j.dialPendingMsgSubjectMap.get(_u);if(Wt="".concat(_n,"-").concat(Wt,"#").concat(_i),_h)_h.next(_t),j.log("Env_%d: The dialogue has pending messages, next: %s",_.env,Wt);else{var _d=j.dialogueSequenceLru.get(_u);if(_h=!_d&&_i.eq(1),_n=_d!==void 0&&_i.sub(_d).eq(1),_h||_n)j.emitMessage(_t,_.env);else{if(_d){if(_i.lte(_d))return;j.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",_.env,Wt)}else j.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",_.env,Wt);_i=new Pa,j.dialPendingMsgSubjectMap.set(_u,_i);var nE=_i.pipe(Qs(Pk),xg(function(aE,uE){return[].concat(G(aE),[uE])},[]),ba(function(aE){return G(aE).sort(function(uE,hE){return uE=uE.sequence,hE=hE.sequence,uE.eq(hE)?0:uE.gt(hE)?1:-1})}),sm(1));_s=!(_s=new ae(_s)).isFromCache()&&!_s.isBufferedMessage(),nE.pipe(ob(Bc(_s?750:1500)),aa(function(aE){if(2>aE.length)return!1;for(var uE=_d===void 0?U.fromNumber(1,!0):_d.add(1),hE=0;hE<aE.length;uE=uE.add(1),hE++)if(!aE[hE].sequence.eq(uE))return!1;return!0}),wg(function(){j.dialPendingMsgSubjectMap.delete(_u)})).subscribe(function(aE){aE.forEach(function(uE){j.emitMessage(uE,_.env),j.log("Env_%d: The message queue has fully ordered, emitting: %s",_.env,"".concat(uE.instance,"-").concat(uE.dialogue,"#").concat(uE.sequence))})},function(aE){aE instanceof vg&&nE.pipe(Ka(1)).subscribe(function(uE){return uE.forEach(function(hE){j.log("Env_%d: The message pending queue expired, emitting: %s",_.env,"".concat(hE.instance,"-").concat(hE.dialogue,"#").concat(hE.sequence)),j.emitMessage(hE,_.env)})})}),_i.next(_t)}}}}}},{key:"onGroupEnterNotice",value:function(){var _=this;return function(j){_.emit("memberNotice",{channelId:j.group,seq:j.seq,instance:j.instance,memberId:j.user,type:"MemberJoined",size:j.size})}}},{key:"onGroupLeaveNotice",value:function(){var _=this;return function(j){_.emit("memberNotice",{channelId:j.group,seq:j.seq,instance:j.instance,memberId:j.user,type:"MemberLeft",size:j.size})}}},{key:"onGroupCountNotice",value:function(){var _=this;return function(j){_.emit("memberNotice",{channelId:j.group,seq:j.seq,instance:j.instance,type:"MemberCountUpdated",size:j.size})}}},{key:"onGroupAttributeAlt",value:function(){var _=this;return function(j){var _t=j.group;j=ff(j,kD),_.emit("channelAttributesUpdated",ua({channelId:_t},j))}}},{key:"onUserNotice",value:function(_){var j=this;return function(_t){j.emit("peerOnlineStatusChanged",{peerId:_t.user,instance:_t.instance,seq:_t.seq,state:_})}}}],[{key:"sendMessageAck",value:function(_,j){var _t=new ae(_.options);(_t.isInvitation()||_t.isPeerMessage())&&j.sendPacket("Ack",{code:0,dialogue:_.dialogue,instance:_.instance,sequence:_.sequence})}}]),i}(tb());m(ls,"genTimeoutError",function(e,i){return bb(void 0).pipe(cd(i===void 0?1e4:i),ba(function(){throw new db(["Request timed out after %ds",i===void 0?1e4:i],e)}))});var ms,ol,pl=0,ql=0;Ud.v1=function(e,i,h){h=i&&h||0;var _=i||[],j=(e=e||{}).node||ms,_t=e.clockseq!==void 0?e.clockseq:ol;if(j==null||_t==null){var Wt=Jq();j==null&&(j=ms=[1|Wt[0],Wt[1],Wt[2],Wt[3],Wt[4],Wt[5]]),_t==null&&(_t=ol=16383&(Wt[6]<<8|Wt[7]))}Wt=e.msecs!==void 0?e.msecs:new Date().getTime();var _n=e.nsecs!==void 0?e.nsecs:ql+1,_i=Wt-pl+(_n-ql)/1e4;if(0>_i&&e.clockseq===void 0&&(_t=_t+1&16383),(0>_i||Wt>pl)&&e.nsecs===void 0&&(_n=0),1e4<=_n)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=Wt,ql=_n,ol=_t,e=(1e4*(268435455&(Wt+=122192928e5))+_n)%4294967296,_[h++]=e>>>24&255,_[h++]=e>>>16&255,_[h++]=e>>>8&255,_[h++]=255&e,e=Wt/4294967296*1e4&268435455,_[h++]=e>>>8&255,_[h++]=255&e,_[h++]=e>>>24&15|16,_[h++]=e>>>16&255,_[h++]=_t>>>8|128,_[h++]=255&_t,_t=0;6>_t;++_t)_[h+_t]=j[_t];return i||Kq(_)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(e){function i(_,j,_t){W(this,i);var Wt=h.call(this,_t,"RtmLocalInvitation",!0);return m(n(Wt),"state",Ba.IDLE),m(n(Wt),"localInvitationEnd$",Ca(gb(n(Wt),"LocalInvitationAccepted"),gb(n(Wt),"LocalInvitationRefused"),gb(n(Wt),"LocalInvitationFailure"),gb(n(Wt),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(Wt),"callId",Ud.v4()),m(n(Wt),"_content",""),m(n(Wt),"_channelId",""),m(n(Wt),"_response",""),m(n(Wt),"calleeId",void 0),m(n(Wt),"logger",void 0),m(n(Wt),"getSession",void 0),Wt.calleeId=_,Wt.getSession=j,Wt.logger=_t,Wt}la(i,e);var h=ma(i);return Ha(i,[{key:"channelId",get:function(){return this._channelId},set:function(_){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=_)}},{key:"content",get:function(){return this._content},set:function(_){this.log("set content for %s",this.callId),this._content=_}},{key:"response",get:function(){return this._response},set:function(_){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var _,j=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark(function _t(){var Wt,_n,_i;return w.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:return _s.next=2,j.getSession().sendInvitationMessage({peerId:j.calleeId,callId:j.callId,extra:j._content,type:"CallInvite",channelId:j._channelId});case 2:if(Wt=_s.sent,_n=Wt.hasPeerReceived,_i=Wt.hasReSent,!j.isLocalInvitationEnd()){_s.next=7;break}throw new db("send invitation timeout");case 7:if(j.log("The local invitation has sent to the callee"),_n||_i){_s.next=11;break}throw _=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(_n){_s.next=14;break}throw _=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return _s.stop()}},_t)}))).pipe(oe(function(_t){return _t.pipe(ca(function(Wt){if(!(Wt instanceof rl))throw Wt}),cd(2e3))}),hb(3e4),Ga(function(_t){return Sa(_t)&&j.warn("local invitation ack timed out"),Z(_t)}),ob(this.localInvitationEnd$)).subscribe({next:function(){j.state===Ba.RECEIVED_BY_REMOTE?j.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):j.state!==Ba.SENT_TO_REMOTE?j.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(j.info("The peer received the local invitation %s.",j.callId),j.state=Ba.RECEIVED_BY_REMOTE,j.emit("LocalInvitationReceivedByPeer"),j.localInvitationEnd$.pipe(hb(6e4),Ga(function(_t){return Sa(_t)&&j.warn("local invitation expired"),Z(_t)})).subscribe({error:function(){j.state=Ba.FAILURE,j.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(_t){j.isLocalInvitationEnd()?j.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(j.state=Ba.FAILURE,Sa(_t)&&_?_.code==="PEER_NOT_ONLINE"?j.emit("LocalInvitationFailure",bf.PEER_OFFLINE):_.code==="RESENT_AND_OFFLINE"&&j.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(_t)?j.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):_t.name==="RtmInvalidStatusError"?j.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):j.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(_){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=_,this.emit("LocalInvitationAccepted",_))}}},{key:"onRefuseReceived",value:function(_){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=_,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",_)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),i}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(e){function i(_){var j=_.invitationChannel,_t=_.extraContent,Wt=_.callId,_n=_.callerId,_i=_.logger;_=_.getSession,W(this,i);var _s=h.call(this,_i,"RtmRemoteInvitation",!0);return m(n(_s),"state",kb.INVITATION_RECEIVED),m(n(_s),"remoteInvitationEnd$",Ca(gb(n(_s),"RemoteInvitationCanceled"),gb(n(_s),"RemoteInvitationRefused"),gb(n(_s),"RemoteInvitationAccepted"),gb(n(_s),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(_s),"callerId",void 0),m(n(_s),"callId",void 0),m(n(_s),"_getSession",void 0),m(n(_s),"logger",void 0),m(n(_s),"_content",void 0),m(n(_s),"_channelId",void 0),m(n(_s),"_response",""),_s._channelId=j,_s._content=_t,_s.callId=Wt,_s.callerId=_n,_s._getSession=_,_s.logger=_i,_s.remoteInvitationEnd$.pipe(hb(6e4),Ga(function(_u){return Sa(_u)&&_s.warn("Remote invitation expired"),Z(_u)})).subscribe({error:function(){_s.state=kb.FAILURE,_s.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),_s}la(i,e);var h=ma(i);return Ha(i,[{key:"channelId",get:function(){return this._channelId},set:function(_){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(_){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(_){this._response=_}},{key:"accept",value:function(){var _,j=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb(function(){return ad(J(w.mark(function _t(){return w.wrap(function(Wt){for(;;)switch(Wt.prev=Wt.next){case 0:return Wt.abrupt("return",j._getSession().sendInvitationMessage({peerId:j.callerId,callId:j.callId,extra:j.response,type:"CallAccept",isAcceptAck:!1,channelId:j.channelId}));case 1:case"end":return Wt.stop()}},_t)})))}),wb(function(_t){return _=_t.hasPeerReceived}),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(_t){if(j.logError(_t),j.state=kb.FAILURE,Sa(_t))switch(_){case void 0:case!0:return void j.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void j.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}j.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8  1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(_){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=_,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",_))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),i}(tb()),nD=function(e){function i(_,j){W(this,i);var _t=h.call(this,j,"InvitationManager");return m(n(_t),"getSession",void 0),m(n(_t),"invitationDispatcher",new ea.EventEmitter),m(n(_t),"outgoingLocalInvitations",new Map),m(n(_t),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(_t),"logger",void 0),_t.getSession=cn(_),_t.logger=j,_t.invitationDispatcher.on("remoteInvitationToManager",function(Wt){var _n=Wt.callId,_i=Wt.extra,_s=Wt.callerId;Wt=Wt.channelId,_t.receivedRemoteInvitations.has(_n)||((_i=new mD({callerId:_s,callId:_n,getSession:_t.getSession,logger:j,extraContent:_i,invitationChannel:Wt})).remoteInvitationEnd$.subscribe(function(){_t.receivedRemoteInvitations.delete(_n)}),_t.receivedRemoteInvitations.set(_n,_i),_t.emit("remoteInvitationInstance",_i))}),_t.invitationDispatcher.on("acceptAckToRemoteInvitation",function(Wt){(Wt=_t.receivedRemoteInvitations.get(Wt.callId))&&Wt.onAcceptAckReceived()}),_t.invitationDispatcher.on("cancelToRemoteInvitation",function(Wt){var _n=Wt.extra;(Wt=_t.receivedRemoteInvitations.get(Wt.callId))&&Wt.onCancelReceived(_n)}),_t.invitationDispatcher.on("acceptToLocalInvitation",function(Wt){var _n=Wt.extra;(Wt=_t.outgoingLocalInvitations.get(Wt.callId))&&Wt.onAcceptReceived(_n)}),_t.invitationDispatcher.on("refuseToLocalInvitation",function(Wt){var _n=Wt.extra;(Wt=_t.outgoingLocalInvitations.get(Wt.callId))&&Wt.onRefuseReceived(_n)}),_t}la(i,e);var h=ma(i);return Ha(i,[{key:"invitationMessageHandler",value:function(_){var j=_.body,_t=j.callId,Wt=j.extra;Wt=Wt===void 0?"":Wt;var _n=j.type,_i=(j=j.channel)===void 0?"":j,_s=_.type;switch(j=_.peerId,_=_.serverReceivedTs,_s){case"CallAccept":_n==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:_t}):_n==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:_t,extra:Wt});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:_t,callerId:j,extra:Wt,channelId:_i});break;case"CallCancel":if(_t==="0"){_t="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(_i,"_").concat(Wt),this.getSession().emit("peerTextMessage",{peerId:j,properties:{serverReceivedTs:_,isOfflineMessage:!1},text:_t});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:_t,extra:Wt});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:_t,extra:Wt});break;default:throw Im("invitationType",_s)}}},{key:"genLocalInvitation",value:function(_){var j=this,_t=new lD(_,this.getSession,this.logger);return _t.localInvitationEnd$.subscribe(function(){j.outgoingLocalInvitations.delete(_t.callId)}),this.outgoingLocalInvitations.set(_t.callId,_t),_t}}]),i}(tb()),oD=function(e,i,h){var _=!0,j=!0;if(typeof e!="function")throw new TypeError("Expected a function");return lb(h)&&(_="leading"in h?!!h.leading:_,j="trailing"in h?!!h.trailing:j),qC(e,i,{leading:_,maxWait:i,trailing:j})},ub,cf;(function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"})(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(e){function i(_,j,_t,Wt){W(this,i);var _n=h.call(this,Wt,"RtmChannel",!0);return m(n(_n),"onMemberCountUpdated",oD(function(_i){_i!==_n.memberCount&&(_n.memberCount=_i,_n.emit("MemberCountUpdated",_i))},1e3)),m(n(_n),"getSession",void 0),m(n(_n),"memberCount",0),m(n(_n),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(_n),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(_n),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(_n),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(_n),"channelId",void 0),m(n(_n),"client",void 0),m(n(_n),"onAttributesUpdated",function(_i){var _s=_i.channelId,_u=_i.attributeMaps,_h=_i.seq;_i=_i.instance.toString();var _d=_n.attributesSeqLru.get(_i);if((!_d||_h.greaterThan(_d))&&(_n.attributesSeqLru.set(_i,_h),_s===_n.channelId)){for(_s={},_h=0;_h<_u.length;_h++){var nE=_u[_h];_i=nE.key,_d=nE.ms;var aE=nE.value;if(nE=nE.origin,typeof _i!="string"||!U.isLong(_d)||typeof aE!="string"||!za(nE))break;_s[_i]={value:aE,lastUpdateUserId:nE,lastUpdateTs:_d.toNumber()}}_n.emit("AttributesUpdated",_s)}}),m(n(_n),"onChannelTextMessage",function(_i){var _s=_i.memberId,_u=_i.text,_h=_i.properties;_i.channelId===_n.channelId&&_n.emit("ChannelMessage",{text:_u,messageType:S.MessageType.TEXT},_s,_h)}),m(n(_n),"onChannelMediaMessage",function(_i){var _s=_i.memberId,_u=_i.properties,_h=_i.details,_d=_i.messageType;_i.channelId===_n.channelId&&(_d==="FILE"?_n.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(_h.media_size),10),description:pa(_h.media_description),fileName:pa(_h.media_filename),mediaId:pa(_h.media_id),thumbnail:new Blob([_h.media_thumbnail])},_s,_u):_d==="IMAGE"&&_n.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(_h.media_size),10),description:pa(_h.media_description),fileName:pa(_h.media_filename),mediaId:pa(_h.media_id),thumbnail:new Blob([_h.media_thumbnail]),height:parseInt(pa(_h.media_height),10),width:parseInt(pa(_h.media_width),10),thumbnailHeight:parseInt(pa(_h.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(_h.media_thumbnailwidth),10)},_s,_u))}),m(n(_n),"onChannelRawMessage",function(_i){var _s=_i.desc,_u=_i.raw,_h=_i.memberId,_d=_i.properties;_i.channelId===_n.channelId&&_n.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:_u,description:_s},_h,_d)}),m(n(_n),"onMemberNotice",function(_i){var _s=_i.memberId,_u=_i.type,_h=_i.size;if(_i.channelId===_n.channelId){var _d=_i.instance.toString();_i=_i.seq.toString();var nE={MemberLeft:_n.memberLeftLru,MemberJoined:_n.memberJoinedLru,MemberCountUpdated:void 0}[_u];if(nE){if(nE.has(_d+_i))return void _n.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",_u,_i,oa(_n.channelId),oa(_s||""));if(nE.set(_d+_i,void 0),typeof _s!="string")return;if(_s!==_n.getSession().context.uid&&((_d=_n.memberJoinStateLru.get(_s))===cf.JOINED&&_u==="MemberJoined"||_d===cf.LEFT&&_u==="MemberLeft"))return void _n.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",_u,_i,oa(_n.channelId),oa(_s||""));_n.memberJoinStateLru.set(_s,_u==="MemberJoined"?cf.JOINED:cf.LEFT)}_n.info("Channel %s - %s, memberId: %s",_u,oa(_n.channelId),_u==="MemberCountUpdated"?"[unknown]":oa(_s||"")),_d=_s===_n.getSession().context.uid,_u==="MemberLeft"&&za(_s)||_u==="MemberJoined"&&za(_s)?(_d||_n.emit(_u,_s),_n.onMemberCountUpdated(_h)):_u==="MemberCountUpdated"&&typeof _h=="number"&&_n.onMemberCountUpdated(_h)}}),_n.getSession=cn(j),_n.channelId=_,_n.client=_t,_n.info("A channel created, id %s",oa(_)),_n}la(i,e);var h=ma(i);return Ha(i,[{key:"join",value:function(){var _=J(w.mark(function j(){var _t,Wt,_n,_i,_s,_u,_h;return w.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:if(za(this.channelId)){_d.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:_d.prev=2,_t=this.getSession(),_d.next=9;break;case 6:throw _d.prev=6,_d.t0=_d.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!_t.joinedChannels.has(this)){_d.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:_t.context.uid,elapse:fb(_t.startTime),errCode:Uq,sid:Xa(_t.instanceId)},(Wt=this.client.context.config.enableCloudProxy)!==null&&Wt!==void 0&&Wt),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(_d.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){_d.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:_t.context.uid,elapse:fb(_t.startTime),errCode:Wq,sid:Xa(_t.instanceId)},(_s=this.client.context.config.enableCloudProxy)!==null&&_s!==void 0&&_s),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(_t.joinedChannels.size!==20){_d.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:_t.context.uid,elapse:fb(_t.startTime),errCode:Tq,sid:Xa(_t.instanceId)},(_u=this.client.context.config.enableCloudProxy)!==null&&_u!==void 0&&_u),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:_t.context.uid,elapse:fb(_t.startTime),errCode:0,sid:Xa(_t.instanceId)},(_n=this.client.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n),_d.next=23,_t.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(_t.startTime),errCode:0,sid:Xa(_t.instanceId),serverErrCode:0,userId:_t.context.uid},(_i=this.client.context.config.enableCloudProxy)!==null&&_i!==void 0&&_i),this.info("The channel %s joined successfully",oa(this.channelId)),_t.on("channelTextMessage",this.onChannelTextMessage),_t.on("channelRawMessage",this.onChannelRawMessage),_t.on("channelMediaMessage",this.onChannelMediaMessage),_t.on("memberNotice",this.onMemberNotice),_t.on("channelAttributesUpdated",this.onAttributesUpdated),_d.next=41;break;case 32:if(_d.prev=32,_d.t1=_d.catch(12),this.logError(_d.t1),!sa(_d.t1)){_d.next=37;break}throw _d.t1;case 37:if(!Sa(_d.t1)){_d.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(_t.startTime),errCode:Sq,sid:Xa(_t.instanceId),serverErrCode:0,userId:_t.context.uid},(_h=this.client.context.config.enableCloudProxy)!==null&&_h!==void 0&&_h),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:_d.t1});case 41:case"end":return _d.stop()}},j,this,[[2,6],[12,32]])}));return function(){return _.apply(this,arguments)}}()},{key:"leave",value:function(){var _=J(w.mark(function j(){var _t,Wt,_n,_i;return w.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:_s.prev=0,Wt=this.getSession(),_s.next=7;break;case 4:throw _s.prev=4,_s.t0=_s.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(Wt.joinedChannels.has(this)){_s.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:_s.prev=9,Wt.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,Wt.removeListener("channelTextMessage",this.onChannelTextMessage),Wt.removeListener("channelRawMessage",this.onChannelRawMessage),Wt.removeListener("channelMediaMessage",this.onChannelMediaMessage),Wt.removeListener("memberNotice",this.onMemberNotice),Wt.removeListener("channelAttributesUpdated",this.onAttributesUpdated),_s.next=32;break;case 23:if(_s.prev=23,_s.t1=_s.catch(9),this.logError(_s.t1),!sa(_s.t1)){_s.next=30;break}throw _s.t1.code===void 0&&(_s.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(Wt.startTime),errCode:Yq,sid:Xa(Wt.instanceId),userId:Wt.context.uid},(_i=this.client.context.config.enableCloudProxy)!==null&&_i!==void 0&&_i),_s.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(Wt.startTime),errCode:Xq,sid:Xa(Wt.instanceId),userId:Wt.context.uid},(_n=this.client.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n),new Wc("The channel leave failure",{code:Xq,originalError:_s.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(Wt.startTime),errCode:0,sid:Xa(Wt.instanceId),userId:Wt.context.uid},(_t=this.client.context.config.enableCloudProxy)!==null&&_t!==void 0&&_t);case 33:case"end":return _s.stop()}},j,this,[[0,4],[9,23]])}));return function(){return _.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u,_h=this,_d=arguments;return w.wrap(function(nE){for(;;)switch(nE.prev=nE.next){case 0:Wt=1<_d.length&&_d[1]!==void 0?_d[1]:{},_n=Wt.enableHistoricalMessaging,_i=_n!==void 0&&_n,Tm(_t,Hh),nE.prev=2,_s=this.getSession(),nE.next=9;break;case 6:throw nE.prev=6,nE.t0=nE.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(_s.joinedChannels.has(this)){nE.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){nE.next=16;break}return _u=Date.now(),nE.next=15,new Promise(function(aE,uE){var hE=function(){var sE=J(w.mark(function dE(){var vE;return w.wrap(function(AE){for(;;)switch(AE.prev=AE.next){case 0:return vE=Date.now()-_u,AE.prev=1,AE.next=4,Gg({message:_t,peerId:_h.channelId,toPeer:!1,session:_h.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:vE,logger:_h.logger,options:{enableHistoricalMessaging:_i,enableOfflineMessaging:!1}});case 4:aE(),AE.next=12;break;case 7:AE.prev=7,AE.t0=AE.catch(1),Sa(AE.t0)&&uE(new db(Yd(_h.name,"sendMessageToPeer",1e4),Yk)),sa(AE.t0)&&uE(AE.t0),uE(new da("Channel message send failure",{code:hg,originalError:AE.t0}));case 12:return AE.prev=12,clearTimeout(oE),AE.finish(12);case 15:case"end":return AE.stop()}},dE,null,[[1,7,12,15]])}));return function(){return sE.apply(this,arguments)}}();_h.client.internalEmitter.once("RECONNECTED",hE);var oE=setTimeout(function(){_h.client.internalEmitter.off("RECONNECTED",hE),uE(new db(Yd(_h.name,"sendMessageToPeer",1e4),Yk))},9e3)});case 15:return nE.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){nE.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return nE.prev=18,nE.next=21,Gg({message:_t,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:_i,enableOfflineMessaging:!1}});case 21:nE.next=31;break;case 23:if(nE.prev=23,nE.t1=nE.catch(18),!Sa(nE.t1)){nE.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(nE.t1)){nE.next=30;break}throw this.logError(nE.t1),nE.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return nE.stop()}},j,this,[[2,6],[18,23]])}));return function(j){return _.apply(this,arguments)}}()},{key:"getMembers",value:function(){var _=J(w.mark(function j(){var _t,Wt,_n;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:_i.prev=0,_i.prev=1,_t=this.getSession(),_i.next=8;break;case 5:throw _i.prev=5,_i.t0=_i.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(_t.joinedChannels.has(this)){_i.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return Wt=this.getSession().requestChannelMemberList(this.channelId),_i.next=13,Wt.pipe(ba(function(_s){return _s.memberInfos.map(function(_u){return _u.account})})).toPromise();case 13:return _n=_i.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),_n.map(oa)),_i.abrupt("return",_n);case 18:if(_i.prev=18,_i.t1=_i.catch(0),!sa(_i.t1)){_i.next=23;break}throw this.logError(_i.t1),_i.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return _i.stop()}},j,this,[[0,18],[1,5]])}));return function(){return _.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var _=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some(function(j){return j.channelId===_.channelId})}}]),i}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(e){function i(_,j,_t,Wt){W(this,i);var _n=h.call(this,j,"RtmClient",!0);return m(n(_n),"connectionState",T.DISCONNECTED),m(n(_n),"internalEmitter",new ea),m(n(_n),"context",void 0),m(n(_n),"attributes",{}),m(n(_n),"loginPromise",void 0),m(n(_n),"attributeDrafts",new Set),m(n(_n),"session",void 0),m(n(_n),"lastLoginTime",void 0),m(n(_n),"reconnId",0),m(n(_n),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(_n),"invitationManager",void 0),m(n(_n),"subscribedPeerStatusCache",{}),m(n(_n),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(_n),"peerUnreachableTimers",{}),m(n(_n),"mediaTaskManager",void 0),m(n(_n),"setParameters",void 0),m(n(_n),"updateConfig",void 0),m(n(_n),"userDropHandler",function(_i){if(_n.connectionState!==T.ABORTED)switch(_i){case 11:_n.logError("Kicked off by remote session"),_n.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:_n.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[_i])),_n.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:_n.logError("User kicked off for unknown code: ".concat(_i)),_n.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}}),_n.context=new ZC(_,_t,j),_n.mediaTaskManager=new fs(j),_n.context.config=_t,_n.internalEmitter.setMaxListeners(512),_n.setParameters=Wt.bind(n(_n)),_n.updateConfig=Wt.bind(n(_n)),_n.invitationManager=new nD(function(){return _n.session},j),_n.invitationManager.on("remoteInvitationInstance",function(_i){_n.emit("RemoteInvitationReceived",_i)}),_n}la(i,e);var h=ma(i);return Ha(i,[{key:"renewToken",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s=this;return w.wrap(function(_u){for(;;)switch(_u.prev=_u.next){case 0:if(typeof _t=="string"&&_t.length!==0){_u.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){_u.next=5;break}return _u.next=5,new Promise(function(){});case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){_u.next=7;break}throw new K("The client is not logged in",uA);case 7:if(this.session!==void 0){_u.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _u.prev=9,Wt=this.context.token,this.context.token=_t,_u.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd(function(){return Error("No available edge address to connect")}),oe(function(_h){return _h.pipe(ca(function(_d){if(sa(_d))throw _d}),cd(2500),Ka(4))}),Ka(1),hb(2e4),Ga(function(_h){return Sa(_h)&&_s.warn("renewToken timed out"),Z(_h)})).toPromise();case 14:_n=_u.sent,_i=_n.ticket,_u.next=27;break;case 18:if(_u.prev=18,_u.t0=_u.catch(9),this.context.token=Wt,_u.t0.code!==$q&&_u.t0.code!==ar){_u.next=23;break}throw new Ye("Invalid token",tA);case 23:if(_u.t0.code!==Kh){_u.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(_u.t0)){_u.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter(function(_h){return _h!==void 0}).forEach(function(_h){return _h.ticket=_i});case 28:case"end":return _u.stop()}},j,this,[[9,18]])}));return function(j){return _.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i=this;return w.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(this.connectionState===T.CONNECTED){_s.next=2;break}throw new K("The client is not logged in",pA);case 2:if(this.session!==void 0){_s.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(_t)||_t.length===0||_t.some(function(_u){return!za(_u)})||256<_t.length)){_s.next=6;break}throw new I("invalid arguments",er);case 6:return _s.next=8,this.session.requestPeersOnlineStatus(_t).toPromise();case 8:return Wt=_s.sent,_n=uc(Jk(Wt.userInfos,"account"),function(_u){return!!_u.ts}),Object.keys(_n).forEach(function(_u){if(_u in _i.subscribedPeerStatusCache&&_i.subscribedPeerStatusCache[_u]!==S.PeerOnlineState.UNREACHABLE){var _h=_n[_u]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;_i.emit("PeersOnlineStatusChanged",m({},_u,_h)),_i.subscribedPeerStatusCache[_u]=_h}}),_s.abrupt("return",_n);case 12:case"end":return _s.stop()}},j,this)}));return function(j){return _.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u,_h,_d,nE=this;return w.wrap(function(aE){for(;;)switch(aE.prev=aE.next){case 0:if(this.connectionState===T.CONNECTED){aE.next=2;break}throw new K("The client is not logged in",aA);case 2:if(this.session!==void 0){aE.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(_t)&&_t.every(function(uE){return typeof uE=="string"})&&_t.length!==0){aE.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<_t.length)){aE.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:Wt=0;case 9:if(!(Wt<_t.length)){aE.next=16;break}if(za(_n=_t[Wt])){aE.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",_n],Oq);case 13:Wt++,aE.next=9;break;case 16:return aE.next=18,this.session.requestGetChannelMemberCount(_t).toPromise();case 18:for(_i=aE.sent,_s=_i.groupInfos,_u={},_h=function(uE){var hE=(uE=_s[uE]).group,oE=uE.memberCount;za(hE)&&typeof oE=="number"&&(nE.session.joinedChannels.forEach(function(sE){sE.channelId===hE&&sE.onMemberCountUpdated(oE)}),_u[hE]=oE)},_d=0;_d<_s.length;_d++)_h(_d);return aE.abrupt("return",_u);case 24:case"end":return aE.stop()}},j,this)}));return function(j){return _.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var _=J(w.mark(function j(_t){var Wt,_n;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(uf({attributes:_t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){_i.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){_i.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return Wt=this.session.requestSetLocalUserAttributes(_t).toPromise(),_n={attribute:_t,promise:Wt},this.attributeDrafts.add(_n),_i.prev=8,_i.next=11,Wt;case 11:this.attributes=_t,_i.next=19;break;case 14:if(_i.prev=14,_i.t0=_i.catch(8),!sa(_i.t0)){_i.next=18;break}throw _i.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return _i.prev=19,this.attributeDrafts.delete(_n),_i.finish(19);case 22:case"end":return _i.stop()}},j,this,[[8,14,19,22]])}));return function(j){return _.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var _=J(w.mark(function j(_t,Wt){var _n,_i,_s,_u,_h,_d=arguments;return w.wrap(function(nE){for(;;)switch(nE.prev=nE.next){case 0:if(_n=2<_d.length&&_d[2]!==void 0?_d[2]:{},_i=_n.enableNotificationToChannelMembers,_s=_i!==void 0&&_i,uf({attributes:Wt,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){nE.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){nE.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _u=this.session.requestSetChannelAttributes(_t,Wt,_s).toPromise(),nE.prev=7,nE.next=10,_u;case 10:_h=uc(Wt,function(aE){return new Blob([aE]).size}),this.channelAttributesCacheLru.set(_t,_h),nE.next=19;break;case 14:if(nE.prev=14,nE.t0=nE.catch(7),!sa(nE.t0)){nE.next=18;break}throw nE.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return nE.stop()}},j,this,[[7,14]])}));return function(j,_t){return _.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i;return w.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(Wt=ua(ua({},this.attributes),_t),uf({attributes:_t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:Wt,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){_s.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){_s.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return _n=this.session.requestAddOrUpdateLocalUserAttributes(_t).toPromise(),_i={attribute:Wt,promise:_n},this.attributeDrafts.add(_i),_s.prev=10,_s.next=13,_n;case 13:this.attributes=Wt,_s.next=21;break;case 16:if(_s.prev=16,_s.t0=_s.catch(10),!sa(_s.t0)){_s.next=20;break}throw _s.t0;case 20:throw new I("arguments is not valid",er);case 21:return _s.prev=21,this.attributeDrafts.delete(_i),_s.finish(21);case 24:case"end":return _s.stop()}},j,this,[[10,16,21,24]])}));return function(j){return _.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var _=J(w.mark(function j(_t,Wt){var _n,_i,_s,_u,_h,_d,nE,aE=arguments;return w.wrap(function(uE){for(;;)switch(uE.prev=uE.next){case 0:if(_n=2<aE.length&&aE[2]!==void 0?aE[2]:{},_i=_n.enableNotificationToChannelMembers,_s=_i!==void 0&&_i,_u=this.channelAttributesCacheLru.get(_t,{}),_h=uc(Wt,function(hE){return new Blob([hE]).size}),_d=ua(ua({},_u),_h),uf({attributes:Wt,attrSizeMap:_d,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){uE.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(this.session!==void 0){uE.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return nE=this.session.requestAddOrUpdateChannelAttributes(_t,Wt,_s).toPromise(),uE.prev=10,uE.next=13,nE;case 13:this.channelAttributesCacheLru.set(_t,_d),uE.next=21;break;case 16:if(uE.prev=16,uE.t0=uE.catch(10),!sa(uE.t0)){uE.next=20;break}throw uE.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return uE.stop()}},j,this,[[10,16]])}));return function(j,_t){return _.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s;return w.wrap(function(_u){for(;;)switch(_u.prev=_u.next){case 0:if(Array.isArray(_t)&&_t.length!==0&&!_t.some(function(_h){return _h.length===0})){_u.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){_u.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_u.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return Wt=this.session.requestDeleteLocalUserAttributesByKeys(_t).toPromise(),_n={attribute:Gk(this.attributes,_t),promise:Wt},this.attributeDrafts.add(_n),_u.prev=9,_u.next=12,Wt;case 12:for(_i=0;_i<_t.length;_i++)_s=_t[_i],delete this.attributes[_s];_u.next=20;break;case 15:if(_u.prev=15,_u.t0=_u.catch(9),!sa(_u.t0)){_u.next=19;break}throw _u.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return _u.prev=20,this.attributeDrafts.delete(_n),_u.finish(20);case 23:case"end":return _u.stop()}},j,this,[[9,15,20,23]])}));return function(j){return _.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var _=J(w.mark(function j(_t,Wt){var _n,_i,_s,_u,_h,_d,nE,aE=arguments;return w.wrap(function(uE){for(;;)switch(uE.prev=uE.next){case 0:if(_n=2<aE.length&&aE[2]!==void 0?aE[2]:{},_i=_n.enableNotificationToChannelMembers,_s=_i!==void 0&&_i,Array.isArray(Wt)&&Wt.length!==0&&za(_t)&&!Wt.some(function(hE){return hE.length===0||512<hE.length})){uE.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){uE.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){uE.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return _u=this.session.requestDeleteChannelAttributesByKeys(_t,Wt,_s).toPromise(),uE.prev=8,uE.next=11,_u;case 11:if(_h=this.channelAttributesCacheLru.get(_t))for(_d=0;_d<Wt.length;_d++)nE=Wt[_d],delete _h[nE];uE.next=20;break;case 15:if(uE.prev=15,uE.t0=uE.catch(8),!sa(uE.t0)){uE.next=19;break}throw uE.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return uE.stop()}},j,this,[[8,15]])}));return function(j,_t){return _.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var _=J(w.mark(function j(){var _t,Wt;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(this.connectionState===T.CONNECTED){_n.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){_n.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return _t=this.session.requestClearLocalUserAttributes().toPromise(),Wt={attribute:{},promise:_t},this.attributeDrafts.add(Wt),_n.prev=7,_n.next=10,_t;case 10:this.attributes={},_n.next=18;break;case 13:if(_n.prev=13,_n.t0=_n.catch(7),!sa(_n.t0)){_n.next=17;break}throw _n.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return _n.prev=18,this.attributeDrafts.delete(Wt),_n.finish(18);case 21:case"end":return _n.stop()}},j,this,[[7,13,18,21]])}));return function(){return _.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u=arguments;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(Wt=1<_u.length&&_u[1]!==void 0?_u[1]:{},_n=Wt.enableNotificationToChannelMembers,_i=_n!==void 0&&_n,this.connectionState===T.CONNECTED){_h.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){_h.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return _s=this.session.requestClearChannelAttributes(_t,_i).toPromise(),_h.prev=6,_h.next=9,_s;case 9:this.channelAttributesCacheLru.delete(_t),_h.next=17;break;case 12:if(_h.prev=12,_h.t0=_h.catch(6),!sa(_h.t0)){_h.next=16;break}throw _h.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return _h.stop()}},j,this,[[6,12]])}));return function(j){return _.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i;return w.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(za(_t)){_s.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){_s.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_s.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _s.prev=6,_s.next=9,this.session.requestGetUserAttributeKeys(_t).toPromise();case 9:return Wt=_s.sent,_n=Wt.keys,_s.next=13,this.session.requestGetUserAttributesByKeys(_t,_n.slice(0,512)).toPromise();case 13:_i=_s.sent,_s.next=21;break;case 16:if(_s.prev=16,_s.t0=_s.catch(6),!sa(_s.t0)){_s.next=20;break}throw _s.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return _s.abrupt("return",Yp(_i.attributeInfos.map(function(_u){return[_u.key,_u.value]})));case 22:case"end":return _s.stop()}},j,this,[[6,16]])}));return function(j){return _.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u,_h,_d,nE,aE,uE,hE;return w.wrap(function(oE){for(;;)switch(oE.prev=oE.next){case 0:if(za(_t)){oE.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){oE.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){oE.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return oE.prev=6,oE.next=9,this.session.requestGetChannelAttributesKeys(_t).toPromise();case 9:return Wt=oE.sent,_n=Wt.keys,oE.next=13,this.session.requestGetChannelAttributesByKeys(_t,_n).toPromise();case 13:_i=oE.sent,_s=_i.attributeMaps,oE.next=22;break;case 17:if(oE.prev=17,oE.t0=oE.catch(6),!sa(oE.t0)){oE.next=21;break}throw oE.t0;case 21:throw new I("arguments is not valid",Ja);case 22:_u={},_h=0;case 24:if(!(_h<_s.length)){oE.next=32;break}if(_d=_s[_h],nE=_d.key,aE=_d.ms,uE=_d.value,hE=_d.origin,typeof nE=="string"&&U.isLong(aE)&&typeof uE=="string"&&za(hE)){oE.next=28;break}return oE.abrupt("break",32);case 28:_u[nE]={value:uE,lastUpdateUserId:hE,lastUpdateTs:aE.toNumber()};case 29:_h++,oE.next=24;break;case 32:return this.channelAttributesCacheLru.set(_t,uc(_u,function(sE){return new Blob([sE.value]).size})),oE.abrupt("return",_u);case 34:case"end":return oE.stop()}},j,this,[[6,17]])}));return function(j){return _.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var _=J(w.mark(function j(_t,Wt){var _n,_i,_s,_u,_h,_d,nE,aE,uE,hE;return w.wrap(function(oE){for(;;)switch(oE.prev=oE.next){case 0:if(this.connectionState===T.CONNECTED){oE.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){oE.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(_t,Wt),oE.prev=5,oE.next=8,this.session.requestGetChannelAttributesByKeys(_t,Wt).toPromise();case 8:_n=oE.sent,_i=_n.attributeMaps,oE.next=17;break;case 12:if(oE.prev=12,oE.t0=oE.catch(5),!sa(oE.t0)){oE.next=16;break}throw oE.t0;case 16:throw new I("arguments is not valid",Ja);case 17:_s={},_u=this.channelAttributesCacheLru.get(_t,{}),_h=0;case 20:if(!(_h<_i.length)){oE.next=29;break}if(_d=_i[_h],nE=_d.key,aE=_d.ms,uE=_d.value,hE=_d.origin,typeof nE=="string"&&U.isLong(aE)&&typeof uE=="string"&&za(hE)){oE.next=24;break}return oE.abrupt("break",29);case 24:_u[nE]=new Blob([uE]).size,_s[nE]={value:uE,lastUpdateUserId:hE,lastUpdateTs:aE.toNumber()};case 26:_h++,oE.next=20;break;case 29:return this.channelAttributesCacheLru.set(_t,_u),oE.abrupt("return",_s);case 31:case"end":return oE.stop()}},j,this,[[5,12]])}));return function(j,_t){return _.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var _=J(w.mark(function j(_t,Wt){var _n;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(this.connectionState===T.CONNECTED){_i.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){_i.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(_t,Wt),_i.prev=5,_i.next=8,this.session.requestGetUserAttributesByKeys(_t,Wt).toPromise();case 8:_n=_i.sent,_i.next=16;break;case 11:if(_i.prev=11,_i.t0=_i.catch(5),!sa(_i.t0)){_i.next=15;break}throw _i.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return _i.abrupt("return",Yp(_n.attributeInfos.map(function(_s){return[_s.key,_s.value]})));case 17:case"end":return _i.stop()}},j,this,[[5,11]])}));return function(j,_t){return _.apply(this,arguments)}}()},{key:"login",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u=this;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(Uk=!0,Wt=Bg(),_n=_t.token,_t.token===this.context.appId&&(_n=void 0),setTimeout(function(){var _d;eb("Session",{appId:_u.context.appId,did:navigator.userAgent,elapse:fb(_u.session&&_u.session.startTime),index:{index1:_t.uid,index2:_u.context.appId,index3:"enableLogUpload=".concat(_u.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(Wt),token:_n||"",userId:_t.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},(_d=_u.context.config.enableCloudProxy)!==null&&_d!==void 0&&_d)},1e4),yd(_t)&&za(_t.uid)){_h.next=7;break}throw new I("not a valid user id",Jh);case 7:if(typeof _n!="string"||!_n){_h.next=11;break}this.context.token=_n,_h.next=13;break;case 11:if(typeof _n=="string"||_n==null){_h.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return _i=Date.now(),this.context.sid=Xa(Wt),this.loginPromise=this.loginImpl({uid:_t.uid,instanceId:Wt}),this.info("RTM Client logging in as ".concat(oa(_t.uid))),_h.prev=17,_h.next=20,this.loginPromise;case 20:_h.next=27;break;case 22:throw _h.prev=22,_h.t0=_h.catch(17),sa(_h.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:_h.t0.code||1,sc:_h.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-_i,sid:Xa(Wt),userId:_t.uid},(_s=this.context.config.enableCloudProxy)!==null&&_s!==void 0&&_s),this.context.token=void 0,_h.t0;case 27:return _h.prev=27,this.loginPromise=void 0,_h.finish(27);case 30:Uk=!1;case 31:case"end":return _h.stop()}},j,this,[[17,22,27,30]])}));return function(j){return _.apply(this,arguments)}}()},{key:"logout",value:function(){var _=J(w.mark(function j(){var _t;return w.wrap(function(Wt){for(;;)switch(Wt.prev=Wt.next){case 0:if(!this.loginPromise){Wt.next=3;break}return Wt.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){Wt.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){Wt.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),Wt.abrupt("return");case 10:if(this.session!==void 0){Wt.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),Wt.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(_t=this.context.config.enableCloudProxy)!==null&&_t!==void 0&&_t),Wt.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return Wt.stop()}},j,this)}));return function(){return _.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var _,j=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(_=this.context.config.enableCloudProxy)!==null&&_!==void 0&&_),this.session.logoutHandler().then(function(){j.log("Log out success")})),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var _=J(w.mark(function j(_t,Wt){var _n,_i,_s,_u,_h,_d,nE=this,aE=arguments;return w.wrap(function(uE){for(;;)switch(uE.prev=uE.next){case 0:if(_n=2<aE.length&&aE[2]!==void 0?aE[2]:{},_i=_n.enableOfflineMessaging,_s=_i!==void 0&&_i,_u=_n.enableHistoricalMessaging,_h=_u!==void 0&&_u,Tm(_t,ve),this.connectionState!==T.RECONNECTING){uE.next=5;break}return _d=Date.now(),uE.abrupt("return",new Promise(function(hE,oE){var sE=function(){var vE=J(w.mark(function AE(){var PE;return w.wrap(function(IE){for(;;)switch(IE.prev=IE.next){case 0:if(nE.session!==void 0){IE.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return PE=Date.now()-_d,IE.prev=3,IE.t0=hE,IE.next=7,Gg({message:_t,peerId:Wt,toPeer:!0,session:nE.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:PE,logger:nE.logger,options:{enableHistoricalMessaging:_h,enableOfflineMessaging:_s}});case 7:IE.t1=IE.sent,(0,IE.t0)(IE.t1),IE.next=16;break;case 11:IE.prev=11,IE.t2=IE.catch(3),Sa(IE.t2)&&oE(new db(Yd(nE.name,"sendMessageToPeer",1e4),Zk)),sa(IE.t2)&&oE(IE.t2),oE(new da("Peer-to-peer message send failure",{code:cr,originalError:IE.t2}));case 16:return IE.prev=16,clearTimeout(dE),IE.finish(16);case 19:case"end":return IE.stop()}},AE,null,[[3,11,16,19]])}));return function(){return vE.apply(this,arguments)}}();nE.internalEmitter.once("RECONNECTED",sE);var dE=setTimeout(function(){nE.internalEmitter.off("RECONNECTED",sE),oE(new db(Yd(nE.name,"sendMessageToPeer",1e4),Zk))},9e3)}));case 5:if(this.connectionState===T.CONNECTED){uE.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(this.session!==void 0){uE.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return uE.prev=9,uE.next=12,Gg({message:_t,peerId:Wt,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:_h,enableOfflineMessaging:_s}});case 12:return uE.abrupt("return",uE.sent);case 15:if(uE.prev=15,uE.t0=uE.catch(9),!Sa(uE.t0)){uE.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(uE.t0)){uE.next=21;break}throw uE.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:uE.t0});case 22:case"end":return uE.stop()}},j,this,[[9,15]])}));return function(j,_t){return _.apply(this,arguments)}}()},{key:"createChannel",value:function(_){var j=this;if(!za(_))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:_})[0]],Zz);return new pD(_,function(){return j.session},this,this.logger)}},{key:"createLocalInvitation",value:function(_){if(!za(_))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:_})[0]],xc);return this.invitationManager.genLocalInvitation(_)}},{key:"subscribePeersOnlineStatus",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u,_h,_d,nE,aE,uE,hE,oE,sE,dE=this;return w.wrap(function(vE){for(;;)switch(vE.prev=vE.next){case 0:if(this.connectionState===T.CONNECTED){vE.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){vE.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(_t)&&_t.length!==0){vE.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:Wt=0;case 7:if(!(Wt<_t.length)){vE.next=14;break}if(za(_n=_t[Wt])){vE.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",_n],kg);case 11:Wt++,vE.next=7;break;case 14:if(!(512<(_i=_t&&_t.length?vk(_t):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){vE.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return vE.next=19,this.session.requestSubscribePeersOnlineStatus(_i).toPromise();case 19:_s=vE.sent,_u=_s.errors,_h=[],_d=[],nE=0;case 24:if(!(nE<_u.length)){vE.next=32;break}if(aE=_u[nE],uE=aE.code,typeof(hE=aE.account)=="string"){vE.next=28;break}throw new da("Returned account is invalid",fr);case 28:uE!==0&&_h.push(hE);case 29:nE++,vE.next=24;break;case 32:for(oE=0;oE<_i.length;oE++)sE=_i[oE],_h.includes(sE)||(_d.push(sE),this.subscribedPeerStatusCache[sE]=void 0);if(this.session.requestPeersOnlineStatus(_d).pipe(ba(function(AE){return uc(Jk(AE.userInfos,"account"),function(PE){return!!PE.ts})})).subscribe(function(AE){AE=uc(AE,function(PE,IE){return PE=PE?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,dE.subscribedPeerStatusCache[IE]=PE}),dE.emit("PeersOnlineStatusChanged",AE)}),_h.length===0){vE.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return vE.stop()}},j,this)}));return function(j){return _.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(this.connectionState===T.CONNECTED){_h.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){_h.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(_t)&&_t.length!==0){_h.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:Wt=0;case 7:if(!(Wt<_t.length)){_h.next=14;break}if(za(_n=_t[Wt])){_h.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",_n],kg);case 11:Wt++,_h.next=7;break;case 14:if(!(512<_t.length)){_h.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(_i=_t&&_t.length?vk(_t):[],this.session.requestUnsubscribePeersOnlineStatus(_i),_s=0;_s<_i.length;_s++)_u=_i[_s],delete this.subscribedPeerStatusCache[_u];case 19:case"end":return _h.stop()}},j,this)}));return function(j){return _.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var _=J(w.mark(function j(_t){return w.wrap(function(Wt){for(;;)switch(Wt.prev=Wt.next){case 0:if(this.connectionState===T.CONNECTED){Wt.next=2;break}throw new K("The client is not logged in",bl);case 2:if(_t!==S.PeerSubscriptionOption.ONLINE_STATUS){Wt.next=4;break}return Wt.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return Wt.stop()}},j,this)}));return function(j){return _.apply(this,arguments)}}()},{key:"createMessage",value:function(_){return _.messageType==="IMAGE"?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},_):_.messageType==="FILE"?ua({fileName:"",description:"",thumbnail:new Blob,size:0},_):_}},{key:"downloadMedia",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u,_h,_d,nE,aE,uE,hE,oE,sE,dE,vE=this,AE=arguments;return w.wrap(function(PE){for(;;)switch(PE.prev=PE.next){case 0:if(Wt=1<AE.length&&AE[1]!==void 0?AE[1]:{},typeof _t=="string"){PE.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(PE.prev=3,_n=_t.split("z"),_i=ra(_n,3),_s=_i[0],_u=_i[1],_h=_i[2],_d=_s.slice(1,65),nE=bD(_d),aE=parseInt(_s.slice(65),10),uE=parseInt(_u,10),hE=parseInt(_h,10),!(Number.isNaN(aE)||Number.isNaN(uE)||Number.isNaN(hE))){PE.next=12;break}throw new I("Invalid mediaId content",cl);case 12:PE.next=19;break;case 14:if(PE.prev=14,PE.t0=PE.catch(3),!sa(PE.t0)){PE.next=18;break}throw PE.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:PE.t0});case 19:if(this.connectionState===T.CONNECTED){PE.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(this.session!==void 0){PE.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return oE=this.mediaTaskManager.addDownloadTask({unit:uE,zone:aE,hashHexStr:_d,size:hE},function(){if(vE.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return vE.session.requestFileDownloadIndexGet({hash:nE,zone:aE,unit:uE,size:hE}).toPromise()},Wt),PE.next=26,this.mediaTaskManager.waitMediaTask(oE);case 26:return sE=PE.sent,dE=sE.payload,PE.abrupt("return",dE);case 29:case"end":return PE.stop()}},j,this,[[3,14]])}));return function(j){return _.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u,_h,_d,nE,aE,uE,hE,oE,sE,dE,vE,AE,PE,IE,QE,m_,yE,FE,UE,qE,gE=this,RE=arguments;return w.wrap(function(OE){for(;;)switch(OE.prev=OE.next){case 0:if(Wt=1<RE.length&&RE[1]!==void 0?RE[1]:{},_n=2<RE.length&&RE[2]!==void 0?RE[2]:{},yd(Wt)){OE.next=4;break}throw new I("Invalid params",wf);case 4:if(_i="thumbnailWidth"in Wt||"thumbnailHeight"in Wt||"width"in Wt||"height"in Wt,_s=Wt.messageType,_u=_s===void 0?_i?"IMAGE":"FILE":_s,_h=Wt.description,_d=_h===void 0?"":_h,nE=Wt.fileName,aE=nE===void 0?"":nE,uE=Wt.thumbnail,typeof Wt.messageType=="string"&&typeof _d=="string"&&typeof aE=="string"&&(Pm(uE)||uE===void 0)&&Pm(_t)){OE.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!_i||_u!=="FILE"){OE.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(hE=_t.size))){OE.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return OE.next=15,Ji(_t);case 15:return oE=OE.sent,OE.next=18,aD(oE);case 18:if(sE=OE.sent,this.connectionState===T.CONNECTED){OE.next=21;break}throw new K("The client is not logged in",yA);case 21:if(_u!=="IMAGE"){OE.next=29;break}return OE.next=24,Xt(Wt,oE);case 24:dE=OE.sent,vE=dE.height,AE=dE.width,PE=dE.thumbnailWidth,IE=dE.thumbnailHeight;case 29:return QE=this.mediaTaskManager.addUploadTask({file:new Uint8Array(oE),hash:sE},function(){if(gE.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return gE.session.fetchFileUploadIndexGet({hash:sE,size:hE})},function(HE,CE){if(gE.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return gE.session.requestFileUploadIndexSet({hash:sE,unit:HE,servers:CE}).toPromise()},_n),OE.next=32,this.mediaTaskManager.waitMediaTask(QE);case 32:if(m_=OE.sent,yE=m_.zone,FE=m_.retUnit,_u!=="IMAGE"){OE.next=38;break}return UE={height:vE,width:AE,fileName:aE,size:hE,description:_d,thumbnail:uE,messageType:_u,thumbnailWidth:PE,thumbnailHeight:IE,mediaId:"0".concat($r(sE)).concat(yE,"z").concat(FE,"z").concat(hE,"z").concat(vE,"z").concat(AE)},OE.abrupt("return",UE);case 38:return qE={fileName:aE,size:hE,description:_d,mediaId:"0".concat($r(sE)).concat(yE,"z").concat(FE,"z").concat(hE),thumbnail:uE,messageType:_u},OE.abrupt("return",qE);case 40:case"end":return OE.stop()}},j,this)}));return function(j){return _.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var _=J(w.mark(function j(_t){var Wt,_n,_i,_s,_u=this;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(Wt=_t.uid,_n=_t.instanceId,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){_h.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){_h.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:_h.prev=6,this.context.uid=Wt,_h.next=13;break;case 10:throw _h.prev=10,_h.t0=_h.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:Wt})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=_i=new ls(this.context,new Yr(this.context,this.logger,!1),_n,this.logger),_s=function(){_u.connectionState===T.CONNECTED&&(_u.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),_u.session)&&_u.session.once("userJoined",function(){_u.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)})},_i.on("connectionLost",_s),_i.on("tokenExpired",function(){_u.emit("TokenExpired")}),_i.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(_d){_u.emit("MessageFromPeer",{text:_d.text,messageType:S.MessageType.TEXT},_d.peerId,_d.properties)}),this.session.on("peerMediaMessage",function(_d){var nE=_d.peerId,aE=_d.properties,uE=_d.messageType;_d=_d.details,uE==="FILE"?_u.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(_d.media_size),10),description:pa(_d.media_description),fileName:pa(_d.media_filename),mediaId:pa(_d.media_id),thumbnail:new Blob([_d.media_thumbnail])},nE,aE):uE==="IMAGE"&&_u.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(_d.media_size),10),description:pa(_d.media_description),fileName:pa(_d.media_filename),mediaId:pa(_d.media_id),thumbnail:new Blob([_d.media_thumbnail]),height:parseInt(pa(_d.media_height),10),width:parseInt(pa(_d.media_width),10),thumbnailHeight:parseInt(pa(_d.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(_d.media_thumbnailwidth),10)},nE,aE)}),this.session.on("peerRawMessage",function(_d){_u.emit("MessageFromPeer",{rawMessage:_d.raw,description:_d.desc,messageType:S.MessageType.RAW},_d.peerId,_d.properties)}),_i.on("instanceChanged",function(_d){return _n=_d}),_i.on("peerOnlineStatusChanged",function(_d){var nE=_d.instance.toString()+_d.state,aE=_u.peerStatusSeqLru.get(nE);!aE||_d.seq.greaterThan(aE)?(_u.peerStatusSeqLru.set(nE,_d.seq),_d.state!==_u.subscribedPeerStatusCache[_d.peerId]&&_u.emit("PeersOnlineStatusChanged",m({},_d.peerId,_d.state)),_u.subscribedPeerStatusCache[_d.peerId]=_d.state,clearTimeout(_u.peerUnreachableTimers[nE]),_d.state===S.PeerOnlineState.UNREACHABLE&&(_u.peerUnreachableTimers[nE]=setTimeout(function(){_u.subscribedPeerStatusCache[_d.peerId]===S.PeerOnlineState.UNREACHABLE&&(_u.subscribedPeerStatusCache[_d.peerId]=S.PeerOnlineState.ONLINE,_u.emit("PeersOnlineStatusChanged",m({},_d.peerId,S.PeerOnlineState.ONLINE)))},3e4))):_u.log("peerOnlineStatusChanged dedup for %s, %d",nE,_d.seq.toNumber())}),_i.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),_i.on("channelAttributesUpdated",function(_d){var nE=_d.channelId;_d=_d.attributeMaps;for(var aE={},uE=0;uE<_d.length;uE++){var hE=_d[uE],oE=hE.key,sE=hE.ms,dE=hE.value;if(hE=hE.origin,typeof oE!="string"||!U.isLong(sE)||typeof dE!="string"||!za(hE))break;aE[oE]=new Blob([dE]).size}_u.channelAttributesCacheLru.set(nE,aE)}),_i.on("userJoined",function(_d){if(Object.keys(_u.attributes).length!==0){if(_u.session===void 0)return;_u.session.requestSetLocalUserAttributes(_u.attributes,_d).toPromise()}if(_u.attributeDrafts.size!==0)for(var nE=function(hE,oE){var sE=(hE=oE[hE]).attribute;hE.promise.then(function(){_u.session!==void 0&&_u.session.requestSetLocalUserAttributes(sE,_d).toPromise()})},aE=0,uE=Array.from(_u.attributeDrafts);aE<uE.length;aE++)nE(aE,uE);Object.keys(_u.subscribedPeerStatusCache).length!==0&&_i.requestSubscribePeersOnlineStatus(Object.keys(_u.subscribedPeerStatusCache))}),this.lastLoginTime=Date.now(),_h.prev=29,_h.next=32,_i.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:_i.connection.curOpenSockets.filter(function(_d){return _d!==void 0})[0].ticket,instance:_i.instanceId,useNewDomain:.5<=Math.random(),loginOpt:_i.userJoinOptions.toLong()}),_h.next=44;break;case 35:if(_h.prev=35,_h.t1=_h.catch(29),!Sa(_h.t1)){_h.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(_h.t1)){_h.next=43;break}throw _h.t1;case 43:throw new da("Login failure",{code:Zq,originalError:_h.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return _h.stop()}},j,this,[[6,10],[29,35]])}));return function(j){return _.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(_,j){var _t,Wt=this;_===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[_],oldState:os[this.connectionState],reason:qD[j],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(_t=this.context.config.enableCloudProxy)!==null&&_t!==void 0&&_t),this.connectionState===T.RECONNECTING&&_===T.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba(function(_n){return uc(Jk(_n.userInfos,"account"),function(_i){return!!_i.ts})})).subscribe(function(_n){_n=uc(_n,function(_i,_s){return _i=_i?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,Wt.subscribedPeerStatusCache[_s]=_i}),Wt.emit("PeersOnlineStatusChanged",_n)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=_,_!==T.ABORTED&&_!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",_),this.emit("ConnectionStateChanged",_,j)}}]),i}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(e){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},h=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new I(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],Nq);var _=Object.keys(i).filter(function(_u){return!(_u in qs)});if(_.length!==0)throw new I("Invalid RTM config: ".concat(_.join(", ")),Nq);var j=ua(ua({},qs),i);if(h!==void 0&&(!Array.isArray(h)||h.length===0))throw new I("Invalid area config");if(h!=null){if(!h.every(function(_u){return _u in S.LegacyAreaCode}))throw new I("Invalid area codes: ".concat(h.filter(function(_u){return!(_u in S)}).join(", ")));M=xe(h.map(function(_u){return zC[_u]}))}h=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var _t=DC(j);_=EC(j);var Wt=FC(j),_n=GC(h,j),_i=Tr(h,j),_s=_i("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=j,_t("The Agora RTM Web SDK version is %s","1.4.3-203"),i.enableCloudProxy&&_t("RTM cloud proxy enabled"),i.enableLogUpload&&_t("Log upload enabled"),M&&_s("Area is set to %s",Array.from(M.CODES).map(function(_u){return xf(F).find(function(_h){return F[_h]===_u})}).join(", ")),_s("Creating an RtmClient instance"),_s('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),_s("The App ID is %s",Um(e,4,10,"*".repeat(6))),_t("The process ID is %s",gg),_s("The build is %s","v1.4.3-17-g1e27aa38"),_s("NODE_ENV is %s","production"),new rD(e,{genLogger:_i,genTracker:_n,info:_t,warn:_,logError:Wt,loggerId:h},j,function(_u){for(var _h=0,_d=xf(_u);_h<_d.length;_h++){var nE=_d[_h];try{var aE=_u[nE];aE!=null&&(_u.enableCloudProxy&&_t("RTM cloud proxy enabled"),_u.enableLogUpload&&_t("Log upload enabled"),j[nE]=aE)}catch{throw new I(["The %s in the arguments is invalid",nE],void 0)}}})},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(e,i){Object.keys(Nc).includes(e)&&(Nc[e]=i)},getParameter:function(e){return Nc[e]},setArea:function(e){var i=e.areaCodes;if(e=e.excludedArea,!Array.isArray(i)||i.length===0||!i.every(function(h){return h in S.AreaCode}))throw new I("Invalid area config");if(e!==void 0&&e===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(e===void 0)M=xe(i.map(function(h){return F[h]}));else{if(i.includes(e))throw new I("Excluded area cannot be in areaCodes");if(!(e in F))throw new I("Invalid excludedArea:",e);M=bu({areas:i.map(function(h){return F[h]}),excludedArea:F[e]})}}});return Zd})})(agoraRtmSdk,agoraRtmSdk.exports);var agoraRtmSdkExports=agoraRtmSdk.exports;const AgoraRTM__default=getDefaultExportFromCjs(agoraRtmSdkExports);var createLazyClient=function e(){var i;function h(_,j,_t){return i||(i=AgoraRTM__default.createInstance(_,j,_t)),i}return function(_,j,_t){return h(_,j,_t)}},createLazyChannel=function e(){var i;function h(_,j){return i||(i=_.createChannel(j)),i}return function(_,j){return h(_,j)}},AreaCode;(function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"})(AreaCode||(AreaCode={}));function _extends(){return _extends=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var h=arguments[i];for(var _ in h)Object.prototype.hasOwnProperty.call(h,_)&&(e[_]=h[_])}return e},_extends.apply(this,arguments)}typeof Symbol<"u"&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")));typeof Symbol<"u"&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function _catch(e,i){try{var h=e()}catch(_){return i(_)}return h&&h.then?h.then(void 0,i):h}var RtcContext=React.createContext({}),RtcProvider=RtcContext.Provider;RtcContext.Consumer;var remoteTrackState;(function(e){e[e.yes=0]="yes",e[e.subbed=1]="subbed",e[e.no=2]="no"})(remoteTrackState||(remoteTrackState={}));var layout;(function(e){e[e.grid=0]="grid",e[e.pin=1]="pin"})(layout||(layout={}));var ToggleState;(function(e){e[e.disabled=0]="disabled",e[e.enabled=1]="enabled",e[e.disabling=2]="disabling",e[e.enabling=3]="enabling"})(ToggleState||(ToggleState={}));var initialValue={rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}},PropsContext=React.createContext(initialValue),PropsProvider=PropsContext.Provider,MaxUidContext=React.createContext([]),MaxUidProvider=MaxUidContext.Provider,MaxUidConsumer=MaxUidContext.Consumer,MinUidContext=React.createContext([]),MinUidProvider=MinUidContext.Provider,MinUidConsumer=MinUidContext.Consumer,TracksContext=React.createContext({}),TracksProvider=TracksContext.Provider,initState={max:[{uid:0,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}],min:[],isScreensharing:!1},reducer=function e(i,h){var _=initState,j=[].concat(i.max,i.min).map(function(_s){return _s.uid});switch(h.type){case"Screensharing":_=_extends({},i,{isScreensharing:h.value[0]}),console.log("!Screensharingstate",i,_);break;case"update-user-video":_={min:i.min.map(function(_s){return _s.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:_s}),max:i.max.map(function(_s){return _s.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:_s}),isScreensharing:i.isScreensharing};break;case"user-joined":if(j.indexOf(h.value[0].uid)===-1){var _t=[].concat(i.min,[{uid:h.value[0].uid,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}]);_t.length===1&&i.max[0].uid===0?_={max:_t,min:i.max,isScreensharing:i.isScreensharing}:_={min:_t,max:i.max,isScreensharing:i.isScreensharing}}break;case"user-unpublished":if(i.max[0].uid===h.value[0].uid)_={max:[{uid:h.value[0].uid,hasAudio:h.value[1]==="audio"?remoteTrackState.no:i.max[0].hasAudio,hasVideo:h.value[1]==="video"?remoteTrackState.no:i.max[0].hasVideo}],min:i.min,isScreensharing:i.isScreensharing};else{var Wt=i.min.find(function(_s){return _s.uid===h.value[0].uid});if(Wt){var _n=[].concat(i.min.filter(function(_s){return _s.uid!==h.value[0].uid}),[{uid:h.value[0].uid,hasAudio:h.value[1]==="audio"?remoteTrackState.no:Wt.hasAudio,hasVideo:h.value[1]==="video"?remoteTrackState.no:Wt.hasVideo}]);_={min:_n,max:i.max,isScreensharing:i.isScreensharing}}}break;case"user-published":i.max[0].uid===h.value[0].uid?_={max:[{uid:h.value[0].uid,hasAudio:h.value[1]==="audio"?remoteTrackState.subbed:i.max[0].hasAudio,hasVideo:h.value[1]==="video"?remoteTrackState.subbed:i.max[0].hasVideo}],min:i.min,isScreensharing:i.isScreensharing}:_={min:i.min.map(function(_s){return _s.uid!==h.value[0].uid?_s:{uid:_s.uid,hasAudio:h.value[1]==="audio"?remoteTrackState.subbed:_s.hasAudio,hasVideo:h.value[1]==="video"?remoteTrackState.subbed:_s.hasVideo}}),max:i.max,isScreensharing:i.isScreensharing};break;case"user-left":if(i.max[0].uid===h.value[0].uid){var _i=[].concat(i.min);_={max:[_i.pop()],min:_i,isScreensharing:i.isScreensharing}}else _={min:i.min.filter(function(_s){return _s.uid!==h.value[0].uid}),max:i.max,isScreensharing:i.isScreensharing};break;case"user-swap":i.max[0].uid===h.value[0].uid||(_={max:[h.value[0]],min:[].concat(i.min.filter(function(_s){return _s.uid!==h.value[0].uid}),[i.max[0]]),isScreensharing:i.isScreensharing});break;case"local-user-mute-video":_={min:i.min.map(function(_s){return _s.uid===0?{uid:0,hasAudio:_s.hasAudio,hasVideo:h.value[0]}:_s}),max:i.max.map(function(_s){return _s.uid===0?{uid:0,hasAudio:_s.hasAudio,hasVideo:h.value[0]}:_s}),isScreensharing:i.isScreensharing};break;case"local-user-mute-audio":_={min:i.min.map(function(_s){return _s.uid===0?{uid:0,hasAudio:h.value[0],hasVideo:_s.hasVideo}:_s}),max:i.max.map(function(_s){return _s.uid===0?{uid:0,hasAudio:h.value[0],hasVideo:_s.hasVideo}:_s}),isScreensharing:i.isScreensharing};break;case"remote-user-mute-video":_={min:i.min.map(function(_s){return _s.uid===h.value[0].uid?{uid:_s.uid,hasVideo:h.value[1],hasAudio:_s.hasAudio}:_s}),max:i.max.map(function(_s){return _s.uid===h.value[0].uid?{uid:_s.uid,hasVideo:h.value[1],hasAudio:_s.hasAudio}:_s}),isScreensharing:i.isScreensharing};break;case"remote-user-mute-audio":_={min:i.min.map(function(_s){return _s.uid===h.value[0].uid?{uid:_s.uid,hasAudio:h.value[1],hasVideo:_s.hasVideo}:_s}),max:i.max.map(function(_s){return _s.uid===h.value[0].uid?{uid:_s.uid,hasAudio:h.value[1],hasVideo:_s.hasVideo}:_s}),isScreensharing:i.isScreensharing};break;case"leave-channel":_=initState;break;case"ActiveSpeaker":i.max[0].uid===h.value[0]?_=_extends({},i):_={max:[i.min.find(function(_s){return _s.uid===h.value[0]})],min:[].concat(i.min.filter(function(_s){return _s.uid!==h.value[0]}),[i.max[0]]),isScreensharing:i.isScreensharing};break}return console.log("!state-update",_extends({},i,_),_),_extends({},i,_)},startScreenshare=function e(i,h,_,j,_t,Wt,_n){try{var _i=function(){try{try{console.log(_h),Wt&&(_h.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(Wt+"/rtc/"+h+"/publisher/uid/"+nE+"/")).then(function(oE){return Promise.resolve(oE.json()).then(function(sE){var dE=sE.rtcToken;_h.renewToken(dE)})})}catch(oE){return Promise.reject(oE)}}),_h.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(Wt+"/rtc/"+h+"/publisher/uid/"+nE+"/")).then(function(oE){return Promise.resolve(oE.json()).then(function(sE){var dE=sE.rtcToken;_h.renewToken(dE)})})}catch(oE){return Promise.reject(oE)}})),_.on("track-ended",function(){_h.leave(),_h.removeAllListeners()})}catch(oE){console.log(oE)}return Promise.resolve()}catch(oE){return Promise.reject(oE)}},_s=function(){try{_h.setClientRole("host");var oE=function(){if(Wt){var sE=_catch(function(){return Promise.resolve(fetch(Wt+"/rtc/"+h+"/publisher/uid/"+nE+"/")).then(function(dE){return Promise.resolve(dE.json()).then(function(vE){var AE=vE.rtcToken;return Promise.resolve(_h.join(i,h,AE,nE)).then(function(PE){_d=PE})})})},function(dE){console.log(dE)});if(sE&&sE.then)return sE.then(function(){})}else return Promise.resolve(_h.join(i,h,j||null,nE||0)).then(function(dE){_d=dE})}();return Promise.resolve(oE&&oE.then?oE.then(function(){}):void 0)}catch(sE){return Promise.reject(sE)}},_u=function(){try{var oE=function(){var vE=function(){if(_.enabled){var AE=function(){if(!aE)return Promise.resolve(_h.publish([_]).then(function(){aE=!0})).then(function(){})}();if(AE&&AE.then)return AE.then(function(){})}}();if(vE&&vE.then)return vE.then(function(){})},sE=function(){if(_n)return Promise.resolve(_h.enableDualStream()).then(function(){})}();return Promise.resolve(sE&&sE.then?sE.then(oE):oE(sE))}catch(dE){return Promise.reject(dE)}},_h=AgoraRTC__default.createClient({mode:"live",role:"host",codec:"vp8"}),_d=0,nE=_t||1,aE=!1,uE=function(){try{var oE=_catch(function(){return _.close(),Promise.resolve(_h.leave()).then(function(){_h.removeAllListeners()})},function(sE){console.log(sE)});return Promise.resolve(oE&&oE.then?oE.then(function(){}):void 0)}catch(sE){return Promise.reject(sE)}};return stopScreenshare=uE,Promise.resolve(_i()).then(function(){return Promise.resolve(_s()).then(function(){return Promise.resolve(_u()).then(function(){_d&&console.log(_d)})})})}catch(hE){return Promise.reject(hE)}},stopScreenshare=function e(){},useClient=createClient({codec:"vp8",mode:"live"}),RtcConfigure=function e(i){var h=reactExports.useRef(),_=reactExports.useRef(),j=reactExports.useRef(!1),_t=reactExports.useContext(TracksContext),Wt=_t.localVideoTrack,_n=_t.localAudioTrack,_i=reactExports.useContext(PropsContext),_s=_i.callbacks,_u=_i.rtcProps,_h=reactExports.useState(!1),_d=_h[0],nE=_h[1],aE=reactExports.useState(!1),uE=aE[0],hE=aE[1],oE=null,sE=reactExports.useRef(new Promise(function(UE,qE){oE=UE,console.log(qE)})),dE=useClient();_u.customRtcClient&&(dE.removeAllListeners(),dE=_u.customRtcClient);var vE=!1,AE=!1,PE=reactExports.useRef({}),IE=i.callActive;IE===void 0&&(IE=!0);var QE=reactExports.useReducer(reducer,initState),m_=QE[0],yE=QE[1];reactExports.useEffect(function(){var UE=function(){try{try{if(console.log(dE),dE.on("user-joined",function(){try{for(var CE=arguments.length,jE=new Array(CE),LE=0;LE<CE;LE++)jE[LE]=arguments[LE];var i_=jE[0];return i_.uid===i.screenshareUid&&j.current||i_.uid===1&&j.current||(PE.current[i_.uid]={}),yE({type:"user-joined",value:jE}),Promise.resolve()}catch(o_){return Promise.reject(o_)}}),dE.on("user-published",function(){for(var CE=arguments.length,jE=new Array(CE),LE=0;LE<CE;LE++)jE[LE]=arguments[LE];try{var i_=jE[0],o_=jE[1];return console.log("user-published",i_.uid),i_.uid===i.screenshareUid&&j.current||i_.uid===1&&j.current?yE({type:"user-published",value:jE}):dE.subscribe(i_,o_).then(function(w_){if(PE.current[i_.uid][o_+"Track"]=i_[o_+"Track"],o_==="audio"){var _y;(_y=i_.audioTrack)===null||_y===void 0||_y.play()}else _u.enableDualStream&&_u.dualStreamMode&&dE.setStreamFallbackOption(i_.uid,_u.dualStreamMode);yE({type:"user-published",value:jE})}).catch(function(w_){return console.log(w_)}),Promise.resolve()}catch(w_){return Promise.reject(w_)}}),dE.on("user-unpublished",function(){try{for(var CE=arguments.length,jE=new Array(CE),LE=0;LE<CE;LE++)jE[LE]=arguments[LE];var i_=jE[0],o_=jE[1];if(console.log("user-unpublished",i_.uid),o_==="audio"){var w_;(w_=i_.audioTrack)===null||w_===void 0||w_.stop()}return yE({type:"user-unpublished",value:jE}),Promise.resolve()}catch(_y){return Promise.reject(_y)}}),dE.on("connection-state-change",function(){try{for(var CE=arguments.length,jE=new Array(CE),LE=0;LE<CE;LE++)jE[LE]=arguments[LE];var i_=jE[0],o_=jE[1],w_=jE[2];if(console.log("connection",o_,i_,w_),i_==="CONNECTED")hE(!0);else if(i_==="DISCONNECTED"){try{stopScreenshare(),j.current=!1}catch(_y){console.log("stopscreenshare",_y)}yE({type:"leave-channel",value:null})}else hE(!1);return Promise.resolve()}catch(_y){return Promise.reject(_y)}}),dE.on("user-left",function(){for(var CE=arguments.length,jE=new Array(CE),LE=0;LE<CE;LE++)jE[LE]=arguments[LE];yE({type:"user-left",value:jE})}),_u.tokenUrl){var gE=_u.tokenUrl,RE=_u.channel,OE=_u.uid;dE.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(gE+"/rtc/"+RE+"/publisher/uid/"+(OE||0)+"/")).then(function(CE){return Promise.resolve(CE.json()).then(function(jE){var LE=jE.rtcToken;dE.renewToken(LE)})})}catch(CE){return Promise.reject(CE)}}),dE.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(gE+"/rtc/"+RE+"/publisher/uid/"+(OE||0)+"/")).then(function(CE){return Promise.resolve(CE.json()).then(function(jE){var LE=jE.rtcToken;dE.renewToken(LE)})})}catch(CE){return Promise.reject(CE)}})}if(_s){var HE=Object.keys(_s);HE.map(function(CE){try{dE.on(CE,function(){for(var jE=arguments.length,LE=new Array(jE),i_=0;i_<jE;i_++)LE[i_]=arguments[i_];_s[CE].apply(null,LE)})}catch(jE){console.log(jE)}})}oE(!0),nE(!0)}catch(CE){console.log("!!!",CE)}return Promise.resolve()}catch(CE){return Promise.reject(CE)}};return oE?(UE(),function(){try{dE.removeAllListeners()}catch(qE){console.log(qE)}}):function(){}},[_u.appId]),reactExports.useEffect(function(){var UE=function(){try{return Promise.resolve(sE.current).then(function(){var RE=_u.tokenUrl,OE=_u.channel,HE=_u.uid,CE=_u.appId,jE=_u.token,LE=function(){if(dE&&!qE){_u.role==="audience"?dE.setClientRole(_u.role):dE.setClientRole("host");var i_=function(){if(RE){var o_=_catch(function(){return Promise.resolve(fetch(RE+"/rtc/"+OE+"/publisher/uid/"+(HE||0)+"/")).then(function(w_){return Promise.resolve(w_.json()).then(function(_y){var bS=_y.rtcToken;return Promise.resolve(dE.join(CE,OE,bS,HE||0)).then(function(MS){h.current=MS})})})},function(w_){console.log(w_)});if(o_&&o_.then)return o_.then(function(){})}else return Promise.resolve(dE.join(CE,OE,jE||null,HE||0)).then(function(w_){h.current=w_})}();if(i_&&i_.then)return i_.then(function(){})}else console.error("trying to join before RTC Engine was initialized")}();if(LE&&LE.then)return LE.then(function(){})})}catch(RE){return Promise.reject(RE)}},qE=!1;return IE?(UE(),console.log("Attempted join: ",_u.channel)):console.log("In precall - waiting to join"),function(){if(qE=!0,IE){console.log("Leaving channel");try{stopScreenshare(),j.current=!1}catch(gE){console.log(gE)}sE.current=dE.leave().catch(function(gE){return console.log(gE)})}}},[_u.channel,_u.uid,IE,_u.tokenUrl]),reactExports.useEffect(function(){var UE=function(){try{var gE=function(){function HE(){var jE=function(){if(Wt!=null&&Wt.enabled&&uE){var LE=function(){if(!vE)return Promise.resolve(dE.publish([Wt]).then(function(){vE=!0})).then(function(){})}();if(LE&&LE.then)return LE.then(function(){})}}();if(jE&&jE.then)return jE.then(function(){})}var CE=function(){if(_n!=null&&_n.enabled&&uE){var jE=function(){if(!AE)return Promise.resolve(dE.publish([_n]).then(function(){AE=!0})).then(function(){})}();if(jE&&jE.then)return jE.then(function(){})}}();return CE&&CE.then?CE.then(HE):HE(CE)},RE=function(){if(_u.enableDualStream)return Promise.resolve(dE.enableDualStream()).then(function(){})}();return Promise.resolve(RE&&RE.then?RE.then(gE):gE(RE))}catch(OE){return Promise.reject(OE)}};console.log("Publish",Wt,_n,IE),IE&&UE()},[IE,Wt==null?void 0:Wt.enabled,_n==null?void 0:_n.enabled,uE]),reactExports.useEffect(function(){Wt&&_n!==null&&(PE.current[0]={audioTrack:_n,videoTrack:Wt},yE({type:"update-user-video",value:[_n,Wt]}))},[_u.channel,uE]),reactExports.useEffect(function(){uE&&_u.token&&dE.renewToken(_u.token).then(function(UE){return console.log("renewed token",UE)})},[_u.token,uE]),reactExports.useEffect(function(){_u.role&&dE.setClientRole(_u.role).then(function(UE){return console.log("changed role",UE)})},[_u.role,uE]),reactExports.useEffect(function(){var UE=function(){try{var gE=function(){if(_u.activeSpeaker&&_u.layout!==layout.grid)return dE.on("volume-indicator",function(RE){var OE=RE.reduce(function(jE,LE){return jE===null||LE.level>jE.level?LE:jE},null),HE=OE?OE.uid:void 0,CE=HE===h.current?0:HE;HE!==void 0&&yE({type:"ActiveSpeaker",value:[CE]})}),Promise.resolve(dE.enableAudioVolumeIndicator()).then(function(){})}();return Promise.resolve(gE&&gE.then?gE.then(function(){}):void 0)}catch(RE){return Promise.reject(RE)}};return IE&&UE(),function(){dE.removeAllListeners("volume-indicator")}},[_u.activeSpeaker,_u.layout]);var FE=function(){try{var qE=function(){try{return yE({type:"Screensharing",value:[!0]}),Promise.resolve(AgoraRTC__default.createScreenVideoTrack({},"disable")).then(function(OE){_.current=OE;var HE=_u.screenshareUid||1;return PE.current[HE]={videoTrack:_.current},_.current.on("track-ended",function(){j.current=!1,yE({type:"Screensharing",value:[!1]})}),j.current=!0,Promise.resolve(startScreenshare(_u.appId,_u.channel,_.current,_u.screenshareToken,_u.screenshareUid,_u.tokenUrl,_u.enableDualStream)).then(function(){})})}catch(OE){return Promise.reject(OE)}},gE=function(){stopScreenshare(),j.current=!1};return j.current?gE():qE(),Promise.resolve()}catch(RE){return Promise.reject(RE)}};return React.createElement(RtcProvider,{value:{client:dE,mediaStore:PE.current,localVideoTrack:Wt,localAudioTrack:_n,dispatch:yE,localUid:h,channelJoined:uE,toggleScreensharing:FE,isScreensharing:j.current}},React.createElement(MaxUidProvider,{value:m_.max},React.createElement(MinUidProvider,{value:m_.min},_d?i.children:null)))},icons={videocam:React.createElement(React.Fragment,null,React.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),React.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:React.createElement(React.Fragment,null,React.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:React.createElement(React.Fragment,null,React.createElement("polyline",{points:"15 3 21 3 21 9"}),React.createElement("polyline",{points:"9 21 3 21 3 15"}),React.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),React.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:React.createElement(React.Fragment,null,React.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),React.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:React.createElement(React.Fragment,null,React.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),React.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:React.createElement(React.Fragment,null,React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),React.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),React.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:React.createElement(React.Fragment,null,React.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),React.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),React.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:React.createElement(React.Fragment,null,React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},BtnTemplate=function e(i){var h=i.onClick,_=i.name,j=i.disabled,_t=i.style,Wt=reactExports.useContext(PropsContext),_n=Wt.styleProps,_i=_n||{},_s=_i.theme,_u=_i.BtnTemplateStyles,_h=_i.iconSize,_d=_i.customIcon;return React.createElement("div",{style:_extends({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:j?"auto":"pointer",margin:4},_u,_t),onClick:h},_d?React.createElement("img",{src:_d[_],alt:_}):React.createElement("svg",{style:{width:_h||24,height:_h||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:j?"0.5":"1",stroke:_s||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},icons[_]))};function EndCall(){var e=reactExports.useContext(PropsContext),i=e.styleProps,h=e.callbacks,_=i||{},j=_.localBtnStyles,_t=j||{},Wt=_t.endCall;return React.createElement(BtnTemplate,{style:Wt||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return(h==null?void 0:h.EndCall)&&h.EndCall()}})}var LocalContext=reactExports.createContext({}),LocalUserContext=function e(i){var h=reactExports.useContext(MaxUidContext),_=reactExports.useContext(MinUidContext),j;return h[0].uid===0?j=h[0]:j=_.find(function(_t){return _t.uid===0}),React.createElement(LocalContext.Provider,{value:j},i.children)},muteAudio=function(e,i,h,_){try{var j=function(){if(e.uid===0){var _t=e.hasAudio,Wt=function(){if(_t===ToggleState.enabled||_t===ToggleState.disabled){var _n=_t===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;i({type:"local-user-mute-audio",value:[_n]}),_&&_["local-user-mute-audio"]&&_["local-user-mute-audio"](_n);var _i=_catch(function(){return Promise.resolve(h==null?void 0:h.setEnabled(_t!==ToggleState.enabled)).then(function(){_n=_t===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,_&&_["local-user-mute-audio"]&&_["local-user-mute-audio"](_n),i({type:"local-user-mute-audio",value:[_t===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled]})})},function(){i({type:"local-user-mute-audio",value:[_t]})});if(_i&&_i.then)return _i.then(function(){})}}();if(Wt&&Wt.then)return Wt.then(function(){})}}();return Promise.resolve(j&&j.then?j.then(function(){}):void 0)}catch(_t){return Promise.reject(_t)}};function LocalAudioMute(){var e=reactExports.useContext(PropsContext),i=e.styleProps,h=e.callbacks,_=i||{},j=_.localBtnStyles,_t=j||{},Wt=_t.muteLocalAudio,_n=reactExports.useContext(RtcContext),_i=_n.dispatch,_s=_n.localAudioTrack,_u=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:Wt,name:_u.hasAudio===ToggleState.enabled?"mic":"micOff",onClick:function(){return _s&&muteAudio(_u,_i,_s,h)}}))}function Screenshare(){var e=reactExports.useContext(PropsContext),i=e.styleProps,h=i||{},_=h.localBtnStyles,j=_||{},_t=j.screenshare,Wt=reactExports.useContext(RtcContext),_n=Wt.toggleScreensharing,_i=Wt.isScreensharing;return React.createElement("div",null,React.createElement(BtnTemplate,{style:_t,name:_i?"stop":"screen",onClick:function(){return _n()}}))}var muteVideo=function(e,i,h,_){try{var j=function(){if(e.uid===0){var _t=e.hasVideo,Wt=function(){if(_t===ToggleState.enabled||_t===ToggleState.disabled){var _n=_t===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;i({type:"local-user-mute-video",value:[_n]}),_&&_["local-user-mute-video"]&&_["local-user-mute-video"](_n);var _i=_catch(function(){return Promise.resolve(h==null?void 0:h.setEnabled(_t!==ToggleState.enabled)).then(function(){_n=_t===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,_&&_["local-user-mute-video"]&&_["local-user-mute-video"](_n),i({type:"local-user-mute-video",value:[_n]})})},function(){i({type:"local-user-mute-video",value:[_t]})});if(_i&&_i.then)return _i.then(function(){})}}();if(Wt&&Wt.then)return Wt.then(function(){})}}();return Promise.resolve(j&&j.then?j.then(function(){}):void 0)}catch(_t){return Promise.reject(_t)}};function LocalVideoMute(){var e=reactExports.useContext(PropsContext),i=e.styleProps,h=e.callbacks,_=i||{},j=_.localBtnStyles,_t=j||{},Wt=_t.muteLocalVideo,_n=reactExports.useContext(RtcContext),_i=_n.dispatch,_s=_n.localVideoTrack,_u=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:Wt,name:_u.hasVideo===ToggleState.enabled?"videocam":"videocamOff",onClick:function(){return _s&&muteVideo(_u,_i,_s,h)}}))}function LocalControls(){var e=reactExports.useContext(PropsContext),i=e.styleProps,h=e.rtcProps,_=i||{},j=_.localBtnContainer;return React.createElement("div",{style:_extends({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},j)},h.role!=="audience"&&React.createElement(LocalVideoMute,null),h.role!=="audience"&&React.createElement(LocalAudioMute,null),h.role!=="audience"&&h.enableScreensharing&&React.createElement(Screenshare,null),React.createElement(EndCall,null))}var rtmStatusEnum;(function(e){e[e.initFailed=0]="initFailed",e[e.offline=1]="offline",e[e.initialising=2]="initialising",e[e.loggingIn=3]="loggingIn",e[e.loggedIn=4]="loggedIn",e[e.connected=5]="connected",e[e.loginFailed=6]="loginFailed"})(rtmStatusEnum||(rtmStatusEnum={}));var clientRoleRaw;(function(e){e[e.broadcaster=0]="broadcaster",e[e.audience=1]="audience"})(clientRoleRaw||(clientRoleRaw={}));var mutingDevice;(function(e){e[e.camera=0]="camera",e[e.microphone=1]="microphone"})(mutingDevice||(mutingDevice={}));var popUpStateEnum;(function(e){e[e.closed=0]="closed",e[e.muteMic=1]="muteMic",e[e.muteCamera=2]="muteCamera",e[e.unmuteMic=3]="unmuteMic",e[e.unmuteCamera=4]="unmuteCamera"})(popUpStateEnum||(popUpStateEnum={}));var RtmContext=reactExports.createContext(null),RtmProvider=RtmContext.Provider;RtmContext.Consumer;function RemoteVideoMute(e){var i=reactExports.useContext(PropsContext),h=i.styleProps,_=reactExports.useContext(RtmContext),j=_.sendMuteRequest,_t=_.uidMap,Wt=h||{},_n=Wt.remoteBtnStyles,_i=_n||{},_s=_i.muteRemoteVideo,_u=e.UIKitUser,_h=_u.hasVideo===remoteTrackState.no;return _u.uid!==0&&_t[_u.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{name:_u.hasVideo===remoteTrackState.subbed?"videocam":"videocamOff",style:_s,onClick:function(){return j(mutingDevice.camera,_u.uid,!_h)}})):null}function RemoteAudioMute(e){var i=reactExports.useContext(PropsContext),h=i.styleProps,_=h||{},j=_.remoteBtnStyles,_t=reactExports.useContext(RtmContext),Wt=_t.sendMuteRequest,_n=_t.uidMap,_i=j||{},_s=_i.muteRemoteAudio,_u=e.UIKitUser,_h=_u.hasAudio===remoteTrackState.no;return _u.uid!==0&&_n[_u.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{style:_s,name:_u.hasAudio===remoteTrackState.subbed?"mic":"micOff",onClick:function(){return Wt(mutingDevice.microphone,_u.uid,!_h)}})):null}function SwapUser(e){var i=reactExports.useContext(RtcContext),h=i.dispatch,_=e.UIKitUser;return React.createElement("div",null,React.createElement(BtnTemplate,{name:"remoteSwap",onClick:function(){return h({type:"user-swap",value:[_]})}}))}var VideoPlaceholder=function e(i){var h=reactExports.useContext(PropsContext),_=h.styleProps,j=h.rtcProps,_t=_||{},Wt=_t.maxViewStyles,_n=_t.maxViewOverlayContainer,_i=i.user,_s=j.CustomVideoPlaceholder;return _s?_s&&_s(_extends({},i),null):React.createElement("div",{key:_i.uid,style:_extends({},style.max,Wt)},React.createElement("div",{style:style.imgContainer},React.createElement("img",{style:style.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),i.isShown&&React.createElement("div",{style:_extends({},style.btnContainer,_n)},i.showButtons&&React.createElement(React.Fragment,null,!j.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:_i}),!j.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:_i}),i.showSwap&&React.createElement(SwapUser,{UIKitUser:_i}))))},style={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},Username=function e(i){var h=reactExports.useContext(RtmContext),_=h.usernames,j=reactExports.useContext(PropsContext),_t=j.rtmProps,Wt=j.styleProps,_n=i.user;return _t!=null&&_t.displayUsername?React.createElement("p",{style:_extends({},styles.username,Wt==null?void 0:Wt.usernameText)},_n.uid===1?"Screenshare":_[_n.uid]):React.createElement(React.Fragment,null)},styles={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MaxVideoView=function e(i){var h=reactExports.useContext(RtcContext),_=h.mediaStore,j=reactExports.useContext(PropsContext),_t=j.styleProps,Wt=j.rtcProps,_n=_t||{},_i=_n.maxViewStyles,_s=_n.videoMode,_u=_n.maxViewOverlayContainer,_h=_s==null?void 0:_s.max,_d=reactExports.useState(!1),nE=_d[0],aE=_d[1],uE=i.user;return React.createElement("div",{style:_extends({},styles$1.container,i.style,_i),onMouseEnter:function(){return aE(!0)},onMouseLeave:function(){return aE(!1)}},uE.hasVideo===1?React.createElement("div",{style:styles$1.videoContainer},!Wt.disableRtm&&React.createElement(Username,{user:uE}),React.createElement(AgoraVideoPlayer,{style:styles$1.videoplayer,config:{fit:_h||"cover"},videoTrack:_[uE.uid].videoTrack}),nE&&React.createElement("div",{style:_extends({},styles$1.overlay,_u)},!Wt.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:uE}),!Wt.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:uE}))):React.createElement("div",{style:styles$1.videoContainer},!Wt.disableRtm&&React.createElement(Username,{user:uE}),React.createElement(VideoPlaceholder,{user:uE,isShown:nE,showButtons:!0})))},styles$1={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"},username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MinVideoView=function e(i){var h=reactExports.useContext(RtcContext),_=h.mediaStore,j=reactExports.useContext(PropsContext),_t=j.styleProps,Wt=j.rtcProps,_n=_t||{},_i=_n.minViewStyles,_s=_n.videoMode,_u=_n.minViewOverlayContainer,_h=_s==null?void 0:_s.min,_d=reactExports.useState(!1),nE=_d[0],aE=_d[1],uE=i.user;return React.createElement("div",{style:_extends({},{display:"flex",flex:1},_i),onMouseEnter:function(){return aE(!0)},onMouseLeave:function(){return aE(!1)}},uE.hasVideo===1?React.createElement("div",{style:_extends({},{display:"flex",flex:1,position:"relative"})},React.createElement(AgoraVideoPlayer,{style:{flex:10,display:"flex"},config:{fit:_h!==void 0?_h:"cover"},videoTrack:_[uE.uid].videoTrack}),nE&&React.createElement("div",{style:_extends({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},_u)},!Wt.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:uE}),!Wt.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:uE}),React.createElement(SwapUser,{UIKitUser:uE}))):React.createElement(VideoPlaceholder,{user:uE,isShown:nE,showButtons:!0,showSwap:!0}))},styles$2={test:"_3ybTi",scrollbar:"_3Sxu7"},PinnedVideo=function e(){var i=reactExports.useContext(PropsContext),h=i.styleProps,_=i.rtcProps,j=h||{},_t=j.minViewContainer,Wt=j.pinnedVideoContainer,_n=j.maxViewContainer,_i=j.scrollViewContainer,_s=reactExports.useRef(null),_u=reactExports.useState(0),_h=_u[0],_d=_u[1],nE=reactExports.useState(0),aE=nE[0],uE=nE[1],hE=_h>aE;return reactExports.useEffect(function(){var oE=function(){_s.current&&(_d(_s.current.offsetWidth),uE(_s.current.offsetHeight))};return window.addEventListener("resize",oE),_s.current&&(_d(_s.current.offsetWidth),uE(_s.current.offsetHeight)),function(){window.removeEventListener("resize",oE)}},[]),React.createElement("div",{ref:_s,style:_extends({},{display:"flex",flex:1,flexDirection:hE?"row":"column-reverse",overflow:"hidden"},Wt)},React.createElement("div",{style:_extends({},{display:"flex",flex:hE?5:4},_n)},React.createElement(MaxUidConsumer,null,function(oE){return _.role==="audience"&&oE[0].uid===0?null:React.createElement(MaxVideoView,{user:oE[0]})})),React.createElement("div",{className:styles$2.scrollbar,style:_extends({},{overflowY:hE?"scroll":"hidden",overflowX:hE?"hidden":"scroll",display:"flex",flex:1,flexDirection:hE?"column":"row"},_i)},React.createElement(MinUidConsumer,null,function(oE){return oE.map(function(sE){return _.role==="audience"&&sE.uid===0?null:React.createElement("div",{style:_extends({},{minHeight:hE?"35vh":"99%",minWidth:hE?"99%":"40vw",margin:2,display:"flex"},_t),key:sE.uid},React.createElement(MinVideoView,{user:sE}))})})))},GridVideo=function e(){var i=reactExports.useContext(PropsContext),h=i.styleProps,_=i.rtcProps,j=h||{},_t=j.gridVideoCells,Wt=j.gridVideoContainer,_n=reactExports.useContext(MaxUidContext),_i=reactExports.useContext(MinUidContext),_s=_.role==="audience"?[].concat(_n,_i).filter(function(dE){return dE.uid!==0}):[].concat(_n,_i),_u=reactExports.useRef(null),_h=reactExports.useState(window.innerWidth),_d=_h[0],nE=_h[1],aE=reactExports.useState(window.innerHeight),uE=aE[0],hE=aE[1],oE=_d>uE,sE="minmax(0, 1fr) ";return reactExports.useEffect(function(){var dE=function(){_u.current&&(nE(_u.current.offsetWidth),hE(_u.current.offsetHeight))};return window.addEventListener("resize",dE),_u.current&&(nE(_u.current.offsetWidth),hE(_u.current.offsetHeight)),function(){window.removeEventListener("resize",dE)}},[]),React.createElement("div",{ref:_u,style:_extends({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:oE?_s.length>9?sE.repeat(4):_s.length>4?sE.repeat(3):_s.length>1?sE.repeat(2):sE:_s.length>8?sE.repeat(3):_s.length>2?sE.repeat(2):sE},Wt)},_s.map(function(dE){return React.createElement(MaxVideoView,{user:dE,style:_extends({},{height:"100%",width:"100%"},_t),key:dE.uid})}))},useTracks=createMicrophoneAndCameraTracks({encoderConfig:{}},{encoderConfig:{}}),TracksConfigure=function e(i){var h=reactExports.useState(!1),_=h[0],j=h[1],_t=reactExports.useState(null),Wt=_t[0],_n=_t[1],_i=reactExports.useState(null),_s=_i[0],_u=_i[1],_h=useTracks(),_d=_h.ready,nE=_h.tracks,aE=_h.error,uE=reactExports.useRef({});return reactExports.useEffect(function(){return nE!==null?(_u(nE[0]),_n(nE[1]),uE.current[0]={audioTrack:nE[0],videoTrack:nE[1]},j(!0)):aE&&(console.error(aE),j(!1)),function(){if(nE){var hE,oE;(hE=nE[0])===null||hE===void 0||hE.close(),(oE=nE[1])===null||oE===void 0||oE.close()}}},[_d,aE]),React.createElement(TracksProvider,{value:{localVideoTrack:Wt,localAudioTrack:_s}},_?i.children:null)},timeNow=function e(){return new Date().getTime()},useChannel=createLazyChannel(),useClient$1=createLazyClient(),RtmConfigure=function e(i){var h=reactExports.useContext(PropsContext),_=h.rtcProps,j=h.rtmProps,_t=reactExports.useState(!1),Wt=_t[0],_n=_t[1],_i=useClient$1(_.appId),_s=useChannel(_i,_.channel),_u=reactExports.useRef(""),_h=reactExports.useRef(5),_d=reactExports.useContext(LocalContext),nE=reactExports.useContext(PropsContext),aE=nE.rtmCallbacks,uE=reactExports.useState({}),hE=uE[0],oE=uE[1],sE=reactExports.useState({}),dE=sE[0],vE=sE[1],AE=reactExports.useState({}),PE=AE[0],IE=AE[1],QE=reactExports.useState(popUpStateEnum.closed),m_=QE[0],yE=QE[1],FE=reactExports.useState(rtmStatusEnum.offline),UE=FE[0],qE=FE[1],gE=reactExports.useContext(RtcContext),RE=gE.localUid,OE=gE.localAudioTrack,HE=gE.localVideoTrack,CE=gE.dispatch,jE=gE.channelJoined,LE=function bT(){try{var U_=_.tokenUrl,sS=function(){if(U_){var h_=_catch(function(){return Promise.resolve(fetch(U_+"/rtm/"+((j==null?void 0:j.uid)||_u.current))).then(function(AS){return Promise.resolve(AS.json()).then(function(j0){var IN=j0.rtmToken;return Promise.resolve(_i.login({uid:(j==null?void 0:j.uid)||_u.current,token:IN})).then(function(){_h.current=5})})})},function(){setTimeout(function(){try{return _h.current=_h.current+_h.current,bT(),Promise.resolve()}catch(AS){return Promise.reject(AS)}},_h.current*1e3)});if(h_&&h_.then)return h_.then(function(){})}else{var fS=_catch(function(){return Promise.resolve(_i.login({uid:(j==null?void 0:j.uid)||_u.current,token:(j==null?void 0:j.token)||void 0})).then(function(){_h.current=5})},function(){setTimeout(function(){try{return _h.current=_h.current+_h.current,bT(),Promise.resolve()}catch(AS){return Promise.reject(AS)}},_h.current*1e3)});if(fS&&fS.then)return fS.then(function(){})}}();return Promise.resolve(sS&&sS.then?sS.then(function(){}):void 0)}catch(h_){return Promise.reject(h_)}},i_=function bT(){try{var U_=_catch(function(){return Promise.resolve(_s.join()).then(function(){_h.current=5})},function(){setTimeout(function(){try{return _h.current=_h.current+_h.current,bT(),Promise.resolve()}catch(sS){return Promise.reject(sS)}},_h.current*1e3)});return Promise.resolve(U_&&U_.then?U_.then(function(){}):void 0)}catch(sS){return Promise.reject(sS)}},o_=function(){try{if(qE(rtmStatusEnum.initialising),_.uid?_u.current=String(_.uid):_u.current=String(timeNow()),_i.on("ConnectionStateChanged",function(h_,fS){console.log(h_,fS)}),_i.on("TokenExpired",function(){try{var h_=_.tokenUrl;console.log("token expired - renewing");var fS=function(){if(h_){var AS=_catch(function(){return Promise.resolve(fetch(h_+"/rtm/"+((j==null?void 0:j.uid)||_u.current))).then(function(j0){return Promise.resolve(j0.json()).then(function(IN){var OT=IN.rtmToken;return Promise.resolve(_i.renewToken(OT)).then(function(){_h.current=5})})})},function(j0){console.error("TokenExpiredError",j0)});if(AS&&AS.then)return AS.then(function(){})}}();return Promise.resolve(fS&&fS.then?fS.then(function(){}):void 0)}catch(AS){return Promise.reject(AS)}}),_i.on("MessageFromPeer",function(h_,fS){bS(h_,fS)}),_s.on("ChannelMessage",function(h_,fS){bS(h_,fS)}),_s.on("MemberJoined",function(h_){try{return Promise.resolve(nR(w_(),h_)).then(function(){})}catch(fS){return Promise.reject(fS)}}),_s.on("MemberCountUpdated",function(h_){try{return console.log("RTM-MemberCountUpdated: ",h_),Promise.resolve()}catch(fS){return Promise.reject(fS)}}),aE!=null&&aE.channel?Object.keys(aE.channel).map(function(h_){aE.channel&&_s.on(h_,aE.channel[h_])}):aE!=null&&aE.client&&Object.keys(aE.client).map(function(h_){aE.client&&_i.on(h_,aE.client[h_])}),_.tokenUrl){var U_=_.tokenUrl,sS=_.uid;_i.on("TokenExpired",function(){try{return console.log("token expired"),Promise.resolve(fetch(U_+"/rtm/"+(sS||0)+"/")).then(function(h_){return Promise.resolve(h_.json()).then(function(fS){var AS=fS.rtmToken;_i.renewToken(AS)})})}catch(h_){return Promise.reject(h_)}})}return qE(rtmStatusEnum.loggingIn),Promise.resolve(LE()).then(function(){return qE(rtmStatusEnum.loggedIn),Promise.resolve(i_()).then(function(){qE(rtmStatusEnum.connected),vE(function(h_){return _extends({},h_,{0:j==null?void 0:j.username})}),XP(w_())})})}catch(h_){return Promise.reject(h_)}},w_=function(){return{messageType:"UserData",rtmId:(j==null?void 0:j.uid)||_u.current,rtcId:RE.current,username:j==null?void 0:j.username,role:_.role==="audience"?1:0,uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:AgoraRTM__default.VERSION,rtc:AgoraRTC__default.VERSION}}},_y=function(U_,sS,h_){var fS=(j==null?void 0:j.showPopUpBeforeRemoteMute)===!1,AS={messageType:"MuteRequest",device:U_,rtcId:sS,mute:h_,isForceful:fS},j0=hE[sS];fS&&!h_?console.log("cannot send force unmute request"):j0?nR(AS,j0):console.log("peer not found")},bS=function(U_,sS){var h_;if(U_.messageType==="RAW"?h_=parsePayload(U_.rawMessage):U_.messageType==="TEXT"&&(h_=JSON.parse(U_.text)),console.log(h_,sS),h_)switch(h_.messageType){case"UserData":MS(h_);break;case"MuteRequest":qR(h_);break;case"RtmDataRequest":switch(h_.type){case"ping":zL(sS);break;case"userData":wN(sS);break;default:console.log(sS)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},MS=function(U_){oE(function(sS){var h_;return _extends({},sS,(h_={},h_[U_.rtcId]=U_.rtmId,h_))}),vE(function(sS){var h_;return _extends({},sS,(h_={},h_[U_.rtcId]=U_.username,h_))}),IE(function(sS){var h_;return _extends({},sS,(h_={},h_[U_.rtmId]=U_,h_))})},qR=function(U_){RE.current===U_.rtcId&&(U_.isForceful?U_.mute?U_.device===mutingDevice.microphone?OE&&muteAudio(_d,CE,OE):U_.device===mutingDevice.camera&&HE&&muteVideo(_d,CE,HE):console.error("cannot force unmute"):U_.device===mutingDevice.microphone?U_.mute?yE(popUpStateEnum.muteMic):yE(popUpStateEnum.unmuteMic):U_.device===mutingDevice.camera&&(U_.mute?yE(popUpStateEnum.muteCamera):yE(popUpStateEnum.unmuteCamera)))},zL=function(U_){nR({messageType:"RtmDataRequest",type:"pong"},U_)},wN=function(U_){nR(w_(),U_)},XP=function(U_){try{var sS=_i.createMessage({text:JSON.stringify(U_),messageType:AgoraRTM__default.MessageType.TEXT}),h_=_catch(function(){return Promise.resolve(_s.sendMessage(sS)).then(function(){})},function(fS){console.error(fS)});return Promise.resolve(h_&&h_.then?h_.then(function(){}):void 0)}catch(fS){return Promise.reject(fS)}},nR=function(U_,sS){try{var h_=_i.createMessage({text:JSON.stringify(U_),messageType:AgoraRTM__default.MessageType.TEXT}),fS=_catch(function(){return Promise.resolve(_i.sendMessageToPeer(h_,String(sS))).then(function(){})},function(AS){console.error(AS)});return Promise.resolve(fS&&fS.then?fS.then(function(){}):void 0)}catch(AS){return Promise.reject(AS)}},HR=function(){try{return Promise.resolve(_i.logout()).then(function(){return Promise.resolve(_i.removeAllListeners()).then(function(){})})}catch(U_){return Promise.reject(U_)}};return reactExports.useEffect(function(){return jE&&(o_(),_n(!0)),function(){jE&&HR()}},[_.channel,_.appId,jE]),React.createElement(RtmProvider,{value:{rtmStatus:UE,sendPeerMessage:nR,sendChannelMessage:XP,sendMuteRequest:_y,rtmClient:_i,uidMap:hE,usernames:dE,userDataMap:PE,popUpState:m_,setPopUpState:yE}},Wt?i.children:React.createElement(React.Fragment,null))};new TextEncoder;var dec=new TextDecoder,parsePayload=function e(i){return JSON.parse(dec.decode(i))};function PopUp(){var e=reactExports.useContext(PropsContext),i=e.styleProps,h=reactExports.useContext(RtmContext),_=h.popUpState,j=h.setPopUpState,_t=i||{},Wt=_t.popUpContainer,_n=reactExports.useContext(RtcContext),_i=_n.dispatch,_s=_n.localVideoTrack,_u=_n.localAudioTrack,_h=reactExports.useContext(LocalContext);return _!==popUpStateEnum.closed?React.createElement("div",{style:_extends({},styles$3.container,Wt)},React.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},_===popUpStateEnum.muteCamera||_===popUpStateEnum.muteMic?"Mute ":"Unmute ",_===popUpStateEnum.muteCamera||_===popUpStateEnum.unmuteCamera?"Camera":"Mic","?"),React.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},React.createElement("div",{onClick:function(){switch(_){case popUpStateEnum.muteCamera:_h.hasVideo&&_s&&muteVideo(_h,_i,_s);break;case popUpStateEnum.muteMic:_h.hasAudio&&_u&&muteAudio(_h,_i,_u);break;case popUpStateEnum.unmuteCamera:!_h.hasVideo&&_s&&muteVideo(_h,_i,_s);break;case popUpStateEnum.unmuteMic:!_h.hasAudio&&_u&&muteAudio(_h,_i,_u);break}j(popUpStateEnum.closed)},style:styles$3.button},"Confirm"),React.createElement("div",{style:styles$3.buttonClose,onClick:function(){return j(popUpStateEnum.closed)}},"Close"))):null}var styles$3={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},AgoraUIKit=function e(i){var h=i.styleProps,_=i.rtcProps,j=h||{},_t=j.UIKitContainer;return React.createElement(PropsProvider,{value:i},React.createElement("div",{style:_extends({},style$1,_t)},_.role==="audience"?React.createElement(VideocallUI,null):React.createElement(TracksConfigure,null,React.createElement(VideocallUI,null))))},VideocallUI=function e(){var i=reactExports.useContext(PropsContext),h=i.rtcProps;return React.createElement(RtcConfigure,{callActive:h.callActive},React.createElement(LocalUserContext,null,h.disableRtm?React.createElement(React.Fragment,null,(h==null?void 0:h.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null)):React.createElement(RtmConfigure,null,React.createElement(PopUp,null),(h==null?void 0:h.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null))))},style$1={display:"flex",flex:1,minHeight:0,flexDirection:"column"};const defaultStates={token:"",channel:"",showVideo:!1};function App(){const[e,i]=reactExports.useState(defaultStates),h={EndCall:()=>i(defaultStates)},_={appId:"1510f54378f344449c5ac30a62c11f7f",...e};return e.showVideo&&e.channel&&e.token?jsxRuntimeExports.jsx("div",{style:{display:"flex",width:"100vw",height:"100vh"},children:jsxRuntimeExports.jsx(AgoraUIKit,{rtcProps:_,callbacks:h})}):jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"5px"},children:[jsxRuntimeExports.jsx("input",{onChange:_t=>i({...e,channel:_t.target.value}),type:"text",placeholder:"channel name",style:{height:"100px",width:"500px"}}),jsxRuntimeExports.jsx("input",{onChange:_t=>i({...e,token:_t.target.value}),type:"text",placeholder:"token",style:{height:"100px",width:"500px"}}),jsxRuntimeExports.jsx("button",{onClick:()=>i({...e,showVideo:!0}),children:"Start Video"})]})}createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
